<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>18 键/值编码 | Sean</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="do things for fun">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="18 键/值编码 | Sean">
    <meta name="twitter:description" content="do things for fun">

    <meta property="og:type" content="article">
    <meta property="og:title" content="18 键/值编码 | Sean">
    <meta property="og:description" content="do things for fun">

    
    <meta name="author" content="Sean">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/sean.png">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://laputa-er.github.io/2016/05/13/o-c基础教程第二版_18 键／值编码/"/>

    
</head>

<body class="home-template no-js">

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/mengxiang.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <span class="panel-arrow panel-left-arrow disabled">
        <i class="fa fa-angle-left"></i>
      </span>
      <span class="panel-arrow panel-right-arrow">
        <i class="fa fa-angle-right"></i>
      </span>

      <div class="panel-animation-container">
        <div class="panel-content panel-main__content">
            <a href="/" title="前往 Sean 的主页"><img src="/images/sean.png" width="80" alt="Sean logo" class="panel-cover__logo logo" /></a>
            <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Sean">Sean</a></h1>
            
            <span class="panel-cover__subtitle panel-subtitle">笔记分享</span>
            
            <hr class="panel-cover__divider" />
            <p class="panel-cover__description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
            <hr class="panel-cover__divider panel-cover__divider--secondary" />

            <div class="navigation-wrapper">
              <div>
              <nav class="cover-navigation cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="/#blog" title="访问笔记" class="blog-button">笔记</a></li>
                  <li style="display: none;">
                    <textarea>
                      
                        <li class="navigation__item"><a href="/projects">项目作品</a></li>
                      
                        <li class="navigation__item"><a href="/aboutme">关于我</a></li>
                      
                    </textarea>
                  </li>
                </ul>
              </nav>
              </div>
              <div>
              <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  

<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  



  </ul>
</nav>

              </div>
            </div>

          </div>
          <div class="panel-content panel-tagcloud_content">
            
              <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">笔记分类</h3>
    <div class="widget tagcloud">
      <a href="/tags/Objective-C基础教程第二版/">Objective-C基础教程第二版</a> <a href="/tags/The-Swift-Program-Language-2/">The Swift Program Language 2</a> <a href="/tags/c语言程序设计－现代方法/">c语言程序设计－现代方法</a> <a href="/tags/极客学院-ios中级/">极客学院_ios中级</a> <a href="/tags/极客学院-ios初级/">极客学院_ios初级</a> <a href="/tags/极客学院-ios高级/">极客学院_ios高级</a>
    </div>
  </div>

  
</aside>
            
          </div>
        </div>  

      </div>
      <div class="panel-cover--overlay cover-blue"></div>
  </div>
  </header>
    
    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2016-05-13T02:42:32.000Z" class="post-list__meta--date date">2016-05-13</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Objective-C基础教程第二版/">Objective-C基础教程第二版</a>
</span>
    </div>
    <h1 class="post-title">18 键/值编码</h1>
  </header>

  <section class="post">
    <!-- Table of Contents -->
    
    <div id="top-toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#18-1-入门项目"><span class="toc-number">1.</span> <span class="toc-text">18.1    入门项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-2-KVC简介"><span class="toc-number">2.</span> <span class="toc-text">18.2    KVC简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#valueForKey实例方法"><span class="toc-number">2.1.</span> <span class="toc-text">valueForKey实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setValue-forkey实例方法"><span class="toc-number">2.2.</span> <span class="toc-text">setValue:forkey实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-3-键路径"><span class="toc-number">3.</span> <span class="toc-text">18.3    键路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#valueForKeyPath实例方法"><span class="toc-number">3.1.</span> <span class="toc-text">valueForKeyPath实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setValue-forKeyPath实例方法"><span class="toc-number">3.2.</span> <span class="toc-text">setValue:forKeyPath实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-4-整体操作"><span class="toc-number">4.</span> <span class="toc-text">18.4    整体操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-1-休息一下"><span class="toc-number">4.1.</span> <span class="toc-text">18.4.1    休息一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-2-快速运算"><span class="toc-number">4.2.</span> <span class="toc-text">18.4.2    快速运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-5-批处理"><span class="toc-number">5.</span> <span class="toc-text">18.5    批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setValuesForKeysWithDictionary实例方法"><span class="toc-number">5.1.</span> <span class="toc-text">setValuesForKeysWithDictionary实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dictionaryWithValuesForKeys实例方法"><span class="toc-number">5.2.</span> <span class="toc-text">dictionaryWithValuesForKeys实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-6-nil-仍然可用"><span class="toc-number">6.</span> <span class="toc-text">18.6    nil 仍然可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-7-处理未定义键"><span class="toc-number">7.</span> <span class="toc-text">18.7    处理未定义键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-8-小结"><span class="toc-number">8.</span> <span class="toc-text">18.8    小结</span></a></li></ol>
    </div>
    <div id="tocShell"></div>
    <div id="toc" class="toc-article">
      <div class="btn-group drag-me">
        <i class="social fa fa-ellipsis-v"></i>
      </div>
      <div class="btn-group dropup-catelog">
        <button class="btn"><i class="social fa fa-list-ol"></i></button>
        <div class="catelog-content">
          <p class="toc-title-wrap">
            <strong class="toc-title">文章目录</strong>
          </p>
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#18-1-入门项目"><span class="toc-number">1.</span> <span class="toc-text">18.1    入门项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-2-KVC简介"><span class="toc-number">2.</span> <span class="toc-text">18.2    KVC简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#valueForKey实例方法"><span class="toc-number">2.1.</span> <span class="toc-text">valueForKey实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setValue-forkey实例方法"><span class="toc-number">2.2.</span> <span class="toc-text">setValue:forkey实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-3-键路径"><span class="toc-number">3.</span> <span class="toc-text">18.3    键路径</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#valueForKeyPath实例方法"><span class="toc-number">3.1.</span> <span class="toc-text">valueForKeyPath实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setValue-forKeyPath实例方法"><span class="toc-number">3.2.</span> <span class="toc-text">setValue:forKeyPath实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-4-整体操作"><span class="toc-number">4.</span> <span class="toc-text">18.4    整体操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-1-休息一下"><span class="toc-number">4.1.</span> <span class="toc-text">18.4.1    休息一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-2-快速运算"><span class="toc-number">4.2.</span> <span class="toc-text">18.4.2    快速运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-5-批处理"><span class="toc-number">5.</span> <span class="toc-text">18.5    批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setValuesForKeysWithDictionary实例方法"><span class="toc-number">5.1.</span> <span class="toc-text">setValuesForKeysWithDictionary实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dictionaryWithValuesForKeys实例方法"><span class="toc-number">5.2.</span> <span class="toc-text">dictionaryWithValuesForKeys实例方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-6-nil-仍然可用"><span class="toc-number">6.</span> <span class="toc-text">18.6    nil 仍然可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-7-处理未定义键"><span class="toc-number">7.</span> <span class="toc-text">18.7    处理未定义键</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-8-小结"><span class="toc-number">8.</span> <span class="toc-text">18.8    小结</span></a></li></ol>
        </div>
      </div>
    </div>
    
    <h2 id="18-1-入门项目"><a href="#18-1-入门项目" class="headerlink" title="18.1    入门项目"></a>18.1    入门项目</h2><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<h2 id="18-2-KVC简介"><a href="#18-2-KVC简介" class="headerlink" title="18.2    KVC简介"></a>18.2    KVC简介</h2><blockquote>
<p><strong>说明：</strong>通过<code>键／值编码（KVC）</code>，没有相应<code>getter</code>方法也能获取属性值，没有相应<code>setter</code>方法也能设置属性值。<br><strong>自动开箱和装箱：</strong>仅<code>KVC</code>具有这种功能，常规方法调用和属性语法不具备该功能。</p>
</blockquote>
<h3 id="valueForKey实例方法"><a href="#valueForKey实例方法" class="headerlink" title="valueForKey实例方法"></a>valueForKey实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>获取属性的<code>值</code>。<br><strong>原理：</strong>在<code>Objective-C</code>的运行中使用元数据打开对象并进入其中查找需要的信息，查找顺序为</p>
<ol>
<li>以参数命名(<code>key</code>或<code>isKey</code>)的<code>getter</code></li>
<li>名称为<code>_key</code>或<code>key</code>的实例变量</li>
</ol>
<p><strong>自动装箱：</strong>通过该方法获取属性值时，如果属性为<code>标量(int、float、struct)</code>，该方法会根据需要将属性放入<code>NSNumber</code>或<code>NSValue</code>中。<br><strong>兼容性：</strong>在<code>C</code>或<code>C++</code>中不能执行这种操作。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; key 属性名</span><br><span class="line">* @return &#123;id&#125; 属性值（标量会被自动装箱）</span><br><span class="line">*/</span></span><br><span class="line">- (nullable <span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<h3 id="setValue-forkey实例方法"><a href="#setValue-forkey实例方法" class="headerlink" title="setValue:forkey实例方法"></a>setValue:forkey实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>设置属性的<code>值</code>。<br><strong>自动开箱：</strong>使用该方法设置属性时，如果属性是<code>标量（int、float、struct）</code>，则会从新值（<code>id</code>）中提取出和属性类型相符的<code>标量</code>。<br><strong>技巧：</strong>如果想设置一个<code>标量</code>值，在调用<code>setValue</code>方法之前需要将它们包装掐来（封装到对象中）。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; value 要设置的值（需要的话会被开箱）</span><br><span class="line">* @param &#123;NSString *&#125; key 属性名</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(nullable <span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 创建 Car 对象</span></span><br><span class="line">Car *car = [[Car alloc] init];</span><br><span class="line">car.name = <span class="string">@"Herbie"</span>;</span><br><span class="line">car.make = <span class="string">@"Honda"</span>;</span><br><span class="line">car.model = <span class="string">@"CRX"</span>;</span><br><span class="line">car.modelYear = <span class="number">1984</span>;</span><br><span class="line">car.numberOfDoors = <span class="number">2</span>;</span><br><span class="line">car.mileage = <span class="number">110000</span>;</span><br><span class="line"><span class="comment">// 初始化轮胎</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    AllWeatherRadial *tire;</span><br><span class="line">    tire = [[AllWeatherRadial alloc] init];</span><br><span class="line">    [car setTire: tire atIndex:i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化引擎</span></span><br><span class="line">Slant6 *engine = [[Slant6 alloc] init];</span><br><span class="line">car.engine = engine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 访问车的引擎的马力</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [engine valueForKey:<span class="string">@"horsepower"</span>]);</span><br><span class="line"><span class="comment">// 通过 KVC 重新设置车的引擎的马力</span></span><br><span class="line">[engine setValue:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">150</span>] forKey:<span class="string">@"horsepower"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [engine valueForKey:<span class="string">@"horsepower"</span>]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Car is %@"</span>, car);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 访问车的名字</span></span><br><span class="line"><span class="built_in">NSString</span> *name = [car valueForKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, name);</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的制造商</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"make is %@"</span>, [car valueForKey:<span class="string">@"make"</span>]);</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的车型出厂日期</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"model year is %@"</span>, [car valueForKey:<span class="string">@"modelYear"</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 设置车名</span></span><br><span class="line">[car setValue:<span class="string">@"Harold"</span> forKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"new car name is %@"</span>, [car name]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 设置里程数</span></span><br><span class="line">[car setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">25062.4</span>] forKey:<span class="string">@"mileage"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"new mileage is %.1f"</span>, [car mileage]);</span><br></pre></td></tr></table></figure>
<h2 id="18-3-键路径"><a href="#18-3-键路径" class="headerlink" title="18.3    键路径"></a>18.3    键路径</h2><blockquote>
<p><strong>说明：</strong>进行<code>get</code>和<code>set</code>操作，除了通过<code>键</code>，还可以通过<code>键路径</code>。<code>键路径</code>可以根据<code>对象图</code>访问到任意深度的对象，比使用一系列嵌套方法调用更容易访问到对象。</p>
</blockquote>
<h3 id="valueForKeyPath实例方法"><a href="#valueForKeyPath实例方法" class="headerlink" title="valueForKeyPath实例方法"></a>valueForKeyPath实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>获取属性的<code>值</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; keyPath 键路径</span><br><span class="line">* @return &#123;id&#125; 属性值（标量会被自动装箱）</span><br><span class="line">*/</span></span><br><span class="line">- (nullable <span class="keyword">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<h3 id="setValue-forKeyPath实例方法"><a href="#setValue-forKeyPath实例方法" class="headerlink" title="setValue:forKeyPath实例方法"></a>setValue:forKeyPath实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>设置属性的<code>值</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; value 要设置的值（需要的话会被开箱）</span><br><span class="line">* @param &#123;NSString *&#125; keyPath 键路径</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(nullable <span class="keyword">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过 KVC 设置车的引擎的马力</span></span><br><span class="line">[car setValue:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">155</span>] forKeyPath:<span class="string">@"engine.horsepower"</span>];</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的引擎的马力</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [car valueForKeyPath:<span class="string">@"engine.horsepower"</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="18-4-整体操作"><a href="#18-4-整体操作" class="headerlink" title="18.4    整体操作"></a>18.4    整体操作</h2><blockquote>
<p><strong>说明：</strong>如果使用<code>键值</code>或<code>键路径</code>访问位于对象中的数组类型的<code>实例属性</code>的元素，实际上会对数组中所有元素进行操作。如果是查询操作，则还会将查询结果打包到另一个数组中并返回。<br><strong>注意：</strong>这种<code>整体操作</code>意味着无法在<code>键路径</code>中单独索引数组类型的属性的其中一个元素。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过 KVC 访问车的轮胎的胎压，会便利tires的每个属性，并将所有tires的属性的pressure变量封装到 NSNumber 对象中并返回</span></span><br><span class="line"><span class="built_in">NSArray</span> *pressures = [car valueForKeyPath:<span class="string">@"tires.pressure"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"pressures %@"</span>, pressures);</span><br></pre></td></tr></table></figure>
<h3 id="18-4-1-休息一下"><a href="#18-4-1-休息一下" class="headerlink" title="18.4.1    休息一下"></a>18.4.1    休息一下</h3><blockquote>
<p><strong>说明：</strong>创建一个新的类用于后面的学习使用。</p>
</blockquote>
<p><em>Garage.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Car</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Garage</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">	<span class="built_in">NSString</span> *name;</span><br><span class="line">	<span class="built_in">NSMutableArray</span> *cars;</span><br><span class="line">	<span class="built_in">NSMutableDictionary</span> *stuff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readwrite</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) addCar: (Car *) car;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Garage</span></span><br></pre></td></tr></table></figure>
<p><em>Garage.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Garage.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Garage</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> name;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) addCar: (Car *) car &#123;</span><br><span class="line">	<span class="keyword">if</span> (cars == <span class="literal">nil</span>) &#123;</span><br><span class="line">		cars = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">	&#125;</span><br><span class="line">	[cars addObject: car];</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// addCar</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) dealloc &#123;</span><br><span class="line">	[name release];</span><br><span class="line">	[cars release];</span><br><span class="line">	[stuff release];</span><br><span class="line">	[<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125; <span class="comment">// dealloc</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print &#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@:"</span>, name);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (Car *car <span class="keyword">in</span> cars) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"    %@"</span>, car);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setValue: (<span class="keyword">id</span>) value  forUndefinedKey: (<span class="built_in">NSString</span> *) key &#123;</span><br><span class="line">	<span class="keyword">if</span> (stuff == <span class="literal">nil</span>) &#123;</span><br><span class="line">		stuff = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">	&#125;</span><br><span class="line">	[stuff setValue: value forKey: key];</span><br><span class="line">&#125; <span class="comment">// setValueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) valueForUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">	<span class="keyword">id</span> value = [stuff valueForKey: key];</span><br><span class="line">	<span class="keyword">return</span> (value);</span><br><span class="line">&#125; <span class="comment">// valueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span>  <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 汽车集合</span></span><br><span class="line">Garage *garage = [[Garage alloc] init];</span><br><span class="line">garage.name = <span class="string">@"Joe's Garage"</span>;</span><br><span class="line"><span class="comment">// 创建一些汽车实例</span></span><br><span class="line">Car *car;</span><br><span class="line">car = makeCar(<span class="string">@"Herbie"</span>, <span class="string">@"Honda"</span>, <span class="string">@"CRX"</span>, <span class="number">1984</span>, <span class="number">2</span>, <span class="number">110000</span>, <span class="number">58</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Badger"</span>, <span class="string">@"Acura"</span>, <span class="string">@"integra"</span>, <span class="number">1987</span>, <span class="number">5</span>, <span class="number">217036</span>, <span class="number">130</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Elvis"</span>, <span class="string">@"Acura"</span>, <span class="string">@"Legend"</span>, <span class="number">1989</span>, <span class="number">4</span>, <span class="number">28123.4</span>, <span class="number">151</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Phoenix"</span>, <span class="string">@"Pontiac"</span>, <span class="string">@"Firebird"</span>, <span class="number">1969</span>, <span class="number">2</span>, <span class="number">85128.3</span>, <span class="number">345</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察汽车集合</span></span><br><span class="line">[garage print];</span><br></pre></td></tr></table></figure>
<h3 id="18-4-2-快速运算"><a href="#18-4-2-快速运算" class="headerlink" title="18.4.2    快速运算"></a>18.4.2    快速运算</h3><blockquote>
<p><strong>说明：</strong><code>键路径</code>中可以使用进行引用一些运算符进行一些运算，比如</p>
<ul>
<li><strong>prevProperty.<code>@count</code>：</strong>计算 <strong>prevProperty</strong> 包含的对象的总数</li>
<li><strong>prevProperty.<code>@sum</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的总和</li>
<li><strong>prevProperty.<code>@avg</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的平均值</li>
<li><strong>prevProperty.<code>@max</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的最大值</li>
<li><strong>prevProperty.<code>@min</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的最小值</li>
<li><strong>prevProperty.<code>@distinctUnionOfObjects</code>.nextProperty：</strong>获得从<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性构成的集合去重后的集合</li>
</ul>
<p><strong>注意：</strong>不要滥用<code>KVC</code>通过<code>键路径</code>提供的处理集合类的<code>快速运算</code>特性，因为</p>
<ul>
<li>速度比较慢</li>
<li>编译器无法对它进行错误检查（出现运行时错误时才能发觉）</li>
</ul>
<p><strong>限制：</strong>无法添加自定义的运算符</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// @count</span></span><br><span class="line"><span class="built_in">NSNumber</span> *count = [garage valueForKeyPath:<span class="string">@"cars.@count"</span>];</span><br><span class="line"><span class="comment">// @sum</span></span><br><span class="line"><span class="built_in">NSNumber</span> *sum = [garage valueForKeyPath:<span class="string">@"cars.@sum.mileage"</span>];</span><br><span class="line"><span class="comment">// @avg</span></span><br><span class="line"><span class="built_in">NSNumber</span> *avgMileage = [garage valueForKeyPath:<span class="string">@"cars.@avg.mileage"</span>];</span><br><span class="line"><span class="comment">// @max、 @min</span></span><br><span class="line"><span class="built_in">NSNumber</span> *min, *max;</span><br><span class="line">max = [garage valueForKeyPath:<span class="string">@"cars.@max.mileage"</span>];</span><br><span class="line">min = [garage valueForKeyPath:<span class="string">@"cars.@max.mileage"</span>];</span><br><span class="line"><span class="comment">// @distinctUnionOfObjects</span></span><br><span class="line"><span class="built_in">NSArray</span> *manufacture = [garage valueForKeyPath:<span class="string">@"cars.@distinctUnionOfObjects.make"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="18-5-批处理"><a href="#18-5-批处理" class="headerlink" title="18.5    批处理"></a>18.5    批处理</h2><blockquote>
<p><strong>说明：</strong><code>KVC</code>提供了对对象进行批量操作的方式。</p>
</blockquote>
<h3 id="setValuesForKeysWithDictionary实例方法"><a href="#setValuesForKeysWithDictionary实例方法" class="headerlink" title="setValuesForKeysWithDictionary实例方法"></a>setValuesForKeysWithDictionary实例方法</h3><blockquote>
<p><strong>说明：</strong>通过<code>字典</code>对对象进行批量<code>set</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSDictionary&lt;NSString *, id&gt; *&#125; keyedValues 包含一系列属性名和值的字典</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValuesForKeysWithDictionary:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)keyedValues;</span><br></pre></td></tr></table></figure>
<h3 id="dictionaryWithValuesForKeys实例方法"><a href="#dictionaryWithValuesForKeys实例方法" class="headerlink" title="dictionaryWithValuesForKeys实例方法"></a>dictionaryWithValuesForKeys实例方法</h3><blockquote>
<p><strong>说明：</strong>通过<code>数组</code>对对象进行批量<code>set</code><br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSArray&lt;NSString *&gt; *&#125; keys 包含要获取的属性的属性名</span><br><span class="line">* @return &#123;NSDictionary&lt;NSString *, id&gt; *&#125; 包含要获取的属性名/属性值对的字典</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取汽车集合中的最后一个汽车实例</span></span><br><span class="line">car = [[garage valueForKeyPath:<span class="string">@"cars"</span>] lastObject];</span><br><span class="line"><span class="comment">// 创建一个数组：包含创建字典需要的键集合</span></span><br><span class="line"><span class="built_in">NSArray</span> *keys = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"make"</span>, <span class="string">@"model"</span>, <span class="string">@"modelYear"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 使用 KVC 批量get：利用上一步创建的包含一系列键的数组</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *carValues = [car dictionaryWithValuesForKeys:keys];</span><br><span class="line"><span class="comment">// 创建字典：用于初始化汽车实例的属性</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *newValues = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                           <span class="string">@"Chevy"</span>, <span class="string">@"make"</span>,</span><br><span class="line">                           <span class="string">@"Nova"</span>,<span class="string">@"model"</span>,</span><br><span class="line">                           [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1964</span>], <span class="string">@"modelYear"</span>,</span><br><span class="line">                           [<span class="built_in">NSNull</span> null], <span class="string">@"mileage"</span>,</span><br><span class="line">                           <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 使用 KVC 批量set汽车</span></span><br><span class="line">[car setValuesForKeysWithDictionary:newValues];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"car with new values is %@"</span>, car);</span><br></pre></td></tr></table></figure>
<h2 id="18-6-nil-仍然可用"><a href="#18-6-nil-仍然可用" class="headerlink" title="18.6    nil 仍然可用"></a>18.6    nil 仍然可用</h2><blockquote>
<p><strong>背景：</strong>默认情况下，应用<code>KVC</code>调用<code>setValue:forKey</code>设置某个属性的值为<code>nil</code>时，编译器会给出警告。<br><strong>解决：</strong>可以通过重写<code>setNilValueForKey</code>方法给出有意义个返回值而避免警告。<br><strong>扩展：</strong>这里的 <code>nil</code>是标量<code>nil</code>，不要和<code>[NSNull null]</code>相混淆</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) setNilValueForKey: (<span class="built_in">NSString</span> *) key &#123;</span><br><span class="line">	<span class="keyword">if</span> ([key isEqualToString: <span class="string">@"mileage"</span>]) &#123;</span><br><span class="line">		mileage = <span class="number">0</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		[<span class="keyword">super</span> setNilValueForKey: key];</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="comment">// setNilValueForKey</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 会将 mileage 设置为 0</span></span><br><span class="line">[car setValue: <span class="literal">nil</span> forKey: <span class="string">@"mileage"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="18-7-处理未定义键"><a href="#18-7-处理未定义键" class="headerlink" title="18.7    处理未定义键"></a>18.7    处理未定义键</h2><blockquote>
<p><strong>背景：</strong>如果<code>KVC</code>机制无法找到处理方法，会退回并询问该如何处理。默认的实现会取消操作。<br><strong>解决：</strong>通过重写<code>setValue:forUndefinedKey</code>和<code>valueForUndefinedKey</code>更改默认行为，使对象可以设置和获取任何键。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  处理通过 KVC 设置不存在的属性的值</span><br><span class="line"> *</span><br><span class="line"> *  @param value 要设置的值</span><br><span class="line"> *  @param key   要设置的属性名</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setValue:(<span class="keyword">id</span>)value forUndefinedKey: (<span class="built_in">NSString</span> *) key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 惰性初始化</span></span><br><span class="line">    <span class="keyword">if</span> (stuff == <span class="literal">nil</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        stuff = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    [stuff setValue:value forKey:key];</span><br><span class="line">&#125;<span class="comment">// setValueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  处理通过 KVC 方式获取不存在的属性的值</span><br><span class="line"> *</span><br><span class="line"> *  @param key 属性名</span><br><span class="line"> *</span><br><span class="line"> *  @return 试图获取不存在的属性的值时的返回值</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>) valueForUndefinedKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span> value = [stuff valueForKey:key];</span><br><span class="line">    <span class="keyword">return</span> (value);</span><br><span class="line">&#125;<span class="comment">// valueForUnderfinedKey</span></span><br></pre></td></tr></table></figure>
<h2 id="18-8-小结"><a href="#18-8-小结" class="headerlink" title="18.8    小结"></a>18.8    小结</h2>
  </section>

</article>


<section class="post-comments">
  <!-- 多说评论框 start -->
  <div id="ds-thread" class="ds-thread" data-thread-key="http://laputa-er.github.io/2016/05/13/o-c基础教程第二版_18 键／值编码/" data-title="18 键/值编码" data-url="http://laputa-er.github.io/2016/05/13/o-c基础教程第二版_18 键／值编码/"></div>
  <!-- 多说评论框 end -->
  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"lapuda-er"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->
</section>




            <footer class="footer">
    <span class="footer__copyright">
        本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2016 - 
        本站修改自<a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">hexo-theme-vno</a>
    </span>
</footer>

        </div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>

     
</body>
</html>
