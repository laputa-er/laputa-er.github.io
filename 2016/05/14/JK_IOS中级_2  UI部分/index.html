<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="极客学院_ios中级," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="说明：iOS实战项目

2.1    汤姆猫小游戏（投诉下线）2.2    加法计算器
说明：本课时讲解 storyboard 中利用 UITextField、UILabel、UIButton 快速搭建器计算器UI界面，并在 viewController 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。

设置Text Field使用数字键盘
点击“计算”后，使Tex">
<meta property="og:type" content="article">
<meta property="og:title" content="2 UI部分">
<meta property="og:url" content="http://laputa-er.github.io/2016/05/14/JK_IOS中级_2  UI部分/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="说明：iOS实战项目

2.1    汤姆猫小游戏（投诉下线）2.2    加法计算器
说明：本课时讲解 storyboard 中利用 UITextField、UILabel、UIButton 快速搭建器计算器UI界面，并在 viewController 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。

设置Text Field使用数字键盘
点击“计算”后，使Tex">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%888.59.20.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%889.29.01.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%8810.43.32.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-02%20%E4%B8%8A%E5%8D%8812.11.15.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-04%2012.15.01.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-05%20%E4%B8%8B%E5%8D%883.20.24.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_more.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.29.09.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.24.35.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_qq.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-16%20%E4%B8%8A%E5%8D%889.34.22.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.09.10.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.06.44.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_contact.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%8810.17.31.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_show.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8A%E5%8D%8812.23.35.png">
<meta property="og:image" content="http://laputa-er.github.io/./show2.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.43.58.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.44.32.png">
<meta property="og:image" content="http://laputa-er.github.io/./屏幕快照 2016-03-23 10.14.46.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_section.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-23%2010.35.09.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%889.51.15.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%8810.25.47.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-25%20%E4%B8%8A%E5%8D%8812.28.25.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_gesture.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.11.53.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.26.12.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_animation.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_wheel.gif">
<meta property="og:updated_time" content="2016-05-14T08:18:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2 UI部分">
<meta name="twitter:description" content="说明：iOS实战项目

2.1    汤姆猫小游戏（投诉下线）2.2    加法计算器
说明：本课时讲解 storyboard 中利用 UITextField、UILabel、UIButton 快速搭建器计算器UI界面，并在 viewController 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。

设置Text Field使用数字键盘
点击“计算”后，使Tex">
<meta name="twitter:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/2016/05/14/JK_IOS中级_2  UI部分/"/>

  <title> 2 UI部分 | Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                2 UI部分
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:56:56+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_2  UI部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_2  UI部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p><strong>说明：</strong><code>iOS</code>实战项目</p>
</blockquote>
<h2 id="2-1-汤姆猫小游戏（投诉下线）"><a href="#2-1-汤姆猫小游戏（投诉下线）" class="headerlink" title="2.1    汤姆猫小游戏（投诉下线）"></a>2.1    汤姆猫小游戏（投诉下线）</h2><h2 id="2-2-加法计算器"><a href="#2-2-加法计算器" class="headerlink" title="2.2    加法计算器"></a>2.2    加法计算器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>storyboard</code> 中利用 <code>UITextField</code>、<code>UILabel</code>、<code>UIButton</code> 快速搭建器计算器UI界面，并在 <code>viewController</code> 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。</p>
<ul>
<li>设置<code>Text Field</code>使用数字键盘</li>
<li>点击“计算”后，使<code>Text Field</code>失去焦点</li>
<li>处理<code>Text Field</code>没有输入的情况</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text1: <span class="type">UITextField</span>!<span class="comment">// 操作数1控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text2: <span class="type">UITextField</span>!<span class="comment">// 操作数2控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> result: <span class="type">UILabel</span>!<span class="comment">// 结果控件</span></span><br><span class="line">    <span class="comment">// 计算</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> num1 = <span class="type">Int</span>(<span class="keyword">self</span>.text1.text!) ?? <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> num2 = <span class="type">Int</span>(<span class="keyword">self</span>.text2.text!) ?? <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> resultNum = num1 + num2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> resultString = <span class="string">"\(resultNum)"</span><span class="comment">//String(resultNum)</span></span><br><span class="line">        <span class="keyword">self</span>.result.text = resultString</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使输入框失去焦点</span></span><br><span class="line">        <span class="keyword">self</span>.text1.endEditing(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">self</span>.text2.endEditing(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清零</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.result.text = <span class="string">"0"</span></span><br><span class="line">        <span class="keyword">self</span>.text1.text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.text2.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-制作图片浏览器"><a href="#2-3-制作图片浏览器" class="headerlink" title="2.3    制作图片浏览器"></a>2.3    制作图片浏览器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>UILable</code>、<code>UIButton</code>、<code>UIImageView</code> 搭建一个图片浏览器的结构，并通过字典数组完成它的业务逻辑，实现浏览趣味图片的功能。</p>
<ul>
<li>切换按钮的不同<code>State Config</code>要分别进行设置</li>
<li>通过设置按钮控件的<code>enabled</code>属性设置按钮是否可点击</li>
<li>图片资源通过<code>plist</code>存储</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%888.59.20.png" alt="Alt text"><br><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *leftBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *rightBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> index;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSArray</span> *imageDicts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)leftBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index--;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)rightBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取存储图片的数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 存储图片的数组（字典数组）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)imageDicts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_imageDicts.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"imageData"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        _imageDicts = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"still"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _imageDicts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  切换图片</span><br><span class="line"> *</span><br><span class="line"> *  @param isAdd 是否向后(右)翻</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) btnClickChange: (<span class="built_in">BOOL</span>) isAdd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), <span class="keyword">self</span>.imageDicts.count]);</span><br><span class="line">    <span class="keyword">self</span>.topLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%lu"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), (<span class="keyword">unsigned</span> <span class="keyword">long</span>)<span class="keyword">self</span>.imageDicts.count];</span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = <span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"description"</span>];</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"name"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.leftBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">0</span>);<span class="comment">// 左边按钮的状态</span></span><br><span class="line">    <span class="keyword">self</span>.rightBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">4</span>);<span class="comment">// 右边按钮的状态</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-LOL英雄展示"><a href="#2-4-LOL英雄展示" class="headerlink" title="2.4    LOL英雄展示"></a>2.4    LOL英雄展示</h2><blockquote>
<p><strong>说明：</strong>通过<code>UITableView</code>和<code>plist</code>数据文件，搭建一个LOL英雄展示界面。</p>
<ul>
<li><code>UITableView</code>需要通过右键菜单设置<code>dataSource</code>和<code>delegate</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%889.29.01.png" alt="Alt text"></li>
<li><code>ViewController</code>要采纳相应的协议（<code>UITableViewDataSource</code>,<code>UITableViewDelegate</code>）：通过采纳相应的协议实现对<code>TableView</code>的中的<code>cell</code>的创建工作</li>
<li>通过使用<code>JKHero</code>类封装<code>plist</code>数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%8810.43.32.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="2-4-1-数据模版"><a href="#2-4-1-数据模版" class="headerlink" title="2.4.1    数据模版"></a>2.4.1    数据模版</h3><p><em>JKHero.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKHero</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 成员属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKHero.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKHero</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="comment">//        self.icon = [dict[@"icon"] copy];</span></span><br><span class="line"><span class="comment">//        self.name = [dict[@"name"] copy];</span></span><br><span class="line"><span class="comment">//        self.intro = [dict[@"intro"] copy];</span></span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];<span class="comment">// 利用 kvc</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-采纳协议"><a href="#2-4-2-采纳协议" class="headerlink" title="2.4.2    采纳协议"></a>2.4.2    采纳协议</h3><blockquote>
<p><strong>说明：</strong>通过扩展采纳协议。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *heros;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取英雄列表数据(懒加载)</span><br><span class="line"> *</span><br><span class="line"> *  @return JKHero类型的可变数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *) heros</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_heros) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"heros"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKHero *hero = [JKHero heroWithDict:dict];</span><br><span class="line">            [arrayM addObject:hero];</span><br><span class="line">        &#125;</span><br><span class="line">        _heros = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _heros;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - UITableViewDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少行</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.heros.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组默认有多少行(可以不实现，默认就是1)</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView sectionForSectionIndexTitle:(<span class="built_in">NSString</span> *)title atIndex:(<span class="built_in">NSInteger</span>)index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cell的高度</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建tableView中的所有cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"heroCell"</span>;</span><br><span class="line">    <span class="comment">// 创建cell</span></span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置cell的样式风格</span></span><br><span class="line">    cell.accessoryType = <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>;</span><br><span class="line">    <span class="comment">// 设置cell内容</span></span><br><span class="line">    JKHero *hero = <span class="keyword">self</span>.heros[indexPath.row];</span><br><span class="line">    cell.textLabel.text = hero.name;</span><br><span class="line">    cell.detailTextLabel.text = hero.intro;</span><br><span class="line">    cell.detailTextLabel.textColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:hero.icon];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏状态栏</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersStatusBarHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-5-Face-人脸识别技术入门"><a href="#2-5-Face-人脸识别技术入门" class="headerlink" title="2.5    Face++人脸识别技术入门"></a>2.5    Face++人脸识别技术入门</h2><blockquote>
<p><strong>注意：</strong>课程中的演示程项目是<code>Android</code>项目！</p>
</blockquote>
<h3 id="2-5-1-本课概要"><a href="#2-5-1-本课概要" class="headerlink" title="2.5.1    本课概要"></a>2.5.1    本课概要</h3><h4 id="2-5-1-1-Face-公司简介"><a href="#2-5-1-1-Face-公司简介" class="headerlink" title="2.5.1.1    Face++公司简介"></a>2.5.1.1    Face++公司简介</h4><blockquote>
<p><strong>网址：</strong><a href="http://www.faceplusplus.com.cn/" target="_blank" rel="external">http://www.faceplusplus.com.cn/</a></p>
</blockquote>
<ul>
<li>北京旷视科技有限公司（Face++）创立于2011年，是一家专注于机器视觉和深度学习的科技创业公司。</li>
<li>北京旷视科技旗下的Face++人脸识别云平台，是世界最大的人脸识别技术云平台。服务超过2万的开发者，日调用超过2百万次，积累人脸数据超过10亿张。</li>
<li>北京旷世科技先后获得联想创投的天使投资，和创新工场李开复博士的A轮投资。并获得2012年黑马创业大赛全国总冠军。</li>
</ul>
<h4 id="2-5-1-2-Face-核心技术简介"><a href="#2-5-1-2-Face-核心技术简介" class="headerlink" title="2.5.1.2 Face++核心技术简介"></a>2.5.1.2 Face++核心技术简介</h4><ul>
<li>旷视科技旗下Face++平台是世界最大的人脸识别技术云平台，提供包括人脸检测、人脸分析、人脸识别、人脸搜索等全套核心技术。</li>
<li>Face++的人脸技术居世界领先地位。其中，人脸检测技术获<code>FDDB</code>评测世界第一，人脸关键点技术获300-W评测世界第一，人脸识别技术获LFW评测世界第一。</li>
<li>Face++已搭建起世界领先的大数据深度学习（deep learning）技术引擎，可以提供人脸技术以外先进的视觉技术。其深度学习引擎可以和<code>Google</code>、<code>Facebook</code>形成强有力竞争。</li>
<li>旷视科技拥有自己独立的知识产权，有多项国内国外专利在申。</li>
</ul>
<h5 id="人脸检测和追踪"><a href="#人脸检测和追踪" class="headerlink" title="人脸检测和追踪"></a>人脸检测和追踪</h5><ul>
<li>Face++人脸检测技术在世界权威<code>FDDB</code>测试集上排名世界第一</li>
<li>Face++人脸检测技术针对移动和嵌入式设备做过多项性能优化，检测率高、内存消耗小、模型小，最小可稳定检测16x16大小的人脸<h5 id="Face-人脸关键点定位"><a href="#Face-人脸关键点定位" class="headerlink" title="Face++人脸关键点定位"></a>Face++人脸关键点定位</h5></li>
<li>Face++人脸关键点定位技术在世界权威300-W测试集上排名世界第一</li>
<li>Face++人脸关键点定位提供5点，23点，83点等多个版本，对移动和嵌入式设备做过多项性能优化<h5 id="Face-人脸属性分析"><a href="#Face-人脸属性分析" class="headerlink" title="Face++人脸属性分析"></a>Face++人脸属性分析</h5></li>
<li>Face++ 人脸属性分析可以分析出性别、年龄、种族、情绪，是否佩戴眼镜</li>
<li>Face++性别、种族、情绪、眼镜分析精确度均在95%以上，年龄准确度平均误差在5岁范围内<h5 id="Face-人脸1-1识别技术"><a href="#Face-人脸1-1识别技术" class="headerlink" title="Face++人脸1:1识别技术"></a>Face++人脸1:1识别技术</h5></li>
<li>Face++人脸1:1验证技术已被广泛应用于帐号登录、身份验证等服务中，被联想、神州智联等大客户使用。在千分之一的误检率情况下，通过率超过70%<h5 id="Face-人脸1-N识别技术"><a href="#Face-人脸1-N识别技术" class="headerlink" title="Face++人脸1:N识别技术"></a>Face++人脸1:N识别技术</h5></li>
<li>Face++人脸识别技术在世界最著名<code>LFW</code>评测中排名世界第一，取到97.72%的准确度，力压<code>Facebook</code><h5 id="Face-人脸大规模搜索"><a href="#Face-人脸大规模搜索" class="headerlink" title="Face++人脸大规模搜索"></a>Face++人脸大规模搜索</h5></li>
<li>Face++人脸大规模搜索技术被奇虎360、世纪佳缘等大客户使用，可以用不超过4字节表示一张人脸，千万级别图片搜索可达0.1ms响应速度</li>
</ul>
<h4 id="2-5-1-3-Face-技术使用场景介绍"><a href="#2-5-1-3-Face-技术使用场景介绍" class="headerlink" title="2.5.1.3    Face++技术使用场景介绍"></a>2.5.1.3    Face++技术使用场景介绍</h4><ul>
<li>相机和相册类应用</li>
<li>电子商务和广告营销类</li>
<li>游戏类应用</li>
<li>人脸搜索</li>
</ul>
<h5 id="相机和广告"><a href="#相机和广告" class="headerlink" title="相机和广告"></a>相机和广告</h5><ul>
<li>Face++ 已经为美图秀秀、相机360等移动应用广告厂商提供了人脸检测、人脸追踪以及人脸关键点定位技术，通过这些技术移动应用可以在相机和相册中快速得定为人脸的位置以及五官的位置，为下一步的美化做提前准备。</li>
<li>通过Face++所能提供的人脸属性分析，包括年龄、性别、种族以及微笑程度的判断，可以更好地评估电子商务、广告营销类的用户群体和这些群体所带有的属性。</li>
</ul>
<h5 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h5><ul>
<li>现有的移动设备大多都带有前置摄像头，那我们可以通过这些前置摄像头以及Face++ 所能提供的人脸检测和追踪技术，快速定位人脸以及人脸位置的变化。通过具体实际人脸的位置变化来操控游戏中的人物的位置变化。</li>
</ul>
<h5 id="人脸搜索和人脸登录"><a href="#人脸搜索和人脸登录" class="headerlink" title="人脸搜索和人脸登录"></a>人脸搜索和人脸登录</h5><ul>
<li>Face++已经为360搜索和世纪佳缘提供了此项技术，可以在千万级的会员库中快速准确地定位到具体的某个人以及与他相似的人</li>
<li>Face++已经为联想视频通话软件－－友约和神州智联提供了此项技术，可以瞬间验证使用者的身份是否属实。</li>
</ul>
<h3 id="2-5-2-Face-介绍"><a href="#2-5-2-Face-介绍" class="headerlink" title="2.5.2    Face++介绍"></a>2.5.2    Face++介绍</h3><h3 id="2-5-3-线上API分析"><a href="#2-5-3-线上API分析" class="headerlink" title="2.5.3    线上API分析"></a>2.5.3    线上API分析</h3><blockquote>
<p><strong>说明：</strong><a href="http://www.faceplusplus.com.cn/api-overview/" target="_blank" rel="external">http://www.faceplusplus.com.cn/api-overview/</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>用途</th>
<th>依赖的数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>face</td>
<td>基本属性</td>
<td></td>
<td></td>
</tr>
<tr>
<td>faceset</td>
<td>face集合</td>
<td>搜索集合中的face</td>
<td><code>faceid</code>、<code>faceset_name</code>、<code>face</code>、<code>set_id</code></td>
</tr>
<tr>
<td>person</td>
<td>人</td>
<td>验证</td>
<td><code>faceid</code>、 <code>person_name(person_id)</code></td>
</tr>
<tr>
<td>group</td>
<td>人群</td>
<td>匹配</td>
<td><code>identity</code>、 <code>url(ing)</code>、 <code>group_name(group_id)</code></td>
</tr>
</tbody>
</table>
<h3 id="2-5-4-离线API的下载和配置"><a href="#2-5-4-离线API的下载和配置" class="headerlink" title="2.5.4    离线API的下载和配置"></a>2.5.4    离线API的下载和配置</h3><blockquote>
<p><strong>说明：</strong>离线API主要用于在客户端提取图片的信息，从而与线上服务器配合完成一些处理。<br><strong>注意：</strong>在<code>Face++</code>官网创建自己的应用后才能下载到相应的离线<code>SDK</code></p>
<blockquote>
<p><strong>我的学习应用：</strong><a href="http://www.faceplusplus.com.cn/uc/app/home?app_id=42841" target="_blank" rel="external">http://www.faceplusplus.com.cn/uc/app/home?app_id=42841</a></p>
</blockquote>
</blockquote>
<h3 id="2-5-5-Face-实例编写"><a href="#2-5-5-Face-实例编写" class="headerlink" title="2.5.5    Face++实例编写"></a>2.5.5    Face++实例编写</h3><h3 id="2-5-6-Face-人脸识别总结语"><a href="#2-5-6-Face-人脸识别总结语" class="headerlink" title="2.5.6    Face++人脸识别总结语"></a>2.5.6    Face++人脸识别总结语</h3><h2 id="2-6-应用管理"><a href="#2-6-应用管理" class="headerlink" title="2.6    应用管理"></a>2.6    应用管理</h2><h3 id="2-6-1-项目讲解和模型搭建"><a href="#2-6-1-项目讲解和模型搭建" class="headerlink" title="2.6.1    项目讲解和模型搭建"></a>2.6.1    项目讲解和模型搭建</h3><ol>
<li>创建项目</li>
<li>设置<code>Storyboard</code>(设置<code>Size</code>为<code>iPhone 3.5-inch</code>，取消<code>Use Auto Layout</code>和<code>Use Size Classes</code>)</li>
<li>导入素材（图片和<code>plist</code>文件）</li>
<li>为<code>plist</code>文件创建<code>数据模型</code><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><em>JKAppInfo.h</em></li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKAppInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;<span class="comment">// 通过定义为私有属性使其可在 image 方法中被访问</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 image 的set(因为 通过 @property 创建的 image 是只读的，因此不会自动生成 get)</span></span><br><span class="line"><span class="comment">// 注意：将访问 image 自定义为访问 _image</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-Xib自定义视图"><a href="#2-6-2-Xib自定义视图" class="headerlink" title="2.6.2    Xib自定义视图"></a>2.6.2    Xib自定义视图</h3><ol>
<li>创建<code>JKAppView</code>（继承<code>UIView</code>）</li>
<li>创建<code>xib</code>文件（<code>iOS</code>-&gt;<code>User Interface</code>-&gt;<code>Empty</code>）</li>
</ol>
<ul>
<li><code>Size</code>：Freeform(然后宽和高就可以设置了)</li>
</ul>
<ol>
<li>在<code>xib</code>中创建需要的展现单个<code>app</code>信息的控件</li>
<li>在<code>xib</code>文件和<code>JKAppView</code>类之间创建关联</li>
<li>完善<code>JKAppView</code>类</li>
</ol>
<h4 id="2-6-2-1-xib视图文件"><a href="#2-6-2-1-xib视图文件" class="headerlink" title="2.6.2.1    xib视图文件"></a>2.6.2.1    xib视图文件</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-02%20%E4%B8%8A%E5%8D%8812.11.15.png" alt="Alt text"></p>
<h4 id="2-6-2-2-绑定的类-UIView"><a href="#2-6-2-2-绑定的类-UIView" class="headerlink" title="2.6.2.2    绑定的类(UIView)"></a>2.6.2.2    绑定的类(<code>UIView</code>)</h4><p><em>JKView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKAppInfo</span>;</span></span><br><span class="line"><span class="comment">//-------协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">JKAppViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">// 下载按钮被点击的响应函数</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性：一项app信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKAppInfo *appInfo;</span><br><span class="line"><span class="comment">// 属性：代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;JKAppViewDelegate&gt; delegate;<span class="comment">// 要求代理对象采纳JKAppViewDelegate协议</span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)appView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="comment">//------ 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *iconView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *nameLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppView</span></span></span><br><span class="line">- (<span class="keyword">IBAction</span>)downloadBtnOnClick:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 调用代理对象的”点击下载按钮“的响应函数</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(downloadClickWithBtn:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate downloadClickWithBtn:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂构造</span></span><br><span class="line">+ (instancetype)appView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从指定nib文件中获取目标View控件（是唯一的，所以可以用lastObject）</span></span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle]loadNibNamed:<span class="string">@"JKAppView"</span> owner:<span class="literal">nil</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为View控件初始化内部信息</span></span><br><span class="line">- (<span class="keyword">void</span>)setAppInfo:(JKAppInfo *)appInfo</span><br><span class="line">&#123;</span><br><span class="line">    _appInfo = appInfo;</span><br><span class="line">    <span class="keyword">self</span>.iconView.image = appInfo.image;</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.text = appInfo.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-3-创建自定义视图数组"><a href="#2-6-3-创建自定义视图数组" class="headerlink" title="2.6.3    创建自定义视图数组"></a>2.6.3    创建自定义视图数组</h3><blockquote>
<p><strong>说明：</strong>在<code>ViewController</code>中初始化<code>JKAppView</code>数组</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据plist初始化所有的小view（懒加载）</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)appViews</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_appViews) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"app"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKAppInfo *appInfo = [JKAppInfo appInfoWithDict:dict];</span><br><span class="line">            JKAppView *appView = [JKAppView appView];</span><br><span class="line">            appView.appInfo = appInfo;</span><br><span class="line">            appView.delegate = <span class="keyword">self</span>;</span><br><span class="line">            </span><br><span class="line">            [arrayM addObject:appView];</span><br><span class="line">        &#125;</span><br><span class="line">        _appViews = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _appViews;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-4-九宫格布局展示"><a href="#2-6-4-九宫格布局展示" class="headerlink" title="2.6.4    九宫格布局展示"></a>2.6.4    九宫格布局展示</h3><blockquote>
<p><strong>说明：</strong>九宫格布局开发</p>
<ol>
<li>宏定义界面布局的相关参数</li>
<li>确定间距</li>
<li>为确定每个下载项的位置（通过设置中心点坐标）</li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenH [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="comment">// 每个下载项的高度</span></span><br><span class="line"><span class="meta">#define kAppViewH [JKAppView appView].bounds.size.height</span></span><br><span class="line"><span class="comment">// 每个下载项的宽度</span></span><br><span class="line"><span class="meta">#define kAppViewW [JKAppView appView].bounds.size.width</span></span><br><span class="line"><span class="comment">// 分3列</span></span><br><span class="line"><span class="meta">#define kTotaoCol 3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 间距</span></span><br><span class="line">    <span class="built_in">CGFloat</span> margin = (kScreenW - kTotaoCol * kAppViewW) / (kTotaoCol + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 确定每个自定义视图在父视图中的位置并添加到父视图中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.appViews.count; i++) &#123;</span><br><span class="line">        JKAppView *appView = <span class="keyword">self</span>.appViews[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> col = i % kTotaoCol;</span><br><span class="line">        <span class="keyword">int</span> row = i / kTotaoCol;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGFloat</span> centerX = (margin + kAppViewW * <span class="number">0.5</span>) + (margin + kAppViewW) * col;</span><br><span class="line">        <span class="built_in">CGFloat</span> centerY = (margin + kAppViewH * <span class="number">0.5</span>) + (margin + kAppViewH) * row;</span><br><span class="line">        <span class="comment">// 设置中心点</span></span><br><span class="line">        appView.center = <span class="built_in">CGPointMake</span>(centerX, centerY);</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:appView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-5-点击效果分析与bug排除"><a href="#2-6-5-点击效果分析与bug排除" class="headerlink" title="2.6.5    点击效果分析与bug排除"></a>2.6.5    点击效果分析与bug排除</h3><blockquote>
<p><strong>说明：</strong>点击<code>下载</code>时弹出等待画面</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 获取要下载的应用的名字</span></span><br><span class="line">    JKAppView *appView = (JKAppView *)btn.superview;</span><br><span class="line">    <span class="built_in">NSString</span> *appName = appView.appInfo.name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建加载提示窗</span></span><br><span class="line">    <span class="built_in">UIActivityIndicatorView</span> *juhua = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleGray</span>];<span class="comment">// 样式</span></span><br><span class="line">    juhua.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 尺寸</span></span><br><span class="line">    [juhua startAnimating];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:juhua];<span class="comment">// 将提示窗添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 创建下载中文案</span></span><br><span class="line">    <span class="built_in">UILabel</span> *downloadLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">    downloadLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">10</span>, kScreenW, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    downloadLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    downloadLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    downloadLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@正在下载..."</span>, appName];</span><br><span class="line">    downloadLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">15.0</span>];</span><br><span class="line">    </span><br><span class="line">    downloadLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    downloadLabel.alpha = <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    [juhua addSubview:downloadLabel];<span class="comment">// 将文案添加到加载窗上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-延时操作与块动画"><a href="#2-6-6-延时操作与块动画" class="headerlink" title="2.6.6    延时操作与块动画"></a>2.6.6    延时操作与块动画</h3><blockquote>
<p><strong>说明：</strong>过一段时间以多线程的方式延时处理。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 4. 设置两秒钟后完成下载</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 加载窗停止转动，并且自动隐藏</span></span><br><span class="line">        [juhua stopAnimating];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 下载完成的提示</span></span><br><span class="line">        <span class="built_in">UILabel</span> *noteLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        noteLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">20</span>, kScreenW, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        noteLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        noteLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        noteLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@下载完成"</span>, appName];</span><br><span class="line">        </span><br><span class="line">        noteLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:noteLabel];</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 执行动画</span></span><br><span class="line">            noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            <span class="comment">// 动画完成后需要做的事情</span></span><br><span class="line">            btn.enabled = <span class="literal">NO</span>;</span><br><span class="line">            [btn setTitle:<span class="string">@"已下载"</span> forState: <span class="built_in">UIControlStateDisabled</span>];</span><br><span class="line">            [noteLabel removeFromSuperview];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-超级猜图"><a href="#2-7-超级猜图" class="headerlink" title="2.7    超级猜图"></a>2.7    超级猜图</h2><h3 id="2-7-1-效果展示与业务逻辑分析"><a href="#2-7-1-效果展示与业务逻辑分析" class="headerlink" title="2.7.1    效果展示与业务逻辑分析"></a>2.7.1    效果展示与业务逻辑分析</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-04%2012.15.01.png" alt="Alt text"></p>
<h3 id="2-7-2-模型搭建"><a href="#2-7-2-模型搭建" class="headerlink" title="2.7.2    模型搭建"></a>2.7.2    模型搭建</h3><blockquote>
<p><strong>说明：</strong>创建对应<code>plist</code>文件的数据模型。</p>
<ol>
<li>视图控制器基本设置</li>
<li>导入相关素材（图片和<code>plist</code>）</li>
<li>创建对应<code>plist</code>文件的数据模型</li>
</ol>
</blockquote>
<p><em>JKQuestionInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKQuestionInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">// 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *answer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *options;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)doct;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKQuestionInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKQuestionInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为_image手动定义 get</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"questions"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">        [arrayM addObject:[<span class="keyword">self</span> questionWithDict:dict]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 保证每次调用该方法获取的都是全新的数组</span></span><br><span class="line">    <span class="keyword">return</span> [arrayM <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-3-Storyboard-布局-UI"><a href="#2-7-3-Storyboard-布局-UI" class="headerlink" title="2.7.3    Storyboard 布局 UI"></a>2.7.3    Storyboard 布局 UI</h3><blockquote>
<p><strong>技巧：</strong></p>
<ul>
<li>可以在<code>Storyboard</code>中为控件设置内边距</li>
<li>有时候用<code>Button</code>替代<code>ImageView</code>会更方便</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-05%20%E4%B8%8B%E5%8D%883.20.24.png" alt="Alt text"></p>
<h3 id="2-7-4-拖线与注释"><a href="#2-7-4-拖线与注释" class="headerlink" title="2.7.4    拖线与注释"></a>2.7.4    拖线与注释</h3><blockquote>
<p><strong>技巧：</strong>多个控件可以绑定同一个<code>action</code>。方式是<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_more.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">// 顶部索引情况 label</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topindexLabel;</span><br><span class="line"><span class="comment">// 图片描述</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 金币</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *coinBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *imgInsideBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *answerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备选的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *optionsView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录索引</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：帮助</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)helpBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：大图</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-5-创建模型数组与遮罩"><a href="#2-7-5-创建模型数组与遮罩" class="headerlink" title="2.7.5    创建模型数组与遮罩"></a>2.7.5    创建模型数组与遮罩</h3><blockquote>
<p><strong>说明：</strong>遮罩用来监听点<code>击屏幕任何地方</code>的事件。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取数据模型数组（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @return 模型数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _questions) &#123;</span><br><span class="line">        _questions = [JKQuestionInfo questions];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _questions;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取遮罩（懒加载），用来监听用户的点击行为</span><br><span class="line"> *</span><br><span class="line"> *  @return 遮罩</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">UIButton</span> *)cover</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _cover) &#123;</span><br><span class="line">        _cover = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 和最外层视图一样大</span></span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;</span><br><span class="line">        _cover.alpha = <span class="number">0.0</span>;<span class="comment">// 一开始隐藏遮罩：当透明度为0时，该遮罩不会存在于任何位置</span></span><br><span class="line">        _cover.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        <span class="comment">// 为遮罩注册点击事件</span></span><br><span class="line">        [_cover addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(imgBtnChangeOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:_cover];<span class="comment">// 把遮罩添加到视图中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-6-实现图片缩放"><a href="#2-7-6-实现图片缩放" class="headerlink" title="2.7.6    实现图片缩放"></a>2.7.6    实现图片缩放</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 1. 按钮：大图(拖线) 2. 遮罩（代码调用） 3. 图片本身（拖线）</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">    <span class="comment">// 放大图片</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="keyword">self</span>.cover.alpha) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> scaleX = kScreenW / imgW;<span class="comment">// 水平方向放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> scaleY = scaleX;<span class="comment">// 垂直方向上放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> translateY = <span class="keyword">self</span>.imgInsideBtn.frame.origin.y / scaleX;<span class="comment">// 垂直方向上的偏移（倍数）</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用块动画</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 显示遮罩</span></span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scaleX, scaleY);<span class="comment">// 放大</span></span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformTranslate</span>(<span class="keyword">self</span>.imgInsideBtn.transform, <span class="number">0</span>, translateY);<span class="comment">// 在现有的基础上向上移动</span></span><br><span class="line">        &#125;];</span><br><span class="line">        <span class="comment">// 将中间图片所在图层置顶</span></span><br><span class="line">        [<span class="keyword">self</span>.view bringSubviewToFront:<span class="keyword">self</span>.imgInsideBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 还原图片</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 图片还原事件</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.0</span>;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-7-下一题方法实现"><a href="#2-7-7-下一题方法实现" class="headerlink" title="2.7.7    下一题方法实现"></a>2.7.7    下一题方法实现</h3><blockquote>
<p><strong>说明：</strong>用户点击下一题按钮时界面做出相应的改变</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 索引自增（判断是否越界）</span></span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"INDEX == %D"</span>, <span class="keyword">self</span>.index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.index &gt;= <span class="keyword">self</span>.questions.count) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"恭喜过关！"</span>);</span><br><span class="line">        <span class="meta">#warning noCode</span></span><br><span class="line">        <span class="keyword">self</span>.index--;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出数据模型</span></span><br><span class="line">    JKQuestionInfo *question = <span class="keyword">self</span>.questions[<span class="keyword">self</span>.index];</span><br><span class="line">    <span class="comment">// 3. 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setupBaseInfo:question];</span><br><span class="line">    <span class="comment">// 4. 创建答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createAnswerBtns:question];</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - 私有方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置基本信息</span><br><span class="line"> *</span><br><span class="line"> *  @param question 问题的数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupBaseInfo: (JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 恢复（enable）optionView 的用户交互</span></span><br><span class="line">    <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// 改变顶部图片索引信息</span></span><br><span class="line">    <span class="keyword">self</span>.topindexLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, <span class="keyword">self</span>.index + <span class="number">1</span>, <span class="keyword">self</span>.questions.count];</span><br><span class="line">    <span class="comment">// 改变图片描述</span></span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = question.title;</span><br><span class="line">    <span class="comment">// 更换图片</span></span><br><span class="line">    [<span class="keyword">self</span>.imgInsideBtn setImage:question.image forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下一题按钮状态判断改变</span></span><br><span class="line">    <span class="keyword">self</span>.nextBtn.enabled = (<span class="keyword">self</span>.index != <span class="keyword">self</span>.questions.count - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-8-创建答案按钮"><a href="#2-7-8-创建答案按钮" class="headerlink" title="2.7.8    创建答案按钮"></a>2.7.8    创建答案按钮</h3><blockquote>
<p><strong>说明：</strong>设置基本信息时创建放置答案的一排按钮集合。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要计算的常量</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"><span class="meta">#define kAnswerBtnTitleColor [UIColor blackColor]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要计算的常量</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnW = <span class="number">35</span>;<span class="comment">// 按钮宽</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnH = <span class="number">35</span>;<span class="comment">// 按钮高</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kMarginBetweenBtns = <span class="number">10</span>;<span class="comment">// 按钮间距</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kOptionViewTotalCol = <span class="number">7</span>;<span class="comment">// 备选答案总列数</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTrueAddScore = <span class="number">200</span>;<span class="comment">// 猜对加分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kFalseDecreaseScore = <span class="number">-200</span>;<span class="comment">// 猜错减分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTipDecreaseScore = <span class="number">-200</span>;<span class="comment">// 亲求提示减分</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建放置答案的按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createAnswerBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 清空放置答案的按钮</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [btn removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 获取答案按钮的数量</span></span><br><span class="line">    <span class="built_in">NSInteger</span> answerBtnCount = question.answer.length;</span><br><span class="line">    <span class="comment">// 3. 创建放置答案的按钮</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerW = <span class="keyword">self</span>.answerView.bounds.size.width;<span class="comment">// 放答案的父容器宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerEdgeInset = (answerW - answerBtnCount * kBtnW - (answerBtnCount - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 放答案的父容器两侧内边距</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; answerBtnCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        <span class="built_in">CGFloat</span> btnX = answerEdgeInset + i * i * (kBtnW + kMarginBetweenBtns);<span class="comment">// 起点水平坐标</span></span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnX, <span class="number">0</span>, kBtnW, kBtnH);<span class="comment">// 设置frame</span></span><br><span class="line">        <span class="comment">// 设置背景图片</span></span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        <span class="comment">// 设置字体颜色</span></span><br><span class="line">        [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册点击事件</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick:) forControlEvents:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 添加到视图中</span></span><br><span class="line">        [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-9-创建备选答案按钮"><a href="#2-7-9-创建备选答案按钮" class="headerlink" title="2.7.9    创建备选答案按钮"></a>2.7.9    创建备选答案按钮</h3><blockquote>
<p><strong>说明：</strong>当<code>点击下一题</code>或<code>程序刚启动</code>时，需要设置备选答案按钮。<br><strong>技巧：</strong>以懒加载的方式创建备选按钮，这样就不用每次都重新创建备选按钮。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">self</span>.index = <span class="number">-1</span>;</span><br><span class="line">    [<span class="keyword">self</span> nextBtnOnClick];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置备选字按钮（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createOptionBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 备选字总个数</span></span><br><span class="line">    <span class="keyword">int</span> optionsCount = question.options.count;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 没有备选字按钮就创建</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.optionsView.subviews.count != optionsCount) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> optionW = <span class="keyword">self</span>.optionsView.bounds.size.width;<span class="comment">// 备选字按钮父控件宽度</span></span><br><span class="line">        <span class="built_in">CGFloat</span> optionEdgeInset = (optionW - kOptionViewTotalCol * kBtnW - (kOptionViewTotalCol - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 父控件左右内边距</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">            <span class="keyword">int</span> col = i % kOptionViewTotalCol;<span class="comment">// 所在列</span></span><br><span class="line">            <span class="keyword">int</span> row = i / kOptionViewTotalCol;<span class="comment">// 所在行</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CGFloat</span> btnX = optionEdgeInset + (kBtnW + kMarginBetweenBtns) * col;<span class="comment">// 水平坐标</span></span><br><span class="line">            <span class="built_in">CGFloat</span> btnY = kMarginBetweenBtns + (kBtnH + kMarginBetweenBtns) * row;<span class="comment">// 垂直坐标</span></span><br><span class="line">            <span class="comment">// 设置frame</span></span><br><span class="line">            btn.frame = <span class="built_in">CGRectMake</span>(btnX, btnY, kBtnW, kBtnH);</span><br><span class="line">            <span class="comment">// 设置背景图</span></span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">            <span class="comment">// 设置字颜色</span></span><br><span class="line">            [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            <span class="comment">// 注册点击事件</span></span><br><span class="line">            [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">            <span class="comment">// 添加到视图</span></span><br><span class="line">            [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新备选字</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *optionBtn = <span class="keyword">self</span>.optionsView.subviews[i];</span><br><span class="line">            [optionBtn setTitle:question.options[i] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-10-答案按钮点击"><a href="#2-7-10-答案按钮点击" class="headerlink" title="2.7.10    答案按钮点击"></a>2.7.10    答案按钮点击</h3><blockquote>
<p><strong>说明：</strong> 点击组成答案的按钮，该按钮清除其文字，而相应的备选答案按钮会重新出现该文字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-11-备选按钮点击"><a href="#2-7-11-备选按钮点击" class="headerlink" title="2.7.11    备选按钮点击"></a>2.7.11    备选按钮点击</h3><blockquote>
<p><strong>说明：</strong>被点击的备选按钮会清除其文字，并将该文字写到答案按钮中。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-12-提示点击方法的实现"><a href="#2-7-12-提示点击方法的实现" class="headerlink" title="2.7.12    提示点击方法的实现"></a>2.7.12    提示点击方法的实现</h3><blockquote>
<p><strong>说明：</strong>提示按钮每被点击一次，答案按钮就回为答案生成一个字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 清空答案按钮的文字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [<span class="keyword">self</span> answerBtnOnClick:answerBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出实际答案中的第一个字</span></span><br><span class="line">    <span class="built_in">NSString</span> *answer = [<span class="keyword">self</span>.questions[<span class="keyword">self</span>.index] answer];</span><br><span class="line">    <span class="built_in">NSString</span> *firstWord = [answer substringToIndex:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 3. 模拟点击optionView中第一个正确的按钮，扣分</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([optionBtn.currentTitle isEqualToString:firstWord]) &#123;</span><br><span class="line">            [<span class="keyword">self</span> optionBtnOnClick:optionBtn];</span><br><span class="line">            [<span class="keyword">self</span> coinChange:kTipDecreaseScore];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-国家选择"><a href="#2-8-国家选择" class="headerlink" title="2.8    国家选择"></a>2.8    国家选择</h2><h3 id="2-8-1-UIPickerView与数据模型的创建"><a href="#2-8-1-UIPickerView与数据模型的创建" class="headerlink" title="2.8.1    UIPickerView与数据模型的创建"></a>2.8.1    <code>UIPickerView</code>与<code>数据模型</code>的创建</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>导入素材（<code>jpg</code>格式的图片不能放在<code>Assets.xcassets</code>中管理）</li>
<li>创建自定义<code>UIView</code>类:<code>JKCountryInfo</code></li>
<li><code>ViewController</code>采纳<code>UIPickerView</code></li>
</ol>
<p><strong>注意：</strong><code>gif</code>格式的图片不能放在<code>Assets.xcassets</code>。</p>
</blockquote>
<h4 id="2-8-1-1-UIPickerView"><a href="#2-8-1-1-UIPickerView" class="headerlink" title="2.8.1.1    UIPickerView"></a>2.8.1.1    <code>UIPickerView</code></h4><blockquote>
<p><strong>说明：</strong>类似<code>TableView</code>，可以通过让普通<code>ViewControll</code>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code>实现</p>
<ol>
<li>通过拖动建立<code>PickerView</code>控件和<code>ViewController</code>类之间的关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.29.09.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-1-2-数据模型的创建"><a href="#2-8-1-2-数据模型的创建" class="headerlink" title="2.8.1.2     数据模型的创建"></a>2.8.1.2     数据模型的创建</h4><p><em>JKContryInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;<span class="comment">// 国家名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *icon;<span class="comment">// 国旗（图片名）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 工厂方法</span></span><br><span class="line">+ (instancetype) CountryWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContryInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryInfo</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)CountryWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-2-自定义视图完善实例"><a href="#2-8-2-自定义视图完善实例" class="headerlink" title="2.8.2    自定义视图完善实例"></a>2.8.2    自定义视图完善实例</h3><blockquote>
<p><strong>说明：</strong>自定义<code>PickerView</code>中的每一行采用的视图。</p>
</blockquote>
<h4 id="2-8-2-1-创建xib文件"><a href="#2-8-2-1-创建xib文件" class="headerlink" title="2.8.2.1    创建xib文件"></a>2.8.2.1    创建<code>xib</code>文件</h4><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>创建的<code>xib</code>文件和要绑定的<code>UIVIew</code>的文件名要一致。</li>
</ol>
<p><strong>注意：</strong>待对应的<code>UIView</code>子类创建完毕后，手动绑定之。</p>
</blockquote>
<p><em>JKCountryFlagView.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.24.35.png" alt="Alt text"></p>
<h4 id="2-8-2-2-创建JKCountryFlagView类"><a href="#2-8-2-2-创建JKCountryFlagView类" class="headerlink" title="2.8.2.2    创建JKCountryFlagView类"></a>2.8.2.2    创建<code>JKCountryFlagView</code>类</h4><blockquote>
<p><strong>说明：</strong>该类用来绑定上面创建的<code>xib</code>文件。</p>
</blockquote>
<p><em>JKCountryFlagView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKCountryInfo</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryFlagView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IBOutlet 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKCountryInfo *countryModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器(工厂方法)</span></span><br><span class="line">+ (instancetype)countryView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKCountryFlagView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryFlagView</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)countryView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="string">@"JKCountryFlagView"</span> owner:<span class="keyword">self</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setCountryModel:(JKCountryInfo *)countryModel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_countryModel != countryModel) &#123;</span><br><span class="line">        _countryModel = countryModel;</span><br><span class="line">        <span class="keyword">self</span>.name.text = _countryModel.name;</span><br><span class="line">        <span class="keyword">self</span>.flag.image = [<span class="built_in">UIImage</span> imageNamed:_countryModel.icon];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">54</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-2-3-完善ViewController"><a href="#2-8-2-3-完善ViewController" class="headerlink" title="2.8.2.3    完善ViewController"></a>2.8.2.3    完善<code>ViewController</code></h4><blockquote>
<p><strong>说明：</strong>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"path:%@"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"array:%@"</span>, _dataArray);</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDelegate</span></span><br><span class="line"><span class="comment">// 定义详情视图的创建过程</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView viewForRow:(<span class="built_in">NSInteger</span>)row forComponent:(<span class="built_in">NSInteger</span>)component reusingView:(<span class="built_in">UIView</span> *)view</span><br><span class="line">&#123;</span><br><span class="line">    JKCountryFlagView *countryView = (JKCountryFlagView *)view;</span><br><span class="line">    <span class="keyword">if</span> (!countryView) &#123;</span><br><span class="line">        countryView = [JKCountryFlagView countryView];</span><br><span class="line">    &#125;</span><br><span class="line">    countryView.countryModel = <span class="keyword">self</span>.dataArray[row];</span><br><span class="line">    <span class="keyword">return</span> countryView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义行高</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView rowHeightForComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [JKCountryFlagView rowHeight];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-图片自动播放"><a href="#2-9-图片自动播放" class="headerlink" title="2.9    图片自动播放"></a>2.9    图片自动播放</h2><h3 id="2-9-1-创建UIScrollView和UIPageControl"><a href="#2-9-1-创建UIScrollView和UIPageControl" class="headerlink" title="2.9.1    创建UIScrollView和UIPageControl"></a>2.9.1    创建<code>UIScrollView</code>和<code>UIPageControl</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><code>ViewController</code>采纳<code>UIScrollViewDelegate</code></li>
<li>创建<code>UIScrollView</code></li>
<li>创建<code>UIScrollPageControl</code></li>
</ol>
</blockquote>
<h3 id="2-9-2-定时器与代理方法调用"><a href="#2-9-2-定时器与代理方法调用" class="headerlink" title="2.9.2    定时器与代理方法调用"></a>2.9.2    定时器与代理方法调用</h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><strong>封装一些相关的方法：</strong>清除<code>timer</code>、添加<code>timer</code>等</li>
<li><strong>遵守协议<code>UIScrollViewDelegate</code>：</strong>定义滑动前、中、后需要的操作</li>
</ol>
</blockquote>
<h3 id="2-9-3-代码摘要"><a href="#2-9-3-代码摘要" class="headerlink" title="2.9.3    代码摘要"></a>2.9.3    代码摘要</h3><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width// 屏幕高度</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> kImgCount = <span class="number">10</span>;<span class="comment">// 图片总数</span></span><br><span class="line"><span class="built_in">CGFloat</span> scrollY = <span class="number">20</span>;<span class="comment">// 上边距</span></span><br><span class="line"><span class="built_in">CGFloat</span> pageCtrlWidth = <span class="number">200</span>;<span class="comment">// 滚动指示器宽度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//--------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIPageControl</span> *pageCtrl;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initScrollView];</span><br><span class="line">    [<span class="keyword">self</span> initPageControl];</span><br><span class="line">    [<span class="keyword">self</span> addTimer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIScrollView</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initScrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">    <span class="comment">// 设置代理对象</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 初始化所有滚动的屏的内容</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kImgCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span> *imgview = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(kScreenWidth * i, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">        imgview.image = [<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"huoying%d"</span>, i + <span class="number">1</span>]];</span><br><span class="line">        [<span class="keyword">self</span>.scrollView addSubview:imgview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(kScreenWidth * kImgCount, kScreenHeight - scrollY);</span><br><span class="line">    <span class="keyword">self</span>.scrollView.pagingEnabled = <span class="literal">YES</span>;<span class="comment">// 使滚动操作停止在恰当的位置</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIPageControl</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPageControl</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl = [[<span class="built_in">UIPageControl</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>((kScreenWidth - pageCtrlWidth) / <span class="number">2</span>, kScreenHeight - scrollY, pageCtrlWidth, scrollY)];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.numberOfPages = kImgCount;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.pageIndicatorTintColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPageIndicatorTintColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span>.view insertSubview:<span class="keyword">self</span>.pageCtrl aboveSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  自动滚动到下一屏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)nextPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = <span class="keyword">self</span>.pageCtrl.currentPage;</span><br><span class="line">    page++;</span><br><span class="line">    <span class="keyword">if</span> (page == kImgCount) &#123;</span><br><span class="line">        page = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGPoint</span> point = <span class="built_in">CGPointMake</span>(kScreenWidth * page, <span class="number">0</span>);</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:point animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addTimer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 timer (interval)</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(nextPage) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  清除延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeTimer</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma  mark -UIScrollViewDelegae</span></span><br><span class="line"><span class="comment">// 滑动前：清除计时器</span></span><br><span class="line">- (<span class="keyword">void</span>) scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> removeTimer];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"BeginDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动中：更改指示器</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = scrollView.contentOffset.x / kScreenWidth + <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPage = page;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动后：开始下一次互动倒计时</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 2秒钟后重新开始自动滚屏</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> addTimer];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"EndDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-QQ列表展示"><a href="#2-10-QQ列表展示" class="headerlink" title="2.10    QQ列表展示"></a>2.10    QQ列表展示</h2><blockquote>
<p><strong>说明：</strong>该项目使用<code>MVC</code>模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_qq.gif" alt="Alt text|200x400"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-16%20%E4%B8%8A%E5%8D%889.34.22.png" alt="Alt text|400x300"></p>
<p><strong>注意：</strong><code>Xcode</code>工程中的文件夹有两种：<code>黄色</code>的为辅助进行代码管理的“伪文件夹”，<code>蓝色</code>的为真正的文件夹。</p>
</blockquote>
<h3 id="2-10-1-模型搭建"><a href="#2-10-1-模型搭建" class="headerlink" title="2.10.1    模型搭建"></a>2.10.1    模型搭建</h3><blockquote>
<p><strong>说明：</strong>需要两个数据模型，<code>JKGroupModel</code>（好友所在分组）和<code>JKFriendsModel</code>（好友）</p>
<ol>
<li>导入<code>plist</code></li>
<li>创建数据模型</li>
</ol>
</blockquote>
<h4 id="2-10-1-1-JKGroupModel"><a href="#2-10-1-1-JKGroupModel" class="headerlink" title="2.10.1.1    JKGroupModel"></a>2.10.1.1    <code>JKGroupModel</code></h4><blockquote>
<p><strong>说明：</strong>好友分组的数据模型</p>
</blockquote>
<p><em>JKGroupModel</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKGroupModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKGroupModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> <span class="keyword">self</span>.friends) &#123;</span><br><span class="line">            JKFriendsModel *model = [JKFriendsModel friendWithDict:dict];</span><br><span class="line">            [muArray addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.friends = muArray;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)GroupWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-1-2-JKFriendsModel"><a href="#2-10-1-2-JKFriendsModel" class="headerlink" title="2.10.1.2    JKFriendsModel"></a>2.10.1.2    <code>JKFriendsModel</code></h4><blockquote>
<p><strong>说明：</strong>好友的数据模型。</p>
</blockquote>
<p><em>JKFriendsModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKFriendsModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKFriendsModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-创建UITableView"><a href="#2-10-2-创建UITableView" class="headerlink" title="2.10.2    创建UITableView"></a>2.10.2    创建<code>UITableView</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li>在<code>AppDelegate</code>中创建二级导航（通过<code>UINavigationController</code>）</li>
<li>在<code>ListTableViewController</code>完善<code>TableView</code></li>
</ol>
</blockquote>
<p><em>Model/AppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    <span class="comment">// 创建 window</span></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建 TableViewController</span></span><br><span class="line">    ListTableViewController *listVC = [[ListTableViewController alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 UINavigationController(需要指定导航控制器控制的是那个控制器)</span></span><br><span class="line">    <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc] initWithRootViewController:listVC];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将导航控制器设置为 window 的 rootViewController（这就是所谓的二级视图）</span></span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = navCtrl;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];<span class="comment">// 将该window置顶并显示出来</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-自定义头视图"><a href="#2-10-3-自定义头视图" class="headerlink" title="2.10.3    自定义头视图"></a>2.10.3    自定义头视图</h3><blockquote>
<p><strong>说明：</strong><code>MVC</code>的<code>View</code>部分</p>
<ul>
<li>不创建<code>xib</code>文件</li>
<li>完全通过代码创建视图</li>
<li>继承<code>UITableViewHeaderFooterView</code></li>
</ul>
<p><strong>注意：</strong>如果头视图被自定义了，则需要在<code>viewDidLoad</code>中重新设置其高度。</p>
</blockquote>
<h4 id="2-10-3-1-View部分"><a href="#2-10-3-1-View部分" class="headerlink" title="2.10.3.1    View部分"></a>2.10.3.1    <code>View</code>部分</h4><p><em>View/HeaderView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 协议（为代理对象定义协议）</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">HeaderViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeaderView</span> : <span class="title">UITableViewHeaderFooterView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;HeaderViewDelegate&gt;delegate;<span class="comment">// 代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKGroupModel *groupModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>View/HeadView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *_arrowBtn;<span class="comment">// 三角按钮（展开和关闭）</span></span><br><span class="line">    <span class="built_in">UILabel</span> *_label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"header"</span>;</span><br><span class="line">    <span class="comment">// 尝试获取该 UITableViewHeaderFooterView</span></span><br><span class="line">    HeaderView *header = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!header) &#123;</span><br><span class="line">        header = [[HeaderView alloc] initWithReuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        <span class="comment">// 初始化_arrowBtn(带三角的按钮)</span></span><br><span class="line">        <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg"</span>] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 北京图片</span></span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        [button setImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"arrow"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [button setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 标题</span></span><br><span class="line">        button.contentEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 整体内边距</span></span><br><span class="line">        button.contentHorizontalAlignment = <span class="built_in">UIControlContentHorizontalAlignmentLeft</span>;<span class="comment">// 左对齐</span></span><br><span class="line">        button.titleEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 文字部分的内边距</span></span><br><span class="line">        button.imageView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        button.imageView.clipsToBounds = <span class="literal">NO</span>;</span><br><span class="line">        _arrowBtn = button;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_arrowBtn];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化_label</span></span><br><span class="line">        <span class="built_in">UILabel</span> *labelRight = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        labelRight.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        _label = labelRight;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_label];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写布局方法:为_arrowBtn和_label设置布局</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    _arrowBtn.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.frame.size.width - <span class="number">70</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setGroupModel:(JKGroupModel *)groupModel</span><br><span class="line">&#123;</span><br><span class="line">    _groupModel = groupModel;</span><br><span class="line">    [_arrowBtn setTitle:_groupModel.name forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    _label.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/%lu"</span>, _groupModel.online, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)_groupModel.friends.count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - buttonAction</span></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-3-2-Controller部分"><a href="#2-10-3-2-Controller部分" class="headerlink" title="2.10.3.2    Controller部分"></a>2.10.3.2    <code>Controller</code>部分</h4><blockquote>
<p><strong>说明：</strong>整个qq列表实际上是一个<code>UITableView</code></p>
</blockquote>
<p><em>Controller/ListTableViewController</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()&lt;<span class="title">HeaderViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 自定义的透视图需要重新定义高度</span></span><br><span class="line">    <span class="keyword">self</span>.tableView.sectionHeaderHeight = <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:friendModel.icon];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableView delagate</span></span><br><span class="line"><span class="comment">// 添加自定义的头视图：初始化TableView中每个section中的header部分</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    HeaderView *header = [HeaderView headerView:tableView];</span><br><span class="line">    header.delegate = <span class="keyword">self</span>;<span class="comment">// 将自身作为代理对象</span></span><br><span class="line">    header.groupModel = <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-4-点击效果的实现"><a href="#2-10-4-点击效果的实现" class="headerlink" title="2.10.4    点击效果的实现"></a>2.10.4    点击效果的实现</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>点击群组栏（<code>HeaderView</code>，继承自<code>UITableViewHeaderFooterView</code>）中的按钮</li>
</ol>
<ul>
<li>展开群组</li>
<li>三角按钮变化</li>
</ul>
<ol>
<li>点击好友（<code>cell</code>），push到一个空界面</li>
</ol>
</blockquote>
<p><em>View/HeaderView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        ...</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父视图发生变化时被调用（不知为什么并没有被调用）</span></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToSuperview</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 三角符号旋转180度</span></span><br><span class="line">    _arrowBtn.imageView.transform = <span class="keyword">self</span>.groupModel.isOpen ? <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_2) : <span class="built_in">CGAffineTransformMakeRotation</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Controller/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">self</span> clipExtraCellLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cell被点击（选中进入）时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过导航控制器进入一个新的 ViewController</span></span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - HeadViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的cell的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clipExtraCellLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-三级控制器"><a href="#2-11-三级控制器" class="headerlink" title="2.11    三级控制器"></a>2.11    三级控制器</h2><blockquote>
<p><strong>说明：</strong>项目截图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.09.10.png" alt="Alt text|200x350"></p>
<p><strong>API：</strong><code>三级控制器</code>的实现使用到的<code>UIKit</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UITabViewController</code>相关成员</th>
<th>原型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>viewControllers</td>
<td><code>@property(nonatomic, copy) NSArray&lt;__kindof UIViewController *&gt; *viewControllers</code></td>
<td>存储着tab视图管理的所有二级控制器实例</td>
</tr>
<tr>
<td>selectedIndex</td>
<td><code>@property(nonatomic) NSUInteger selectedIndex</code></td>
<td>当前被选中的tab item的下标，修改该值会导致视图的切换</td>
</tr>
</tbody>
</table>
<h3 id="2-11-1-初始化视图控制器"><a href="#2-11-1-初始化视图控制器" class="headerlink" title="2.11.1    初始化视图控制器"></a>2.11.1    初始化视图控制器</h3><blockquote>
<p><strong>说明：</strong>本课时讲解<code>三级控制器</code>的结构，自定义视图控制器并初始化学习用新语法创建数组并赋值。用<code>导航控制器</code>构建<code>二级控制器</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.06.44.png" alt="Alt text|450x250"></p>
</blockquote>
<p><em>AppDelegate.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用新的<code>window</code>替换掉项目创建时默认的<code>window</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">    RootViewController *rootVC = [[RootViewController alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = rootVC;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"><span class="comment">// 初始化所有第二级控制器</span></span><br><span class="line">- (<span class="keyword">void</span>)initViewController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化视图控制器</span></span><br><span class="line">    ProfileViewController *profileVC = [[ProfileViewController alloc]init];</span><br><span class="line">    MessageViewController *messageVC = [[MessageViewController alloc]init];</span><br><span class="line">    ColaViewController *colaVC = [[ColaViewController alloc]init];</span><br><span class="line">    UserViewController *userVC = [[UserViewController alloc]init];</span><br><span class="line">    MoreViewController *moreVC = [[MoreViewController alloc]init];</span><br><span class="line">    <span class="comment">// 封装到数组中</span></span><br><span class="line">    <span class="built_in">NSArray</span> *vcArr = @[profileVC, messageVC, colaVC, userVC, moreVC];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *tabArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:vcArr.count];</span><br><span class="line">    <span class="comment">// 为每个视图控制器创建对应的导航控制器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vcArr.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc]initWithRootViewController:vcArr[i]];<span class="comment">// 创建导航视图器时为其绑定对应的视图控制器</span></span><br><span class="line">        [tabArray addObject:navCtrl];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将初始化好的存储导航控制器的数组作为一个属性赋值给第一级控制器</span></span><br><span class="line">    <span class="keyword">self</span>.viewControllers = tabArray;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-自定义标签工具栏"><a href="#2-11-2-自定义标签工具栏" class="headerlink" title="2.11.2    自定义标签工具栏"></a>2.11.2    自定义标签工具栏</h3><blockquote>
<p><strong>说明：</strong>本课时讲解隐藏系统自带<code>标签工具栏</code>样式，并自定义按钮和视图，根据系统的<code>标签工具栏</code>的属性实现切换。</p>
</blockquote>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> btnHeight = <span class="number">45</span>;<span class="comment">// 标签工具栏中按钮的高度</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 初始化标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)initTabBarView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图</span></span><br><span class="line">    _tabBarView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenHeight - tabViewHeight, kScreenWidth, tabViewHeight)];</span><br><span class="line">    _tabBarView.backgroundColor = [<span class="built_in">UIColor</span> colorWithPatternImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask_navbar"</span>]];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tabBarView];</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图 中的按钮</span></span><br><span class="line">    <span class="built_in">NSArray</span> *imgArray = @[<span class="string">@"home_tab_icon_1"</span>, <span class="string">@"home_tab_icon_2"</span>, <span class="string">@"home_tab_icon_3"</span>, <span class="string">@"home_tab_icon_4"</span>, <span class="string">@"home_tab_icon_5"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i; i &lt; imgArray.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:imgArray[i]] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnWidth * i, (tabViewHeight - btnHeight) / <span class="number">2</span>, btnWidth, btnHeight);</span><br><span class="line">        btn.tag = <span class="number">100</span> + i;<span class="comment">// 用来识别点击哪些按钮进行的tab切换（100以内的tag有特殊用途）</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btnAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.tabBarView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化当前被选中的tab按钮上展现的视图（倒三角）</span></span><br><span class="line">    _selectView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, btnWidth, btnHeight)];</span><br><span class="line">    _selectView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"home_bottom_tab_arrow"</span>];</span><br><span class="line">    [_tabBarView addSubview:_selectView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - tab按钮被点击时的处理函数</span></span><br><span class="line">- (<span class="keyword">void</span>)btnAction:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 切换视图（根据tag值获取当前索引）</span></span><br><span class="line">    <span class="keyword">self</span>.selectedIndex = button.tag - <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// 将倒三角移动到被选中的tab按钮上，移动动画持续时间为0.2秒</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        _selectView.center = button.center;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">self</span>.tabBar.hidden = <span class="literal">YES</span>;<span class="comment">// 隐藏 UITabViewController 自带的tab bar</span></span><br><span class="line">    [<span class="keyword">self</span> initTabBarView];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-页面跳转的两种方式"><a href="#2-11-3-页面跳转的两种方式" class="headerlink" title="2.11.3    页面跳转的两种方式"></a>2.11.3    页面跳转的两种方式</h3><blockquote>
<p><strong>说明：</strong>本课时讲解页面两种跳转方式。通过<code>导航控制器</code>实现 <code>push</code> 和通过<code>视图控制器</code>实现模态视图。并讲解 <code>iOS8</code> 中新的方法。</p>
<ul>
<li>从<code>三级控制器</code> <code>push</code>出其它页面需要隐藏<code>标签工具栏</code>，<code>pop</code>回来后需要展现<code>标签工具栏</code></li>
</ul>
</blockquote>
<h4 id="2-11-3-1-RootViewController"><a href="#2-11-3-1-RootViewController" class="headerlink" title="2.11.3.1    RootViewController"></a>2.11.3.1    RootViewController</h4><blockquote>
<p><strong>说明：</strong>在<code>标签控制器</code>中定义<code>标签工具栏</code>的显示／隐藏方法</p>
</blockquote>
<p><em>RootViewController.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> : <span class="title">UITabBarController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *tabBarView;<span class="comment">// 标签工具栏</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示或隐藏标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *selectView;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示／隐藏tab工具栏</span><br><span class="line"> *</span><br><span class="line"> *  @param show YES: 显示, NO: 隐藏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.tabBarView.frame;</span><br><span class="line">    <span class="comment">// 更新frame</span></span><br><span class="line">    <span class="keyword">if</span> (show) &#123;</span><br><span class="line">        frame.origin.x = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        frame.origin.x = -kScreenWidth;<span class="comment">// 隐藏tab bar：将tab bar移除屏幕</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重新赋值tabBarView的frame</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.tabBarView.frame = frame;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-2-ProfileViewController"><a href="#2-11-3-2-ProfileViewController" class="headerlink" title="2.11.3.2    ProfileViewController"></a>2.11.3.2    ProfileViewController</h4><blockquote>
<p><strong>说明：</strong><code>首页</code>中通过两种方式跳转。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonWidth = <span class="number">33</span>;<span class="comment">// 导航栏按钮宽度</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonHeight = <span class="number">32</span>;<span class="comment">// 导航栏按钮高度</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProfileViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ProfileViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.title = <span class="string">@"首页"</span>;</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span> initNavButton];</span><br><span class="line">    [<span class="keyword">self</span> initPushButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义导航栏按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)initNavButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIButton</span></span><br><span class="line">    <span class="built_in">UIButton</span> *writeBtn =  [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">    writeBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, writeButtonWidth, writeButtonHeight);</span><br><span class="line">    [writeBtn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"write"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [writeBtn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(presentAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 封装为 UIBarButtonItem</span></span><br><span class="line">    <span class="built_in">UIBarButtonItem</span> *item = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithCustomView:writeBtn];</span><br><span class="line">    <span class="comment">// 添加到导航栏</span></span><br><span class="line">    <span class="keyword">self</span>.navigationItem.rightBarButtonItem = item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化 push 页面的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPushButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *pushButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    pushButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [pushButton setTitle:<span class="string">@"Push"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [pushButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pushAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:pushButton];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用push的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pushAction</span><br><span class="line">&#123;</span><br><span class="line">    PushViewController *pushVC = [[PushViewController alloc] init];</span><br><span class="line">    <span class="comment">// 通过和当前的视图控制器绑定的导航控制器完成页面的 push</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:pushVC animated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 隐藏首页的tab bar</span></span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用模态的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)presentAction</span><br><span class="line">&#123;</span><br><span class="line">    ModalViewController *modalVC = [[ModalViewController alloc] init];</span><br><span class="line">    <span class="comment">// 使用模态视图</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:modalVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// 展现首页前显示tab bar</span></span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-3-PushViewController"><a href="#2-11-3-3-PushViewController" class="headerlink" title="2.11.3.3    PushViewController"></a>2.11.3.3    PushViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>push</code>跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PushViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PushViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建回退（pop）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *popButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    popButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="comment">// 设置文本（使用了setTitle就不能setImage了）</span></span><br><span class="line">    [popButton setTitle:<span class="string">@"Pop"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [popButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(popAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:popButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  回退(pop)到堆栈中的上一个视图(首页)</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)popAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-4-ModalViewController"><a href="#2-11-3-4-ModalViewController" class="headerlink" title="2.11.3.4    ModalViewController"></a>2.11.3.4    ModalViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>dismiss</code>方式跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ModalViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ModalViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="comment">// 创建回退（dismisss）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *dismissButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    dismissButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [dismissButton setTitle:<span class="string">@"Dismiss"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册点击事件</span></span><br><span class="line">    [dismissButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(dismissAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:dismissButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回退页面</span></span><br><span class="line">- (<span class="keyword">void</span>)dismissAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-12-通讯录"><a href="#2-12-通讯录" class="headerlink" title="2.12    通讯录"></a>2.12    通讯录</h2><blockquote>
<p><strong>说明：</strong>本课实现模拟通讯录的登陆、添加、删除、修改的功能，涉及到第三方类库的使用，数据存储并加深理解代理和 <code>UITableView</code>。</p>
<ol>
<li><code>Storyboard</code>中设置页面跳转</li>
<li>第三方类库<code>MBProgressHUD</code></li>
<li>数据存储</li>
<li><code>UITableView</code>的深入理解</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_contact.gif" alt="Alt text|200x350"></p>
</blockquote>
<h3 id="2-12-1-Storyboard实现布局和跳转"><a href="#2-12-1-Storyboard实现布局和跳转" class="headerlink" title="2.12.1    Storyboard实现布局和跳转"></a>2.12.1    <code>Storyboard</code>实现布局和跳转</h3><blockquote>
<p><strong>说明：</strong>本课时讲解创建自定义视图控制器并通过 <code>storyboard</code> 来布局页面，学习手动跳转的方法。</p>
</blockquote>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><hr>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>becomeFirstResponder</code></td>
<td>实例方法</td>
<td>使文本输入框自动获取焦点，呼出键盘，类似<code>html</code>中的<code>autofocus</code></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>``</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="2-12-1-1-布局"><a href="#2-12-1-1-布局" class="headerlink" title="2.12.1.1    布局"></a>2.12.1.1    布局</h4><p><strong>1. 建立<code>Navigaton Controller</code>和<code>LoginViewController</code>之间的关联</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%8810.17.31.png" alt="Alt text"><br><strong>2. <code>LoginViewController</code>跳转到<code>ContactTableViewController</code></strong></p>
<blockquote>
<p>采用<code>iOS8</code>后的新的<code>show</code>替代<code>push</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_show.gif" alt="Alt text"><br><strong>3. 自定义<code>ContactTableViewController</code>的导航栏</strong></p>
<ul>
<li>自定义导航栏需要添加<code>Navigation Item</code>控件</li>
<li><code>Navigation Item</code>内的按钮要使用<code>Button Item</code>控件</li>
<li>按钮中使用系统图标(<code>System Icon</code>)<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8A%E5%8D%8812.23.35.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="2-12-1-2-跳转"><a href="#2-12-1-2-跳转" class="headerlink" title="2.12.1.2    跳转"></a>2.12.1.2    跳转</h4><blockquote>
<ul>
<li>使用<code>NSNotificationCenter</code>监控文本的变化</li>
<li>使用在<code>Storyboard</code>中为视图之间建立的<code>连接</code>的<code>identifier</code>访问<code>连接</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LoginViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LoginViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *pwdField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UISwitch</span> *rembField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *loginBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.pwdField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// In a storyboard-based application, you will often want to do a little preparation before navigation</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  跳转之前之行</span><br><span class="line"> *</span><br><span class="line"> *  @param segue 跳转的信息</span><br><span class="line"> *  @param sender 和performSegueWithIdentifier方法传入的sender是同一个</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// Get the new view controller using [segue destinationViewController].</span></span><br><span class="line">    <span class="comment">// Pass the selected object to the new view controller.</span></span><br><span class="line">    <span class="comment">// 1. 获取跳转目的地视图的控制器</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *contactVC = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 2. 设置标题（传值）</span></span><br><span class="line">    contactVC.title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@的联系人列表"</span>, <span class="keyword">self</span>.nameField.text];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.loginBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.pwdField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-2-UIAlertController与添加页面布局"><a href="#2-12-2-UIAlertController与添加页面布局" class="headerlink" title="2.12.2    UIAlertController与添加页面布局"></a>2.12.2    <code>UIAlertController</code>与添加页面布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>iOS8</code> 中新控制器 <code>UIAlertController</code> 的使用，并通过 <code>storyboard</code> 布局添加联系人页面，用第三方类库 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> 实现网络加载进程的效果。</p>
</blockquote>
<p><strong>1. 登录过程中使用<code>MBProgressHUD</code>实现提示窗</strong><br><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"账号不存在"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"密码错误"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [MBProgressHUD showMessage:<span class="string">@"努力加载中"</span>];</span><br><span class="line">    <span class="comment">// 2秒后（模拟网络请求）跳转</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 移除蒙板弹窗</span></span><br><span class="line">        [MBProgressHUD hideHUD];</span><br><span class="line">        [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 在<code>联系人列表界面</code>中点击<code>添加按钮</code>跳转到<code>添加页面</code></strong><br><img src="./show2.gif" alt="Alt text|200x200"></p>
<p><strong>3. 在<code>联系人列表界面</code>中点击注销按钮，注销登陆</strong></p>
<blockquote>
<p><code>UIAlertController</code>：<code>iOS8</code>之后出现的，用来弹出提示窗，取代了<code>UIAcionSheet</code>和<code>UIAlertView</code>。</p>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 初始化 UIAlertController,使用 actionSheet 样式</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"是否注销?"</span> message:<span class="string">@"真的要注销吗？"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">    <span class="comment">// 添加取消按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:<span class="literal">nil</span>]];</span><br><span class="line">    <span class="comment">// 添加确定按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleDestructive</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</span><br><span class="line">        <span class="comment">// pop掉适当前的视图控制器</span></span><br><span class="line">        [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;]];</span><br><span class="line">    <span class="comment">// 弹出这个控制器</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 为<code>登陆界面</code>的输入框增加清空按钮</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.43.58.png" alt="Alt text"></p>
<p><strong>5. 为<code>登陆界面</code>的密码输入框设置安全输入</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.44.32.png" alt="Alt text"></p>
<p><strong>6. 初始化<code>联系人列表界面</code>中的联系人</strong></p>
<blockquote>
<ul>
<li>添加属性<code>contactArr</code></li>
<li>在<code>Storyboard</code>中为<code>联系人cell</code>设置<code>identifier</code>，并设置其<code>Style</code>为<code>Right Style</code></li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.contactArr.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"contactPeopleCell"</span> forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Configure the cell...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-3-添加功能与传值"><a href="#2-12-3-添加功能与传值" class="headerlink" title="2.12.3    添加功能与传值"></a>2.12.3    添加功能与传值</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现添加功能，添加联系人信息后通过代理传递数据到上一层视图控制器。用 <code>storyboard</code> 布局编辑页面。</p>
</blockquote>
<p><strong>1. 创建<code>JKContactModel</code>数据模型</strong></p>
<blockquote>
<p>该数据模型能够<code>序列化</code>和<code>反序列化</code></p>
</blockquote>
<p><em>JKContactModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKContactModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *phone;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContactModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKContactModel</span></span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)encoder &#123;</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.name forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.phone forKey:<span class="string">@"phone"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)decoder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"phone"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 定义具备添加功能（传值）的代理协议，并使用代理对象实现添加功能</strong></p>
<blockquote>
<ul>
<li>让姓名文本框自动获取光标，弹出虚拟键盘</li>
</ul>
</blockquote>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">AddViewController</span>, <span class="title">JKContactModel</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义处理添加工作的代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AddViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;AddViewControllerDelegate&gt; delegate;<span class="comment">// 代理对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *addBtn;</span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction;</span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AddViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="comment">// 让性命文本框 autofocus</span></span><br><span class="line">    [<span class="keyword">self</span>.nameField becomeFirstResponder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通过代理对象传值</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(addContact:didAddContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 创建数据模型</span></span><br><span class="line">        JKContactModel *contactModel = [[JKContactModel alloc] init];</span><br><span class="line">        contactModel.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        contactModel.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理对象将数据添加到 联系人列表视图的数组中</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate addContact:<span class="keyword">self</span> didAddContact:contactModel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.addBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>联系人列表视图</code>中接受数据并增加一条联系人信息<blockquote>
<ul>
<li>去掉多余的 table 中多余的线</li>
<li>在cell右侧添加箭头</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> clearExtraLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clearExtraLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc]init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    AddViewController *addVc = vc;</span><br><span class="line">    addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 设置键盘类型</strong><br><img src="./屏幕快照 2016-03-23 10.14.46.png" alt="Alt text"></p>
<h3 id="2-12-4-编辑页面功能完善"><a href="#2-12-4-编辑页面功能完善" class="headerlink" title="2.12.4    编辑页面功能完善"></a>2.12.4    编辑页面功能完善</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现编辑页面的功能，点击编辑修改响应的按钮和文本框状态，并通过代理方法传值。</p>
</blockquote>
<p><strong>1. 在<code>Storyboard</code>中创建并初始化编辑页面的布局</strong></p>
<blockquote>
<ul>
<li>为cell建立<code>selection segue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_section.gif" alt="Alt text|200x200"></li>
<li>设置按钮默认隐藏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-23%2010.35.09.png" alt="Alt text|350x200"></li>
<li>设置<code>编辑界面</code>的输入框默认不可点击</li>
</ul>
</blockquote>
<p><strong>2. 完善<code>EditViewController</code></strong></p>
<blockquote>
<ul>
<li>初始化界面数据</li>
<li>定义编辑界面的代理协议</li>
<li>实现编辑action</li>
<li>实现保存action</li>
</ul>
</blockquote>
<p>“<em>Controller/EditViewController.h”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKContactModel</span>, <span class="title">EditViewController</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">EditViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc ddidSavaContact: (JKContactModel *)model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;EditViewControllerDelegate&gt;delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKContactModel *contactMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>“<em>Controller/EditViewController.m”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *saveBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIBarButtonItem</span> *edit;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender;</span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EditViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 通过数据模型初始化页面数据</span></span><br><span class="line">    <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">    <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前页面</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通知代理</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(editViewController:didSavaContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 更新编辑界面的显示</span></span><br><span class="line">        <span class="keyword">self</span>.contactMode.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        <span class="keyword">self</span>.contactMode.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理更新联系人列表界面的显示</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate editViewController:<span class="keyword">self</span> didSavaContact:<span class="keyword">self</span>.contactMode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 进入不可编辑状态</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.nameField.enabled) &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">YES</span>;</span><br><span class="line">        sender.title = <span class="string">@"编辑"</span>;</span><br><span class="line">        <span class="comment">// 使用原来的数据还原输入框显示</span></span><br><span class="line">        <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 进入可编辑状态</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">NO</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        sender.title = <span class="string">@"取消"</span>;<span class="comment">// 更新编辑按钮文案</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.edit.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p><code>联系人列表界面</code>采纳代理协议，接收编辑页面的数据</p>
<blockquote>
<ul>
<li>跳转到编辑页面前为<code>编辑界面</code>赋值代理对象</li>
<li>实现滑动删除功能</li>
</ul>
</blockquote>
<hr>
<p><em>ContactTableViewConrtroller.m</em></p>
</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>, <span class="title">EditViewControllerDelegate</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）和数据模型</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">/* 设置代理 */</span></span><br><span class="line">    <span class="comment">// 跳转到添加联系人视图控制器</span></span><br><span class="line">    <span class="keyword">if</span> ([vc isKindOfClass:[AddViewController class]]) &#123;</span><br><span class="line">        AddViewController *addVc = vc;</span><br><span class="line">        addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跳转到编辑联系人视图控制器</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([vc isKindOfClass:[EditViewController class]]) &#123;</span><br><span class="line">        <span class="comment">// 获取点击的联系人所在cell(选中的那一行)的 NSIndexPath</span></span><br><span class="line">        EditViewController *editVc = vc;</span><br><span class="line">        <span class="comment">// 获取选中的那一行</span></span><br><span class="line">        <span class="built_in">NSIndexPath</span> *path = [<span class="keyword">self</span>.tableView indexPathForSelectedRow];</span><br><span class="line">        <span class="comment">// 赋值数据模型</span></span><br><span class="line">        editVc.contactMode = <span class="keyword">self</span>.contactArr[path.row];</span><br><span class="line">        <span class="comment">// 赋值代理对象</span></span><br><span class="line">        editVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-5-数据存储"><a href="#2-12-5-数据存储" class="headerlink" title="2.12.5    数据存储"></a>2.12.5    数据存储</h3><blockquote>
<p><strong>说明：</strong>本课时讲解数据存储的四种方式的区别，学习<code>偏好设置</code>和<code>归档</code>的方式存储数据，并解决添加页面不能传值的问题。</p>
</blockquote>
<table>
<thead>
<tr>
<th>数据存储方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>plist</td>
<td>需要知道文件名，只适合<code>NSArray</code>、<code>NSString</code>等基本数据类型</td>
</tr>
<tr>
<td>偏好设置</td>
<td>不需要知道文件名，小型数据<code>NSUserDefaults</code></td>
</tr>
<tr>
<td>对象归档</td>
<td><code>NSKeyedArchiver</code>，必须采纳<code>NSCoding</code>协议</td>
</tr>
<tr>
<td>core Data</td>
<td>大型数据</td>
</tr>
<tr>
<td>sqpite3</td>
<td>数据库</td>
</tr>
</tbody>
</table>
<h4 id="2-12-5-1-便好设置"><a href="#2-12-5-1-便好设置" class="headerlink" title="2.12.5.1    便好设置"></a>2.12.5.1    便好设置</h4><blockquote>
<p><strong>实战：</strong>登录界面载入后采用<code>便好设置</code>方式读取配置</p>
<ul>
<li>页面载入时读取<code>便好设置</code></li>
<li>点击登录时存储<code>便好设置</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MBProgressHUD+MJ.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define UserNameKey @<span class="meta-string">"name"</span></span></span><br><span class="line"><span class="meta">#define PwdKey @<span class="meta-string">"pwd"</span></span></span><br><span class="line"><span class="meta">#define RmbPwdKey @<span class="meta-string">"rmd_pwd"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.nameField forKey:UserNameKey];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.pwdField.text forKey:PwdKey];</span><br><span class="line">    [defaults setBool:<span class="keyword">self</span>.rembField.isOn forKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 设置同步</span></span><br><span class="line">    [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 读取上次配置</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    <span class="keyword">self</span>.nameField.text = [defaults valueForKey:UserNameKey];</span><br><span class="line">    <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">    <span class="keyword">self</span>.rembField.on = [defaults boolForKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 如果上次登录时选择了记住密码，则自动填写密码字段，并激活登录按钮</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.rembField.isOn) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">        <span class="keyword">self</span>.loginBtn.enabled = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-12-5-2-对象归档"><a href="#2-12-5-2-对象归档" class="headerlink" title="2.12.5.2    对象归档"></a>2.12.5.2    对象归档</h4><blockquote>
<p><strong>实战：</strong>联系人列表界面使用<code>对象归档方式</code>存储数据。</p>
<ul>
<li><code>JKContactModel</code>采纳<code>NSCoding</code>协议</li>
<li>对<code>联系人列表界面</code>中添加、删除和读取数据模型的操作进行归档</li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取归档的文件路径</span></span><br><span class="line"><span class="meta">#define ContactFilePath [[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:@<span class="meta-string">"contacts.data"</span>]</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">        <span class="comment">// 3. 归档</span></span><br><span class="line">        [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 3. 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-13-绘制小黄人"><a href="#2-13-绘制小黄人" class="headerlink" title="2.13    绘制小黄人"></a>2.13    绘制小黄人</h2><h3 id="Quartz-2D"><a href="#Quartz-2D" class="headerlink" title="Quartz 2D"></a>Quartz 2D</h3><blockquote>
<p><strong>说明：</strong>是一个二维绘图引擎。<code>Quartz 2D</code>的<code>API</code>是<code>C</code>语言，来自于<code>CoreGraphics</code>框架。该框架可以用来</p>
<ul>
<li>绘制图形：线条／三角形／矩形／圆／弧等</li>
<li>绘制文字</li>
<li>绘制、生成图片（图像)）</li>
<li>读取／生成pdf</li>
<li>截图、裁剪图片</li>
<li>自定义UI控件</li>
</ul>
<p><strong>技巧：</strong><code>UIView</code>就是通过该引擎实现的控件绘制，因此可以通过继承<code>UIView</code>定义自己的控件。<br><strong>图形上下文（Graphics Context）：</strong>是一个<code>CGContextRef</code>类型的数据，用来</p>
<ul>
<li>保存绘图信息、绘图状态</li>
<li>决定绘制的输出目标（绘制到什么地方去，输出目标可以是PDF文件、Bitmap或者显示器的窗口上）</li>
</ul>
</blockquote>
<h3 id="2-13-1-Quartz-2D基本图形"><a href="#2-13-1-Quartz-2D基本图形" class="headerlink" title="2.13.1    Quartz 2D基本图形"></a>2.13.1    <code>Quartz 2D</code>基本图形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>Quartz 2D</code> 的概念，<code>drawRect</code> 方法的调用、图形上下文、以及线段、三角形、四边形的绘制方法。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%889.51.15.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawLine.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DrawLine</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>DrawLine.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawLine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawLine</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  系统自动调用，视图显示在屏幕上的时候调用切只调用一次</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drwaLine();</span><br><span class="line">    drawRect();</span><br><span class="line">    drawTriangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制直线</span><br><span class="line"> *  绘制两条样式不同的线，因此在两个图形上下文中分别绘制</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drwaLine() &#123;</span><br><span class="line">    <span class="comment">// 第1条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 将上下文复制一份到栈中(作为为第二条线的图形上下文)</span></span><br><span class="line">    <span class="built_in">CGContextSaveGState</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">20</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(context, k<span class="built_in">CGLineCapRound</span>);<span class="comment">// 设置线条头尾部的样式</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);<span class="comment">//设置起点</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第二条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRestoreGState</span>(context);<span class="comment">// 将图形上下文出栈， 替换当前的上下文</span></span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(context, k<span class="built_in">CGLineJoinRound</span>);<span class="comment">// 设置线断转折点的样式</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">120</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制四边形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawRect() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制四边形</span></span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">180</span>));<span class="comment">// 四边形</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> purpleColor] setFill];<span class="comment">// 设置填充色</span></span><br><span class="line">    <span class="comment">// 3. 显示在 View 上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制三角形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawTriangle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制三角形</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);<span class="comment">// 第一个边</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">100</span>);<span class="comment">// 第二个边</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);<span class="comment">// 第三个边（闭合路径，连接起点和最后一个点）</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    <span class="comment">// 3. 显示在view</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-2-绘制圆、图片与文字"><a href="#2-13-2-绘制圆、图片与文字" class="headerlink" title="2.13.2    绘制圆、图片与文字"></a>2.13.2    绘制圆、图片与文字</h3><blockquote>
<p><strong>说明：</strong>本课时讲解绘制圆弧、圆形、图片与文字的方法，所用函数及函数参数的含义，并介绍多种不同的函数绘制图形，最后介绍了<code>Quartz 2D</code>中的贝塞尔曲线。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%8810.25.47.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawCircle.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawCircle.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  角度转换为弧度</span><br><span class="line"> *</span><br><span class="line"> *  @param angle 角度</span><br><span class="line"> *</span><br><span class="line"> *  @return 弧度</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">CGFloat</span> arc(<span class="built_in">CGFloat</span> angle) &#123;</span><br><span class="line">    <span class="keyword">return</span> angle * (M_PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawCircle</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drawArc();</span><br><span class="line">    drawCircle();</span><br><span class="line">    drawImg();</span><br><span class="line">    drawText();</span><br><span class="line">    drawBezier();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  画圆</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawCircle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">130</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  弧形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawArc() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="comment">// 参数：上下文, 圆心横坐标，圆心纵坐标，半径，开始的角度，结束的角度，0顺时针/1逆时针</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, arc(<span class="number">90</span>), arc(<span class="number">200</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *   绘制字体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawText() &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;<span class="comment">// 字串</span></span><br><span class="line">    <span class="comment">// 设置（字体样式信息保存在字典中）</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    attributes[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];<span class="comment">// 字体大小</span></span><br><span class="line">    attributes[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> purpleColor];<span class="comment">// 字体颜色</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:attributes];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图片</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawImg()&#123;</span><br><span class="line">    <span class="comment">// 1. 取得图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">    <span class="comment">// 2. 画</span></span><br><span class="line">    <span class="comment">// img drawAtPoint</span></span><br><span class="line">    <span class="comment">// img drawInRect</span></span><br><span class="line">    [img drawAsPatternInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  贝塞尔曲线</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBezier()&#123;</span><br><span class="line">    <span class="comment">// 1.取得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 起点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextAddCurveToPoint(context, 120, 100, 180, 50, 190, 190);// 2个控制点</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>);<span class="comment">// 1个控制点</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-3-绘制小黄人雏形"><a href="#2-13-3-绘制小黄人雏形" class="headerlink" title="2.13.3    绘制小黄人雏形"></a>2.13.3    绘制小黄人雏形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解根据所学习的 <code>Quartz 2D</code> 的绘制图形的知识绘制小黄人雏形，以此加深对绘图的理解。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-25%20%E4%B8%8A%E5%8D%8812.28.25.png" alt="Alt text|200x150"></p>
</blockquote>
<p><em>DrawHuman.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawHuman.h"</span></span></span><br><span class="line"><span class="meta">#define JKRadius 70// 半径</span></span><br><span class="line"><span class="meta">#define JKTopY 100// 即是身体高度，也是身体顶部纵坐标</span></span><br><span class="line"><span class="meta">#define JKColor(r, g, b) [UIColor colorWithRed:(r)/255.0 green:(g)/255.0 blue :(b)/255.0 alpha:1.0]// 身体颜色</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawHuman</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// 1. 图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    drawBody(context, rect);</span><br><span class="line">    drawMouse(context, rect);</span><br><span class="line">    drawEyes(context, rect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  身体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBody(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 上半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topX = rect.size.width * <span class="number">0.5</span>;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topY = JKTopY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topRadius = JKRadius;<span class="comment">// 圆形半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, topX, topY, topRadius, <span class="number">0</span>, M_PI, <span class="number">1</span>);<span class="comment">// 绘制半圆（从右侧沿逆时针向左绘制）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 身体左侧竖线</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleX = topX - topRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleH = JKTopY;<span class="comment">// 身体部分高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleY =  topY + middleH;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, middleX, middleY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomX = topX;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomY = middleY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomRedius = topRadius;<span class="comment">// 半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, bottomX, bottomY, bottomRedius, M_PI, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭合</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [JKColor(<span class="number">252</span>, <span class="number">218</span>, <span class="number">0</span>) set];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  嘴</span><br><span class="line"> *  采用赛贝尔曲线，1个控制点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawMouse(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 控制点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> controlX = rect.size.width * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> controlY = rect.size.height * <span class="number">0.3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移动到起点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> marginX = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> marginY = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentX = controlX - marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentY = controlY - marginY;</span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, currentX, currentY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 结束点坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endX = controlX + marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> endY = currentY;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, controlX, controlY, endX, endY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  眼睛</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawEyes(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">//黑色绑带（一条很粗的线）</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startX = rect.size.width * <span class="number">0.5</span> - JKRadius;<span class="comment">// 起点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startY = JKTopY;<span class="comment">// 起点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startX, startY);</span><br><span class="line">    <span class="built_in">CGFloat</span> endX = startX + <span class="number">2</span> * JKRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endY = startY;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endX, endY);<span class="comment">// 划线</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">15</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];<span class="comment">// 设置线的颜色</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 显示</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//灰色镜框</span></span><br><span class="line">    [JKColor(<span class="number">61</span>, <span class="number">62</span>, <span class="number">66</span>) set];</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangRadius = JKRadius * <span class="number">0.4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangY = startY;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangX = rect.size.width * <span class="number">0.5</span> - kuangRadius;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, kuangX + <span class="number">25</span>, kuangY, kuangRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//里面的白色框</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> whiteColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteRadius = kuangRadius * <span class="number">0.7</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteX = kuangX;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteY = kuangY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, whiteX + <span class="number">25</span>, whiteY, whiteRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//眼睛</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> blackRadius = whiteRadius * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackX = whiteX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackY = whiteY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, blackX + <span class="number">25</span>, blackY, blackRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-14-手势密码锁"><a href="#2-14-手势密码锁" class="headerlink" title="2.14    手势密码锁"></a>2.14    手势密码锁</h2><h3 id="UIGestureRecognizer"><a href="#UIGestureRecognizer" class="headerlink" title="UIGestureRecognizer"></a>UIGestureRecognizer</h3><blockquote>
<p><strong>说明：</strong>所有手势操作相关的操作的类的<code>基类</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UIGestureRecognizer</code>的子类</th>
<th>对应的手势操作</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UITapGestureRecoginizer</code></td>
<td>点击</td>
</tr>
<tr>
<td><code>UIPinchGestureRecognizer</code></td>
<td>捏合</td>
</tr>
<tr>
<td><code>UIRotationGestureRecognizer</code></td>
<td>旋转</td>
</tr>
<tr>
<td><code>UISwipwGestureRecognizer</code></td>
<td>轻扫、快速移动，是用于监测欢动方向的</td>
</tr>
<tr>
<td><code>UIPanGestureRecognizer</code></td>
<td>拖移、慢速移动，是用于监测便宜的量的</td>
</tr>
<tr>
<td><code>UILongPressGestureRecognizer</code></td>
<td>长按</td>
</tr>
</tbody>
</table>
<h3 id="2-14-1-点击、捏合、轻扫"><a href="#2-14-1-点击、捏合、轻扫" class="headerlink" title="2.14.1    点击、捏合、轻扫"></a>2.14.1    点击、捏合、轻扫</h3><blockquote>
<p><strong>说明：</strong>本课时讲解点击手势，单击和双击，手势互斥原则的概念和解决方法，捏合手势缩放视图以及轻扫手势的使用。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Tap 点击和手势</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  1. 点击示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)tapGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 类型一：一个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTap:)];</span><br><span class="line">    tap.numberOfTapsRequired = <span class="number">1</span>;<span class="comment">// 点击次数(默认1)</span></span><br><span class="line">    tap.numberOfTouchesRequired = <span class="number">1</span>;<span class="comment">// 几个手指点击（默认1）</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap];<span class="comment">// 注册事件到顶层view</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二：一个手指双击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap2 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(doubleTap:)];</span><br><span class="line">    tap2.numberOfTapsRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap2];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型一和类型二冲突策略</span></span><br><span class="line">    [tap requireGestureRecognizerToFail:tap2];<span class="comment">// 同时发生时，只触发tap2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型三：两个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap3 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTwoFingerTap:)];</span><br><span class="line">    tap3.numberOfTouchesRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap3];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二和类型三冲突策略</span></span><br><span class="line">    [tap2 requireGestureRecognizerToFail:tap3];<span class="comment">// 同时发生时，只触发tap3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  2. 轻扫手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UISwipeGestureRecognizer</span> *swipe = [[<span class="built_in">UISwipeGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(swipeAction:)];</span><br><span class="line">    swipe.direction = <span class="built_in">UISwipeGestureRecognizerDirectionLeft</span>;<span class="comment">// 默认右扫</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:swipe];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  3. 捏合手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPinchGestureRecognizer</span> *pinch = [[<span class="built_in">UIPinchGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pinchAction:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:pinch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 响应方法</span></span><br><span class="line"><span class="comment">// 单击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)doubleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指双击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单击（两个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTwoFingerTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"两个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滑动</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeAction:(<span class="built_in">UISwipeGestureRecognizer</span> *)swipe</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"向左轻扫"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捏合</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchAction:(<span class="built_in">UIPinchGestureRecognizer</span> *)pinch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> scale = pinch.scale;</span><br><span class="line">    pinch.view.transform = <span class="built_in">CGAffineTransformScale</span>(pinch.view.transform, scale, scale);</span><br><span class="line">    <span class="keyword">if</span> (scale &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合放大"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (scale &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合缩小"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-14-2-拖移、旋转、长按"><a href="#2-14-2-拖移、旋转、长按" class="headerlink" title="2.14.2    拖移、旋转、长按"></a>2.14.2    拖移、旋转、长按</h3><blockquote>
<p><strong>说明：</strong>本课时讲解拖移、旋转和长按手势的声明以及响应方法，根据其属性和方法来深入理解手势。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  4. 拖移手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)panGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:pan];<span class="comment">// 注册事件到_genstureLabel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  5. 旋转手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIRotationGestureRecognizer</span> *rotation = [[<span class="built_in">UIRotationGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rotationAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:rotation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  6. 长按手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UILongPressGestureRecognizer</span> *longPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(longPressAction:)];</span><br><span class="line">    longPress.minimumPressDuration = <span class="number">2</span>;<span class="comment">// 设置有效触发长按事件时间</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:longPress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长按</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressAction:(<span class="built_in">UILongPressGestureRecognizer</span> *)longPress</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"已经长按2秒"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationAction:(<span class="built_in">UIRotationGestureRecognizer</span> *)rotationGes</span><br><span class="line">&#123;</span><br><span class="line">    rotationGes.view.transform = <span class="built_in">CGAffineTransformRotate</span>(rotationGes.view.transform, rotationGes.rotation);</span><br><span class="line">    rotationGes.rotation = M_PI;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"旋转"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拖动</span></span><br><span class="line">- (<span class="keyword">void</span>)panAction:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移动的量（向量）</span></span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [pan translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    <span class="comment">// 计算移动后的位置坐标</span></span><br><span class="line">    pan.view.center = <span class="built_in">CGPointMake</span>(pan.view.center.x + translation.x, pan.view.center.y + translation.y);</span><br><span class="line">    <span class="comment">// 设置坐标和速度</span></span><br><span class="line">    [pan setTranslation:<span class="built_in">CGPointZero</span> inView:<span class="keyword">self</span>.view];</span><br><span class="line">    _genstureLabel.text = <span class="string">@"把我放哪儿啊？"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-14-3-九宫格布局按钮"><a href="#2-14-3-九宫格布局按钮" class="headerlink" title="2.14.3    九宫格布局按钮"></a>2.14.3    九宫格布局按钮</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>storyboard</code> 添加背景视图，并通过代码布局按钮，运用到了九宫格布局算法，对触摸事件和按钮的功能进行代码封装。</p>
<ol>
<li>引入图片资源</li>
<li>创建<code>JKLockView</code>（<code>UIView</code>）</li>
<li>重写<code>initWithFrame</code>和<code>initWithCoder</code></li>
<li>布局<code>JKLockView</code>并添加按钮<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_gesture.gif" alt="Alt text|100x180"></li>
</ol>
</blockquote>
<h3 id="2-14-4-手势连线与代理"><a href="#2-14-4-手势连线与代理" class="headerlink" title="2.14.4    手势连线与代理"></a>2.14.4    手势连线与代理</h3><blockquote>
<p><strong>说明：</strong>本课时讲解将按钮根据手势触摸连线，修改按钮选中状态、手势结束后取消连线、最后设置代理方法来判断密码是否正确。</p>
<ol>
<li>完成连线逻辑</li>
<li>在<code>JKLockView</code>中定义代理协议</li>
<li><code>ViewController</code>采纳代理协议</li>
<li>在<code>JKLockView</code>中调用代理对象</li>
<li>在<code>ViewController</code>中使用<code>UIAlertController</code></li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>数组或字典中添加的对象不能为<code>nil</code>，否则程序会崩溃</li>
<li>当视图发生变化时，调用<code>setNeedDisplay</code>更新视图</li>
</ul>
<p><strong>技巧：</strong>通过 <code>makeObjectsPerformSelector</code> 向数组中的每一个对象发送信息</p>
</blockquote>
<h2 id="2-15-抽奖转盘动画"><a href="#2-15-抽奖转盘动画" class="headerlink" title="2.15    抽奖转盘动画"></a>2.15    抽奖转盘动画</h2><blockquote>
<p><strong>说明：</strong><code>QuartzCore</code> 框架是常用的框架，除了绘图还有动画效果，通过这个课程理解常用的 <code>CAAnimation</code> 类，并且了解图层与视图的关系，包括 <code>CALayer</code> 的自定义方法和属性。</p>
<ul>
<li>CALayer</li>
<li>CAAnimation</li>
<li>转场动画与组动画</li>
<li>隐性动画</li>
<li>CGImageCreateWithImageInRect</li>
<li>CADisplayLink</li>
</ul>
<p><strong>兼容性：</strong><code>QuartzCore</code>与<code>CoreGraphics</code>是可以跨平台使用的，<code>UIKit</code>只能在<code>iOS</code>中使用</p>
</blockquote>
<h3 id="2-15-1-CALayer图层介绍"><a href="#2-15-1-CALayer图层介绍" class="headerlink" title="2.15.1    CALayer图层介绍"></a>2.15.1    CALayer图层介绍</h3><p><strong>*课程介绍：</strong>本课时讲解<code>CALayer</code> 图层的概念，介绍图层的属性和自定义图层的方法。*</p>
<h4 id="CALayer"><a href="#CALayer" class="headerlink" title="CALayer"></a>CALayer</h4><blockquote>
<p><strong>依赖：</strong>使用层之前，需要在项目中引入<code>QuartzCore.framework</code>框架<br><strong>用途：</strong><code>CALayer</code>(层)是屏幕上的一个矩形区域，在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。</p>
<ul>
<li>层的大小尺寸</li>
<li>背景色</li>
<li>内容（可以填充图片或者使用<code>Core Graphics</code>绘制的内容）</li>
<li>矩形是否使用圆角</li>
<li>矩形是否有阴影</li>
</ul>
<p><strong>感性认知：</strong><code>CALayer</code>本质上是一块包含一幅位图的缓冲区，由视图创建的层为<code>隐式层</code>，而手动创建的层称为<code>显示层</code>。<br><strong>种类：</strong><code>Layer</code>有很多种，最常用也是最基本的是<code>CALayer</code>，当然还包括其他的子类</p>
<ul>
<li><code>CAScrollerLayer</code> 简化显示层的一部分</li>
<li><code>CATextLayer</code> 文本层</li>
<li><code>CAGradientLayer</code>、<code>CAShapeLayer</code>等等</li>
</ul>
</blockquote>
<h4 id="2-15-1-1-原生控件使用CALayer"><a href="#2-15-1-1-原生控件使用CALayer" class="headerlink" title="2.15.1.1    原生控件使用CALayer"></a>2.15.1.1    原生控件使用<code>CALayer</code></h4><blockquote>
<p><strong>说明：</strong>在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.11.53.png" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initImageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置原生控件的CALayer（以 UIImageView 为例）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initImageView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>]];</span><br><span class="line">    imgView.frame = <span class="built_in">CGRectMake</span>((kScreenWidth - <span class="number">200</span>) / <span class="number">2</span>, (kScreenHeight - <span class="number">200</span>) / <span class="number">2</span>, <span class="number">200</span>, <span class="number">200</span>);<span class="comment">// 设置frame</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imgView];<span class="comment">// 将 UIImageView 添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 UIImageView 的根 CGLayer</span></span><br><span class="line">    <span class="comment">// 1. 设置阴影</span></span><br><span class="line">    imgView.layer.shadowColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;<span class="comment">// 设置阴影颜色</span></span><br><span class="line">    imgView.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);<span class="comment">// 设置阴影的偏移</span></span><br><span class="line">    imgView.layer.shadowOpacity = <span class="number">0.5</span>;<span class="comment">// 设置阴影的不透明</span></span><br><span class="line">    <span class="comment">// 2. 设置圆角</span></span><br><span class="line">    imgView.layer.cornerRadius = <span class="number">10</span>;<span class="comment">// 设置圆角半径</span></span><br><span class="line">    imgView.layer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 强制内部的所有子层支持圆角效果，少了这个设置，UIImageView是不会有圆角效果的。设置之后，没有阴影效果。</span></span><br><span class="line">    <span class="comment">// 3. 设置边框</span></span><br><span class="line">    imgView.layer.borderWidth = <span class="number">5</span>;</span><br><span class="line">    imgView.layer.borderColor = [<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">    <span class="comment">// 4. 设置旋转：利用 transform 属性可以设置旋转、缩放等效果</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 顺时针旋转45度</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 缩小0.5倍</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [imgView.layer setValue:@(2) forKey:@"transform.scale.x"];// 使用KVC方式</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-15-1-2-自定义CALayer"><a href="#2-15-1-2-自定义CALayer" class="headerlink" title="2.15.1.2    自定义CALayer"></a>2.15.1.2    自定义CALayer</h4><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>建子类继承<code>CALayer</code>，实现 <code>drawInContext：</code>方法</li>
<li>在控制器中设置代理，实现代理方法来画图层</li>
</ul>
</blockquote>
<h5 id="方式一：继承CALayer"><a href="#方式一：继承CALayer" class="headerlink" title="方式一：继承CALayer"></a>方式一：继承CALayer</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.26.12.png" alt="Alt text"></p>
<p><em>MyCALayer.h</em></p>
<blockquote>
<p><strong>说明：</strong>继承<code>CALayer</code><br><strong>注意：</strong>需要在项目的<code>info.plist</code>中导入<code>QuartzCore</code>库</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyCALyer</span> : <span class="title">CALayer</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>MyCALayer.m</em></p>
<blockquote>
<p><strong>说明：</strong>需要重写<code>drawInContext</code>方法，该方法在视图变动时通过<code>setNeededDisplay</code>被自动调用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyCALyer</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  该方法中完成对图层的绘制</span><br><span class="line"> *</span><br><span class="line"> *  @param ctx 图形上下文</span><br><span class="line"> */</span></span><br><span class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));<span class="comment">// 椭圆</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 实心绘制</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>在控制器中使用这个自定义的<code>MyLayer</code>，将图层实例添加到视图中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> myLayerExample];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例自定义 CALayer 的使用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)myLayerExample</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建自定义 layer 实例</span></span><br><span class="line">    My<span class="built_in">CALyer</span> *layer = [My<span class="built_in">CALyer</span> layer];</span><br><span class="line">    <span class="comment">// 设置该 layer 实例</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 绘制该layer</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 调用该方法，layer 的 drawInContext 方法才会被调用</span></span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：实现代理当法"><a href="#方式二：实现代理当法" class="headerlink" title="方式二：实现代理当法"></a>方式二：实现代理当法</h5><blockquote>
<p><strong>说明：</strong>和方式一一样要创建<code>CALayer</code>的子类，但不用实现<code>drawInContext</code>方法，而是设置代理对象（可以是任何类的实例），绘制的过程由代理对象重写<code>drawInContext</code>方法来实现。<br><em>JKLayer.h</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKLayer</span> : <span class="title">CALayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKLayer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKLayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    JKLayer *layer = [JKLayer layer];</span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;<span class="comment">// 不用采纳额外协议，任何对象可以作为代理对象</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 必须调用这个方法，代理对象的 drawLayer方法 才会显被调用</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到父图层</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 代理方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  修改当前ViewController的根Layer</span><br><span class="line"> *  @param layer 图层</span><br><span class="line"> *  @param ctx   绘制上下文</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-2-CAAnimation-动画"><a href="#2-15-2-CAAnimation-动画" class="headerlink" title="2.15.2    CAAnimation 动画"></a>2.15.2    CAAnimation 动画</h3><blockquote>
<p><strong>说明：</strong>基本动画、关键帧动画、组动画</p>
</blockquote>
<table>
<thead>
<tr>
<th>基本动画类型</th>
<th>说明</th>
<th>父类</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CABasicAnimation</code></td>
<td>基础动画</td>
<td>属性动画</td>
<td>平移、旋转、缩放</td>
</tr>
<tr>
<td><code>CAKeyframeAnimation</code></td>
<td>关键帧动画</td>
<td>属性动画</td>
<td>按照某种自定义路径移动</td>
</tr>
<tr>
<td><code>CATransition</code></td>
<td>转场动画</td>
<td><code>CAAnimation</code></td>
<td>不同layer之间的切换</td>
</tr>
<tr>
<td><code>CAAnimationGroup</code></td>
<td>组动画</td>
<td><code>CAAnimation</code></td>
<td>将几个不同的动画放在同一个组里</td>
</tr>
</tbody>
</table>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *layer;<span class="comment">// 用于演示动画的图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 创建图层</span></span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.position = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.backgroundColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;</span><br><span class="line">    <span class="comment">// 添加图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">    <span class="keyword">self</span>.layer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">// [self animationScale];</span></span><br><span class="line">    <span class="comment">// [self animationTranslate];</span></span><br><span class="line">    <span class="comment">// [self animationRotation];</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 基本动画(CABasicAnimation)</span></span><br><span class="line"><span class="comment">// 缩放</span></span><br><span class="line">- (<span class="keyword">void</span>)animationScale</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置 动画</span></span><br><span class="line">    <span class="comment">// keyPath ：决定了基本动画的类型</span></span><br><span class="line">    animation.keyPath = <span class="string">@"bounds"</span>;</span><br><span class="line">    <span class="comment">// toValue 到达哪个点，byValue 增加多少值, fromValue 从哪个点开始移动</span></span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];<span class="comment">// toValue ：到达哪个点</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;<span class="comment">// 动画持续时间</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;<span class="comment">// 动画完毕之后不删除动画（即，可以再次触发）</span></span><br><span class="line">    animation.fillMode = <span class="string">@"forwords"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画到图层</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平移</span></span><br><span class="line">- (<span class="keyword">void</span>)animationTranslate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forwards"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)animationRotation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"transform"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forward"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 关键帧动画</span></span><br><span class="line"><span class="comment">// 让图层做一个圆形移动</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *animation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = k<span class="built_in">CAFillModeForwards</span>;<span class="comment">// 保持最新的状态</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();<span class="comment">// 创建一个可变路径</span></span><br><span class="line">    <span class="built_in">CGPathAddEllipseInRect</span>(path, <span class="literal">NULL</span>, <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>));<span class="comment">// 画一个圆</span></span><br><span class="line">    animation.path = path;<span class="comment">// 设置动画路径</span></span><br><span class="line">    <span class="comment">// CGPathRelease(path);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置动画的执行节奏</span></span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.delegate = <span class="keyword">self</span>;<span class="comment">// 也可以将动画设置工作交给代理对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 组动画</span></span><br><span class="line"><span class="comment">// 组动画</span></span><br><span class="line">- (<span class="keyword">void</span>)animationGroup</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建组动画对象</span></span><br><span class="line">    <span class="comment">// CAAnimationGroup *animationGroup = [CAAnimationGroup animation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建多个动画，添加到组动画（数组）中</span></span><br><span class="line">    <span class="comment">// animationGroup.animations = @[];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    <span class="comment">// [self.layer addAnimation:animationGroup forKey:nil];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-3-转场动画"><a href="#2-15-3-转场动画" class="headerlink" title="2.15.3    转场动画"></a>2.15.3    转场动画</h3><blockquote>
<p><strong>说明：</strong>本课时讲解核心动画的两个子类即<code>转场动画</code>和<code>组动画</code>，并介绍了转场动画的私有 API ，全面理解 <code>CAAnimation</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_animation.gif" alt="Alt text|200x200"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 转场动画</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)exchangeView &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"pageCurl"</span>;<span class="comment">// 翻页效果：私有API的动画类型</span></span><br><span class="line">    animation.subtype = k<span class="built_in">CATransitionFromRight</span>;<span class="comment">// 翻页方向</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 实施动画</span></span><br><span class="line">    [_animView exchangeSubviewAtIndex:<span class="number">0</span> withSubviewAtIndex:<span class="number">1</span>];</span><br><span class="line">    [_animView.layer addAnimation:animation forKey:<span class="string">@"myAnimation"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)pushAction &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"cube"</span>;<span class="comment">// 立体翻转</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 将动画添加到导航控制器视图图层</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController.view.layer addAnimation:animation forKey:<span class="string">@"navAnimation"</span>];</span><br><span class="line">    <span class="comment">// 4. 实施动画</span></span><br><span class="line">    DetailViewController *detailVC = [[DetailViewController alloc] init];<span class="comment">// 创建要导航到的视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController showViewController:detailVC sender:<span class="literal">nil</span>];<span class="comment">// 导航到目标视图控制器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-15-4-实例动画按钮布局"><a href="#2-15-4-实例动画按钮布局" class="headerlink" title="2.15.4    实例动画按钮布局"></a>2.15.4    实例动画按钮布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解转盘动画实例，进行效果展示并完成 <code>UI</code> 布局，介绍了裁剪图片的新方法。</p>
<ol>
<li>导入资源</li>
<li>创建轮盘类（<code>WheelView</code>，继承<code>UIView</code>）</li>
<li>创建轮盘类对应的<code>xib</code>文件</li>
</ol>
<p><strong>要点：</strong> 使用<code>CGImageCreateWithImageInRect</code>裁剪图片</p>
</blockquote>
<h3 id="2-15-5-CADisplayLink实现动画效果"><a href="#2-15-5-CADisplayLink实现动画效果" class="headerlink" title="2.15.5    CADisplayLink实现动画效果"></a>2.15.5    CADisplayLink实现动画效果</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>CADisplayLink</code> 实现动画效果，完善实例动画功能，复习了 <code>CABasicAnimation</code> 的属性和方法。</p>
<p><strong>要点：</strong>使用<code>CADisplayLink</code>通过刷新实现动画，<br><strong>注意：</strong>这里没有使用核心动画，因为它们在动画过程中响应点击的位置并没有真的发生变化。<code>CADisplayLink</code>就可以做到。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_wheel.gif" alt="Alt text"></p>
</blockquote>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/极客学院-ios中级/" rel="tag">#极客学院_ios中级</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/" rel="next" title="1 了解ios项目开发">
                <i class="fa fa-chevron-left"></i> 1 了解ios项目开发
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/14/JK_IOS中级_3  动画图层部分/" rel="prev" title="3 动画图层部分">
                3 动画图层部分 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/05/14/JK_IOS中级_2  UI部分/"
           data-title="2 UI部分" data-url="http://laputa-er.github.io/2016/05/14/JK_IOS中级_2  UI部分/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">94</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-汤姆猫小游戏（投诉下线）"><span class="nav-number">1.</span> <span class="nav-text">2.1    汤姆猫小游戏（投诉下线）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-加法计算器"><span class="nav-number">2.</span> <span class="nav-text">2.2    加法计算器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-制作图片浏览器"><span class="nav-number">3.</span> <span class="nav-text">2.3    制作图片浏览器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-LOL英雄展示"><span class="nav-number">4.</span> <span class="nav-text">2.4    LOL英雄展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-数据模版"><span class="nav-number">4.1.</span> <span class="nav-text">2.4.1    数据模版</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-采纳协议"><span class="nav-number">4.2.</span> <span class="nav-text">2.4.2    采纳协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-Face-人脸识别技术入门"><span class="nav-number">5.</span> <span class="nav-text">2.5    Face++人脸识别技术入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-本课概要"><span class="nav-number">5.1.</span> <span class="nav-text">2.5.1    本课概要</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-1-Face-公司简介"><span class="nav-number">5.1.1.</span> <span class="nav-text">2.5.1.1    Face++公司简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-2-Face-核心技术简介"><span class="nav-number">5.1.2.</span> <span class="nav-text">2.5.1.2 Face++核心技术简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#人脸检测和追踪"><span class="nav-number">5.1.2.1.</span> <span class="nav-text">人脸检测和追踪</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Face-人脸关键点定位"><span class="nav-number">5.1.2.2.</span> <span class="nav-text">Face++人脸关键点定位</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Face-人脸属性分析"><span class="nav-number">5.1.2.3.</span> <span class="nav-text">Face++人脸属性分析</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Face-人脸1-1识别技术"><span class="nav-number">5.1.2.4.</span> <span class="nav-text">Face++人脸1:1识别技术</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Face-人脸1-N识别技术"><span class="nav-number">5.1.2.5.</span> <span class="nav-text">Face++人脸1:N识别技术</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Face-人脸大规模搜索"><span class="nav-number">5.1.2.6.</span> <span class="nav-text">Face++人脸大规模搜索</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-3-Face-技术使用场景介绍"><span class="nav-number">5.1.3.</span> <span class="nav-text">2.5.1.3    Face++技术使用场景介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#相机和广告"><span class="nav-number">5.1.3.1.</span> <span class="nav-text">相机和广告</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#游戏"><span class="nav-number">5.1.3.2.</span> <span class="nav-text">游戏</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#人脸搜索和人脸登录"><span class="nav-number">5.1.3.3.</span> <span class="nav-text">人脸搜索和人脸登录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2-Face-介绍"><span class="nav-number">5.2.</span> <span class="nav-text">2.5.2    Face++介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-3-线上API分析"><span class="nav-number">5.3.</span> <span class="nav-text">2.5.3    线上API分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-4-离线API的下载和配置"><span class="nav-number">5.4.</span> <span class="nav-text">2.5.4    离线API的下载和配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-5-Face-实例编写"><span class="nav-number">5.5.</span> <span class="nav-text">2.5.5    Face++实例编写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-6-Face-人脸识别总结语"><span class="nav-number">5.6.</span> <span class="nav-text">2.5.6    Face++人脸识别总结语</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-应用管理"><span class="nav-number">6.</span> <span class="nav-text">2.6    应用管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-项目讲解和模型搭建"><span class="nav-number">6.1.</span> <span class="nav-text">2.6.1    项目讲解和模型搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据模型"><span class="nav-number">6.1.1.</span> <span class="nav-text">数据模型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-Xib自定义视图"><span class="nav-number">6.2.</span> <span class="nav-text">2.6.2    Xib自定义视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-1-xib视图文件"><span class="nav-number">6.2.1.</span> <span class="nav-text">2.6.2.1    xib视图文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-6-2-2-绑定的类-UIView"><span class="nav-number">6.2.2.</span> <span class="nav-text">2.6.2.2    绑定的类(UIView)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-3-创建自定义视图数组"><span class="nav-number">6.3.</span> <span class="nav-text">2.6.3    创建自定义视图数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-4-九宫格布局展示"><span class="nav-number">6.4.</span> <span class="nav-text">2.6.4    九宫格布局展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-5-点击效果分析与bug排除"><span class="nav-number">6.5.</span> <span class="nav-text">2.6.5    点击效果分析与bug排除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-6-延时操作与块动画"><span class="nav-number">6.6.</span> <span class="nav-text">2.6.6    延时操作与块动画</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-超级猜图"><span class="nav-number">7.</span> <span class="nav-text">2.7    超级猜图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-1-效果展示与业务逻辑分析"><span class="nav-number">7.1.</span> <span class="nav-text">2.7.1    效果展示与业务逻辑分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-2-模型搭建"><span class="nav-number">7.2.</span> <span class="nav-text">2.7.2    模型搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-3-Storyboard-布局-UI"><span class="nav-number">7.3.</span> <span class="nav-text">2.7.3    Storyboard 布局 UI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-4-拖线与注释"><span class="nav-number">7.4.</span> <span class="nav-text">2.7.4    拖线与注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-5-创建模型数组与遮罩"><span class="nav-number">7.5.</span> <span class="nav-text">2.7.5    创建模型数组与遮罩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-6-实现图片缩放"><span class="nav-number">7.6.</span> <span class="nav-text">2.7.6    实现图片缩放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-7-下一题方法实现"><span class="nav-number">7.7.</span> <span class="nav-text">2.7.7    下一题方法实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-8-创建答案按钮"><span class="nav-number">7.8.</span> <span class="nav-text">2.7.8    创建答案按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-9-创建备选答案按钮"><span class="nav-number">7.9.</span> <span class="nav-text">2.7.9    创建备选答案按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-10-答案按钮点击"><span class="nav-number">7.10.</span> <span class="nav-text">2.7.10    答案按钮点击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-11-备选按钮点击"><span class="nav-number">7.11.</span> <span class="nav-text">2.7.11    备选按钮点击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-12-提示点击方法的实现"><span class="nav-number">7.12.</span> <span class="nav-text">2.7.12    提示点击方法的实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-8-国家选择"><span class="nav-number">8.</span> <span class="nav-text">2.8    国家选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-1-UIPickerView与数据模型的创建"><span class="nav-number">8.1.</span> <span class="nav-text">2.8.1    UIPickerView与数据模型的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-1-1-UIPickerView"><span class="nav-number">8.1.1.</span> <span class="nav-text">2.8.1.1    UIPickerView</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-1-2-数据模型的创建"><span class="nav-number">8.1.2.</span> <span class="nav-text">2.8.1.2     数据模型的创建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-2-自定义视图完善实例"><span class="nav-number">8.2.</span> <span class="nav-text">2.8.2    自定义视图完善实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-2-1-创建xib文件"><span class="nav-number">8.2.1.</span> <span class="nav-text">2.8.2.1    创建xib文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-2-2-创建JKCountryFlagView类"><span class="nav-number">8.2.2.</span> <span class="nav-text">2.8.2.2    创建JKCountryFlagView类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-8-2-3-完善ViewController"><span class="nav-number">8.2.3.</span> <span class="nav-text">2.8.2.3    完善ViewController</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-9-图片自动播放"><span class="nav-number">9.</span> <span class="nav-text">2.9    图片自动播放</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-1-创建UIScrollView和UIPageControl"><span class="nav-number">9.1.</span> <span class="nav-text">2.9.1    创建UIScrollView和UIPageControl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-2-定时器与代理方法调用"><span class="nav-number">9.2.</span> <span class="nav-text">2.9.2    定时器与代理方法调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-3-代码摘要"><span class="nav-number">9.3.</span> <span class="nav-text">2.9.3    代码摘要</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-10-QQ列表展示"><span class="nav-number">10.</span> <span class="nav-text">2.10    QQ列表展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-1-模型搭建"><span class="nav-number">10.1.</span> <span class="nav-text">2.10.1    模型搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-1-1-JKGroupModel"><span class="nav-number">10.1.1.</span> <span class="nav-text">2.10.1.1    JKGroupModel</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-1-2-JKFriendsModel"><span class="nav-number">10.1.2.</span> <span class="nav-text">2.10.1.2    JKFriendsModel</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-2-创建UITableView"><span class="nav-number">10.2.</span> <span class="nav-text">2.10.2    创建UITableView</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-3-自定义头视图"><span class="nav-number">10.3.</span> <span class="nav-text">2.10.3    自定义头视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-3-1-View部分"><span class="nav-number">10.3.1.</span> <span class="nav-text">2.10.3.1    View部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-10-3-2-Controller部分"><span class="nav-number">10.3.2.</span> <span class="nav-text">2.10.3.2    Controller部分</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-10-4-点击效果的实现"><span class="nav-number">10.4.</span> <span class="nav-text">2.10.4    点击效果的实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-11-三级控制器"><span class="nav-number">11.</span> <span class="nav-text">2.11    三级控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-1-初始化视图控制器"><span class="nav-number">11.1.</span> <span class="nav-text">2.11.1    初始化视图控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-2-自定义标签工具栏"><span class="nav-number">11.2.</span> <span class="nav-text">2.11.2    自定义标签工具栏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-11-3-页面跳转的两种方式"><span class="nav-number">11.3.</span> <span class="nav-text">2.11.3    页面跳转的两种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-3-1-RootViewController"><span class="nav-number">11.3.1.</span> <span class="nav-text">2.11.3.1    RootViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-3-2-ProfileViewController"><span class="nav-number">11.3.2.</span> <span class="nav-text">2.11.3.2    ProfileViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-3-3-PushViewController"><span class="nav-number">11.3.3.</span> <span class="nav-text">2.11.3.3    PushViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-11-3-4-ModalViewController"><span class="nav-number">11.3.4.</span> <span class="nav-text">2.11.3.4    ModalViewController</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-12-通讯录"><span class="nav-number">12.</span> <span class="nav-text">2.12    通讯录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-1-Storyboard实现布局和跳转"><span class="nav-number">12.1.</span> <span class="nav-text">2.12.1    Storyboard实现布局和跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">12.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-12-1-1-布局"><span class="nav-number">12.2.1.</span> <span class="nav-text">2.12.1.1    布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-12-1-2-跳转"><span class="nav-number">12.2.2.</span> <span class="nav-text">2.12.1.2    跳转</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-2-UIAlertController与添加页面布局"><span class="nav-number">12.3.</span> <span class="nav-text">2.12.2    UIAlertController与添加页面布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-3-添加功能与传值"><span class="nav-number">12.4.</span> <span class="nav-text">2.12.3    添加功能与传值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-4-编辑页面功能完善"><span class="nav-number">12.5.</span> <span class="nav-text">2.12.4    编辑页面功能完善</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-12-5-数据存储"><span class="nav-number">12.6.</span> <span class="nav-text">2.12.5    数据存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-12-5-1-便好设置"><span class="nav-number">12.6.1.</span> <span class="nav-text">2.12.5.1    便好设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-12-5-2-对象归档"><span class="nav-number">12.6.2.</span> <span class="nav-text">2.12.5.2    对象归档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-13-绘制小黄人"><span class="nav-number">13.</span> <span class="nav-text">2.13    绘制小黄人</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Quartz-2D"><span class="nav-number">13.1.</span> <span class="nav-text">Quartz 2D</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-13-1-Quartz-2D基本图形"><span class="nav-number">13.2.</span> <span class="nav-text">2.13.1    Quartz 2D基本图形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-13-2-绘制圆、图片与文字"><span class="nav-number">13.3.</span> <span class="nav-text">2.13.2    绘制圆、图片与文字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-13-3-绘制小黄人雏形"><span class="nav-number">13.4.</span> <span class="nav-text">2.13.3    绘制小黄人雏形</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-14-手势密码锁"><span class="nav-number">14.</span> <span class="nav-text">2.14    手势密码锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UIGestureRecognizer"><span class="nav-number">14.1.</span> <span class="nav-text">UIGestureRecognizer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-14-1-点击、捏合、轻扫"><span class="nav-number">14.2.</span> <span class="nav-text">2.14.1    点击、捏合、轻扫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-14-2-拖移、旋转、长按"><span class="nav-number">14.3.</span> <span class="nav-text">2.14.2    拖移、旋转、长按</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-14-3-九宫格布局按钮"><span class="nav-number">14.4.</span> <span class="nav-text">2.14.3    九宫格布局按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-14-4-手势连线与代理"><span class="nav-number">14.5.</span> <span class="nav-text">2.14.4    手势连线与代理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-15-抽奖转盘动画"><span class="nav-number">15.</span> <span class="nav-text">2.15    抽奖转盘动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-1-CALayer图层介绍"><span class="nav-number">15.1.</span> <span class="nav-text">2.15.1    CALayer图层介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CALayer"><span class="nav-number">15.1.1.</span> <span class="nav-text">CALayer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-15-1-1-原生控件使用CALayer"><span class="nav-number">15.1.2.</span> <span class="nav-text">2.15.1.1    原生控件使用CALayer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-15-1-2-自定义CALayer"><span class="nav-number">15.1.3.</span> <span class="nav-text">2.15.1.2    自定义CALayer</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#方式一：继承CALayer"><span class="nav-number">15.1.3.1.</span> <span class="nav-text">方式一：继承CALayer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方式二：实现代理当法"><span class="nav-number">15.1.3.2.</span> <span class="nav-text">方式二：实现代理当法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-2-CAAnimation-动画"><span class="nav-number">15.2.</span> <span class="nav-text">2.15.2    CAAnimation 动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-3-转场动画"><span class="nav-number">15.3.</span> <span class="nav-text">2.15.3    转场动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-4-实例动画按钮布局"><span class="nav-number">15.4.</span> <span class="nav-text">2.15.4    实例动画按钮布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-15-5-CADisplayLink实现动画效果"><span class="nav-number">15.5.</span> <span class="nav-text">2.15.5    CADisplayLink实现动画效果</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
