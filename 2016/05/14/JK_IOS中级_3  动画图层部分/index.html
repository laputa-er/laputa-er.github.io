<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="3.1    设计复杂的iOS动画效果3.1.1    制定统一的动画接口
说明：制定统一的动画接口有如下优点

便于实现后续复杂的动画组合
对于后续的代码维护极为方便
需要优先考虑里氏代换原则


3.1.2    动画中的高内聚低耦合原理
说明：将视图的动画效果的实现和视图本身封装到另一个UIView中。技巧：

不要把实现动画的细节暴露在外
设计动画类尽力那个要符合单一职能原则，以便后续方便">
<meta property="og:type" content="article">
<meta property="og:title" content="3 动画图层部分">
<meta property="og:url" content="http://laputa-er.github.io/2016/05/14/JK_IOS中级_3  动画图层部分/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="3.1    设计复杂的iOS动画效果3.1.1    制定统一的动画接口
说明：制定统一的动画接口有如下优点

便于实现后续复杂的动画组合
对于后续的代码维护极为方便
需要优先考虑里氏代换原则


3.1.2    动画中的高内聚低耦合原理
说明：将视图的动画效果的实现和视图本身封装到另一个UIView中。技巧：

不要把实现动画的细节暴露在外
设计动画类尽力那个要符合单一职能原则，以便后续方便">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%881.08.34.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%8810.02.55.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_effective.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-06%20%E4%B8%8B%E5%8D%883.14.40.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_ga.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_text.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.44.12.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.53.54.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_pop.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_decay.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_spring.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-09%20%E4%B8%8B%E5%8D%8810.52.45.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_easing.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-10%20%E4%B8%8B%E5%8D%8812.00.12.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_time.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_bounce.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_cubic.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_emitter.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_rain.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam1.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam2.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam3.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam4.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.44.12.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.45.28.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_gra.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_colors.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_last.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_path.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_beisaier.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-12%2019.14.35.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_animeTwo.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_circle.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-13%2010.29.42.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_fade.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8A%E5%8D%8812.01.58.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1460642543336.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8810.36.09.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1460644510040.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8811.43.57.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_panel.gif">
<meta property="og:updated_time" content="2016-09-19T12:06:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 动画图层部分">
<meta name="twitter:description" content="3.1    设计复杂的iOS动画效果3.1.1    制定统一的动画接口
说明：制定统一的动画接口有如下优点

便于实现后续复杂的动画组合
对于后续的代码维护极为方便
需要优先考虑里氏代换原则


3.1.2    动画中的高内聚低耦合原理
说明：将视图的动画效果的实现和视图本身封装到另一个UIView中。技巧：

不要把实现动画的细节暴露在外
设计动画类尽力那个要符合单一职能原则，以便后续方便">
<meta name="twitter:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/2016/05/14/JK_IOS中级_3  动画图层部分/"/>

  <title> 3 动画图层部分 | Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?898688f51c5a3d6b37dd23e04441e5bd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                3 动画图层部分
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:59:02+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/极客学院-ios中级/" itemprop="url" rel="index">
                    <span itemprop="name">极客学院_ios中级</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_3  动画图层部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="3-1-设计复杂的iOS动画效果"><a href="#3-1-设计复杂的iOS动画效果" class="headerlink" title="3.1    设计复杂的iOS动画效果"></a>3.1    设计复杂的iOS动画效果</h2><h3 id="3-1-1-制定统一的动画接口"><a href="#3-1-1-制定统一的动画接口" class="headerlink" title="3.1.1    制定统一的动画接口"></a>3.1.1    制定统一的动画接口</h3><blockquote>
<p><strong>说明：</strong>制定统一的动画接口有如下优点</p>
<ul>
<li>便于实现后续复杂的动画组合</li>
<li>对于后续的代码维护极为方便</li>
<li>需要优先考虑里氏代换原则</li>
</ul>
</blockquote>
<h3 id="3-1-2-动画中的高内聚低耦合原理"><a href="#3-1-2-动画中的高内聚低耦合原理" class="headerlink" title="3.1.2    动画中的高内聚低耦合原理"></a>3.1.2    动画中的高内聚低耦合原理</h3><blockquote>
<p><strong>说明：</strong>将视图的动画效果的实现和视图本身封装到另一个<code>UIView</code>中。<br><strong>技巧：</strong></p>
<ul>
<li>不要把实现动画的细节暴露在外</li>
<li>设计动画类尽力那个要符合<code>单一职能原则</code>，以便后续方便组合成复杂的动画效果</li>
</ul>
<p><strong>单一职能原则：</strong>如果一个类承担的只能过多，就等于把这些功能耦合在一起，一个职能的变化可能会削弱或者抑制其他职能的能力，这种耦合会导致脆弱的设计，当发生变化时，设计会遭到意想不到的破坏。如果想要避免这种现象发生，就要尽可能的遵守<code>单一职能原则</code>。</p>
</blockquote>
<p><em>LineView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">@(中级ios开发工程师)interface LineView : <span class="built_in">UIView</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span>  offsetX;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> rect;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.rect = frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>viewcntroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *line<span class="built_in">UIView</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [<span class="keyword">self</span> testLineAnimate];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用封装在LineUIView中的动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testLineAnimate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建封装着动画效果的视图实例</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置初始状态</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView.offsetX = <span class="number">50.</span>f;</span><br><span class="line">    <span class="keyword">self</span>.lineUIView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineUIView];</span><br><span class="line">    <span class="comment">// 展现带有动画的视图（展现带有动画）</span></span><br><span class="line">    [<span class="keyword">self</span>.lineUIView show];</span><br><span class="line">    <span class="comment">// 3秒中后隐藏视图（带消失有动画）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(excuteAfterDelay) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)excuteAfterDelay</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineUIView hide];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-设计动画函数的注意事项"><a href="#3-1-3-设计动画函数的注意事项" class="headerlink" title="3.1.3    设计动画函数的注意事项"></a>3.1.3    设计动画函数的注意事项</h3><ul>
<li>动画方法的命名统一：封装在不同的<code>view</code>的同类动画方法命名要一致</li>
<li>预留非动画情形的设计：避免<code>TableView</code>或者其它存在重用问题的场景下的性能问题</li>
<li>用百分比来表示动画的执行程度</li>
<li>懒加载的使用</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif" alt="Alt text"></p>
<p><em>LineUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> offSetX;<span class="comment">// 对应动画进度的偏移量</span></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建view（懒加载方式）</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画百分比（动画进行程度）</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> startRect;<span class="comment">// 开始区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> midRect;<span class="comment">// 动画进行到中间时的区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> endRect;<span class="comment">// 结束区域</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineUIView</span></span></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;<span class="comment">// 视图创建时是不可见的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  隐藏视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.endRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished)&#123;</span><br><span class="line">            <span class="comment">// 视图隐藏后将视图复原到初始位置</span></span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建view（懒加载方式）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.startRect = <span class="keyword">self</span>.frame;</span><br><span class="line">    <span class="keyword">self</span>.midRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">    <span class="keyword">self</span>.endRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX * <span class="number">2</span>,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  动画百分比（动画进行程度）</span><br><span class="line"> *</span><br><span class="line"> *  @param percent 动画进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (percent &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        tmpOffsetX = percent * <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + tmpOffsetX,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.lineView.offSetX = <span class="keyword">self</span>.view.frame.size.width / <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.lineView buildView];<span class="comment">// 初始化视图成员</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将动画视图添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineView];</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    [<span class="keyword">self</span> delayShow];</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    [<span class="keyword">self</span> delayHide];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayShow</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView showWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayHide</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView hideWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-用里氏代换原则来处理动画类的继承问题"><a href="#3-1-4-用里氏代换原则来处理动画类的继承问题" class="headerlink" title="3.1.4    用里氏代换原则来处理动画类的继承问题"></a>3.1.4    用里氏代换原则来处理动画类的继承问题</h3><blockquote>
<p><strong>说明：</strong>其实就是利用对象的<code>多态性</code>，父类变量动态调用子类对象的方法。<br><strong>要点：</strong></p>
<ul>
<li>里氏代换原则的基本原理</li>
<li>设计中要确保父类可以直接调用子类的方法</li>
<li>将父类设计成虚类（需要时，父类也可以提供实现）</li>
</ul>
</blockquote>
<h4 id="3-1-4-1-父类"><a href="#3-1-4-1-父类" class="headerlink" title="3.1.4.1    父类"></a>3.1.4.1    父类</h4><p><em>SuperUIView.h</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SuperUIView : UIView</span><br><span class="line"></span><br><span class="line">- (void)show;</span><br><span class="line">- (void)hide;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><em>SuperUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SuperUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperUIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-2-子类"><a href="#3-1-4-2-子类" class="headerlink" title="3.1.4.2    子类"></a>3.1.4.2    子类</h4><blockquote>
<p><strong>说明：</strong>在子类中重写集成来的<code>show</code>的<code>hide</code>方法。</p>
</blockquote>
<p><em>SubUIView1.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView1</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>SubUIView2.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView2</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-3-演示"><a href="#3-1-4-3-演示" class="headerlink" title="3.1.4.3    演示"></a>3.1.4.3    演示</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示类的多态性</span></span><br><span class="line">Super<span class="built_in">UIView</span> *tmpView = [[Sub<span class="built_in">UIView1</span> alloc]init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br><span class="line"></span><br><span class="line">tmpView = [[Sub<span class="built_in">UIView2</span> alloc] init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br></pre></td></tr></table></figure>
<h3 id="3-1-5-动画中的模块化设计"><a href="#3-1-5-动画中的模块化设计" class="headerlink" title="3.1.5    动画中的模块化设计"></a>3.1.5    动画中的模块化设计</h3><blockquote>
<p><strong>说明：</strong>模块化设计在开发中非常重要，拆分成小颗粒的模块非常便于代码的维护<br><strong>要点：</strong></p>
<ul>
<li>动画效果实现难度的判断</li>
<li>将看到的动画效果查分成小模块</li>
<li>将写好的小模块组合成你所需要的动画效果</li>
</ul>
</blockquote>
<h4 id="3-1-5-1-子模块"><a href="#3-1-5-1-子模块" class="headerlink" title="3.1.5.1    子模块"></a>3.1.5.1    子模块</h4><p><em>LineUIView.h、CircleUIView.h、RectUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m、CircleUIView.m、RectUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="3-1-5-2-组合使用"><a href="#3-1-5-2-组合使用" class="headerlink" title="3.1.5.2    组合使用"></a>3.1.5.2    组合使用</h4><p><em>BaseAnimationView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BaseAnimationView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BaseAnimationView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RectUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Circle<span class="built_in">UIView</span> *circleView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BaseAnimationView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView show];</span><br><span class="line">    [<span class="keyword">self</span>.lineView show];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView hide];</span><br><span class="line">    [<span class="keyword">self</span>.lineView hide];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;</span><br><span class="line">    <span class="keyword">self</span>.circleView = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.circleView];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.lineView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS模糊效果的使用"><a href="#3-2-iOS模糊效果的使用" class="headerlink" title="3.2    iOS模糊效果的使用"></a>3.2    iOS模糊效果的使用</h2><blockquote>
<p><strong>背景：</strong>在项目开发中，使用模糊效果或许是很多开发者并不愿意接触的东西，因为大部分都是从开源代码里获取到的代码片段，并不一定理解别人的设计思路，此时要最大程度的修改来符合自己的项目需求并不容易。本课程我将会带领大家来定制出自己需要的模糊效果，理解设计的原理，并根据不同的需求设计出符合我们期望的效果。<br><strong>要点：</strong></p>
<ol>
<li>CoreImage 中的模糊滤镜</li>
<li>UIImage+ImageEffects 的 category 模糊效果</li>
<li>iOS8 中 UIVisualEffectView 模糊效果的使用</li>
<li>设计下载图片后自动模糊的控件</li>
</ol>
</blockquote>
<h3 id="3-2-1-CoreImage中的模糊滤镜"><a href="#3-2-1-CoreImage中的模糊滤镜" class="headerlink" title="3.2.1    CoreImage中的模糊滤镜"></a>3.2.1    CoreImage中的模糊滤镜</h3><blockquote>
<p><strong>要点：</strong></p>
<ul>
<li><code>CoreImage</code>是苹果用来简化图片处理的框架</li>
<li><code>CIImage</code>、<code>CIFilter</code>与<code>CIContext</code>三者之间的联系</li>
<li><code>CIGaussianBlur</code>中可以设置的参数<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%881.08.34.png" alt="Alt text|200x400"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1. 原始图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"sourceImage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. coreImage部分</span></span><br><span class="line"><span class="comment">/*------- coreImage 部分 ------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CIImage - 将 UIImage 包装为 CIImage 才可以用于滤镜</span></span><br><span class="line"><span class="built_in">CIImage</span> *ciImage = [[<span class="built_in">CIImage</span> alloc]initWithImage:image];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIFilter － 滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *blurFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看滤镜可以设置的参数以及一些相关的信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [blurFilter attributes]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片输入到滤镜中</span></span><br><span class="line">[blurFilter setValue:ciImage forKey:k<span class="built_in">CIInputImageKey</span>];<span class="comment">//  KVC方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模糊程度(0-100)</span></span><br><span class="line">[blurFilter setValue:@(<span class="number">3</span>) forKey:<span class="string">@"inputRadius"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将处理好的图片输出为 CIImage</span></span><br><span class="line"><span class="built_in">CIImage</span> *outCiImage = [blurFilter valueForKey:k<span class="built_in">CIOutputImageKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIContext</span></span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRef</span> <span class="keyword">out</span><span class="built_in">CGImage</span> = [context create<span class="built_in">CGImage</span>:outCiImage fromRect:[outCiImage extent]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终获取的图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *blurImage = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:<span class="keyword">out</span><span class="built_in">CGImage</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(<span class="keyword">out</span><span class="built_in">CGImage</span>);</span><br><span class="line"><span class="comment">/*-----------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 初始化UIImageView</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">590</span> / <span class="number">2.</span>f, <span class="number">988</span> / <span class="number">2.</span>f)];</span><br><span class="line">imageView.image = blurImage;</span><br><span class="line">imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-UIImage-ImageEffects的category模糊效果"><a href="#3-2-2-UIImage-ImageEffects的category模糊效果" class="headerlink" title="3.2.2    UIImage + ImageEffects的category模糊效果"></a>3.2.2    UIImage + ImageEffects的category模糊效果</h3><blockquote>
<p><strong>说明：</strong>苹果官方提供了一段无论是性能还是效果都更优的实现图片模糊效果的代码。在此基础上封装的库在以下地址可以拿到<br><a href="https://github.com/YouXianMing/UIImageBlur" target="_blank" rel="external">https://github.com/YouXianMing/UIImageBlur</a></p>
<ul>
<li>性能更好</li>
<li>可以局部模糊</li>
<li>更加易用<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%8810.02.55.png" alt="Alt text|200x350"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 原始图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *sourceImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对图片进行模糊</span></span><br><span class="line">    <span class="built_in">UIImage</span> *blurImage = [sourceImage blurImageAtFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, sourceImage.size.width, sourceImage.size.height / <span class="number">2.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:blurImage];</span><br><span class="line">    imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="keyword">self</span>.view.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-iOS8种UIVisualEffectView模糊效果的使用"><a href="#3-2-3-iOS8种UIVisualEffectView模糊效果的使用" class="headerlink" title="3.2.3    iOS8种UIVisualEffectView模糊效果的使用"></a>3.2.3    iOS8种UIVisualEffectView模糊效果的使用</h3><blockquote>
<p><strong>说明：</strong><code>UIVisyalEffectView</code>的模糊效果是即时渲染的，效率非常高<br><strong>注意：</strong>在<code>UIVisualEffectView</code>之上的文本显示需要特殊处理<br><strong>兼容性：</strong><code>iOS8+</code><br><strong>案例：</strong><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_effective.gif" alt="Alt text|100x100"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--- 1. 环境 ----*/</span></span><br><span class="line"><span class="comment">// 1.1 图片</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 展示视图（UIScrollView）：用以显示动态模糊</span></span><br><span class="line"><span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line"><span class="keyword">self</span>.scrollView.contentSize = imageView.image.size;<span class="comment">// 展现视图和图片大小一致</span></span><br><span class="line"><span class="keyword">self</span>.scrollView.bounces = <span class="literal">NO</span>;<span class="comment">// 无边缘反弹效果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 将图片添加到展示视图</span></span><br><span class="line">[<span class="keyword">self</span>.scrollView addSubview:imageView];</span><br><span class="line"><span class="comment">// 1.4 将展示视图添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--- 2. 添加模糊视图 ---*/</span></span><br><span class="line"><span class="comment">// 2.1 创建模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *effecView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>]];</span><br><span class="line"><span class="comment">// 2.2 设置尺寸（动态模糊区域）</span></span><br><span class="line">effecView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>);</span><br><span class="line"><span class="comment">// 2.3 添加到 view</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:effecView];</span><br><span class="line"><span class="comment">/*------ 3. 子模糊视图（文本） ------*/</span></span><br><span class="line"><span class="comment">// 3.1  添加显示文本</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:effecView.bounds];</span><br><span class="line">label.text = <span class="string">@"时代精神"</span>;</span><br><span class="line">label.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">50.</span>f];</span><br><span class="line">label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line"><span class="comment">// 3.2  创建子模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *subEffectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIVibrancyEffect</span> effectForBlurEffect:(<span class="built_in">UIBlurEffect</span> *)effecView.effect]];</span><br><span class="line"><span class="comment">// 3.3  尺寸</span></span><br><span class="line">subEffectView.frame = effecView.bounds;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.4  将子模糊view添加到effectView的contentView才能够生效</span></span><br><span class="line">[effecView.contentView addSubview:subEffectView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.5  添加文本（此时文本会个模糊视图融合得比较好）</span></span><br><span class="line">[subEffectView.contentView addSubview:label];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-设计下载图片后自动模糊的控件"><a href="#3-2-4-设计下载图片后自动模糊的控件" class="headerlink" title="3.2.4    设计下载图片后自动模糊的控件"></a>3.2.4    设计下载图片后自动模糊的控件</h3><blockquote>
<p><strong>说明：</strong>将下载下来的图片自动模糊的控件。<br><strong>要点：</strong></p>
<ul>
<li>KVO监听下载完成后的事件</li>
<li>在子线程中进行渲染，主线程中进行图片的下载 （提升性能）</li>
</ul>
<p><strong>GDC：</strong><a href="https://github.com/YouXianMing/GCD-Program" target="_blank" rel="external">https://github.com/YouXianMing/GCD-Program</a></p>
</blockquote>
<h4 id="3-2-4-1-控件实现"><a href="#3-2-4-1-控件实现" class="headerlink" title="3.2.4.1    控件实现"></a>3.2.4.1    控件实现</h4><blockquote>
<p><strong>依赖:</strong><code>GDC</code>和<code>UIImage+ImageEffects</code></p>
</blockquote>
<p><em>BlurDownloadPicView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *pictureUrlString;<span class="comment">// 图片下载地址</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIViewContentMode</span> contentMode;<span class="comment">// 图片显示的方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始执行</span></span><br><span class="line">- (<span class="keyword">void</span>)startProgress;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BlurDownloadPicView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GCD.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BlurDownloadPicView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化控件</span></span><br><span class="line">        <span class="keyword">self</span>.imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="keyword">self</span>.imageView.alpha = <span class="number">0.</span>f;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startProgress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.pictureUrlString) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在子线程中执行下载图片的过程</span></span><br><span class="line">        [GCDQueue executeInGlobalQueue:^&#123;</span><br><span class="line">            <span class="comment">// 创建请求</span></span><br><span class="line">            <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.pictureUrlString]];</span><br><span class="line">            <span class="comment">// 获取数据(因为是同步请求，会阻塞主线程)</span></span><br><span class="line">            <span class="built_in">NSData</span> *data = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request</span><br><span class="line">                                                 returningResponse:<span class="literal">nil</span></span><br><span class="line">                                                             error:<span class="literal">nil</span>];</span><br><span class="line">            <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">UIImage</span> *blurImage = [image blurImage];</span><br><span class="line">            </span><br><span class="line">            [GCDQueue executeInMainQueue:^&#123;</span><br><span class="line">                <span class="comment">// 在主线程中加载图片</span></span><br><span class="line">                <span class="keyword">self</span>.imageView.image = blurImage;</span><br><span class="line">                <span class="comment">// 动画效果：淡出</span></span><br><span class="line">                [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">                    <span class="keyword">self</span>.imageView.alpha = <span class="number">1.</span>f;</span><br><span class="line">                &#125;];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> contentMode = _contentMode;</span><br><span class="line">- (<span class="keyword">void</span>)setContentMode:(<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    _contentMode = contentMode;</span><br><span class="line">    <span class="keyword">self</span>.imageView.contentMode = contentMode;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    <span class="keyword">return</span> _contentMode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-4-2-使用"><a href="#3-2-4-2-使用" class="headerlink" title="3.2.4.2    使用"></a>3.2.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *picUrlString = <span class="string">@"http://img.zcool.cn/community/0207a4570363fc6ac7257948ec0f00.jpg@800w_1l_2o"</span>;<span class="comment">// 下载地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建模糊视图</span></span><br><span class="line">    BlurDownloadPicView *blurDownloadView = [[BlurDownloadPicView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">400</span>)];</span><br><span class="line">    blurDownloadView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    blurDownloadView.pictureUrlString = picUrlString;</span><br><span class="line">    blurDownloadView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:blurDownloadView];</span><br><span class="line">    <span class="comment">// 下载图片 模糊图片 呈现</span></span><br><span class="line">    [blurDownloadView startProgress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-使用-maskView-设计动画"><a href="#3-3-使用-maskView-设计动画" class="headerlink" title="3.3    使用 maskView 设计动画"></a>3.3    使用 maskView 设计动画</h2><h3 id="3-3-1-maskView-maskLayer-的基本原理"><a href="#3-3-1-maskView-maskLayer-的基本原理" class="headerlink" title="3.3.1    maskView(maskLayer)的基本原理"></a>3.3.1    maskView(maskLayer)的基本原理</h3><blockquote>
<p><strong>说明：</strong>本课时主要讲解 <code>maskView(maskLayer)</code>的基本原理，并用示例演示。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-06%20%E4%B8%8B%E5%8D%883.14.40.png" alt="Alt text|100x200"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> width = <span class="number">120</span>;</span><br><span class="line"><span class="comment">// 情形1. 只有底图的情形</span></span><br><span class="line"><span class="keyword">self</span>.baseImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.baseImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形2. 只有mask（png图片）</span></span><br><span class="line"><span class="keyword">self</span>.maskImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + width + <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.maskImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形3. 底图通过maskView组合mask</span></span><br><span class="line"><span class="comment">// 底图</span></span><br><span class="line"><span class="keyword">self</span>.addImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + (width + <span class="number">20</span>) * <span class="number">2</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.addImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// mask</span></span><br><span class="line"><span class="built_in">UIImageView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, width)];</span><br><span class="line">mask.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"><span class="comment">// 在底图上设置maskView</span></span><br><span class="line"><span class="keyword">self</span>.addImageView.maskView = mask;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.baseImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.maskImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addImageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-maskView配合-CAGradientLayer的使用"><a href="#3-3-2-maskView配合-CAGradientLayer的使用" class="headerlink" title="3.3.2    maskView配合 CAGradientLayer的使用"></a>3.3.2    maskView配合 CAGradientLayer的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解如何在 maskView 中加载 <code>CAGradientLayer</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_ga.gif" alt="Alt text|100x100"></p>
<p><strong>要点：</strong></p>
<ul>
<li>用<code>CAGradientLayer</code>直接产生带透明像素通道的<code>layer</code></li>
<li>用<code>maskView</code>直接加载带<code>CAGradientLayer</code>的<code>View</code></li>
<li>可以通过<code>CAGradientLayer</code>进行动画的操作实现动画效果</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 底图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>)];</span><br><span class="line">imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. mask (使用 CAGradientLayer 替代 png 图片)</span></span><br><span class="line"><span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">gradientLayer.frame = imageView.bounds;</span><br><span class="line">gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIView</span> *containerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:imageView.bounds];</span><br><span class="line">[containerView.layer addSublayer:gradientLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. set maskView</span></span><br><span class="line">imageView.maskView = containerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 maskView 做动画效果</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 新位置</span></span><br><span class="line">    <span class="built_in">CGRect</span> frame = containerView.frame;</span><br><span class="line">    frame.origin.x += <span class="number">400</span>;</span><br><span class="line">    containerView.frame = frame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-maskView-配合带-alpha-通道图片的使用"><a href="#3-3-3-maskView-配合带-alpha-通道图片的使用" class="headerlink" title="3.3.3    maskView 配合带 alpha 通道图片的使用"></a>3.3.3    maskView 配合带 alpha 通道图片的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>maskView</code> 加载 <code>png</code> 图片的原理。</p>
<ul>
<li>直接使用带<code>alpha</code>通道的<code>png</code>图片比用<code>CAGradientLayer</code>的方式更加高效</li>
<li>可以使用技巧在<code>maskView</code>上添加多张图片</li>
<li>在<code>maskView</code>中做简单的动画</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text|100x100"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遮罩图片1</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picOne = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line">picOne.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮罩图片2</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picTwo = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">-200</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line"></span><br><span class="line">picTwo.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *backgroundView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">backgroundView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"background"</span>];</span><br><span class="line">backgroundView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待切换目标背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *baseView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:backgroundView.frame];</span><br><span class="line">baseView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为带切换图 set maskView</span></span><br><span class="line"><span class="built_in">UIView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:baseView.bounds];</span><br><span class="line"><span class="comment">// 两个png图片合成新遮罩</span></span><br><span class="line">[mask addSubview:picOne];</span><br><span class="line">[mask addSubview:picTwo];</span><br><span class="line">baseView.maskView = mask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:backgroundView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:baseView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 偏移左半边的遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> oneFrame = picOne.frame;</span><br><span class="line">    oneFrame.origin.y -= <span class="number">400</span>;</span><br><span class="line">    picOne.frame = oneFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 偏移右半边遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> twoFrame = picTwo.frame;</span><br><span class="line">    twoFrame.origin.y += <span class="number">400</span>;</span><br><span class="line">    picTwo.frame = twoFrame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-设计文本横向渐变消失的控件"><a href="#3-3-4-设计文本横向渐变消失的控件" class="headerlink" title="3.3.4    设计文本横向渐变消失的控件"></a>3.3.4    设计文本横向渐变消失的控件</h3><blockquote>
<p><strong>说明：</strong>本课时将综合前面所学内容设计一个效果不错的文本渐变消失的控件，并做简易的扩展设计。</p>
<ul>
<li>接口的设计</li>
<li>封装<code>CAGradientLayer</code>用以提供<code>mask</code>遮罩</li>
<li>动画样式的分析与设计</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_text.gif" alt="Alt text"></p>
<h4 id="3-3-4-1-文本横向渐变消失的控件"><a href="#3-3-4-1-文本横向渐变消失的控件" class="headerlink" title="3.3.4.1    文本横向渐变消失的控件"></a>3.3.4.1    文本横向渐变消失的控件</h4><p><em>FadeStrinUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示的文本</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从左到右渐变消失</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 动画持续时间</span><br><span class="line"> *  @param animated 是否显示动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeStringUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *mask;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeStringUIView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 创建文本</span></span><br><span class="line">        [<span class="keyword">self</span> createLabel:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="comment">// 创建mask</span></span><br><span class="line">        [<span class="keyword">self</span> createMask:<span class="keyword">self</span>.bounds];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.mask.frame;</span><br><span class="line">    frame.origin.x += frame.size.width;</span><br><span class="line">    <span class="keyword">if</span> (animated) &#123;</span><br><span class="line"></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createLabel:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span>.label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:frame];</span><br><span class="line">    <span class="keyword">self</span>.label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20.</span>f];</span><br><span class="line">    <span class="keyword">self</span>.label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    <span class="keyword">self</span>.label.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.label];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createMask:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="comment">// 创建出渐变的layer</span></span><br><span class="line">    <span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    gradientLayer.frame = frame;</span><br><span class="line">    gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">    gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.1</span>), @(<span class="number">0.9</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">    gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.mask = [[<span class="built_in">UIView</span> alloc] initWithFrame:frame];</span><br><span class="line">    [<span class="keyword">self</span>.mask.layer addSublayer:gradientLayer];</span><br><span class="line">    <span class="keyword">self</span>.maskView = <span class="keyword">self</span>.mask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 重写 text 的set和get， 该值被修改时同时更新到 label</span></span><br><span class="line"><span class="keyword">@synthesize</span> text = _text;</span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    _text = text;</span><br><span class="line">    <span class="keyword">self</span>.label.text = text;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">return</span> _text;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-2-使用该控件"><a href="#3-3-4-2-使用该控件" class="headerlink" title="3.3.4.2    使用该控件"></a>3.3.4.2    使用该控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 创建 FadeStringUIView 实例</span></span><br><span class="line">    FadeString<span class="built_in">UIView</span> *fadeString = [[FadeString<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">100</span>)];</span><br><span class="line">    fadeString.text = <span class="string">@"如果一个人不按照他想的方式活，那么很快就会按照他活的方式想。"</span>;</span><br><span class="line">    fadeString.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:fadeString];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行动画效果</span></span><br><span class="line">    [fadeString fadeRightWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-4-使用-Facebook-开源动画库-POP-实现"><a href="#3-4-使用-Facebook-开源动画库-POP-实现" class="headerlink" title="3.4    使用 Facebook 开源动画库 POP 实现"></a>3.4    使用 Facebook 开源动画库 POP 实现</h2><blockquote>
<p><strong>课程说明：</strong><code>POP</code> 动画库是 <code>Facebook</code> 在 2014 年开源出来的一个高效的动画引擎，它与 <code>CoreAnimation</code> 的实现机制有着巨大区别，但使用方式极为相似，其动画效果逼真而优美，虽无法完全替换 <code>CoreAnimation</code>，但掌握它，将会使你的应用的交互效果惊艳而脱颖而出。<br><strong>Github地址：</strong><a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a></p>
</blockquote>
<h3 id="3-4-1-POP动画引擎简介"><a href="#3-4-1-POP动画引擎简介" class="headerlink" title="3.4.1    POP动画引擎简介"></a>3.4.1    <code>POP</code>动画引擎简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时示例演示 <code>POP</code> 动画的强大之处，讲解 <code>CADisplayLink</code> 的作用，以及 <code>POP</code> 动画引擎与 <code>CoreAnimation</code> 之间的联系。</p>
<ol>
<li>pop动画引擎是Facebook公司开源的</li>
<li>pop动画引擎主要实现了真实物理系的动画效果（弹簧效果与衰减效果）</li>
<li>pop动画引擎的动画效果非常流畅，因为它是用了<code>CADisplayLink</code>来刷新画面（帧）</li>
<li>pop动画引擎自成体系，与系统的<code>CoreAnimation</code>有很大的区别，但使用非常类似</li>
</ol>
</blockquote>
<h4 id="3-4-1-1-POP效果展示"><a href="#3-4-1-1-POP效果展示" class="headerlink" title="3.4.1.1    POP效果展示"></a>3.4.1.1    POP效果展示</h4><h4 id="3-4-1-2-CADisplayLink"><a href="#3-4-1-2-CADisplayLink" class="headerlink" title="3.4.1.2    CADisplayLink"></a>3.4.1.2    CADisplayLink</h4><blockquote>
<p><strong>说明：</strong><code>POP</code>通过<code>CADisplayLink</code>刷新动画的（60帧/秒，同iOS系统本身的刷新频率）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>演示<code>CADisplayLink</code>使用方式，在中端1秒输出60次。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CADisplayLink</span> *displayLink;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> count;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 displayLink</span></span><br><span class="line">    <span class="keyword">self</span>.displayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(displayLinkEvent:)];</span><br><span class="line">    <span class="comment">// 1秒钟后开始刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventOne) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 2秒中后停止刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventTwo) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  每次刷新调用该方法</span><br><span class="line"> *</span><br><span class="line"> *  @param object 对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLinkEvent:(<span class="keyword">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.count ++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"count = %ld"</span>, (<span class="keyword">long</span>)<span class="keyword">self</span>.count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  开始刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventOne</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink addToRunLoop:[<span class="built_in">NSRunLoop</span> currentRunLoop] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  停止刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventTwo</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink invalidate];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-POP动画引擎中Layer与CALayer的联系与区别"><a href="#3-4-2-POP动画引擎中Layer与CALayer的联系与区别" class="headerlink" title="3.4.2    POP动画引擎中Layer与CALayer的联系与区别"></a>3.4.2    <code>POP</code>动画引擎中<code>Layer</code>与<code>CALayer</code>的联系与区别</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>POP</code> 动画中的 Layer 与 <code>CALayer</code> 的一些共性与区别。<br><strong>比较：</strong></p>
<ol>
<li>使用<code>POP</code>动画与使用<code>CALayer</code>动画非常相似</li>
<li><p><code>POP</code>动画的执行没有中间状态：相比POP动画，<code>CALayer</code>动画有中间状态：实际动画角色是立即到达结束时的位置的，中间状态指的是是“虚拟”的动画<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.44.12.png" alt="Alt text"></p>
</li>
<li><p><code>POP</code>动画是对<code>CALayer</code>动画的扩充，但不能实现所有的<code>CALayer</code>的动画效果</p>
</li>
<li><code>POP</code>动画可以作用在任何对象上，不仅仅是<code>CALayer</code></li>
</ol>
<p><strong>其它参考：</strong></p>
<ul>
<li><a href="http://www.cocoachina.com/industry/20140527/8565.html" target="_blank" rel="external">http://www.cocoachina.com/industry/20140527/8565.html</a></li>
</ul>
<p><strong>实例：</strong></p>
<ol>
<li>导入<code>POP</code>框架(<a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a>)<blockquote>
<p><strong>方式1：</strong>使用<a href="http://www.jianshu.com/p/071d30a3af02" target="_blank" rel="external">cocoapods</a>安装<br><strong>方式2：</strong>直接导入源码（可以配合<code>pch</code>文件）<br>教程：<a href="http://www.jianshu.com/p/67ce72c4ad6c" target="_blank" rel="external">http://www.jianshu.com/p/67ce72c4ad6c</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.53.54.png" alt="Alt text"><br><strong>方式3：</strong>二进制文件<code>.framework</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<h4 id="3-4-2-1-导入POP框架"><a href="#3-4-2-1-导入POP框架" class="headerlink" title="3.4.2.1    导入POP框架"></a>3.4.2.1    导入<code>POP</code>框架</h4><blockquote>
<p><strong>说明：</strong>使用<code>CocoaPods</code><br><strong>可能的出错：</strong><a href="http://www.tuicool.com/articles/InIBbaf" target="_blank" rel="external">http://www.tuicool.com/articles/InIBbaf</a><br><strong>注意：</strong>安装好依赖后，需要从<code>项目名.xcworkspace</code>重启项目。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ pod search pop<span class="comment"># 搜索版本号</span></span><br><span class="line">$ <span class="built_in">cd</span> /Users/tonyearth/Documents/My Study/Animation/L04POP动画引擎中Layer与CALayer的联系与区别 <span class="comment">#到项目目录下</span></span><br><span class="line">$ pod init<span class="comment"># 初始化环境</span></span><br><span class="line">$ vim Podfile<span class="comment"># 依赖配置</span></span><br><span class="line">	platform :ios, <span class="string">'7.0'</span></span><br><span class="line">	pod <span class="string">'pop'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line">$ pod install<span class="comment"># 安装依赖</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-1-比较CALayer和POP-CAlayer"><a href="#3-4-2-1-比较CALayer和POP-CAlayer" class="headerlink" title="3.4.2.1    比较CALayer和POP CAlayer"></a>3.4.2.1    比较CALayer和POP CAlayer</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_pop.gif" alt="Alt text|150x200"></p>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *normal<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *pop<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理 normalCALayer</span></span><br><span class="line">    [<span class="keyword">self</span> accessNormal<span class="built_in">CALayer</span>];</span><br><span class="line">    <span class="comment">// 处理 POP 动画</span></span><br><span class="line">    [<span class="keyword">self</span> accessPOP<span class="built_in">CALayer</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - pop CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  pop CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessPOP<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.popCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.popCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 POP 动画</span></span><br><span class="line">    POPBasicAnimation *popAnimation = \</span><br><span class="line">    [POPBasicAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">    popAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">100</span> + <span class="number">50</span>, <span class="number">400</span>)];<span class="comment">// pop 动画不需要 fromValue</span></span><br><span class="line">    popAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    popAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_addAnimation:popAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：在哪儿移除就停在哪儿</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removePopAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1.5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removePopAnimation</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_removeAllAnimations];<span class="comment">// 移除所有 pop 动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessNormal<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.normalCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *baseAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    baseAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.normalCALayer.position];</span><br><span class="line">    baseAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>)];</span><br><span class="line">        baseAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    baseAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置结束位置的值</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.position = <span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>);</span><br><span class="line">    <span class="comment">// 开始动画</span></span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer addAnimation:baseAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：无论在哪儿停止，都会出现在最后设置的位置（非常突兀）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removeNormalAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNormalAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = <span class="keyword">self</span>.normalCALayer.presentationLayer;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(layer.frame));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(<span class="keyword">self</span>.normalCALayer.frame));</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer removeAllAnimations];<span class="comment">// 移除掉所有动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-用POP动画引擎实现衰减动画"><a href="#3-4-3-用POP动画引擎实现衰减动画" class="headerlink" title="3.4.3    用POP动画引擎实现衰减动画"></a>3.4.3    用<code>POP</code>动画引擎实现衰减动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现移动<code>View</code> 并停止时衰减的动画效果。<br><strong>要点：</strong></p>
<ol>
<li>衰减动画由<code>POPDecayAnimation</code>来实现</li>
<li>需要精确计算停止运动瞬间的加速度才能用衰减动画做出真实的效果</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_decay.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *button;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化button</span></span><br><span class="line">    <span class="keyword">self</span>.button = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.button.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.button.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.button];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [<span class="keyword">self</span>.button addTarget:<span class="keyword">self</span></span><br><span class="line">                    action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">          forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 初始化手势</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *panGesture = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePanGesture:)];</span><br><span class="line">    <span class="comment">// 添加手势</span></span><br><span class="line">    [<span class="keyword">self</span>.button addGestureRecognizer:panGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击按钮取消按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param button 按钮控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    [button.layer pop_removeAllAnimations];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  手势操作的响应函数</span><br><span class="line"> *</span><br><span class="line"> *  @param recognizer 事件目标控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)handlePanGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [recognizer translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    recognizer.view.center = <span class="built_in">CGPointMake</span>(recognizer.view.center.x + translation.x,</span><br><span class="line">                                         recognizer.view.center.y + translation.y);</span><br><span class="line">    [recognizer setTranslation:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>) inView:<span class="keyword">self</span>.view];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拖动停止</span></span><br><span class="line">    <span class="keyword">if</span> (recognizer.state == <span class="built_in">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class="line">        <span class="comment">//1. 创建动画</span></span><br><span class="line">        <span class="comment">// 获取加速度</span></span><br><span class="line">        <span class="built_in">CGPoint</span> velocity = [recognizer velocityInView:<span class="keyword">self</span>.view];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化POP的decay(衰减)动画</span></span><br><span class="line">        POPDecayAnimation *decayAnimation = \</span><br><span class="line">            [POPDecayAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">        <span class="comment">// 设置加速度</span></span><br><span class="line">        decayAnimation.velocity = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:velocity];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 执行动画</span></span><br><span class="line">        [recognizer.view.layer pop_addAnimation:decayAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-用POP动画引擎实现弹簧动画"><a href="#3-4-4-用POP动画引擎实现弹簧动画" class="headerlink" title="3.4.4    用POP动画引擎实现弹簧动画"></a>3.4.4    用<code>POP</code>动画引擎实现弹簧动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现 View 的放大缩小等的弹簧效果。<br><strong>扩展：</strong><code>Shimmer</code><br><strong>要点：</strong></p>
<ol>
<li>弹簧动画由<code>POPSpringAnimation</code></li>
<li>弹簧的质量、速度、时间等值都是可以设置的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_spring.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置背景色</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 延时3秒执行动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(startSpringAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例弹簧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)startSpringAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化spring动画</span></span><br><span class="line">    POPSpringAnimation *sizeAnimation = \</span><br><span class="line">    [POPSpringAnimation animationWithPropertyNamed:kPOPLayerBounds];<span class="comment">// 缩放型动画</span></span><br><span class="line">    sizeAnimation.springSpeed = <span class="number">0.</span>f;</span><br><span class="line">    sizeAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.showView pop_addAnimation:sizeAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-5-用缓动函数模拟物理动画"><a href="#3-5-用缓动函数模拟物理动画" class="headerlink" title="3.5    用缓动函数模拟物理动画"></a>3.5    用缓动函数模拟物理动画</h2><h3 id="3-5-1-缓动函数简介"><a href="#3-5-1-缓动函数简介" class="headerlink" title="3.5.1    缓动函数简介"></a>3.5.1    缓动函数简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时将演示缓动函数能做出来的效果，然后讲解它的基本原理。</p>
<ol>
<li>缓动函数的动画效果是建立在<code>CALayer</code>层级的关键帧动画基础之上</li>
<li>缓动函数是一系列模拟物理效果（如抛物线）方程式的统称，用以计算给定亮点之间的插值</li>
<li>两点之间插的值越多，效果越好，但是会耗费更多的性能</li>
<li>只有理解了缓动函数的原理才有可能写出自己想要的效果</li>
</ol>
<p><strong>缓动函数源码：</strong><a href="https://github.com/YouXianMing/EasingAnimation" target="_blank" rel="external">https://github.com/YouXianMing/EasingAnimation</a></p>
</blockquote>
<h4 id="3-5-1-1-缓动函数类型"><a href="#3-5-1-1-缓动函数类型" class="headerlink" title="3.5.1.1    缓动函数类型"></a>3.5.1.1    缓动函数类型</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-09%20%E4%B8%8B%E5%8D%8810.52.45.png" alt="Alt text"></p>
<h4 id="3-5-1-2-缓动效果示例"><a href="#3-5-1-2-缓动效果示例" class="headerlink" title="3.5.1.2    缓动效果示例"></a>3.5.1.2    缓动效果示例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_easing.gif" alt="Alt text"></p>
<h3 id="3-5-2-缓动函数与关键帧动画的联系"><a href="#3-5-2-缓动函数与关键帧动画的联系" class="headerlink" title="3.5.2    缓动函数与关键帧动画的联系"></a>3.5.2    缓动函数与关键帧动画的联系</h3><blockquote>
<p><strong>课程说明：</strong>本课时将讲解关键帧动画的原理，并分析关键帧动画与缓动函数之间的联系。</p>
<ol>
<li>关键帧动画需要提供很多的帧来完善动画效果</li>
<li>关键帧动画的帧可以通过一定的数学计算来提供需要的帧数</li>
<li><code>关键帧动画只需要提供起始点、结束点，就可以通过缓动函数来计算中间“缺失”的帧</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-10%20%E4%B8%8B%E5%8D%8812.00.12.png" alt="Alt text"></li>
<li>缓动函数可以指定计算出多少帧</li>
<li>帧数越多，动画越流畅，但同时耗费更多GPU性能</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>缓动动画只是缓动函数在关键帧动画中的一种应用</li>
<li>当只插值只有起点和终点时，关键帧动画和基本动画效果一致</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化显示用的view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本动画</span></span><br><span class="line">    <span class="comment">// [self baseAnimation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关键帧动画</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  基本动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)baseAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *basicAnimation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    basicAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    basicAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    <span class="comment">// fromValue = A, toValue = B</span></span><br><span class="line">    basicAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.showView.center];</span><br><span class="line">    basicAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:basicAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  关键帧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    <span class="comment">// 插值（通过缓动函数创建一些列插值点）</span></span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromPoint:<span class="keyword">self</span>.showView.center<span class="comment">// 起点</span></span><br><span class="line">                                                         toPoint:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)<span class="comment">//终点</span></span><br><span class="line">                                                            func:BounceEaseIn<span class="comment">// 动画进度</span></span><br><span class="line">                                                      frameCount:<span class="number">60</span> * <span class="number">2</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="comment">// 2. 实际目标位置</span></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加动画到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-用缓动函数模拟弹簧效果"><a href="#3-5-3-用缓动函数模拟弹簧效果" class="headerlink" title="3.5.3    用缓动函数模拟弹簧效果"></a>3.5.3    用缓动函数模拟弹簧效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数结合关键帧动画实现弹簧效果，并模拟秒表摆动效果。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_time.gif" alt="Alt text|100x90"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *secLayer;<span class="comment">// 秒针</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个表盘 UIView</span></span><br><span class="line">    <span class="built_in">UIView</span> *showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    showView.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    showView.layer.cornerRadius = <span class="number">150</span>;</span><br><span class="line">    showView.layer.borderColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建出秒针 CALayer</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.secLayer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">150</span>, <span class="number">150</span>, <span class="number">1</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.backgroundColor = [<span class="built_in">UIColor</span> blackColor].CGColor;</span><br><span class="line">    [showView.layer addSublayer:<span class="keyword">self</span>.secLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f<span class="comment">// 1秒钟调用一次</span></span><br><span class="line">                                                  target:<span class="keyword">self</span><span class="comment">// 目标控制器</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent) <span class="comment">// 目标方法</span></span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  指针变化动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">1</span>;<span class="comment">// 时间点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> oldValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i++);<span class="comment">// 旧弧度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> newValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i);<span class="comment">// 新弧度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"transform.rotation.z"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">0.5</span>;</span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromValue:oldValue<span class="comment">// 起始弧度</span></span><br><span class="line">                                                         toValue:newValue<span class="comment">// 结束弧度</span></span><br><span class="line">                                                            func:ElasticEaseOut <span class="comment">// 动画效果</span></span><br><span class="line">                                                      frameCount:<span class="number">0.5</span> * <span class="number">30</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer.transform = <span class="built_in">CATransform3DMakeRotation</span>(newValue,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">1</span>);</span><br><span class="line">    [<span class="keyword">self</span>.secLayer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-4-用缓动函数模拟碰撞效果"><a href="#3-5-4-用缓动函数模拟碰撞效果" class="headerlink" title="3.5.4    用缓动函数模拟碰撞效果"></a>3.5.4    用缓动函数模拟碰撞效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现碰撞动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutBounce</code>函数来创建碰撞效果</li>
<li>将<code>easeOutBounce</code>创建出来的帧数组添加到关键帧动画中</li>
<li>碰撞效果用途</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_bounce.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 创建图 view</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">100</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    imageView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画（移动距离的动画）</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>)</span><br><span class="line">                                     func:BounceEaseOut<span class="comment">// 碰撞动画</span></span><br><span class="line">                               frameCount:<span class="number">2</span> * <span class="number">30</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation</span><br><span class="line">                           forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-用缓动函数模拟衰减效果"><a href="#3-5-5-用缓动函数模拟衰减效果" class="headerlink" title="3.5.5    用缓动函数模拟衰减效果"></a>3.5.5    用缓动函数模拟衰减效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现衰减动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutCubic</code>函数来创建弹簧效果</li>
<li>将<code>easeOutCubic</code>创建出来的的帧数组添加到关键帧动画中</li>
<li>衰减效果用途</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_cubic.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画1:背景变暗</span></span><br><span class="line">    <span class="built_in">UIView</span>  *backView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    backView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">        backView.alpha = <span class="number">0.3</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:backView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画2:衰减滑出</span></span><br><span class="line">    <span class="comment">// 创建图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">320</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">568</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y)</span><br><span class="line">                                     func:CubicEaseOut</span><br><span class="line">                               frameCount:<span class="number">1</span> * <span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-使用带粒子效果的-CAEmitterLayer"><a href="#3-6-使用带粒子效果的-CAEmitterLayer" class="headerlink" title="3.6    使用带粒子效果的 CAEmitterLayer"></a>3.6    使用带粒子效果的 CAEmitterLayer</h2><h3 id="3-6-1-用-CAEmitterLayer-产生粒子效果"><a href="#3-6-1-用-CAEmitterLayer-产生粒子效果" class="headerlink" title="3.6.1    用 CAEmitterLayer 产生粒子效果"></a>3.6.1    用 CAEmitterLayer 产生粒子效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>CAEmitterLayer</code> 的一些基本属性，以及基本的用法。</p>
<ul>
<li><code>CAEmitterLayer</code>的用途：实现粒子效果</li>
<li><code>CAEmitterLayer</code>参数</li>
<li><code>CAEmitterLayer</code>优点：使用<code>GPU</code>渲染，不占用<code>CPU</code>资源，远优于使用大量的随机<code>View</code>来实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_emitter.gif" alt="Alt text"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. CAEmitterLayer</span></span><br><span class="line"><span class="comment">// 创建出粒子发射图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayer</span> *emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</span><br><span class="line">emitterLayer.borderWidth = <span class="number">2.</span>f;<span class="comment">// 边框宽度（显示边框）</span></span><br><span class="line">emitterLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>);<span class="comment">// 设置尺寸</span></span><br><span class="line">emitterLayer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏溢出的粒子</span></span><br><span class="line">emitterLayer.emitterPosition = <span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">50</span>);<span class="comment">// 发射点</span></span><br><span class="line">emitterLayer.emitterMode = k<span class="built_in">CAEmitterLayerSurface</span>;<span class="comment">// 发射模式</span></span><br><span class="line">emitterLayer.emitterShape = k<span class="built_in">CAEmitterLayerLine</span>;<span class="comment">// 发射形状</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加图层到当前视图图层</span></span><br><span class="line">[<span class="keyword">self</span>.view.layer addSublayer:emitterLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. CAEmitterCell（粒子）</span></span><br><span class="line"><span class="built_in">CAEmitterCell</span> *cell = [<span class="built_in">CAEmitterCell</span> emitterCell];</span><br><span class="line">cell.birthRate = <span class="number">10.</span>f;<span class="comment">// 粒子产生率</span></span><br><span class="line">cell.lifetime = <span class="number">120.</span>f;<span class="comment">// 粒子声明周期</span></span><br><span class="line">cell.velocity = <span class="number">30</span>;<span class="comment">// 加速度</span></span><br><span class="line">cell.velocityRange = <span class="number">10.</span>f;<span class="comment">// 加速度微调</span></span><br><span class="line">cell.yAcceleration = <span class="number">2.</span>f;<span class="comment">// y 轴加速度</span></span><br><span class="line">cell.emissionRange = <span class="number">0.5</span> * M_1_PI;<span class="comment">// 发射角度</span></span><br><span class="line">cell.color = [<span class="built_in">UIColor</span> blackColor].CGColor;<span class="comment">// 设置粒子颜色</span></span><br><span class="line">cell.contents = (__bridge <span class="keyword">id</span>)([<span class="built_in">UIImage</span> imageNamed:<span class="string">@"snow"</span>].CGImage);<span class="comment">// 设置图片</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将 CAEmitterCell(粒子)关联到CAEmitterLayer</span></span><br><span class="line">emitterLayer.emitterCells = @[cell];</span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-封装-CAEmitterLayerUIVIew"><a href="#3-6-2-封装-CAEmitterLayerUIVIew" class="headerlink" title="3.6.2    封装 CAEmitterLayerUIVIew"></a>3.6.2    封装 CAEmitterLayerUIVIew</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解了为了避免繁琐的设置而将 <code>CAEmitterLayer</code> 封装成一个较为通用的父类供子类使用。</p>
<ul>
<li>替换<code>CAEmitterLayer</code>成<code>UIView</code>子类的<code>backedLayer</code></li>
<li>将<code>CAEmitterLayer</code>封装的类作为“抽象“父类</li>
</ul>
<p><strong>说明：</strong>封装一个父类(<code>CAEmitterLayerUIView</code>)，其它类型的粒子图层继承该类，将设置封装到子类的<code>show</code>和<code>hide</code>实现中。</p>
</blockquote>
<p><em>CAEmitterLayerUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示view</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏view</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CAEmitterLayerUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CAEmitterLayerUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">CAEmitterLayer</span> *_emitterLayer;<span class="comment">// 粒子图层</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CAEmitterLayerUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        _emitterLayer = (<span class="built_in">CAEmitterLayer</span> *)<span class="keyword">self</span>.layer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类本身</span></span><br><span class="line">+ (Class)layerClass</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">CAEmitterLayer</span> class];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer</span><br><span class="line">&#123;</span><br><span class="line">    _emitterLayer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _emitterLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-封装下雪、下雨的粒子效果控件"><a href="#3-6-3-封装下雪、下雨的粒子效果控件" class="headerlink" title="3.6.3    封装下雪、下雨的粒子效果控件"></a>3.6.3    封装下雪、下雨的粒子效果控件</h3><blockquote>
<p><strong>课程说明：</strong>本课时在封装 <code>CAEmitterLayer</code> 基础上进一步从“抽象”父类派生出下雪、下雨的子类控件。</p>
<ul>
<li>从封装<code>CAEmitterLayer</code>的“抽象”父类继承的原因</li>
<li>下雪、下雨效果参数的设置</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_rain.gif" alt="Alt text"></p>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用控件</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 初始化粒子效果图层</span></span><br><span class="line"><span class="comment">// 下雪效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *snowView = [[SnowView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line"><span class="comment">// 下雨效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *rainView = [[RainView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">210</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 模糊化粒子视图边界</span></span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView1 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView1.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"></span><br><span class="line">snowView.maskView = alphaView1;</span><br><span class="line">rainView.maskView = alphaView2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加到当前图层</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:rainView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 展现</span></span><br><span class="line">[snowView show];</span><br><span class="line">[rainView show];</span><br></pre></td></tr></table></figure>
<h2 id="3-7-iOS-中-CAGradientLaueyer-的使用"><a href="#3-7-iOS-中-CAGradientLaueyer-的使用" class="headerlink" title="3.7    iOS 中 CAGradientLaueyer 的使用"></a>3.7    iOS 中 CAGradientLaueyer 的使用</h2><h3 id="3-7-1-CAGradientLayer-简介"><a href="#3-7-1-CAGradientLayer-简介" class="headerlink" title="3.7.1    CAGradientLayer 简介"></a>3.7.1    CAGradientLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课演示 <code>CAGradientLayer</code> 能做的一些动画效果，以及 <code>CAGradientLayer</code> 与 <code>CAShapeLayer</code> 配合使用的实例。</p>
<ol>
<li><code>CAGradientLayer</code>是用于处理渐变色的层结构</li>
<li><code>CAGradientLayer</code>的渐变色可以做隐式动画</li>
<li>大部分情况下，<code>CAGradientLayer</code>都是与<code>CAShapeLayer</code>配合使用的</li>
<li><code>CAGradientLayer</code>可以用作<code>png</code>遮罩效果</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam1.gif" alt="Alt text|100x100"> <code>CAShapeLayer</code>作为<code>CAGradientLayer</code>的遮罩实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam2.gif" alt="Alt text|100x100">旋转<code>CAGradientLayer</code>实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam3.gif" alt="Alt text|100x160"> 色差动画效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam4.gif" alt="Alt text|100x160">作为<code>png</code>图片遮罩动画效果</p>
<h3 id="3-7-2-CAGradientLayer-坐标系统"><a href="#3-7-2-CAGradientLayer-坐标系统" class="headerlink" title="3.7.2    CAGradientLayer 坐标系统"></a>3.7.2    CAGradientLayer 坐标系统</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解 CAGradientLayer 的坐标系统，并延伸讲解了坐标系统影响如何颜色分配、动画效果。</p>
<ol>
<li><code>CAGradientLayer</code>的坐标系统是从坐标（0, 0）到（1, 1）绘制的矩形<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.44.12.png" alt="Alt text|200x180"></li>
<li><code>CAGradientLayer</code>的<code>frame</code>值的<code>size</code>不为正方形的话，坐标系统会被拉伸</li>
<li><code>CAGradientLayer</code>的<code>startPoint</code>与<code>endPoint</code>会直接影响颜色的绘制方向</li>
<li><code>CAGradientLayer</code>的颜色分割线是以0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.45.28.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_gra.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 1. 创建并初始化 CAGradientLayer 实例</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.gradientLayer];<span class="comment">// 添加到视图</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 渐变效果相关设置</span></span><br><span class="line">    <span class="comment">// 颜色</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> greenColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor].CGColor];</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 动画:3秒后修改分割点</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(gradientLayerLocationLocationAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  修改分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)gradientLayerLocationLocationAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 颜色分割点效果</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.5</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-3-色差动画的实现"><a href="#3-7-3-色差动画的实现" class="headerlink" title="3.7.3    色差动画的实现"></a>3.7.3    色差动画的实现</h3><blockquote>
<p><strong>课程说明：</strong>本课用 CAGradientLayer 实现色差动画效果。</p>
<ol>
<li>确定渐变色渐变方向</li>
<li>设定两种颜色，其中一种是透明色，另外一种是自定义颜色</li>
<li>设定好<code>location</code>颜色分割点</li>
<li><code>CAGradientLayer</code>的颜色分割点是0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_colors.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建 UIImage 实例（作为背景）</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>]];</span><br><span class="line">    imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 初始化渐变图层</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = imageView.bounds;</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.5</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 组合背景和渐变图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    [imageView.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 初始化定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                                  target:<span class="keyword">self</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent)</span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  刷新颜色组合分割点，从而制造动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取一组随机产生的颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> colorWithRed:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               green:arc4random() % <span class="number">255</span> /  <span class="number">255.</span>f</span><br><span class="line">                                                                blue:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">    <span class="comment">// 获取随机产生的分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(arc4random() % <span class="number">10</span> / <span class="number">10.</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-4-用-CAGradientLayer-封装带色差动画的-View"><a href="#3-7-4-用-CAGradientLayer-封装带色差动画的-View" class="headerlink" title="3.7.4    用 CAGradientLayer 封装带色差动画的 View"></a>3.7.4    用 CAGradientLayer 封装带色差动画的 View</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解将色差动画效果封装到 View 当中。</p>
<ol>
<li>确定几个属性值</li>
<li>去定意义做动画的参数</li>
<li>重写<code>setter</code>做动画</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_last.gif" alt="Alt text"></p>
<h4 id="3-7-4-1-封装好的视图"><a href="#3-7-4-1-封装好的视图" class="headerlink" title="3.7.4.1    封装好的视图"></a>3.7.4.1    封装好的视图</h4><blockquote>
<p><strong>说明：</strong>将对视图的渐变层的设置工作整合到<code>setter</code>中。</p>
</blockquote>
<p><em>ColorUIImageView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 渐变方向</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    UP,<span class="comment">// 从上至下</span></span><br><span class="line">    DOWN,<span class="comment">// 从下往上</span></span><br><span class="line">    RIGHT,<span class="comment">// 从左到右</span></span><br><span class="line">    LEFT<span class="comment">// 从右往左</span></span><br><span class="line">&#125; EColorDirection;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> : <span class="title">UIImageView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) EColorDirection direction;<span class="comment">// 渐变方向(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;<span class="comment">// 颜色(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> percent;<span class="comment">// 百分比(可以做动画)</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ColorUIImageView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ColorUIImageView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化 CAGradientLayer 实例</span></span><br><span class="line">        <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                      (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">1</span>), @(<span class="number">1</span>)];</span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色组 color</span></span><br><span class="line"><span class="keyword">@synthesize</span> color = _color;</span><br><span class="line">- (<span class="keyword">void</span>)setColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    _color = color;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)color.CGColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渐变方向 direction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> direction = _direction;</span><br><span class="line">- (<span class="keyword">void</span>)setDirection:(EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    _direction = direction;</span><br><span class="line">    <span class="keyword">if</span> (direction == UP) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == DOWN) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == RIGHT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == LEFT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _direction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 分割点 percent</span></span><br><span class="line"><span class="keyword">@synthesize</span> percent = _percent;</span><br><span class="line">- (<span class="keyword">void</span>)setPercent:(<span class="built_in">CGFloat</span>)percent &#123;</span><br><span class="line">    _percent = percent;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(percent), @(<span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _percent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-7-4-2-使用"><a href="#3-7-4-2-使用" class="headerlink" title="3.7.4.2    使用"></a>3.7.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Color<span class="built_in">UIImageView</span> *colorView;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 初始化封装了渐变图层的自定义视图</span></span><br><span class="line">    <span class="keyword">self</span>.colorView        = [[Color<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">198</span>, <span class="number">253</span>)];</span><br><span class="line">    <span class="keyword">self</span>.colorView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.colorView.image  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.colorView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 1秒钟后改变视图</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(event)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">1.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变渐变颜色组、渐变方向和分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)event &#123;</span><br><span class="line">    <span class="keyword">self</span>.colorView.direction = DOWN;</span><br><span class="line">    <span class="keyword">self</span>.colorView.color     = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.colorView.percent   = <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-8-iOS中-CAShapeLayer-的使用"><a href="#3-8-iOS中-CAShapeLayer-的使用" class="headerlink" title="3.8    iOS中 CAShapeLayer 的使用"></a>3.8    iOS中 CAShapeLayer 的使用</h2><h3 id="3-8-1-CAShapeLayer-简介"><a href="#3-8-1-CAShapeLayer-简介" class="headerlink" title="3.8.1    CAShapeLayer 简介"></a>3.8.1    CAShapeLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍 <code>CAShapeLayer</code> 与 <code>CALayer</code>、贝塞尔曲线之间的简单联系，并通过一个 demo 演示 <code>CAShapeLayer</code> 实现的路径动画效果。</p>
<ol>
<li><code>CAShapeLayer</code>继承自<code>CALayer</code>，可以使用<code>CALayer</code>的所有属性值</li>
<li><code>CAShapeLayer</code>需要与贝塞尔曲线配合使用才有意义</li>
<li>使用<code>CAShapeLayer</code>与贝塞尔曲线可以实现不在<code>view</code>的<code>drawRect</code>方法中画出一些想要的图形</li>
<li><code>CAShapeLayer</code>属于<code>CoreAnimation</code>框架，其动画渲染直接提交到手机的<code>GPU</code>当中，相较于<code>view</code>的<code>srawRect</code>方法使用<code>CPU</code>渲染而言，其效率极高，能大大优化内存使用情况。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_path.gif" alt="Alt text"></p>
<h3 id="3-8-2-贝塞尔曲线与-CAShapeLayer-的关系"><a href="#3-8-2-贝塞尔曲线与-CAShapeLayer-的关系" class="headerlink" title="3.8.2    贝塞尔曲线与 CAShapeLayer 的关系"></a>3.8.2    贝塞尔曲线与 CAShapeLayer 的关系</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍多阶贝塞尔曲线的用途，并详细讲解贝塞尔曲线与 <code>CAShapeLayer</code> 之间的关系，以及使用贝塞尔曲线的一些注意事项。</p>
<ol>
<li><code>CAShapeLayer</code>中有<code>Shape</code>这个单词，顾名思义，它需要一个形状才能生效</li>
<li>贝赛尔曲线可以创建基于矢量的路径<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_beisaier.gif" alt="Alt text"></li>
<li>贝塞尔曲线给<code>CAShaperLayer</code>提供路径，<code>CAShpaeLayer</code>在提供的路径中进行渲染，路径会闭环，所以路径绘制出了<code>Shape</code></li>
<li>用于<code>CAShapeLayer</code>的贝赛尔曲线作为<code>path</code>，其中<code>path</code>是一个首尾相接的闭环的曲线，即使该贝赛尔曲线不是一个闭环的曲线。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-12%2019.14.35.png" alt="Alt text"></p>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">    <span class="comment">// UIBezierPath *oval = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(0, 0, 200, 100)];// 椭圆形</span></span><br><span class="line">    <span class="comment">// UIBezierPath *rect = [UIBezierPath bezierPathWithRect:CGRectMake(0, 0, 200, 100)];// 矩形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *circle = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];<span class="comment">// 圆形</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">    <span class="built_in">CAShapeLayer</span> *shape = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    shape.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">    shape.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    shape.borderWidth = <span class="number">1.</span>f;<span class="comment">// 显示 CAShapeLayer 的边界</span></span><br><span class="line">    shape.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏益处的贝塞尔曲线围住的区域</span></span><br><span class="line">    shape.fillColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 建立关联</span></span><br><span class="line">    shape.path = circle.CGPath;<span class="comment">// 看下圆形的效果</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:shape];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-3-StrokeStart-与-StrokeEnd-动画"><a href="#3-8-3-StrokeStart-与-StrokeEnd-动画" class="headerlink" title="3.8.3    StrokeStart 与 StrokeEnd 动画"></a>3.8.3    StrokeStart 与 StrokeEnd 动画</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何设置 <code>CAShapeLayer</code> 的属性值来显示出圆环并用 <code>CAShapeLayer</code> 的 <code>StrokeStart</code> 与 <code>StrokeEnd</code> 属性做动画。</p>
<ol>
<li>将<code>ShapeLayer</code>的<code>fillColor</code>设置成透明背景</li>
<li>设置线条的宽度(<code>lineWidth</code>)的值</li>
<li>设置线条的颜色</li>
<li>将<code>strokeStart</code>的值设定成0，然后让<code>strokeEnd</code>的值变化触发隐式动画</li>
</ol>
<p><strong>注意：</strong>同时设置<code>strokeStart</code>和<code>strokeEnd</code>时，前者不能大于后者。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_animeTwo.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 背景设置</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.878</span> green:<span class="number">0.878</span> blue:<span class="number">0.878</span> alpha:<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 贝塞尔曲线</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *oval = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. CAShapeLayer</span></span><br><span class="line">    _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    _shapeLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    _shapeLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">    _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    _shapeLayer.lineWidth = <span class="number">2.</span>f;</span><br><span class="line">    _shapeLayer.strokeStart = <span class="number">0.</span>f;</span><br><span class="line">    _shapeLayer.strokeEnd = <span class="number">0.</span>f;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 建立贝塞尔曲线与CAShapeLayer之间的关联</span></span><br><span class="line">    _shapeLayer.path = oval.CGPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:_shapeLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 定时器</span></span><br><span class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                              target:<span class="keyword">self</span></span><br><span class="line">                                            selector:<span class="keyword">@selector</span>(animationEventTypeTwo)</span><br><span class="line">                                            userInfo:<span class="literal">nil</span></span><br><span class="line">                                             repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  只改变 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeOne</span><br><span class="line">&#123;</span><br><span class="line">    _shapeLayer.strokeEnd = arc4random() % <span class="number">100</span> / <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  同时改变 strokeStart 和 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeTwo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueOne = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueTwo = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    </span><br><span class="line">    _shapeLayer.strokeStart = valueOne &lt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取小的</span></span><br><span class="line">    _shapeLayer.strokeEnd = valueOne &gt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取大的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-4-用-CAShapeLayer-实现圆形进度条效果"><a href="#3-8-4-用-CAShapeLayer-实现圆形进度条效果" class="headerlink" title="3.8.4    用 CAShapeLayer 实现圆形进度条效果"></a>3.8.4    用 CAShapeLayer 实现圆形进度条效果</h3><blockquote>
<p><strong>课程说明：</strong>本课在课时 3 的基础上将动画效果封装到控件当中。</p>
<ol>
<li>确定需要设定的参数</li>
<li>实现细节</li>
<li>进行测试</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_circle.gif" alt="Alt text"></p>
<h4 id="3-8-4-1-圆形进度条控件"><a href="#3-8-4-1-圆形进度条控件" class="headerlink" title="3.8.4.1    圆形进度条控件"></a>3.8.4.1    圆形进度条控件</h4><p><em>CircleUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> startValue;<span class="comment">// 起始值（0～1）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> lineWidth;<span class="comment">// 线宽（&gt;0）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> value;<span class="comment">// 变化的值</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;<span class="comment">// 线条颜色</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CircleUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CircleUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="keyword">self</span>.bounds];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">        _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">        _shapeLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">        _shapeLayer.lineWidth=  <span class="number">1.</span>f;</span><br><span class="line">        _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">        _shapeLayer.strokeEnd = <span class="number">0.</span>f;<span class="comment">// 一开使进度为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 关联</span></span><br><span class="line">        _shapeLayer.path = path.CGPath;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 添加并显示</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:_shapeLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeStart</span></span><br><span class="line"><span class="keyword">@synthesize</span> startValue = _startValue;</span><br><span class="line">- (<span class="keyword">void</span>)setStartValue:(<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    _startValue = startValue;</span><br><span class="line">    _shapeLayer.strokeStart = startValue;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    <span class="keyword">return</span> _startValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeEnd</span></span><br><span class="line"><span class="keyword">@synthesize</span> value = _value;</span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    _value = value;</span><br><span class="line">    _shapeLayer.strokeEnd = value;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    <span class="keyword">return</span> _value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lineWidth</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineWidth = _lineWidth;</span><br><span class="line">- (<span class="keyword">void</span>)setLineWidth:(<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    _lineWidth = lineWidth;</span><br><span class="line">    _shapeLayer.lineWidth = lineWidth;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeColor</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineColor = _lineColor;</span><br><span class="line">- (<span class="keyword">void</span>)setLineColor:(<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    _lineColor = lineColor;</span><br><span class="line">    _shapeLayer.strokeColor = lineColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-8-4-2-使用"><a href="#3-8-4-2-使用" class="headerlink" title="3.8.4.2    使用"></a>3.8.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    Circle<span class="built_in">UIView</span> *circle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建并设置圆型进度条</span></span><br><span class="line">    circle = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    circle.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    circle.startValue = <span class="number">0.</span>f;</span><br><span class="line">    circle.lineWidth = <span class="number">3.</span>f;</span><br><span class="line">    circle.lineColor = [<span class="built_in">UIColor</span> grayColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:circle];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 延迟3秒后动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(delayAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置圆型进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)delayAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使进度达到100%</span></span><br><span class="line">    circle.value = <span class="number">1.</span>f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-9-iOS中-CALayer-的使用"><a href="#3-9-iOS中-CALayer-的使用" class="headerlink" title="3.9    iOS中 CALayer 的使用"></a>3.9    iOS中 CALayer 的使用</h2><h3 id="3-9-1-用-CALayer-定制下载进度条控件"><a href="#3-9-1-用-CALayer-定制下载进度条控件" class="headerlink" title="3.9.1    用 CALayer 定制下载进度条控件"></a>3.9.1    用 CALayer 定制下载进度条控件</h3><blockquote>
<p><strong>课程说明：</strong>本课在通过对 <code>CALayer</code> 的基本原理讲解后用 <code>CALayer</code> 基本知识定制下载进度条控件。</p>
<ol>
<li>单独创建出<code>CALayer</code></li>
<li>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果</li>
<li>用定时器（<code>NSTimer</code>）模拟网络下载时提供的百分比数据</li>
<li>将<code>CALayer</code>封装进<code>UIView</code>子类中定制进度条控件</li>
</ol>
<p><strong>CALayer简介：</strong></p>
<ol>
<li><code>CALayer</code>一般作为<code>UIView</code>的容器使用</li>
<li><code>CALayer</code>是一个管理着图片载体（image-based content）的 层结构</li>
<li>直接修改单独创建出的<code>CALayer</code>的属性可以触发隐式动画（不需要其它设置，修改属性直接触发动画）</li>
<li><code>UIView</code>中的<code>CALayer</code>动画必须显式触发才能生效</li>
</ol>
</blockquote>
<h4 id="3-9-2-1-原理"><a href="#3-9-2-1-原理" class="headerlink" title="3.9.2.1    原理"></a>3.9.2.1    原理</h4><blockquote>
<p><strong>说明：</strong>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建layer并添加layer</span></span><br><span class="line"><span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">5</span>);</span><br><span class="line">[<span class="keyword">self</span>.view.layer addSubLayer:layer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发隐式动画</span></span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>, <span class="number">200</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-13%2010.29.42.png" alt="Alt text|200x120"></p>
<h4 id="3-9-1-2-实战"><a href="#3-9-1-2-实战" class="headerlink" title="3.9.1.2    实战"></a>3.9.1.2    实战</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
<h3 id="3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果"><a href="#3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果" class="headerlink" title="3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果"></a>3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用动画组 <code>CAAnimationGroup</code> 将 <code>bounds</code> 动画与 <code>contents</code> 动画组合起来实现切换图片时的淡入淡出效果。</p>
<ol>
<li>操作<code>UIImageView</code>的<code>CALayer</code>修改其<code>bounds</code>值进行显示动画</li>
<li>修改<code>UIImageView</code>的<code>CALayer</code>中的<code>contents</code>属性实现切换图片的动画</li>
<li>用<code>CAAnimationGroup</code>将<code>bounds</code>动画与<code>contents</code>动画组合起来</li>
<li>将上述效果封装进<code>UIView</code>的子类中生成控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_fade.gif" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="3-9-2-1-封装动画效果"><a href="#3-9-2-1-封装动画效果" class="headerlink" title="3.9.2.1    封装动画效果"></a>3.9.2.1    封装动画效果</h4><p><em>FadeUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *image;<span class="comment">// 当前图片</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 setter, getter</span></span><br><span class="line"><span class="keyword">@synthesize</span> image = _image;</span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    _image = image;</span><br><span class="line">    <span class="comment">// 除了第一次设置图片，都加入淡如淡出的效果</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.layer.contents != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建淡入/淡出的切换动画</span></span><br><span class="line">        <span class="built_in">CABasicAnimation</span> *contentsAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"contents"</span>];</span><br><span class="line">        contentsAnimation.fromValue = <span class="keyword">self</span>.layer.contents;</span><br><span class="line">        contentsAnimation.toValue = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">        contentsAnimation.duration = <span class="number">3.</span>f;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将动画添加到图层</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addAnimation:contentsAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改 contents，触发动画</span></span><br><span class="line">    <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-9-2-2-使用控件"><a href="#3-9-2-2-使用控件" class="headerlink" title="3.9.2.2    使用控件"></a>3.9.2.2    使用控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Fade<span class="built_in">UIView</span> *fadeView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化呈现动画的视图</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView = [[Fade<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.fadeView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置第一张图片</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"起始图片"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2秒钟后设置下一张图片</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(layerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置下一张图片</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"结束图片"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-9-3-用-CALayer-实现复杂遮罩效果"><a href="#3-9-3-用-CALayer-实现复杂遮罩效果" class="headerlink" title="3.9.3    用 CALayer 实现复杂遮罩效果"></a>3.9.3    用 CALayer 实现复杂遮罩效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用 CALayer 的 mask 属性作为遮罩 Layer，通过移动该遮罩 Layer 的 frame 值实现复杂的遮罩效果。</p>
<ol>
<li>遮罩原理分析</li>
<li>用<code>png</code>图片作为<code>CALayer</code>中<code>mask</code>属性的遮罩<code>Layer</code></li>
<li>移动该<code>CALayer</code>的<code>mask</code>的<code>frame</code>值实现遮罩<code>Layer</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8A%E5%8D%8812.01.58.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *imageLayer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *maskLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *imageForContents = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"原始图片"</span>];<span class="comment">// 底图</span></span><br><span class="line">    <span class="built_in">UIImage</span> *imageForMask = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"maskLayerContents"</span>];<span class="comment">// 作为遮罩的图片</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.contents = (__bridge <span class="keyword">id</span>)(imageForContents.CGImage);</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.imageLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遮罩 layer</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.contents = (__bridge <span class="keyword">id</span>)(imageForMask.CGImage);</span><br><span class="line">    <span class="comment">// self.maskLayer.backgroundColor = [UIColor whiteColor].CGColor;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给图片 layer 提供遮罩的 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer.mask = <span class="keyword">self</span>.maskLayer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3秒中中后做 maskLayer 动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(maskLayerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)maskLayerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-10-iOS绘图-API-绘制线条／文字／几何图形"><a href="#3-10-iOS绘图-API-绘制线条／文字／几何图形" class="headerlink" title="3.10    iOS绘图 API 绘制线条／文字／几何图形"></a>3.10    iOS绘图 API 绘制线条／文字／几何图形</h2><h3 id="3-10-1-绘制线条"><a href="#3-10-1-绘制线条" class="headerlink" title="3.10.1    绘制线条"></a>3.10.1    绘制线条</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460642543336.png" alt="Alt text|100x150"><br><em>DrawLines.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawLinesView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 描绘线条</span></span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">300</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">500</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出来</span></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-2-绘制矩形"><a href="#3-10-2-绘制矩形" class="headerlink" title="3.10.2    绘制矩形"></a>3.10.2    绘制矩形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8810.36.09.png" alt="Alt text"><br><em>DrawRectView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawRectView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 矩形</span></span><br><span class="line">        <span class="type">CGContextAddRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置绘图上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出矩形</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-3-绘制圆形"><a href="#3-10-3-绘制圆形" class="headerlink" title="3.10.3    绘制圆形"></a>3.10.3    绘制圆形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460644510040.png" alt="Alt text|100x150"><br><em>DrawCircleView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawCircleView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 画圆</span></span><br><span class="line">        <span class="comment">/*-- 方案一 --*/</span></span><br><span class="line">        <span class="comment">// 内部用来填充的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="comment">// 外部作为边的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">10</span>)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*-- 方案二 --*/</span></span><br><span class="line">        <span class="type">CGContextAddEllipseInRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">400</span>, <span class="number">200</span>, <span class="number">100</span>))</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line"></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-4-绘制图片"><a href="#3-10-4-绘制图片" class="headerlink" title="3.10.4    绘制图片"></a>3.10.4    绘制图片</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8811.43.57.png" alt="Alt text"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawImageView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uiImage:<span class="type">CGImageRef</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">        uiImage = <span class="type">UIImage</span>(named: <span class="string">"walle.jpg"</span>)?.<span class="type">CGImage</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制图片 */</span></span><br><span class="line">        <span class="comment">// 1. 保留之前的上下文信息（设置暂存点）</span></span><br><span class="line">        <span class="type">CGContextSaveGState</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 设置当前上下文</span></span><br><span class="line">        <span class="type">CGContextTranslateCTM</span>(context, <span class="number">10</span>, <span class="number">400</span>)<span class="comment">// 移动</span></span><br><span class="line">        <span class="type">CGContextScaleCTM</span>(context, <span class="number">1</span>, -<span class="number">1</span>)<span class="comment">// 缩放（翻转坐标系）</span></span><br><span class="line">        <span class="comment">// 3. 呈现图片</span></span><br><span class="line">        <span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>), uiImage)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制矩形 */</span></span><br><span class="line">        <span class="type">CGContextRestoreGState</span>(context)<span class="comment">// 恢复暂存点之前的上下文</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">80</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-5-画板实例"><a href="#3-10-5-画板实例" class="headerlink" title="3.10.5    画板实例"></a>3.10.5    画板实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_panel.gif" alt="Alt text"><br><em>DrawBoardView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawBoardView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">CGPathCreateMutable</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathMoveToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">        </span><br><span class="line">        setNeedsDisplay()<span class="comment">// 重绘当前view（触发drawRect）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="type">CGContextAddPath</span>(context, path)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/14/JK_IOS中级_2  UI部分/" rel="next" title="2 UI部分">
                <i class="fa fa-chevron-left"></i> 2 UI部分
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" rel="prev" title="4 中级ios开发工程师面试题">
                4 中级ios开发工程师面试题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/05/14/JK_IOS中级_3  动画图层部分/"
           data-title="3 动画图层部分" data-url="http://laputa-er.github.io/2016/05/14/JK_IOS中级_3  动画图层部分/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">102</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-设计复杂的iOS动画效果"><span class="nav-text">3.1    设计复杂的iOS动画效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-制定统一的动画接口"><span class="nav-text">3.1.1    制定统一的动画接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-动画中的高内聚低耦合原理"><span class="nav-text">3.1.2    动画中的高内聚低耦合原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-设计动画函数的注意事项"><span class="nav-text">3.1.3    设计动画函数的注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例"><span class="nav-text">案例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-4-用里氏代换原则来处理动画类的继承问题"><span class="nav-text">3.1.4    用里氏代换原则来处理动画类的继承问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-1-父类"><span class="nav-text">3.1.4.1    父类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-2-子类"><span class="nav-text">3.1.4.2    子类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-3-演示"><span class="nav-text">3.1.4.3    演示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-5-动画中的模块化设计"><span class="nav-text">3.1.5    动画中的模块化设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5-1-子模块"><span class="nav-text">3.1.5.1    子模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5-2-组合使用"><span class="nav-text">3.1.5.2    组合使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-iOS模糊效果的使用"><span class="nav-text">3.2    iOS模糊效果的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-CoreImage中的模糊滤镜"><span class="nav-text">3.2.1    CoreImage中的模糊滤镜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-UIImage-ImageEffects的category模糊效果"><span class="nav-text">3.2.2    UIImage + ImageEffects的category模糊效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-iOS8种UIVisualEffectView模糊效果的使用"><span class="nav-text">3.2.3    iOS8种UIVisualEffectView模糊效果的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4-设计下载图片后自动模糊的控件"><span class="nav-text">3.2.4    设计下载图片后自动模糊的控件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-1-控件实现"><span class="nav-text">3.2.4.1    控件实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-2-使用"><span class="nav-text">3.2.4.2    使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-使用-maskView-设计动画"><span class="nav-text">3.3    使用 maskView 设计动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-maskView-maskLayer-的基本原理"><span class="nav-text">3.3.1    maskView(maskLayer)的基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-maskView配合-CAGradientLayer的使用"><span class="nav-text">3.3.2    maskView配合 CAGradientLayer的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-maskView-配合带-alpha-通道图片的使用"><span class="nav-text">3.3.3    maskView 配合带 alpha 通道图片的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-设计文本横向渐变消失的控件"><span class="nav-text">3.3.4    设计文本横向渐变消失的控件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-1-文本横向渐变消失的控件"><span class="nav-text">3.3.4.1    文本横向渐变消失的控件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-4-2-使用该控件"><span class="nav-text">3.3.4.2    使用该控件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-使用-Facebook-开源动画库-POP-实现"><span class="nav-text">3.4    使用 Facebook 开源动画库 POP 实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-POP动画引擎简介"><span class="nav-text">3.4.1    POP动画引擎简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-1-POP效果展示"><span class="nav-text">3.4.1.1    POP效果展示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-2-CADisplayLink"><span class="nav-text">3.4.1.2    CADisplayLink</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-POP动画引擎中Layer与CALayer的联系与区别"><span class="nav-text">3.4.2    POP动画引擎中Layer与CALayer的联系与区别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-1-导入POP框架"><span class="nav-text">3.4.2.1    导入POP框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-1-比较CALayer和POP-CAlayer"><span class="nav-text">3.4.2.1    比较CALayer和POP CAlayer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-3-用POP动画引擎实现衰减动画"><span class="nav-text">3.4.3    用POP动画引擎实现衰减动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-4-用POP动画引擎实现弹簧动画"><span class="nav-text">3.4.4    用POP动画引擎实现弹簧动画</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-用缓动函数模拟物理动画"><span class="nav-text">3.5    用缓动函数模拟物理动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-1-缓动函数简介"><span class="nav-text">3.5.1    缓动函数简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-1-缓动函数类型"><span class="nav-text">3.5.1.1    缓动函数类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-2-缓动效果示例"><span class="nav-text">3.5.1.2    缓动效果示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-2-缓动函数与关键帧动画的联系"><span class="nav-text">3.5.2    缓动函数与关键帧动画的联系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-3-用缓动函数模拟弹簧效果"><span class="nav-text">3.5.3    用缓动函数模拟弹簧效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-4-用缓动函数模拟碰撞效果"><span class="nav-text">3.5.4    用缓动函数模拟碰撞效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-5-用缓动函数模拟衰减效果"><span class="nav-text">3.5.5    用缓动函数模拟衰减效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-使用带粒子效果的-CAEmitterLayer"><span class="nav-text">3.6    使用带粒子效果的 CAEmitterLayer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-1-用-CAEmitterLayer-产生粒子效果"><span class="nav-text">3.6.1    用 CAEmitterLayer 产生粒子效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-2-封装-CAEmitterLayerUIVIew"><span class="nav-text">3.6.2    封装 CAEmitterLayerUIVIew</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-3-封装下雪、下雨的粒子效果控件"><span class="nav-text">3.6.3    封装下雪、下雨的粒子效果控件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-7-iOS-中-CAGradientLaueyer-的使用"><span class="nav-text">3.7    iOS 中 CAGradientLaueyer 的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-1-CAGradientLayer-简介"><span class="nav-text">3.7.1    CAGradientLayer 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-2-CAGradientLayer-坐标系统"><span class="nav-text">3.7.2    CAGradientLayer 坐标系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-3-色差动画的实现"><span class="nav-text">3.7.3    色差动画的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-4-用-CAGradientLayer-封装带色差动画的-View"><span class="nav-text">3.7.4    用 CAGradientLayer 封装带色差动画的 View</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-4-1-封装好的视图"><span class="nav-text">3.7.4.1    封装好的视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-4-2-使用"><span class="nav-text">3.7.4.2    使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-8-iOS中-CAShapeLayer-的使用"><span class="nav-text">3.8    iOS中 CAShapeLayer 的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-1-CAShapeLayer-简介"><span class="nav-text">3.8.1    CAShapeLayer 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-2-贝塞尔曲线与-CAShapeLayer-的关系"><span class="nav-text">3.8.2    贝塞尔曲线与 CAShapeLayer 的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-3-StrokeStart-与-StrokeEnd-动画"><span class="nav-text">3.8.3    StrokeStart 与 StrokeEnd 动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-4-用-CAShapeLayer-实现圆形进度条效果"><span class="nav-text">3.8.4    用 CAShapeLayer 实现圆形进度条效果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-4-1-圆形进度条控件"><span class="nav-text">3.8.4.1    圆形进度条控件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-4-2-使用"><span class="nav-text">3.8.4.2    使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-9-iOS中-CALayer-的使用"><span class="nav-text">3.9    iOS中 CALayer 的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-1-用-CALayer-定制下载进度条控件"><span class="nav-text">3.9.1    用 CALayer 定制下载进度条控件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-2-1-原理"><span class="nav-text">3.9.2.1    原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-1-2-实战"><span class="nav-text">3.9.1.2    实战</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果"><span class="nav-text">3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-2-1-封装动画效果"><span class="nav-text">3.9.2.1    封装动画效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-2-2-使用控件"><span class="nav-text">3.9.2.2    使用控件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-9-3-用-CALayer-实现复杂遮罩效果"><span class="nav-text">3.9.3    用 CALayer 实现复杂遮罩效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-10-iOS绘图-API-绘制线条／文字／几何图形"><span class="nav-text">3.10    iOS绘图 API 绘制线条／文字／几何图形</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-1-绘制线条"><span class="nav-text">3.10.1    绘制线条</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-2-绘制矩形"><span class="nav-text">3.10.2    绘制矩形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-3-绘制圆形"><span class="nav-text">3.10.3    绘制圆形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-4-绘制图片"><span class="nav-text">3.10.4    绘制图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-10-5-画板实例"><span class="nav-text">3.10.5    画板实例</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
