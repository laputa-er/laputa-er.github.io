<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="4.1    iOS设计模式简介4.1.1    编码是门艺术4.1.2    设计模式的基本原则
开闭原则：一个模块的修改应该对扩展开发，对修改关闭
里氏代换原则：子类、父类可以替换使用
依赖倒转原则：抽象比依赖细节，细节依赖抽象
接口隔离原则：只做和接口相关的必要的事情，不做和接口不相关的事情
合成／聚合复用：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为">
<meta property="og:type" content="article">
<meta property="og:title" content="4 设计模式">
<meta property="og:url" content="http://laputa-er.github.io/2016/06/03/JK_IOS高级_4 设计模式/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="4.1    iOS设计模式简介4.1.1    编码是门艺术4.1.2    设计模式的基本原则
开闭原则：一个模块的修改应该对扩展开发，对修改关闭
里氏代换原则：子类、父类可以替换使用
依赖倒转原则：抽象比依赖细节，细节依赖抽象
接口隔离原则：只做和接口相关的必要的事情，不做和接口不相关的事情
合成／聚合复用：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462074739914.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.30.25.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462073700393.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.31.00.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.38.40.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462093482279.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%889.41.29.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462113251890.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%8811.30.22.png">
<meta property="og:image" content="http://laputa-er.github.io/./屏幕快照 2016-05-02 下午2.57.40.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462191691369.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462192387967.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462199219485.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462186013642.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1462201625961.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463410189425.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463410420677.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463490224877.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463495040772.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463587653123.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463799288205.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463798863229.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463743818102.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463715567130.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463816866737.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463816799001.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463818469080.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463839147515.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463839248044.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463845234221.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464019108656.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463899846934.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1463922342138.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464018921308.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464186654392.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464361708327.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464362026510.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464364328834.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464447294270.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464417280472.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464445381861.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464447882554.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464500610532.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464500840393.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E5%85%B3%E7%B3%BB%E5%9B%BE.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464515129490.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331xcode.gif">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464531258992.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464533251952.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464611058484.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464616045947.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464676034326.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464700648380.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464700681237.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464708309582.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/1464751736763.png">
<meta property="og:updated_time" content="2016-09-19T12:06:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 设计模式">
<meta name="twitter:description" content="4.1    iOS设计模式简介4.1.1    编码是门艺术4.1.2    设计模式的基本原则
开闭原则：一个模块的修改应该对扩展开发，对修改关闭
里氏代换原则：子类、父类可以替换使用
依赖倒转原则：抽象比依赖细节，细节依赖抽象
接口隔离原则：只做和接口相关的必要的事情，不做和接口不相关的事情
合成／聚合复用：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为">
<meta name="twitter:image" content="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/2016/06/03/JK_IOS高级_4 设计模式/"/>

  <title> 4 设计模式 | Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?898688f51c5a3d6b37dd23e04441e5bd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                4 设计模式
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-03T14:11:18+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/极客学院-ios高级/" itemprop="url" rel="index">
                    <span itemprop="name">极客学院_ios高级</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/03/JK_IOS高级_4 设计模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/03/JK_IOS高级_4 设计模式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="4-1-iOS设计模式简介"><a href="#4-1-iOS设计模式简介" class="headerlink" title="4.1    iOS设计模式简介"></a>4.1    iOS设计模式简介</h2><h3 id="4-1-1-编码是门艺术"><a href="#4-1-1-编码是门艺术" class="headerlink" title="4.1.1    编码是门艺术"></a>4.1.1    编码是门艺术</h3><h3 id="4-1-2-设计模式的基本原则"><a href="#4-1-2-设计模式的基本原则" class="headerlink" title="4.1.2    设计模式的基本原则"></a>4.1.2    设计模式的基本原则</h3><ul>
<li><strong>开闭原则</strong>：一个模块的修改应该对扩展开发，对修改关闭</li>
<li><strong>里氏代换原则</strong>：子类、父类可以替换使用</li>
<li><strong>依赖倒转原则</strong>：抽象比依赖细节，细节依赖抽象</li>
<li><strong>接口隔离原则</strong>：只做和接口相关的必要的事情，不做和接口不相关的事情</li>
<li><strong>合成／聚合复用</strong>：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为一个组件调用</li>
</ul>
<h3 id="4-1-3-设计模式的类型"><a href="#4-1-3-设计模式的类型" class="headerlink" title="4.1.3    设计模式的类型"></a>4.1.3    设计模式的类型</h3><h2 id="4-2-适配器"><a href="#4-2-适配器" class="headerlink" title="4.2    适配器"></a>4.2    适配器</h2><h3 id="4-2-1-何为适配器模式"><a href="#4-2-1-何为适配器模式" class="headerlink" title="4.2.1    何为适配器模式"></a>4.2.1    何为适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过现实生活中遇到的电源适配问题，来讲解何为适配器模式。<br><strong>说明：</strong>苹果的电源适配器，可以将各种输入电压频率转为一致的电压频率为设备供电，从而解决国家电压频率不一致问题</p>
<ul>
<li><strong>类适配器：</strong>比之于一般的电源适配器，在不同国家要购买相应的电源适配器</li>
<li><strong>对象适配器：</strong>比之于苹果的电源适配器，能自动适应各个国家的情况</li>
</ul>
</blockquote>
<h3 id="4-2-2-数据直接适配带来的困境"><a href="#4-2-2-数据直接适配带来的困境" class="headerlink" title="4.2.2    数据直接适配带来的困境"></a>4.2.2    数据直接适配带来的困境</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解开发过程中遇到的最常见的几种数据适配问题的弊端，并配以代码示例，来引申出为何要用适配器模式。</p>
<ul>
<li>直接赋值的弊端</li>
<li>用对象赋值的灵活性问题</li>
<li>如何降低数据层与视图层的耦合度</li>
</ul>
</blockquote>
<h3 id="4-2-3-使用适配器模式"><a href="#4-2-3-使用适配器模式" class="headerlink" title="4.2.3    使用适配器模式"></a>4.2.3    使用适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解用适配器模式来优化名片视图加载数据的问题。</p>
<ul>
<li>创建抽象适配器模式</li>
<li>适配器与视图层建立输出联系</li>
<li>类适配器与对象适配器<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462074739914.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="4-2-3-1-类适配器"><a href="#4-2-3-1-类适配器" class="headerlink" title="4.2.3.1    类适配器"></a>4.2.3.1    类适配器</h4><blockquote>
<p><strong>说明：</strong>为每种数据模型都创建相应的适配器，用到哪种数据就使用相应的适配器。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.30.25.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462073700393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">// 3. 将数据连接到适配器</span><br><span class="line">BusinessCardAdapter *modelAdapter = [[NewCardModelAdapter alloc] initWithData:newCardModel];</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[ModelAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-2-对象适配器"><a href="#4-2-3-2-对象适配器" class="headerlink" title="4.2.3.2        对象适配器"></a>4.2.3.2        对象适配器</h4><blockquote>
<p><strong>说明：</strong>每种数据模型都使用同一个适配器，适配器中承担为每种数据模型都提供适配的任务。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.31.00.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.38.40.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[CardAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-适配器模式的优缺点"><a href="#4-2-4-适配器模式的优缺点" class="headerlink" title="4.2.4    适配器模式的优缺点"></a>4.2.4    适配器模式的优缺点</h3><p><strong>优点：</strong>降低数据层和视图层之间的耦合度<br><strong>缺点：</strong>对不理解适配器模式的人可读性不好</p>
<h2 id="4-3-策略"><a href="#4-3-策略" class="headerlink" title="4.3    策略"></a>4.3    策略</h2><h3 id="4-3-1-if-else-的问题"><a href="#4-3-1-if-else-的问题" class="headerlink" title="4.3.1    if - else 的问题"></a>4.3.1    if - else 的问题</h3><blockquote>
<p><strong>课程说明：</strong>程序中出现了大量 if - else 之后，出现的阅读障碍以及维护的困境。</p>
</blockquote>
<h3 id="4-3-2-策略模式的原理"><a href="#4-3-2-策略模式的原理" class="headerlink" title="4.3.2    策略模式的原理"></a>4.3.2    策略模式的原理</h3><blockquote>
<p><strong>课程说明：</strong>策略模式的基本原理以及定义的条件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462093482279.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-3-3-策略模式的使用"><a href="#4-3-3-策略模式的使用" class="headerlink" title="4.3.3    策略模式的使用"></a>4.3.3    策略模式的使用</h3><blockquote>
<p><strong>课程说明：</strong>怎样将策略模式用到 <code>UITextField</code> 的验证逻辑上。</p>
<ul>
<li>如何抽象出策略</li>
<li>制定协议来维护输出信息<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%889.41.29.png" alt="Alt text|200x100"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462113251890.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIButton+inits.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIView+SetRect.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIInfomationView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CustomUITextField.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EmailValidator.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PhoneNumberValidator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITextFieldDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *emailField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *phoneNumberField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButton];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化输入框</span></span><br><span class="line">    [<span class="keyword">self</span> initCustonFields];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳 UITextFieldDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)textFieldDidEndEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    Custom<span class="built_in">UITextField</span> *customField = (Custom<span class="built_in">UITextField</span> *)textField;</span><br><span class="line">    <span class="keyword">if</span> ([customField validate] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="comment">// 弹出错误提示窗</span></span><br><span class="line">        [<span class="built_in">UIInfomationView</span> showAlertViewWithTitle:<span class="literal">nil</span></span><br><span class="line">                                         message:customField</span><br><span class="line">                                                .validator</span><br><span class="line">                                                .errorMessage</span><br><span class="line">                               cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                               otherButtonTitles:@[<span class="string">@"确定"</span>]</span><br><span class="line">                                    clickAtIndex:^(<span class="built_in">NSInteger</span> buttonIndex) &#123;</span><br><span class="line">                                        </span><br><span class="line">                                    &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化输入框</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initCustonFields &#123;</span><br><span class="line">    <span class="comment">// 邮箱输入框</span></span><br><span class="line">    <span class="keyword">self</span>.emailField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.emailField.placeholder = <span class="string">@"请输入邮箱"</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.delegate =  <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.validator = [EmailValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.emailField];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手机号输入框</span></span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span> + <span class="number">40</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.placeholder = <span class="string">@"请输入电话号码"</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.validator = [PhoneNumberValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneNumberField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化返回按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButton &#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> createButtonWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">30</span>)</span><br><span class="line">                                            buttonType:<span class="number">0</span></span><br><span class="line">                                                 title:<span class="string">@"Back"</span></span><br><span class="line">                                                   tag:<span class="number">0</span></span><br><span class="line">                                                target:<span class="keyword">self</span></span><br><span class="line">                                                action:<span class="keyword">@selector</span>(buttonEvent:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  结束编辑</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4-策略模式的优缺点"><a href="#4-3-4-策略模式的优缺点" class="headerlink" title="4.3.4    策略模式的优缺点"></a>4.3.4    策略模式的优缺点</h3><p><strong>优点：</strong>避免大量<code>if-else</code>的使用，精简逻辑，可维护性高<br><strong>缺点：</strong>使用场景受限，使用之前就需要确定对应的策略。</p>
<h2 id="4-4-观察者"><a href="#4-4-观察者" class="headerlink" title="4.4    观察者"></a>4.4    观察者</h2><h3 id="4-4-1-如何订阅一本杂志"><a href="#4-4-1-如何订阅一本杂志" class="headerlink" title="4.4.1    如何订阅一本杂志"></a>4.4.1    如何订阅一本杂志</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过讲解如何订阅杂志的生活实例，来讲解何为观察者模式。</p>
</blockquote>
<h4 id="4-4-1-1-如何订阅一本杂志"><a href="#4-4-1-1-如何订阅一本杂志" class="headerlink" title="4.4.1.1    如何订阅一本杂志"></a>4.4.1.1    如何订阅一本杂志</h4><blockquote>
<ol>
<li>通过邮局或网络查询刊物的编号</li>
<li>找到后，提供个人住址等相关信息</li>
<li>发行商在一般每月的固定时间发送刊物</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%8811.30.22.png" alt="Alt text"></p>
<h3 id="4-4-2-通知中心的抽象设计"><a href="#4-4-2-通知中心的抽象设计" class="headerlink" title="4.4.2    通知中心的抽象设计"></a>4.4.2    通知中心的抽象设计</h3><blockquote>
<p><strong>课程说明：</strong>本课时根据订阅杂志的实例，讲解如何将抽象的模型转换成代码。</p>
<ul>
<li>如何抽象接口</li>
<li>对订阅对象的约束：订阅对象必须采纳相应的协议</li>
<li>针对接口编程：先根据目标功能定好接口，然后再具体实现</li>
</ul>
</blockquote>
<p><em>SubscriptionServiceCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenterProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubscriptionServiceCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护订阅信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护客户信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加客户到具体的订阅号当中</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           客户</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从具体的订阅号中移除客户</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           &lt;#customer description#&gt;</span><br><span class="line"> *  @param subscriptionNumber &lt;#subscriptionNumber description#&gt;</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 发送消息</span></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-3-实现通知中心"><a href="#4-4-3-实现通知中心" class="headerlink" title="4.4.3    实现通知中心"></a>4.4.3    实现通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时将实现通知中心，并讲解<code>NSHashTable</code> 与<code>NSParameterAssert</code> 的使用。<br><strong>注意：</strong><code>NSHashTable</code>和<code>NSSet</code>类似，但前者可以不会强引用集合中的元素。</p>
</blockquote>
<ul>
<li>对象持有的问题<br><em>描述</em>：书刊和用户之间的联系导致用户实例无法被释放<br><em>解决</em>：用<code>NSHashTable</code>实现<code>weak</code>引用</li>
<li>参数的严格验证<br><em>描述</em>：比如参数值不允许值为<code>nil</code></li>
</ul>
<p><img src="./屏幕快照 2016-05-02 下午2.57.40.png" alt="Alt text"></p>
<h4 id="4-4-3-1-实现通知中心类"><a href="#4-4-3-1-实现通知中心类" class="headerlink" title="4.4.3.1    实现通知中心类"></a>4.4.3.1    实现通知中心类</h4><p><em>SubscriptionServiceCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"><span class="comment">// 存储订阅号的字典</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *_subscriptionDictionary = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubscriptionServiceCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化存储订阅号的字典</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == [SubscriptionServiceCenter class]) &#123;</span><br><span class="line">        _subscriptionDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取具体的订阅号</span></span><br><span class="line">+ (<span class="built_in">NSHashTable</span> *)existSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="keyword">return</span> [_subscriptionDictionary objectForKey:subscriptionNumber];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable == <span class="literal">nil</span>) &#123;</span><br><span class="line">        hashTable = [<span class="built_in">NSHashTable</span> weakObjectsHashTable];</span><br><span class="line">        [_subscriptionDictionary setObject:hashTable forKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        [_subscriptionDictionary removeObjectForKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(customer);</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable addObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable removeObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];<span class="comment">// 存储订阅号的字典</span></span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        <span class="comment">// 遍历订阅号</span></span><br><span class="line">        <span class="built_in">NSEnumerator</span> *enumerator = [hashTable objectEnumerator];</span><br><span class="line">        <span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;object = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">while</span> (object = [enumerator nextObject]) &#123;</span><br><span class="line">            <span class="comment">// 向每个订阅用户发送订阅订阅内容</span></span><br><span class="line">            <span class="keyword">if</span> ([object respondsToSelector:<span class="keyword">@selector</span>(subscriptionMessage:subscriptionNumber:)]) &#123;</span><br><span class="line">                [object subscriptionMessage:message subscriptionNumber:subscriptionNumber];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-3-2-使用通知中心"><a href="#4-4-3-2-使用通知中心" class="headerlink" title="4.4.3.2    使用通知中心"></a>4.4.3.2    使用通知中心</h4><p><em>SubscriptionServiceCenterProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SubscriptionServiceCenterProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *S<span class="built_in">CIENCE</span> = <span class="string">@"SCIENCE"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">SubscriptionServiceCenterProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅号</span></span><br><span class="line">    [SubscriptionServiceCenter createSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加订阅的用户到指定的刊物</span></span><br><span class="line">    [SubscriptionServiceCenter addCustomer:<span class="keyword">self</span></span><br><span class="line">                    withSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发型机构发送刊物</span></span><br><span class="line">    [SubscriptionServiceCenter sendMessage:<span class="string">@"V1.0"</span></span><br><span class="line">                      toSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳协议 SubscriptionServiceCenterProtocol</span></span><br><span class="line"><span class="comment">// 发行机构发送刊物时触发该方法的调用</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, message, subscriptionNumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-4-KVO与通知中心"><a href="#4-4-4-KVO与通知中心" class="headerlink" title="4.4.4    KVO与通知中心"></a>4.4.4    KVO与通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时简单介绍下 Cocoa 框架中的 KVO 与通知中心的使用。</p>
</blockquote>
<h4 id="4-4-4-1-Cocoa框架的通知中心"><a href="#4-4-4-1-Cocoa框架的通知中心" class="headerlink" title="4.4.4.1    Cocoa框架的通知中心"></a>4.4.4.1    Cocoa框架的通知中心</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>框架提供了自己的通知中心<code>API</code>，该通知中心就是通过观察者模式实现的。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加客户到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(notificationCenterEvent:)</span><br><span class="line">                                                 name:S<span class="built_in">CIENCE</span></span><br><span class="line">                                               object:<span class="string">@"v1.0"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:S<span class="built_in">CIENCE</span></span><br><span class="line">                                                        object:<span class="string">@"V1.0"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当客户收到消息时被调用的方法</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)notificationCenterEvent:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, sender);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// 从通知中心移除</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span></span><br><span class="line">                                              forKeyPath:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-4-2-KVO机制的观察者模式"><a href="#4-4-4-2-KVO机制的观察者模式" class="headerlink" title="4.4.4.2    KVO机制的观察者模式"></a>4.4.4.2    KVO机制的观察者模式</h4><blockquote>
<p><strong>说明：</strong><code>KVO</code>机制本身就是一种观察者模式。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<h5 id="通知中心"><a href="#通知中心" class="headerlink" title="通知中心"></a>通知中心</h5><p><em>Model.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h5><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Model *model;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅中心</span></span><br><span class="line">    <span class="keyword">self</span>.model = [Model new];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户添加订阅中心的"name"服务：当name属性被修改时会发送消息给观察者</span></span><br><span class="line">    [<span class="keyword">self</span>.model addObserver:<span class="keyword">self</span></span><br><span class="line">                 forKeyPath:<span class="string">@"name"</span></span><br><span class="line">                    options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">                    context:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 订阅中心发送消息（通过修改 name 属性值）</span></span><br><span class="line">    <span class="keyword">self</span>.model.name = <span class="string">@"V1.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 通过KVO该表属性时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">	<span class="comment">// 移除 KVO</span></span><br><span class="line">    [<span class="keyword">self</span>.model removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-5-原型模式和外观模式"><a href="#4-5-原型模式和外观模式" class="headerlink" title="4.5    原型模式和外观模式"></a>4.5    原型模式和外观模式</h2><h3 id="4-5-1-原型模式"><a href="#4-5-1-原型模式" class="headerlink" title="4.5.1    原型模式"></a>4.5.1    原型模式</h3><h4 id="4-5-1-1-模版的用处"><a href="#4-5-1-1-模版的用处" class="headerlink" title="4.5.1.1    模版的用处"></a>4.5.1.1    模版的用处</h4><blockquote>
<p><strong>用途：</strong>当要创建的对象有很多相似的细节的时候，就可以通过制作模版简化工作。</p>
</blockquote>
<h4 id="4-5-1-2-原型模式的原理"><a href="#4-5-1-2-原型模式的原理" class="headerlink" title="4.5.1.2    原型模式的原理"></a>4.5.1.2    原型模式的原理</h4><blockquote>
<p><strong>说明：</strong>定义一个协议，采纳该协议个类要实现<code>clone</code>方法，也就是具备拷贝自身的能力。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462191691369.png" alt="Alt text"></p>
</blockquote>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462192387967.png" alt="Alt text"></p>
<p><em>PrototypeCopyProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">PrototypeCopyProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  复制自己</span><br><span class="line"> *</span><br><span class="line"> *  @return 返回一个拷贝</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>)clone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">```	</span><br><span class="line">*StudentModel.h*</span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PrototypeCopyProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StudentModel</span> : <span class="title">NSObject</span> &lt;<span class="title">PrototypeCopyProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *address;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *totalScore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>StudentModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">StudentModel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)clone &#123;</span><br><span class="line">    <span class="comment">// 创建一个新的实例</span></span><br><span class="line">    StudentModel *student = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    <span class="comment">// 按照当前实例初始化新的实例</span></span><br><span class="line">    student.name = <span class="keyword">self</span>.name;</span><br><span class="line">    student.age = <span class="keyword">self</span>.age;</span><br><span class="line">    student.address = <span class="keyword">self</span>.address;</span><br><span class="line">    student.totalScore = <span class="keyword">self</span>.totalScore;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生1</span></span><br><span class="line">    StudentModel *stu1 = [[StudentModel alloc] init];</span><br><span class="line">    stu1.name = <span class="string">@"mengxiang"</span>;</span><br><span class="line">    stu1.age = @(<span class="number">1</span>);</span><br><span class="line">    stu1.address = <span class="string">@"海淀区"</span>;</span><br><span class="line">    stu1.totalScore = @(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生2</span></span><br><span class="line">    StudentModel *stu2 = [stu1 clone];<span class="comment">// 应用原型模式</span></span><br><span class="line">    stu2.name = <span class="string">@"Viking"</span>;</span><br><span class="line">    stu2.address = <span class="string">@"Northern Europe"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5-1-3-NSCoping协议的使用细节"><a href="#4-5-1-3-NSCoping协议的使用细节" class="headerlink" title="4.5.1.3    NSCoping协议的使用细节"></a>4.5.1.3    NSCoping协议的使用细节</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>通过<code>NSCoping</code>协议为原型模式提供了支持。<br><strong>注意：</strong></p>
<ul>
<li>深拷贝与浅拷贝</li>
<li>不支持<code>NSCopying</code>协议的对象<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462199219485.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-5-2-外观模式"><a href="#4-5-2-外观模式" class="headerlink" title="4.5.2    外观模式"></a>4.5.2    外观模式</h3><h4 id="4-5-2-1-如何去一个指定的地方"><a href="#4-5-2-1-如何去一个指定的地方" class="headerlink" title="4.5.2.1    如何去一个指定的地方"></a>4.5.2.1    如何去一个指定的地方</h4><blockquote>
<p><strong>说明：</strong>用来说明外观模式的一个显示场景</p>
<ul>
<li>自驾：自己负责路线相关的各种事务</li>
<li>坐火车：将细节交给黑盒</li>
</ul>
</blockquote>
<h4 id="4-5-2-2-外观模式的原理"><a href="#4-5-2-2-外观模式的原理" class="headerlink" title="4.5.2.2    外观模式的原理"></a>4.5.2.2    外观模式的原理</h4><blockquote>
<p><strong>说明：</strong>就是将细节封装了起来，使用时不需要了解细节<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462186013642.png" alt="Alt text"></p>
</blockquote>
<h4 id="4-5-2-3-如何绘制复杂的图形"><a href="#4-5-2-3-如何绘制复杂的图形" class="headerlink" title="4.5.2.3    如何绘制复杂的图形"></a>4.5.2.3    如何绘制复杂的图形</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462201625961.png" alt="Alt text"></p>
<h2 id="4-6-装饰"><a href="#4-6-装饰" class="headerlink" title="4.6    装饰"></a>4.6    装饰</h2><p><code>不改变原类，动态地扩展原类的功能</code></p>
<h3 id="4-6-1-照片与相框"><a href="#4-6-1-照片与相框" class="headerlink" title="4.6.1    照片与相框"></a>4.6.1    照片与相框</h3><blockquote>
<p><strong>课程说明：</strong>通过照片与相框之间的联系，来讲解何为装饰模式。</p>
</blockquote>
<h3 id="4-6-2-装饰模式的原理"><a href="#4-6-2-装饰模式的原理" class="headerlink" title="4.6.2    装饰模式的原理"></a>4.6.2    装饰模式的原理</h3><blockquote>
<p>基本原理<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410189425.png" alt="Alt text"></p>
<p>装饰起模式的优点<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410420677.png" alt="Alt text"></p>
<p> 装饰模式的使用场景</p>
</blockquote>
<p>不知道一个类的实现细节，只知道相关的接口，又需要扩展这个类的功能。</p>
<h3 id="4-6-3-实现装饰模式"><a href="#4-6-3-实现装饰模式" class="headerlink" title="4.6.3    实现装饰模式"></a>4.6.3    实现装饰模式</h3><blockquote>
<p><strong>课程说明：</strong>通过一个扩展游戏机手柄行为的事例，来实现装饰模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463490224877.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463495040772.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-6-4-category的使用"><a href="#4-6-4-category的使用" class="headerlink" title="4.6.4    category的使用"></a>4.6.4    category的使用</h3><blockquote>
<p><strong>课程说明：</strong>讲解 <code>Cocoa</code> 框架已经实现的装饰模式，并延伸讲解下如何给 <code>category</code> 添加属性。<br><strong>说明：</strong>利用<code>Objective-C</code>的动态运行时分配机制，你可以为现有的类添加方法或计算属性，这种机制称为类别(<code>category</code>)。<br><strong>注意：</strong>和装饰模式不同，这种扩展方式会导致原类型的改变。</p>
</blockquote>
<ol>
<li>原类型</li>
</ol>
<p><em>GamePad.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  上下左右的操作</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)up;</span><br><span class="line">- (<span class="keyword">void</span>)down;</span><br><span class="line">- (<span class="keyword">void</span>)left;</span><br><span class="line">- (<span class="keyword">void</span>)right;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  选择与开始的操作</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)select;</span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  按钮 A + B + X + Y</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)commandA;</span><br><span class="line">- (<span class="keyword">void</span>)commandB;</span><br><span class="line">- (<span class="keyword">void</span>)commandX;</span><br><span class="line">- (<span class="keyword">void</span>)commandY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePod.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span></span></span><br><span class="line">- (<span class="keyword">void</span>)up &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"up"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)down &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"down"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)left &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"left"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)right &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"right"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)select &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"select"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"start"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandA &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandA"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandB &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandB"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandX &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandX"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandY &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandY"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>扩展</li>
</ol>
<p><em>GamePad+Coin.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  游戏币</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span>  coin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePad+Coin.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为类和属性之间的关联key</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *_coinStr = <span class="string">@"_coinStr"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setCoin:(<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 将当前类（GamePad）和 coin 属性关联在一起</span></span><br><span class="line">    <span class="comment">// 也就是额外添加了一个属性</span></span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr, @(coin), OBJC_ASSO<span class="built_in">CIATION_ASSIGN</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 通过key扩区绑定到当前类的属性的值</span></span><br><span class="line">    <span class="built_in">NSNumber</span> *number = objc_getAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> number.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>使用扩展后的GamePod</li>
</ol>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">    GamePad *gamePad = [[GamePad alloc] init];</span><br><span class="line">    [gamePad up];</span><br><span class="line">    </span><br><span class="line">    gamePad.coin = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"coin %ld"</span>, (<span class="keyword">long</span>)gamePad.coin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-7-工厂"><a href="#4-7-工厂" class="headerlink" title="4.7    工厂"></a>4.7    工厂</h2><h3 id="4-7-1-制造手机与使用手机"><a href="#4-7-1-制造手机与使用手机" class="headerlink" title="4.7.1    制造手机与使用手机"></a>4.7.1    制造手机与使用手机</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463587653123.png" alt="Alt text"></p>
<h3 id="4-7-2-简单工厂"><a href="#4-7-2-简单工厂" class="headerlink" title="4.7.2    简单工厂"></a>4.7.2    简单工厂</h3><blockquote>
<p><strong>说明：</strong>将“产品”的生产任务封装在“工厂中”</p>
<ol>
<li>简化生产流程</li>
<li>隔离生产产品的细节</li>
<li>不同类型产品之间有着一些共同的功能</li>
<li>一个具体的工厂<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463799288205.png" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="案例：通过简单工厂获取手机实例"><a href="#案例：通过简单工厂获取手机实例" class="headerlink" title="案例：通过简单工厂获取手机实例"></a>案例：通过简单工厂获取手机实例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463798863229.png" alt="Alt text"></p>
<blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463743818102.png" alt="Alt text"></p>
<p>类图：通过</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463715567130.png" alt="Alt text|500x500"></p>
<blockquote>
<p>使用</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DeviceFactory.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过工厂创建手机</span></span><br><span class="line">    iPhoneDevice *iPhone = (iPhoneDevice *)[DeviceFactory deviceFactoryWithDeviceType:kiPhone];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用手机功能</span></span><br><span class="line">    [iPhone fingerprintIndentification];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-7-3-抽象工厂"><a href="#4-7-3-抽象工厂" class="headerlink" title="4.7.3    抽象工厂"></a>4.7.3    抽象工厂</h3><blockquote>
<p><strong>说明：</strong><code>客户端</code>通过<code>抽象工厂</code>创建具体的<code>工厂</code>，然后通过具体的<code>工厂</code>获取产品。相比简单工厂，抽象工厂多了一层抽象，在很多场景中可以比简单工厂更好地解耦。</p>
<ul>
<li>抽象工厂原理</li>
<li>抽象工厂抽象在哪里</li>
<li>抽象工厂使用场景</li>
</ul>
</blockquote>
<h4 id="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"><a href="#案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品" class="headerlink" title="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"></a>案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品</h4><blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816866737.png" alt="Alt text"></p>
<p>类图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816799001.png" alt="Alt text"></p>
<p>使用</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取工厂</span></span><br><span class="line">BaseFactory *factory = [FactoryManager factoryWithBrand:kGoogle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建商品</span></span><br><span class="line">BasePhone *phone = [factory createPhone];</span><br><span class="line">BaseWatch *watch = [factory createWatch];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, phone, watch);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-4-Cocoa-框架中的-NSNumber"><a href="#4-7-4-Cocoa-框架中的-NSNumber" class="headerlink" title="4.7.4    Cocoa 框架中的 NSNumber"></a>4.7.4    Cocoa 框架中的 NSNumber</h3><blockquote>
<p><strong>说明：</strong><code>NSNumber</code>本身是一个抽象工厂类，直接通过该类<code>init</code>一个实例会获得一个<code>nil</code>。<code>NSNumber</code>提供了一系列工厂方法来获取针对具体数值类型的工厂。<br><strong>注意：</strong><code>NSNumber</code>是针对<code>数值</code>的抽象工厂，产品是各种<code>数值</code>类型，而且这些<code>数值</code>之间可以进行类型转换。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于NSNumber是一个抽象工厂，这里只会返回一个 nil</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[<span class="built_in">NSNumber</span> alloc] init]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建具体的工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *number = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">100</span>];<span class="comment">// 通过Int类型的100获取一个工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *floatValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">100.</span>f];<span class="comment">// 通过浮点数100.f获取一个工厂实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用工厂实例生产具体的产品（具体类型的数字）</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [number charValue]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [floatValue charValue]);</span><br></pre></td></tr></table></figure>
<h2 id="4-8-桥接"><a href="#4-8-桥接" class="headerlink" title="4.8    桥接"></a>4.8    桥接</h2><blockquote>
<p><strong>说明：</strong>两类存在通信的实体，其实例实现各自的协议，两类实体的实例就可以正确通信。这种设计方式解耦了通信协议的定义和具体实例的实现。</p>
</blockquote>
<h3 id="4-8-1-遥控器与电视机"><a href="#4-8-1-遥控器与电视机" class="headerlink" title="4.8.1 遥控器与电视机"></a>4.8.1 遥控器与电视机</h3><blockquote>
<p><strong>例子：</strong>为遥控器和电视机分别定义了协议，采纳了协议的具体的遥控器和电视机之间只需完成各自的实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463818469080.png" alt="Alt text|400x250"></p>
</blockquote>
<h3 id="4-8-2-桥接模式原理"><a href="#4-8-2-桥接模式原理" class="headerlink" title="4.8.2 桥接模式原理"></a>4.8.2 桥接模式原理</h3><blockquote>
<p><strong>目的：</strong> 把抽象层次结构从具体的实现分离出来，使其能够独立变更。<br><strong>抽象层：</strong>定义了共客户端使用的上层抽象接口。<br><strong>实现层：</strong>定义了供抽象层使用的底层接口。<br><strong>桥接：</strong>实现类的引用被封装到抽象层的实例中，桥接就形成了。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839147515.png" alt="Alt text"></p>
<h3 id="4-8-3-设计游戏机模拟器"><a href="#4-8-3-设计游戏机模拟器" class="headerlink" title="4.8.3 设计游戏机模拟器"></a>4.8.3 设计游戏机模拟器</h3><ul>
<li>游戏机模拟器的功能定义</li>
<li>按钮协议的制定</li>
<li>游戏机模拟器的实现<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839248044.png" alt="Alt text"></li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463845234221.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GBA系统 ＋ GBA执行器 */</span></span><br><span class="line"><span class="comment">// 创建GBA系统</span></span><br><span class="line">AbstractSystem *gbaSystem = [[GBASystem alloc] init];</span><br><span class="line"><span class="comment">// 设置GBA执行器</span></span><br><span class="line">gbaSystem.implementor = [[GBAImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[gbaSystem loadSystem];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* PSP系统 ＋ PSP执行器 */</span></span><br><span class="line"><span class="comment">// 创建PSP系统</span></span><br><span class="line">AbstractSystem *pspSystem = [[PSPSystem alloc] init];</span><br><span class="line"><span class="comment">// 设置PSP执行器</span></span><br><span class="line">pspSystem.implementor = [[PSPImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[pspSystem loadSystem];</span><br></pre></td></tr></table></figure>
<h2 id="4-9-代理"><a href="#4-9-代理" class="headerlink" title="4.9    代理"></a>4.9    代理</h2><h3 id="4-9-1-代理模式"><a href="#4-9-1-代理模式" class="headerlink" title="4.9.1 代理模式"></a>4.9.1 代理模式</h3><blockquote>
<p><strong>说明：</strong>当一个对象和另一个对象必然耦合的时候，为了降低这种耦合，可以选择和代理对象耦和。代理对象可以是实现了代理协议的任意对象，由于采纳代理协议的对象相比具体对象更灵活且可配置，从而降低了耦和度。<br><strong>注意：</strong>代理对象建议修饰为<code>weak</code>，从而有助于减低消耗。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464019108656.png" alt="Alt text"></p>
<h4 id="案例：顾客和经销商"><a href="#案例：顾客和经销商" class="headerlink" title="案例：顾客和经销商"></a>案例：顾客和经销商</h4><blockquote>
<p>顾客的购买行为代理给经销商</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463899846934.png" alt="Alt text"></p>
<p><em>Customer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Customer</span>;</span></span><br><span class="line"><span class="comment">// 代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CustomerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Customer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理对象(经销商)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;CustomerDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购买</span></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Cosutomer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Customer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="comment">// 确保设置了代理对象，且代理对象正确采纳了协议</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(customer:buyItemCount:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate customer:<span class="keyword">self</span></span><br><span class="line">                   buyItemCount:count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Dealer</span> : <span class="title">NSObject</span> &lt;<span class="title">CustomerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dealer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议，实现方法</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, (<span class="keyword">long</span>)count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 顾客</span></span><br><span class="line">    Customer *customer = [[Customer alloc] init];</span><br><span class="line">    <span class="comment">// 经销商</span></span><br><span class="line">    Dealer *dealer = [[Dealer alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将经销商实例做为代理对象</span></span><br><span class="line">    customer.delegate = dealer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户购买（会代理到dealer的相应方法去处理）</span></span><br><span class="line">    [customer buyItemCount:<span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-2-代理与协议"><a href="#4-9-2-代理与协议" class="headerlink" title="4.9.2 代理与协议"></a>4.9.2 代理与协议</h3><blockquote>
<p><code>代理对象</code>本质上是<code>让对象采纳协议</code>的一种特殊情况。和单纯要求对象采纳某种协议相比，代理对象承担者完成代理任务的同时降低与被调用者之间的耦和度的职能。</p>
</blockquote>
<h4 id="案例：单纯使用协议"><a href="#案例：单纯使用协议" class="headerlink" title="案例：单纯使用协议"></a>案例：单纯使用协议</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463922342138.png" alt="Alt text"></p>
<p><em>TCPProtocol.h</em></p>
<blockquote>
<p><strong>说明：</strong>定义协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TCPProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">// 获取源端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort;</span><br><span class="line"><span class="comment">// 获取目的地端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.h</em></p>
<blockquote>
<p><strong>说明：</strong>采纳协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span> &lt;<span class="title">TCPProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<blockquote>
<p><strong>说明：</strong>实现协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> sourcePort;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 tcp 数据源</span></span><br><span class="line">    Model *tcpData = [[Model alloc] init];</span><br><span class="line">    <span class="comment">// 通过 tcp 数据源获取 tcp 数据</span></span><br><span class="line">    [<span class="keyword">self</span> accessTCPData:tcpData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取 tcp 数据</span><br><span class="line"> *</span><br><span class="line"> *  @param data 采纳了 TCP 协议的数据</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessTCPData:(<span class="keyword">id</span> &lt;TCPProtocol&gt;)data &#123;</span><br><span class="line">    <span class="keyword">self</span>.sourcePort = [data sourcePort];</span><br><span class="line">    <span class="keyword">self</span>.destinationPort = [data destinationPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-3-用NSProxy-实现的代理模式"><a href="#4-9-3-用NSProxy-实现的代理模式" class="headerlink" title="4.9.3 用NSProxy 实现的代理模式"></a>4.9.3 用NSProxy 实现的代理模式</h3><blockquote>
<p><code>NSProxy</code>：没有父类，和<code>NSObject</code>是一个级别的<br><strong>用途：</strong>可以方便地向代理对象发送一系列消息。</p>
</blockquote>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464018921308.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建代理</span></span><br><span class="line">ConcreteProxy *proxy = [ConcreteProxy alloc];</span><br><span class="line"><span class="comment">// 设置代理对象</span></span><br><span class="line">proxy.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 派发消息</span></span><br><span class="line">[proxy helloWorld];</span><br><span class="line">[proxy goodBye];</span><br></pre></td></tr></table></figure>
<h2 id="4-10-单例"><a href="#4-10-单例" class="headerlink" title="4.10    单例"></a>4.10    单例</h2><h3 id="4-10-1-单例模式"><a href="#4-10-1-单例模式" class="headerlink" title="4.10.1 单例模式"></a>4.10.1 单例模式</h3><h4 id="单例模式的基本原理"><a href="#单例模式的基本原理" class="headerlink" title="单例模式的基本原理"></a>单例模式的基本原理</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464186654392.png" alt="Alt text"></p>
<h4 id="单例模式用以解决何种问题"><a href="#单例模式用以解决何种问题" class="headerlink" title="单例模式用以解决何种问题"></a>单例模式用以解决何种问题</h4><blockquote>
<p>保证某个类只会存在一个全局的实例，全局共享</p>
</blockquote>
<h4 id="单例模式的优缺点"><a href="#单例模式的优缺点" class="headerlink" title="单例模式的优缺点"></a>单例模式的优缺点</h4><ul>
<li>优点：共享实例</li>
<li>缺点：使使用到单例实例的类之间耦和在一起</li>
</ul>
<h4 id="案例：存储用户信息的单例类"><a href="#案例：存储用户信息的单例类" class="headerlink" title="案例：存储用户信息的单例类"></a>案例：存储用户信息的单例类</h4><p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取单例</span><br><span class="line"> *</span><br><span class="line"> *  @return 单例实例</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="comment">// 使用全局变量保存单例实例</span></span><br><span class="line">    <span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predict;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predict, ^&#123;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>使用</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, center.name);</span><br></pre></td></tr></table></figure>
<h3 id="4-10-2-编写严格的单例"><a href="#4-10-2-编写严格的单例" class="headerlink" title="4.10.2 编写严格的单例"></a>4.10.2 编写严格的单例</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>防止继承：在<code>init</code>构造器中判断当前类名，当子类调用<code>init</code>或工厂方法创建实例时中断程序</li>
<li>确保实例对象只出现一个：限制<code>init</code>构造器只能在获取实例的工厂方法中调用，而且只调用一次</li>
</ul>
</blockquote>
<p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"><span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predicate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predicate, ^&#123;</span><br><span class="line">        center = (UserInfoManagerCenter *)<span class="string">@"UserInfoManagerCenter"</span>;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">    <span class="comment">// 获取当前实例的类名</span></span><br><span class="line">    <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="comment">// 是子类调用该方法则中断程序</span></span><br><span class="line">    <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *string = (<span class="built_in">NSString</span> *)center;</span><br><span class="line">    <span class="keyword">if</span> ([string isKindOfClass:[<span class="built_in">NSString</span> class]] == <span class="literal">YES</span> &amp;&amp; [string isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">            <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">            <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">            <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 正确获取单例的方法 */</span></span><br><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无效的方式:会引起程序崩溃 */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [NewManagerCenter managerCenter]);<span class="comment">// 试图创建子类实例</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[UserInfoManagerCenter alloc] init]);<span class="comment">// 试图直接调用构造器</span></span><br></pre></td></tr></table></figure>
<h3 id="4-10-3-优化本地存储"><a href="#4-10-3-优化本地存储" class="headerlink" title="4.10.3 优化本地存储"></a>4.10.3 优化本地存储</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>用单例设计存储数据接口</li>
<li>用单例接口隔离实现细节</li>
<li>在单例提供接口的基础上进行上层封装</li>
</ul>
<p><strong>扩展：</strong>使用<a href="https://github.com/nicklockwood/FastCoding" target="_blank" rel="external"> FastCoding </a>替代<code>NSCoding</code>存储数据<br><strong>注意：</strong>启用<code>ARC</code>时<code>FastCoding</code>运行会比较慢，建议关闭</p>
<ul>
<li>文件启用了<code>ARC</code>是代码给出了警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464361708327.png" alt="Alt text"></li>
<li>通过关闭<code>FastCoder</code>对应的文件的<code>ARC</code>清除警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464362026510.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464364328834.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将相对复杂的对象数据存储到用户首选项（借由对象的扩展）</span></span><br><span class="line">StudentModel *student = [[StudentModel alloc] init];</span><br><span class="line">student.name = <span class="string">@"A"</span>;</span><br><span class="line"><span class="built_in">NSArray</span> *array = @[[InfoModel new], [InfoModel new], [InfoModel new]];</span><br><span class="line">student.datas = array;</span><br><span class="line">[student storeValueWithKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从用户首选项中取出数据</span></span><br><span class="line">StudentModel *tmpStudent = [StudentModel valueByKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.name);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.datas);</span><br></pre></td></tr></table></figure>
<h2 id="4-11-备忘录"><a href="#4-11-备忘录" class="headerlink" title="4.11    备忘录"></a>4.11    备忘录</h2><h3 id="4-11-1-如何存储记录"><a href="#4-11-1-如何存储记录" class="headerlink" title="4.11.1    如何存储记录"></a>4.11.1    如何存储记录</h3><blockquote>
<p><strong>课程说明：</strong>用几个简单的示例来说明如何存储纪录，并引申出什么是备忘录模式。</p>
</blockquote>
<ul>
<li>存储记录的必要性</li>
<li>记录的唯一标识符</li>
<li>存储纪录和取出记录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447294270.png" alt="Alt text"></li>
</ul>
<h3 id="4-11-2-备忘录模式"><a href="#4-11-2-备忘录模式" class="headerlink" title="4.11.2 备忘录模式"></a>4.11.2 备忘录模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464417280472.png" alt="Alt text"></p>
<ul>
<li>设计存储中心</li>
<li>制定存储接口</li>
<li>实现存储机制</li>
</ul>
<h3 id="4-11-3-优化存储方案"><a href="#4-11-3-优化存储方案" class="headerlink" title="4.11.3    优化存储方案"></a>4.11.3    优化存储方案</h3><ul>
<li>统一存储规范</li>
<li>实现灵活多变的存储机制</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464445381861.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Apple *apple = [[Apple alloc] init];</span><br><span class="line">apple.name = <span class="string">@"laputa-er"</span>;</span><br><span class="line">apple.age = @(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[apple saveStateWithKey:<span class="string">@"birth"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复到指定的状态</span></span><br><span class="line">[apple recoverFromStateWithKey:<span class="string">@"birth"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="4-11-4-恢复-UIView-的状态"><a href="#4-11-4-恢复-UIView-的状态" class="headerlink" title="4.11.4    恢复 UIView 的状态"></a>4.11.4    恢复 UIView 的状态</h3><blockquote>
<p><strong>摘要：</strong>可以借助上面实现的备忘录模式存储／恢复<code>UIView</code>的状态。</p>
</blockquote>
<h4 id="存储UIView的问题"><a href="#存储UIView的问题" class="headerlink" title="存储UIView的问题"></a>存储UIView的问题</h4><ol>
<li><code>UIView</code>实现了<code>NSCoding</code>协议，但没有实现<code>NSCopy</code>协议。所以，<code>UIView</code>可以被存储下来，但无法拷贝副本</li>
<li><code>NSCoding</code>协议只能存储对象的所有数据，不能仅存储特定的状态数据（比如<code>frame</code>值）</li>
</ol>
<h4 id="使用备忘录模式"><a href="#使用备忘录模式" class="headerlink" title="使用备忘录模式"></a>使用备忘录模式</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 UIView</span></span><br><span class="line">DemoView *demoView = [[DemoView alloc] init];</span><br><span class="line">demoView.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[demoView saveStateWithKey:<span class="string">@"A"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复状态</span></span><br><span class="line">[demoView recoverFromStateWithKey:<span class="string">@"A"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="4-12-生成器"><a href="#4-12-生成器" class="headerlink" title="4.12    生成器"></a>4.12    生成器</h2><blockquote>
<p><strong>说明：</strong>有时，构建某些对象有多种不同的方式。如果这些逻辑包含在构建这些对象的类的单一方法中，构建的逻辑会非常的荒唐（例如，针对各种构建需求的一大片 <code>if-else</code> 或者 <code>switch-case</code> 语句）。如果能够把构建过程分解为<code>客户-指导者-生成器</code>的关系，那么过程将更容易管理与复用。针对此类关系的设计模式称为<code>生成器</code>。</p>
</blockquote>
<h3 id="4-12-1-建造房子的承包商"><a href="#4-12-1-建造房子的承包商" class="headerlink" title="4.12.1 建造房子的承包商"></a>4.12.1 建造房子的承包商</h3><blockquote>
<p><strong>课程说明：</strong>本课时用一个生活中建造房子例子说明并引申出何为生成器模式</p>
<ul>
<li>如何建造房子</li>
<li>建造过程的模块化处理 </li>
<li>不同模块找不同的承包商</li>
</ul>
<p><strong>使用生成器模式的优点：</strong></p>
<ul>
<li>不需要知道细节</li>
<li>模块化处理</li>
<li>很好的组合特性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-12-2-生成器模式"><a href="#4-12-2-生成器模式" class="headerlink" title="4.12.2 生成器模式"></a>4.12.2 生成器模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447882554.png" alt="Alt text"></p>
<h3 id="4-12-3-制造汽车的流程"><a href="#4-12-3-制造汽车的流程" class="headerlink" title="4.12.3 制造汽车的流程"></a>4.12.3 制造汽车的流程</h3><blockquote>
<p><strong>说明：</strong>使用生成器模式来制造一辆汽车。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500610532.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500840393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建组装着（指挥者）</span></span><br><span class="line"><span class="keyword">self</span>.builder = [[Builder alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定承包商</span></span><br><span class="line"><span class="keyword">self</span>.builder.engine = [[YEngine alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.wheels = [[Wheels alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.door = [[Door alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构件所有部件</span></span><br><span class="line">[<span class="keyword">self</span>.builder buildAllParts];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取产品信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.builder.productsInfo);</span><br></pre></td></tr></table></figure>
<h2 id="4-13-命令"><a href="#4-13-命令" class="headerlink" title="4.13    命令"></a>4.13    命令</h2><blockquote>
<p><strong>命令模式：</strong>在软件系统中，<code>行为请求者</code>与<code>行为执行者</code>通常呈现一种“紧耦合”。但在某些场合，比如要对行为进行<code>记录、撤销/重做、事务</code>等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将<code>行为请求者</code>与<code>行为执行者</code>解耦，将行为抽象成对象，实现两者之间的松耦合，这就是我们这门课程所要讲的<code>命令模式</code>。 </p>
</blockquote>
<h3 id="4-13-1-电视机、遥控器与接收器之间的关系"><a href="#4-13-1-电视机、遥控器与接收器之间的关系" class="headerlink" title="4.13.1 电视机、遥控器与接收器之间的关系"></a>4.13.1 电视机、遥控器与接收器之间的关系</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="Alt text"></p>
<ul>
<li>遥控器与接收器并非必要的设备</li>
<li>接收器转换遥控器的信号</li>
</ul>
<h3 id="4-13-2-命令模式"><a href="#4-13-2-命令模式" class="headerlink" title="4.13.2 命令模式"></a>4.13.2 命令模式</h3><ul>
<li>命令的发送者和命令的执行者之间完全解耦</li>
<li>命令可以回退（撤销）</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464515129490.png" alt="Alt text"></p>
<h3 id="4-13-3-改变一个视图的明暗程度"><a href="#4-13-3-改变一个视图的明暗程度" class="headerlink" title="4.13.3 改变一个视图的明暗程度"></a>4.13.3 改变一个视图的明暗程度</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331xcode.gif" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464531258992.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Receiver.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Invoker.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DarkerCommand.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LighterCommand.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 按钮的tag</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSInteger</span> &#123;</span><br><span class="line">    kAddButtonTag = <span class="number">10</span>, <span class="comment">// 增加按钮tag枚举值</span></span><br><span class="line">    kDelButtonTag, <span class="comment">// 减少按钮tag枚举值</span></span><br><span class="line">    kRolButtonTag, <span class="comment">// 回退按钮tag枚举值</span></span><br><span class="line">&#125; ViewControllerEnumValue;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *addButton;<span class="comment">// 增加亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *delButton;<span class="comment">// 减少亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *rolButton;<span class="comment">// 退回按钮</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Receiver *receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化接收器</span></span><br><span class="line">    <span class="keyword">self</span>.receiver = [[Receiver alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.receiver.clientView = <span class="keyword">self</span>.view;<span class="comment">// 关联客户端视图（遥控器）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButtons];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButtons &#123;</span><br><span class="line">    <span class="comment">/*1. 初始化按钮*/</span></span><br><span class="line">    <span class="comment">// 减少亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.delButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.delButton.tag = kDelButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.delButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitle:<span class="string">@"-"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.addButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">40</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.addButton.tag = kAddButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.addButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitle:<span class="string">@"+"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 回退按钮</span></span><br><span class="line">    <span class="keyword">self</span>.rolButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">80</span>, <span class="number">25</span>, <span class="number">90</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.rolButton.tag = kRolButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.rolButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitle:<span class="string">@"回退"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*2. 注册事件*/</span></span><br><span class="line">    [<span class="keyword">self</span>.delButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*3. 添加到视图*/</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.delButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.rolButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  为按钮绑定事件</span><br><span class="line"> *</span><br><span class="line"> *  @param button 需要绑定事件的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    <span class="keyword">if</span> (button.tag == kAddButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"增加亮度"</span>);</span><br><span class="line">        LighterCommand *command = [[LighterCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                 parameter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];<span class="comment">// 添加并执行命令</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kDelButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"减少亮度"</span>);</span><br><span class="line">        DarkerCommand *command = [[DarkerCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                paramter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kRolButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"回退操作"</span>);</span><br><span class="line">        [[Invoker shareInstance] rollBack];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-14-组合"><a href="#4-14-组合" class="headerlink" title="4.14    组合"></a>4.14    组合</h2><blockquote>
<p><strong>说明：</strong>将对象组合成树形结构以表示<code>部分-整体</code>的层次结构，组合模式使得用户对单个对象和组合对象的使用具有一致性。组合设计模式可以解决某些线性结构无法解决的难题（如编写文件夹目录结构等类似问题），掌握它具有很实用的意义。 </p>
</blockquote>
<h3 id="4-14-1-树形结构"><a href="#4-14-1-树形结构" class="headerlink" title="4.14.1    树形结构"></a>4.14.1    树形结构</h3><blockquote>
<p><strong>课程说明：</strong>讲解树形结构，并实现一个简易的二叉树，对于后续的组合设计模式的理解很有帮助。</p>
<ul>
<li>树形结构原理</li>
<li>简易的二叉树</li>
<li>用递归遍历树形结构节点</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464533251952.png" alt="Alt text|200x300"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当前节点名</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  左节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *leftNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  右节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rightNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    <span class="comment">// 创建节点实例（考虑子类的情况，使用 self class 创建实例）</span></span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  根节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rootNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建根节点</span></span><br><span class="line">    <span class="keyword">self</span>.rootNode = [Node nodeWithName:<span class="string">@"A"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"B"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"C"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"D"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"E"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"F"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历二叉树</span></span><br><span class="line">    [<span class="keyword">self</span> treeInfomationWithNode:<span class="keyword">self</span>.rootNode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  往根节点上插入节点</span><br><span class="line"> *</span><br><span class="line"> *  @param tree 根节点</span><br><span class="line"> *  @param node 被插入的节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)insertNodeTree:(Node *)tree node:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tree.leftNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.leftNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (tree.rightNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.rightNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:tree.leftNode node:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遍历二叉树</span><br><span class="line"> *</span><br><span class="line"> *  @param node 根节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)treeInfomationWithNode:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node.leftNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.leftNode];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.nodeName);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (node.rightNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.rightNode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-2-组合模式"><a href="#4-14-2-组合模式" class="headerlink" title="4.14.2    组合模式"></a>4.14.2    组合模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464611058484.png" alt="Alt text"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  节点名字</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加子节点</span><br><span class="line"> *</span><br><span class="line"> *  @param nodes 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)nodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  删除字节点</span><br><span class="line"> *</span><br><span class="line"> *  @param node 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  打印 Node</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)operation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-3-编写文件夹系统"><a href="#4-14-3-编写文件夹系统" class="headerlink" title="4.14.3 编写文件夹系统"></a>4.14.3 编写文件夹系统</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464616045947.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464676034326.png" alt="Alt text"></p>
<h2 id="4-15-迭代器"><a href="#4-15-迭代器" class="headerlink" title="4.15    迭代器"></a>4.15    迭代器</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示，这种模式叫迭代器模式，<code>Cocoa</code> 框架中的 <code>NSEnumerator</code> 就是迭代器模式的具体实现。学习迭代器模式有助于理解线性表结构的常规使用，对于优化具备线性表结构的类有实际意义。 </p>
</blockquote>
<h3 id="4-15-1-线性表"><a href="#4-15-1-线性表" class="headerlink" title="4.15.1 线性表"></a>4.15.1 线性表</h3><blockquote>
<p><strong>课程说明：</strong>讲解常用线性表基本原理，对于理解何为迭代器模式很有帮助。<br><strong>线性表：</strong>线性表中数据元素之间的关系是一对一的关系，即除了第一个和最后一个数据元素之外，其它数据元素都是首尾相接的（注意，这句话只适用大部分线性表，而不是全部。比如，循环链表逻辑层次上也是一种线性表（存储层次上属于链式存储），但是把最后一个数据元素的尾指针指向了哨位结点）。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700648380.png" alt="Alt text"></p>
<blockquote>
<p>栈和队列就是典型的线性表<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700681237.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-15-2-迭代器模式"><a href="#4-15-2-迭代器模式" class="headerlink" title="4.15.2 迭代器模式"></a>4.15.2 迭代器模式</h3><blockquote>
<p><strong>课程说明：</strong>讲解迭代器模式基本原理，并简单介绍下 <code>Cocoa</code> 框架已经实现的迭代器。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464708309582.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 系统自身的集合和迭代器 */</span></span><br><span class="line"><span class="comment">// 创建集合对象</span></span><br><span class="line"><span class="built_in">NSArray</span> *datas = @[<span class="string">@"A"</span>, <span class="string">@"B"</span>, <span class="string">@"C"</span>, <span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *iterator = [datas objectEnumerator];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器访问元素</span></span><br><span class="line"><span class="keyword">id</span> arrObj = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (arrObj = [iterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, arrObj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义的集合和迭代器 */</span></span><br><span class="line"><span class="keyword">self</span>.list = [[LinkedList alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"A"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"B"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"C"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line">LinkedListIterator *linkedIterator = [LinkedListIterator linkedListIteratorWithLinkedList:<span class="keyword">self</span>.list];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器遍历元素</span></span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (node = [linkedIterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-15-3-实现组合对象的迭代器"><a href="#4-15-3-实现组合对象的迭代器" class="headerlink" title="4.15.3 实现组合对象的迭代器"></a>4.15.3 实现组合对象的迭代器</h3><blockquote>
<p><strong>课程说明：</strong>实现一个组合对象的迭代器，并遍历出该组合对象中我们需要关心的元素。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464751736763.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Custom<span class="built_in">UIView</span> *custom<span class="built_in">UIView</span> = [[Custom<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">[custom<span class="built_in">UIView</span> resetIterator];</span><br><span class="line"><span class="keyword">while</span> (node = [custom<span class="built_in">UIView</span> nextObject]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/14/JK_IOS高级_3  音频视频处理/" rel="next" title="3 音频视频处理">
                <i class="fa fa-chevron-left"></i> 3 音频视频处理
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/15/imooc_iOS_When iOS loves JS/" rel="prev" title="When iOS loves JS">
                When iOS loves JS <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/06/03/JK_IOS高级_4 设计模式/"
           data-title="4 设计模式" data-url="http://laputa-er.github.io/2016/06/03/JK_IOS高级_4 设计模式/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">100</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-iOS设计模式简介"><span class="nav-text">4.1    iOS设计模式简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-编码是门艺术"><span class="nav-text">4.1.1    编码是门艺术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-设计模式的基本原则"><span class="nav-text">4.1.2    设计模式的基本原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-设计模式的类型"><span class="nav-text">4.1.3    设计模式的类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-适配器"><span class="nav-text">4.2    适配器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-何为适配器模式"><span class="nav-text">4.2.1    何为适配器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-数据直接适配带来的困境"><span class="nav-text">4.2.2    数据直接适配带来的困境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-使用适配器模式"><span class="nav-text">4.2.3    使用适配器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-1-类适配器"><span class="nav-text">4.2.3.1    类适配器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-2-对象适配器"><span class="nav-text">4.2.3.2        对象适配器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-适配器模式的优缺点"><span class="nav-text">4.2.4    适配器模式的优缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-策略"><span class="nav-text">4.3    策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-if-else-的问题"><span class="nav-text">4.3.1    if - else 的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-策略模式的原理"><span class="nav-text">4.3.2    策略模式的原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-策略模式的使用"><span class="nav-text">4.3.3    策略模式的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-策略模式的优缺点"><span class="nav-text">4.3.4    策略模式的优缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-观察者"><span class="nav-text">4.4    观察者</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-如何订阅一本杂志"><span class="nav-text">4.4.1    如何订阅一本杂志</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-1-如何订阅一本杂志"><span class="nav-text">4.4.1.1    如何订阅一本杂志</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-通知中心的抽象设计"><span class="nav-text">4.4.2    通知中心的抽象设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-3-实现通知中心"><span class="nav-text">4.4.3    实现通知中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-3-1-实现通知中心类"><span class="nav-text">4.4.3.1    实现通知中心类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-3-2-使用通知中心"><span class="nav-text">4.4.3.2    使用通知中心</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-4-KVO与通知中心"><span class="nav-text">4.4.4    KVO与通知中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-4-1-Cocoa框架的通知中心"><span class="nav-text">4.4.4.1    Cocoa框架的通知中心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-4-2-KVO机制的观察者模式"><span class="nav-text">4.4.4.2    KVO机制的观察者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#通知中心"><span class="nav-text">通知中心</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#演示"><span class="nav-text">演示</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-原型模式和外观模式"><span class="nav-text">4.5    原型模式和外观模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-1-原型模式"><span class="nav-text">4.5.1    原型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-1-模版的用处"><span class="nav-text">4.5.1.1    模版的用处</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-2-原型模式的原理"><span class="nav-text">4.5.1.2    原型模式的原理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#案例"><span class="nav-text">案例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-1-3-NSCoping协议的使用细节"><span class="nav-text">4.5.1.3    NSCoping协议的使用细节</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-2-外观模式"><span class="nav-text">4.5.2    外观模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-1-如何去一个指定的地方"><span class="nav-text">4.5.2.1    如何去一个指定的地方</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-2-外观模式的原理"><span class="nav-text">4.5.2.2    外观模式的原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-2-3-如何绘制复杂的图形"><span class="nav-text">4.5.2.3    如何绘制复杂的图形</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-装饰"><span class="nav-text">4.6    装饰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-1-照片与相框"><span class="nav-text">4.6.1    照片与相框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-2-装饰模式的原理"><span class="nav-text">4.6.2    装饰模式的原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-3-实现装饰模式"><span class="nav-text">4.6.3    实现装饰模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-4-category的使用"><span class="nav-text">4.6.4    category的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7-工厂"><span class="nav-text">4.7    工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-1-制造手机与使用手机"><span class="nav-text">4.7.1    制造手机与使用手机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-2-简单工厂"><span class="nav-text">4.7.2    简单工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例：通过简单工厂获取手机实例"><span class="nav-text">案例：通过简单工厂获取手机实例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-3-抽象工厂"><span class="nav-text">4.7.3    抽象工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"><span class="nav-text">案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-4-Cocoa-框架中的-NSNumber"><span class="nav-text">4.7.4    Cocoa 框架中的 NSNumber</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8-桥接"><span class="nav-text">4.8    桥接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-1-遥控器与电视机"><span class="nav-text">4.8.1 遥控器与电视机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-2-桥接模式原理"><span class="nav-text">4.8.2 桥接模式原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-3-设计游戏机模拟器"><span class="nav-text">4.8.3 设计游戏机模拟器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例-1"><span class="nav-text">案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-9-代理"><span class="nav-text">4.9    代理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-1-代理模式"><span class="nav-text">4.9.1 代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例：顾客和经销商"><span class="nav-text">案例：顾客和经销商</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用"><span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-2-代理与协议"><span class="nav-text">4.9.2 代理与协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例：单纯使用协议"><span class="nav-text">案例：单纯使用协议</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9-3-用NSProxy-实现的代理模式"><span class="nav-text">4.9.3 用NSProxy 实现的代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#案例-2"><span class="nav-text">案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-10-单例"><span class="nav-text">4.10    单例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-10-1-单例模式"><span class="nav-text">4.10.1 单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式的基本原理"><span class="nav-text">单例模式的基本原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式用以解决何种问题"><span class="nav-text">单例模式用以解决何种问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式的优缺点"><span class="nav-text">单例模式的优缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#案例：存储用户信息的单例类"><span class="nav-text">案例：存储用户信息的单例类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-10-2-编写严格的单例"><span class="nav-text">4.10.2 编写严格的单例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-10-3-优化本地存储"><span class="nav-text">4.10.3 优化本地存储</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-11-备忘录"><span class="nav-text">4.11    备忘录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-11-1-如何存储记录"><span class="nav-text">4.11.1    如何存储记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-11-2-备忘录模式"><span class="nav-text">4.11.2 备忘录模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-11-3-优化存储方案"><span class="nav-text">4.11.3    优化存储方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-11-4-恢复-UIView-的状态"><span class="nav-text">4.11.4    恢复 UIView 的状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#存储UIView的问题"><span class="nav-text">存储UIView的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用备忘录模式"><span class="nav-text">使用备忘录模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-12-生成器"><span class="nav-text">4.12    生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-12-1-建造房子的承包商"><span class="nav-text">4.12.1 建造房子的承包商</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-12-2-生成器模式"><span class="nav-text">4.12.2 生成器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-12-3-制造汽车的流程"><span class="nav-text">4.12.3 制造汽车的流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-13-命令"><span class="nav-text">4.13    命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-13-1-电视机、遥控器与接收器之间的关系"><span class="nav-text">4.13.1 电视机、遥控器与接收器之间的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-13-2-命令模式"><span class="nav-text">4.13.2 命令模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-13-3-改变一个视图的明暗程度"><span class="nav-text">4.13.3 改变一个视图的明暗程度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-14-组合"><span class="nav-text">4.14    组合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-14-1-树形结构"><span class="nav-text">4.14.1    树形结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-14-2-组合模式"><span class="nav-text">4.14.2    组合模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-14-3-编写文件夹系统"><span class="nav-text">4.14.3 编写文件夹系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-15-迭代器"><span class="nav-text">4.15    迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-15-1-线性表"><span class="nav-text">4.15.1 线性表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-15-2-迭代器模式"><span class="nav-text">4.15.2 迭代器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-15-3-实现组合对象的迭代器"><span class="nav-text">4.15.3 实现组合对象的迭代器</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
