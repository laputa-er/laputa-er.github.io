<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/24/Blog_webpack入坑之旅/" itemprop="url">
                  webpack入坑之旅
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-24T11:29:16+08:00" content="2016-08-24">
              2016-08-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>博客链接：</strong><a href="http://guowenfh.github.io/2016/03/24/vue-webpack-01-base/" target="_blank" rel="external">http://guowenfh.github.io/2016/03/24/vue-webpack-01-base/</a><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i webpack -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目初始化</span></span><br><span class="line">$ mkdir vue_by_webpack_blog &amp;&amp; <span class="built_in">cd</span> vue_by_webpack_blog</span><br><span class="line">$ npm init</span><br><span class="line">$ npm i webpack -D <span class="comment"># --save-dev</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><em>目录</em><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure></p>
<h1 id="1-最简单的开始"><a href="#1-最简单的开始" class="headerlink" title="1 最简单的开始"></a>1 最简单的开始</h1><p>不使用 <code>webpack</code> 配置文件</p>
<p><em>目录</em><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment">#1</span></span><br><span class="line">├── first.js <span class="comment">#2</span></span><br><span class="line">├── index.html <span class="comment">#3</span></span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** entry.js **/</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).innerHTML = <span class="string">"第一个成功打包的程序"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./first.js'</span>);</span><br></pre></td></tr></table></figure></p>
<p><em># 2 first.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> h2 = <span class="built_in">document</span>.createElement(<span class="string">'h2'</span>);</span><br><span class="line">h2.innerHTML = <span class="string">'不是吧，那么快就第二个打包程序了'</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(h2);</span><br></pre></td></tr></table></figure></p>
<p><em>#3 index.html</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入 webpack 生成的文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack entry.js bundle.js <span class="comment"># 打包</span></span><br><span class="line"></span><br><span class="line">Hash: bd78725bb04725a3c1f9</span><br><span class="line">Version: webpack 1.13.1</span><br><span class="line">Time: 88ms</span><br><span class="line">    Asset     Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  1.67 kB       0  [emitted]  main</span><br><span class="line">   [0] ./entry.js 97 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./first.js 104 bytes &#123;0&#125; [built]</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1468494421937.png" alt="Alt text"></p>
<h1 id="2-loader"><a href="#2-loader" class="headerlink" title="2 loader"></a>2 loader</h1><h2 id="2-1-处理css"><a href="#2-1-处理css" class="headerlink" title="2.1 处理css"></a>2.1 处理css</h2><p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment"># 1</span></span><br><span class="line">├── first.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">└── style.css <span class="comment"># 2</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i css-loader -D <span class="comment"># 读取 css 的 loader</span></span><br><span class="line">$ npm i style-loader -D <span class="comment"># 将 css 插入页面的 loader</span></span><br></pre></td></tr></table></figure>
<hr>
<p><em># 1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">require(<span class="string">'!style!css!./style.css'</span>);<span class="comment">// 需要 !style!css! 前缀</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 style.css</em><br><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">bady</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack entry.js bundle.js</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1468494451555.png" alt="Alt text"></p>
<h2 id="2-2-根据扩展名自动绑定-loader"><a href="#2-2-根据扩展名自动绑定-loader" class="headerlink" title="2.2 根据扩展名自动绑定 loader"></a>2.2 根据扩展名自动绑定 loader</h2><p><code>entry.js</code>中的<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'!style!css!./style.css'</span>)</span><br></pre></td></tr></table></figure></p>
<p>可以省略前缀<code>!style!css!</code>，改为:<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./style.css'</span>)</span><br></pre></td></tr></table></figure></p>
<p>但相应的打包命令就变为<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack ./entry.js bundle.js --module-bind <span class="string">"css=style\!css"</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-webpack-config"><a href="#3-webpack-config" class="headerlink" title="3 webpack.config"></a>3 webpack.config</h1><p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── first.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── style.css</span><br><span class="line">└── webpack.config.js <span class="comment"># 1</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);<span class="comment">// 必须引入</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 指入口文件的配置项，它是一个数组的原因是webpack允许多个入口点。 当然如果你只有一个入口的话，也可以直接使用双引号"./entry.js"</span><br><span class="line">	 * @type &#123;Array&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	entry: [</span><br><span class="line">		<span class="string">"./entry.js"</span></span><br><span class="line">	],</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 置打包结果，path定义了输出的文件夹，filename则定义了打包结果文件的名称</span><br><span class="line">	 * @type &#123;Object&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	output: &#123;</span><br><span class="line">		path: __dirname,</span><br><span class="line">		filename: <span class="string">'bundle.js'</span></span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 定义了对模块的处理逻辑，这里可以用loaders定义了一系列的加载器，以及一些正则。当需要加载的文件匹配test的正则时，就会调用后面的loader对文件进行处理</span><br><span class="line">	 * @type &#123;Object&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="built_in">module</span>: &#123;</span><br><span class="line">		loaders: [</span><br><span class="line">			<span class="comment">/* 针对所有的 css 后缀的文件，使用 css-loader 读取，并使用 style-loader 插入到页面 */</span></span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">				loader: <span class="string">'style!css'</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 插件可以完成更多loader不能完成的功能</span><br><span class="line">	 * @type &#123;Array&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	plugins: [</span><br><span class="line">		<span class="keyword">new</span> Webpack.BannerPlugin(<span class="string">"这里是打包文件头部注释！"</span>)</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack <span class="comment"># 会自动在当前目录中查找webpack.config.js的配置文件</span></span><br><span class="line">Hash: 4bd595f27c8112d7d21f</span><br><span class="line">Version: webpack 1.13.1</span><br><span class="line">Time: 2059ms</span><br><span class="line">    Asset   Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  12 kB       0  [emitted]  main</span><br><span class="line">   [0] multi main 28 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./entry.js 133 bytes &#123;0&#125; [built]</span><br><span class="line">   [2] ./first.js 104 bytes &#123;0&#125; [built]</span><br><span class="line">    + 4 hidden modules</span><br></pre></td></tr></table></figure>
<h1 id="4-高级"><a href="#4-高级" class="headerlink" title="4 高级"></a>4 高级</h1><h2 id="4-1-图片"><a href="#4-1-图片" class="headerlink" title="4.1 图片"></a>4.1 图片</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install file-loader -D</span><br><span class="line">$ npm install url-loader -D <span class="comment"># 用来处理图片</span></span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── first.js</span><br><span class="line">├── img</span><br><span class="line">│   ├── big.png</span><br><span class="line">│   └── small.png</span><br><span class="line">├── index.html <span class="comment"># 1</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── selectarea.mov</span><br><span class="line">├── style.css <span class="comment"># 2</span></span><br><span class="line">└── webpack.config.js <span class="comment"># 3</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 index.html</em><br><figure class="highlight vbscript-html"><table><tr><td class="code"><pre><span class="line"><span class="xml">...</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"img/small.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"big"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"small"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">...</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 style.css</em><br><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="selector-id">#big</span> &#123;</span><br><span class="line">	<span class="attribute">background-image</span>: <span class="built_in">url</span>(img/big.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#small</span> &#123;</span><br><span class="line">	<span class="attribute">background-image</span>: <span class="built_in">url</span>(img/small.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>#3 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);<span class="comment">// 必须引入</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	module: &#123;</span><br><span class="line">		loaders: [</span><br><span class="line">			...</span><br><span class="line">			<span class="comment">/* 图片处理 */</span></span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">				loader: <span class="string">'url-loader?limit=8192'</span><span class="comment">// 设置limit，小于8K的图片图片转化成了base64的编码，而大于8k的图片则不会转化</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack</span><br></pre></td></tr></table></figure>
<h2 id="4-2-webpack命令选项"><a href="#4-2-webpack命令选项" class="headerlink" title="4.2 webpack命令选项"></a>4.2 webpack命令选项</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">webpack <span class="comment">#最基本的启动webpack命令</span></span><br><span class="line">webpack -w <span class="comment">#提供watch方法，实时进行打包更新</span></span><br><span class="line">webpack -p <span class="comment">#对打包后的文件进行压缩</span></span><br><span class="line">webpack <span class="_">-d</span> <span class="comment">#提供SourceMaps，方便调试</span></span><br><span class="line">webpack --colors <span class="comment">#输出结果带彩色，比如：会用红色显示耗时较长的步骤</span></span><br><span class="line">webpack --profile <span class="comment">#输出性能数据，可以看到每一步的耗时</span></span><br><span class="line">webpack --display-modules <span class="comment">#默认情况下 node_modules 下的模块会被隐藏，加上这个参数可以显示这些被隐藏的模块</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-1-watch-热加载"><a href="#4-2-1-watch-热加载" class="headerlink" title="4..2.1 watch(热加载)"></a>4..2.1 watch(热加载)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack --watch <span class="comment"># webpack -w</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-liveload-自动刷新-vue"><a href="#4-2-2-liveload-自动刷新-vue" class="headerlink" title="4.2.2 liveload(自动刷新) + vue"></a>4.2.2 liveload(自动刷新) + vue</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># liveload</span></span><br><span class="line">$ npm i webpack-dev-server -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># vue</span></span><br><span class="line">$ npm i vue -S</span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment"># 1</span></span><br><span class="line">├── first.js</span><br><span class="line">├── img</span><br><span class="line">├── index.html <span class="comment"># 2</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── selectarea.mov</span><br><span class="line">├── style.css</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em># 1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./first.js'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'!style!css!./style.css'</span>);</span><br><span class="line"><span class="keyword">var</span> Vue = <span class="built_in">require</span>(<span class="string">'vue'</span>);</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	el: <span class="string">'body'</span>,</span><br><span class="line">	data: &#123;</span><br><span class="line">		message: <span class="string">'Hello Vue.js'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em># 2 index.html</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">	&#123;&#123; message &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ webpack-dev-server <span class="comment"># 实时预览：http://localhost:8080/webpack-dev-server/</span></span><br></pre></td></tr></table></figure>
<h1 id="5-加载vue单文件组织"><a href="#5-加载vue单文件组织" class="headerlink" title="5 加载vue单文件组织"></a>5 加载vue单文件组织</h1><p><strong>初始目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── index.html</span><br><span class="line">├── src</span><br><span class="line">│   ├── components <span class="comment"># 组件</span></span><br><span class="line">│   └── main.js <span class="comment"># 入口</span></span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>初始化依赖</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># package.json</span></span><br><span class="line">$ npm init</span><br><span class="line"></span><br><span class="line"><span class="comment"># vue</span></span><br><span class="line">$ npm i vue -S</span><br><span class="line"></span><br><span class="line"><span class="comment"># webpack</span></span><br><span class="line">$ npm i webpack -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># babel</span></span><br><span class="line">$ npm i babel -D <span class="comment"># es6</span></span><br><span class="line">$ npm i babel-core -D</span><br><span class="line">$ npm i babel-plugin-transform-runtime -D</span><br><span class="line">$ npm i babel-preset-es2015 -D <span class="comment"># babel</span></span><br><span class="line">$ npm i babel-runtime -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># webpack loader</span></span><br><span class="line">$ npm i autoprefixer-loader -D <span class="comment"># css 浏览器前缀</span></span><br><span class="line">$ npm i babel-loader -D</span><br><span class="line">$ npm i css-loader -D</span><br><span class="line">$ npm i file-loader -D</span><br><span class="line">$ npm i html-loader -D</span><br><span class="line">$ npm i node-sass -D</span><br><span class="line">$ npm i sass-loader -D</span><br><span class="line">$ npm i style-loader -D</span><br><span class="line">$ npm i url-loader -D</span><br><span class="line">$ npm i vue-html-loader -D</span><br><span class="line">$ npm i vue-loader -D</span><br><span class="line">$ npm i vue-style-loader -D</span><br><span class="line">$ npm i vue-hot-reload-api -D</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>完成后目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">├── index.html <span class="comment"># 1</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── npm-debug.log</span><br><span class="line">├── package.json <span class="comment"># 2</span></span><br><span class="line">├── src</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   └── app.vue <span class="comment"># 3</span></span><br><span class="line">│   └── main.js <span class="comment"># 4</span></span><br><span class="line">└── webpack.config.js <span class="comment"># 5</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 index.html</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#app</span> &#123;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">800px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 package.json</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"vue_by_webpack_blog_spa"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"study vue"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"webpack.config.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"webpack-dev-server --inline"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"mengqingshen"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"vue"</span>: <span class="string">"^1.0.26"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"autoprefixer-loader"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="string">"babel"</span>: <span class="string">"^6.5.2"</span>,</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.10.4"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^6.2.4"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"^6.9.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.9.0"</span>,</span><br><span class="line">    <span class="string">"babel-runtime"</span>: <span class="string">"^6.9.2"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="string">"file-loader"</span>: <span class="string">"^0.9.0"</span>,</span><br><span class="line">    <span class="string">"html-loader"</span>: <span class="string">"^0.4.3"</span>,</span><br><span class="line">    <span class="string">"node-sass"</span>: <span class="string">"^3.8.0"</span>,</span><br><span class="line">    <span class="string">"sass-loader"</span>: <span class="string">"^4.0.0"</span>,</span><br><span class="line">    <span class="string">"style-loader"</span>: <span class="string">"^0.13.1"</span>,</span><br><span class="line">    <span class="string">"url-loader"</span>: <span class="string">"^0.5.7"</span>,</span><br><span class="line">    <span class="string">"vue-hot-reload-api"</span>: <span class="string">"^2.0.5"</span>,</span><br><span class="line">    <span class="string">"vue-html-loader"</span>: <span class="string">"^1.2.3"</span>,</span><br><span class="line">    <span class="string">"vue-loader"</span>: <span class="string">"^8.5.3"</span>,</span><br><span class="line">    <span class="string">"vue-style-loader"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^1.13.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>#3 app.vue</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="comment">/* es6 */</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        el:<span class="string">"#app"</span>,</span><br><span class="line">         <span class="comment">/* data:function()&#123;&#125;，下面是es6写法 */</span></span><br><span class="line">         data () &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                name:<span class="string">"laputa"</span>,</span><br><span class="line">                age:<span class="string">"2q1"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"sass"</span>&gt;</span><span class="undefined"></span><br><span class="line">    /* 一定要加 lang 不然无法编译 */</span><br><span class="line">    /*测试一下对sass的编译*/</span><br><span class="line">    $qwe:#098;</span><br><span class="line">    body&#123;</span><br><span class="line">        background-color: $qwe;</span><br><span class="line">        h1&#123;</span><br><span class="line">            background-color: #eee;</span><br><span class="line">            color: red;</span><br><span class="line">            transform: translate(10%, 10%);/*测试自动添加前缀*/</span><br><span class="line">        &#125;</span><br><span class="line">        h1:hover&#123;</span><br><span class="line">            height:100px;</span><br><span class="line">        &#125;</span><br><span class="line">        h2&#123;</span><br><span class="line">            background-color: #999;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#4 main.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//es6语法，其实不用写完，会自动查找。可以直接写import Vue from "vue";</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"../node_modules/vue/dist/vue.min.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//引入我们编写的测试用vue文件。</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">'./components/app'</span>;</span><br><span class="line">Vue.config.debug = <span class="literal">true</span>;<span class="comment">//开启错误提示</span></span><br><span class="line"><span class="keyword">new</span> Vue(app);</span><br></pre></td></tr></table></figure></p>
<p><em>#5 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * NodeJS中的Path对象，用于处理目录的对象，提高开发效率。</span><br><span class="line"> * @type &#123;Object&#125;</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模块导入 */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 入口文件地址，不需要写完，会自动查找</span><br><span class="line">     * @type &#123;String|Array&#125;</span><br><span class="line">     */</span></span><br><span class="line">    entry: <span class="string">'./src/main'</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 输出</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),<span class="comment">// 文件地址，使用绝对路径形式</span></span><br><span class="line">        filename: <span class="string">'[name].js'</span>,<span class="comment">// [name]这里是 webpack 提供的根据入口文件自动生成的名字</span></span><br><span class="line">        publicPath: <span class="string">'/dist/'</span><span class="comment">// 公共文件生成的地址</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 服务器配置相关，自动刷新!</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">        hot: <span class="literal">false</span>,<span class="comment">// 全局刷新</span></span><br><span class="line">        inline: <span class="literal">true</span>,</span><br><span class="line">        progress: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 加载器</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">            <span class="comment">/* 解析.vue文件 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.vue$/</span>, loader: <span class="string">'vue'</span> &#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 转化ES6的语法 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.js$/</span>, loader: <span class="string">'babel'</span>, exclude: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 编译css并自动添加css前缀 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.css$/</span>, loader: <span class="string">'style!css!autoprefixer'</span>&#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* .scss 文件想要编译，scss就需要这些东西！来编译处理 </span><br><span class="line">            install css-loader style-loader sass-loader node-sass --save-dev */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.scss$/</span>, loader: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 图片转化，小于8K自动转化为base64的编码 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.(png|jpg|gif)$/</span>, loader: <span class="string">'url-loader?limit=8192'</span>&#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* html模板编译 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.(html|tpl)$/</span>, loader: <span class="string">'html-loader'</span> &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * .vue的配置。需要单独出来配置，其实没什么必要--因为我删了也没保错，不过这里就留这把，因为官网文档里是可以有单独的配置的。</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    vue: &#123;</span><br><span class="line">        loaders: &#123;</span><br><span class="line">            css: <span class="string">'style!css!autoprefixer'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 转化成es5的语法</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    babel: &#123;</span><br><span class="line">        presets: [<span class="string">'es2015'</span>],</span><br><span class="line">        plugins: [<span class="string">'transform-runtime'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">/* require时省略的扩展名，如：require('module') 不需要module.js */</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.vue'</span>],</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 别名，可以直接使用别名来代表设定的路径以及其他 */</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">            filter: path.join(__dirname, <span class="string">'./src/filters'</span>),</span><br><span class="line">            components: path.join(__dirname, <span class="string">'./src/components'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 开启source-map，webpack有多种source-map，在官网文档可以查到 */</span></span><br><span class="line">    devtool: <span class="string">'eval-source-map'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># http://localhost:8080/</span></span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure>
<h1 id="6-vue组件"><a href="#6-vue组件" class="headerlink" title="6 vue组件"></a>6 vue组件</h1><h1 id="7-vue-router"><a href="#7-vue-router" class="headerlink" title="7 vue-router"></a>7 vue-router</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i vue-loader -D</span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   └── main.js</span><br><span class="line">├── index.html<span class="comment"># 1 页面入口</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   ├── app.vue <span class="comment"># 2 组件1，嵌套了组件2</span></span><br><span class="line">│   │   ├── hello.vue <span class="comment"># 3 组件2</span></span><br><span class="line">│   │   └── list.vue <span class="comment"># 4 组件3</span></span><br><span class="line">│   └── main.js <span class="comment"># 5 实例化 vue 组件；初始化路由</span></span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em># 1 index.html</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        *, *<span class="selector-pseudo">:beofre</span>, *<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">            <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">body</span>, <span class="selector-tag">html</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-id">#app</span> &#123;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">800px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 路由视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 app.vue</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">'./hello.vue'</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        data () &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                name: <span class="string">'laputa'</span>,</span><br><span class="line">                age: <span class="string">'26'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            golist () &#123;</span><br><span class="line">                <span class="keyword">this</span>.$route.router.go(&#123;name: <span class="string">'list'</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            hello</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"overflow: hidden;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"golist"</span>&gt;</span>$toute.router.go查看<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'list'&#125;"</span>&gt;</span>v-link查看列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'index'&#125;"</span>&gt;</span>回去主页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'hello'&#125;"</span>&gt;</span>嵌套的路由<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 嵌套其它 vue 组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hello</span>&gt;</span><span class="tag">&lt;/<span class="name">hello</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 嵌套路由显示视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"sass"</span>&gt;</span><span class="undefined"></span><br><span class="line">    $qwe:pink;</span><br><span class="line">    body &#123;</span><br><span class="line">        background-color: $qwe;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    h1 &#123;</span><br><span class="line">        background-color: blue;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    h2 &#123;</span><br><span class="line">        background-color: purple;</span><br><span class="line">    &#125;</span><br><span class="line">    a &#123;</span><br><span class="line">        display: block;</span><br><span class="line">        font-size: 16px;</span><br><span class="line">    &#125;</span><br><span class="line">    button &#123;</span><br><span class="line">        float: left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em># 3 组件2</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">        data () &#123;</span><br><span class="line">           <span class="keyword">return</span> &#123;</span><br><span class="line">                hello:<span class="string">"这里是嵌套路由！！！1"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;hello&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">div</span>&#123;</span><br><span class="line">        <span class="attribute">text-shadow</span>: <span class="number">1px</span> <span class="number">1px</span> <span class="number">10px</span> <span class="number">#000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#4 组件3</em><br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">		data () &#123;</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">				peoples: [&#123;</span><br><span class="line">					name: <span class="string">'小红'</span>,</span><br><span class="line">					age: <span class="number">20</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'张三'</span>,</span><br><span class="line">					age: <span class="number">12</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'三五'</span>,</span><br><span class="line">					age: <span class="number">78</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'阿文'</span>,</span><br><span class="line">					age: <span class="number">22</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					name: <span class="string">'李六'</span>,</span><br><span class="line">					age: <span class="number">87</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"person in peoples"</span>&gt;</span></span><br><span class="line">			&#123;&#123;person.name&#125;&#125;: &#123;&#123;person.age&#125;&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">	<span class="selector-tag">li</span> &#123;</span><br><span class="line">		<span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">		<span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">		<span class="attribute">list-style</span>: none;</span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#5 main.js</em><br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//es6语法，其实不用写完，会自动查找。可以直接写import Vue from "vue";</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引入第三方库 */</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'../node_modules/vue/dist/vue.min.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引入自定义的 vue 组件 */</span></span><br><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">'./components/app.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> list <span class="keyword">from</span> <span class="string">'./components/list'</span>;</span><br><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">'./components/hello'</span>;</span><br><span class="line"></span><br><span class="line">Vue.config.debug = <span class="literal">true</span>;<span class="comment">//开启错误提示</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建根组件 */</span></span><br><span class="line"><span class="keyword">var</span> App = Vue.extend(&#123;&#125;);<span class="comment">// 路由器需要一个根组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建一个路由器实例 */</span></span><br><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> VueRouter();<span class="comment">// 创建实例时可以传入配置参数进行定制，为保持简单，这里使用默认配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义路由规则 */</span></span><br><span class="line"><span class="comment">// 每条路由规则应该映射到一个组件。这里的“组件”可以是一个使用 Vue.extend</span></span><br><span class="line"><span class="comment">// 创建的组件构造函数，也可以是一个组件选项对象。</span></span><br><span class="line">router.map(&#123;</span><br><span class="line">	<span class="string">'index'</span>: &#123;</span><br><span class="line">		name: <span class="string">'index'</span>,</span><br><span class="line">		component: index,</span><br><span class="line">		<span class="comment">// 在/index下设置一个子路由</span></span><br><span class="line">		<span class="comment">// 当匹配到/index/hello时，会在index的&lt;router-view&gt;内渲染</span></span><br><span class="line">		subRoutes: &#123;</span><br><span class="line">			<span class="string">'hello'</span>: &#123;</span><br><span class="line">				name: <span class="string">'hello'</span>,</span><br><span class="line">				component: hello</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">'/list'</span>: &#123;</span><br><span class="line">		name: <span class="string">'list'</span>,</span><br><span class="line">		component: list</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.redirect(&#123;</span><br><span class="line">	<span class="string">'*'</span>: <span class="string">'index'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 启动应用 */</span></span><br><span class="line">router.start(App, <span class="string">'#app'</span>);<span class="comment">// 路由器会创建一个 App 实例，并且挂载到选择符 #app 匹配的元素上。</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/16/imooc_iOS_iOS9新特性之UIStackView/" itemprop="url">
                  iOS9新特性之UIStackView
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-16T10:20:24+08:00" content="2016-06-16">
              2016-06-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>视频：</strong><a href="http://www.imooc.com/learn/568" target="_blank" rel="external">http://www.imooc.com/learn/568</a><br><strong>源码：</strong><a href="https://git.coding.net/eli01/imooc_UIStackView.git" target="_blank" rel="external">https://git.coding.net/eli01/imooc_UIStackView.git</a></p>
</blockquote>
<h1 id="1-学习指南"><a href="#1-学习指南" class="headerlink" title="1    学习指南"></a>1    学习指南</h1><blockquote>
<p><strong>说明：</strong><code>iOS</code>设备屏幕尺寸日益多样化，随之而来的是屏幕适配日益复杂。为了解决这个问题，<code>iOS9</code>推出了<code>Stack View</code>。</p>
</blockquote>
<h1 id="2-UIStackView效果实现"><a href="#2-UIStackView效果实现" class="headerlink" title="2    UIStackView效果实现"></a>2    UIStackView效果实现</h1><h2 id="2-1-UIStackView属性介绍"><a href="#2-1-UIStackView属性介绍" class="headerlink" title="2.1    UIStackView属性介绍"></a>2.1    UIStackView属性介绍</h2><blockquote>
<p><strong>说明：</strong>一些常用的属性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8810.47.51.png" alt="Alt text"></p>
</blockquote>
<h2 id="2-2-美团效果实现"><a href="#2-2-美团效果实现" class="headerlink" title="2.2    美团效果实现"></a>2.2    美团效果实现</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.07.12.png" alt="Alt text"></p>
<h2 id="2-3-大众点评子控件代码实现"><a href="#2-3-大众点评子控件代码实现" class="headerlink" title="2.3    大众点评子控件代码实现"></a>2.3    大众点评子控件代码实现</h2><blockquote>
<p><strong>说明：</strong>通过代码（而不是<code>Storyboard</code>）创建并添加该组件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.47.24.png" alt="Alt text"><br><strong>注意：</strong>向<code>UIStackView</code>中添加子控件的时候要使用<code>addArrangedSubview</code>而不是<code>addSubview</code>，因为前者会保留控件作为<code>Stack View</code>子控件的特性</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">/* 1. 最外部UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackView = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">50</span>)];<span class="comment">// 创建Stack View</span></span><br><span class="line">    stackView.axis = <span class="built_in">UILayoutConstraintAxisHorizontal</span>;<span class="comment">// 设置为水平排列</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 2. 左边图片 */</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    imgView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img1.png"</span>];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/* 3. 右边子UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackViewSub = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">50</span>)];</span><br><span class="line">    stackViewSub.axis = <span class="built_in">UILayoutConstraintAxisVertical</span>;</span><br><span class="line">    <span class="comment">// 内部3个控件</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    imgView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img2.png"</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label1 = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    label1.text = <span class="string">@"人均¥18"</span>;</span><br><span class="line">    label1.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">12.0</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label2 =[[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">10</span>)];</span><br><span class="line">    label2.text = <span class="string">@"口味21环境21价格18"</span>;</span><br><span class="line">    label2.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">10.0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 4. 组合 */</span></span><br><span class="line">    <span class="comment">// 3个控件添加到内部Stack View</span></span><br><span class="line">    [stackViewSub addArrangedSubview:imgView2];</span><br><span class="line">    [stackViewSub addArrangedSubview:label1];</span><br><span class="line">    [stackViewSub addArrangedSubview:label2];</span><br><span class="line">    <span class="comment">// 添加左边的图片到外部的Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:imgView];</span><br><span class="line">    <span class="comment">// 添加内部的 Stack View到外部的 Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:stackViewSub];</span><br><span class="line">    <span class="comment">// 将最外层的stackView添加到View Controller</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:stackView]; </span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-UIStackView使用要点"><a href="#2-4-UIStackView使用要点" class="headerlink" title="2.4    UIStackView使用要点"></a>2.4    UIStackView使用要点</h2><p>无干货</p>
<h1 id="3-总结与预告"><a href="#3-总结与预告" class="headerlink" title="3    总结与预告"></a>3    总结与预告</h1><p>无干货</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_WEB_带你学习pug模版引擎/" itemprop="url">
                  带你学习pug模版引擎
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T22:23:30+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-课程简介"><a href="#1-课程简介" class="headerlink" title="1    课程简介"></a>1    课程简介</h1><blockquote>
<p><strong>模版引擎：</strong>将动态的数据和静态的页面糅合在一起的实现机制或技术<br><strong>流行的模版：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>实现语言</th>
<th>模版引擎例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP</td>
<td><code>Smarty</code>、<code>SimpleTemplate</code>、 <code>Xtemplate</code>、 <code>Savant</code></td>
</tr>
<tr>
<td>Java</td>
<td><code>Velocity</code>、 <code>FreeMarker</code>、 <code>Jbyte</code></td>
</tr>
<tr>
<td>C#</td>
<td><code>Dotliquid</code>、 <code>SharpDom</code>、 <code>Razor</code></td>
</tr>
<tr>
<td>JavaScript</td>
<td><code>Mustache</code>、 <code>Handlebars</code>、 <code>Juicer</code>、 <code>Xtemplate</code>、 <code>EJS</code>、 <code>pug</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>官网：</strong><a href="http://pug-lang.com/" target="_blank" rel="external">http://pug-lang.com/</a><br><strong>提示：</strong><code>jade</code>改名为<code>pug</code>了</p>
</blockquote>
<h2 id="1-1-pug环境配置"><a href="#1-1-pug环境配置" class="headerlink" title="1.1    pug环境配置"></a>1.1    pug环境配置</h2><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><ul>
<li>升级 mac 系统到最新</li>
<li>升级 xcode 及 xcode command line tools 到最新</li>
<li>安装 homebrew</li>
<li>通过 homebrew 安装 git 和 <a href="https://github.com/tj/n" target="_blank" rel="external">node</a></li>
<li>通过 npm 安装 pug<br><code>npm i -g pug</code></li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul>
<li>安装 node 可执行文件</li>
<li>通过 cygwin, 及可能的 openssl、g++-gcc、python、git等</li>
<li>通过 npm 安装 pug<br><code>npm install -g pug</code></li>
</ul>
<h2 id="1-2-pug特点"><a href="#1-2-pug特点" class="headerlink" title="1.2    pug特点"></a>1.2    pug特点</h2><ol>
<li>超强的可读性</li>
<li>灵活易用的缩进</li>
<li>块扩展</li>
<li>代码默认经过编码处理，以增强安全性</li>
<li>编译及运行时的上下文错误报告</li>
<li>命令行编译支持</li>
<li>HTML5模式（使用!!!5文档类型）</li>
<li>可选的内存缓存</li>
<li>联合动态的静态标记类</li>
<li>利用过滤器解析树的处理</li>
</ol>
<h2 id="1-3-pug的诞生"><a href="#1-3-pug的诞生" class="headerlink" title="1.3    pug的诞生"></a>1.3    pug的诞生</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-18%20%E4%B8%8B%E5%8D%8810.40.40.png" alt="pug环境|150x150"></p>
<h3 id="1-4-命令行中的-pug"><a href="#1-4-命令行中的-pug" class="headerlink" title="1.4    命令行中的 pug"></a>1.4    命令行中的 pug</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ npm install pug -g --client</span><br><span class="line">$ pug --help</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Usage: pug [options] [dir|file ...]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  -h, --help             output usage information</span><br><span class="line">  -V, --version          output the version number</span><br><span class="line">  -O, --obj &lt;str|path&gt;   JavaScript options object or JSON file containing it</span><br><span class="line">  -o, --out &lt;dir&gt;        output the compiled html to &lt;dir&gt;</span><br><span class="line">  -p, --path &lt;path&gt;      filename used to resolve includes</span><br><span class="line">  -P, --pretty           compile pretty html output</span><br><span class="line">  -c, --client           compile <span class="keyword">function</span> <span class="keyword">for</span> client-side runtime.js</span><br><span class="line">  -n, --name &lt;str&gt;       The name of the compiled template (requires --client)</span><br><span class="line">  -D, --no-debug         compile without debugging (smaller <span class="built_in">functions</span>)</span><br><span class="line">  -w, --watch            watch files <span class="keyword">for</span> changes and automatically re-render</span><br><span class="line">  -E, --extension &lt;ext&gt;  specify the output file extension</span><br><span class="line">  -H, --hierarchy        keep directory hierarchy when a directory is specified</span><br><span class="line">  --name-after-file      Name the template after the last section of the file path (requires --client and overriden by --name)</span><br><span class="line">  --doctype &lt;str&gt;        Specify the doctype on the <span class="built_in">command</span> line (useful <span class="keyword">if</span> it is not specified by the template)</span><br></pre></td></tr></table></figure>
<h1 id="2-pug基础语法知识"><a href="#2-pug基础语法知识" class="headerlink" title="2    pug基础语法知识"></a>2    pug基础语法知识</h1><h2 id="2-1-文档声明和头尾标签"><a href="#2-1-文档声明和头尾标签" class="headerlink" title="2.1    文档声明和头尾标签"></a>2.1    文档声明和头尾标签</h2><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 imooc hade study</span><br></pre></td></tr></table></figure>
<h2 id="2-2-实现命令行实时编译"><a href="#2-2-实现命令行实时编译" class="headerlink" title="2.2    实现命令行实时编译"></a>2.2    实现命令行实时编译</h2><p><code>-P</code>:     不压缩生成的html文件<br><code>-w</code>：实时监控</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">└── index.pug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ pug -P index.pug <span class="comment"># 编译到当前目录下</span></span><br><span class="line"></span><br><span class="line">$ tree  </span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line"></span><br><span class="line">├── index.html<span class="comment"># 编译生成的文件</span></span><br><span class="line">└── index.pug</span><br></pre></td></tr></table></figure>
<h2 id="2-3-标签语法"><a href="#2-3-标签语法" class="headerlink" title="2.3    标签语法"></a>2.3    标签语法</h2><ul>
<li>不需要尖括号</li>
<li>不需要闭合</li>
<li>通过缩进实现嵌套</li>
</ul>
<h2 id="2-4-属性文本和值"><a href="#2-4-属性文本和值" class="headerlink" title="2.4    属性文本和值"></a>2.4    属性文本和值</h2><table>
<thead>
<tr>
<th>属性类型</th>
<th>书写方式</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>|id|<code>[标签]# [id]</code>或<code>[标签] (id=[id])</code>|<br>|class|<code>[标签].[className1].[classeName2]</code>或<code>[标签] (class=&quot;[className1] [className2]&quot;)</code><br>|其它|<code>[标签] ([属性]=&quot;[属性值]&quot; [省略值的属性])</code>|</p>
<p><strong>注意：</strong>对于id和class属性，编写div标签且采用<code>#</code>、<code>.</code>的方式时可以省略<code>div</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		</span><br><span class="line">		h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">		</span><br><span class="line">		# id.classname</span><br><span class="line">			a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">			input(value='course',type="text",name="course")</span><br><span class="line">			input(name='type',type='checkbox',checked)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://imooc.com"</span> <span class="attr">title</span>=<span class="string">"imooc pug"</span> <span class="attr">data-uid</span>=<span class="string">"1000"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"course"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"course"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="2-5-混合的成段文本和标签"><a href="#2-5-混合的成段文本和标签" class="headerlink" title="2.5        混合的成段文本和标签"></a>2.5        混合的成段文本和标签</h1><p><strong>说明：</strong>两种方式</p>
<ul>
<li>每一行文本前加 <code>|</code></li>
<li>为标签添加后缀<code>.</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">p </span><br><span class="line">	|	a </span><br><span class="line">	|	b </span><br><span class="line">	|	c </span><br><span class="line">	|	d</span><br><span class="line">p.</span><br><span class="line">	a</span><br><span class="line">	<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">	b</span><br><span class="line">	c</span><br><span class="line">	d</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  a </span><br><span class="line">  b </span><br><span class="line">  c </span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--接下来的东西是个完整代码块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  a</span><br><span class="line">  <span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-6-注释和条件注释"><a href="#2-6-注释和条件注释" class="headerlink" title="2.6    注释和条件注释"></a>2.6    注释和条件注释</h2><h3 id="2-6-1-注释"><a href="#2-6-1-注释" class="headerlink" title="2.6.1    注释"></a>2.6.1    注释</h3><p><strong>分类：</strong></p>
<ul>
<li>缓冲注释<code>//</code>：会输出到html</li>
<li>非缓冲注释<code>//-</code>：不会输出到html</li>
</ul>
<p><strong>注意：</strong>当注释放在标签下部时，表示块注释</p>
<h3 id="2-6-2-条件注释"><a href="#2-6-2-条件注释" class="headerlink" title="2.6.2    条件注释"></a>2.6.2    条件注释</h3><p><strong>注意：</strong>当使用条件注释时，html需要使用标签，且需要闭合。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">//- html</span><br><span class="line"><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	meta(charset='utf-8')</span><br><span class="line">	title imooc pug study</span><br><span class="line">body</span><br><span class="line">	style.</span><br><span class="line">		</span><br><span class="line">		body&#123;color:# ff6600&#125;</span><br><span class="line">	script.</span><br><span class="line">		var imoocCourse = 'pug'</span><br><span class="line">	</span><br><span class="line">	h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">	h2 注释</span><br><span class="line">	//h3 单行注释</span><br><span class="line">	//-h4 非缓冲注释</span><br><span class="line">	</span><br><span class="line">	# id.classname</span><br><span class="line">	//-块注释</span><br><span class="line">		a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">		input(value='course',type="text",name="course")</span><br><span class="line">		input(name='type',type='checkbox',checked)</span><br><span class="line">		p </span><br><span class="line">			|	a </span><br><span class="line">			|	b </span><br><span class="line">			|	c </span><br><span class="line">			|	d</span><br><span class="line">		//接下来的东西是个完整代码块</span><br><span class="line">		p.</span><br><span class="line">			a</span><br><span class="line">			<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">			b</span><br><span class="line">			c</span><br><span class="line">			d</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="selector-tag">body</span>&#123;<span class="attribute">color</span>:# ff6600&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> imoocCourse = <span class="string">'pug'</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>注释<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--h3 单行注释--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-变量声明与数据传递"><a href="#2-7-变量声明与数据传递" class="headerlink" title="2.7    变量声明与数据传递"></a>2.7    变量声明与数据传递</h2><h3 id="2-7-1-变量声明与使用"><a href="#2-7-1-变量声明与使用" class="headerlink" title="2.7.1        变量声明与使用"></a>2.7.1        变量声明与使用</h3><ul>
<li><p>声明：<code>- var variableName</code></p>
</li>
<li><p>调用<code># {variableName}</code></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		- var course = 'pug'</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-2-数据传递"><a href="#2-7-2-数据传递" class="headerlink" title="2.7.2    数据传递"></a>2.7.2    数据传递</h3><blockquote>
<p><strong>说明：</strong>通过命令行指令传递数据</p>
<ol>
<li><code>--obj {jsonString}</code>：直接传递对象字符串</li>
<li><code>-O file.json</code>：载入json文件</li>
</ol>
</blockquote>
<p><strong>注意</strong>：如果在pug文件中声明了同样的变量，则被pug文件中的覆盖。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$pug</span> index.pug -P -w --obj <span class="string">'&#123;"course":"pug"&#125;'</span></span><br><span class="line">或</span><br><span class="line">$ vim imooc.json </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"course"</span>:<span class="string">"pug"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pug</span> index.pug -P -w －O imooc.json</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-安全转义与非转义"><a href="#2-8-安全转义与非转义" class="headerlink" title="2.8    安全转义与非转义"></a>2.8    安全转义与非转义</h2><blockquote>
<p><strong>说明：</strong>解析并输出变量的内容时，默认会对变量进行<code>安全转义</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 转义</span><br><span class="line">		- var htmlData = '<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>'</span><br><span class="line">		// 默认(会转义)</span><br><span class="line">		</span><br><span class="line">		p # &#123;htmlData&#125;</span><br><span class="line">		// 安全转义</span><br><span class="line">		p= htmlData</span><br><span class="line"></span><br><span class="line">		// 非安全转义（形式1）</span><br><span class="line">		p !&#123;htmlData&#125;</span><br><span class="line">		// 非安全转义（形式2）</span><br><span class="line">		p!= htmlData</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		// 特殊符号转义（! #  &#123; &#125;）</span><br><span class="line">		</span><br><span class="line">		p \# &#123;htmlData&#125;</span><br><span class="line">		p \!&#123;htmlData&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight vbscript-html"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>转义<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认(会转义)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 安全转义--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式1）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式2）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 特殊符号转义（! #  &#123; &#125;）--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span># &#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>!&#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-流程代码for-in-each-in-while"><a href="#2-9-流程代码for-in-each-in-while" class="headerlink" title="2.9    流程代码for-in /each-in / while"></a>2.9    流程代码for-in /each-in / while</h2><h3 id="2-9-1-for-in"><a href="#2-9-1-for-in" class="headerlink" title="2.9.1    for-in"></a>2.9.1    for-in</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 for</span><br><span class="line">- var imooc = &#123;course: 'pug', level: 'high'&#125;</span><br><span class="line">- for (var k in imooc)</span><br><span class="line">	p= imooc[k]</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-2-each-in"><a href="#2-9-2-each-in" class="headerlink" title="2.9.2    each-in"></a>2.9.2    each-in</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 each</span><br><span class="line">each value, key in imooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;key&#125;:# &#123;value&#125;</span><br><span class="line"></span><br><span class="line">h3 遍历数组</span><br><span class="line">- var courses = ['node', 'pug', 'express']</span><br><span class="line">each item in courses</span><br><span class="line">	p= item</span><br><span class="line"></span><br><span class="line">h3 嵌套循环</span><br><span class="line">- var sections = [&#123;id: 1, items: ['a', 'b']&#125;,&#123;id: 2, items: ['c', 'd']&#125;]</span><br><span class="line">dl</span><br><span class="line">	each section in sections</span><br><span class="line">		dt= section.id</span><br><span class="line">		each item in section.items</span><br><span class="line">			dd= item</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历数组<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>express<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>嵌套循环<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>a<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>b<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>c<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>d<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-3-while"><a href="#2-9-3-while" class="headerlink" title="2.9.3    while"></a>2.9.3    while</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 while</span><br><span class="line">- var n = 0</span><br><span class="line">ul</span><br><span class="line">	while n <span class="tag">&lt; <span class="attr">4</span></span><br><span class="line">		<span class="attr">li</span>= <span class="string">n++</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>while<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-流程代码-if-else-unless"><a href="#2-10-流程代码-if-else-unless" class="headerlink" title="2.10    流程代码 if - else/unless"></a>2.10    流程代码 if - else/unless</h2><h3 id="2-10-1-if-else"><a href="#2-10-1-if-else" class="headerlink" title="2.10.1    if-else"></a>2.10.1    if-else</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 if else</span><br><span class="line">- var isImooc = true</span><br><span class="line">- var lessons = ['pug', 'node']</span><br><span class="line">if lessons</span><br><span class="line">	if lessons.length &gt; 2</span><br><span class="line">		</span><br><span class="line">		p more than 2: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else if lessons.length &gt; 1</span><br><span class="line">		</span><br><span class="line">		p more than 1: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else</span><br><span class="line">		p no lesson</span><br><span class="line">else</span><br><span class="line">	p no lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>if else<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>more than 1: pug, node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-unless"><a href="#2-10-2-unless" class="headerlink" title="2.10.2    unless"></a>2.10.2    unless</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">- var isImooc = true</span><br><span class="line">unless isImooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;lessons.length&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>unless<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-case-when"><a href="#2-10-3-case-when" class="headerlink" title="2.10.3    case-when"></a>2.10.3    case-when</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 case</span><br><span class="line">- var name = 'pug'</span><br><span class="line">case name</span><br><span class="line">	when 'java'</span><br><span class="line">	when 'node'</span><br><span class="line">		p Hi node!</span><br><span class="line">	when 'pug': p Hi exress!</span><br><span class="line">	when 'express': p Hi express</span><br><span class="line">	default</span><br><span class="line">		</span><br><span class="line">		p Hi # &#123;name&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>case<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi exress!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-神奇的mixins"><a href="#2-11-神奇的mixins" class="headerlink" title="2.11    神奇的mixins"></a>2.11    神奇的mixins</h2><h3 id="2-11-1-参数"><a href="#2-11-1-参数" class="headerlink" title="2.11.1    参数"></a>2.11.1    参数</h3><h4 id="2-11-1-1-无参数"><a href="#2-11-1-1-无参数" class="headerlink" title="2.11.1.1    无参数"></a>2.11.1.1    无参数</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 无参数</span><br><span class="line">mixin lesson</span><br><span class="line">	p imooc pug study</span><br><span class="line">+lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>无参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-2-有参数"><a href="#2-22-1-2-有参数" class="headerlink" title="2.22.1.2    有参数"></a>2.22.1.2    有参数</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 带参数</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">+study('tom', ['pug', 'node'])</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>带参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>tom study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"courses"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-3-可变参数"><a href="#2-22-1-3-可变参数" class="headerlink" title="2.22.1.3    可变参数"></a>2.22.1.3    可变参数</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 可变参数</span><br><span class="line">mixin magic(name, ...items)</span><br><span class="line">	</span><br><span class="line">	ul(class='# name')</span><br><span class="line">		each item in items</span><br><span class="line">			li= item</span><br><span class="line">+magic('magic', 'node', 'pug')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>可变参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"# name"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-嵌套"><a href="#2-11-2-嵌套" class="headerlink" title="2.11.2    嵌套"></a>2.11.2    嵌套</h3><blockquote>
<p><strong>说明：</strong>在一个<code>mixin</code>的定义中调用另一个<code>mixin</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 mixin中调用另一个mixin</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">mixin group(student)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;student.name&#125;</span><br><span class="line">	+study(student.name, student.courses)</span><br><span class="line">+group(&#123;name:'tom', courses:['pug', 'node']&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-块包含"><a href="#2-11-3-块包含" class="headerlink" title="2.11.3    块包含"></a>2.11.3    块包含</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 块包含</span><br><span class="line">mixin team(slogon)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;slogon&#125;</span><br><span class="line">	if block</span><br><span class="line">		block</span><br><span class="line">	else</span><br><span class="line">		p no team</span><br><span class="line">//- 调用时后面跟一个块</span><br><span class="line">+team('slogon')</span><br><span class="line">	p Good job!</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>块包含<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>slogon<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Good job!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-4-传递属性"><a href="#2-11-4-传递属性" class="headerlink" title="2.11.4    传递属性"></a>2.11.4    传递属性</h3><blockquote>
<p><strong>说明：</strong>设置标签的属性有两种方式</p>
<ol>
<li>单个设置：<code>标签(属性名=attributes.属性名)</code></li>
<li>批量设置：<code>标签&amp;attributes(attributes)</code></li>
</ol>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 传递属性</span><br><span class="line">//- 索引某个属性</span><br><span class="line">mixin attr(name)</span><br><span class="line">	</span><br><span class="line">	p(class!=attributes.class) # &#123;name&#125;</span><br><span class="line">+attr('attr')(class='magic')</span><br><span class="line">//- 索引所有属性</span><br><span class="line">mixin attrs(name)</span><br><span class="line">	</span><br><span class="line">	p&amp;attributes(attributes) # &#123;name&#125;</span><br><span class="line">+attrs('attrs')(class='magic2', id='attrid')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>传递属性<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"magic"</span>&gt;</span>attr<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"attrid"</span> <span class="attr">class</span>=<span class="string">"magic2"</span>&gt;</span>attrs<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="3-pug进级"><a href="#3-pug进级" class="headerlink" title="3    pug进级"></a>3    pug进级</h1><h2 id="3-1-模版的继承"><a href="#3-1-模版的继承" class="headerlink" title="3.1    模版的继承"></a>3.1    模版的继承</h2><table>
<thead>
<tr>
<th>关键字</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extents [pug文件]</code></td>
<td>继承</td>
<td></td>
</tr>
<tr>
<td><code>block</code></td>
<td>定义(或引用，可追加)被继承的内容</td>
</tr>
</tbody>
</table>
<h3 id="3-1-1-案例源码"><a href="#3-1-1-案例源码" class="headerlink" title="3.1.1    案例源码"></a>3.1.1    案例源码</h3><p><em>head.pug</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">meta(charset='utf-8')</span><br><span class="line">title  study</span><br></pre></td></tr></table></figure>
<p><em>layout.pug</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">doctype html</span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	include head</span><br><span class="line">body</span><br><span class="line">	block desc</span><br><span class="line">	  p desc from layout</span><br><span class="line">	block content</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line"><span class="keyword">block</span> content</span><br><span class="line">	p <span class="keyword">desc</span> <span class="keyword">from</span> <span class="keyword">index</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-编译后"><a href="#3-1-2-编译后" class="headerlink" title="3.1.2    编译后"></a>3.1.2    编译后</h3><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span> study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from layout<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from index<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-模版的包含"><a href="#3-2-模版的包含" class="headerlink" title="3.2    模版的包含"></a>3.2    模版的包含</h2><h3 id="3-2-1-包含其它-pug-文件"><a href="#3-2-1-包含其它-pug-文件" class="headerlink" title="3.2.1    包含其它 pug 文件"></a>3.2.1    包含其它 pug 文件</h3><p><em>style.pug</em></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">style</span>.</span><br><span class="line">	<span class="selector-tag">body</span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h1 模版包含</span><br><span class="line">//- 引入（还可以并追加内容）</span><br><span class="line">include style</span><br><span class="line">	style.</span><br><span class="line">		h2 &#123;</span><br><span class="line">			</span><br><span class="line">			color: # 000;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模版包含<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">h2</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">000</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-包含-html-文件"><a href="#3-2-2-包含-html-文件" class="headerlink" title="3.2.2    包含 html 文件"></a>3.2.2    包含 html 文件</h3><h4 id="原文件"><a href="#原文件" class="headerlink" title="原文件"></a>原文件</h4><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//- 引入静态文件，添加后缀名（.html），就不会被当做pug模版文件处理</span><br><span class="line">include title.html</span><br></pre></td></tr></table></figure>
<p><em>title.html</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编译后"><a href="#编译后" class="headerlink" title="编译后"></a>编译后</h4><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-render及renderFile方法"><a href="#3-3-render及renderFile方法" class="headerlink" title="3.3    render及renderFile方法"></a>3.3    render及renderFile方法</h2><h3 id="3-3-1-pug-API"><a href="#3-3-1-pug-API" class="headerlink" title="3.3.1    pug API"></a>3.3.1    pug API</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461486682614.png" alt="Alt text|400x150"></p>
<h3 id="3-3-2-compile、render、renderFile"><a href="#3-3-2-compile、render、renderFile" class="headerlink" title="3.3.2    compile、render、renderFile"></a>3.3.2    compile、render、renderFile</h3><blockquote>
<p><strong>说明：</strong><code>pug</code>提供写一些方法，帮助开发着在服务端灵活地处理编译工作。</p>
<ul>
<li>compile：返回一个编译特定模版片段的方法</li>
<li>render：直接编译定模版片段</li>
<li>renderFile：直接编译特定pug模版文件</li>
</ul>
</blockquote>
<p><em>server.js</em></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">		<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. pug.compile</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> fn = pug.compile(<span class="string">'div test # &#123;type&#125;'</span>, &#123;&#125;)</span><br><span class="line">	<span class="comment">// var html = fn(&#123;type: 'compile'&#125;)</span></span><br><span class="line">	<span class="comment">// 2. pug.render</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// var html = pug.render('div test # &#123;type&#125;', &#123;type: 'render'&#125;)</span></span><br><span class="line">	<span class="comment">// 3. pug.renderFile</span></span><br><span class="line">	<span class="keyword">var</span> html = pug.renderFile(<span class="string">'index.pug'</span>, &#123;course: <span class="string">'pug renderFile'</span>, pretty: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line">	res.end(html);</span><br><span class="line">&#125;).listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server running at 1337'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#  安装需要的node包</span></span><br><span class="line">➜  imooc_pug git:(master) ✗ npm i pug coffee-script less markdown --save</span><br></pre></td></tr></table></figure>
<h2 id="3-4-过滤器-filters"><a href="#3-4-过滤器-filters" class="headerlink" title="3.4    过滤器 filters"></a>3.4    过滤器 filters</h2><h3 id="3-4-1-markdown"><a href="#3-4-1-markdown" class="headerlink" title="3.4.1    markdown"></a>3.4.1    markdown</h3><blockquote>
<p><strong>注意：</strong><code>markdown</code>中不能使用<code>pug</code>变量</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i jstransformer-markdown -g</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">h1 过滤器filters</span><br><span class="line">h3 markdown</span><br><span class="line">:markdown</span><br><span class="line">	Hi, this is **TZM** [link](http://tzmcn.org/)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>过滤器filters<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>markdown<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, this is<span class="tag">&lt;<span class="name">strong</span>&gt;</span>TZM<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"# &#123;url&#125;"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-less"><a href="#3-4-2-less" class="headerlink" title="3.4.2    less"></a>3.4.2    less</h3><blockquote>
<p><strong>官网：</strong><a href="http://lesscss.org/" target="_blank" rel="external">http://lesscss.org/</a></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ npm i -g jstransformer-less</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 less</span><br><span class="line">	style</span><br><span class="line">		:less</span><br><span class="line">			body &#123;</span><br><span class="line">				p &#123;</span><br><span class="line">					</span><br><span class="line">					color: # ccc;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3&gt;less<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line"><span class="selector-tag">body</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">color</span>: # ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-coffee-script"><a href="#3-4-3-coffee-script" class="headerlink" title="3.4.3    coffee-script"></a>3.4.3    coffee-script</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">$ npm i -g jstransformer-coffee-script</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h3 coffee</span><br><span class="line">	script</span><br><span class="line">		:coffee-script</span><br><span class="line">			console.log 'This is coffee!'</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;h3&gt;coffee&lt;/h3&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(function() &#123;</span><br><span class="line">	console.log(&apos;This is coffee!&apos;);</span><br><span class="line">&#125;).call(this);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-runtime环境下使用pug"><a href="#3-5-runtime环境下使用pug" class="headerlink" title="3.5    runtime环境下使用pug"></a>3.5    runtime环境下使用pug</h2><blockquote>
<p><strong>说明：</strong><code>runtime</code>环境这里特指浏览器</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">h1 浏览器端和服务器端能使用pug</span><br><span class="line"></span><br><span class="line"># runtime</span><br><span class="line">//- 服务器端使用</span><br><span class="line">script(src='node_modules/pug/runtime.js')</span><br><span class="line">//- 客户端使用</span><br><span class="line">script(src='runtime.js')</span><br><span class="line">script.</span><br><span class="line">	var runtimeNode = document.getElementById('runtime');</span><br><span class="line">	var runtimeHtml = template(&#123;isRuntime: true&#125;);</span><br><span class="line">	runtimeNode.innerHTML = runtimeHtml;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>浏览器端和服务器端能使用pug<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"runtime"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/pug/runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="keyword">var</span> runtimeNode = <span class="built_in">document</span>.getElementById(<span class="string">'runtime'</span>);</span><br><span class="line">  <span class="keyword">var</span> runtimeHtml = template(&#123;isRuntime: <span class="literal">true</span>&#125;);</span><br><span class="line">  runtimeNode.innerHTML = runtimeHtml;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-利用html2pug反编译"><a href="#3-6-利用html2pug反编译" class="headerlink" title="3.6    利用html2pug反编译"></a>3.6    利用html2pug反编译</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i html2jade -g</span><br></pre></td></tr></table></figure>
<h3 id="命令行中使用"><a href="#命令行中使用" class="headerlink" title="命令行中使用"></a>命令行中使用</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="node端使用"><a href="#node端使用" class="headerlink" title="node端使用"></a>node端使用</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> html2pug = <span class="built_in">require</span>(<span class="string">'html2jade'</span>)</span><br><span class="line">html2pug.convertDocument(html, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, pug</span>) </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="4-pug缺点及如何取舍"><a href="#4-pug缺点及如何取舍" class="headerlink" title="4    pug缺点及如何取舍"></a>4    pug缺点及如何取舍</h1><h2 id="4-1-Pug-的缺点"><a href="#4-1-Pug-的缺点" class="headerlink" title="4.1    Pug 的缺点"></a>4.1    Pug 的缺点</h2><ol>
<li>可移植差</li>
<li>调试困难</li>
<li>性能不是非常出色（对性能有需求考虑 <a href="">doT</a>）</li>
</ol>
<h2 id="4-2-选择的因素"><a href="#4-2-选择的因素" class="headerlink" title="4.2    选择的因素"></a>4.2    选择的因素</h2><ol>
<li>初始阶段（开发效率）</li>
<li>稳定阶段（性能和协作成本）</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_iOS_When iOS loves JS/" itemprop="url">
                  When iOS loves JS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T21:33:42+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-JSBinding概述"><a href="#1-JSBinding概述" class="headerlink" title="1    JSBinding概述"></a>1    JSBinding概述</h1><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>是<code>JS</code>和<code>native</code>之间的一个桥梁，通过这个桥梁，<code>JS</code>可以调用<code>Native</code>，<code>Native</code>可以调用<code>JS</code>。</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.35.27.png" alt="Alt text"></p>
<p><strong>注意：</strong><code>JSBinding</code>不是什么</p>
<ul>
<li>not Hybrid</li>
<li>not a new technology</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.38.56.png" alt="Alt text"></p>
<p><strong>历史：</strong><code>cocos2D-X</code>使用<code>zynga</code>提出的一个方案(<a href="https://github.com/zynga/jsbindings)，`JS" target="_blank" rel="external">https://github.com/zynga/jsbindings)，`JS</a> Engine<code>使用的是</code>SpiderMonkey`。</p>
<h2 id="1-1-JS和Native"><a href="#1-1-JS和Native" class="headerlink" title="1.1    JS和Native"></a>1.1    JS和Native</h2><p><strong>说明：</strong>两者结合初衷如下</p>
</blockquote>
<table>
<thead>
<tr>
<th>原生静态语言</th>
<th>动态脚本语言</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>简单易用</td>
</tr>
<tr>
<td>更底层，更强大</td>
<td>免编译</td>
</tr>
<tr>
<td>平台特性</td>
<td>热部署</td>
</tr>
</tbody>
</table>
<h2 id="1-2-iOS-7-and-JavaScriptCore"><a href="#1-2-iOS-7-and-JavaScriptCore" class="headerlink" title="1.2    iOS 7 and JavaScriptCore"></a>1.2    iOS 7 and JavaScriptCore</h2><blockquote>
<p><strong>说明：</strong>在<code>iOS 7</code>之后，苹果公布了<code>JavaScriptCore</code>的<code>API</code>，在这之前一直是<code>iOS</code>系统私有的。<br><strong>扩展：</strong><code>Mac</code>的<code>JavaScriptCore</code>一直是开放的。<br><strong>要点：</strong>包括以下部分</p>
<ul>
<li><code>JavaScriptCore.h</code>头文件</li>
<li><code>JSContext</code>类：<code>JS</code>的运行环境</li>
<li><code>JSValue</code>类：</li>
<li><code>JSExport</code>类</li>
</ul>
</blockquote>
<h3 id="1-2-1-Eval-JavaScript-Code"><a href="#1-2-1-Eval-JavaScript-Code" class="headerlink" title="1.2.1    Eval JavaScript Code"></a>1.2.1    Eval JavaScript Code</h3><blockquote>
<p><strong>说明：</strong>利用引擎执行<code>JS</code>代码</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 使用 JS 上下文执行 JS 语句 "1 + 2"，并返回计算结果</span></span><br><span class="line">    JSValue *result = [context evaluateScript: <span class="string">@"1 + 2"</span>];</span><br><span class="line">    <span class="comment">// 打印计算结果</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"1 + 2 = %f"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-Call-JavaScript-Function"><a href="#1-2-2-Call-JavaScript-Function" class="headerlink" title="1.2.2    Call JavaScript Function"></a>1.2.2    Call JavaScript Function</h3><blockquote>
<p><strong>说明：</strong>假设一个叫做<code>sum</code>的<code>JS</code>方法已经被加载</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a "sum" function was loaded in context</span></span><br><span class="line"><span class="comment">// 使用上下文获取函数 sum</span></span><br><span class="line">J<span class="built_in">AValue</span> *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line"><span class="comment">// 调用sum JS 方法,并传递两个参数</span></span><br><span class="line">JSValue *result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line"><span class="comment">// 打印计算结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h3 id="1-2-3-Create-JavaScript-Value"><a href="#1-2-3-Create-JavaScript-Value" class="headerlink" title="1.2.3    Create JavaScript Value"></a>1.2.3    Create JavaScript Value</h3><blockquote>
<p><strong>说明：</strong>可以先创建<code>JS</code>的值，再赋值给相应变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在指定上下文中创建值 231</span></span><br><span class="line">JSValue *intVar = [JSValue valueWithInt32: <span class="number">231</span> inContext: context];</span><br><span class="line"><span class="comment">// 将值赋给变量 bar</span></span><br><span class="line">context[<span class="string">@"bar"</span>] = intVar;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line">[context evaluateScript: <span class="string">@"bar++];</span></span><br></pre></td></tr></table></figure>
<p><em>another way</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">[context evaluateScript: <span class="string">@"var bar = 231;bar++;"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-Type-Conversion"><a href="#1-2-4-Type-Conversion" class="headerlink" title="1.2.4    Type Conversion"></a>1.2.4    Type Conversion</h3><blockquote>
<p><strong>说明：</strong><code>JS</code>和<code>O-C</code>之间对应类型的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th>Objective-C type</th>
<th>JavaScript type</th>
</tr>
</thead>
<tbody>
<tr>
<td>nil</td>
<td>undefined</td>
</tr>
<tr>
<td>NSNull</td>
<td>null</td>
</tr>
<tr>
<td>NSString</td>
<td>string</td>
</tr>
<tr>
<td>NSNumber</td>
<td>number, boolean</td>
</tr>
<tr>
<td>NSDictionary</td>
<td>Object object</td>
</tr>
<tr>
<td>NSArray</td>
<td>Array object</td>
</tr>
<tr>
<td>NSDate</td>
<td>Date object</td>
</tr>
<tr>
<td>NSBlock</td>
<td>Function object</td>
</tr>
<tr>
<td>id</td>
<td>Wrapper object</td>
</tr>
<tr>
<td>Class</td>
<td>Constructor object</td>
</tr>
</tbody>
</table>
<h2 id="1-3-完整实例"><a href="#1-3-完整实例" class="headerlink" title="1.3    完整实例"></a>1.3    完整实例</h2><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 为上下文指定JS异常处理代码块</span></span><br><span class="line">    context.exceptionHandler = ^(JSContext *ctx, JSValue *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, exception);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">NSString</span> *script;</span><br><span class="line">    JSValue *result;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 表达式</span></span><br><span class="line">    script = <span class="string">@"1 + 2 + 3"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" %@ = %f"</span>, script, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 语句(创建一个全局变量)</span></span><br><span class="line">    script = <span class="string">@"var globalVal = 2 * 3;"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" globalVar = %@"</span>, context[<span class="string">@"globalVar"</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 函数</span></span><br><span class="line">    script = <span class="string">@"function sum(a, b)&#123;return a + b;&#125;"</span>;</span><br><span class="line">    [context evaluateScript:script];</span><br><span class="line">    JSValue *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line">    result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, <span class="string">@"sum(1,2)"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建值</span></span><br><span class="line">    JSValue *foo = [JSValue valueWithDouble:<span class="number">123.45</span> inContext:context];</span><br><span class="line">    context[<span class="string">@"foo"</span>] = foo;</span><br><span class="line">    [context evaluateScript:<span class="string">@"foo++"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"foo = %f"</span>, [context[<span class="string">@"foo"</span>] toDouble]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-初始iOS7-JavaScriptCore-API"><a href="#2-初始iOS7-JavaScriptCore-API" class="headerlink" title="2    初始iOS7 JavaScriptCore API"></a>2    初始iOS7 JavaScriptCore API</h1><h2 id="2-1-Call-Native-Code-via-Block"><a href="#2-1-Call-Native-Code-via-Block" class="headerlink" title="2.1    Call Native Code via Block"></a>2.1    Call Native Code via Block</h2><blockquote>
<p><strong>说明：</strong><code>JS</code>调用<code>Native</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">//------------ JS 调用 Native</span></span><br><span class="line"><span class="comment">// 为 JS 的上下文注入可以调用的本地 BLOCK</span></span><br><span class="line">context[<span class="string">@"sum"</span>] = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 在 JS 中调用 Native block</span></span><br><span class="line">result = [context evaluateScript:<span class="string">@"sum(1, 2)"</span>];</span><br><span class="line"><span class="comment">// 观察运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Call-Native-Code-via-JSExport"><a href="#2-2-Call-Native-Code-via-JSExport" class="headerlink" title="2.2    Call Native Code via JSExport"></a>2.2    Call Native Code via JSExport</h2><blockquote>
<p><strong>说明：</strong>通过<code>jsExport</code>调用<code>Native</code></p>
<ul>
<li>Create a js export Class in Objective-C（创建<code>jsExport</code>类）</li>
<li>the instance of this class can be accessed in js context（该类的实例可以在<code>js</code>的上下文中访问到）</li>
<li>No Constructor in JS（无法在<code>JS</code>中访问到<code>JSExport</code>对象的构造函数）</li>
</ul>
</blockquote>
<p>###实例</p>
<blockquote>
<p><strong>说明：</strong>需要做以下工作</p>
<ol>
<li>定义一个<code>JSExport</code>的子协议：协议指定的成员才能够暴露给<code>JS</code>上下文</li>
<li>创建一个<code>O-C</code>类，并采纳协议</li>
</ol>
</blockquote>
<p><em>Point3D.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">// 协议：继承 JSExport</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">Point3DExport</span> &lt;<span class="title">JSExport</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> x;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> y;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>) length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Point3D</span> : <span class="title">NSObject</span> &lt;<span class="title">Point3DExport</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    JSContext *context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Point3D.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Point3D.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Point3D</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> x;</span><br><span class="line"><span class="keyword">@synthesize</span> y;</span><br><span class="line"><span class="keyword">@synthesize</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        context = ctx;</span><br><span class="line">        context[<span class="string">@"Point3D"</span>] = [Point3D class];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>)length &#123;</span><br><span class="line">    <span class="keyword">return</span> sqrt(<span class="keyword">self</span>.x * <span class="keyword">self</span>.x + <span class="keyword">self</span>.y * <span class="keyword">self</span>.y + <span class="keyword">self</span>.z * <span class="keyword">self</span>.z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *script;</span><br><span class="line">JSValue *result;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line">Point3D *point3D = [[Point3D alloc] initWithContext:context];</span><br><span class="line">point3D.x = <span class="number">1</span>;</span><br><span class="line">point3D.y = <span class="number">2</span>;</span><br><span class="line">point3D.z = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 将实例注入到 JS 上下文</span></span><br><span class="line">context[<span class="string">@"point3D"</span>] = point3D;</span><br><span class="line"><span class="comment">// 待执行的 JS 脚本</span></span><br><span class="line">script = <span class="string">@"point3D.x = 2; point3D.y = 2; point3D.length();"</span>;</span><br><span class="line"><span class="comment">// 在 JS 上下文中调用该实例</span></span><br><span class="line">result = [context evaluateScript:script];</span><br><span class="line"><span class="comment">// 观察 JS 运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, script, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-3-载入js文件来执行"><a href="#2-3-载入js文件来执行" class="headerlink" title="2.3    载入js文件来执行"></a>2.3    载入js文件来执行</h2><blockquote>
<p><strong>说明：</strong>加入<code>js</code>文件比起在<code>Native</code>代码中创建<code>js</code>脚本子串要通用、易用的多。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建文件路径</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [<span class="built_in">NSString</span> stringWithFormat:</span><br><span class="line">                       <span class="string">@"%@/%@"</span>,</span><br><span class="line">                       [[<span class="built_in">NSBundle</span> mainBundle] resourcePath],</span><br><span class="line">                       fileName];</span><br><span class="line"><span class="comment">// 载入 js 文件</span></span><br><span class="line"><span class="built_in">NSString</span> *script = [<span class="built_in">NSString</span> stringWithContentsOfFile:filePath encoding:<span class="built_in">NSUTF8StringEncoding</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 执行 js</span></span><br><span class="line">[context evaluateScript:script];</span><br></pre></td></tr></table></figure>
<h1 id="3-JavaScriptCore-API-进阶"><a href="#3-JavaScriptCore-API-进阶" class="headerlink" title="3    JavaScriptCore API 进阶"></a>3    JavaScriptCore API 进阶</h1><h2 id="3-1-Memory-Leak"><a href="#3-1-Memory-Leak" class="headerlink" title="3.1    Memory Leak"></a>3.1    Memory Leak</h2><blockquote>
<p><strong>说明：</strong><code>js</code>中对象的<code>循环引用</code>和<code>o-c</code>中对象的<code>循环引用</code>都不会导致内存泄漏。但<code>js</code>对象和<code>Native</code>对象之间的循环引用会导致内存泄漏。</p>
<ul>
<li><code>js</code>对象之间循环引用：不会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454685937810.png" alt="Alt text"></li>
<li><code>o-c</code>对象和<code>js</code>对象之间循环引用：会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686063492.png" alt="Alt text"></li>
</ul>
<p><strong>解决：</strong><code>o-c</code>对象引用<code>js</code>对象时将后者包装为<code>JSManageredValue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686201162.png" alt="Alt text"><br><em>JS Code</em></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> girl = <span class="keyword">new</span> Girl();</span><br><span class="line">girl.boyFriend = boy;</span><br><span class="line">boy.girlFriend = girl;</span><br></pre></td></tr></table></figure>
<p><em>Objective-C Code</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Boy</span></span></span><br><span class="line">- (<span class="keyword">void</span>)setGirlFriend: (JSValue *)girl</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 使用 JSManageredValue 进行包装</span></span><br><span class="line">	<span class="keyword">self</span>.girlFriend = [JSManageredValue manageredValueWithValue: girl];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-Threding-and-parallelism"><a href="#3-2-Threding-and-parallelism" class="headerlink" title="3.2    Threding and parallelism"></a>3.2    Threding and parallelism</h2><blockquote>
<p><strong>说明：</strong>要点</p>
<ul>
<li>API is thread safe（API是线程安全的）</li>
<li>Locking granularity is JSVirtualMachine（锁的最小粒度为是<code>JS</code>虚拟机）</li>
<li>Use separate JSVirtualMachines for parallelism（并发时要使用不同的<code>JS</code>虚拟机）<br>###实例<br><strong>说明：</strong>创建了2个虚拟机实例</li>
<li>jsvmA：运行了两个<code>js</code>上下文(<code>ctxA1</code>和<code>ctxA2</code>)</li>
<li>jsvmB：运行了一个<code>js</code>上下文(<code>ctxB</code>)</li>
</ul>
<p><code>ctxA1</code>和<code>ctxA2</code>能够在并发情形下正常通信，但他们<code>ctxB</code>在并发环境下不能通信。因为前两者在同一个虚拟机中运行，也就意味着运行在同一个线程中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 js 虚拟机实例 jsvmA</span></span><br><span class="line">JSVirtualMachine *jsvmA = [[JSVirtualMachine alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 jsvmA 虚拟机中创建两个js上下文</span></span><br><span class="line">JSContext *ctxA1 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line">JSContext *ctxA2 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建另一个 js 虚拟机实例 javmB</span></span><br><span class="line">JSVirtualMachine *jsvmB = [[JSVirtualMachine alloc] init];</span><br><span class="line"><span class="comment">// // 在 jsvmB 虚拟机中创建一个js上下文</span></span><br><span class="line">JSContext *ctxB = [[JSContext alloc] initWithVirtualMachine: jsvmB];</span><br></pre></td></tr></table></figure>
<h2 id="3-3-JSBinding-in-the-Real-World"><a href="#3-3-JSBinding-in-the-Real-World" class="headerlink" title="3.3    JSBinding in the Real World"></a>3.3    JSBinding in the Real World</h2><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>的一些实际应用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744485627.png" alt="Alt text"></p>
<ul>
<li>Cocos2D</li>
<li>Ejecta</li>
<li>CocoonJS<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744686882.png" alt="Alt text"></li>
<li>node.app<h3 id="3-3-1-JS-Engines"><a href="#3-3-1-JS-Engines" class="headerlink" title="3.3.1    JS Engines"></a>3.3.1    JS Engines</h3></li>
</ul>
<p><strong>说明：</strong>2种<code>JS</code>引擎比较，<code>JavaScriptCore</code>和<code>SpiderMonkey</code></p>
<ul>
<li>JavaScriptCore</li>
<li>SpiderMonkey(Cocos2D-iPhone-2.1-bate3)</li>
<li>SpiderMonkey(Cocos2D-x-2.1-bate3)</li>
<li>SpiderMonkey(iMonkey)</li>
</ul>
<p><strong>注意：</strong><code>v8</code>引擎不受支持，因为其依赖于<code>JIT</code>，被苹果禁用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454745052574.png" alt="Alt text"></p>
<h3 id="3-3-2-JSBind-VS-LuaBinding"><a href="#3-3-2-JSBind-VS-LuaBinding" class="headerlink" title="3.3.2    JSBind VS LuaBinding"></a>3.3.2    JSBind VS LuaBinding</h3><p><strong>说明：</strong><code>JSBinding</code>和<code>LuaBinding</code>比较</p>
<ul>
<li><code>LUA</code>为什么在游戏编程领域被广泛运用<br><a href="https://www.zhihu.com/question/21717567" target="_blank" rel="external">https://www.zhihu.com/question/21717567</a></li>
<li><code>Cocos2dx+LUA</code>合适还是<code>Cocos2dx+JS</code>合适<br><a href="https://www.zhihu.com/question/21130385" target="_blank" rel="external">https://www.zhihu.com/question/21130385</a><h2 id="3-3-3-Which-to-Choose"><a href="#3-3-3-Which-to-Choose" class="headerlink" title="3.3.3    Which to Choose"></a>3.3.3    Which to Choose</h2></li>
</ul>
</blockquote>
<ul>
<li>Native</li>
<li>Web</li>
<li>Hybrid</li>
<li>ScriptBinding</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/03/JK_IOS高级_4 设计模式/" itemprop="url">
                  4 设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-03T14:11:18+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-iOS设计模式简介"><a href="#4-1-iOS设计模式简介" class="headerlink" title="4.1    iOS设计模式简介"></a>4.1    iOS设计模式简介</h2><h3 id="4-1-1-编码是门艺术"><a href="#4-1-1-编码是门艺术" class="headerlink" title="4.1.1    编码是门艺术"></a>4.1.1    编码是门艺术</h3><h3 id="4-1-2-设计模式的基本原则"><a href="#4-1-2-设计模式的基本原则" class="headerlink" title="4.1.2    设计模式的基本原则"></a>4.1.2    设计模式的基本原则</h3><ul>
<li><strong>开闭原则</strong>：一个模块的修改应该对扩展开发，对修改关闭</li>
<li><strong>里氏代换原则</strong>：子类、父类可以替换使用</li>
<li><strong>依赖倒转原则</strong>：抽象比依赖细节，细节依赖抽象</li>
<li><strong>接口隔离原则</strong>：只做和接口相关的必要的事情，不做和接口不相关的事情</li>
<li><strong>合成／聚合复用</strong>：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为一个组件调用</li>
</ul>
<h3 id="4-1-3-设计模式的类型"><a href="#4-1-3-设计模式的类型" class="headerlink" title="4.1.3    设计模式的类型"></a>4.1.3    设计模式的类型</h3><h2 id="4-2-适配器"><a href="#4-2-适配器" class="headerlink" title="4.2    适配器"></a>4.2    适配器</h2><h3 id="4-2-1-何为适配器模式"><a href="#4-2-1-何为适配器模式" class="headerlink" title="4.2.1    何为适配器模式"></a>4.2.1    何为适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过现实生活中遇到的电源适配问题，来讲解何为适配器模式。<br><strong>说明：</strong>苹果的电源适配器，可以将各种输入电压频率转为一致的电压频率为设备供电，从而解决国家电压频率不一致问题</p>
<ul>
<li><strong>类适配器：</strong>比之于一般的电源适配器，在不同国家要购买相应的电源适配器</li>
<li><strong>对象适配器：</strong>比之于苹果的电源适配器，能自动适应各个国家的情况</li>
</ul>
</blockquote>
<h3 id="4-2-2-数据直接适配带来的困境"><a href="#4-2-2-数据直接适配带来的困境" class="headerlink" title="4.2.2    数据直接适配带来的困境"></a>4.2.2    数据直接适配带来的困境</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解开发过程中遇到的最常见的几种数据适配问题的弊端，并配以代码示例，来引申出为何要用适配器模式。</p>
<ul>
<li>直接赋值的弊端</li>
<li>用对象赋值的灵活性问题</li>
<li>如何降低数据层与视图层的耦合度</li>
</ul>
</blockquote>
<h3 id="4-2-3-使用适配器模式"><a href="#4-2-3-使用适配器模式" class="headerlink" title="4.2.3    使用适配器模式"></a>4.2.3    使用适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解用适配器模式来优化名片视图加载数据的问题。</p>
<ul>
<li>创建抽象适配器模式</li>
<li>适配器与视图层建立输出联系</li>
<li>类适配器与对象适配器<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462074739914.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="4-2-3-1-类适配器"><a href="#4-2-3-1-类适配器" class="headerlink" title="4.2.3.1    类适配器"></a>4.2.3.1    类适配器</h4><blockquote>
<p><strong>说明：</strong>为每种数据模型都创建相应的适配器，用到哪种数据就使用相应的适配器。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.30.25.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462073700393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">// 3. 将数据连接到适配器</span><br><span class="line">BusinessCardAdapter *modelAdapter = [[NewCardModelAdapter alloc] initWithData:newCardModel];</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[ModelAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-2-对象适配器"><a href="#4-2-3-2-对象适配器" class="headerlink" title="4.2.3.2        对象适配器"></a>4.2.3.2        对象适配器</h4><blockquote>
<p><strong>说明：</strong>每种数据模型都使用同一个适配器，适配器中承担为每种数据模型都提供适配的任务。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.31.00.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.38.40.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[CardAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-适配器模式的优缺点"><a href="#4-2-4-适配器模式的优缺点" class="headerlink" title="4.2.4    适配器模式的优缺点"></a>4.2.4    适配器模式的优缺点</h3><p><strong>优点：</strong>降低数据层和视图层之间的耦合度<br><strong>缺点：</strong>对不理解适配器模式的人可读性不好</p>
<h2 id="4-3-策略"><a href="#4-3-策略" class="headerlink" title="4.3    策略"></a>4.3    策略</h2><h3 id="4-3-1-if-else-的问题"><a href="#4-3-1-if-else-的问题" class="headerlink" title="4.3.1    if - else 的问题"></a>4.3.1    if - else 的问题</h3><blockquote>
<p><strong>课程说明：</strong>程序中出现了大量 if - else 之后，出现的阅读障碍以及维护的困境。</p>
</blockquote>
<h3 id="4-3-2-策略模式的原理"><a href="#4-3-2-策略模式的原理" class="headerlink" title="4.3.2    策略模式的原理"></a>4.3.2    策略模式的原理</h3><blockquote>
<p><strong>课程说明：</strong>策略模式的基本原理以及定义的条件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462093482279.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-3-3-策略模式的使用"><a href="#4-3-3-策略模式的使用" class="headerlink" title="4.3.3    策略模式的使用"></a>4.3.3    策略模式的使用</h3><blockquote>
<p><strong>课程说明：</strong>怎样将策略模式用到 <code>UITextField</code> 的验证逻辑上。</p>
<ul>
<li>如何抽象出策略</li>
<li>制定协议来维护输出信息<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%889.41.29.png" alt="Alt text|200x100"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462113251890.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIButton+inits.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIView+SetRect.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIInfomationView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CustomUITextField.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EmailValidator.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PhoneNumberValidator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITextFieldDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *emailField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *phoneNumberField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButton];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化输入框</span></span><br><span class="line">    [<span class="keyword">self</span> initCustonFields];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳 UITextFieldDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)textFieldDidEndEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    Custom<span class="built_in">UITextField</span> *customField = (Custom<span class="built_in">UITextField</span> *)textField;</span><br><span class="line">    <span class="keyword">if</span> ([customField validate] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="comment">// 弹出错误提示窗</span></span><br><span class="line">        [<span class="built_in">UIInfomationView</span> showAlertViewWithTitle:<span class="literal">nil</span></span><br><span class="line">                                         message:customField</span><br><span class="line">                                                .validator</span><br><span class="line">                                                .errorMessage</span><br><span class="line">                               cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                               otherButtonTitles:@[<span class="string">@"确定"</span>]</span><br><span class="line">                                    clickAtIndex:^(<span class="built_in">NSInteger</span> buttonIndex) &#123;</span><br><span class="line">                                        </span><br><span class="line">                                    &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化输入框</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initCustonFields &#123;</span><br><span class="line">    <span class="comment">// 邮箱输入框</span></span><br><span class="line">    <span class="keyword">self</span>.emailField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.emailField.placeholder = <span class="string">@"请输入邮箱"</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.delegate =  <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.validator = [EmailValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.emailField];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手机号输入框</span></span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span> + <span class="number">40</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.placeholder = <span class="string">@"请输入电话号码"</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.validator = [PhoneNumberValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneNumberField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化返回按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButton &#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> createButtonWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">30</span>)</span><br><span class="line">                                            buttonType:<span class="number">0</span></span><br><span class="line">                                                 title:<span class="string">@"Back"</span></span><br><span class="line">                                                   tag:<span class="number">0</span></span><br><span class="line">                                                target:<span class="keyword">self</span></span><br><span class="line">                                                action:<span class="keyword">@selector</span>(buttonEvent:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  结束编辑</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4-策略模式的优缺点"><a href="#4-3-4-策略模式的优缺点" class="headerlink" title="4.3.4    策略模式的优缺点"></a>4.3.4    策略模式的优缺点</h3><p><strong>优点：</strong>避免大量<code>if-else</code>的使用，精简逻辑，可维护性高<br><strong>缺点：</strong>使用场景受限，使用之前就需要确定对应的策略。</p>
<h2 id="4-4-观察者"><a href="#4-4-观察者" class="headerlink" title="4.4    观察者"></a>4.4    观察者</h2><h3 id="4-4-1-如何订阅一本杂志"><a href="#4-4-1-如何订阅一本杂志" class="headerlink" title="4.4.1    如何订阅一本杂志"></a>4.4.1    如何订阅一本杂志</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过讲解如何订阅杂志的生活实例，来讲解何为观察者模式。</p>
</blockquote>
<h4 id="4-4-1-1-如何订阅一本杂志"><a href="#4-4-1-1-如何订阅一本杂志" class="headerlink" title="4.4.1.1    如何订阅一本杂志"></a>4.4.1.1    如何订阅一本杂志</h4><blockquote>
<ol>
<li>通过邮局或网络查询刊物的编号</li>
<li>找到后，提供个人住址等相关信息</li>
<li>发行商在一般每月的固定时间发送刊物</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%8811.30.22.png" alt="Alt text"></p>
<h3 id="4-4-2-通知中心的抽象设计"><a href="#4-4-2-通知中心的抽象设计" class="headerlink" title="4.4.2    通知中心的抽象设计"></a>4.4.2    通知中心的抽象设计</h3><blockquote>
<p><strong>课程说明：</strong>本课时根据订阅杂志的实例，讲解如何将抽象的模型转换成代码。</p>
<ul>
<li>如何抽象接口</li>
<li>对订阅对象的约束：订阅对象必须采纳相应的协议</li>
<li>针对接口编程：先根据目标功能定好接口，然后再具体实现</li>
</ul>
</blockquote>
<p><em>SubscriptionServiceCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenterProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubscriptionServiceCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护订阅信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护客户信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加客户到具体的订阅号当中</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           客户</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从具体的订阅号中移除客户</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           &lt;#customer description#&gt;</span><br><span class="line"> *  @param subscriptionNumber &lt;#subscriptionNumber description#&gt;</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 发送消息</span></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-3-实现通知中心"><a href="#4-4-3-实现通知中心" class="headerlink" title="4.4.3    实现通知中心"></a>4.4.3    实现通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时将实现通知中心，并讲解<code>NSHashTable</code> 与<code>NSParameterAssert</code> 的使用。<br><strong>注意：</strong><code>NSHashTable</code>和<code>NSSet</code>类似，但前者可以不会强引用集合中的元素。</p>
</blockquote>
<ul>
<li>对象持有的问题<br><em>描述</em>：书刊和用户之间的联系导致用户实例无法被释放<br><em>解决</em>：用<code>NSHashTable</code>实现<code>weak</code>引用</li>
<li>参数的严格验证<br><em>描述</em>：比如参数值不允许值为<code>nil</code></li>
</ul>
<p><img src="./屏幕快照 2016-05-02 下午2.57.40.png" alt="Alt text"></p>
<h4 id="4-4-3-1-实现通知中心类"><a href="#4-4-3-1-实现通知中心类" class="headerlink" title="4.4.3.1    实现通知中心类"></a>4.4.3.1    实现通知中心类</h4><p><em>SubscriptionServiceCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"><span class="comment">// 存储订阅号的字典</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *_subscriptionDictionary = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubscriptionServiceCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化存储订阅号的字典</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == [SubscriptionServiceCenter class]) &#123;</span><br><span class="line">        _subscriptionDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取具体的订阅号</span></span><br><span class="line">+ (<span class="built_in">NSHashTable</span> *)existSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="keyword">return</span> [_subscriptionDictionary objectForKey:subscriptionNumber];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable == <span class="literal">nil</span>) &#123;</span><br><span class="line">        hashTable = [<span class="built_in">NSHashTable</span> weakObjectsHashTable];</span><br><span class="line">        [_subscriptionDictionary setObject:hashTable forKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        [_subscriptionDictionary removeObjectForKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(customer);</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable addObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable removeObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];<span class="comment">// 存储订阅号的字典</span></span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        <span class="comment">// 遍历订阅号</span></span><br><span class="line">        <span class="built_in">NSEnumerator</span> *enumerator = [hashTable objectEnumerator];</span><br><span class="line">        <span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;object = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">while</span> (object = [enumerator nextObject]) &#123;</span><br><span class="line">            <span class="comment">// 向每个订阅用户发送订阅订阅内容</span></span><br><span class="line">            <span class="keyword">if</span> ([object respondsToSelector:<span class="keyword">@selector</span>(subscriptionMessage:subscriptionNumber:)]) &#123;</span><br><span class="line">                [object subscriptionMessage:message subscriptionNumber:subscriptionNumber];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-3-2-使用通知中心"><a href="#4-4-3-2-使用通知中心" class="headerlink" title="4.4.3.2    使用通知中心"></a>4.4.3.2    使用通知中心</h4><p><em>SubscriptionServiceCenterProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SubscriptionServiceCenterProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *S<span class="built_in">CIENCE</span> = <span class="string">@"SCIENCE"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">SubscriptionServiceCenterProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅号</span></span><br><span class="line">    [SubscriptionServiceCenter createSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加订阅的用户到指定的刊物</span></span><br><span class="line">    [SubscriptionServiceCenter addCustomer:<span class="keyword">self</span></span><br><span class="line">                    withSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发型机构发送刊物</span></span><br><span class="line">    [SubscriptionServiceCenter sendMessage:<span class="string">@"V1.0"</span></span><br><span class="line">                      toSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳协议 SubscriptionServiceCenterProtocol</span></span><br><span class="line"><span class="comment">// 发行机构发送刊物时触发该方法的调用</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, message, subscriptionNumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-4-KVO与通知中心"><a href="#4-4-4-KVO与通知中心" class="headerlink" title="4.4.4    KVO与通知中心"></a>4.4.4    KVO与通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时简单介绍下 Cocoa 框架中的 KVO 与通知中心的使用。</p>
</blockquote>
<h4 id="4-4-4-1-Cocoa框架的通知中心"><a href="#4-4-4-1-Cocoa框架的通知中心" class="headerlink" title="4.4.4.1    Cocoa框架的通知中心"></a>4.4.4.1    Cocoa框架的通知中心</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>框架提供了自己的通知中心<code>API</code>，该通知中心就是通过观察者模式实现的。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加客户到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(notificationCenterEvent:)</span><br><span class="line">                                                 name:S<span class="built_in">CIENCE</span></span><br><span class="line">                                               object:<span class="string">@"v1.0"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:S<span class="built_in">CIENCE</span></span><br><span class="line">                                                        object:<span class="string">@"V1.0"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当客户收到消息时被调用的方法</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)notificationCenterEvent:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, sender);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// 从通知中心移除</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span></span><br><span class="line">                                              forKeyPath:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-4-2-KVO机制的观察者模式"><a href="#4-4-4-2-KVO机制的观察者模式" class="headerlink" title="4.4.4.2    KVO机制的观察者模式"></a>4.4.4.2    KVO机制的观察者模式</h4><blockquote>
<p><strong>说明：</strong><code>KVO</code>机制本身就是一种观察者模式。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<h5 id="通知中心"><a href="#通知中心" class="headerlink" title="通知中心"></a>通知中心</h5><p><em>Model.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h5><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Model *model;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅中心</span></span><br><span class="line">    <span class="keyword">self</span>.model = [Model new];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户添加订阅中心的"name"服务：当name属性被修改时会发送消息给观察者</span></span><br><span class="line">    [<span class="keyword">self</span>.model addObserver:<span class="keyword">self</span></span><br><span class="line">                 forKeyPath:<span class="string">@"name"</span></span><br><span class="line">                    options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">                    context:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 订阅中心发送消息（通过修改 name 属性值）</span></span><br><span class="line">    <span class="keyword">self</span>.model.name = <span class="string">@"V1.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 通过KVO该表属性时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">	<span class="comment">// 移除 KVO</span></span><br><span class="line">    [<span class="keyword">self</span>.model removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-5-原型模式和外观模式"><a href="#4-5-原型模式和外观模式" class="headerlink" title="4.5    原型模式和外观模式"></a>4.5    原型模式和外观模式</h2><h3 id="4-5-1-原型模式"><a href="#4-5-1-原型模式" class="headerlink" title="4.5.1    原型模式"></a>4.5.1    原型模式</h3><h4 id="4-5-1-1-模版的用处"><a href="#4-5-1-1-模版的用处" class="headerlink" title="4.5.1.1    模版的用处"></a>4.5.1.1    模版的用处</h4><blockquote>
<p><strong>用途：</strong>当要创建的对象有很多相似的细节的时候，就可以通过制作模版简化工作。</p>
</blockquote>
<h4 id="4-5-1-2-原型模式的原理"><a href="#4-5-1-2-原型模式的原理" class="headerlink" title="4.5.1.2    原型模式的原理"></a>4.5.1.2    原型模式的原理</h4><blockquote>
<p><strong>说明：</strong>定义一个协议，采纳该协议个类要实现<code>clone</code>方法，也就是具备拷贝自身的能力。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462191691369.png" alt="Alt text"></p>
</blockquote>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462192387967.png" alt="Alt text"></p>
<p><em>PrototypeCopyProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"> <span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">PrototypeCopyProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  复制自己</span><br><span class="line"> *</span><br><span class="line"> *  @return 返回一个拷贝</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>)clone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">```	</span><br><span class="line">*StudentModel.h*</span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PrototypeCopyProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StudentModel</span> : <span class="title">NSObject</span> &lt;<span class="title">PrototypeCopyProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *address;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *totalScore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>StudentModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">StudentModel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)clone &#123;</span><br><span class="line">    <span class="comment">// 创建一个新的实例</span></span><br><span class="line">    StudentModel *student = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    <span class="comment">// 按照当前实例初始化新的实例</span></span><br><span class="line">    student.name = <span class="keyword">self</span>.name;</span><br><span class="line">    student.age = <span class="keyword">self</span>.age;</span><br><span class="line">    student.address = <span class="keyword">self</span>.address;</span><br><span class="line">    student.totalScore = <span class="keyword">self</span>.totalScore;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生1</span></span><br><span class="line">    StudentModel *stu1 = [[StudentModel alloc] init];</span><br><span class="line">    stu1.name = <span class="string">@"mengxiang"</span>;</span><br><span class="line">    stu1.age = @(<span class="number">1</span>);</span><br><span class="line">    stu1.address = <span class="string">@"海淀区"</span>;</span><br><span class="line">    stu1.totalScore = @(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生2</span></span><br><span class="line">    StudentModel *stu2 = [stu1 clone];<span class="comment">// 应用原型模式</span></span><br><span class="line">    stu2.name = <span class="string">@"Viking"</span>;</span><br><span class="line">    stu2.address = <span class="string">@"Northern Europe"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5-1-3-NSCoping协议的使用细节"><a href="#4-5-1-3-NSCoping协议的使用细节" class="headerlink" title="4.5.1.3    NSCoping协议的使用细节"></a>4.5.1.3    NSCoping协议的使用细节</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>通过<code>NSCoping</code>协议为原型模式提供了支持。<br><strong>注意：</strong></p>
<ul>
<li>深拷贝与浅拷贝</li>
<li>不支持<code>NSCopying</code>协议的对象<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462199219485.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-5-2-外观模式"><a href="#4-5-2-外观模式" class="headerlink" title="4.5.2    外观模式"></a>4.5.2    外观模式</h3><h4 id="4-5-2-1-如何去一个指定的地方"><a href="#4-5-2-1-如何去一个指定的地方" class="headerlink" title="4.5.2.1    如何去一个指定的地方"></a>4.5.2.1    如何去一个指定的地方</h4><blockquote>
<p><strong>说明：</strong>用来说明外观模式的一个显示场景</p>
<ul>
<li>自驾：自己负责路线相关的各种事务</li>
<li>坐火车：将细节交给黑盒</li>
</ul>
</blockquote>
<h4 id="4-5-2-2-外观模式的原理"><a href="#4-5-2-2-外观模式的原理" class="headerlink" title="4.5.2.2    外观模式的原理"></a>4.5.2.2    外观模式的原理</h4><blockquote>
<p><strong>说明：</strong>就是将细节封装了起来，使用时不需要了解细节<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462186013642.png" alt="Alt text"></p>
</blockquote>
<h4 id="4-5-2-3-如何绘制复杂的图形"><a href="#4-5-2-3-如何绘制复杂的图形" class="headerlink" title="4.5.2.3    如何绘制复杂的图形"></a>4.5.2.3    如何绘制复杂的图形</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462201625961.png" alt="Alt text"></p>
<h2 id="4-6-装饰"><a href="#4-6-装饰" class="headerlink" title="4.6    装饰"></a>4.6    装饰</h2><p><code>不改变原类，动态地扩展原类的功能</code></p>
<h3 id="4-6-1-照片与相框"><a href="#4-6-1-照片与相框" class="headerlink" title="4.6.1    照片与相框"></a>4.6.1    照片与相框</h3><blockquote>
<p><strong>课程说明：</strong>通过照片与相框之间的联系，来讲解何为装饰模式。</p>
</blockquote>
<h3 id="4-6-2-装饰模式的原理"><a href="#4-6-2-装饰模式的原理" class="headerlink" title="4.6.2    装饰模式的原理"></a>4.6.2    装饰模式的原理</h3><blockquote>
<p>基本原理<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410189425.png" alt="Alt text"></p>
<p>装饰起模式的优点<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410420677.png" alt="Alt text"></p>
<p> 装饰模式的使用场景</p>
</blockquote>
<p>不知道一个类的实现细节，只知道相关的接口，又需要扩展这个类的功能。</p>
<h3 id="4-6-3-实现装饰模式"><a href="#4-6-3-实现装饰模式" class="headerlink" title="4.6.3    实现装饰模式"></a>4.6.3    实现装饰模式</h3><blockquote>
<p><strong>课程说明：</strong>通过一个扩展游戏机手柄行为的事例，来实现装饰模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463490224877.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463495040772.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-6-4-category的使用"><a href="#4-6-4-category的使用" class="headerlink" title="4.6.4    category的使用"></a>4.6.4    category的使用</h3><blockquote>
<p><strong>课程说明：</strong>讲解 <code>Cocoa</code> 框架已经实现的装饰模式，并延伸讲解下如何给 <code>category</code> 添加属性。<br><strong>说明：</strong>利用<code>Objective-C</code>的动态运行时分配机制，你可以为现有的类添加方法或计算属性，这种机制称为类别(<code>category</code>)。<br><strong>注意：</strong>和装饰模式不同，这种扩展方式会导致原类型的改变。</p>
</blockquote>
<ol>
<li>原类型</li>
</ol>
<p><em>GamePad.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  上下左右的操作</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)up;</span><br><span class="line">- (<span class="keyword">void</span>)down;</span><br><span class="line">- (<span class="keyword">void</span>)left;</span><br><span class="line">- (<span class="keyword">void</span>)right;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  选择与开始的操作</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)select;</span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  按钮 A + B + X + Y</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)commandA;</span><br><span class="line">- (<span class="keyword">void</span>)commandB;</span><br><span class="line">- (<span class="keyword">void</span>)commandX;</span><br><span class="line">- (<span class="keyword">void</span>)commandY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePod.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span></span></span><br><span class="line">- (<span class="keyword">void</span>)up &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"up"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)down &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"down"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)left &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"left"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)right &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"right"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)select &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"select"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"start"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandA &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandA"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandB &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandB"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandX &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandX"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandY &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandY"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>扩展</li>
</ol>
<p><em>GamePad+Coin.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  游戏币</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span>  coin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePad+Coin.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为类和属性之间的关联key</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *_coinStr = <span class="string">@"_coinStr"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setCoin:(<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 将当前类（GamePad）和 coin 属性关联在一起</span></span><br><span class="line">    <span class="comment">// 也就是额外添加了一个属性</span></span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr, @(coin), OBJC_ASSO<span class="built_in">CIATION_ASSIGN</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 通过key扩区绑定到当前类的属性的值</span></span><br><span class="line">    <span class="built_in">NSNumber</span> *number = objc_getAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> number.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>使用扩展后的GamePod</li>
</ol>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">    GamePad *gamePad = [[GamePad alloc] init];</span><br><span class="line">    [gamePad up];</span><br><span class="line">    </span><br><span class="line">    gamePad.coin = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"coin %ld"</span>, (<span class="keyword">long</span>)gamePad.coin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-7-工厂"><a href="#4-7-工厂" class="headerlink" title="4.7    工厂"></a>4.7    工厂</h2><h3 id="4-7-1-制造手机与使用手机"><a href="#4-7-1-制造手机与使用手机" class="headerlink" title="4.7.1    制造手机与使用手机"></a>4.7.1    制造手机与使用手机</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463587653123.png" alt="Alt text"></p>
<h3 id="4-7-2-简单工厂"><a href="#4-7-2-简单工厂" class="headerlink" title="4.7.2    简单工厂"></a>4.7.2    简单工厂</h3><blockquote>
<p><strong>说明：</strong>将“产品”的生产任务封装在“工厂中”</p>
<ol>
<li>简化生产流程</li>
<li>隔离生产产品的细节</li>
<li>不同类型产品之间有着一些共同的功能</li>
<li>一个具体的工厂<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463799288205.png" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="案例：通过简单工厂获取手机实例"><a href="#案例：通过简单工厂获取手机实例" class="headerlink" title="案例：通过简单工厂获取手机实例"></a>案例：通过简单工厂获取手机实例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463798863229.png" alt="Alt text"></p>
<blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463743818102.png" alt="Alt text"></p>
<p>类图：通过</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463715567130.png" alt="Alt text|500x500"></p>
<blockquote>
<p>使用</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DeviceFactory.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过工厂创建手机</span></span><br><span class="line">    iPhoneDevice *iPhone = (iPhoneDevice *)[DeviceFactory deviceFactoryWithDeviceType:kiPhone];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用手机功能</span></span><br><span class="line">    [iPhone fingerprintIndentification];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-7-3-抽象工厂"><a href="#4-7-3-抽象工厂" class="headerlink" title="4.7.3    抽象工厂"></a>4.7.3    抽象工厂</h3><blockquote>
<p><strong>说明：</strong><code>客户端</code>通过<code>抽象工厂</code>创建具体的<code>工厂</code>，然后通过具体的<code>工厂</code>获取产品。相比简单工厂，抽象工厂多了一层抽象，在很多场景中可以比简单工厂更好地解耦。</p>
<ul>
<li>抽象工厂原理</li>
<li>抽象工厂抽象在哪里</li>
<li>抽象工厂使用场景</li>
</ul>
</blockquote>
<h4 id="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"><a href="#案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品" class="headerlink" title="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"></a>案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品</h4><blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816866737.png" alt="Alt text"></p>
<p>类图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816799001.png" alt="Alt text"></p>
<p>使用</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取工厂</span></span><br><span class="line">BaseFactory *factory = [FactoryManager factoryWithBrand:kGoogle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建商品</span></span><br><span class="line">BasePhone *phone = [factory createPhone];</span><br><span class="line">BaseWatch *watch = [factory createWatch];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, phone, watch);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-4-Cocoa-框架中的-NSNumber"><a href="#4-7-4-Cocoa-框架中的-NSNumber" class="headerlink" title="4.7.4    Cocoa 框架中的 NSNumber"></a>4.7.4    Cocoa 框架中的 NSNumber</h3><blockquote>
<p><strong>说明：</strong><code>NSNumber</code>本身是一个抽象工厂类，直接通过该类<code>init</code>一个实例会获得一个<code>nil</code>。<code>NSNumber</code>提供了一系列工厂方法来获取针对具体数值类型的工厂。<br><strong>注意：</strong><code>NSNumber</code>是针对<code>数值</code>的抽象工厂，产品是各种<code>数值</code>类型，而且这些<code>数值</code>之间可以进行类型转换。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 由于NSNumber是一个抽象工厂，这里只会返回一个 nil</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[<span class="built_in">NSNumber</span> alloc] init]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建具体的工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *number = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">100</span>];<span class="comment">// 通过Int类型的100获取一个工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *floatValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">100.</span>f];<span class="comment">// 通过浮点数100.f获取一个工厂实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用工厂实例生产具体的产品（具体类型的数字）</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [number charValue]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [floatValue charValue]);</span><br></pre></td></tr></table></figure>
<h2 id="4-8-桥接"><a href="#4-8-桥接" class="headerlink" title="4.8    桥接"></a>4.8    桥接</h2><blockquote>
<p><strong>说明：</strong>两类存在通信的实体，其实例实现各自的协议，两类实体的实例就可以正确通信。这种设计方式解耦了通信协议的定义和具体实例的实现。</p>
</blockquote>
<h3 id="4-8-1-遥控器与电视机"><a href="#4-8-1-遥控器与电视机" class="headerlink" title="4.8.1 遥控器与电视机"></a>4.8.1 遥控器与电视机</h3><blockquote>
<p><strong>例子：</strong>为遥控器和电视机分别定义了协议，采纳了协议的具体的遥控器和电视机之间只需完成各自的实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463818469080.png" alt="Alt text|400x250"></p>
</blockquote>
<h3 id="4-8-2-桥接模式原理"><a href="#4-8-2-桥接模式原理" class="headerlink" title="4.8.2 桥接模式原理"></a>4.8.2 桥接模式原理</h3><blockquote>
<p><strong>目的：</strong> 把抽象层次结构从具体的实现分离出来，使其能够独立变更。<br><strong>抽象层：</strong>定义了共客户端使用的上层抽象接口。<br><strong>实现层：</strong>定义了供抽象层使用的底层接口。<br><strong>桥接：</strong>实现类的引用被封装到抽象层的实例中，桥接就形成了。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839147515.png" alt="Alt text"></p>
<h3 id="4-8-3-设计游戏机模拟器"><a href="#4-8-3-设计游戏机模拟器" class="headerlink" title="4.8.3 设计游戏机模拟器"></a>4.8.3 设计游戏机模拟器</h3><ul>
<li>游戏机模拟器的功能定义</li>
<li>按钮协议的制定</li>
<li>游戏机模拟器的实现<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839248044.png" alt="Alt text"></li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463845234221.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* GBA系统 ＋ GBA执行器 */</span></span><br><span class="line"><span class="comment">// 创建GBA系统</span></span><br><span class="line">AbstractSystem *gbaSystem = [[GBASystem alloc] init];</span><br><span class="line"><span class="comment">// 设置GBA执行器</span></span><br><span class="line">gbaSystem.implementor = [[GBAImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[gbaSystem loadSystem];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* PSP系统 ＋ PSP执行器 */</span></span><br><span class="line"><span class="comment">// 创建PSP系统</span></span><br><span class="line">AbstractSystem *pspSystem = [[PSPSystem alloc] init];</span><br><span class="line"><span class="comment">// 设置PSP执行器</span></span><br><span class="line">pspSystem.implementor = [[PSPImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[pspSystem loadSystem];</span><br></pre></td></tr></table></figure>
<h2 id="4-9-代理"><a href="#4-9-代理" class="headerlink" title="4.9    代理"></a>4.9    代理</h2><h3 id="4-9-1-代理模式"><a href="#4-9-1-代理模式" class="headerlink" title="4.9.1 代理模式"></a>4.9.1 代理模式</h3><blockquote>
<p><strong>说明：</strong>当一个对象和另一个对象必然耦合的时候，为了降低这种耦合，可以选择和代理对象耦和。代理对象可以是实现了代理协议的任意对象，由于采纳代理协议的对象相比具体对象更灵活且可配置，从而降低了耦和度。<br><strong>注意：</strong>代理对象建议修饰为<code>weak</code>，从而有助于减低消耗。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464019108656.png" alt="Alt text"></p>
<h4 id="案例：顾客和经销商"><a href="#案例：顾客和经销商" class="headerlink" title="案例：顾客和经销商"></a>案例：顾客和经销商</h4><blockquote>
<p>顾客的购买行为代理给经销商</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463899846934.png" alt="Alt text"></p>
<p><em>Customer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Customer</span>;</span></span><br><span class="line"><span class="comment">// 代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CustomerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Customer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理对象(经销商)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;CustomerDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购买</span></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Cosutomer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Customer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="comment">// 确保设置了代理对象，且代理对象正确采纳了协议</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(customer:buyItemCount:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate customer:<span class="keyword">self</span></span><br><span class="line">                   buyItemCount:count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Dealer</span> : <span class="title">NSObject</span> &lt;<span class="title">CustomerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dealer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议，实现方法</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, (<span class="keyword">long</span>)count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 顾客</span></span><br><span class="line">    Customer *customer = [[Customer alloc] init];</span><br><span class="line">    <span class="comment">// 经销商</span></span><br><span class="line">    Dealer *dealer = [[Dealer alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将经销商实例做为代理对象</span></span><br><span class="line">    customer.delegate = dealer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户购买（会代理到dealer的相应方法去处理）</span></span><br><span class="line">    [customer buyItemCount:<span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-2-代理与协议"><a href="#4-9-2-代理与协议" class="headerlink" title="4.9.2 代理与协议"></a>4.9.2 代理与协议</h3><blockquote>
<p><code>代理对象</code>本质上是<code>让对象采纳协议</code>的一种特殊情况。和单纯要求对象采纳某种协议相比，代理对象承担者完成代理任务的同时降低与被调用者之间的耦和度的职能。</p>
</blockquote>
<h4 id="案例：单纯使用协议"><a href="#案例：单纯使用协议" class="headerlink" title="案例：单纯使用协议"></a>案例：单纯使用协议</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463922342138.png" alt="Alt text"></p>
<p><em>TCPProtocol.h</em></p>
<blockquote>
<p><strong>说明：</strong>定义协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TCPProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">// 获取源端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort;</span><br><span class="line"><span class="comment">// 获取目的地端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.h</em></p>
<blockquote>
<p><strong>说明：</strong>采纳协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span> &lt;<span class="title">TCPProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<blockquote>
<p><strong>说明：</strong>实现协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> sourcePort;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 tcp 数据源</span></span><br><span class="line">    Model *tcpData = [[Model alloc] init];</span><br><span class="line">    <span class="comment">// 通过 tcp 数据源获取 tcp 数据</span></span><br><span class="line">    [<span class="keyword">self</span> accessTCPData:tcpData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取 tcp 数据</span><br><span class="line"> *</span><br><span class="line"> *  @param data 采纳了 TCP 协议的数据</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessTCPData:(<span class="keyword">id</span> &lt;TCPProtocol&gt;)data &#123;</span><br><span class="line">    <span class="keyword">self</span>.sourcePort = [data sourcePort];</span><br><span class="line">    <span class="keyword">self</span>.destinationPort = [data destinationPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-3-用NSProxy-实现的代理模式"><a href="#4-9-3-用NSProxy-实现的代理模式" class="headerlink" title="4.9.3 用NSProxy 实现的代理模式"></a>4.9.3 用NSProxy 实现的代理模式</h3><blockquote>
<p><code>NSProxy</code>：没有父类，和<code>NSObject</code>是一个级别的<br><strong>用途：</strong>可以方便地向代理对象发送一系列消息。</p>
</blockquote>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464018921308.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建代理</span></span><br><span class="line">ConcreteProxy *proxy = [ConcreteProxy alloc];</span><br><span class="line"><span class="comment">// 设置代理对象</span></span><br><span class="line">proxy.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 派发消息</span></span><br><span class="line">[proxy helloWorld];</span><br><span class="line">[proxy goodBye];</span><br></pre></td></tr></table></figure>
<h2 id="4-10-单例"><a href="#4-10-单例" class="headerlink" title="4.10    单例"></a>4.10    单例</h2><h3 id="4-10-1-单例模式"><a href="#4-10-1-单例模式" class="headerlink" title="4.10.1 单例模式"></a>4.10.1 单例模式</h3><h4 id="单例模式的基本原理"><a href="#单例模式的基本原理" class="headerlink" title="单例模式的基本原理"></a>单例模式的基本原理</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464186654392.png" alt="Alt text"></p>
<h4 id="单例模式用以解决何种问题"><a href="#单例模式用以解决何种问题" class="headerlink" title="单例模式用以解决何种问题"></a>单例模式用以解决何种问题</h4><blockquote>
<p>保证某个类只会存在一个全局的实例，全局共享</p>
</blockquote>
<h4 id="单例模式的优缺点"><a href="#单例模式的优缺点" class="headerlink" title="单例模式的优缺点"></a>单例模式的优缺点</h4><ul>
<li>优点：共享实例</li>
<li>缺点：使使用到单例实例的类之间耦和在一起</li>
</ul>
<h4 id="案例：存储用户信息的单例类"><a href="#案例：存储用户信息的单例类" class="headerlink" title="案例：存储用户信息的单例类"></a>案例：存储用户信息的单例类</h4><p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取单例</span><br><span class="line"> *</span><br><span class="line"> *  @return 单例实例</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="comment">// 使用全局变量保存单例实例</span></span><br><span class="line">    <span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predict;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predict, ^&#123;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>使用</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, center.name);</span><br></pre></td></tr></table></figure>
<h3 id="4-10-2-编写严格的单例"><a href="#4-10-2-编写严格的单例" class="headerlink" title="4.10.2 编写严格的单例"></a>4.10.2 编写严格的单例</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>防止继承：在<code>init</code>构造器中判断当前类名，当子类调用<code>init</code>或工厂方法创建实例时中断程序</li>
<li>确保实例对象只出现一个：限制<code>init</code>构造器只能在获取实例的工厂方法中调用，而且只调用一次</li>
</ul>
</blockquote>
<p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"><span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predicate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predicate, ^&#123;</span><br><span class="line">        center = (UserInfoManagerCenter *)<span class="string">@"UserInfoManagerCenter"</span>;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">    <span class="comment">// 获取当前实例的类名</span></span><br><span class="line">    <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="comment">// 是子类调用该方法则中断程序</span></span><br><span class="line">    <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *string = (<span class="built_in">NSString</span> *)center;</span><br><span class="line">    <span class="keyword">if</span> ([string isKindOfClass:[<span class="built_in">NSString</span> class]] == <span class="literal">YES</span> &amp;&amp; [string isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">            <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">            <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">            <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 正确获取单例的方法 */</span></span><br><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无效的方式:会引起程序崩溃 */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [NewManagerCenter managerCenter]);<span class="comment">// 试图创建子类实例</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[UserInfoManagerCenter alloc] init]);<span class="comment">// 试图直接调用构造器</span></span><br></pre></td></tr></table></figure>
<h3 id="4-10-3-优化本地存储"><a href="#4-10-3-优化本地存储" class="headerlink" title="4.10.3 优化本地存储"></a>4.10.3 优化本地存储</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>用单例设计存储数据接口</li>
<li>用单例接口隔离实现细节</li>
<li>在单例提供接口的基础上进行上层封装</li>
</ul>
<p><strong>扩展：</strong>使用<a href="https://github.com/nicklockwood/FastCoding" target="_blank" rel="external"> FastCoding </a>替代<code>NSCoding</code>存储数据<br><strong>注意：</strong>启用<code>ARC</code>时<code>FastCoding</code>运行会比较慢，建议关闭</p>
<ul>
<li>文件启用了<code>ARC</code>是代码给出了警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464361708327.png" alt="Alt text"></li>
<li>通过关闭<code>FastCoder</code>对应的文件的<code>ARC</code>清除警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464362026510.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464364328834.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将相对复杂的对象数据存储到用户首选项（借由对象的扩展）</span></span><br><span class="line">StudentModel *student = [[StudentModel alloc] init];</span><br><span class="line">student.name = <span class="string">@"A"</span>;</span><br><span class="line"><span class="built_in">NSArray</span> *array = @[[InfoModel new], [InfoModel new], [InfoModel new]];</span><br><span class="line">student.datas = array;</span><br><span class="line">[student storeValueWithKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从用户首选项中取出数据</span></span><br><span class="line">StudentModel *tmpStudent = [StudentModel valueByKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.name);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.datas);</span><br></pre></td></tr></table></figure>
<h2 id="4-11-备忘录"><a href="#4-11-备忘录" class="headerlink" title="4.11    备忘录"></a>4.11    备忘录</h2><h3 id="4-11-1-如何存储记录"><a href="#4-11-1-如何存储记录" class="headerlink" title="4.11.1    如何存储记录"></a>4.11.1    如何存储记录</h3><blockquote>
<p><strong>课程说明：</strong>用几个简单的示例来说明如何存储纪录，并引申出什么是备忘录模式。</p>
</blockquote>
<ul>
<li>存储记录的必要性</li>
<li>记录的唯一标识符</li>
<li>存储纪录和取出记录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447294270.png" alt="Alt text"></li>
</ul>
<h3 id="4-11-2-备忘录模式"><a href="#4-11-2-备忘录模式" class="headerlink" title="4.11.2 备忘录模式"></a>4.11.2 备忘录模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464417280472.png" alt="Alt text"></p>
<ul>
<li>设计存储中心</li>
<li>制定存储接口</li>
<li>实现存储机制</li>
</ul>
<h3 id="4-11-3-优化存储方案"><a href="#4-11-3-优化存储方案" class="headerlink" title="4.11.3    优化存储方案"></a>4.11.3    优化存储方案</h3><ul>
<li>统一存储规范</li>
<li>实现灵活多变的存储机制</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464445381861.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Apple *apple = [[Apple alloc] init];</span><br><span class="line">apple.name = <span class="string">@"laputa-er"</span>;</span><br><span class="line">apple.age = @(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[apple saveStateWithKey:<span class="string">@"birth"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复到指定的状态</span></span><br><span class="line">[apple recoverFromStateWithKey:<span class="string">@"birth"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="4-11-4-恢复-UIView-的状态"><a href="#4-11-4-恢复-UIView-的状态" class="headerlink" title="4.11.4    恢复 UIView 的状态"></a>4.11.4    恢复 UIView 的状态</h3><blockquote>
<p><strong>摘要：</strong>可以借助上面实现的备忘录模式存储／恢复<code>UIView</code>的状态。</p>
</blockquote>
<h4 id="存储UIView的问题"><a href="#存储UIView的问题" class="headerlink" title="存储UIView的问题"></a>存储UIView的问题</h4><ol>
<li><code>UIView</code>实现了<code>NSCoding</code>协议，但没有实现<code>NSCopy</code>协议。所以，<code>UIView</code>可以被存储下来，但无法拷贝副本</li>
<li><code>NSCoding</code>协议只能存储对象的所有数据，不能仅存储特定的状态数据（比如<code>frame</code>值）</li>
</ol>
<h4 id="使用备忘录模式"><a href="#使用备忘录模式" class="headerlink" title="使用备忘录模式"></a>使用备忘录模式</h4><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 UIView</span></span><br><span class="line">DemoView *demoView = [[DemoView alloc] init];</span><br><span class="line">demoView.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[demoView saveStateWithKey:<span class="string">@"A"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复状态</span></span><br><span class="line">[demoView recoverFromStateWithKey:<span class="string">@"A"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="4-12-生成器"><a href="#4-12-生成器" class="headerlink" title="4.12    生成器"></a>4.12    生成器</h2><blockquote>
<p><strong>说明：</strong>有时，构建某些对象有多种不同的方式。如果这些逻辑包含在构建这些对象的类的单一方法中，构建的逻辑会非常的荒唐（例如，针对各种构建需求的一大片 <code>if-else</code> 或者 <code>switch-case</code> 语句）。如果能够把构建过程分解为<code>客户-指导者-生成器</code>的关系，那么过程将更容易管理与复用。针对此类关系的设计模式称为<code>生成器</code>。</p>
</blockquote>
<h3 id="4-12-1-建造房子的承包商"><a href="#4-12-1-建造房子的承包商" class="headerlink" title="4.12.1 建造房子的承包商"></a>4.12.1 建造房子的承包商</h3><blockquote>
<p><strong>课程说明：</strong>本课时用一个生活中建造房子例子说明并引申出何为生成器模式</p>
<ul>
<li>如何建造房子</li>
<li>建造过程的模块化处理 </li>
<li>不同模块找不同的承包商</li>
</ul>
<p><strong>使用生成器模式的优点：</strong></p>
<ul>
<li>不需要知道细节</li>
<li>模块化处理</li>
<li>很好的组合特性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-12-2-生成器模式"><a href="#4-12-2-生成器模式" class="headerlink" title="4.12.2 生成器模式"></a>4.12.2 生成器模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447882554.png" alt="Alt text"></p>
<h3 id="4-12-3-制造汽车的流程"><a href="#4-12-3-制造汽车的流程" class="headerlink" title="4.12.3 制造汽车的流程"></a>4.12.3 制造汽车的流程</h3><blockquote>
<p><strong>说明：</strong>使用生成器模式来制造一辆汽车。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500610532.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500840393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建组装着（指挥者）</span></span><br><span class="line"><span class="keyword">self</span>.builder = [[Builder alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定承包商</span></span><br><span class="line"><span class="keyword">self</span>.builder.engine = [[YEngine alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.wheels = [[Wheels alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.door = [[Door alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构件所有部件</span></span><br><span class="line">[<span class="keyword">self</span>.builder buildAllParts];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取产品信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.builder.productsInfo);</span><br></pre></td></tr></table></figure>
<h2 id="4-13-命令"><a href="#4-13-命令" class="headerlink" title="4.13    命令"></a>4.13    命令</h2><blockquote>
<p><strong>命令模式：</strong>在软件系统中，<code>行为请求者</code>与<code>行为执行者</code>通常呈现一种“紧耦合”。但在某些场合，比如要对行为进行<code>记录、撤销/重做、事务</code>等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将<code>行为请求者</code>与<code>行为执行者</code>解耦，将行为抽象成对象，实现两者之间的松耦合，这就是我们这门课程所要讲的<code>命令模式</code>。 </p>
</blockquote>
<h3 id="4-13-1-电视机、遥控器与接收器之间的关系"><a href="#4-13-1-电视机、遥控器与接收器之间的关系" class="headerlink" title="4.13.1 电视机、遥控器与接收器之间的关系"></a>4.13.1 电视机、遥控器与接收器之间的关系</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="Alt text"></p>
<ul>
<li>遥控器与接收器并非必要的设备</li>
<li>接收器转换遥控器的信号</li>
</ul>
<h3 id="4-13-2-命令模式"><a href="#4-13-2-命令模式" class="headerlink" title="4.13.2 命令模式"></a>4.13.2 命令模式</h3><ul>
<li>命令的发送者和命令的执行者之间完全解耦</li>
<li>命令可以回退（撤销）</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464515129490.png" alt="Alt text"></p>
<h3 id="4-13-3-改变一个视图的明暗程度"><a href="#4-13-3-改变一个视图的明暗程度" class="headerlink" title="4.13.3 改变一个视图的明暗程度"></a>4.13.3 改变一个视图的明暗程度</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331xcode.gif" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464531258992.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Receiver.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Invoker.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DarkerCommand.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LighterCommand.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 按钮的tag</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSInteger</span> &#123;</span><br><span class="line">    kAddButtonTag = <span class="number">10</span>, <span class="comment">// 增加按钮tag枚举值</span></span><br><span class="line">    kDelButtonTag, <span class="comment">// 减少按钮tag枚举值</span></span><br><span class="line">    kRolButtonTag, <span class="comment">// 回退按钮tag枚举值</span></span><br><span class="line">&#125; ViewControllerEnumValue;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *addButton;<span class="comment">// 增加亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *delButton;<span class="comment">// 减少亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *rolButton;<span class="comment">// 退回按钮</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Receiver *receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化接收器</span></span><br><span class="line">    <span class="keyword">self</span>.receiver = [[Receiver alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.receiver.clientView = <span class="keyword">self</span>.view;<span class="comment">// 关联客户端视图（遥控器）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButtons];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButtons &#123;</span><br><span class="line">    <span class="comment">/*1. 初始化按钮*/</span></span><br><span class="line">    <span class="comment">// 减少亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.delButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.delButton.tag = kDelButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.delButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitle:<span class="string">@"-"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.addButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">40</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.addButton.tag = kAddButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.addButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitle:<span class="string">@"+"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 回退按钮</span></span><br><span class="line">    <span class="keyword">self</span>.rolButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">80</span>, <span class="number">25</span>, <span class="number">90</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.rolButton.tag = kRolButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.rolButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitle:<span class="string">@"回退"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*2. 注册事件*/</span></span><br><span class="line">    [<span class="keyword">self</span>.delButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*3. 添加到视图*/</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.delButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.rolButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  为按钮绑定事件</span><br><span class="line"> *</span><br><span class="line"> *  @param button 需要绑定事件的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    <span class="keyword">if</span> (button.tag == kAddButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"增加亮度"</span>);</span><br><span class="line">        LighterCommand *command = [[LighterCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                 parameter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];<span class="comment">// 添加并执行命令</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kDelButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"减少亮度"</span>);</span><br><span class="line">        DarkerCommand *command = [[DarkerCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                paramter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kRolButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"回退操作"</span>);</span><br><span class="line">        [[Invoker shareInstance] rollBack];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-14-组合"><a href="#4-14-组合" class="headerlink" title="4.14    组合"></a>4.14    组合</h2><blockquote>
<p><strong>说明：</strong>将对象组合成树形结构以表示<code>部分-整体</code>的层次结构，组合模式使得用户对单个对象和组合对象的使用具有一致性。组合设计模式可以解决某些线性结构无法解决的难题（如编写文件夹目录结构等类似问题），掌握它具有很实用的意义。 </p>
</blockquote>
<h3 id="4-14-1-树形结构"><a href="#4-14-1-树形结构" class="headerlink" title="4.14.1    树形结构"></a>4.14.1    树形结构</h3><blockquote>
<p><strong>课程说明：</strong>讲解树形结构，并实现一个简易的二叉树，对于后续的组合设计模式的理解很有帮助。</p>
<ul>
<li>树形结构原理</li>
<li>简易的二叉树</li>
<li>用递归遍历树形结构节点</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464533251952.png" alt="Alt text|200x300"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当前节点名</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  左节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *leftNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  右节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rightNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    <span class="comment">// 创建节点实例（考虑子类的情况，使用 self class 创建实例）</span></span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  根节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rootNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建根节点</span></span><br><span class="line">    <span class="keyword">self</span>.rootNode = [Node nodeWithName:<span class="string">@"A"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"B"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"C"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"D"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"E"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"F"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历二叉树</span></span><br><span class="line">    [<span class="keyword">self</span> treeInfomationWithNode:<span class="keyword">self</span>.rootNode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  往根节点上插入节点</span><br><span class="line"> *</span><br><span class="line"> *  @param tree 根节点</span><br><span class="line"> *  @param node 被插入的节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)insertNodeTree:(Node *)tree node:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tree.leftNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.leftNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (tree.rightNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.rightNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:tree.leftNode node:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遍历二叉树</span><br><span class="line"> *</span><br><span class="line"> *  @param node 根节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)treeInfomationWithNode:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node.leftNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.leftNode];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.nodeName);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (node.rightNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.rightNode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-2-组合模式"><a href="#4-14-2-组合模式" class="headerlink" title="4.14.2    组合模式"></a>4.14.2    组合模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464611058484.png" alt="Alt text"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  节点名字</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加子节点</span><br><span class="line"> *</span><br><span class="line"> *  @param nodes 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)nodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  删除字节点</span><br><span class="line"> *</span><br><span class="line"> *  @param node 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  打印 Node</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)operation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-3-编写文件夹系统"><a href="#4-14-3-编写文件夹系统" class="headerlink" title="4.14.3 编写文件夹系统"></a>4.14.3 编写文件夹系统</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464616045947.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464676034326.png" alt="Alt text"></p>
<h2 id="4-15-迭代器"><a href="#4-15-迭代器" class="headerlink" title="4.15    迭代器"></a>4.15    迭代器</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示，这种模式叫迭代器模式，<code>Cocoa</code> 框架中的 <code>NSEnumerator</code> 就是迭代器模式的具体实现。学习迭代器模式有助于理解线性表结构的常规使用，对于优化具备线性表结构的类有实际意义。 </p>
</blockquote>
<h3 id="4-15-1-线性表"><a href="#4-15-1-线性表" class="headerlink" title="4.15.1 线性表"></a>4.15.1 线性表</h3><blockquote>
<p><strong>课程说明：</strong>讲解常用线性表基本原理，对于理解何为迭代器模式很有帮助。<br><strong>线性表：</strong>线性表中数据元素之间的关系是一对一的关系，即除了第一个和最后一个数据元素之外，其它数据元素都是首尾相接的（注意，这句话只适用大部分线性表，而不是全部。比如，循环链表逻辑层次上也是一种线性表（存储层次上属于链式存储），但是把最后一个数据元素的尾指针指向了哨位结点）。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700648380.png" alt="Alt text"></p>
<blockquote>
<p>栈和队列就是典型的线性表<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700681237.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-15-2-迭代器模式"><a href="#4-15-2-迭代器模式" class="headerlink" title="4.15.2 迭代器模式"></a>4.15.2 迭代器模式</h3><blockquote>
<p><strong>课程说明：</strong>讲解迭代器模式基本原理，并简单介绍下 <code>Cocoa</code> 框架已经实现的迭代器。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464708309582.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 系统自身的集合和迭代器 */</span></span><br><span class="line"><span class="comment">// 创建集合对象</span></span><br><span class="line"><span class="built_in">NSArray</span> *datas = @[<span class="string">@"A"</span>, <span class="string">@"B"</span>, <span class="string">@"C"</span>, <span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *iterator = [datas objectEnumerator];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器访问元素</span></span><br><span class="line"><span class="keyword">id</span> arrObj = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (arrObj = [iterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, arrObj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义的集合和迭代器 */</span></span><br><span class="line"><span class="keyword">self</span>.list = [[LinkedList alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"A"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"B"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"C"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line">LinkedListIterator *linkedIterator = [LinkedListIterator linkedListIteratorWithLinkedList:<span class="keyword">self</span>.list];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器遍历元素</span></span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (node = [linkedIterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-15-3-实现组合对象的迭代器"><a href="#4-15-3-实现组合对象的迭代器" class="headerlink" title="4.15.3 实现组合对象的迭代器"></a>4.15.3 实现组合对象的迭代器</h3><blockquote>
<p><strong>课程说明：</strong>实现一个组合对象的迭代器，并遍历出该组合对象中我们需要关心的元素。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464751736763.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">Custom<span class="built_in">UIView</span> *custom<span class="built_in">UIView</span> = [[Custom<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">[custom<span class="built_in">UIView</span> resetIterator];</span><br><span class="line"><span class="keyword">while</span> (node = [custom<span class="built_in">UIView</span> nextObject]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_3  音频视频处理/" itemprop="url">
                  3 音频视频处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:52+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-iOS-API视频的播放和录制"><a href="#3-1-iOS-API视频的播放和录制" class="headerlink" title="3.1    iOS API视频的播放和录制"></a>3.1    iOS API视频的播放和录制</h2><blockquote>
<p><strong>注意：</strong><code>MPMoviePlayerViewController</code>在<code>iOS9中</code>过时了</p>
</blockquote>
<h3 id="3-1-1-播放视频"><a href="#3-1-1-播放视频" class="headerlink" title="3.1.1    播放视频"></a>3.1.1    播放视频</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_video1.gif" alt="Alt text|200x350"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> pc:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        pc = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSBundle</span>.mainBundle().<span class="type">URLForResource</span>(<span class="string">"video"</span>, withExtension: <span class="string">"mp4"</span>))</span><br><span class="line">        presentViewController(pc, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-录制视频"><a href="#3-1-2-录制视频" class="headerlink" title="3.1.2    录制视频"></a>3.1.2    录制视频</h3><blockquote>
<p><strong>注意：</strong> xcode 的虚拟机不支持使用相机，模拟使用相机只能选择真机！<br><strong>技巧：</strong>调试时可以通过<code>window-&gt;Devices</code>，在设备管理面板选择要管理的设备进行操作（比如截屏）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MobileCoreServices<span class="comment">// 录制视频使用到的库</span></span><br><span class="line"><span class="keyword">import</span> MediaPlayer<span class="comment">// 播放视频用到的库</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UIImagePickerControllerDelegate</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片选择器</span></span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">UIImagePickerController</span>!<span class="comment">// 可以选择从图库或摄像头中选择图片或视频（源为摄像头意味着拍照或视频）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> videoUrl:<span class="type">NSURL</span>?</span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录制</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">recVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        picker = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        picker.mediaTypes = [kUTTypeMovie <span class="keyword">as</span> <span class="type">String</span>]</span><br><span class="line">        picker.sourceType = <span class="type">UIImagePickerControllerSourceType</span>.<span class="type">Camera</span><span class="comment">// 设置源通过摄像头</span></span><br><span class="line">        picker.cameraCaptureMode = <span class="type">UIImagePickerControllerCameraCaptureMode</span>.<span class="type">Video</span><span class="comment">// 设置摄像头为录制视频模式</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = videoUrl &#123;</span><br><span class="line">            player = <span class="type">MPMoviePlayerViewController</span>(contentURL: url)</span><br><span class="line">            presentViewController(player, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选中了视频时（录制完成后）被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(picker: UIImagePickerController, didFinishPickingImage image: UIImage, editingInfo: [String : AnyObject]?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取录制好的视频资源的url地址</span></span><br><span class="line">        videoUrl = editingInfo![<span class="type">UIImagePickerControllerMediaURL</span>] <span class="keyword">as</span>? <span class="type">NSURL</span></span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消录制视频时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerControllerDidCancel</span><span class="params">(picker: UIImagePickerController)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS音频相关-API-的使用"><a href="#3-2-iOS音频相关-API-的使用" class="headerlink" title="3.2    iOS音频相关 API 的使用"></a>3.2    iOS音频相关 API 的使用</h2><h3 id="3-2-1-播放声音"><a href="#3-2-1-播放声音" class="headerlink" title="3.2.1    播放声音"></a>3.2.1    播放声音</h3><blockquote>
<p><strong>说明：</strong>给出两种方式</p>
<ul>
<li>使用<code>AVAudioPlayer</code>播放音乐文件</li>
<li>使用<code>MediaPlayer</code>播放音乐</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> aPlayer:<span class="type">AVAudioPlayer</span>!</span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 暂定</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">pauseBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.pause()<span class="comment">// 暂停后音乐仍然处在准备播放的状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.stop()<span class="comment">// 通知后音乐不会处在准备播放状态，但会记住停止时的位置</span></span><br><span class="line">        aPlayer.currentTime = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另一种方式播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playSongBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 初始化播放控制器</span></span><br><span class="line">        <span class="keyword">let</span> p = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        presentViewController(p, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 初始化 AVAudioPlayer</span></span><br><span class="line">            aPlayer = <span class="keyword">try</span> <span class="type">AVAudioPlayer</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"failed"</span>)</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-播放乐库音乐"><a href="#3-2-2-播放乐库音乐" class="headerlink" title="3.2.2    播放乐库音乐"></a>3.2.2    播放乐库音乐</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>（<code>ViewController</code>）采纳<code>MPMediaPickerControllerDelegate</code>协议</li>
<li>初始化媒体选择控制器（<code>MPMediaPickerController</code>）和音乐播放控制器（<code>MPMusicPlayerController</code>）</li>
<li>实现采纳协议的相关方法</li>
</ol>
<p><strong>注意：</strong>在虚拟机中是不能使用音乐库的</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">MPMediaPickerControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">MPMediaPickerController</span>!<span class="comment">// 选择音乐控制器</span></span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMusicPlayerController</span>!<span class="comment">// 播放音乐控制器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSelectMusicClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐完成后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPicker</span><span class="params">(mediaPicker: MPMediaPickerController, didPickMediaItems mediaItemCollection: MPMediaItemCollection)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭视频选择控制器</span></span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 将选中的音乐加入到播放列表</span></span><br><span class="line">        player.setQueueWithItemCollection(mediaItemCollection)</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        player.play()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取选中的第一首歌的名字</span></span><br><span class="line">        <span class="keyword">let</span> firstName:<span class="type">AnyObject</span> = mediaItemCollection.items[<span class="number">0</span>].valueForProperty(<span class="type">MPMediaItemPropertyTitle</span>)!</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(firstName)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消播放时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPickerDidCancel</span><span class="params">(mediaPicker: MPMediaPickerController)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cancel"</span>)</span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        picker = <span class="type">MPMediaPickerController</span>(mediaTypes: <span class="type">MPMediaType</span>.<span class="type">Music</span>)</span><br><span class="line">        picker.allowsPickingMultipleItems = <span class="literal">true</span><span class="comment">// 可以选择多个</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        </span><br><span class="line">        player = <span class="type">MPMusicPlayerController</span>.systemMusicPlayer()<span class="comment">// 创建全局音乐播放器(程序退出后仍可以播放)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-录制声音"><a href="#3-2-3-录制声音" class="headerlink" title="3.2.3    录制声音"></a>3.2.3    录制声音</h3><blockquote>
<p><strong>疑问：</strong>下面程序找到的<code>Documents</code>文件夹路径不可用，竟然在<code>Library</code>下面，但下面其实没有<code>Documents</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E/Library/Documentation/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cd</span> /Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E</span><br><span class="line"></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── Documents</span><br><span class="line">├── Library</span><br><span class="line">│   ├── Caches</span><br><span class="line">│   │   └── Snapshots</span><br><span class="line">│   │       └── com.earth.L0204-----</span><br><span class="line">│   │           ├── 50998B49-4017-4DAA-A8BB-49F0A32325DD@2x.png</span><br><span class="line">│   │           └── C0EB8483-DCD1-41F9-8F4D-1AADC05666E1@2x.png</span><br><span class="line">│   └── Preferences</span><br><span class="line">└── tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> avRec:<span class="type">AVAudioRecorder</span>!<span class="comment">// 录音器</span></span><br><span class="line">    <span class="keyword">var</span> audioFileUrl:<span class="type">NSURL</span>!<span class="comment">// 保存地址</span></span><br><span class="line">    <span class="keyword">var</span> avPlayer:<span class="type">AVAudioPlayer</span>!<span class="comment">// 播放器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">startRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"start rec"</span>)</span><br><span class="line">        avRec.record()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopRecBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"stop rec"</span>)</span><br><span class="line">        avRec.stop()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"play rec：\(audioFileUrl)"</span>)</span><br><span class="line">        avPlayer = <span class="keyword">try</span>? <span class="type">AVAudioPlayer</span>(contentsOfURL: audioFileUrl)</span><br><span class="line">        avPlayer.prepareToPlay()</span><br><span class="line">        avPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        audioFileUrl = (<span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">NSURL</span>).<span class="type">URLByAppendingPathComponent</span>(<span class="string">"rec"</span>)</span><br><span class="line">        avRec = <span class="keyword">try</span>? <span class="type">AVAudioRecorder</span>(<span class="type">URL</span>: audioFileUrl,</span><br><span class="line">                                        settings: [:])</span><br><span class="line">        avRec.prepareToRecord()</span><br><span class="line"><span class="comment">// 查看文件路径</span></span><br><span class="line">        <span class="keyword">let</span> sp = <span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sp &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(item)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_2  网络通信/" itemprop="url">
                  2 网络通信
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:10+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="2-1-iOS-HTTP通信"><a href="#2-1-iOS-HTTP通信" class="headerlink" title="2.1    iOS-HTTP通信"></a>2.1    iOS-HTTP通信</h2><h3 id="2-1-1-同步加载网络数据"><a href="#2-1-1-同步加载网络数据" class="headerlink" title="2.1.1    同步加载网络数据"></a>2.1.1    同步加载网络数据</h3><blockquote>
<p><strong>说明：</strong>介绍两种方式</p>
<ul>
<li><code>NSString</code>提供的构造器</li>
<li><code>NSURLConnection.sendSynchronousRequest</code>方法（iOS 9中已过时）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPageByNSString()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSString）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSString</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> str = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> data = <span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(str)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSURLConnection）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSURLConnection</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> resp:<span class="type">NSURLResponse</span>?</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">NSURLConnection</span>.sendSynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://hikexueyuan.com"</span>)!), returningResponse: &amp;resp)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(resp)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-异步加载网络数据"><a href="#2-2-2-异步加载网络数据" class="headerlink" title="2.2.2    异步加载网络数据"></a>2.2.2    异步加载网络数据</h3><blockquote>
<p><strong>说明：</strong><code>NSURLConnection.sendAsynchronousRequest</code>（在<code>iOS9 中过时</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPage()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPage</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!), queue: <span class="type">NSOperationQueue</span>()) &#123;(resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> e = error &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"请求失败:\(e)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="type">NSString</span>(data: data!, encoding: <span class="type">NSUTF8StringEncoding</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-搭建J2E集成开发环境"><a href="#2-2-3-搭建J2E集成开发环境" class="headerlink" title="2.2.3 搭建J2E集成开发环境"></a>2.2.3 搭建J2E集成开发环境</h3><h4 id="2-2-3-1-安装-Apache-Tomcat"><a href="#2-2-3-1-安装-Apache-Tomcat" class="headerlink" title="2.2.3.1    安装 Apache Tomcat"></a>2.2.3.1    安装 Apache Tomcat</h4><blockquote>
<p><strong>下载 Apache Tomcat：</strong><a href="http://tomcat.apache.org/download-80.cgi" target="_blank" rel="external">http://tomcat.apache.org/download-80.cgi</a></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.30.32.png" alt="Alt text"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo mkdir -p /usr/<span class="built_in">local</span></span><br><span class="line">$ mv ~/Downloads/apache-tomcat-8.0.33 /usr/<span class="built_in">local</span></span><br><span class="line">$ sudo ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/apache-tomcat-8.0.33 /Library/Tomcat8</span><br><span class="line">$ chown -R  tonyearth /Library/Tomcat8</span><br><span class="line">$ sudo chown -R  tonyearth /Library/Tomcat8/bin/*.sh</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-2-安装-Tomcat-Controller"><a href="#2-2-3-2-安装-Tomcat-Controller" class="headerlink" title="2.2.3.2    安装 Tomcat Controller"></a>2.2.3.2    安装 Tomcat Controller</h4><blockquote>
<p><strong>下载 Tomcat Controller：</strong><a href="http://tomcat-controller.en.softonic.com/mac/download#downloading" target="_blank" rel="external">http://tomcat-controller.en.softonic.com/mac/download#downloading</a></p>
</blockquote>
<h4 id="2-2-3-3-安装-eclispe"><a href="#2-2-3-3-安装-eclispe" class="headerlink" title="2.2.3.3    安装 eclispe"></a>2.2.3.3    安装 eclispe</h4><blockquote>
<p><strong>下载eclipse：</strong><a href="http://www.eclipse.org/downloads/" target="_blank" rel="external">http://www.eclipse.org/downloads/</a></p>
</blockquote>
<h5 id="创建Dynamic-Web-Project"><a href="#创建Dynamic-Web-Project" class="headerlink" title="创建Dynamic Web Project"></a>创建Dynamic Web Project</h5><ol>
<li>开始创建新项目<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.45.png" alt="Alt text|300x150"></li>
<li>New Runtime<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.56.png" alt="Alt text|300x200"></li>
<li>选择前面安装好的 Tomecat8 的安装目录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.17.png" alt="Alt text|300x120"></li>
<li>创建 JSP文件 测试<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.39.14.png" alt="Alt text|300x200"></li>
</ol>
<h3 id="2-2-4-通过GET-POST方式与服务器通信"><a href="#2-2-4-通过GET-POST方式与服务器通信" class="headerlink" title="2.2.4    通过GET/POST方式与服务器通信"></a>2.2.4    通过GET/POST方式与服务器通信</h3><h4 id="2-2-4-1-后端"><a href="#2-2-4-1-后端" class="headerlink" title="2.2.4.1    后端"></a>2.2.4.1    后端</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461253557430.png" alt="Alt text|200x200"></p>
<p><em>returnParas.jsp</em></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">if</span> (name != <span class="keyword">null</span>) &#123;</span><br><span class="line">	out.print(<span class="string">"Hello "</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	out.print(<span class="string">"No Args"</span>);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-2-客户端"><a href="#2-2-4-2-客户端" class="headerlink" title="2.2.4.2    客户端"></a>2.2.4.2    客户端</h4><blockquote>
<p><strong>注意：</strong>下面请求使用的<code>API</code>在<code>iOS9</code>中已过时<br><strong>技巧：</strong>网络请求交给子线程而不是主线程处理，不占用主线程的资源，从而不带来界面卡顿的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462710986603_get.gif" alt="Alt text|300x200"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textInput: <span class="type">UITextField</span>!<span class="comment">// 输入请求参数</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textShow: <span class="type">UITextView</span>!<span class="comment">// 展示请求会的结果</span></span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnRequestPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        testGet()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送 get 请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testGet</span><span class="params">()</span></span>-&gt; () &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建一个线程发起请求，不占用主线程的资源</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp?name=\(name)"</span>)!), queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                <span class="comment">// 交给主线程处理</span></span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="comment">// self.textShow 是主线程的控件，因此必须在主线程中处理</span></span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送post请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testPost</span><span class="params">()</span></span>-&gt;() &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建并设置请求</span></span><br><span class="line">        <span class="keyword">let</span> req = <span class="type">NSMutableURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp"</span>)!)</span><br><span class="line">        req.<span class="type">HTTPMethod</span> = <span class="string">"POST"</span></span><br><span class="line">        req.<span class="type">HTTPBody</span> = <span class="type">NSString</span>(string: <span class="string">"name=\(name)"</span>).dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(req, queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_1  数据处理/" itemprop="url">
                  1 数据处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:02:28+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-操作plist数据"><a href="#1-1-操作plist数据" class="headerlink" title="1.1    操作plist数据"></a>1.1    操作plist数据</h2><h3 id="1-1-1-plist数据介绍"><a href="#1-1-1-plist数据介绍" class="headerlink" title="1.1.1    plist数据介绍"></a>1.1.1    plist数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解<code>plist</code>数据格式以及如何编辑<code>plist</code>文件。</p>
</blockquote>
<h3 id="1-1-2-plist数组解析"><a href="#1-1-2-plist数组解析" class="headerlink" title="1.1.2    plist数组解析"></a>1.1.2    plist数组解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析plist数组。</p>
</blockquote>
<p><em>TestArr.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-16%20%E4%B8%8B%E5%8D%8811.46.38.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 取出plist中的数据（数组）</span></span><br><span class="line"><span class="keyword">let</span> arr = <span class="type">NSArray</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestArr"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Optional((</span><br><span class="line">    human,</span><br><span class="line">    bear,</span><br><span class="line">    elephant,</span><br><span class="line">    wolf,</span><br><span class="line">    monkey,</span><br><span class="line">    tiger</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<h3 id="1-1-3-plist字典解析"><a href="#1-1-3-plist字典解析" class="headerlink" title="1.1.3    plist字典解析"></a>1.1.3    plist字典解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析<code>plist</code>字典。</p>
</blockquote>
<p><em>TestDic.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460822236961.png" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> dict = <span class="type">NSDictionary</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestDic"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dict)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Optional(&#123;</span><br><span class="line">    event = film;</span><br><span class="line">    members =     (</span><br><span class="line">        me,</span><br><span class="line">        lili,</span><br><span class="line">        xiaoli</span><br><span class="line">    );</span><br><span class="line">    time = <span class="string">"2016\U5e744\U670816\U65e5\U5468\U516d\U4e0b\U534811:54"</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="1-2-CoreData"><a href="#1-2-CoreData" class="headerlink" title="1.2    CoreData"></a>1.2    CoreData</h2><h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><blockquote>
<p><strong>官网：</strong><a href="http://sqlite.org/" target="_blank" rel="external">http://sqlite.org/</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_coredata.gif" alt="案例| 200x150"></p>
</blockquote>
<h3 id="1-2-1-创建使用CoreData的项目"><a href="#1-2-1-创建使用CoreData的项目" class="headerlink" title="1.2.1    创建使用CoreData的项目"></a>1.2.1    创建使用<code>CoreData</code>的项目</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍<code>SQLite</code>以及如何创建一个使用<code>CoreData</code>的项目。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.32.25.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 操作sqlite的上下文环境</span></span><br><span class="line"><span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-设计数据结构"><a href="#1-2-2-设计数据结构" class="headerlink" title="1.2.2    设计数据结构"></a>1.2.2    设计数据结构</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用<code>Xcode</code>设计数据库的结构。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.40.34.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-2-3-插入数据"><a href="#1-2-3-插入数据" class="headerlink" title="1.2.3    插入数据"></a>1.2.3    插入数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何插入一条数据。</p>
</blockquote>
<h4 id="1-2-3-1-插入数据"><a href="#1-2-3-1-插入数据" class="headerlink" title="1.2.3.1    插入数据"></a>1.2.3.1    插入数据</h4><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 1. 获取操作sqlite的上下文环境</span></span><br><span class="line">        <span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        <span class="comment">// 2. 为 Users 表插入一行数据</span></span><br><span class="line">        <span class="comment">// 创建一行（字段为默认值）</span></span><br><span class="line">        <span class="keyword">let</span> row:<span class="type">AnyObject</span> = <span class="type">NSEntityDescription</span>.insertNewObjectForEntityForName(<span class="string">"Users"</span>, inManagedObjectContext:context)</span><br><span class="line">        <span class="comment">// 设置 name 字段</span></span><br><span class="line">        row.setValue(<span class="string">"jikexueyuan"</span>, forKey:<span class="string">"name"</span>)</span><br><span class="line">        <span class="comment">// 设置 age 字段</span></span><br><span class="line">        row.setValue(<span class="number">10</span>, forKey: <span class="string">"age"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 持久化</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> context.save()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Error"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-3-2-查看SQLite文件地址"><a href="#1-2-3-2-查看SQLite文件地址" class="headerlink" title="1.2.3.2    查看SQLite文件地址"></a>1.2.3.2    查看<code>SQLite</code>文件地址</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%886.00.14.png" alt="Alt text"><br><em>AppDelegate.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	 <span class="built_in">lazy</span> <span class="keyword">var</span> persistentStoreCoordinator: <span class="type">NSPersistentStoreCoordinator</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> coordinator = <span class="type">NSPersistentStoreCoordinator</span>(managedObjectModel: <span class="keyword">self</span>.managedObjectModel)</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">self</span>.applicationDocumentsDirectory.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"SingleViewCoreData.sqlite"</span>)</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">		...</span><br><span class="line">     &#125;()</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/1041D05D-4C13-45A9-BD8C-B209722B59F2/data/Containers/Data/Application/AA16281E-DE67-4A56-859C-2C96834101CE/Documents/SingleViewCoreData.sqlite</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-读取数据"><a href="#1-2-4-读取数据" class="headerlink" title="1.2.4    读取数据"></a>1.2.4    读取数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取<code>SQLite</code>的数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">let</span> f = <span class="type">NSFetchRequest</span>(entityName: <span class="string">"Users"</span>)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> dataArr = context.executeFetchRequest(f)</span><br><span class="line">    tableView.reloadData()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"数据查询失败"</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="1-2-5-更新数据"><a href="#1-2-5-更新数据" class="headerlink" title="1.2.5    更新数据"></a>1.2.5    更新数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何更新数据。</p>
</blockquote>
<p><em>UserContentViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserContentViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfName: <span class="type">UITextField</span>!<span class="comment">// 姓名</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfAge: <span class="type">UITextField</span>!<span class="comment">// 年龄</span></span><br><span class="line">    <span class="keyword">var</span> data:<span class="type">NSManagedObject</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        tfName.text = data.valueForKey(<span class="string">"name"</span>) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> age:<span class="type">AnyObject</span>! = data.valueForKey(<span class="string">"age"</span>)</span><br><span class="line">        tfAge.text = <span class="string">"\(age)"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击提交按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">submitBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">	    <span class="comment">// 更新数据</span></span><br><span class="line">        data.setValue(tfName.text, forKey: <span class="string">"name"</span>)</span><br><span class="line">        data.setValue(<span class="type">Int</span>(tfAge.text!), forKey: <span class="string">"age"</span>)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> data.managedObjectContext?.save()</span><br><span class="line">            dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"save failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击取消按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">cancelBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-6-删除数据"><a href="#1-2-6-删除数据" class="headerlink" title="1.2.6    删除数据"></a>1.2.6    删除数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何删除数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTableViewController</span>: <span class="title">UITableViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存放数据库信息</span></span><br><span class="line">    <span class="keyword">var</span> dataArr:<span class="type">Array</span>&lt;<span class="type">AnyObject</span>&gt; = []</span><br><span class="line">    <span class="comment">// 数据库上下文</span></span><br><span class="line">    <span class="keyword">var</span> context:<span class="type">NSManagedObjectContext</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        refreshData()</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Override to support editing the table view.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, commitEditingStyle editingStyle: UITableViewCellEditingStyle, forRowAtIndexPath indexPath: NSIndexPath)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 删除 table 中的一个cell</span></span><br><span class="line">        <span class="keyword">if</span> editingStyle == .<span class="type">Delete</span> &#123;</span><br><span class="line">            <span class="comment">// 删除数据</span></span><br><span class="line">            context.deleteObject(dataArr[indexPath.row] <span class="keyword">as</span>! <span class="type">NSManagedObject</span>)</span><br><span class="line">            <span class="comment">// 持久化</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> context.save()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"删除数据失败"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            refreshData()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向 table 中插入一条 cell</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> editingStyle == .<span class="type">Insert</span> &#123;</span><br><span class="line">            <span class="comment">// Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-操作-JSON-数据"><a href="#1-3-操作-JSON-数据" class="headerlink" title="1.3    操作 JSON 数据"></a>1.3    操作 JSON 数据</h2><h3 id="1-3-1-JSON数据介绍"><a href="#1-3-1-JSON数据介绍" class="headerlink" title="1.3.1    JSON数据介绍"></a>1.3.1    JSON数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>JSON</code> 格式数据的语法。</p>
</blockquote>
<h3 id="1-3-2-Swift-解析-JSON-数据"><a href="#1-3-2-Swift-解析-JSON-数据" class="headerlink" title="1.3.2    Swift 解析 JSON 数据"></a>1.3.2    Swift 解析 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言解析 <code>JSON</code> 格式的数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 从json文件中读取 json 格式数据</span></span><br><span class="line">    <span class="keyword">let</span> json:<span class="type">AnyObject</span>? = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(<span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"obj"</span>, ofType: <span class="string">"json"</span>)!))!, options: <span class="type">NSJSONReadingOptions</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 索引 json 内容</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> lang:<span class="type">AnyObject</span> = json?.objectForKey(<span class="string">"language"</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(lang)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"json 文件读取失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-Swift-生成-JSON-数据"><a href="#1-3-3-Swift-生成-JSON-数据" class="headerlink" title="1.3.3    Swift 生成 JSON 数据"></a>1.3.3    Swift 生成 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言生成<code>JSON</code> 格式数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字典</span></span><br><span class="line"><span class="keyword">let</span> dict = [<span class="string">"name"</span>:<span class="string">"lixiangguo"</span>, <span class="string">"age"</span>: <span class="string">"-1"</span>];</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 将字典转化为 json 格式的NSData</span></span><br><span class="line">    <span class="keyword">let</span> jsonData = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.dataWithJSONObject(dict, options: <span class="type">NSJSONWritingOptions</span>())</span><br><span class="line">    <span class="comment">// 将 NSData 转换为 NSString</span></span><br><span class="line">    <span class="keyword">let</span> jsonStr  = <span class="type">NSString</span>(data: jsonData, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(jsonStr)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"字典解析为json格式字符串失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-4-操作XML数据"><a href="#1-4-操作XML数据" class="headerlink" title="1.4    操作XML数据"></a>1.4    操作XML数据</h2><h3 id="1-4-1-XML格式数据介绍"><a href="#1-4-1-XML格式数据介绍" class="headerlink" title="1.4.1    XML格式数据介绍"></a>1.4.1    XML格式数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍XML格式数据的结构以及如何编写XML文件</p>
</blockquote>
<h3 id="1-4-2-Swift解析XML格式的数据"><a href="#1-4-2-Swift解析XML格式的数据" class="headerlink" title="1.4.2    Swift解析XML格式的数据"></a>1.4.2    Swift解析XML格式的数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用Swift语言解析<code>XML</code>格式的数据</p>
<ol>
<li>引入资源：xml 文件</li>
<li>采纳协议：<code>NSXMLParserDelegate</code></li>
<li>获取资源并解析（通过代理）</li>
</ol>
</blockquote>
<p><em>testData.xml</em></p>
<blockquote>
<p><strong>说明：</strong>待解析的 xml 文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>mengqingshen<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>yixiaoli<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"0.3"</span>&gt;</span>mengxiang<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c</span>&gt;</span>Data<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">NSXMLParserDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前解析出的节点</span></span><br><span class="line">    <span class="keyword">var</span> currentNodeName:<span class="type">String</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过 xml 文件获取 NSXMLParser</span></span><br><span class="line">        <span class="keyword">let</span> parser = <span class="type">NSXMLParser</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"testData"</span>, ofType: <span class="string">"xml"</span>)!))</span><br><span class="line">        <span class="comment">// 设置代理</span></span><br><span class="line">        parser?.delegate = <span class="keyword">self</span></span><br><span class="line">        <span class="comment">// 解析数据</span></span><br><span class="line">        parser?.parse()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每解析到一个节点的开标签时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String])</span></span> &#123;</span><br><span class="line">        currentNodeName = elementName</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印 person 节点的 age 属性</span></span><br><span class="line">        <span class="keyword">if</span> elementName == <span class="string">"person"</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> age:<span class="type">AnyObject</span> = attributeDict[<span class="string">"age"</span>] &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"age:\(age)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每发现一个叶子节点包裹的字符串时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, foundCharacters string: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> str = string.stringByTrimmingCharactersInSet(<span class="type">NSCharacterSet</span>.whitespaceAndNewlineCharacterSet())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 过滤掉空白符号(包括换行符)</span></span><br><span class="line">        <span class="keyword">if</span> str != <span class="string">""</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"current node: \(currentNodeName), value:\(str)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-3-选择题实例"><a href="#1-4-3-选择题实例" class="headerlink" title="1.4.3    选择题实例"></a>1.4.3    选择题实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个实例演示如何在程序中使用<code>XML</code>格式的数据</p>
<ol>
<li>（工程）引入 xml 文件</li>
<li>（storyboard）编辑界面</li>
<li>（ViewController.swift）绑定控件和注册事件</li>
</ol>
</blockquote>
<h2 id="1-5-iOS用户首选项数据"><a href="#1-5-iOS用户首选项数据" class="headerlink" title="1.5    iOS用户首选项数据"></a>1.5    iOS用户首选项数据</h2><h3 id="1-5-1-用户首选项数据说明"><a href="#1-5-1-用户首选项数据说明" class="headerlink" title="1.5.1    用户首选项数据说明"></a>1.5.1    用户首选项数据说明</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解iOS首选项数据的概念及用途<br><strong>说明：</strong>用户首选项数据适合以下场景</p>
<ol>
<li>数据量小</li>
<li>键值对形式存储</li>
<li>保存到首选项的数据在app关闭后不会被清空</li>
</ol>
</blockquote>
<h3 id="1-5-2-存储用户首选项数据"><a href="#1-5-2-存储用户首选项数据" class="headerlink" title="1.5.2    存储用户首选项数据"></a>1.5.2    存储用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何存储用户首选项数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_shouxuanxiang.gif" alt="Alt text|200x350"></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!<span class="comment">// 输入框</span></span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSavePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 保存到首选项</span></span><br><span class="line">        ud.setObject(textView.text, forKey: <span class="string">"data"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"saved"</span>)</span><br><span class="line">        <span class="comment">// 创建提示框</span></span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"成功"</span>,</span><br><span class="line">            message: <span class="string">"成功保存到首选项"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">ActionSheet</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: <span class="type">UIAlertActionStyle</span>.<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 弹出提示框</span></span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取首选项数据初始化界面</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> value:<span class="type">AnyObject</span> = ud.objectForKey(<span class="string">"data"</span>) &#123;</span><br><span class="line">            textView.text = value <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            textView.text = <span class="string">"No value"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-读取用户首选项数据"><a href="#1-5-3-读取用户首选项数据" class="headerlink" title="1.5.3    读取用户首选项数据"></a>1.5.3    读取用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取用户首选项数据</p>
</blockquote>
<h3 id="1-5-4-启动时小贴士实例"><a href="#1-5-4-启动时小贴士实例" class="headerlink" title="1.5.4    启动时小贴士实例"></a>1.5.4    启动时小贴士实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个小实例演示用户首选项数据的使用场景<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_tip.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> mySwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchChangedHandler</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        ud.setBool(mySwitch.on, forKey: <span class="string">"showTips"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        mySwitch.on = ud.boolForKey(<span class="string">"showTips"</span>)</span><br><span class="line">        <span class="keyword">if</span> mySwitch.on &#123;</span><br><span class="line">            <span class="type">NSTimer</span>.scheduledTimerWithTimeInterval(<span class="number">2</span>,</span><br><span class="line">                target: <span class="keyword">self</span>,</span><br><span class="line">                selector: <span class="string">"showTip"</span>,</span><br><span class="line">                userInfo: <span class="literal">nil</span>,</span><br><span class="line">                repeats: <span class="literal">false</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 弹出提示窗</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showTip</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>,</span><br><span class="line">            message: <span class="string">"今天要下雨，出门要带雨具哦！"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">Alert</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: .<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-6-iOS文件存取"><a href="#1-6-iOS文件存取" class="headerlink" title="1.6    iOS文件存取"></a>1.6    iOS文件存取</h2><blockquote>
<p><strong>官方文档：</strong><a href="https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1" target="_blank" rel="external">https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1</a></p>
</blockquote>
<h3 id="1-6-1-iOS应用沙盒"><a href="#1-6-1-iOS应用沙盒" class="headerlink" title="1.6.1    iOS应用沙盒"></a>1.6.1    iOS应用沙盒</h3><blockquote>
<p><strong>笔记参考：</strong><a href="http://blog.csdn.net/wzzvictory/article/details/18269713" target="_blank" rel="external">http://blog.csdn.net/wzzvictory/article/details/18269713</a><br><strong>沙盒机制：</strong>出于安全考虑，iOS系统的沙盒机制规定每个应用都只能访问当前沙盒目录下面的文件（也有例外，比如系统通讯录能在用户授权的情况下被第三方应用访问）。</p>
</blockquote>
<h4 id="1-6-1-1-app目录"><a href="#1-6-1-1-app目录" class="headerlink" title="1.6.1.1    app目录"></a>1.6.1.1    app目录</h4><blockquote>
<p><strong>说明：</strong>每个应用的沙盒目录都是相似的，主要包如下所示的4个目录</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── MyApp.app<span class="comment"># 应用程序本身</span></span><br><span class="line">├── Documents<span class="comment"># 应用程序的数据文件</span></span><br><span class="line">│   └── Inbox<span class="comment">#由外部应用请求当前应用程序打开的文件</span></span><br><span class="line">├── Library<span class="comment"># 默认设置或其它状态信息</span></span><br><span class="line">│   ├── Caches<span class="comment">#缓存文件</span></span><br><span class="line">│   └── Preferences<span class="comment">#应用程序的偏好设置文件</span></span><br><span class="line">└── tmp<span class="comment"># 临时文件</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>目录</th>
<th>内容</th>
<th>读写</th>
<th>是否会被iTunes同步</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MyApp.app</code></td>
<td>应用程序本身的数据，包括<code>资源文件</code>和<code>可执行文件</code>等</td>
<td>只读</td>
<td>否</td>
</tr>
<tr>
<td><code>Documents</code></td>
<td>读写</td>
<td>是</td>
<td>应用程序的数据文件保存在该目录下</td>
<td>数据类型仅限于<code>不可再生</code>的数据，<code>可再生</code>的数据文件应该存放在<code>Library/Cache</code>目录下。</td>
</tr>
<tr>
<td><code>Documents/Inbox</code></td>
<td>用来保存由外部应用请求当前应用程序打开的文件</td>
<td>读写</td>
<td>是</td>
<td>比如我们的应用叫<code>A</code>，向系统注册了几种可打开的文件格式，<code>B</code>应用有一个<code>A</code>支持的格式的文件<code>F</code>，并且申请调用<code>A</code>打开<code>F</code>。由于<code>F</code>当前是在<code>B</code>应用的沙盒中，我们知道，沙盒机制是不允许<code>A</code>访问<code>B</code>沙盒中的文件，因此苹果的解决方案是将<code>F</code>拷贝一份到<code>A</code>应用的<code>Documents/Inbox</code>目录下，再让<code>A</code>打开<code>F</code>。</td>
</tr>
<tr>
<td><code>Library</code></td>
<td>苹果建议用来存放默认设置或其它状态信息</td>
<td>读写</td>
<td>是，但是要除了<code>Caches</code>子目录外</td>
<td></td>
</tr>
<tr>
<td><code>Library/Caches</code></td>
<td>主要是缓存文件，用户使用过程中缓存都可以保存在这个目录中</td>
<td>读写</td>
<td>否</td>
<td>Documents目录用于保存不可再生的文件，那么这个目录就用于保存那些可再生的文件，比如网络请求的数据。鉴于此，应用程序通常还需要负责删除这些文件。</td>
</tr>
<tr>
<td><code>Library/Preferences</code></td>
<td>应用程序的偏好设置文件</td>
<td>读写</td>
<td>是</td>
<td>我们使用<code>NSUserDefaults</code>写的设置数据都会保存到该目录下的一个<code>plist</code>文件中，这就是所谓的写到<code>plist</code>中!</td>
</tr>
<tr>
<td><code>tmp</code></td>
<td>各种临时文件，保存应用再次启动时不需要的文件</td>
<td>读写</td>
<td>否</td>
<td>当应用不再需要这些文件时应该主动将其删除，因为该目录下的东西随时有可能被系统清理掉，目前已知的一种可能清理的原因是系统磁盘存储空间不足的时候。</td>
</tr>
</tbody>
</table>
<h4 id="1-6-1-2-获取目录-API"><a href="#1-6-1-2-获取目录-API" class="headerlink" title="1.6.1.2    获取目录 API"></a>1.6.1.2    获取目录 API</h4><h5 id="NSSearchPathForDirectoriesInDomains方法"><a href="#NSSearchPathForDirectoriesInDomains方法" class="headerlink" title="NSSearchPathForDirectoriesInDomains方法"></a>NSSearchPathForDirectoriesInDomains方法</h5><blockquote>
<p><strong>说明：</strong>用于返回指定范围内的指定名称的目录的路径集合<br><strong>注意：</strong>使用<code>沙盒/Documents</code>目录要用该方法获取路径</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* </span><br><span class="line">* @param &#123;enum&#125; directory 表明我们要搜索的目录名称</span><br><span class="line">* @param &#123;enum&#125; domainMask 指定搜索范围。</span><br><span class="line">* @param &#123;Bool&#125; expandTilde 表示是否展开波浪线~</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">NSSearchPathForDirectoriesInDomains</span><span class="params">(directory: NSSearchPathDirectory, <span class="number">_</span> domainMask: NSSearchPathDomainMask, <span class="number">_</span> expandTilde: Bool)</span></span> -&gt; [<span class="type">String</span>]</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-写入文件"><a href="#1-6-2-写入文件" class="headerlink" title="1.6.2    写入文件"></a>1.6.2    写入文件</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*- 获取目录路径 -*/</span></span><br><span class="line"><span class="keyword">let</span> homePath = <span class="type">NSHomeDirectory</span>()<span class="comment">// 沙盒(home)</span></span><br><span class="line"><span class="keyword">let</span> appPath = <span class="type">NSBundle</span>.mainBundle().bundlePath<span class="comment">// MyApp.app</span></span><br><span class="line"><span class="keyword">let</span> tmpPath = <span class="type">NSTemporaryDirectory</span>()<span class="comment">// tmp</span></span><br><span class="line"><span class="keyword">let</span> documentPaths = <span class="type">NSSearchPathForDirectoriesInDomains</span>(.<span class="type">DocumentationDirectory</span>, .<span class="type">AllDomainsMask</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">var</span> documentPath:<span class="type">String</span> = <span class="string">""</span>;<span class="comment">// Documents</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> documentPaths.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">    documentPath = documentPaths[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"home:\(homePath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"app:\(appPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tmp:\(tmpPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Documents\(documentPath)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 在 Documents 下创建文件 -*/</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">NSURL</span>(fileURLWithPath: <span class="string">"\(documentPath)/test.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 向文件中写入文本 -*/</span></span><br><span class="line"><span class="keyword">let</span> textData = <span class="type">NSMutableData</span>()</span><br><span class="line">textData.appendData(<span class="string">"Hello Swift\n"</span>.dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>, allowLossyConversion: <span class="literal">true</span>)!)</span><br><span class="line">textData.writeToFile(url.path!, atomically: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-读取文件"><a href="#1-6-3-读取文件" class="headerlink" title="1.6.3    读取文件"></a>1.6.3    读取文件</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" itemprop="url">
                  4 中级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:01:39+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#4    中级iOS开发工程师面试题</p>
<h2 id="4-1-MVC的理解"><a href="#4-1-MVC的理解" class="headerlink" title="4.1 MVC的理解"></a>4.1 MVC的理解</h2><blockquote>
<p><code>MVC</code>设计模式考虑三种对象：数据模型对象、视图对象、控制器对象。</p>
<ul>
<li>数据模型（<code>M</code>）：负责存储、定义、操作数据</li>
<li>视图（<code>V</code>）：用来战术数据给用户，和用户进行操作交互</li>
<li>控制器（<code>C</code>）：<code>M</code>与<code>V</code>的协调者，控制获取数据，将数据交给视图取展示</li>
</ul>
</blockquote>
<h2 id="4-2-线程和进程"><a href="#4-2-线程和进程" class="headerlink" title="4.2    线程和进程"></a>4.2    线程和进程</h2><blockquote>
<p><strong>进程：</strong>进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统畸形资源分配和调度的一个独立单元。<br><strong>线程：</strong>线程是进程的的一个实体，是cpu调度和分派的基本单位，是比进程更小的能独立运行的基本单位，线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器、一组寄存器和栈），一个线程可以创建和撤销另一个线程。</p>
</blockquote>
<h3 id="4-2-1-线程和进程的关系"><a href="#4-2-1-线程和进程的关系" class="headerlink" title="4.2.1    线程和进程的关系"></a>4.2.1    线程和进程的关系</h3><blockquote>
<ol>
<li>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程。</li>
<li>资源跟配给进程，同一进程的所有线程共享该进程的所有资源。</li>
<li>线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。</li>
<li>真正在处理机上运行的是线程。</li>
<li>线程是指进程內的一个可执行单元，也是进程內的可调度实体。</li>
</ol>
</blockquote>
<h3 id="4-2-2-线程和进程的区别"><a href="#4-2-2-线程和进程的区别" class="headerlink" title="4.2.2    线程和进程的区别"></a>4.2.2    线程和进程的区别</h3><table>
<thead>
<tr>
<th>区别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>调度</td>
<td>线程作为调度和分配的基本单元，进程作为拥有过资源的基本单位</td>
</tr>
<tr>
<td>并发性</td>
<td>不仅进程之间可以并发执行，同一个进程的多个线程之间也可以并发执行</td>
</tr>
<tr>
<td>拥有资源</td>
<td>进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源</td>
</tr>
<tr>
<td>系统开销</td>
<td>创建或者撤销进程的开销比较大</td>
</tr>
</tbody>
</table>
<h3 id="4-2-3-进程的同步机制"><a href="#4-2-3-进程的同步机制" class="headerlink" title="4.2.3    进程的同步机制"></a>4.2.3    进程的同步机制</h3><blockquote>
<p>原子操作：、信号量机制、自旋锁、分布式系统等</p>
</blockquote>
<h3 id="4-2-4-进程死锁"><a href="#4-2-4-进程死锁" class="headerlink" title="4.2.4    进程死锁"></a>4.2.4    进程死锁</h3><blockquote>
<p><strong>原因：</strong>资源竞争以及进程推进顺序非法<br><strong>必要条件：</strong>4个</p>
<ol>
<li>互斥</li>
<li>请求保持</li>
<li>不可剥夺</li>
<li>环路</li>
</ol>
<p><strong>处理：</strong></p>
<ul>
<li>鸵鸟策略</li>
<li>预防策略</li>
<li>监测与接触死锁</li>
</ul>
</blockquote>
<h2 id="4-3-KVC和KVO"><a href="#4-3-KVC和KVO" class="headerlink" title="4.3    KVC和KVO"></a>4.3    KVC和KVO</h2><blockquote>
<ol>
<li><code>KVC</code>（键值编码）：是一种间接访问对象实例变量的机制，该机制可以不通过存取方法就可以访问对象的实例变量。</li>
<li><code>KVO</code> （键值观察）：是一种能使得对象获取到其他对象属性变化的通知机制。</li>
<li>实现<code>KVO简直观察模式</code>，被观察的对象必须使用<code>kvc</code>键值编码来修改它的实例变量，这样才能被观察者观察到。因此，<code>KVC</code>是<code>KVO</code>的基础或者说<code>KVO</code>的实现是建立在<code>KVC</code>的基础之上。</li>
</ol>
</blockquote>
<h2 id="4-4-深复制、浅复制"><a href="#4-4-深复制、浅复制" class="headerlink" title="4.4    深复制、浅复制"></a>4.4    深复制、浅复制</h2><blockquote>
<p><strong>深复制：</strong>不仅复制对象本身，对象持有的属性对象也做复制。<br><strong>浅复制：</strong>只复制对象本身，不对里面的属性复制。</p>
</blockquote>
<h2 id="4-5-定义属性时，什么时候用assign、retain、copy、nonatomic"><a href="#4-5-定义属性时，什么时候用assign、retain、copy、nonatomic" class="headerlink" title="4.5    定义属性时，什么时候用assign、retain、copy、nonatomic?"></a>4.5    定义属性时，什么时候用<code>assign</code>、<code>retain</code>、<code>copy</code>、<code>nonatomic</code>?</h2><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>assign</code></td>
<td>普通赋值</td>
<td>一般用于基本数据类型，常见委托设计模式，以此来防止循环引用</td>
</tr>
<tr>
<td><code>retain</code></td>
<td>保留计数</td>
<td>获得了对象的所有权，引用计数+1</td>
</tr>
<tr>
<td><code>copy</code></td>
<td><code>set</code>是使用副本</td>
<td>一般字符串使用<code>copy</code>，<code>Foundation</code>中的不可变对象使用<code>copy</code>效果相当于<code>retain</code>，只是引用计数+1</td>
</tr>
<tr>
<td><code>nonatomic</code></td>
<td>非原子性访问，不加同步</td>
<td>多线程并发访问会提高性能</td>
</tr>
</tbody>
</table>
<h2 id="4-6-内存管理"><a href="#4-6-内存管理" class="headerlink" title="4.6    内存管理"></a>4.6    内存管理</h2><h3 id="4-6-1-strong与weak，-unsafe-unretained与weak的区别"><a href="#4-6-1-strong与weak，-unsafe-unretained与weak的区别" class="headerlink" title="4.6.1    strong与weak，_unsafe_unretained与weak的区别"></a>4.6.1    strong与weak，_unsafe_unretained与weak的区别</h3><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strong</code></td>
<td>强引用</td>
<td>在<code>ARC</code>中，使用<code>strong</code>告诉编译器自动插入<code>retain</code></td>
</tr>
<tr>
<td><code>weak</code></td>
<td>弱引用</td>
<td>在<code>ARC</code>中，<code>weak</code>相当于手动管理内存的<code>assign</code></td>
</tr>
<tr>
<td><code>_unsafe_unretained</code></td>
<td>安全版<code>weak</code></td>
<td>与<code>weak</code>功能一致,区别在于当指向的对象销毁后，<code>weak</code>会将变量置为<code>nil</code>，防止调用野指针</td>
</tr>
</tbody>
</table>
<h3 id="4-6-2-ARC存在内存泄漏吗？"><a href="#4-6-2-ARC存在内存泄漏吗？" class="headerlink" title="4.6.2    ARC存在内存泄漏吗？"></a>4.6.2    <code>ARC</code>存在内存泄漏吗？</h3><blockquote>
<p>循环引用导致内存泄漏，<code>Objective-C</code>对象与<code>CoreFoundation</code>类之间桥接时，管理不当也会产生内存泄漏。</p>
</blockquote>
<h2 id="4-7-事件响应者链"><a href="#4-7-事件响应者链" class="headerlink" title="4.7    事件响应者链"></a>4.7    事件响应者链</h2><blockquote>
<p>响应者链表示一系列的响应者对象。事件被交由第一响应者对象，如果第一响应者不处理，事件被沿着响应者链向上传递，交给下一个响应者。</p>
</blockquote>
<p>View -&gt; ViewController -&gt; Window -&gt; application -&gt; 丢弃事件</p>
<h2 id="4-8-其它"><a href="#4-8-其它" class="headerlink" title="4.8    其它"></a>4.8    其它</h2><ul>
<li><code>SVN</code>、<code>git</code>使用</li>
<li>打包静态库</li>
<li><code>APP</code>发布的上架流程</li>
<li><code>Storyboard</code>的使用</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="url">
                  3 动画图层部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:59:02+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-设计复杂的iOS动画效果"><a href="#3-1-设计复杂的iOS动画效果" class="headerlink" title="3.1    设计复杂的iOS动画效果"></a>3.1    设计复杂的iOS动画效果</h2><h3 id="3-1-1-制定统一的动画接口"><a href="#3-1-1-制定统一的动画接口" class="headerlink" title="3.1.1    制定统一的动画接口"></a>3.1.1    制定统一的动画接口</h3><blockquote>
<p><strong>说明：</strong>制定统一的动画接口有如下优点</p>
<ul>
<li>便于实现后续复杂的动画组合</li>
<li>对于后续的代码维护极为方便</li>
<li>需要优先考虑里氏代换原则</li>
</ul>
</blockquote>
<h3 id="3-1-2-动画中的高内聚低耦合原理"><a href="#3-1-2-动画中的高内聚低耦合原理" class="headerlink" title="3.1.2    动画中的高内聚低耦合原理"></a>3.1.2    动画中的高内聚低耦合原理</h3><blockquote>
<p><strong>说明：</strong>将视图的动画效果的实现和视图本身封装到另一个<code>UIView</code>中。<br><strong>技巧：</strong></p>
<ul>
<li>不要把实现动画的细节暴露在外</li>
<li>设计动画类尽力那个要符合<code>单一职能原则</code>，以便后续方便组合成复杂的动画效果</li>
</ul>
<p><strong>单一职能原则：</strong>如果一个类承担的只能过多，就等于把这些功能耦合在一起，一个职能的变化可能会削弱或者抑制其他职能的能力，这种耦合会导致脆弱的设计，当发生变化时，设计会遭到意想不到的破坏。如果想要避免这种现象发生，就要尽可能的遵守<code>单一职能原则</code>。</p>
</blockquote>
<p><em>LineView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">@(中级ios开发工程师)interface LineView : <span class="built_in">UIView</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span>  offsetX;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> rect;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.rect = frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>viewcntroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *line<span class="built_in">UIView</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [<span class="keyword">self</span> testLineAnimate];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用封装在LineUIView中的动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testLineAnimate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建封装着动画效果的视图实例</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置初始状态</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView.offsetX = <span class="number">50.</span>f;</span><br><span class="line">    <span class="keyword">self</span>.lineUIView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineUIView];</span><br><span class="line">    <span class="comment">// 展现带有动画的视图（展现带有动画）</span></span><br><span class="line">    [<span class="keyword">self</span>.lineUIView show];</span><br><span class="line">    <span class="comment">// 3秒中后隐藏视图（带消失有动画）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(excuteAfterDelay) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)excuteAfterDelay</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineUIView hide];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-设计动画函数的注意事项"><a href="#3-1-3-设计动画函数的注意事项" class="headerlink" title="3.1.3    设计动画函数的注意事项"></a>3.1.3    设计动画函数的注意事项</h3><ul>
<li>动画方法的命名统一：封装在不同的<code>view</code>的同类动画方法命名要一致</li>
<li>预留非动画情形的设计：避免<code>TableView</code>或者其它存在重用问题的场景下的性能问题</li>
<li>用百分比来表示动画的执行程度</li>
<li>懒加载的使用</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif" alt="Alt text"></p>
<p><em>LineUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> offSetX;<span class="comment">// 对应动画进度的偏移量</span></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建view（懒加载方式）</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画百分比（动画进行程度）</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> startRect;<span class="comment">// 开始区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> midRect;<span class="comment">// 动画进行到中间时的区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> endRect;<span class="comment">// 结束区域</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineUIView</span></span></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;<span class="comment">// 视图创建时是不可见的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  隐藏视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.endRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished)&#123;</span><br><span class="line">            <span class="comment">// 视图隐藏后将视图复原到初始位置</span></span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建view（懒加载方式）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.startRect = <span class="keyword">self</span>.frame;</span><br><span class="line">    <span class="keyword">self</span>.midRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">    <span class="keyword">self</span>.endRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX * <span class="number">2</span>,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  动画百分比（动画进行程度）</span><br><span class="line"> *</span><br><span class="line"> *  @param percent 动画进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (percent &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        tmpOffsetX = percent * <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + tmpOffsetX,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.lineView.offSetX = <span class="keyword">self</span>.view.frame.size.width / <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.lineView buildView];<span class="comment">// 初始化视图成员</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将动画视图添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineView];</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    [<span class="keyword">self</span> delayShow];</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    [<span class="keyword">self</span> delayHide];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayShow</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView showWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayHide</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView hideWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-用里氏代换原则来处理动画类的继承问题"><a href="#3-1-4-用里氏代换原则来处理动画类的继承问题" class="headerlink" title="3.1.4    用里氏代换原则来处理动画类的继承问题"></a>3.1.4    用里氏代换原则来处理动画类的继承问题</h3><blockquote>
<p><strong>说明：</strong>其实就是利用对象的<code>多态性</code>，父类变量动态调用子类对象的方法。<br><strong>要点：</strong></p>
<ul>
<li>里氏代换原则的基本原理</li>
<li>设计中要确保父类可以直接调用子类的方法</li>
<li>将父类设计成虚类（需要时，父类也可以提供实现）</li>
</ul>
</blockquote>
<h4 id="3-1-4-1-父类"><a href="#3-1-4-1-父类" class="headerlink" title="3.1.4.1    父类"></a>3.1.4.1    父类</h4><p><em>SuperUIView.h</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SuperUIView : UIView</span><br><span class="line"></span><br><span class="line">- (void)show;</span><br><span class="line">- (void)hide;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><em>SuperUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SuperUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperUIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-2-子类"><a href="#3-1-4-2-子类" class="headerlink" title="3.1.4.2    子类"></a>3.1.4.2    子类</h4><blockquote>
<p><strong>说明：</strong>在子类中重写集成来的<code>show</code>的<code>hide</code>方法。</p>
</blockquote>
<p><em>SubUIView1.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView1</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>SubUIView2.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView2</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-3-演示"><a href="#3-1-4-3-演示" class="headerlink" title="3.1.4.3    演示"></a>3.1.4.3    演示</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 演示类的多态性</span></span><br><span class="line">Super<span class="built_in">UIView</span> *tmpView = [[Sub<span class="built_in">UIView1</span> alloc]init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br><span class="line"></span><br><span class="line">tmpView = [[Sub<span class="built_in">UIView2</span> alloc] init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br></pre></td></tr></table></figure>
<h3 id="3-1-5-动画中的模块化设计"><a href="#3-1-5-动画中的模块化设计" class="headerlink" title="3.1.5    动画中的模块化设计"></a>3.1.5    动画中的模块化设计</h3><blockquote>
<p><strong>说明：</strong>模块化设计在开发中非常重要，拆分成小颗粒的模块非常便于代码的维护<br><strong>要点：</strong></p>
<ul>
<li>动画效果实现难度的判断</li>
<li>将看到的动画效果查分成小模块</li>
<li>将写好的小模块组合成你所需要的动画效果</li>
</ul>
</blockquote>
<h4 id="3-1-5-1-子模块"><a href="#3-1-5-1-子模块" class="headerlink" title="3.1.5.1    子模块"></a>3.1.5.1    子模块</h4><p><em>LineUIView.h、CircleUIView.h、RectUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m、CircleUIView.m、RectUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="3-1-5-2-组合使用"><a href="#3-1-5-2-组合使用" class="headerlink" title="3.1.5.2    组合使用"></a>3.1.5.2    组合使用</h4><p><em>BaseAnimationView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BaseAnimationView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BaseAnimationView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RectUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Circle<span class="built_in">UIView</span> *circleView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BaseAnimationView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView show];</span><br><span class="line">    [<span class="keyword">self</span>.lineView show];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView hide];</span><br><span class="line">    [<span class="keyword">self</span>.lineView hide];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;</span><br><span class="line">    <span class="keyword">self</span>.circleView = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.circleView];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.lineView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS模糊效果的使用"><a href="#3-2-iOS模糊效果的使用" class="headerlink" title="3.2    iOS模糊效果的使用"></a>3.2    iOS模糊效果的使用</h2><blockquote>
<p><strong>背景：</strong>在项目开发中，使用模糊效果或许是很多开发者并不愿意接触的东西，因为大部分都是从开源代码里获取到的代码片段，并不一定理解别人的设计思路，此时要最大程度的修改来符合自己的项目需求并不容易。本课程我将会带领大家来定制出自己需要的模糊效果，理解设计的原理，并根据不同的需求设计出符合我们期望的效果。<br><strong>要点：</strong></p>
<ol>
<li>CoreImage 中的模糊滤镜</li>
<li>UIImage+ImageEffects 的 category 模糊效果</li>
<li>iOS8 中 UIVisualEffectView 模糊效果的使用</li>
<li>设计下载图片后自动模糊的控件</li>
</ol>
</blockquote>
<h3 id="3-2-1-CoreImage中的模糊滤镜"><a href="#3-2-1-CoreImage中的模糊滤镜" class="headerlink" title="3.2.1    CoreImage中的模糊滤镜"></a>3.2.1    CoreImage中的模糊滤镜</h3><blockquote>
<p><strong>要点：</strong></p>
<ul>
<li><code>CoreImage</code>是苹果用来简化图片处理的框架</li>
<li><code>CIImage</code>、<code>CIFilter</code>与<code>CIContext</code>三者之间的联系</li>
<li><code>CIGaussianBlur</code>中可以设置的参数<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%881.08.34.png" alt="Alt text|200x400"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 1. 原始图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"sourceImage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. coreImage部分</span></span><br><span class="line"><span class="comment">/*------- coreImage 部分 ------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CIImage - 将 UIImage 包装为 CIImage 才可以用于滤镜</span></span><br><span class="line"><span class="built_in">CIImage</span> *ciImage = [[<span class="built_in">CIImage</span> alloc]initWithImage:image];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIFilter － 滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *blurFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看滤镜可以设置的参数以及一些相关的信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [blurFilter attributes]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片输入到滤镜中</span></span><br><span class="line">[blurFilter setValue:ciImage forKey:k<span class="built_in">CIInputImageKey</span>];<span class="comment">//  KVC方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模糊程度(0-100)</span></span><br><span class="line">[blurFilter setValue:@(<span class="number">3</span>) forKey:<span class="string">@"inputRadius"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将处理好的图片输出为 CIImage</span></span><br><span class="line"><span class="built_in">CIImage</span> *outCiImage = [blurFilter valueForKey:k<span class="built_in">CIOutputImageKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIContext</span></span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRef</span> <span class="keyword">out</span><span class="built_in">CGImage</span> = [context create<span class="built_in">CGImage</span>:outCiImage fromRect:[outCiImage extent]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终获取的图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *blurImage = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:<span class="keyword">out</span><span class="built_in">CGImage</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(<span class="keyword">out</span><span class="built_in">CGImage</span>);</span><br><span class="line"><span class="comment">/*-----------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 初始化UIImageView</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">590</span> / <span class="number">2.</span>f, <span class="number">988</span> / <span class="number">2.</span>f)];</span><br><span class="line">imageView.image = blurImage;</span><br><span class="line">imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-UIImage-ImageEffects的category模糊效果"><a href="#3-2-2-UIImage-ImageEffects的category模糊效果" class="headerlink" title="3.2.2    UIImage + ImageEffects的category模糊效果"></a>3.2.2    UIImage + ImageEffects的category模糊效果</h3><blockquote>
<p><strong>说明：</strong>苹果官方提供了一段无论是性能还是效果都更优的实现图片模糊效果的代码。在此基础上封装的库在以下地址可以拿到<br><a href="https://github.com/YouXianMing/UIImageBlur" target="_blank" rel="external">https://github.com/YouXianMing/UIImageBlur</a></p>
<ul>
<li>性能更好</li>
<li>可以局部模糊</li>
<li>更加易用<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%8810.02.55.png" alt="Alt text|200x350"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 原始图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *sourceImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对图片进行模糊</span></span><br><span class="line">    <span class="built_in">UIImage</span> *blurImage = [sourceImage blurImageAtFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, sourceImage.size.width, sourceImage.size.height / <span class="number">2.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:blurImage];</span><br><span class="line">    imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="keyword">self</span>.view.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-iOS8种UIVisualEffectView模糊效果的使用"><a href="#3-2-3-iOS8种UIVisualEffectView模糊效果的使用" class="headerlink" title="3.2.3    iOS8种UIVisualEffectView模糊效果的使用"></a>3.2.3    iOS8种UIVisualEffectView模糊效果的使用</h3><blockquote>
<p><strong>说明：</strong><code>UIVisyalEffectView</code>的模糊效果是即时渲染的，效率非常高<br><strong>注意：</strong>在<code>UIVisualEffectView</code>之上的文本显示需要特殊处理<br><strong>兼容性：</strong><code>iOS8+</code><br><strong>案例：</strong><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_effective.gif" alt="Alt text|100x100"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*--- 1. 环境 ----*/</span></span><br><span class="line"><span class="comment">// 1.1 图片</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 展示视图（UIScrollView）：用以显示动态模糊</span></span><br><span class="line"><span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line"><span class="keyword">self</span>.scrollView.contentSize = imageView.image.size;<span class="comment">// 展现视图和图片大小一致</span></span><br><span class="line"><span class="keyword">self</span>.scrollView.bounces = <span class="literal">NO</span>;<span class="comment">// 无边缘反弹效果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 将图片添加到展示视图</span></span><br><span class="line">[<span class="keyword">self</span>.scrollView addSubview:imageView];</span><br><span class="line"><span class="comment">// 1.4 将展示视图添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--- 2. 添加模糊视图 ---*/</span></span><br><span class="line"><span class="comment">// 2.1 创建模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *effecView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>]];</span><br><span class="line"><span class="comment">// 2.2 设置尺寸（动态模糊区域）</span></span><br><span class="line">effecView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>);</span><br><span class="line"><span class="comment">// 2.3 添加到 view</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:effecView];</span><br><span class="line"><span class="comment">/*------ 3. 子模糊视图（文本） ------*/</span></span><br><span class="line"><span class="comment">// 3.1  添加显示文本</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:effecView.bounds];</span><br><span class="line">label.text = <span class="string">@"时代精神"</span>;</span><br><span class="line">label.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">50.</span>f];</span><br><span class="line">label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line"><span class="comment">// 3.2  创建子模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *subEffectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIVibrancyEffect</span> effectForBlurEffect:(<span class="built_in">UIBlurEffect</span> *)effecView.effect]];</span><br><span class="line"><span class="comment">// 3.3  尺寸</span></span><br><span class="line">subEffectView.frame = effecView.bounds;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.4  将子模糊view添加到effectView的contentView才能够生效</span></span><br><span class="line">[effecView.contentView addSubview:subEffectView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.5  添加文本（此时文本会个模糊视图融合得比较好）</span></span><br><span class="line">[subEffectView.contentView addSubview:label];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-设计下载图片后自动模糊的控件"><a href="#3-2-4-设计下载图片后自动模糊的控件" class="headerlink" title="3.2.4    设计下载图片后自动模糊的控件"></a>3.2.4    设计下载图片后自动模糊的控件</h3><blockquote>
<p><strong>说明：</strong>将下载下来的图片自动模糊的控件。<br><strong>要点：</strong></p>
<ul>
<li>KVO监听下载完成后的事件</li>
<li>在子线程中进行渲染，主线程中进行图片的下载 （提升性能）</li>
</ul>
<p><strong>GDC：</strong><a href="https://github.com/YouXianMing/GCD-Program" target="_blank" rel="external">https://github.com/YouXianMing/GCD-Program</a></p>
</blockquote>
<h4 id="3-2-4-1-控件实现"><a href="#3-2-4-1-控件实现" class="headerlink" title="3.2.4.1    控件实现"></a>3.2.4.1    控件实现</h4><blockquote>
<p><strong>依赖:</strong><code>GDC</code>和<code>UIImage+ImageEffects</code></p>
</blockquote>
<p><em>BlurDownloadPicView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *pictureUrlString;<span class="comment">// 图片下载地址</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIViewContentMode</span> contentMode;<span class="comment">// 图片显示的方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始执行</span></span><br><span class="line">- (<span class="keyword">void</span>)startProgress;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BlurDownloadPicView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GCD.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BlurDownloadPicView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化控件</span></span><br><span class="line">        <span class="keyword">self</span>.imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="keyword">self</span>.imageView.alpha = <span class="number">0.</span>f;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startProgress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.pictureUrlString) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在子线程中执行下载图片的过程</span></span><br><span class="line">        [GCDQueue executeInGlobalQueue:^&#123;</span><br><span class="line">            <span class="comment">// 创建请求</span></span><br><span class="line">            <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.pictureUrlString]];</span><br><span class="line">            <span class="comment">// 获取数据(因为是同步请求，会阻塞主线程)</span></span><br><span class="line">            <span class="built_in">NSData</span> *data = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request</span><br><span class="line">                                                 returningResponse:<span class="literal">nil</span></span><br><span class="line">                                                             error:<span class="literal">nil</span>];</span><br><span class="line">            <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">UIImage</span> *blurImage = [image blurImage];</span><br><span class="line">            </span><br><span class="line">            [GCDQueue executeInMainQueue:^&#123;</span><br><span class="line">                <span class="comment">// 在主线程中加载图片</span></span><br><span class="line">                <span class="keyword">self</span>.imageView.image = blurImage;</span><br><span class="line">                <span class="comment">// 动画效果：淡出</span></span><br><span class="line">                [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">                    <span class="keyword">self</span>.imageView.alpha = <span class="number">1.</span>f;</span><br><span class="line">                &#125;];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> contentMode = _contentMode;</span><br><span class="line">- (<span class="keyword">void</span>)setContentMode:(<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    _contentMode = contentMode;</span><br><span class="line">    <span class="keyword">self</span>.imageView.contentMode = contentMode;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    <span class="keyword">return</span> _contentMode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-4-2-使用"><a href="#3-2-4-2-使用" class="headerlink" title="3.2.4.2    使用"></a>3.2.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *picUrlString = <span class="string">@"http://img.zcool.cn/community/0207a4570363fc6ac7257948ec0f00.jpg@800w_1l_2o"</span>;<span class="comment">// 下载地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建模糊视图</span></span><br><span class="line">    BlurDownloadPicView *blurDownloadView = [[BlurDownloadPicView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">400</span>)];</span><br><span class="line">    blurDownloadView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    blurDownloadView.pictureUrlString = picUrlString;</span><br><span class="line">    blurDownloadView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:blurDownloadView];</span><br><span class="line">    <span class="comment">// 下载图片 模糊图片 呈现</span></span><br><span class="line">    [blurDownloadView startProgress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-使用-maskView-设计动画"><a href="#3-3-使用-maskView-设计动画" class="headerlink" title="3.3    使用 maskView 设计动画"></a>3.3    使用 maskView 设计动画</h2><h3 id="3-3-1-maskView-maskLayer-的基本原理"><a href="#3-3-1-maskView-maskLayer-的基本原理" class="headerlink" title="3.3.1    maskView(maskLayer)的基本原理"></a>3.3.1    maskView(maskLayer)的基本原理</h3><blockquote>
<p><strong>说明：</strong>本课时主要讲解 <code>maskView(maskLayer)</code>的基本原理，并用示例演示。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-06%20%E4%B8%8B%E5%8D%883.14.40.png" alt="Alt text|100x200"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> width = <span class="number">120</span>;</span><br><span class="line"><span class="comment">// 情形1. 只有底图的情形</span></span><br><span class="line"><span class="keyword">self</span>.baseImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.baseImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形2. 只有mask（png图片）</span></span><br><span class="line"><span class="keyword">self</span>.maskImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + width + <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.maskImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形3. 底图通过maskView组合mask</span></span><br><span class="line"><span class="comment">// 底图</span></span><br><span class="line"><span class="keyword">self</span>.addImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + (width + <span class="number">20</span>) * <span class="number">2</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.addImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// mask</span></span><br><span class="line"><span class="built_in">UIImageView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, width)];</span><br><span class="line">mask.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"><span class="comment">// 在底图上设置maskView</span></span><br><span class="line"><span class="keyword">self</span>.addImageView.maskView = mask;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.baseImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.maskImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addImageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-maskView配合-CAGradientLayer的使用"><a href="#3-3-2-maskView配合-CAGradientLayer的使用" class="headerlink" title="3.3.2    maskView配合 CAGradientLayer的使用"></a>3.3.2    maskView配合 CAGradientLayer的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解如何在 maskView 中加载 <code>CAGradientLayer</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_ga.gif" alt="Alt text|100x100"></p>
<p><strong>要点：</strong></p>
<ul>
<li>用<code>CAGradientLayer</code>直接产生带透明像素通道的<code>layer</code></li>
<li>用<code>maskView</code>直接加载带<code>CAGradientLayer</code>的<code>View</code></li>
<li>可以通过<code>CAGradientLayer</code>进行动画的操作实现动画效果</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 底图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>)];</span><br><span class="line">imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. mask (使用 CAGradientLayer 替代 png 图片)</span></span><br><span class="line"><span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">gradientLayer.frame = imageView.bounds;</span><br><span class="line">gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIView</span> *containerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:imageView.bounds];</span><br><span class="line">[containerView.layer addSublayer:gradientLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. set maskView</span></span><br><span class="line">imageView.maskView = containerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 maskView 做动画效果</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 新位置</span></span><br><span class="line">    <span class="built_in">CGRect</span> frame = containerView.frame;</span><br><span class="line">    frame.origin.x += <span class="number">400</span>;</span><br><span class="line">    containerView.frame = frame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-maskView-配合带-alpha-通道图片的使用"><a href="#3-3-3-maskView-配合带-alpha-通道图片的使用" class="headerlink" title="3.3.3    maskView 配合带 alpha 通道图片的使用"></a>3.3.3    maskView 配合带 alpha 通道图片的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>maskView</code> 加载 <code>png</code> 图片的原理。</p>
<ul>
<li>直接使用带<code>alpha</code>通道的<code>png</code>图片比用<code>CAGradientLayer</code>的方式更加高效</li>
<li>可以使用技巧在<code>maskView</code>上添加多张图片</li>
<li>在<code>maskView</code>中做简单的动画</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text|100x100"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 遮罩图片1</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picOne = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line">picOne.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮罩图片2</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picTwo = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">-200</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line"></span><br><span class="line">picTwo.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *backgroundView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">backgroundView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"background"</span>];</span><br><span class="line">backgroundView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待切换目标背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *baseView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:backgroundView.frame];</span><br><span class="line">baseView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为带切换图 set maskView</span></span><br><span class="line"><span class="built_in">UIView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:baseView.bounds];</span><br><span class="line"><span class="comment">// 两个png图片合成新遮罩</span></span><br><span class="line">[mask addSubview:picOne];</span><br><span class="line">[mask addSubview:picTwo];</span><br><span class="line">baseView.maskView = mask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:backgroundView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:baseView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 偏移左半边的遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> oneFrame = picOne.frame;</span><br><span class="line">    oneFrame.origin.y -= <span class="number">400</span>;</span><br><span class="line">    picOne.frame = oneFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 偏移右半边遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> twoFrame = picTwo.frame;</span><br><span class="line">    twoFrame.origin.y += <span class="number">400</span>;</span><br><span class="line">    picTwo.frame = twoFrame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-设计文本横向渐变消失的控件"><a href="#3-3-4-设计文本横向渐变消失的控件" class="headerlink" title="3.3.4    设计文本横向渐变消失的控件"></a>3.3.4    设计文本横向渐变消失的控件</h3><blockquote>
<p><strong>说明：</strong>本课时将综合前面所学内容设计一个效果不错的文本渐变消失的控件，并做简易的扩展设计。</p>
<ul>
<li>接口的设计</li>
<li>封装<code>CAGradientLayer</code>用以提供<code>mask</code>遮罩</li>
<li>动画样式的分析与设计</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_text.gif" alt="Alt text"></p>
<h4 id="3-3-4-1-文本横向渐变消失的控件"><a href="#3-3-4-1-文本横向渐变消失的控件" class="headerlink" title="3.3.4.1    文本横向渐变消失的控件"></a>3.3.4.1    文本横向渐变消失的控件</h4><p><em>FadeStrinUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示的文本</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从左到右渐变消失</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 动画持续时间</span><br><span class="line"> *  @param animated 是否显示动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeStringUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *mask;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeStringUIView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 创建文本</span></span><br><span class="line">        [<span class="keyword">self</span> createLabel:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="comment">// 创建mask</span></span><br><span class="line">        [<span class="keyword">self</span> createMask:<span class="keyword">self</span>.bounds];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.mask.frame;</span><br><span class="line">    frame.origin.x += frame.size.width;</span><br><span class="line">    <span class="keyword">if</span> (animated) &#123;</span><br><span class="line"></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createLabel:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span>.label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:frame];</span><br><span class="line">    <span class="keyword">self</span>.label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20.</span>f];</span><br><span class="line">    <span class="keyword">self</span>.label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    <span class="keyword">self</span>.label.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.label];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createMask:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="comment">// 创建出渐变的layer</span></span><br><span class="line">    <span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    gradientLayer.frame = frame;</span><br><span class="line">    gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">    gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.1</span>), @(<span class="number">0.9</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">    gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.mask = [[<span class="built_in">UIView</span> alloc] initWithFrame:frame];</span><br><span class="line">    [<span class="keyword">self</span>.mask.layer addSublayer:gradientLayer];</span><br><span class="line">    <span class="keyword">self</span>.maskView = <span class="keyword">self</span>.mask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 重写 text 的set和get， 该值被修改时同时更新到 label</span></span><br><span class="line"><span class="keyword">@synthesize</span> text = _text;</span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    _text = text;</span><br><span class="line">    <span class="keyword">self</span>.label.text = text;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">return</span> _text;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-2-使用该控件"><a href="#3-3-4-2-使用该控件" class="headerlink" title="3.3.4.2    使用该控件"></a>3.3.4.2    使用该控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 创建 FadeStringUIView 实例</span></span><br><span class="line">    FadeString<span class="built_in">UIView</span> *fadeString = [[FadeString<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">100</span>)];</span><br><span class="line">    fadeString.text = <span class="string">@"如果一个人不按照他想的方式活，那么很快就会按照他活的方式想。"</span>;</span><br><span class="line">    fadeString.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:fadeString];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行动画效果</span></span><br><span class="line">    [fadeString fadeRightWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-4-使用-Facebook-开源动画库-POP-实现"><a href="#3-4-使用-Facebook-开源动画库-POP-实现" class="headerlink" title="3.4    使用 Facebook 开源动画库 POP 实现"></a>3.4    使用 Facebook 开源动画库 POP 实现</h2><blockquote>
<p><strong>课程说明：</strong><code>POP</code> 动画库是 <code>Facebook</code> 在 2014 年开源出来的一个高效的动画引擎，它与 <code>CoreAnimation</code> 的实现机制有着巨大区别，但使用方式极为相似，其动画效果逼真而优美，虽无法完全替换 <code>CoreAnimation</code>，但掌握它，将会使你的应用的交互效果惊艳而脱颖而出。<br><strong>Github地址：</strong><a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a></p>
</blockquote>
<h3 id="3-4-1-POP动画引擎简介"><a href="#3-4-1-POP动画引擎简介" class="headerlink" title="3.4.1    POP动画引擎简介"></a>3.4.1    <code>POP</code>动画引擎简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时示例演示 <code>POP</code> 动画的强大之处，讲解 <code>CADisplayLink</code> 的作用，以及 <code>POP</code> 动画引擎与 <code>CoreAnimation</code> 之间的联系。</p>
<ol>
<li>pop动画引擎是Facebook公司开源的</li>
<li>pop动画引擎主要实现了真实物理系的动画效果（弹簧效果与衰减效果）</li>
<li>pop动画引擎的动画效果非常流畅，因为它是用了<code>CADisplayLink</code>来刷新画面（帧）</li>
<li>pop动画引擎自成体系，与系统的<code>CoreAnimation</code>有很大的区别，但使用非常类似</li>
</ol>
</blockquote>
<h4 id="3-4-1-1-POP效果展示"><a href="#3-4-1-1-POP效果展示" class="headerlink" title="3.4.1.1    POP效果展示"></a>3.4.1.1    POP效果展示</h4><h4 id="3-4-1-2-CADisplayLink"><a href="#3-4-1-2-CADisplayLink" class="headerlink" title="3.4.1.2    CADisplayLink"></a>3.4.1.2    CADisplayLink</h4><blockquote>
<p><strong>说明：</strong><code>POP</code>通过<code>CADisplayLink</code>刷新动画的（60帧/秒，同iOS系统本身的刷新频率）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>演示<code>CADisplayLink</code>使用方式，在中端1秒输出60次。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CADisplayLink</span> *displayLink;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> count;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 displayLink</span></span><br><span class="line">    <span class="keyword">self</span>.displayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(displayLinkEvent:)];</span><br><span class="line">    <span class="comment">// 1秒钟后开始刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventOne) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 2秒中后停止刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventTwo) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  每次刷新调用该方法</span><br><span class="line"> *</span><br><span class="line"> *  @param object 对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLinkEvent:(<span class="keyword">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.count ++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"count = %ld"</span>, (<span class="keyword">long</span>)<span class="keyword">self</span>.count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  开始刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventOne</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink addToRunLoop:[<span class="built_in">NSRunLoop</span> currentRunLoop] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  停止刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventTwo</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink invalidate];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-POP动画引擎中Layer与CALayer的联系与区别"><a href="#3-4-2-POP动画引擎中Layer与CALayer的联系与区别" class="headerlink" title="3.4.2    POP动画引擎中Layer与CALayer的联系与区别"></a>3.4.2    <code>POP</code>动画引擎中<code>Layer</code>与<code>CALayer</code>的联系与区别</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>POP</code> 动画中的 Layer 与 <code>CALayer</code> 的一些共性与区别。<br><strong>比较：</strong></p>
<ol>
<li>使用<code>POP</code>动画与使用<code>CALayer</code>动画非常相似</li>
<li><p><code>POP</code>动画的执行没有中间状态：相比POP动画，<code>CALayer</code>动画有中间状态：实际动画角色是立即到达结束时的位置的，中间状态指的是是“虚拟”的动画<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.44.12.png" alt="Alt text"></p>
</li>
<li><p><code>POP</code>动画是对<code>CALayer</code>动画的扩充，但不能实现所有的<code>CALayer</code>的动画效果</p>
</li>
<li><code>POP</code>动画可以作用在任何对象上，不仅仅是<code>CALayer</code></li>
</ol>
<p><strong>其它参考：</strong></p>
<ul>
<li><a href="http://www.cocoachina.com/industry/20140527/8565.html" target="_blank" rel="external">http://www.cocoachina.com/industry/20140527/8565.html</a></li>
</ul>
<p><strong>实例：</strong></p>
<ol>
<li>导入<code>POP</code>框架(<a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a>)<blockquote>
<p><strong>方式1：</strong>使用<a href="http://www.jianshu.com/p/071d30a3af02" target="_blank" rel="external">cocoapods</a>安装<br><strong>方式2：</strong>直接导入源码（可以配合<code>pch</code>文件）<br>教程：<a href="http://www.jianshu.com/p/67ce72c4ad6c" target="_blank" rel="external">http://www.jianshu.com/p/67ce72c4ad6c</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.53.54.png" alt="Alt text"><br><strong>方式3：</strong>二进制文件<code>.framework</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<h4 id="3-4-2-1-导入POP框架"><a href="#3-4-2-1-导入POP框架" class="headerlink" title="3.4.2.1    导入POP框架"></a>3.4.2.1    导入<code>POP</code>框架</h4><blockquote>
<p><strong>说明：</strong>使用<code>CocoaPods</code><br><strong>可能的出错：</strong><a href="http://www.tuicool.com/articles/InIBbaf" target="_blank" rel="external">http://www.tuicool.com/articles/InIBbaf</a><br><strong>注意：</strong>安装好依赖后，需要从<code>项目名.xcworkspace</code>重启项目。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pod search pop<span class="comment"># 搜索版本号</span></span><br><span class="line">$ <span class="built_in">cd</span> /Users/tonyearth/Documents/My Study/Animation/L04POP动画引擎中Layer与CALayer的联系与区别 <span class="comment">#到项目目录下</span></span><br><span class="line">$ pod init<span class="comment"># 初始化环境</span></span><br><span class="line">$ vim Podfile<span class="comment"># 依赖配置</span></span><br><span class="line">	platform :ios, <span class="string">'7.0'</span></span><br><span class="line">	pod <span class="string">'pop'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line">$ pod install<span class="comment"># 安装依赖</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-1-比较CALayer和POP-CAlayer"><a href="#3-4-2-1-比较CALayer和POP-CAlayer" class="headerlink" title="3.4.2.1    比较CALayer和POP CAlayer"></a>3.4.2.1    比较CALayer和POP CAlayer</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_pop.gif" alt="Alt text|150x200"></p>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *normal<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *pop<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理 normalCALayer</span></span><br><span class="line">    [<span class="keyword">self</span> accessNormal<span class="built_in">CALayer</span>];</span><br><span class="line">    <span class="comment">// 处理 POP 动画</span></span><br><span class="line">    [<span class="keyword">self</span> accessPOP<span class="built_in">CALayer</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - pop CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  pop CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessPOP<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.popCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.popCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 POP 动画</span></span><br><span class="line">    POPBasicAnimation *popAnimation = \</span><br><span class="line">    [POPBasicAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">    popAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">100</span> + <span class="number">50</span>, <span class="number">400</span>)];<span class="comment">// pop 动画不需要 fromValue</span></span><br><span class="line">    popAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    popAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_addAnimation:popAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：在哪儿移除就停在哪儿</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removePopAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1.5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removePopAnimation</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_removeAllAnimations];<span class="comment">// 移除所有 pop 动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessNormal<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.normalCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *baseAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    baseAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.normalCALayer.position];</span><br><span class="line">    baseAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>)];</span><br><span class="line">        baseAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    baseAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置结束位置的值</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.position = <span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>);</span><br><span class="line">    <span class="comment">// 开始动画</span></span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer addAnimation:baseAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：无论在哪儿停止，都会出现在最后设置的位置（非常突兀）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removeNormalAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNormalAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = <span class="keyword">self</span>.normalCALayer.presentationLayer;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(layer.frame));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(<span class="keyword">self</span>.normalCALayer.frame));</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer removeAllAnimations];<span class="comment">// 移除掉所有动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-用POP动画引擎实现衰减动画"><a href="#3-4-3-用POP动画引擎实现衰减动画" class="headerlink" title="3.4.3    用POP动画引擎实现衰减动画"></a>3.4.3    用<code>POP</code>动画引擎实现衰减动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现移动<code>View</code> 并停止时衰减的动画效果。<br><strong>要点：</strong></p>
<ol>
<li>衰减动画由<code>POPDecayAnimation</code>来实现</li>
<li>需要精确计算停止运动瞬间的加速度才能用衰减动画做出真实的效果</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_decay.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *button;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化button</span></span><br><span class="line">    <span class="keyword">self</span>.button = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.button.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.button.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.button];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [<span class="keyword">self</span>.button addTarget:<span class="keyword">self</span></span><br><span class="line">                    action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">          forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 初始化手势</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *panGesture = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePanGesture:)];</span><br><span class="line">    <span class="comment">// 添加手势</span></span><br><span class="line">    [<span class="keyword">self</span>.button addGestureRecognizer:panGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击按钮取消按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param button 按钮控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    [button.layer pop_removeAllAnimations];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  手势操作的响应函数</span><br><span class="line"> *</span><br><span class="line"> *  @param recognizer 事件目标控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)handlePanGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [recognizer translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    recognizer.view.center = <span class="built_in">CGPointMake</span>(recognizer.view.center.x + translation.x,</span><br><span class="line">                                         recognizer.view.center.y + translation.y);</span><br><span class="line">    [recognizer setTranslation:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>) inView:<span class="keyword">self</span>.view];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拖动停止</span></span><br><span class="line">    <span class="keyword">if</span> (recognizer.state == <span class="built_in">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class="line">        <span class="comment">//1. 创建动画</span></span><br><span class="line">        <span class="comment">// 获取加速度</span></span><br><span class="line">        <span class="built_in">CGPoint</span> velocity = [recognizer velocityInView:<span class="keyword">self</span>.view];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化POP的decay(衰减)动画</span></span><br><span class="line">        POPDecayAnimation *decayAnimation = \</span><br><span class="line">            [POPDecayAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">        <span class="comment">// 设置加速度</span></span><br><span class="line">        decayAnimation.velocity = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:velocity];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 执行动画</span></span><br><span class="line">        [recognizer.view.layer pop_addAnimation:decayAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-用POP动画引擎实现弹簧动画"><a href="#3-4-4-用POP动画引擎实现弹簧动画" class="headerlink" title="3.4.4    用POP动画引擎实现弹簧动画"></a>3.4.4    用<code>POP</code>动画引擎实现弹簧动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现 View 的放大缩小等的弹簧效果。<br><strong>扩展：</strong><code>Shimmer</code><br><strong>要点：</strong></p>
<ol>
<li>弹簧动画由<code>POPSpringAnimation</code></li>
<li>弹簧的质量、速度、时间等值都是可以设置的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_spring.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置背景色</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 延时3秒执行动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(startSpringAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例弹簧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)startSpringAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化spring动画</span></span><br><span class="line">    POPSpringAnimation *sizeAnimation = \</span><br><span class="line">    [POPSpringAnimation animationWithPropertyNamed:kPOPLayerBounds];<span class="comment">// 缩放型动画</span></span><br><span class="line">    sizeAnimation.springSpeed = <span class="number">0.</span>f;</span><br><span class="line">    sizeAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.showView pop_addAnimation:sizeAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-5-用缓动函数模拟物理动画"><a href="#3-5-用缓动函数模拟物理动画" class="headerlink" title="3.5    用缓动函数模拟物理动画"></a>3.5    用缓动函数模拟物理动画</h2><h3 id="3-5-1-缓动函数简介"><a href="#3-5-1-缓动函数简介" class="headerlink" title="3.5.1    缓动函数简介"></a>3.5.1    缓动函数简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时将演示缓动函数能做出来的效果，然后讲解它的基本原理。</p>
<ol>
<li>缓动函数的动画效果是建立在<code>CALayer</code>层级的关键帧动画基础之上</li>
<li>缓动函数是一系列模拟物理效果（如抛物线）方程式的统称，用以计算给定亮点之间的插值</li>
<li>两点之间插的值越多，效果越好，但是会耗费更多的性能</li>
<li>只有理解了缓动函数的原理才有可能写出自己想要的效果</li>
</ol>
<p><strong>缓动函数源码：</strong><a href="https://github.com/YouXianMing/EasingAnimation" target="_blank" rel="external">https://github.com/YouXianMing/EasingAnimation</a></p>
</blockquote>
<h4 id="3-5-1-1-缓动函数类型"><a href="#3-5-1-1-缓动函数类型" class="headerlink" title="3.5.1.1    缓动函数类型"></a>3.5.1.1    缓动函数类型</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-09%20%E4%B8%8B%E5%8D%8810.52.45.png" alt="Alt text"></p>
<h4 id="3-5-1-2-缓动效果示例"><a href="#3-5-1-2-缓动效果示例" class="headerlink" title="3.5.1.2    缓动效果示例"></a>3.5.1.2    缓动效果示例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_easing.gif" alt="Alt text"></p>
<h3 id="3-5-2-缓动函数与关键帧动画的联系"><a href="#3-5-2-缓动函数与关键帧动画的联系" class="headerlink" title="3.5.2    缓动函数与关键帧动画的联系"></a>3.5.2    缓动函数与关键帧动画的联系</h3><blockquote>
<p><strong>课程说明：</strong>本课时将讲解关键帧动画的原理，并分析关键帧动画与缓动函数之间的联系。</p>
<ol>
<li>关键帧动画需要提供很多的帧来完善动画效果</li>
<li>关键帧动画的帧可以通过一定的数学计算来提供需要的帧数</li>
<li><code>关键帧动画只需要提供起始点、结束点，就可以通过缓动函数来计算中间“缺失”的帧</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-10%20%E4%B8%8B%E5%8D%8812.00.12.png" alt="Alt text"></li>
<li>缓动函数可以指定计算出多少帧</li>
<li>帧数越多，动画越流畅，但同时耗费更多GPU性能</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>缓动动画只是缓动函数在关键帧动画中的一种应用</li>
<li>当只插值只有起点和终点时，关键帧动画和基本动画效果一致</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化显示用的view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本动画</span></span><br><span class="line">    <span class="comment">// [self baseAnimation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关键帧动画</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  基本动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)baseAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *basicAnimation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    basicAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    basicAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    <span class="comment">// fromValue = A, toValue = B</span></span><br><span class="line">    basicAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.showView.center];</span><br><span class="line">    basicAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:basicAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  关键帧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    <span class="comment">// 插值（通过缓动函数创建一些列插值点）</span></span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromPoint:<span class="keyword">self</span>.showView.center<span class="comment">// 起点</span></span><br><span class="line">                                                         toPoint:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)<span class="comment">//终点</span></span><br><span class="line">                                                            func:BounceEaseIn<span class="comment">// 动画进度</span></span><br><span class="line">                                                      frameCount:<span class="number">60</span> * <span class="number">2</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="comment">// 2. 实际目标位置</span></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加动画到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-用缓动函数模拟弹簧效果"><a href="#3-5-3-用缓动函数模拟弹簧效果" class="headerlink" title="3.5.3    用缓动函数模拟弹簧效果"></a>3.5.3    用缓动函数模拟弹簧效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数结合关键帧动画实现弹簧效果，并模拟秒表摆动效果。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_time.gif" alt="Alt text|100x90"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *secLayer;<span class="comment">// 秒针</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个表盘 UIView</span></span><br><span class="line">    <span class="built_in">UIView</span> *showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    showView.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    showView.layer.cornerRadius = <span class="number">150</span>;</span><br><span class="line">    showView.layer.borderColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建出秒针 CALayer</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.secLayer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">150</span>, <span class="number">150</span>, <span class="number">1</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.backgroundColor = [<span class="built_in">UIColor</span> blackColor].CGColor;</span><br><span class="line">    [showView.layer addSublayer:<span class="keyword">self</span>.secLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f<span class="comment">// 1秒钟调用一次</span></span><br><span class="line">                                                  target:<span class="keyword">self</span><span class="comment">// 目标控制器</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent) <span class="comment">// 目标方法</span></span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  指针变化动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">1</span>;<span class="comment">// 时间点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> oldValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i++);<span class="comment">// 旧弧度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> newValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i);<span class="comment">// 新弧度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"transform.rotation.z"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">0.5</span>;</span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromValue:oldValue<span class="comment">// 起始弧度</span></span><br><span class="line">                                                         toValue:newValue<span class="comment">// 结束弧度</span></span><br><span class="line">                                                            func:ElasticEaseOut <span class="comment">// 动画效果</span></span><br><span class="line">                                                      frameCount:<span class="number">0.5</span> * <span class="number">30</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer.transform = <span class="built_in">CATransform3DMakeRotation</span>(newValue,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">1</span>);</span><br><span class="line">    [<span class="keyword">self</span>.secLayer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-4-用缓动函数模拟碰撞效果"><a href="#3-5-4-用缓动函数模拟碰撞效果" class="headerlink" title="3.5.4    用缓动函数模拟碰撞效果"></a>3.5.4    用缓动函数模拟碰撞效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现碰撞动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutBounce</code>函数来创建碰撞效果</li>
<li>将<code>easeOutBounce</code>创建出来的帧数组添加到关键帧动画中</li>
<li>碰撞效果用途</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_bounce.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 创建图 view</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">100</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    imageView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画（移动距离的动画）</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>)</span><br><span class="line">                                     func:BounceEaseOut<span class="comment">// 碰撞动画</span></span><br><span class="line">                               frameCount:<span class="number">2</span> * <span class="number">30</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation</span><br><span class="line">                           forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-用缓动函数模拟衰减效果"><a href="#3-5-5-用缓动函数模拟衰减效果" class="headerlink" title="3.5.5    用缓动函数模拟衰减效果"></a>3.5.5    用缓动函数模拟衰减效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现衰减动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutCubic</code>函数来创建弹簧效果</li>
<li>将<code>easeOutCubic</code>创建出来的的帧数组添加到关键帧动画中</li>
<li>衰减效果用途</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_cubic.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画1:背景变暗</span></span><br><span class="line">    <span class="built_in">UIView</span>  *backView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    backView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">        backView.alpha = <span class="number">0.3</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:backView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画2:衰减滑出</span></span><br><span class="line">    <span class="comment">// 创建图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">320</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">568</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y)</span><br><span class="line">                                     func:CubicEaseOut</span><br><span class="line">                               frameCount:<span class="number">1</span> * <span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-使用带粒子效果的-CAEmitterLayer"><a href="#3-6-使用带粒子效果的-CAEmitterLayer" class="headerlink" title="3.6    使用带粒子效果的 CAEmitterLayer"></a>3.6    使用带粒子效果的 CAEmitterLayer</h2><h3 id="3-6-1-用-CAEmitterLayer-产生粒子效果"><a href="#3-6-1-用-CAEmitterLayer-产生粒子效果" class="headerlink" title="3.6.1    用 CAEmitterLayer 产生粒子效果"></a>3.6.1    用 CAEmitterLayer 产生粒子效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>CAEmitterLayer</code> 的一些基本属性，以及基本的用法。</p>
<ul>
<li><code>CAEmitterLayer</code>的用途：实现粒子效果</li>
<li><code>CAEmitterLayer</code>参数</li>
<li><code>CAEmitterLayer</code>优点：使用<code>GPU</code>渲染，不占用<code>CPU</code>资源，远优于使用大量的随机<code>View</code>来实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_emitter.gif" alt="Alt text"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. CAEmitterLayer</span></span><br><span class="line"><span class="comment">// 创建出粒子发射图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayer</span> *emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</span><br><span class="line">emitterLayer.borderWidth = <span class="number">2.</span>f;<span class="comment">// 边框宽度（显示边框）</span></span><br><span class="line">emitterLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>);<span class="comment">// 设置尺寸</span></span><br><span class="line">emitterLayer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏溢出的粒子</span></span><br><span class="line">emitterLayer.emitterPosition = <span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">50</span>);<span class="comment">// 发射点</span></span><br><span class="line">emitterLayer.emitterMode = k<span class="built_in">CAEmitterLayerSurface</span>;<span class="comment">// 发射模式</span></span><br><span class="line">emitterLayer.emitterShape = k<span class="built_in">CAEmitterLayerLine</span>;<span class="comment">// 发射形状</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加图层到当前视图图层</span></span><br><span class="line">[<span class="keyword">self</span>.view.layer addSublayer:emitterLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. CAEmitterCell（粒子）</span></span><br><span class="line"><span class="built_in">CAEmitterCell</span> *cell = [<span class="built_in">CAEmitterCell</span> emitterCell];</span><br><span class="line">cell.birthRate = <span class="number">10.</span>f;<span class="comment">// 粒子产生率</span></span><br><span class="line">cell.lifetime = <span class="number">120.</span>f;<span class="comment">// 粒子声明周期</span></span><br><span class="line">cell.velocity = <span class="number">30</span>;<span class="comment">// 加速度</span></span><br><span class="line">cell.velocityRange = <span class="number">10.</span>f;<span class="comment">// 加速度微调</span></span><br><span class="line">cell.yAcceleration = <span class="number">2.</span>f;<span class="comment">// y 轴加速度</span></span><br><span class="line">cell.emissionRange = <span class="number">0.5</span> * M_1_PI;<span class="comment">// 发射角度</span></span><br><span class="line">cell.color = [<span class="built_in">UIColor</span> blackColor].CGColor;<span class="comment">// 设置粒子颜色</span></span><br><span class="line">cell.contents = (__bridge <span class="keyword">id</span>)([<span class="built_in">UIImage</span> imageNamed:<span class="string">@"snow"</span>].CGImage);<span class="comment">// 设置图片</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将 CAEmitterCell(粒子)关联到CAEmitterLayer</span></span><br><span class="line">emitterLayer.emitterCells = @[cell];</span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-封装-CAEmitterLayerUIVIew"><a href="#3-6-2-封装-CAEmitterLayerUIVIew" class="headerlink" title="3.6.2    封装 CAEmitterLayerUIVIew"></a>3.6.2    封装 CAEmitterLayerUIVIew</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解了为了避免繁琐的设置而将 <code>CAEmitterLayer</code> 封装成一个较为通用的父类供子类使用。</p>
<ul>
<li>替换<code>CAEmitterLayer</code>成<code>UIView</code>子类的<code>backedLayer</code></li>
<li>将<code>CAEmitterLayer</code>封装的类作为“抽象“父类</li>
</ul>
<p><strong>说明：</strong>封装一个父类(<code>CAEmitterLayerUIView</code>)，其它类型的粒子图层继承该类，将设置封装到子类的<code>show</code>和<code>hide</code>实现中。</p>
</blockquote>
<p><em>CAEmitterLayerUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示view</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏view</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CAEmitterLayerUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CAEmitterLayerUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">CAEmitterLayer</span> *_emitterLayer;<span class="comment">// 粒子图层</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CAEmitterLayerUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        _emitterLayer = (<span class="built_in">CAEmitterLayer</span> *)<span class="keyword">self</span>.layer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类本身</span></span><br><span class="line">+ (Class)layerClass</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">CAEmitterLayer</span> class];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer</span><br><span class="line">&#123;</span><br><span class="line">    _emitterLayer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _emitterLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-封装下雪、下雨的粒子效果控件"><a href="#3-6-3-封装下雪、下雨的粒子效果控件" class="headerlink" title="3.6.3    封装下雪、下雨的粒子效果控件"></a>3.6.3    封装下雪、下雨的粒子效果控件</h3><blockquote>
<p><strong>课程说明：</strong>本课时在封装 <code>CAEmitterLayer</code> 基础上进一步从“抽象”父类派生出下雪、下雨的子类控件。</p>
<ul>
<li>从封装<code>CAEmitterLayer</code>的“抽象”父类继承的原因</li>
<li>下雪、下雨效果参数的设置</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_rain.gif" alt="Alt text"></p>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用控件</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 初始化粒子效果图层</span></span><br><span class="line"><span class="comment">// 下雪效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *snowView = [[SnowView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line"><span class="comment">// 下雨效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *rainView = [[RainView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">210</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 模糊化粒子视图边界</span></span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView1 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView1.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"></span><br><span class="line">snowView.maskView = alphaView1;</span><br><span class="line">rainView.maskView = alphaView2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加到当前图层</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:rainView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 展现</span></span><br><span class="line">[snowView show];</span><br><span class="line">[rainView show];</span><br></pre></td></tr></table></figure>
<h2 id="3-7-iOS-中-CAGradientLaueyer-的使用"><a href="#3-7-iOS-中-CAGradientLaueyer-的使用" class="headerlink" title="3.7    iOS 中 CAGradientLaueyer 的使用"></a>3.7    iOS 中 CAGradientLaueyer 的使用</h2><h3 id="3-7-1-CAGradientLayer-简介"><a href="#3-7-1-CAGradientLayer-简介" class="headerlink" title="3.7.1    CAGradientLayer 简介"></a>3.7.1    CAGradientLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课演示 <code>CAGradientLayer</code> 能做的一些动画效果，以及 <code>CAGradientLayer</code> 与 <code>CAShapeLayer</code> 配合使用的实例。</p>
<ol>
<li><code>CAGradientLayer</code>是用于处理渐变色的层结构</li>
<li><code>CAGradientLayer</code>的渐变色可以做隐式动画</li>
<li>大部分情况下，<code>CAGradientLayer</code>都是与<code>CAShapeLayer</code>配合使用的</li>
<li><code>CAGradientLayer</code>可以用作<code>png</code>遮罩效果</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam1.gif" alt="Alt text|100x100"> <code>CAShapeLayer</code>作为<code>CAGradientLayer</code>的遮罩实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam2.gif" alt="Alt text|100x100">旋转<code>CAGradientLayer</code>实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam3.gif" alt="Alt text|100x160"> 色差动画效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam4.gif" alt="Alt text|100x160">作为<code>png</code>图片遮罩动画效果</p>
<h3 id="3-7-2-CAGradientLayer-坐标系统"><a href="#3-7-2-CAGradientLayer-坐标系统" class="headerlink" title="3.7.2    CAGradientLayer 坐标系统"></a>3.7.2    CAGradientLayer 坐标系统</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解 CAGradientLayer 的坐标系统，并延伸讲解了坐标系统影响如何颜色分配、动画效果。</p>
<ol>
<li><code>CAGradientLayer</code>的坐标系统是从坐标（0, 0）到（1, 1）绘制的矩形<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.44.12.png" alt="Alt text|200x180"></li>
<li><code>CAGradientLayer</code>的<code>frame</code>值的<code>size</code>不为正方形的话，坐标系统会被拉伸</li>
<li><code>CAGradientLayer</code>的<code>startPoint</code>与<code>endPoint</code>会直接影响颜色的绘制方向</li>
<li><code>CAGradientLayer</code>的颜色分割线是以0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.45.28.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_gra.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 1. 创建并初始化 CAGradientLayer 实例</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.gradientLayer];<span class="comment">// 添加到视图</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 渐变效果相关设置</span></span><br><span class="line">    <span class="comment">// 颜色</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> greenColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor].CGColor];</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 动画:3秒后修改分割点</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(gradientLayerLocationLocationAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  修改分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)gradientLayerLocationLocationAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 颜色分割点效果</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.5</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-3-色差动画的实现"><a href="#3-7-3-色差动画的实现" class="headerlink" title="3.7.3    色差动画的实现"></a>3.7.3    色差动画的实现</h3><blockquote>
<p><strong>课程说明：</strong>本课用 CAGradientLayer 实现色差动画效果。</p>
<ol>
<li>确定渐变色渐变方向</li>
<li>设定两种颜色，其中一种是透明色，另外一种是自定义颜色</li>
<li>设定好<code>location</code>颜色分割点</li>
<li><code>CAGradientLayer</code>的颜色分割点是0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_colors.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建 UIImage 实例（作为背景）</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>]];</span><br><span class="line">    imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 初始化渐变图层</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = imageView.bounds;</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.5</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 组合背景和渐变图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    [imageView.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 初始化定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                                  target:<span class="keyword">self</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent)</span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  刷新颜色组合分割点，从而制造动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取一组随机产生的颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> colorWithRed:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               green:arc4random() % <span class="number">255</span> /  <span class="number">255.</span>f</span><br><span class="line">                                                                blue:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">    <span class="comment">// 获取随机产生的分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(arc4random() % <span class="number">10</span> / <span class="number">10.</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-4-用-CAGradientLayer-封装带色差动画的-View"><a href="#3-7-4-用-CAGradientLayer-封装带色差动画的-View" class="headerlink" title="3.7.4    用 CAGradientLayer 封装带色差动画的 View"></a>3.7.4    用 CAGradientLayer 封装带色差动画的 View</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解将色差动画效果封装到 View 当中。</p>
<ol>
<li>确定几个属性值</li>
<li>去定意义做动画的参数</li>
<li>重写<code>setter</code>做动画</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_last.gif" alt="Alt text"></p>
<h4 id="3-7-4-1-封装好的视图"><a href="#3-7-4-1-封装好的视图" class="headerlink" title="3.7.4.1    封装好的视图"></a>3.7.4.1    封装好的视图</h4><blockquote>
<p><strong>说明：</strong>将对视图的渐变层的设置工作整合到<code>setter</code>中。</p>
</blockquote>
<p><em>ColorUIImageView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 渐变方向</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    UP,<span class="comment">// 从上至下</span></span><br><span class="line">    DOWN,<span class="comment">// 从下往上</span></span><br><span class="line">    RIGHT,<span class="comment">// 从左到右</span></span><br><span class="line">    LEFT<span class="comment">// 从右往左</span></span><br><span class="line">&#125; EColorDirection;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> : <span class="title">UIImageView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) EColorDirection direction;<span class="comment">// 渐变方向(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;<span class="comment">// 颜色(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> percent;<span class="comment">// 百分比(可以做动画)</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ColorUIImageView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ColorUIImageView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化 CAGradientLayer 实例</span></span><br><span class="line">        <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                      (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">1</span>), @(<span class="number">1</span>)];</span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色组 color</span></span><br><span class="line"><span class="keyword">@synthesize</span> color = _color;</span><br><span class="line">- (<span class="keyword">void</span>)setColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    _color = color;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)color.CGColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渐变方向 direction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> direction = _direction;</span><br><span class="line">- (<span class="keyword">void</span>)setDirection:(EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    _direction = direction;</span><br><span class="line">    <span class="keyword">if</span> (direction == UP) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == DOWN) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == RIGHT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == LEFT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _direction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 分割点 percent</span></span><br><span class="line"><span class="keyword">@synthesize</span> percent = _percent;</span><br><span class="line">- (<span class="keyword">void</span>)setPercent:(<span class="built_in">CGFloat</span>)percent &#123;</span><br><span class="line">    _percent = percent;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(percent), @(<span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _percent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-7-4-2-使用"><a href="#3-7-4-2-使用" class="headerlink" title="3.7.4.2    使用"></a>3.7.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Color<span class="built_in">UIImageView</span> *colorView;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 初始化封装了渐变图层的自定义视图</span></span><br><span class="line">    <span class="keyword">self</span>.colorView        = [[Color<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">198</span>, <span class="number">253</span>)];</span><br><span class="line">    <span class="keyword">self</span>.colorView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.colorView.image  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.colorView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 1秒钟后改变视图</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(event)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">1.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变渐变颜色组、渐变方向和分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)event &#123;</span><br><span class="line">    <span class="keyword">self</span>.colorView.direction = DOWN;</span><br><span class="line">    <span class="keyword">self</span>.colorView.color     = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.colorView.percent   = <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-8-iOS中-CAShapeLayer-的使用"><a href="#3-8-iOS中-CAShapeLayer-的使用" class="headerlink" title="3.8    iOS中 CAShapeLayer 的使用"></a>3.8    iOS中 CAShapeLayer 的使用</h2><h3 id="3-8-1-CAShapeLayer-简介"><a href="#3-8-1-CAShapeLayer-简介" class="headerlink" title="3.8.1    CAShapeLayer 简介"></a>3.8.1    CAShapeLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍 <code>CAShapeLayer</code> 与 <code>CALayer</code>、贝塞尔曲线之间的简单联系，并通过一个 demo 演示 <code>CAShapeLayer</code> 实现的路径动画效果。</p>
<ol>
<li><code>CAShapeLayer</code>继承自<code>CALayer</code>，可以使用<code>CALayer</code>的所有属性值</li>
<li><code>CAShapeLayer</code>需要与贝塞尔曲线配合使用才有意义</li>
<li>使用<code>CAShapeLayer</code>与贝塞尔曲线可以实现不在<code>view</code>的<code>drawRect</code>方法中画出一些想要的图形</li>
<li><code>CAShapeLayer</code>属于<code>CoreAnimation</code>框架，其动画渲染直接提交到手机的<code>GPU</code>当中，相较于<code>view</code>的<code>srawRect</code>方法使用<code>CPU</code>渲染而言，其效率极高，能大大优化内存使用情况。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_path.gif" alt="Alt text"></p>
<h3 id="3-8-2-贝塞尔曲线与-CAShapeLayer-的关系"><a href="#3-8-2-贝塞尔曲线与-CAShapeLayer-的关系" class="headerlink" title="3.8.2    贝塞尔曲线与 CAShapeLayer 的关系"></a>3.8.2    贝塞尔曲线与 CAShapeLayer 的关系</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍多阶贝塞尔曲线的用途，并详细讲解贝塞尔曲线与 <code>CAShapeLayer</code> 之间的关系，以及使用贝塞尔曲线的一些注意事项。</p>
<ol>
<li><code>CAShapeLayer</code>中有<code>Shape</code>这个单词，顾名思义，它需要一个形状才能生效</li>
<li>贝赛尔曲线可以创建基于矢量的路径<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_beisaier.gif" alt="Alt text"></li>
<li>贝塞尔曲线给<code>CAShaperLayer</code>提供路径，<code>CAShpaeLayer</code>在提供的路径中进行渲染，路径会闭环，所以路径绘制出了<code>Shape</code></li>
<li>用于<code>CAShapeLayer</code>的贝赛尔曲线作为<code>path</code>，其中<code>path</code>是一个首尾相接的闭环的曲线，即使该贝赛尔曲线不是一个闭环的曲线。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-12%2019.14.35.png" alt="Alt text"></p>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">    <span class="comment">// UIBezierPath *oval = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(0, 0, 200, 100)];// 椭圆形</span></span><br><span class="line">    <span class="comment">// UIBezierPath *rect = [UIBezierPath bezierPathWithRect:CGRectMake(0, 0, 200, 100)];// 矩形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *circle = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];<span class="comment">// 圆形</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">    <span class="built_in">CAShapeLayer</span> *shape = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    shape.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">    shape.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    shape.borderWidth = <span class="number">1.</span>f;<span class="comment">// 显示 CAShapeLayer 的边界</span></span><br><span class="line">    shape.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏益处的贝塞尔曲线围住的区域</span></span><br><span class="line">    shape.fillColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 建立关联</span></span><br><span class="line">    shape.path = circle.CGPath;<span class="comment">// 看下圆形的效果</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:shape];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-3-StrokeStart-与-StrokeEnd-动画"><a href="#3-8-3-StrokeStart-与-StrokeEnd-动画" class="headerlink" title="3.8.3    StrokeStart 与 StrokeEnd 动画"></a>3.8.3    StrokeStart 与 StrokeEnd 动画</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何设置 <code>CAShapeLayer</code> 的属性值来显示出圆环并用 <code>CAShapeLayer</code> 的 <code>StrokeStart</code> 与 <code>StrokeEnd</code> 属性做动画。</p>
<ol>
<li>将<code>ShapeLayer</code>的<code>fillColor</code>设置成透明背景</li>
<li>设置线条的宽度(<code>lineWidth</code>)的值</li>
<li>设置线条的颜色</li>
<li>将<code>strokeStart</code>的值设定成0，然后让<code>strokeEnd</code>的值变化触发隐式动画</li>
</ol>
<p><strong>注意：</strong>同时设置<code>strokeStart</code>和<code>strokeEnd</code>时，前者不能大于后者。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_animeTwo.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 背景设置</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.878</span> green:<span class="number">0.878</span> blue:<span class="number">0.878</span> alpha:<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 贝塞尔曲线</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *oval = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. CAShapeLayer</span></span><br><span class="line">    _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    _shapeLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    _shapeLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">    _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    _shapeLayer.lineWidth = <span class="number">2.</span>f;</span><br><span class="line">    _shapeLayer.strokeStart = <span class="number">0.</span>f;</span><br><span class="line">    _shapeLayer.strokeEnd = <span class="number">0.</span>f;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 建立贝塞尔曲线与CAShapeLayer之间的关联</span></span><br><span class="line">    _shapeLayer.path = oval.CGPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:_shapeLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 定时器</span></span><br><span class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                              target:<span class="keyword">self</span></span><br><span class="line">                                            selector:<span class="keyword">@selector</span>(animationEventTypeTwo)</span><br><span class="line">                                            userInfo:<span class="literal">nil</span></span><br><span class="line">                                             repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  只改变 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeOne</span><br><span class="line">&#123;</span><br><span class="line">    _shapeLayer.strokeEnd = arc4random() % <span class="number">100</span> / <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  同时改变 strokeStart 和 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeTwo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueOne = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueTwo = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    </span><br><span class="line">    _shapeLayer.strokeStart = valueOne &lt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取小的</span></span><br><span class="line">    _shapeLayer.strokeEnd = valueOne &gt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取大的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-4-用-CAShapeLayer-实现圆形进度条效果"><a href="#3-8-4-用-CAShapeLayer-实现圆形进度条效果" class="headerlink" title="3.8.4    用 CAShapeLayer 实现圆形进度条效果"></a>3.8.4    用 CAShapeLayer 实现圆形进度条效果</h3><blockquote>
<p><strong>课程说明：</strong>本课在课时 3 的基础上将动画效果封装到控件当中。</p>
<ol>
<li>确定需要设定的参数</li>
<li>实现细节</li>
<li>进行测试</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_circle.gif" alt="Alt text"></p>
<h4 id="3-8-4-1-圆形进度条控件"><a href="#3-8-4-1-圆形进度条控件" class="headerlink" title="3.8.4.1    圆形进度条控件"></a>3.8.4.1    圆形进度条控件</h4><p><em>CircleUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> startValue;<span class="comment">// 起始值（0～1）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> lineWidth;<span class="comment">// 线宽（&gt;0）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> value;<span class="comment">// 变化的值</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;<span class="comment">// 线条颜色</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CircleUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CircleUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="keyword">self</span>.bounds];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">        _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">        _shapeLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">        _shapeLayer.lineWidth=  <span class="number">1.</span>f;</span><br><span class="line">        _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">        _shapeLayer.strokeEnd = <span class="number">0.</span>f;<span class="comment">// 一开使进度为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 关联</span></span><br><span class="line">        _shapeLayer.path = path.CGPath;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 添加并显示</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:_shapeLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeStart</span></span><br><span class="line"><span class="keyword">@synthesize</span> startValue = _startValue;</span><br><span class="line">- (<span class="keyword">void</span>)setStartValue:(<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    _startValue = startValue;</span><br><span class="line">    _shapeLayer.strokeStart = startValue;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    <span class="keyword">return</span> _startValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeEnd</span></span><br><span class="line"><span class="keyword">@synthesize</span> value = _value;</span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    _value = value;</span><br><span class="line">    _shapeLayer.strokeEnd = value;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    <span class="keyword">return</span> _value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lineWidth</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineWidth = _lineWidth;</span><br><span class="line">- (<span class="keyword">void</span>)setLineWidth:(<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    _lineWidth = lineWidth;</span><br><span class="line">    _shapeLayer.lineWidth = lineWidth;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeColor</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineColor = _lineColor;</span><br><span class="line">- (<span class="keyword">void</span>)setLineColor:(<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    _lineColor = lineColor;</span><br><span class="line">    _shapeLayer.strokeColor = lineColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-8-4-2-使用"><a href="#3-8-4-2-使用" class="headerlink" title="3.8.4.2    使用"></a>3.8.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    Circle<span class="built_in">UIView</span> *circle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建并设置圆型进度条</span></span><br><span class="line">    circle = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    circle.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    circle.startValue = <span class="number">0.</span>f;</span><br><span class="line">    circle.lineWidth = <span class="number">3.</span>f;</span><br><span class="line">    circle.lineColor = [<span class="built_in">UIColor</span> grayColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:circle];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 延迟3秒后动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(delayAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置圆型进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)delayAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使进度达到100%</span></span><br><span class="line">    circle.value = <span class="number">1.</span>f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-9-iOS中-CALayer-的使用"><a href="#3-9-iOS中-CALayer-的使用" class="headerlink" title="3.9    iOS中 CALayer 的使用"></a>3.9    iOS中 CALayer 的使用</h2><h3 id="3-9-1-用-CALayer-定制下载进度条控件"><a href="#3-9-1-用-CALayer-定制下载进度条控件" class="headerlink" title="3.9.1    用 CALayer 定制下载进度条控件"></a>3.9.1    用 CALayer 定制下载进度条控件</h3><blockquote>
<p><strong>课程说明：</strong>本课在通过对 <code>CALayer</code> 的基本原理讲解后用 <code>CALayer</code> 基本知识定制下载进度条控件。</p>
<ol>
<li>单独创建出<code>CALayer</code></li>
<li>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果</li>
<li>用定时器（<code>NSTimer</code>）模拟网络下载时提供的百分比数据</li>
<li>将<code>CALayer</code>封装进<code>UIView</code>子类中定制进度条控件</li>
</ol>
<p><strong>CALayer简介：</strong></p>
<ol>
<li><code>CALayer</code>一般作为<code>UIView</code>的容器使用</li>
<li><code>CALayer</code>是一个管理着图片载体（image-based content）的 层结构</li>
<li>直接修改单独创建出的<code>CALayer</code>的属性可以触发隐式动画（不需要其它设置，修改属性直接触发动画）</li>
<li><code>UIView</code>中的<code>CALayer</code>动画必须显式触发才能生效</li>
</ol>
</blockquote>
<h4 id="3-9-2-1-原理"><a href="#3-9-2-1-原理" class="headerlink" title="3.9.2.1    原理"></a>3.9.2.1    原理</h4><blockquote>
<p><strong>说明：</strong>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建layer并添加layer</span></span><br><span class="line"><span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">5</span>);</span><br><span class="line">[<span class="keyword">self</span>.view.layer addSubLayer:layer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发隐式动画</span></span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>, <span class="number">200</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-13%2010.29.42.png" alt="Alt text|200x120"></p>
<h4 id="3-9-1-2-实战"><a href="#3-9-1-2-实战" class="headerlink" title="3.9.1.2    实战"></a>3.9.1.2    实战</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
<h3 id="3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果"><a href="#3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果" class="headerlink" title="3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果"></a>3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用动画组 <code>CAAnimationGroup</code> 将 <code>bounds</code> 动画与 <code>contents</code> 动画组合起来实现切换图片时的淡入淡出效果。</p>
<ol>
<li>操作<code>UIImageView</code>的<code>CALayer</code>修改其<code>bounds</code>值进行显示动画</li>
<li>修改<code>UIImageView</code>的<code>CALayer</code>中的<code>contents</code>属性实现切换图片的动画</li>
<li>用<code>CAAnimationGroup</code>将<code>bounds</code>动画与<code>contents</code>动画组合起来</li>
<li>将上述效果封装进<code>UIView</code>的子类中生成控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_fade.gif" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="3-9-2-1-封装动画效果"><a href="#3-9-2-1-封装动画效果" class="headerlink" title="3.9.2.1    封装动画效果"></a>3.9.2.1    封装动画效果</h4><p><em>FadeUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *image;<span class="comment">// 当前图片</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 setter, getter</span></span><br><span class="line"><span class="keyword">@synthesize</span> image = _image;</span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    _image = image;</span><br><span class="line">    <span class="comment">// 除了第一次设置图片，都加入淡如淡出的效果</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.layer.contents != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建淡入/淡出的切换动画</span></span><br><span class="line">        <span class="built_in">CABasicAnimation</span> *contentsAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"contents"</span>];</span><br><span class="line">        contentsAnimation.fromValue = <span class="keyword">self</span>.layer.contents;</span><br><span class="line">        contentsAnimation.toValue = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">        contentsAnimation.duration = <span class="number">3.</span>f;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将动画添加到图层</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addAnimation:contentsAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改 contents，触发动画</span></span><br><span class="line">    <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-9-2-2-使用控件"><a href="#3-9-2-2-使用控件" class="headerlink" title="3.9.2.2    使用控件"></a>3.9.2.2    使用控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Fade<span class="built_in">UIView</span> *fadeView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化呈现动画的视图</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView = [[Fade<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.fadeView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置第一张图片</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"起始图片"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2秒钟后设置下一张图片</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(layerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置下一张图片</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"结束图片"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-9-3-用-CALayer-实现复杂遮罩效果"><a href="#3-9-3-用-CALayer-实现复杂遮罩效果" class="headerlink" title="3.9.3    用 CALayer 实现复杂遮罩效果"></a>3.9.3    用 CALayer 实现复杂遮罩效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用 CALayer 的 mask 属性作为遮罩 Layer，通过移动该遮罩 Layer 的 frame 值实现复杂的遮罩效果。</p>
<ol>
<li>遮罩原理分析</li>
<li>用<code>png</code>图片作为<code>CALayer</code>中<code>mask</code>属性的遮罩<code>Layer</code></li>
<li>移动该<code>CALayer</code>的<code>mask</code>的<code>frame</code>值实现遮罩<code>Layer</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8A%E5%8D%8812.01.58.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *imageLayer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *maskLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *imageForContents = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"原始图片"</span>];<span class="comment">// 底图</span></span><br><span class="line">    <span class="built_in">UIImage</span> *imageForMask = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"maskLayerContents"</span>];<span class="comment">// 作为遮罩的图片</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.contents = (__bridge <span class="keyword">id</span>)(imageForContents.CGImage);</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.imageLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遮罩 layer</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.contents = (__bridge <span class="keyword">id</span>)(imageForMask.CGImage);</span><br><span class="line">    <span class="comment">// self.maskLayer.backgroundColor = [UIColor whiteColor].CGColor;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给图片 layer 提供遮罩的 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer.mask = <span class="keyword">self</span>.maskLayer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3秒中中后做 maskLayer 动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(maskLayerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)maskLayerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-10-iOS绘图-API-绘制线条／文字／几何图形"><a href="#3-10-iOS绘图-API-绘制线条／文字／几何图形" class="headerlink" title="3.10    iOS绘图 API 绘制线条／文字／几何图形"></a>3.10    iOS绘图 API 绘制线条／文字／几何图形</h2><h3 id="3-10-1-绘制线条"><a href="#3-10-1-绘制线条" class="headerlink" title="3.10.1    绘制线条"></a>3.10.1    绘制线条</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460642543336.png" alt="Alt text|100x150"><br><em>DrawLines.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawLinesView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 描绘线条</span></span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">300</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">500</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出来</span></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-2-绘制矩形"><a href="#3-10-2-绘制矩形" class="headerlink" title="3.10.2    绘制矩形"></a>3.10.2    绘制矩形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8810.36.09.png" alt="Alt text"><br><em>DrawRectView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawRectView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 矩形</span></span><br><span class="line">        <span class="type">CGContextAddRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置绘图上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出矩形</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-3-绘制圆形"><a href="#3-10-3-绘制圆形" class="headerlink" title="3.10.3    绘制圆形"></a>3.10.3    绘制圆形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460644510040.png" alt="Alt text|100x150"><br><em>DrawCircleView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawCircleView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 画圆</span></span><br><span class="line">        <span class="comment">/*-- 方案一 --*/</span></span><br><span class="line">        <span class="comment">// 内部用来填充的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="comment">// 外部作为边的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">10</span>)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*-- 方案二 --*/</span></span><br><span class="line">        <span class="type">CGContextAddEllipseInRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">400</span>, <span class="number">200</span>, <span class="number">100</span>))</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line"></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-4-绘制图片"><a href="#3-10-4-绘制图片" class="headerlink" title="3.10.4    绘制图片"></a>3.10.4    绘制图片</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8811.43.57.png" alt="Alt text"></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawImageView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uiImage:<span class="type">CGImageRef</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">        uiImage = <span class="type">UIImage</span>(named: <span class="string">"walle.jpg"</span>)?.<span class="type">CGImage</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制图片 */</span></span><br><span class="line">        <span class="comment">// 1. 保留之前的上下文信息（设置暂存点）</span></span><br><span class="line">        <span class="type">CGContextSaveGState</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 设置当前上下文</span></span><br><span class="line">        <span class="type">CGContextTranslateCTM</span>(context, <span class="number">10</span>, <span class="number">400</span>)<span class="comment">// 移动</span></span><br><span class="line">        <span class="type">CGContextScaleCTM</span>(context, <span class="number">1</span>, -<span class="number">1</span>)<span class="comment">// 缩放（翻转坐标系）</span></span><br><span class="line">        <span class="comment">// 3. 呈现图片</span></span><br><span class="line">        <span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>), uiImage)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制矩形 */</span></span><br><span class="line">        <span class="type">CGContextRestoreGState</span>(context)<span class="comment">// 恢复暂存点之前的上下文</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">80</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-5-画板实例"><a href="#3-10-5-画板实例" class="headerlink" title="3.10.5    画板实例"></a>3.10.5    画板实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_panel.gif" alt="Alt text"><br><em>DrawBoardView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawBoardView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">CGPathCreateMutable</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathMoveToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">        </span><br><span class="line">        setNeedsDisplay()<span class="comment">// 重绘当前view（触发drawRect）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="type">CGContextAddPath</span>(context, path)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_2  UI部分/" itemprop="url">
                  2 UI部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:56:56+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>iOS</code>实战项目</p>
</blockquote>
<h2 id="2-1-汤姆猫小游戏（投诉下线）"><a href="#2-1-汤姆猫小游戏（投诉下线）" class="headerlink" title="2.1    汤姆猫小游戏（投诉下线）"></a>2.1    汤姆猫小游戏（投诉下线）</h2><h2 id="2-2-加法计算器"><a href="#2-2-加法计算器" class="headerlink" title="2.2    加法计算器"></a>2.2    加法计算器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>storyboard</code> 中利用 <code>UITextField</code>、<code>UILabel</code>、<code>UIButton</code> 快速搭建器计算器UI界面，并在 <code>viewController</code> 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。</p>
<ul>
<li>设置<code>Text Field</code>使用数字键盘</li>
<li>点击“计算”后，使<code>Text Field</code>失去焦点</li>
<li>处理<code>Text Field</code>没有输入的情况</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text1: <span class="type">UITextField</span>!<span class="comment">// 操作数1控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text2: <span class="type">UITextField</span>!<span class="comment">// 操作数2控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> result: <span class="type">UILabel</span>!<span class="comment">// 结果控件</span></span><br><span class="line">    <span class="comment">// 计算</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> num1 = <span class="type">Int</span>(<span class="keyword">self</span>.text1.text!) ?? <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> num2 = <span class="type">Int</span>(<span class="keyword">self</span>.text2.text!) ?? <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> resultNum = num1 + num2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> resultString = <span class="string">"\(resultNum)"</span><span class="comment">//String(resultNum)</span></span><br><span class="line">        <span class="keyword">self</span>.result.text = resultString</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使输入框失去焦点</span></span><br><span class="line">        <span class="keyword">self</span>.text1.endEditing(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">self</span>.text2.endEditing(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清零</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.result.text = <span class="string">"0"</span></span><br><span class="line">        <span class="keyword">self</span>.text1.text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.text2.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-制作图片浏览器"><a href="#2-3-制作图片浏览器" class="headerlink" title="2.3    制作图片浏览器"></a>2.3    制作图片浏览器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>UILable</code>、<code>UIButton</code>、<code>UIImageView</code> 搭建一个图片浏览器的结构，并通过字典数组完成它的业务逻辑，实现浏览趣味图片的功能。</p>
<ul>
<li>切换按钮的不同<code>State Config</code>要分别进行设置</li>
<li>通过设置按钮控件的<code>enabled</code>属性设置按钮是否可点击</li>
<li>图片资源通过<code>plist</code>存储</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%888.59.20.png" alt="Alt text"><br><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *leftBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *rightBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> index;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSArray</span> *imageDicts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)leftBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index--;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)rightBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取存储图片的数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 存储图片的数组（字典数组）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)imageDicts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_imageDicts.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"imageData"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        _imageDicts = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"still"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _imageDicts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  切换图片</span><br><span class="line"> *</span><br><span class="line"> *  @param isAdd 是否向后(右)翻</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) btnClickChange: (<span class="built_in">BOOL</span>) isAdd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), <span class="keyword">self</span>.imageDicts.count]);</span><br><span class="line">    <span class="keyword">self</span>.topLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%lu"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), (<span class="keyword">unsigned</span> <span class="keyword">long</span>)<span class="keyword">self</span>.imageDicts.count];</span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = <span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"description"</span>];</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"name"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.leftBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">0</span>);<span class="comment">// 左边按钮的状态</span></span><br><span class="line">    <span class="keyword">self</span>.rightBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">4</span>);<span class="comment">// 右边按钮的状态</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-LOL英雄展示"><a href="#2-4-LOL英雄展示" class="headerlink" title="2.4    LOL英雄展示"></a>2.4    LOL英雄展示</h2><blockquote>
<p><strong>说明：</strong>通过<code>UITableView</code>和<code>plist</code>数据文件，搭建一个LOL英雄展示界面。</p>
<ul>
<li><code>UITableView</code>需要通过右键菜单设置<code>dataSource</code>和<code>delegate</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%889.29.01.png" alt="Alt text"></li>
<li><code>ViewController</code>要采纳相应的协议（<code>UITableViewDataSource</code>,<code>UITableViewDelegate</code>）：通过采纳相应的协议实现对<code>TableView</code>的中的<code>cell</code>的创建工作</li>
<li>通过使用<code>JKHero</code>类封装<code>plist</code>数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%8810.43.32.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="2-4-1-数据模版"><a href="#2-4-1-数据模版" class="headerlink" title="2.4.1    数据模版"></a>2.4.1    数据模版</h3><p><em>JKHero.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKHero</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 成员属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKHero.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKHero</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="comment">//        self.icon = [dict[@"icon"] copy];</span></span><br><span class="line"><span class="comment">//        self.name = [dict[@"name"] copy];</span></span><br><span class="line"><span class="comment">//        self.intro = [dict[@"intro"] copy];</span></span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];<span class="comment">// 利用 kvc</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-采纳协议"><a href="#2-4-2-采纳协议" class="headerlink" title="2.4.2    采纳协议"></a>2.4.2    采纳协议</h3><blockquote>
<p><strong>说明：</strong>通过扩展采纳协议。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *heros;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取英雄列表数据(懒加载)</span><br><span class="line"> *</span><br><span class="line"> *  @return JKHero类型的可变数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *) heros</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_heros) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"heros"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKHero *hero = [JKHero heroWithDict:dict];</span><br><span class="line">            [arrayM addObject:hero];</span><br><span class="line">        &#125;</span><br><span class="line">        _heros = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _heros;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - UITableViewDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少行</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.heros.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组默认有多少行(可以不实现，默认就是1)</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView sectionForSectionIndexTitle:(<span class="built_in">NSString</span> *)title atIndex:(<span class="built_in">NSInteger</span>)index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cell的高度</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建tableView中的所有cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"heroCell"</span>;</span><br><span class="line">    <span class="comment">// 创建cell</span></span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置cell的样式风格</span></span><br><span class="line">    cell.accessoryType = <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>;</span><br><span class="line">    <span class="comment">// 设置cell内容</span></span><br><span class="line">    JKHero *hero = <span class="keyword">self</span>.heros[indexPath.row];</span><br><span class="line">    cell.textLabel.text = hero.name;</span><br><span class="line">    cell.detailTextLabel.text = hero.intro;</span><br><span class="line">    cell.detailTextLabel.textColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:hero.icon];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏状态栏</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersStatusBarHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-5-Face-人脸识别技术入门"><a href="#2-5-Face-人脸识别技术入门" class="headerlink" title="2.5    Face++人脸识别技术入门"></a>2.5    Face++人脸识别技术入门</h2><blockquote>
<p><strong>注意：</strong>课程中的演示程项目是<code>Android</code>项目！</p>
</blockquote>
<h3 id="2-5-1-本课概要"><a href="#2-5-1-本课概要" class="headerlink" title="2.5.1    本课概要"></a>2.5.1    本课概要</h3><h4 id="2-5-1-1-Face-公司简介"><a href="#2-5-1-1-Face-公司简介" class="headerlink" title="2.5.1.1    Face++公司简介"></a>2.5.1.1    Face++公司简介</h4><blockquote>
<p><strong>网址：</strong><a href="http://www.faceplusplus.com.cn/" target="_blank" rel="external">http://www.faceplusplus.com.cn/</a></p>
</blockquote>
<ul>
<li>北京旷视科技有限公司（Face++）创立于2011年，是一家专注于机器视觉和深度学习的科技创业公司。</li>
<li>北京旷视科技旗下的Face++人脸识别云平台，是世界最大的人脸识别技术云平台。服务超过2万的开发者，日调用超过2百万次，积累人脸数据超过10亿张。</li>
<li>北京旷世科技先后获得联想创投的天使投资，和创新工场李开复博士的A轮投资。并获得2012年黑马创业大赛全国总冠军。</li>
</ul>
<h4 id="2-5-1-2-Face-核心技术简介"><a href="#2-5-1-2-Face-核心技术简介" class="headerlink" title="2.5.1.2 Face++核心技术简介"></a>2.5.1.2 Face++核心技术简介</h4><ul>
<li>旷视科技旗下Face++平台是世界最大的人脸识别技术云平台，提供包括人脸检测、人脸分析、人脸识别、人脸搜索等全套核心技术。</li>
<li>Face++的人脸技术居世界领先地位。其中，人脸检测技术获<code>FDDB</code>评测世界第一，人脸关键点技术获300-W评测世界第一，人脸识别技术获LFW评测世界第一。</li>
<li>Face++已搭建起世界领先的大数据深度学习（deep learning）技术引擎，可以提供人脸技术以外先进的视觉技术。其深度学习引擎可以和<code>Google</code>、<code>Facebook</code>形成强有力竞争。</li>
<li>旷视科技拥有自己独立的知识产权，有多项国内国外专利在申。</li>
</ul>
<h5 id="人脸检测和追踪"><a href="#人脸检测和追踪" class="headerlink" title="人脸检测和追踪"></a>人脸检测和追踪</h5><ul>
<li>Face++人脸检测技术在世界权威<code>FDDB</code>测试集上排名世界第一</li>
<li>Face++人脸检测技术针对移动和嵌入式设备做过多项性能优化，检测率高、内存消耗小、模型小，最小可稳定检测16x16大小的人脸<h5 id="Face-人脸关键点定位"><a href="#Face-人脸关键点定位" class="headerlink" title="Face++人脸关键点定位"></a>Face++人脸关键点定位</h5></li>
<li>Face++人脸关键点定位技术在世界权威300-W测试集上排名世界第一</li>
<li>Face++人脸关键点定位提供5点，23点，83点等多个版本，对移动和嵌入式设备做过多项性能优化<h5 id="Face-人脸属性分析"><a href="#Face-人脸属性分析" class="headerlink" title="Face++人脸属性分析"></a>Face++人脸属性分析</h5></li>
<li>Face++ 人脸属性分析可以分析出性别、年龄、种族、情绪，是否佩戴眼镜</li>
<li>Face++性别、种族、情绪、眼镜分析精确度均在95%以上，年龄准确度平均误差在5岁范围内<h5 id="Face-人脸1-1识别技术"><a href="#Face-人脸1-1识别技术" class="headerlink" title="Face++人脸1:1识别技术"></a>Face++人脸1:1识别技术</h5></li>
<li>Face++人脸1:1验证技术已被广泛应用于帐号登录、身份验证等服务中，被联想、神州智联等大客户使用。在千分之一的误检率情况下，通过率超过70%<h5 id="Face-人脸1-N识别技术"><a href="#Face-人脸1-N识别技术" class="headerlink" title="Face++人脸1:N识别技术"></a>Face++人脸1:N识别技术</h5></li>
<li>Face++人脸识别技术在世界最著名<code>LFW</code>评测中排名世界第一，取到97.72%的准确度，力压<code>Facebook</code><h5 id="Face-人脸大规模搜索"><a href="#Face-人脸大规模搜索" class="headerlink" title="Face++人脸大规模搜索"></a>Face++人脸大规模搜索</h5></li>
<li>Face++人脸大规模搜索技术被奇虎360、世纪佳缘等大客户使用，可以用不超过4字节表示一张人脸，千万级别图片搜索可达0.1ms响应速度</li>
</ul>
<h4 id="2-5-1-3-Face-技术使用场景介绍"><a href="#2-5-1-3-Face-技术使用场景介绍" class="headerlink" title="2.5.1.3    Face++技术使用场景介绍"></a>2.5.1.3    Face++技术使用场景介绍</h4><ul>
<li>相机和相册类应用</li>
<li>电子商务和广告营销类</li>
<li>游戏类应用</li>
<li>人脸搜索</li>
</ul>
<h5 id="相机和广告"><a href="#相机和广告" class="headerlink" title="相机和广告"></a>相机和广告</h5><ul>
<li>Face++ 已经为美图秀秀、相机360等移动应用广告厂商提供了人脸检测、人脸追踪以及人脸关键点定位技术，通过这些技术移动应用可以在相机和相册中快速得定为人脸的位置以及五官的位置，为下一步的美化做提前准备。</li>
<li>通过Face++所能提供的人脸属性分析，包括年龄、性别、种族以及微笑程度的判断，可以更好地评估电子商务、广告营销类的用户群体和这些群体所带有的属性。</li>
</ul>
<h5 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h5><ul>
<li>现有的移动设备大多都带有前置摄像头，那我们可以通过这些前置摄像头以及Face++ 所能提供的人脸检测和追踪技术，快速定位人脸以及人脸位置的变化。通过具体实际人脸的位置变化来操控游戏中的人物的位置变化。</li>
</ul>
<h5 id="人脸搜索和人脸登录"><a href="#人脸搜索和人脸登录" class="headerlink" title="人脸搜索和人脸登录"></a>人脸搜索和人脸登录</h5><ul>
<li>Face++已经为360搜索和世纪佳缘提供了此项技术，可以在千万级的会员库中快速准确地定位到具体的某个人以及与他相似的人</li>
<li>Face++已经为联想视频通话软件－－友约和神州智联提供了此项技术，可以瞬间验证使用者的身份是否属实。</li>
</ul>
<h3 id="2-5-2-Face-介绍"><a href="#2-5-2-Face-介绍" class="headerlink" title="2.5.2    Face++介绍"></a>2.5.2    Face++介绍</h3><h3 id="2-5-3-线上API分析"><a href="#2-5-3-线上API分析" class="headerlink" title="2.5.3    线上API分析"></a>2.5.3    线上API分析</h3><blockquote>
<p><strong>说明：</strong><a href="http://www.faceplusplus.com.cn/api-overview/" target="_blank" rel="external">http://www.faceplusplus.com.cn/api-overview/</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>用途</th>
<th>依赖的数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>face</td>
<td>基本属性</td>
<td></td>
<td></td>
</tr>
<tr>
<td>faceset</td>
<td>face集合</td>
<td>搜索集合中的face</td>
<td><code>faceid</code>、<code>faceset_name</code>、<code>face</code>、<code>set_id</code></td>
</tr>
<tr>
<td>person</td>
<td>人</td>
<td>验证</td>
<td><code>faceid</code>、 <code>person_name(person_id)</code></td>
</tr>
<tr>
<td>group</td>
<td>人群</td>
<td>匹配</td>
<td><code>identity</code>、 <code>url(ing)</code>、 <code>group_name(group_id)</code></td>
</tr>
</tbody>
</table>
<h3 id="2-5-4-离线API的下载和配置"><a href="#2-5-4-离线API的下载和配置" class="headerlink" title="2.5.4    离线API的下载和配置"></a>2.5.4    离线API的下载和配置</h3><blockquote>
<p><strong>说明：</strong>离线API主要用于在客户端提取图片的信息，从而与线上服务器配合完成一些处理。<br><strong>注意：</strong>在<code>Face++</code>官网创建自己的应用后才能下载到相应的离线<code>SDK</code></p>
<blockquote>
<p><strong>我的学习应用：</strong><a href="http://www.faceplusplus.com.cn/uc/app/home?app_id=42841" target="_blank" rel="external">http://www.faceplusplus.com.cn/uc/app/home?app_id=42841</a></p>
</blockquote>
</blockquote>
<h3 id="2-5-5-Face-实例编写"><a href="#2-5-5-Face-实例编写" class="headerlink" title="2.5.5    Face++实例编写"></a>2.5.5    Face++实例编写</h3><h3 id="2-5-6-Face-人脸识别总结语"><a href="#2-5-6-Face-人脸识别总结语" class="headerlink" title="2.5.6    Face++人脸识别总结语"></a>2.5.6    Face++人脸识别总结语</h3><h2 id="2-6-应用管理"><a href="#2-6-应用管理" class="headerlink" title="2.6    应用管理"></a>2.6    应用管理</h2><h3 id="2-6-1-项目讲解和模型搭建"><a href="#2-6-1-项目讲解和模型搭建" class="headerlink" title="2.6.1    项目讲解和模型搭建"></a>2.6.1    项目讲解和模型搭建</h3><ol>
<li>创建项目</li>
<li>设置<code>Storyboard</code>(设置<code>Size</code>为<code>iPhone 3.5-inch</code>，取消<code>Use Auto Layout</code>和<code>Use Size Classes</code>)</li>
<li>导入素材（图片和<code>plist</code>文件）</li>
<li>为<code>plist</code>文件创建<code>数据模型</code><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><em>JKAppInfo.h</em></li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKAppInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;<span class="comment">// 通过定义为私有属性使其可在 image 方法中被访问</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 image 的set(因为 通过 @property 创建的 image 是只读的，因此不会自动生成 get)</span></span><br><span class="line"><span class="comment">// 注意：将访问 image 自定义为访问 _image</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-Xib自定义视图"><a href="#2-6-2-Xib自定义视图" class="headerlink" title="2.6.2    Xib自定义视图"></a>2.6.2    Xib自定义视图</h3><ol>
<li>创建<code>JKAppView</code>（继承<code>UIView</code>）</li>
<li>创建<code>xib</code>文件（<code>iOS</code>-&gt;<code>User Interface</code>-&gt;<code>Empty</code>）</li>
</ol>
<ul>
<li><code>Size</code>：Freeform(然后宽和高就可以设置了)</li>
</ul>
<ol>
<li>在<code>xib</code>中创建需要的展现单个<code>app</code>信息的控件</li>
<li>在<code>xib</code>文件和<code>JKAppView</code>类之间创建关联</li>
<li>完善<code>JKAppView</code>类</li>
</ol>
<h4 id="2-6-2-1-xib视图文件"><a href="#2-6-2-1-xib视图文件" class="headerlink" title="2.6.2.1    xib视图文件"></a>2.6.2.1    xib视图文件</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-02%20%E4%B8%8A%E5%8D%8812.11.15.png" alt="Alt text"></p>
<h4 id="2-6-2-2-绑定的类-UIView"><a href="#2-6-2-2-绑定的类-UIView" class="headerlink" title="2.6.2.2    绑定的类(UIView)"></a>2.6.2.2    绑定的类(<code>UIView</code>)</h4><p><em>JKView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKAppInfo</span>;</span></span><br><span class="line"><span class="comment">//-------协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">JKAppViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">// 下载按钮被点击的响应函数</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性：一项app信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKAppInfo *appInfo;</span><br><span class="line"><span class="comment">// 属性：代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;JKAppViewDelegate&gt; delegate;<span class="comment">// 要求代理对象采纳JKAppViewDelegate协议</span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)appView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="comment">//------ 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *iconView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *nameLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppView</span></span></span><br><span class="line">- (<span class="keyword">IBAction</span>)downloadBtnOnClick:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 调用代理对象的”点击下载按钮“的响应函数</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(downloadClickWithBtn:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate downloadClickWithBtn:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂构造</span></span><br><span class="line">+ (instancetype)appView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从指定nib文件中获取目标View控件（是唯一的，所以可以用lastObject）</span></span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle]loadNibNamed:<span class="string">@"JKAppView"</span> owner:<span class="literal">nil</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为View控件初始化内部信息</span></span><br><span class="line">- (<span class="keyword">void</span>)setAppInfo:(JKAppInfo *)appInfo</span><br><span class="line">&#123;</span><br><span class="line">    _appInfo = appInfo;</span><br><span class="line">    <span class="keyword">self</span>.iconView.image = appInfo.image;</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.text = appInfo.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-3-创建自定义视图数组"><a href="#2-6-3-创建自定义视图数组" class="headerlink" title="2.6.3    创建自定义视图数组"></a>2.6.3    创建自定义视图数组</h3><blockquote>
<p><strong>说明：</strong>在<code>ViewController</code>中初始化<code>JKAppView</code>数组</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据plist初始化所有的小view（懒加载）</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)appViews</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_appViews) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"app"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKAppInfo *appInfo = [JKAppInfo appInfoWithDict:dict];</span><br><span class="line">            JKAppView *appView = [JKAppView appView];</span><br><span class="line">            appView.appInfo = appInfo;</span><br><span class="line">            appView.delegate = <span class="keyword">self</span>;</span><br><span class="line">            </span><br><span class="line">            [arrayM addObject:appView];</span><br><span class="line">        &#125;</span><br><span class="line">        _appViews = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _appViews;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-4-九宫格布局展示"><a href="#2-6-4-九宫格布局展示" class="headerlink" title="2.6.4    九宫格布局展示"></a>2.6.4    九宫格布局展示</h3><blockquote>
<p><strong>说明：</strong>九宫格布局开发</p>
<ol>
<li>宏定义界面布局的相关参数</li>
<li>确定间距</li>
<li>为确定每个下载项的位置（通过设置中心点坐标）</li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenH [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="comment">// 每个下载项的高度</span></span><br><span class="line"><span class="meta">#define kAppViewH [JKAppView appView].bounds.size.height</span></span><br><span class="line"><span class="comment">// 每个下载项的宽度</span></span><br><span class="line"><span class="meta">#define kAppViewW [JKAppView appView].bounds.size.width</span></span><br><span class="line"><span class="comment">// 分3列</span></span><br><span class="line"><span class="meta">#define kTotaoCol 3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 间距</span></span><br><span class="line">    <span class="built_in">CGFloat</span> margin = (kScreenW - kTotaoCol * kAppViewW) / (kTotaoCol + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 确定每个自定义视图在父视图中的位置并添加到父视图中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.appViews.count; i++) &#123;</span><br><span class="line">        JKAppView *appView = <span class="keyword">self</span>.appViews[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> col = i % kTotaoCol;</span><br><span class="line">        <span class="keyword">int</span> row = i / kTotaoCol;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGFloat</span> centerX = (margin + kAppViewW * <span class="number">0.5</span>) + (margin + kAppViewW) * col;</span><br><span class="line">        <span class="built_in">CGFloat</span> centerY = (margin + kAppViewH * <span class="number">0.5</span>) + (margin + kAppViewH) * row;</span><br><span class="line">        <span class="comment">// 设置中心点</span></span><br><span class="line">        appView.center = <span class="built_in">CGPointMake</span>(centerX, centerY);</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:appView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-5-点击效果分析与bug排除"><a href="#2-6-5-点击效果分析与bug排除" class="headerlink" title="2.6.5    点击效果分析与bug排除"></a>2.6.5    点击效果分析与bug排除</h3><blockquote>
<p><strong>说明：</strong>点击<code>下载</code>时弹出等待画面</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 获取要下载的应用的名字</span></span><br><span class="line">    JKAppView *appView = (JKAppView *)btn.superview;</span><br><span class="line">    <span class="built_in">NSString</span> *appName = appView.appInfo.name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建加载提示窗</span></span><br><span class="line">    <span class="built_in">UIActivityIndicatorView</span> *juhua = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleGray</span>];<span class="comment">// 样式</span></span><br><span class="line">    juhua.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 尺寸</span></span><br><span class="line">    [juhua startAnimating];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:juhua];<span class="comment">// 将提示窗添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 创建下载中文案</span></span><br><span class="line">    <span class="built_in">UILabel</span> *downloadLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">    downloadLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">10</span>, kScreenW, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    downloadLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    downloadLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    downloadLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@正在下载..."</span>, appName];</span><br><span class="line">    downloadLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">15.0</span>];</span><br><span class="line">    </span><br><span class="line">    downloadLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    downloadLabel.alpha = <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    [juhua addSubview:downloadLabel];<span class="comment">// 将文案添加到加载窗上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-延时操作与块动画"><a href="#2-6-6-延时操作与块动画" class="headerlink" title="2.6.6    延时操作与块动画"></a>2.6.6    延时操作与块动画</h3><blockquote>
<p><strong>说明：</strong>过一段时间以多线程的方式延时处理。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 4. 设置两秒钟后完成下载</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 加载窗停止转动，并且自动隐藏</span></span><br><span class="line">        [juhua stopAnimating];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 下载完成的提示</span></span><br><span class="line">        <span class="built_in">UILabel</span> *noteLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        noteLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">20</span>, kScreenW, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        noteLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        noteLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        noteLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@下载完成"</span>, appName];</span><br><span class="line">        </span><br><span class="line">        noteLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:noteLabel];</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 执行动画</span></span><br><span class="line">            noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            <span class="comment">// 动画完成后需要做的事情</span></span><br><span class="line">            btn.enabled = <span class="literal">NO</span>;</span><br><span class="line">            [btn setTitle:<span class="string">@"已下载"</span> forState: <span class="built_in">UIControlStateDisabled</span>];</span><br><span class="line">            [noteLabel removeFromSuperview];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-超级猜图"><a href="#2-7-超级猜图" class="headerlink" title="2.7    超级猜图"></a>2.7    超级猜图</h2><h3 id="2-7-1-效果展示与业务逻辑分析"><a href="#2-7-1-效果展示与业务逻辑分析" class="headerlink" title="2.7.1    效果展示与业务逻辑分析"></a>2.7.1    效果展示与业务逻辑分析</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-04%2012.15.01.png" alt="Alt text"></p>
<h3 id="2-7-2-模型搭建"><a href="#2-7-2-模型搭建" class="headerlink" title="2.7.2    模型搭建"></a>2.7.2    模型搭建</h3><blockquote>
<p><strong>说明：</strong>创建对应<code>plist</code>文件的数据模型。</p>
<ol>
<li>视图控制器基本设置</li>
<li>导入相关素材（图片和<code>plist</code>）</li>
<li>创建对应<code>plist</code>文件的数据模型</li>
</ol>
</blockquote>
<p><em>JKQuestionInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKQuestionInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">// 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *answer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *options;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)doct;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKQuestionInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKQuestionInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为_image手动定义 get</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"questions"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">        [arrayM addObject:[<span class="keyword">self</span> questionWithDict:dict]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 保证每次调用该方法获取的都是全新的数组</span></span><br><span class="line">    <span class="keyword">return</span> [arrayM <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-3-Storyboard-布局-UI"><a href="#2-7-3-Storyboard-布局-UI" class="headerlink" title="2.7.3    Storyboard 布局 UI"></a>2.7.3    Storyboard 布局 UI</h3><blockquote>
<p><strong>技巧：</strong></p>
<ul>
<li>可以在<code>Storyboard</code>中为控件设置内边距</li>
<li>有时候用<code>Button</code>替代<code>ImageView</code>会更方便</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-05%20%E4%B8%8B%E5%8D%883.20.24.png" alt="Alt text"></p>
<h3 id="2-7-4-拖线与注释"><a href="#2-7-4-拖线与注释" class="headerlink" title="2.7.4    拖线与注释"></a>2.7.4    拖线与注释</h3><blockquote>
<p><strong>技巧：</strong>多个控件可以绑定同一个<code>action</code>。方式是<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_more.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">// 顶部索引情况 label</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topindexLabel;</span><br><span class="line"><span class="comment">// 图片描述</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 金币</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *coinBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *imgInsideBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *answerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备选的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *optionsView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录索引</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：帮助</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)helpBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：大图</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-5-创建模型数组与遮罩"><a href="#2-7-5-创建模型数组与遮罩" class="headerlink" title="2.7.5    创建模型数组与遮罩"></a>2.7.5    创建模型数组与遮罩</h3><blockquote>
<p><strong>说明：</strong>遮罩用来监听点<code>击屏幕任何地方</code>的事件。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取数据模型数组（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @return 模型数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _questions) &#123;</span><br><span class="line">        _questions = [JKQuestionInfo questions];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _questions;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取遮罩（懒加载），用来监听用户的点击行为</span><br><span class="line"> *</span><br><span class="line"> *  @return 遮罩</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">UIButton</span> *)cover</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _cover) &#123;</span><br><span class="line">        _cover = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 和最外层视图一样大</span></span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;</span><br><span class="line">        _cover.alpha = <span class="number">0.0</span>;<span class="comment">// 一开始隐藏遮罩：当透明度为0时，该遮罩不会存在于任何位置</span></span><br><span class="line">        _cover.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        <span class="comment">// 为遮罩注册点击事件</span></span><br><span class="line">        [_cover addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(imgBtnChangeOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:_cover];<span class="comment">// 把遮罩添加到视图中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-6-实现图片缩放"><a href="#2-7-6-实现图片缩放" class="headerlink" title="2.7.6    实现图片缩放"></a>2.7.6    实现图片缩放</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 1. 按钮：大图(拖线) 2. 遮罩（代码调用） 3. 图片本身（拖线）</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">    <span class="comment">// 放大图片</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="keyword">self</span>.cover.alpha) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> scaleX = kScreenW / imgW;<span class="comment">// 水平方向放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> scaleY = scaleX;<span class="comment">// 垂直方向上放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> translateY = <span class="keyword">self</span>.imgInsideBtn.frame.origin.y / scaleX;<span class="comment">// 垂直方向上的偏移（倍数）</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用块动画</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 显示遮罩</span></span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scaleX, scaleY);<span class="comment">// 放大</span></span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformTranslate</span>(<span class="keyword">self</span>.imgInsideBtn.transform, <span class="number">0</span>, translateY);<span class="comment">// 在现有的基础上向上移动</span></span><br><span class="line">        &#125;];</span><br><span class="line">        <span class="comment">// 将中间图片所在图层置顶</span></span><br><span class="line">        [<span class="keyword">self</span>.view bringSubviewToFront:<span class="keyword">self</span>.imgInsideBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 还原图片</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 图片还原事件</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.0</span>;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-7-下一题方法实现"><a href="#2-7-7-下一题方法实现" class="headerlink" title="2.7.7    下一题方法实现"></a>2.7.7    下一题方法实现</h3><blockquote>
<p><strong>说明：</strong>用户点击下一题按钮时界面做出相应的改变</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 索引自增（判断是否越界）</span></span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"INDEX == %D"</span>, <span class="keyword">self</span>.index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.index &gt;= <span class="keyword">self</span>.questions.count) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"恭喜过关！"</span>);</span><br><span class="line">        <span class="meta">#warning noCode</span></span><br><span class="line">        <span class="keyword">self</span>.index--;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出数据模型</span></span><br><span class="line">    JKQuestionInfo *question = <span class="keyword">self</span>.questions[<span class="keyword">self</span>.index];</span><br><span class="line">    <span class="comment">// 3. 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setupBaseInfo:question];</span><br><span class="line">    <span class="comment">// 4. 创建答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createAnswerBtns:question];</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - 私有方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置基本信息</span><br><span class="line"> *</span><br><span class="line"> *  @param question 问题的数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupBaseInfo: (JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 恢复（enable）optionView 的用户交互</span></span><br><span class="line">    <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// 改变顶部图片索引信息</span></span><br><span class="line">    <span class="keyword">self</span>.topindexLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, <span class="keyword">self</span>.index + <span class="number">1</span>, <span class="keyword">self</span>.questions.count];</span><br><span class="line">    <span class="comment">// 改变图片描述</span></span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = question.title;</span><br><span class="line">    <span class="comment">// 更换图片</span></span><br><span class="line">    [<span class="keyword">self</span>.imgInsideBtn setImage:question.image forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下一题按钮状态判断改变</span></span><br><span class="line">    <span class="keyword">self</span>.nextBtn.enabled = (<span class="keyword">self</span>.index != <span class="keyword">self</span>.questions.count - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-8-创建答案按钮"><a href="#2-7-8-创建答案按钮" class="headerlink" title="2.7.8    创建答案按钮"></a>2.7.8    创建答案按钮</h3><blockquote>
<p><strong>说明：</strong>设置基本信息时创建放置答案的一排按钮集合。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要计算的常量</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"><span class="meta">#define kAnswerBtnTitleColor [UIColor blackColor]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要计算的常量</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnW = <span class="number">35</span>;<span class="comment">// 按钮宽</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnH = <span class="number">35</span>;<span class="comment">// 按钮高</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kMarginBetweenBtns = <span class="number">10</span>;<span class="comment">// 按钮间距</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kOptionViewTotalCol = <span class="number">7</span>;<span class="comment">// 备选答案总列数</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTrueAddScore = <span class="number">200</span>;<span class="comment">// 猜对加分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kFalseDecreaseScore = <span class="number">-200</span>;<span class="comment">// 猜错减分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTipDecreaseScore = <span class="number">-200</span>;<span class="comment">// 亲求提示减分</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建放置答案的按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createAnswerBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 清空放置答案的按钮</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [btn removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 获取答案按钮的数量</span></span><br><span class="line">    <span class="built_in">NSInteger</span> answerBtnCount = question.answer.length;</span><br><span class="line">    <span class="comment">// 3. 创建放置答案的按钮</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerW = <span class="keyword">self</span>.answerView.bounds.size.width;<span class="comment">// 放答案的父容器宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerEdgeInset = (answerW - answerBtnCount * kBtnW - (answerBtnCount - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 放答案的父容器两侧内边距</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; answerBtnCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        <span class="built_in">CGFloat</span> btnX = answerEdgeInset + i * i * (kBtnW + kMarginBetweenBtns);<span class="comment">// 起点水平坐标</span></span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnX, <span class="number">0</span>, kBtnW, kBtnH);<span class="comment">// 设置frame</span></span><br><span class="line">        <span class="comment">// 设置背景图片</span></span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        <span class="comment">// 设置字体颜色</span></span><br><span class="line">        [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册点击事件</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick:) forControlEvents:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 添加到视图中</span></span><br><span class="line">        [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-9-创建备选答案按钮"><a href="#2-7-9-创建备选答案按钮" class="headerlink" title="2.7.9    创建备选答案按钮"></a>2.7.9    创建备选答案按钮</h3><blockquote>
<p><strong>说明：</strong>当<code>点击下一题</code>或<code>程序刚启动</code>时，需要设置备选答案按钮。<br><strong>技巧：</strong>以懒加载的方式创建备选按钮，这样就不用每次都重新创建备选按钮。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">self</span>.index = <span class="number">-1</span>;</span><br><span class="line">    [<span class="keyword">self</span> nextBtnOnClick];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置备选字按钮（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createOptionBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 备选字总个数</span></span><br><span class="line">    <span class="keyword">int</span> optionsCount = question.options.count;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 没有备选字按钮就创建</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.optionsView.subviews.count != optionsCount) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> optionW = <span class="keyword">self</span>.optionsView.bounds.size.width;<span class="comment">// 备选字按钮父控件宽度</span></span><br><span class="line">        <span class="built_in">CGFloat</span> optionEdgeInset = (optionW - kOptionViewTotalCol * kBtnW - (kOptionViewTotalCol - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 父控件左右内边距</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">            <span class="keyword">int</span> col = i % kOptionViewTotalCol;<span class="comment">// 所在列</span></span><br><span class="line">            <span class="keyword">int</span> row = i / kOptionViewTotalCol;<span class="comment">// 所在行</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CGFloat</span> btnX = optionEdgeInset + (kBtnW + kMarginBetweenBtns) * col;<span class="comment">// 水平坐标</span></span><br><span class="line">            <span class="built_in">CGFloat</span> btnY = kMarginBetweenBtns + (kBtnH + kMarginBetweenBtns) * row;<span class="comment">// 垂直坐标</span></span><br><span class="line">            <span class="comment">// 设置frame</span></span><br><span class="line">            btn.frame = <span class="built_in">CGRectMake</span>(btnX, btnY, kBtnW, kBtnH);</span><br><span class="line">            <span class="comment">// 设置背景图</span></span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">            <span class="comment">// 设置字颜色</span></span><br><span class="line">            [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            <span class="comment">// 注册点击事件</span></span><br><span class="line">            [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">            <span class="comment">// 添加到视图</span></span><br><span class="line">            [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新备选字</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *optionBtn = <span class="keyword">self</span>.optionsView.subviews[i];</span><br><span class="line">            [optionBtn setTitle:question.options[i] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-10-答案按钮点击"><a href="#2-7-10-答案按钮点击" class="headerlink" title="2.7.10    答案按钮点击"></a>2.7.10    答案按钮点击</h3><blockquote>
<p><strong>说明：</strong> 点击组成答案的按钮，该按钮清除其文字，而相应的备选答案按钮会重新出现该文字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-11-备选按钮点击"><a href="#2-7-11-备选按钮点击" class="headerlink" title="2.7.11    备选按钮点击"></a>2.7.11    备选按钮点击</h3><blockquote>
<p><strong>说明：</strong>被点击的备选按钮会清除其文字，并将该文字写到答案按钮中。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-12-提示点击方法的实现"><a href="#2-7-12-提示点击方法的实现" class="headerlink" title="2.7.12    提示点击方法的实现"></a>2.7.12    提示点击方法的实现</h3><blockquote>
<p><strong>说明：</strong>提示按钮每被点击一次，答案按钮就回为答案生成一个字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 清空答案按钮的文字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [<span class="keyword">self</span> answerBtnOnClick:answerBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出实际答案中的第一个字</span></span><br><span class="line">    <span class="built_in">NSString</span> *answer = [<span class="keyword">self</span>.questions[<span class="keyword">self</span>.index] answer];</span><br><span class="line">    <span class="built_in">NSString</span> *firstWord = [answer substringToIndex:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 3. 模拟点击optionView中第一个正确的按钮，扣分</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([optionBtn.currentTitle isEqualToString:firstWord]) &#123;</span><br><span class="line">            [<span class="keyword">self</span> optionBtnOnClick:optionBtn];</span><br><span class="line">            [<span class="keyword">self</span> coinChange:kTipDecreaseScore];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-国家选择"><a href="#2-8-国家选择" class="headerlink" title="2.8    国家选择"></a>2.8    国家选择</h2><h3 id="2-8-1-UIPickerView与数据模型的创建"><a href="#2-8-1-UIPickerView与数据模型的创建" class="headerlink" title="2.8.1    UIPickerView与数据模型的创建"></a>2.8.1    <code>UIPickerView</code>与<code>数据模型</code>的创建</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>导入素材（<code>jpg</code>格式的图片不能放在<code>Assets.xcassets</code>中管理）</li>
<li>创建自定义<code>UIView</code>类:<code>JKCountryInfo</code></li>
<li><code>ViewController</code>采纳<code>UIPickerView</code></li>
</ol>
<p><strong>注意：</strong><code>gif</code>格式的图片不能放在<code>Assets.xcassets</code>。</p>
</blockquote>
<h4 id="2-8-1-1-UIPickerView"><a href="#2-8-1-1-UIPickerView" class="headerlink" title="2.8.1.1    UIPickerView"></a>2.8.1.1    <code>UIPickerView</code></h4><blockquote>
<p><strong>说明：</strong>类似<code>TableView</code>，可以通过让普通<code>ViewControll</code>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code>实现</p>
<ol>
<li>通过拖动建立<code>PickerView</code>控件和<code>ViewController</code>类之间的关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.29.09.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-1-2-数据模型的创建"><a href="#2-8-1-2-数据模型的创建" class="headerlink" title="2.8.1.2     数据模型的创建"></a>2.8.1.2     数据模型的创建</h4><p><em>JKContryInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;<span class="comment">// 国家名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *icon;<span class="comment">// 国旗（图片名）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 工厂方法</span></span><br><span class="line">+ (instancetype) CountryWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContryInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryInfo</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)CountryWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-2-自定义视图完善实例"><a href="#2-8-2-自定义视图完善实例" class="headerlink" title="2.8.2    自定义视图完善实例"></a>2.8.2    自定义视图完善实例</h3><blockquote>
<p><strong>说明：</strong>自定义<code>PickerView</code>中的每一行采用的视图。</p>
</blockquote>
<h4 id="2-8-2-1-创建xib文件"><a href="#2-8-2-1-创建xib文件" class="headerlink" title="2.8.2.1    创建xib文件"></a>2.8.2.1    创建<code>xib</code>文件</h4><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>创建的<code>xib</code>文件和要绑定的<code>UIVIew</code>的文件名要一致。</li>
</ol>
<p><strong>注意：</strong>待对应的<code>UIView</code>子类创建完毕后，手动绑定之。</p>
</blockquote>
<p><em>JKCountryFlagView.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.24.35.png" alt="Alt text"></p>
<h4 id="2-8-2-2-创建JKCountryFlagView类"><a href="#2-8-2-2-创建JKCountryFlagView类" class="headerlink" title="2.8.2.2    创建JKCountryFlagView类"></a>2.8.2.2    创建<code>JKCountryFlagView</code>类</h4><blockquote>
<p><strong>说明：</strong>该类用来绑定上面创建的<code>xib</code>文件。</p>
</blockquote>
<p><em>JKCountryFlagView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKCountryInfo</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryFlagView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IBOutlet 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKCountryInfo *countryModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器(工厂方法)</span></span><br><span class="line">+ (instancetype)countryView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKCountryFlagView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryFlagView</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)countryView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="string">@"JKCountryFlagView"</span> owner:<span class="keyword">self</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setCountryModel:(JKCountryInfo *)countryModel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_countryModel != countryModel) &#123;</span><br><span class="line">        _countryModel = countryModel;</span><br><span class="line">        <span class="keyword">self</span>.name.text = _countryModel.name;</span><br><span class="line">        <span class="keyword">self</span>.flag.image = [<span class="built_in">UIImage</span> imageNamed:_countryModel.icon];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">54</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-2-3-完善ViewController"><a href="#2-8-2-3-完善ViewController" class="headerlink" title="2.8.2.3    完善ViewController"></a>2.8.2.3    完善<code>ViewController</code></h4><blockquote>
<p><strong>说明：</strong>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"path:%@"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"array:%@"</span>, _dataArray);</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDelegate</span></span><br><span class="line"><span class="comment">// 定义详情视图的创建过程</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView viewForRow:(<span class="built_in">NSInteger</span>)row forComponent:(<span class="built_in">NSInteger</span>)component reusingView:(<span class="built_in">UIView</span> *)view</span><br><span class="line">&#123;</span><br><span class="line">    JKCountryFlagView *countryView = (JKCountryFlagView *)view;</span><br><span class="line">    <span class="keyword">if</span> (!countryView) &#123;</span><br><span class="line">        countryView = [JKCountryFlagView countryView];</span><br><span class="line">    &#125;</span><br><span class="line">    countryView.countryModel = <span class="keyword">self</span>.dataArray[row];</span><br><span class="line">    <span class="keyword">return</span> countryView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义行高</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView rowHeightForComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [JKCountryFlagView rowHeight];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-图片自动播放"><a href="#2-9-图片自动播放" class="headerlink" title="2.9    图片自动播放"></a>2.9    图片自动播放</h2><h3 id="2-9-1-创建UIScrollView和UIPageControl"><a href="#2-9-1-创建UIScrollView和UIPageControl" class="headerlink" title="2.9.1    创建UIScrollView和UIPageControl"></a>2.9.1    创建<code>UIScrollView</code>和<code>UIPageControl</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><code>ViewController</code>采纳<code>UIScrollViewDelegate</code></li>
<li>创建<code>UIScrollView</code></li>
<li>创建<code>UIScrollPageControl</code></li>
</ol>
</blockquote>
<h3 id="2-9-2-定时器与代理方法调用"><a href="#2-9-2-定时器与代理方法调用" class="headerlink" title="2.9.2    定时器与代理方法调用"></a>2.9.2    定时器与代理方法调用</h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><strong>封装一些相关的方法：</strong>清除<code>timer</code>、添加<code>timer</code>等</li>
<li><strong>遵守协议<code>UIScrollViewDelegate</code>：</strong>定义滑动前、中、后需要的操作</li>
</ol>
</blockquote>
<h3 id="2-9-3-代码摘要"><a href="#2-9-3-代码摘要" class="headerlink" title="2.9.3    代码摘要"></a>2.9.3    代码摘要</h3><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width// 屏幕高度</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> kImgCount = <span class="number">10</span>;<span class="comment">// 图片总数</span></span><br><span class="line"><span class="built_in">CGFloat</span> scrollY = <span class="number">20</span>;<span class="comment">// 上边距</span></span><br><span class="line"><span class="built_in">CGFloat</span> pageCtrlWidth = <span class="number">200</span>;<span class="comment">// 滚动指示器宽度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//--------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIPageControl</span> *pageCtrl;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initScrollView];</span><br><span class="line">    [<span class="keyword">self</span> initPageControl];</span><br><span class="line">    [<span class="keyword">self</span> addTimer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIScrollView</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initScrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">    <span class="comment">// 设置代理对象</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 初始化所有滚动的屏的内容</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kImgCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span> *imgview = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(kScreenWidth * i, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">        imgview.image = [<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"huoying%d"</span>, i + <span class="number">1</span>]];</span><br><span class="line">        [<span class="keyword">self</span>.scrollView addSubview:imgview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(kScreenWidth * kImgCount, kScreenHeight - scrollY);</span><br><span class="line">    <span class="keyword">self</span>.scrollView.pagingEnabled = <span class="literal">YES</span>;<span class="comment">// 使滚动操作停止在恰当的位置</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIPageControl</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPageControl</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl = [[<span class="built_in">UIPageControl</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>((kScreenWidth - pageCtrlWidth) / <span class="number">2</span>, kScreenHeight - scrollY, pageCtrlWidth, scrollY)];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.numberOfPages = kImgCount;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.pageIndicatorTintColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPageIndicatorTintColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span>.view insertSubview:<span class="keyword">self</span>.pageCtrl aboveSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  自动滚动到下一屏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)nextPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = <span class="keyword">self</span>.pageCtrl.currentPage;</span><br><span class="line">    page++;</span><br><span class="line">    <span class="keyword">if</span> (page == kImgCount) &#123;</span><br><span class="line">        page = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGPoint</span> point = <span class="built_in">CGPointMake</span>(kScreenWidth * page, <span class="number">0</span>);</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:point animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addTimer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 timer (interval)</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(nextPage) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  清除延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeTimer</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma  mark -UIScrollViewDelegae</span></span><br><span class="line"><span class="comment">// 滑动前：清除计时器</span></span><br><span class="line">- (<span class="keyword">void</span>) scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> removeTimer];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"BeginDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动中：更改指示器</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = scrollView.contentOffset.x / kScreenWidth + <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPage = page;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动后：开始下一次互动倒计时</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 2秒钟后重新开始自动滚屏</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> addTimer];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"EndDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-QQ列表展示"><a href="#2-10-QQ列表展示" class="headerlink" title="2.10    QQ列表展示"></a>2.10    QQ列表展示</h2><blockquote>
<p><strong>说明：</strong>该项目使用<code>MVC</code>模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_qq.gif" alt="Alt text|200x400"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-16%20%E4%B8%8A%E5%8D%889.34.22.png" alt="Alt text|400x300"></p>
<p><strong>注意：</strong><code>Xcode</code>工程中的文件夹有两种：<code>黄色</code>的为辅助进行代码管理的“伪文件夹”，<code>蓝色</code>的为真正的文件夹。</p>
</blockquote>
<h3 id="2-10-1-模型搭建"><a href="#2-10-1-模型搭建" class="headerlink" title="2.10.1    模型搭建"></a>2.10.1    模型搭建</h3><blockquote>
<p><strong>说明：</strong>需要两个数据模型，<code>JKGroupModel</code>（好友所在分组）和<code>JKFriendsModel</code>（好友）</p>
<ol>
<li>导入<code>plist</code></li>
<li>创建数据模型</li>
</ol>
</blockquote>
<h4 id="2-10-1-1-JKGroupModel"><a href="#2-10-1-1-JKGroupModel" class="headerlink" title="2.10.1.1    JKGroupModel"></a>2.10.1.1    <code>JKGroupModel</code></h4><blockquote>
<p><strong>说明：</strong>好友分组的数据模型</p>
</blockquote>
<p><em>JKGroupModel</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKGroupModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKGroupModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> <span class="keyword">self</span>.friends) &#123;</span><br><span class="line">            JKFriendsModel *model = [JKFriendsModel friendWithDict:dict];</span><br><span class="line">            [muArray addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.friends = muArray;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)GroupWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-1-2-JKFriendsModel"><a href="#2-10-1-2-JKFriendsModel" class="headerlink" title="2.10.1.2    JKFriendsModel"></a>2.10.1.2    <code>JKFriendsModel</code></h4><blockquote>
<p><strong>说明：</strong>好友的数据模型。</p>
</blockquote>
<p><em>JKFriendsModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKFriendsModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKFriendsModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-创建UITableView"><a href="#2-10-2-创建UITableView" class="headerlink" title="2.10.2    创建UITableView"></a>2.10.2    创建<code>UITableView</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li>在<code>AppDelegate</code>中创建二级导航（通过<code>UINavigationController</code>）</li>
<li>在<code>ListTableViewController</code>完善<code>TableView</code></li>
</ol>
</blockquote>
<p><em>Model/AppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    <span class="comment">// 创建 window</span></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建 TableViewController</span></span><br><span class="line">    ListTableViewController *listVC = [[ListTableViewController alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 UINavigationController(需要指定导航控制器控制的是那个控制器)</span></span><br><span class="line">    <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc] initWithRootViewController:listVC];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将导航控制器设置为 window 的 rootViewController（这就是所谓的二级视图）</span></span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = navCtrl;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];<span class="comment">// 将该window置顶并显示出来</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-自定义头视图"><a href="#2-10-3-自定义头视图" class="headerlink" title="2.10.3    自定义头视图"></a>2.10.3    自定义头视图</h3><blockquote>
<p><strong>说明：</strong><code>MVC</code>的<code>View</code>部分</p>
<ul>
<li>不创建<code>xib</code>文件</li>
<li>完全通过代码创建视图</li>
<li>继承<code>UITableViewHeaderFooterView</code></li>
</ul>
<p><strong>注意：</strong>如果头视图被自定义了，则需要在<code>viewDidLoad</code>中重新设置其高度。</p>
</blockquote>
<h4 id="2-10-3-1-View部分"><a href="#2-10-3-1-View部分" class="headerlink" title="2.10.3.1    View部分"></a>2.10.3.1    <code>View</code>部分</h4><p><em>View/HeaderView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 协议（为代理对象定义协议）</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">HeaderViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeaderView</span> : <span class="title">UITableViewHeaderFooterView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;HeaderViewDelegate&gt;delegate;<span class="comment">// 代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKGroupModel *groupModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>View/HeadView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *_arrowBtn;<span class="comment">// 三角按钮（展开和关闭）</span></span><br><span class="line">    <span class="built_in">UILabel</span> *_label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"header"</span>;</span><br><span class="line">    <span class="comment">// 尝试获取该 UITableViewHeaderFooterView</span></span><br><span class="line">    HeaderView *header = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!header) &#123;</span><br><span class="line">        header = [[HeaderView alloc] initWithReuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        <span class="comment">// 初始化_arrowBtn(带三角的按钮)</span></span><br><span class="line">        <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg"</span>] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 北京图片</span></span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        [button setImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"arrow"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [button setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 标题</span></span><br><span class="line">        button.contentEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 整体内边距</span></span><br><span class="line">        button.contentHorizontalAlignment = <span class="built_in">UIControlContentHorizontalAlignmentLeft</span>;<span class="comment">// 左对齐</span></span><br><span class="line">        button.titleEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 文字部分的内边距</span></span><br><span class="line">        button.imageView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        button.imageView.clipsToBounds = <span class="literal">NO</span>;</span><br><span class="line">        _arrowBtn = button;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_arrowBtn];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化_label</span></span><br><span class="line">        <span class="built_in">UILabel</span> *labelRight = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        labelRight.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        _label = labelRight;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_label];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写布局方法:为_arrowBtn和_label设置布局</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    _arrowBtn.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.frame.size.width - <span class="number">70</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setGroupModel:(JKGroupModel *)groupModel</span><br><span class="line">&#123;</span><br><span class="line">    _groupModel = groupModel;</span><br><span class="line">    [_arrowBtn setTitle:_groupModel.name forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    _label.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/%lu"</span>, _groupModel.online, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)_groupModel.friends.count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - buttonAction</span></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-3-2-Controller部分"><a href="#2-10-3-2-Controller部分" class="headerlink" title="2.10.3.2    Controller部分"></a>2.10.3.2    <code>Controller</code>部分</h4><blockquote>
<p><strong>说明：</strong>整个qq列表实际上是一个<code>UITableView</code></p>
</blockquote>
<p><em>Controller/ListTableViewController</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()&lt;<span class="title">HeaderViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 自定义的透视图需要重新定义高度</span></span><br><span class="line">    <span class="keyword">self</span>.tableView.sectionHeaderHeight = <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:friendModel.icon];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableView delagate</span></span><br><span class="line"><span class="comment">// 添加自定义的头视图：初始化TableView中每个section中的header部分</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    HeaderView *header = [HeaderView headerView:tableView];</span><br><span class="line">    header.delegate = <span class="keyword">self</span>;<span class="comment">// 将自身作为代理对象</span></span><br><span class="line">    header.groupModel = <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-4-点击效果的实现"><a href="#2-10-4-点击效果的实现" class="headerlink" title="2.10.4    点击效果的实现"></a>2.10.4    点击效果的实现</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>点击群组栏（<code>HeaderView</code>，继承自<code>UITableViewHeaderFooterView</code>）中的按钮</li>
</ol>
<ul>
<li>展开群组</li>
<li>三角按钮变化</li>
</ul>
<ol>
<li>点击好友（<code>cell</code>），push到一个空界面</li>
</ol>
</blockquote>
<p><em>View/HeaderView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        ...</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父视图发生变化时被调用（不知为什么并没有被调用）</span></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToSuperview</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 三角符号旋转180度</span></span><br><span class="line">    _arrowBtn.imageView.transform = <span class="keyword">self</span>.groupModel.isOpen ? <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_2) : <span class="built_in">CGAffineTransformMakeRotation</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Controller/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">self</span> clipExtraCellLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cell被点击（选中进入）时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过导航控制器进入一个新的 ViewController</span></span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - HeadViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的cell的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clipExtraCellLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-三级控制器"><a href="#2-11-三级控制器" class="headerlink" title="2.11    三级控制器"></a>2.11    三级控制器</h2><blockquote>
<p><strong>说明：</strong>项目截图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.09.10.png" alt="Alt text|200x350"></p>
<p><strong>API：</strong><code>三级控制器</code>的实现使用到的<code>UIKit</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UITabViewController</code>相关成员</th>
<th>原型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>viewControllers</td>
<td><code>@property(nonatomic, copy) NSArray&lt;__kindof UIViewController *&gt; *viewControllers</code></td>
<td>存储着tab视图管理的所有二级控制器实例</td>
</tr>
<tr>
<td>selectedIndex</td>
<td><code>@property(nonatomic) NSUInteger selectedIndex</code></td>
<td>当前被选中的tab item的下标，修改该值会导致视图的切换</td>
</tr>
</tbody>
</table>
<h3 id="2-11-1-初始化视图控制器"><a href="#2-11-1-初始化视图控制器" class="headerlink" title="2.11.1    初始化视图控制器"></a>2.11.1    初始化视图控制器</h3><blockquote>
<p><strong>说明：</strong>本课时讲解<code>三级控制器</code>的结构，自定义视图控制器并初始化学习用新语法创建数组并赋值。用<code>导航控制器</code>构建<code>二级控制器</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.06.44.png" alt="Alt text|450x250"></p>
</blockquote>
<p><em>AppDelegate.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用新的<code>window</code>替换掉项目创建时默认的<code>window</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">    RootViewController *rootVC = [[RootViewController alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = rootVC;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"><span class="comment">// 初始化所有第二级控制器</span></span><br><span class="line">- (<span class="keyword">void</span>)initViewController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化视图控制器</span></span><br><span class="line">    ProfileViewController *profileVC = [[ProfileViewController alloc]init];</span><br><span class="line">    MessageViewController *messageVC = [[MessageViewController alloc]init];</span><br><span class="line">    ColaViewController *colaVC = [[ColaViewController alloc]init];</span><br><span class="line">    UserViewController *userVC = [[UserViewController alloc]init];</span><br><span class="line">    MoreViewController *moreVC = [[MoreViewController alloc]init];</span><br><span class="line">    <span class="comment">// 封装到数组中</span></span><br><span class="line">    <span class="built_in">NSArray</span> *vcArr = @[profileVC, messageVC, colaVC, userVC, moreVC];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *tabArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:vcArr.count];</span><br><span class="line">    <span class="comment">// 为每个视图控制器创建对应的导航控制器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vcArr.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc]initWithRootViewController:vcArr[i]];<span class="comment">// 创建导航视图器时为其绑定对应的视图控制器</span></span><br><span class="line">        [tabArray addObject:navCtrl];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将初始化好的存储导航控制器的数组作为一个属性赋值给第一级控制器</span></span><br><span class="line">    <span class="keyword">self</span>.viewControllers = tabArray;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-自定义标签工具栏"><a href="#2-11-2-自定义标签工具栏" class="headerlink" title="2.11.2    自定义标签工具栏"></a>2.11.2    自定义标签工具栏</h3><blockquote>
<p><strong>说明：</strong>本课时讲解隐藏系统自带<code>标签工具栏</code>样式，并自定义按钮和视图，根据系统的<code>标签工具栏</code>的属性实现切换。</p>
</blockquote>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> btnHeight = <span class="number">45</span>;<span class="comment">// 标签工具栏中按钮的高度</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 初始化标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)initTabBarView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图</span></span><br><span class="line">    _tabBarView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenHeight - tabViewHeight, kScreenWidth, tabViewHeight)];</span><br><span class="line">    _tabBarView.backgroundColor = [<span class="built_in">UIColor</span> colorWithPatternImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask_navbar"</span>]];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tabBarView];</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图 中的按钮</span></span><br><span class="line">    <span class="built_in">NSArray</span> *imgArray = @[<span class="string">@"home_tab_icon_1"</span>, <span class="string">@"home_tab_icon_2"</span>, <span class="string">@"home_tab_icon_3"</span>, <span class="string">@"home_tab_icon_4"</span>, <span class="string">@"home_tab_icon_5"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i; i &lt; imgArray.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:imgArray[i]] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnWidth * i, (tabViewHeight - btnHeight) / <span class="number">2</span>, btnWidth, btnHeight);</span><br><span class="line">        btn.tag = <span class="number">100</span> + i;<span class="comment">// 用来识别点击哪些按钮进行的tab切换（100以内的tag有特殊用途）</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btnAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.tabBarView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化当前被选中的tab按钮上展现的视图（倒三角）</span></span><br><span class="line">    _selectView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, btnWidth, btnHeight)];</span><br><span class="line">    _selectView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"home_bottom_tab_arrow"</span>];</span><br><span class="line">    [_tabBarView addSubview:_selectView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - tab按钮被点击时的处理函数</span></span><br><span class="line">- (<span class="keyword">void</span>)btnAction:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 切换视图（根据tag值获取当前索引）</span></span><br><span class="line">    <span class="keyword">self</span>.selectedIndex = button.tag - <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// 将倒三角移动到被选中的tab按钮上，移动动画持续时间为0.2秒</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        _selectView.center = button.center;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">self</span>.tabBar.hidden = <span class="literal">YES</span>;<span class="comment">// 隐藏 UITabViewController 自带的tab bar</span></span><br><span class="line">    [<span class="keyword">self</span> initTabBarView];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-页面跳转的两种方式"><a href="#2-11-3-页面跳转的两种方式" class="headerlink" title="2.11.3    页面跳转的两种方式"></a>2.11.3    页面跳转的两种方式</h3><blockquote>
<p><strong>说明：</strong>本课时讲解页面两种跳转方式。通过<code>导航控制器</code>实现 <code>push</code> 和通过<code>视图控制器</code>实现模态视图。并讲解 <code>iOS8</code> 中新的方法。</p>
<ul>
<li>从<code>三级控制器</code> <code>push</code>出其它页面需要隐藏<code>标签工具栏</code>，<code>pop</code>回来后需要展现<code>标签工具栏</code></li>
</ul>
</blockquote>
<h4 id="2-11-3-1-RootViewController"><a href="#2-11-3-1-RootViewController" class="headerlink" title="2.11.3.1    RootViewController"></a>2.11.3.1    RootViewController</h4><blockquote>
<p><strong>说明：</strong>在<code>标签控制器</code>中定义<code>标签工具栏</code>的显示／隐藏方法</p>
</blockquote>
<p><em>RootViewController.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> : <span class="title">UITabBarController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *tabBarView;<span class="comment">// 标签工具栏</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示或隐藏标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *selectView;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示／隐藏tab工具栏</span><br><span class="line"> *</span><br><span class="line"> *  @param show YES: 显示, NO: 隐藏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.tabBarView.frame;</span><br><span class="line">    <span class="comment">// 更新frame</span></span><br><span class="line">    <span class="keyword">if</span> (show) &#123;</span><br><span class="line">        frame.origin.x = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        frame.origin.x = -kScreenWidth;<span class="comment">// 隐藏tab bar：将tab bar移除屏幕</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重新赋值tabBarView的frame</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.tabBarView.frame = frame;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-2-ProfileViewController"><a href="#2-11-3-2-ProfileViewController" class="headerlink" title="2.11.3.2    ProfileViewController"></a>2.11.3.2    ProfileViewController</h4><blockquote>
<p><strong>说明：</strong><code>首页</code>中通过两种方式跳转。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonWidth = <span class="number">33</span>;<span class="comment">// 导航栏按钮宽度</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonHeight = <span class="number">32</span>;<span class="comment">// 导航栏按钮高度</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProfileViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ProfileViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.title = <span class="string">@"首页"</span>;</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span> initNavButton];</span><br><span class="line">    [<span class="keyword">self</span> initPushButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义导航栏按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)initNavButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIButton</span></span><br><span class="line">    <span class="built_in">UIButton</span> *writeBtn =  [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">    writeBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, writeButtonWidth, writeButtonHeight);</span><br><span class="line">    [writeBtn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"write"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [writeBtn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(presentAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 封装为 UIBarButtonItem</span></span><br><span class="line">    <span class="built_in">UIBarButtonItem</span> *item = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithCustomView:writeBtn];</span><br><span class="line">    <span class="comment">// 添加到导航栏</span></span><br><span class="line">    <span class="keyword">self</span>.navigationItem.rightBarButtonItem = item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化 push 页面的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPushButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *pushButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    pushButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [pushButton setTitle:<span class="string">@"Push"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [pushButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pushAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:pushButton];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用push的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pushAction</span><br><span class="line">&#123;</span><br><span class="line">    PushViewController *pushVC = [[PushViewController alloc] init];</span><br><span class="line">    <span class="comment">// 通过和当前的视图控制器绑定的导航控制器完成页面的 push</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:pushVC animated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 隐藏首页的tab bar</span></span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用模态的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)presentAction</span><br><span class="line">&#123;</span><br><span class="line">    ModalViewController *modalVC = [[ModalViewController alloc] init];</span><br><span class="line">    <span class="comment">// 使用模态视图</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:modalVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// 展现首页前显示tab bar</span></span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-3-PushViewController"><a href="#2-11-3-3-PushViewController" class="headerlink" title="2.11.3.3    PushViewController"></a>2.11.3.3    PushViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>push</code>跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PushViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PushViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建回退（pop）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *popButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    popButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="comment">// 设置文本（使用了setTitle就不能setImage了）</span></span><br><span class="line">    [popButton setTitle:<span class="string">@"Pop"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [popButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(popAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:popButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  回退(pop)到堆栈中的上一个视图(首页)</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)popAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-4-ModalViewController"><a href="#2-11-3-4-ModalViewController" class="headerlink" title="2.11.3.4    ModalViewController"></a>2.11.3.4    ModalViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>dismiss</code>方式跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ModalViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ModalViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="comment">// 创建回退（dismisss）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *dismissButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    dismissButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [dismissButton setTitle:<span class="string">@"Dismiss"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册点击事件</span></span><br><span class="line">    [dismissButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(dismissAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:dismissButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回退页面</span></span><br><span class="line">- (<span class="keyword">void</span>)dismissAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-12-通讯录"><a href="#2-12-通讯录" class="headerlink" title="2.12    通讯录"></a>2.12    通讯录</h2><blockquote>
<p><strong>说明：</strong>本课实现模拟通讯录的登陆、添加、删除、修改的功能，涉及到第三方类库的使用，数据存储并加深理解代理和 <code>UITableView</code>。</p>
<ol>
<li><code>Storyboard</code>中设置页面跳转</li>
<li>第三方类库<code>MBProgressHUD</code></li>
<li>数据存储</li>
<li><code>UITableView</code>的深入理解</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_contact.gif" alt="Alt text|200x350"></p>
</blockquote>
<h3 id="2-12-1-Storyboard实现布局和跳转"><a href="#2-12-1-Storyboard实现布局和跳转" class="headerlink" title="2.12.1    Storyboard实现布局和跳转"></a>2.12.1    <code>Storyboard</code>实现布局和跳转</h3><blockquote>
<p><strong>说明：</strong>本课时讲解创建自定义视图控制器并通过 <code>storyboard</code> 来布局页面，学习手动跳转的方法。</p>
</blockquote>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><hr>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>becomeFirstResponder</code></td>
<td>实例方法</td>
<td>使文本输入框自动获取焦点，呼出键盘，类似<code>html</code>中的<code>autofocus</code></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>``</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="2-12-1-1-布局"><a href="#2-12-1-1-布局" class="headerlink" title="2.12.1.1    布局"></a>2.12.1.1    布局</h4><p><strong>1. 建立<code>Navigaton Controller</code>和<code>LoginViewController</code>之间的关联</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%8810.17.31.png" alt="Alt text"><br><strong>2. <code>LoginViewController</code>跳转到<code>ContactTableViewController</code></strong></p>
<blockquote>
<p>采用<code>iOS8</code>后的新的<code>show</code>替代<code>push</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_show.gif" alt="Alt text"><br><strong>3. 自定义<code>ContactTableViewController</code>的导航栏</strong></p>
<ul>
<li>自定义导航栏需要添加<code>Navigation Item</code>控件</li>
<li><code>Navigation Item</code>内的按钮要使用<code>Button Item</code>控件</li>
<li>按钮中使用系统图标(<code>System Icon</code>)<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8A%E5%8D%8812.23.35.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="2-12-1-2-跳转"><a href="#2-12-1-2-跳转" class="headerlink" title="2.12.1.2    跳转"></a>2.12.1.2    跳转</h4><blockquote>
<ul>
<li>使用<code>NSNotificationCenter</code>监控文本的变化</li>
<li>使用在<code>Storyboard</code>中为视图之间建立的<code>连接</code>的<code>identifier</code>访问<code>连接</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LoginViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LoginViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *pwdField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UISwitch</span> *rembField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *loginBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.pwdField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// In a storyboard-based application, you will often want to do a little preparation before navigation</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  跳转之前之行</span><br><span class="line"> *</span><br><span class="line"> *  @param segue 跳转的信息</span><br><span class="line"> *  @param sender 和performSegueWithIdentifier方法传入的sender是同一个</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// Get the new view controller using [segue destinationViewController].</span></span><br><span class="line">    <span class="comment">// Pass the selected object to the new view controller.</span></span><br><span class="line">    <span class="comment">// 1. 获取跳转目的地视图的控制器</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *contactVC = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 2. 设置标题（传值）</span></span><br><span class="line">    contactVC.title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@的联系人列表"</span>, <span class="keyword">self</span>.nameField.text];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.loginBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.pwdField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-2-UIAlertController与添加页面布局"><a href="#2-12-2-UIAlertController与添加页面布局" class="headerlink" title="2.12.2    UIAlertController与添加页面布局"></a>2.12.2    <code>UIAlertController</code>与添加页面布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>iOS8</code> 中新控制器 <code>UIAlertController</code> 的使用，并通过 <code>storyboard</code> 布局添加联系人页面，用第三方类库 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> 实现网络加载进程的效果。</p>
</blockquote>
<p><strong>1. 登录过程中使用<code>MBProgressHUD</code>实现提示窗</strong><br><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"账号不存在"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"密码错误"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [MBProgressHUD showMessage:<span class="string">@"努力加载中"</span>];</span><br><span class="line">    <span class="comment">// 2秒后（模拟网络请求）跳转</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 移除蒙板弹窗</span></span><br><span class="line">        [MBProgressHUD hideHUD];</span><br><span class="line">        [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 在<code>联系人列表界面</code>中点击<code>添加按钮</code>跳转到<code>添加页面</code></strong><br><img src="./show2.gif" alt="Alt text|200x200"></p>
<p><strong>3. 在<code>联系人列表界面</code>中点击注销按钮，注销登陆</strong></p>
<blockquote>
<p><code>UIAlertController</code>：<code>iOS8</code>之后出现的，用来弹出提示窗，取代了<code>UIAcionSheet</code>和<code>UIAlertView</code>。</p>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 初始化 UIAlertController,使用 actionSheet 样式</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"是否注销?"</span> message:<span class="string">@"真的要注销吗？"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">    <span class="comment">// 添加取消按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:<span class="literal">nil</span>]];</span><br><span class="line">    <span class="comment">// 添加确定按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleDestructive</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</span><br><span class="line">        <span class="comment">// pop掉适当前的视图控制器</span></span><br><span class="line">        [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;]];</span><br><span class="line">    <span class="comment">// 弹出这个控制器</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 为<code>登陆界面</code>的输入框增加清空按钮</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.43.58.png" alt="Alt text"></p>
<p><strong>5. 为<code>登陆界面</code>的密码输入框设置安全输入</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.44.32.png" alt="Alt text"></p>
<p><strong>6. 初始化<code>联系人列表界面</code>中的联系人</strong></p>
<blockquote>
<ul>
<li>添加属性<code>contactArr</code></li>
<li>在<code>Storyboard</code>中为<code>联系人cell</code>设置<code>identifier</code>，并设置其<code>Style</code>为<code>Right Style</code></li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.contactArr.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"contactPeopleCell"</span> forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Configure the cell...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-3-添加功能与传值"><a href="#2-12-3-添加功能与传值" class="headerlink" title="2.12.3    添加功能与传值"></a>2.12.3    添加功能与传值</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现添加功能，添加联系人信息后通过代理传递数据到上一层视图控制器。用 <code>storyboard</code> 布局编辑页面。</p>
</blockquote>
<p><strong>1. 创建<code>JKContactModel</code>数据模型</strong></p>
<blockquote>
<p>该数据模型能够<code>序列化</code>和<code>反序列化</code></p>
</blockquote>
<p><em>JKContactModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKContactModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *phone;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContactModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKContactModel</span></span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)encoder &#123;</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.name forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.phone forKey:<span class="string">@"phone"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)decoder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"phone"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 定义具备添加功能（传值）的代理协议，并使用代理对象实现添加功能</strong></p>
<blockquote>
<ul>
<li>让姓名文本框自动获取光标，弹出虚拟键盘</li>
</ul>
</blockquote>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">AddViewController</span>, <span class="title">JKContactModel</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义处理添加工作的代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AddViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;AddViewControllerDelegate&gt; delegate;<span class="comment">// 代理对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *addBtn;</span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction;</span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AddViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="comment">// 让性命文本框 autofocus</span></span><br><span class="line">    [<span class="keyword">self</span>.nameField becomeFirstResponder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通过代理对象传值</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(addContact:didAddContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 创建数据模型</span></span><br><span class="line">        JKContactModel *contactModel = [[JKContactModel alloc] init];</span><br><span class="line">        contactModel.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        contactModel.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理对象将数据添加到 联系人列表视图的数组中</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate addContact:<span class="keyword">self</span> didAddContact:contactModel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.addBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>联系人列表视图</code>中接受数据并增加一条联系人信息<blockquote>
<ul>
<li>去掉多余的 table 中多余的线</li>
<li>在cell右侧添加箭头</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> clearExtraLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clearExtraLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc]init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    AddViewController *addVc = vc;</span><br><span class="line">    addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 设置键盘类型</strong><br><img src="./屏幕快照 2016-03-23 10.14.46.png" alt="Alt text"></p>
<h3 id="2-12-4-编辑页面功能完善"><a href="#2-12-4-编辑页面功能完善" class="headerlink" title="2.12.4    编辑页面功能完善"></a>2.12.4    编辑页面功能完善</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现编辑页面的功能，点击编辑修改响应的按钮和文本框状态，并通过代理方法传值。</p>
</blockquote>
<p><strong>1. 在<code>Storyboard</code>中创建并初始化编辑页面的布局</strong></p>
<blockquote>
<ul>
<li>为cell建立<code>selection segue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_section.gif" alt="Alt text|200x200"></li>
<li>设置按钮默认隐藏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-23%2010.35.09.png" alt="Alt text|350x200"></li>
<li>设置<code>编辑界面</code>的输入框默认不可点击</li>
</ul>
</blockquote>
<p><strong>2. 完善<code>EditViewController</code></strong></p>
<blockquote>
<ul>
<li>初始化界面数据</li>
<li>定义编辑界面的代理协议</li>
<li>实现编辑action</li>
<li>实现保存action</li>
</ul>
</blockquote>
<p>“<em>Controller/EditViewController.h”</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKContactModel</span>, <span class="title">EditViewController</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">EditViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc ddidSavaContact: (JKContactModel *)model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;EditViewControllerDelegate&gt;delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKContactModel *contactMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>“<em>Controller/EditViewController.m”</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *saveBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIBarButtonItem</span> *edit;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender;</span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EditViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 通过数据模型初始化页面数据</span></span><br><span class="line">    <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">    <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前页面</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通知代理</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(editViewController:didSavaContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 更新编辑界面的显示</span></span><br><span class="line">        <span class="keyword">self</span>.contactMode.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        <span class="keyword">self</span>.contactMode.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理更新联系人列表界面的显示</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate editViewController:<span class="keyword">self</span> didSavaContact:<span class="keyword">self</span>.contactMode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 进入不可编辑状态</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.nameField.enabled) &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">YES</span>;</span><br><span class="line">        sender.title = <span class="string">@"编辑"</span>;</span><br><span class="line">        <span class="comment">// 使用原来的数据还原输入框显示</span></span><br><span class="line">        <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 进入可编辑状态</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">NO</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        sender.title = <span class="string">@"取消"</span>;<span class="comment">// 更新编辑按钮文案</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.edit.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p><code>联系人列表界面</code>采纳代理协议，接收编辑页面的数据</p>
<blockquote>
<ul>
<li>跳转到编辑页面前为<code>编辑界面</code>赋值代理对象</li>
<li>实现滑动删除功能</li>
</ul>
</blockquote>
<hr>
<p><em>ContactTableViewConrtroller.m</em></p>
</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>, <span class="title">EditViewControllerDelegate</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）和数据模型</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">/* 设置代理 */</span></span><br><span class="line">    <span class="comment">// 跳转到添加联系人视图控制器</span></span><br><span class="line">    <span class="keyword">if</span> ([vc isKindOfClass:[AddViewController class]]) &#123;</span><br><span class="line">        AddViewController *addVc = vc;</span><br><span class="line">        addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跳转到编辑联系人视图控制器</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([vc isKindOfClass:[EditViewController class]]) &#123;</span><br><span class="line">        <span class="comment">// 获取点击的联系人所在cell(选中的那一行)的 NSIndexPath</span></span><br><span class="line">        EditViewController *editVc = vc;</span><br><span class="line">        <span class="comment">// 获取选中的那一行</span></span><br><span class="line">        <span class="built_in">NSIndexPath</span> *path = [<span class="keyword">self</span>.tableView indexPathForSelectedRow];</span><br><span class="line">        <span class="comment">// 赋值数据模型</span></span><br><span class="line">        editVc.contactMode = <span class="keyword">self</span>.contactArr[path.row];</span><br><span class="line">        <span class="comment">// 赋值代理对象</span></span><br><span class="line">        editVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-5-数据存储"><a href="#2-12-5-数据存储" class="headerlink" title="2.12.5    数据存储"></a>2.12.5    数据存储</h3><blockquote>
<p><strong>说明：</strong>本课时讲解数据存储的四种方式的区别，学习<code>偏好设置</code>和<code>归档</code>的方式存储数据，并解决添加页面不能传值的问题。</p>
</blockquote>
<table>
<thead>
<tr>
<th>数据存储方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>plist</td>
<td>需要知道文件名，只适合<code>NSArray</code>、<code>NSString</code>等基本数据类型</td>
</tr>
<tr>
<td>偏好设置</td>
<td>不需要知道文件名，小型数据<code>NSUserDefaults</code></td>
</tr>
<tr>
<td>对象归档</td>
<td><code>NSKeyedArchiver</code>，必须采纳<code>NSCoding</code>协议</td>
</tr>
<tr>
<td>core Data</td>
<td>大型数据</td>
</tr>
<tr>
<td>sqpite3</td>
<td>数据库</td>
</tr>
</tbody>
</table>
<h4 id="2-12-5-1-便好设置"><a href="#2-12-5-1-便好设置" class="headerlink" title="2.12.5.1    便好设置"></a>2.12.5.1    便好设置</h4><blockquote>
<p><strong>实战：</strong>登录界面载入后采用<code>便好设置</code>方式读取配置</p>
<ul>
<li>页面载入时读取<code>便好设置</code></li>
<li>点击登录时存储<code>便好设置</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MBProgressHUD+MJ.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define UserNameKey @<span class="meta-string">"name"</span></span></span><br><span class="line"><span class="meta">#define PwdKey @<span class="meta-string">"pwd"</span></span></span><br><span class="line"><span class="meta">#define RmbPwdKey @<span class="meta-string">"rmd_pwd"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.nameField forKey:UserNameKey];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.pwdField.text forKey:PwdKey];</span><br><span class="line">    [defaults setBool:<span class="keyword">self</span>.rembField.isOn forKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 设置同步</span></span><br><span class="line">    [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 读取上次配置</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    <span class="keyword">self</span>.nameField.text = [defaults valueForKey:UserNameKey];</span><br><span class="line">    <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">    <span class="keyword">self</span>.rembField.on = [defaults boolForKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 如果上次登录时选择了记住密码，则自动填写密码字段，并激活登录按钮</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.rembField.isOn) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">        <span class="keyword">self</span>.loginBtn.enabled = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-12-5-2-对象归档"><a href="#2-12-5-2-对象归档" class="headerlink" title="2.12.5.2    对象归档"></a>2.12.5.2    对象归档</h4><blockquote>
<p><strong>实战：</strong>联系人列表界面使用<code>对象归档方式</code>存储数据。</p>
<ul>
<li><code>JKContactModel</code>采纳<code>NSCoding</code>协议</li>
<li>对<code>联系人列表界面</code>中添加、删除和读取数据模型的操作进行归档</li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取归档的文件路径</span></span><br><span class="line"><span class="meta">#define ContactFilePath [[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:@<span class="meta-string">"contacts.data"</span>]</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">        <span class="comment">// 3. 归档</span></span><br><span class="line">        [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 3. 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-13-绘制小黄人"><a href="#2-13-绘制小黄人" class="headerlink" title="2.13    绘制小黄人"></a>2.13    绘制小黄人</h2><h3 id="Quartz-2D"><a href="#Quartz-2D" class="headerlink" title="Quartz 2D"></a>Quartz 2D</h3><blockquote>
<p><strong>说明：</strong>是一个二维绘图引擎。<code>Quartz 2D</code>的<code>API</code>是<code>C</code>语言，来自于<code>CoreGraphics</code>框架。该框架可以用来</p>
<ul>
<li>绘制图形：线条／三角形／矩形／圆／弧等</li>
<li>绘制文字</li>
<li>绘制、生成图片（图像)）</li>
<li>读取／生成pdf</li>
<li>截图、裁剪图片</li>
<li>自定义UI控件</li>
</ul>
<p><strong>技巧：</strong><code>UIView</code>就是通过该引擎实现的控件绘制，因此可以通过继承<code>UIView</code>定义自己的控件。<br><strong>图形上下文（Graphics Context）：</strong>是一个<code>CGContextRef</code>类型的数据，用来</p>
<ul>
<li>保存绘图信息、绘图状态</li>
<li>决定绘制的输出目标（绘制到什么地方去，输出目标可以是PDF文件、Bitmap或者显示器的窗口上）</li>
</ul>
</blockquote>
<h3 id="2-13-1-Quartz-2D基本图形"><a href="#2-13-1-Quartz-2D基本图形" class="headerlink" title="2.13.1    Quartz 2D基本图形"></a>2.13.1    <code>Quartz 2D</code>基本图形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>Quartz 2D</code> 的概念，<code>drawRect</code> 方法的调用、图形上下文、以及线段、三角形、四边形的绘制方法。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%889.51.15.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawLine.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DrawLine</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>DrawLine.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawLine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawLine</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  系统自动调用，视图显示在屏幕上的时候调用切只调用一次</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drwaLine();</span><br><span class="line">    drawRect();</span><br><span class="line">    drawTriangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制直线</span><br><span class="line"> *  绘制两条样式不同的线，因此在两个图形上下文中分别绘制</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drwaLine() &#123;</span><br><span class="line">    <span class="comment">// 第1条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 将上下文复制一份到栈中(作为为第二条线的图形上下文)</span></span><br><span class="line">    <span class="built_in">CGContextSaveGState</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">20</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(context, k<span class="built_in">CGLineCapRound</span>);<span class="comment">// 设置线条头尾部的样式</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);<span class="comment">//设置起点</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第二条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRestoreGState</span>(context);<span class="comment">// 将图形上下文出栈， 替换当前的上下文</span></span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(context, k<span class="built_in">CGLineJoinRound</span>);<span class="comment">// 设置线断转折点的样式</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">120</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制四边形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawRect() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制四边形</span></span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">180</span>));<span class="comment">// 四边形</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> purpleColor] setFill];<span class="comment">// 设置填充色</span></span><br><span class="line">    <span class="comment">// 3. 显示在 View 上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制三角形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawTriangle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制三角形</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);<span class="comment">// 第一个边</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">100</span>);<span class="comment">// 第二个边</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);<span class="comment">// 第三个边（闭合路径，连接起点和最后一个点）</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    <span class="comment">// 3. 显示在view</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-2-绘制圆、图片与文字"><a href="#2-13-2-绘制圆、图片与文字" class="headerlink" title="2.13.2    绘制圆、图片与文字"></a>2.13.2    绘制圆、图片与文字</h3><blockquote>
<p><strong>说明：</strong>本课时讲解绘制圆弧、圆形、图片与文字的方法，所用函数及函数参数的含义，并介绍多种不同的函数绘制图形，最后介绍了<code>Quartz 2D</code>中的贝塞尔曲线。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%8810.25.47.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawCircle.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawCircle.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  角度转换为弧度</span><br><span class="line"> *</span><br><span class="line"> *  @param angle 角度</span><br><span class="line"> *</span><br><span class="line"> *  @return 弧度</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">CGFloat</span> arc(<span class="built_in">CGFloat</span> angle) &#123;</span><br><span class="line">    <span class="keyword">return</span> angle * (M_PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawCircle</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drawArc();</span><br><span class="line">    drawCircle();</span><br><span class="line">    drawImg();</span><br><span class="line">    drawText();</span><br><span class="line">    drawBezier();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  画圆</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawCircle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">130</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  弧形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawArc() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="comment">// 参数：上下文, 圆心横坐标，圆心纵坐标，半径，开始的角度，结束的角度，0顺时针/1逆时针</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, arc(<span class="number">90</span>), arc(<span class="number">200</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *   绘制字体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawText() &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;<span class="comment">// 字串</span></span><br><span class="line">    <span class="comment">// 设置（字体样式信息保存在字典中）</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    attributes[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];<span class="comment">// 字体大小</span></span><br><span class="line">    attributes[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> purpleColor];<span class="comment">// 字体颜色</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:attributes];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图片</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawImg()&#123;</span><br><span class="line">    <span class="comment">// 1. 取得图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">    <span class="comment">// 2. 画</span></span><br><span class="line">    <span class="comment">// img drawAtPoint</span></span><br><span class="line">    <span class="comment">// img drawInRect</span></span><br><span class="line">    [img drawAsPatternInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  贝塞尔曲线</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBezier()&#123;</span><br><span class="line">    <span class="comment">// 1.取得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 起点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextAddCurveToPoint(context, 120, 100, 180, 50, 190, 190);// 2个控制点</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>);<span class="comment">// 1个控制点</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-3-绘制小黄人雏形"><a href="#2-13-3-绘制小黄人雏形" class="headerlink" title="2.13.3    绘制小黄人雏形"></a>2.13.3    绘制小黄人雏形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解根据所学习的 <code>Quartz 2D</code> 的绘制图形的知识绘制小黄人雏形，以此加深对绘图的理解。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-25%20%E4%B8%8A%E5%8D%8812.28.25.png" alt="Alt text|200x150"></p>
</blockquote>
<p><em>DrawHuman.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawHuman.h"</span></span></span><br><span class="line"><span class="meta">#define JKRadius 70// 半径</span></span><br><span class="line"><span class="meta">#define JKTopY 100// 即是身体高度，也是身体顶部纵坐标</span></span><br><span class="line"><span class="meta">#define JKColor(r, g, b) [UIColor colorWithRed:(r)/255.0 green:(g)/255.0 blue :(b)/255.0 alpha:1.0]// 身体颜色</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawHuman</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// 1. 图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    drawBody(context, rect);</span><br><span class="line">    drawMouse(context, rect);</span><br><span class="line">    drawEyes(context, rect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  身体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBody(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 上半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topX = rect.size.width * <span class="number">0.5</span>;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topY = JKTopY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topRadius = JKRadius;<span class="comment">// 圆形半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, topX, topY, topRadius, <span class="number">0</span>, M_PI, <span class="number">1</span>);<span class="comment">// 绘制半圆（从右侧沿逆时针向左绘制）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 身体左侧竖线</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleX = topX - topRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleH = JKTopY;<span class="comment">// 身体部分高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleY =  topY + middleH;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, middleX, middleY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomX = topX;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomY = middleY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomRedius = topRadius;<span class="comment">// 半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, bottomX, bottomY, bottomRedius, M_PI, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭合</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [JKColor(<span class="number">252</span>, <span class="number">218</span>, <span class="number">0</span>) set];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  嘴</span><br><span class="line"> *  采用赛贝尔曲线，1个控制点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawMouse(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 控制点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> controlX = rect.size.width * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> controlY = rect.size.height * <span class="number">0.3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移动到起点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> marginX = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> marginY = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentX = controlX - marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentY = controlY - marginY;</span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, currentX, currentY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 结束点坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endX = controlX + marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> endY = currentY;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, controlX, controlY, endX, endY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  眼睛</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawEyes(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">//黑色绑带（一条很粗的线）</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startX = rect.size.width * <span class="number">0.5</span> - JKRadius;<span class="comment">// 起点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startY = JKTopY;<span class="comment">// 起点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startX, startY);</span><br><span class="line">    <span class="built_in">CGFloat</span> endX = startX + <span class="number">2</span> * JKRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endY = startY;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endX, endY);<span class="comment">// 划线</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">15</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];<span class="comment">// 设置线的颜色</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 显示</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//灰色镜框</span></span><br><span class="line">    [JKColor(<span class="number">61</span>, <span class="number">62</span>, <span class="number">66</span>) set];</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangRadius = JKRadius * <span class="number">0.4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangY = startY;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangX = rect.size.width * <span class="number">0.5</span> - kuangRadius;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, kuangX + <span class="number">25</span>, kuangY, kuangRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//里面的白色框</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> whiteColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteRadius = kuangRadius * <span class="number">0.7</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteX = kuangX;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteY = kuangY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, whiteX + <span class="number">25</span>, whiteY, whiteRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//眼睛</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> blackRadius = whiteRadius * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackX = whiteX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackY = whiteY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, blackX + <span class="number">25</span>, blackY, blackRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-14-手势密码锁"><a href="#2-14-手势密码锁" class="headerlink" title="2.14    手势密码锁"></a>2.14    手势密码锁</h2><h3 id="UIGestureRecognizer"><a href="#UIGestureRecognizer" class="headerlink" title="UIGestureRecognizer"></a>UIGestureRecognizer</h3><blockquote>
<p><strong>说明：</strong>所有手势操作相关的操作的类的<code>基类</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UIGestureRecognizer</code>的子类</th>
<th>对应的手势操作</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UITapGestureRecoginizer</code></td>
<td>点击</td>
</tr>
<tr>
<td><code>UIPinchGestureRecognizer</code></td>
<td>捏合</td>
</tr>
<tr>
<td><code>UIRotationGestureRecognizer</code></td>
<td>旋转</td>
</tr>
<tr>
<td><code>UISwipwGestureRecognizer</code></td>
<td>轻扫、快速移动，是用于监测欢动方向的</td>
</tr>
<tr>
<td><code>UIPanGestureRecognizer</code></td>
<td>拖移、慢速移动，是用于监测便宜的量的</td>
</tr>
<tr>
<td><code>UILongPressGestureRecognizer</code></td>
<td>长按</td>
</tr>
</tbody>
</table>
<h3 id="2-14-1-点击、捏合、轻扫"><a href="#2-14-1-点击、捏合、轻扫" class="headerlink" title="2.14.1    点击、捏合、轻扫"></a>2.14.1    点击、捏合、轻扫</h3><blockquote>
<p><strong>说明：</strong>本课时讲解点击手势，单击和双击，手势互斥原则的概念和解决方法，捏合手势缩放视图以及轻扫手势的使用。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Tap 点击和手势</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  1. 点击示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)tapGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 类型一：一个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTap:)];</span><br><span class="line">    tap.numberOfTapsRequired = <span class="number">1</span>;<span class="comment">// 点击次数(默认1)</span></span><br><span class="line">    tap.numberOfTouchesRequired = <span class="number">1</span>;<span class="comment">// 几个手指点击（默认1）</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap];<span class="comment">// 注册事件到顶层view</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二：一个手指双击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap2 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(doubleTap:)];</span><br><span class="line">    tap2.numberOfTapsRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap2];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型一和类型二冲突策略</span></span><br><span class="line">    [tap requireGestureRecognizerToFail:tap2];<span class="comment">// 同时发生时，只触发tap2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型三：两个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap3 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTwoFingerTap:)];</span><br><span class="line">    tap3.numberOfTouchesRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap3];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二和类型三冲突策略</span></span><br><span class="line">    [tap2 requireGestureRecognizerToFail:tap3];<span class="comment">// 同时发生时，只触发tap3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  2. 轻扫手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UISwipeGestureRecognizer</span> *swipe = [[<span class="built_in">UISwipeGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(swipeAction:)];</span><br><span class="line">    swipe.direction = <span class="built_in">UISwipeGestureRecognizerDirectionLeft</span>;<span class="comment">// 默认右扫</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:swipe];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  3. 捏合手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPinchGestureRecognizer</span> *pinch = [[<span class="built_in">UIPinchGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pinchAction:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:pinch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 响应方法</span></span><br><span class="line"><span class="comment">// 单击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)doubleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指双击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单击（两个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTwoFingerTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"两个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滑动</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeAction:(<span class="built_in">UISwipeGestureRecognizer</span> *)swipe</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"向左轻扫"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捏合</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchAction:(<span class="built_in">UIPinchGestureRecognizer</span> *)pinch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> scale = pinch.scale;</span><br><span class="line">    pinch.view.transform = <span class="built_in">CGAffineTransformScale</span>(pinch.view.transform, scale, scale);</span><br><span class="line">    <span class="keyword">if</span> (scale &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合放大"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (scale &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合缩小"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-14-2-拖移、旋转、长按"><a href="#2-14-2-拖移、旋转、长按" class="headerlink" title="2.14.2    拖移、旋转、长按"></a>2.14.2    拖移、旋转、长按</h3><blockquote>
<p><strong>说明：</strong>本课时讲解拖移、旋转和长按手势的声明以及响应方法，根据其属性和方法来深入理解手势。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  4. 拖移手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)panGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:pan];<span class="comment">// 注册事件到_genstureLabel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  5. 旋转手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIRotationGestureRecognizer</span> *rotation = [[<span class="built_in">UIRotationGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rotationAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:rotation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  6. 长按手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UILongPressGestureRecognizer</span> *longPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(longPressAction:)];</span><br><span class="line">    longPress.minimumPressDuration = <span class="number">2</span>;<span class="comment">// 设置有效触发长按事件时间</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:longPress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长按</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressAction:(<span class="built_in">UILongPressGestureRecognizer</span> *)longPress</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"已经长按2秒"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationAction:(<span class="built_in">UIRotationGestureRecognizer</span> *)rotationGes</span><br><span class="line">&#123;</span><br><span class="line">    rotationGes.view.transform = <span class="built_in">CGAffineTransformRotate</span>(rotationGes.view.transform, rotationGes.rotation);</span><br><span class="line">    rotationGes.rotation = M_PI;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"旋转"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拖动</span></span><br><span class="line">- (<span class="keyword">void</span>)panAction:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移动的量（向量）</span></span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [pan translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    <span class="comment">// 计算移动后的位置坐标</span></span><br><span class="line">    pan.view.center = <span class="built_in">CGPointMake</span>(pan.view.center.x + translation.x, pan.view.center.y + translation.y);</span><br><span class="line">    <span class="comment">// 设置坐标和速度</span></span><br><span class="line">    [pan setTranslation:<span class="built_in">CGPointZero</span> inView:<span class="keyword">self</span>.view];</span><br><span class="line">    _genstureLabel.text = <span class="string">@"把我放哪儿啊？"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-14-3-九宫格布局按钮"><a href="#2-14-3-九宫格布局按钮" class="headerlink" title="2.14.3    九宫格布局按钮"></a>2.14.3    九宫格布局按钮</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>storyboard</code> 添加背景视图，并通过代码布局按钮，运用到了九宫格布局算法，对触摸事件和按钮的功能进行代码封装。</p>
<ol>
<li>引入图片资源</li>
<li>创建<code>JKLockView</code>（<code>UIView</code>）</li>
<li>重写<code>initWithFrame</code>和<code>initWithCoder</code></li>
<li>布局<code>JKLockView</code>并添加按钮<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_gesture.gif" alt="Alt text|100x180"></li>
</ol>
</blockquote>
<h3 id="2-14-4-手势连线与代理"><a href="#2-14-4-手势连线与代理" class="headerlink" title="2.14.4    手势连线与代理"></a>2.14.4    手势连线与代理</h3><blockquote>
<p><strong>说明：</strong>本课时讲解将按钮根据手势触摸连线，修改按钮选中状态、手势结束后取消连线、最后设置代理方法来判断密码是否正确。</p>
<ol>
<li>完成连线逻辑</li>
<li>在<code>JKLockView</code>中定义代理协议</li>
<li><code>ViewController</code>采纳代理协议</li>
<li>在<code>JKLockView</code>中调用代理对象</li>
<li>在<code>ViewController</code>中使用<code>UIAlertController</code></li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>数组或字典中添加的对象不能为<code>nil</code>，否则程序会崩溃</li>
<li>当视图发生变化时，调用<code>setNeedDisplay</code>更新视图</li>
</ul>
<p><strong>技巧：</strong>通过 <code>makeObjectsPerformSelector</code> 向数组中的每一个对象发送信息</p>
</blockquote>
<h2 id="2-15-抽奖转盘动画"><a href="#2-15-抽奖转盘动画" class="headerlink" title="2.15    抽奖转盘动画"></a>2.15    抽奖转盘动画</h2><blockquote>
<p><strong>说明：</strong><code>QuartzCore</code> 框架是常用的框架，除了绘图还有动画效果，通过这个课程理解常用的 <code>CAAnimation</code> 类，并且了解图层与视图的关系，包括 <code>CALayer</code> 的自定义方法和属性。</p>
<ul>
<li>CALayer</li>
<li>CAAnimation</li>
<li>转场动画与组动画</li>
<li>隐性动画</li>
<li>CGImageCreateWithImageInRect</li>
<li>CADisplayLink</li>
</ul>
<p><strong>兼容性：</strong><code>QuartzCore</code>与<code>CoreGraphics</code>是可以跨平台使用的，<code>UIKit</code>只能在<code>iOS</code>中使用</p>
</blockquote>
<h3 id="2-15-1-CALayer图层介绍"><a href="#2-15-1-CALayer图层介绍" class="headerlink" title="2.15.1    CALayer图层介绍"></a>2.15.1    CALayer图层介绍</h3><p><strong>*课程介绍：</strong>本课时讲解<code>CALayer</code> 图层的概念，介绍图层的属性和自定义图层的方法。*</p>
<h4 id="CALayer"><a href="#CALayer" class="headerlink" title="CALayer"></a>CALayer</h4><blockquote>
<p><strong>依赖：</strong>使用层之前，需要在项目中引入<code>QuartzCore.framework</code>框架<br><strong>用途：</strong><code>CALayer</code>(层)是屏幕上的一个矩形区域，在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。</p>
<ul>
<li>层的大小尺寸</li>
<li>背景色</li>
<li>内容（可以填充图片或者使用<code>Core Graphics</code>绘制的内容）</li>
<li>矩形是否使用圆角</li>
<li>矩形是否有阴影</li>
</ul>
<p><strong>感性认知：</strong><code>CALayer</code>本质上是一块包含一幅位图的缓冲区，由视图创建的层为<code>隐式层</code>，而手动创建的层称为<code>显示层</code>。<br><strong>种类：</strong><code>Layer</code>有很多种，最常用也是最基本的是<code>CALayer</code>，当然还包括其他的子类</p>
<ul>
<li><code>CAScrollerLayer</code> 简化显示层的一部分</li>
<li><code>CATextLayer</code> 文本层</li>
<li><code>CAGradientLayer</code>、<code>CAShapeLayer</code>等等</li>
</ul>
</blockquote>
<h4 id="2-15-1-1-原生控件使用CALayer"><a href="#2-15-1-1-原生控件使用CALayer" class="headerlink" title="2.15.1.1    原生控件使用CALayer"></a>2.15.1.1    原生控件使用<code>CALayer</code></h4><blockquote>
<p><strong>说明：</strong>在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.11.53.png" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initImageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置原生控件的CALayer（以 UIImageView 为例）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initImageView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>]];</span><br><span class="line">    imgView.frame = <span class="built_in">CGRectMake</span>((kScreenWidth - <span class="number">200</span>) / <span class="number">2</span>, (kScreenHeight - <span class="number">200</span>) / <span class="number">2</span>, <span class="number">200</span>, <span class="number">200</span>);<span class="comment">// 设置frame</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imgView];<span class="comment">// 将 UIImageView 添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 UIImageView 的根 CGLayer</span></span><br><span class="line">    <span class="comment">// 1. 设置阴影</span></span><br><span class="line">    imgView.layer.shadowColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;<span class="comment">// 设置阴影颜色</span></span><br><span class="line">    imgView.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);<span class="comment">// 设置阴影的偏移</span></span><br><span class="line">    imgView.layer.shadowOpacity = <span class="number">0.5</span>;<span class="comment">// 设置阴影的不透明</span></span><br><span class="line">    <span class="comment">// 2. 设置圆角</span></span><br><span class="line">    imgView.layer.cornerRadius = <span class="number">10</span>;<span class="comment">// 设置圆角半径</span></span><br><span class="line">    imgView.layer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 强制内部的所有子层支持圆角效果，少了这个设置，UIImageView是不会有圆角效果的。设置之后，没有阴影效果。</span></span><br><span class="line">    <span class="comment">// 3. 设置边框</span></span><br><span class="line">    imgView.layer.borderWidth = <span class="number">5</span>;</span><br><span class="line">    imgView.layer.borderColor = [<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">    <span class="comment">// 4. 设置旋转：利用 transform 属性可以设置旋转、缩放等效果</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 顺时针旋转45度</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 缩小0.5倍</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [imgView.layer setValue:@(2) forKey:@"transform.scale.x"];// 使用KVC方式</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-15-1-2-自定义CALayer"><a href="#2-15-1-2-自定义CALayer" class="headerlink" title="2.15.1.2    自定义CALayer"></a>2.15.1.2    自定义CALayer</h4><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>建子类继承<code>CALayer</code>，实现 <code>drawInContext：</code>方法</li>
<li>在控制器中设置代理，实现代理方法来画图层</li>
</ul>
</blockquote>
<h5 id="方式一：继承CALayer"><a href="#方式一：继承CALayer" class="headerlink" title="方式一：继承CALayer"></a>方式一：继承CALayer</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.26.12.png" alt="Alt text"></p>
<p><em>MyCALayer.h</em></p>
<blockquote>
<p><strong>说明：</strong>继承<code>CALayer</code><br><strong>注意：</strong>需要在项目的<code>info.plist</code>中导入<code>QuartzCore</code>库</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyCALyer</span> : <span class="title">CALayer</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>MyCALayer.m</em></p>
<blockquote>
<p><strong>说明：</strong>需要重写<code>drawInContext</code>方法，该方法在视图变动时通过<code>setNeededDisplay</code>被自动调用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyCALyer</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  该方法中完成对图层的绘制</span><br><span class="line"> *</span><br><span class="line"> *  @param ctx 图形上下文</span><br><span class="line"> */</span></span><br><span class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));<span class="comment">// 椭圆</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 实心绘制</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>在控制器中使用这个自定义的<code>MyLayer</code>，将图层实例添加到视图中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> myLayerExample];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例自定义 CALayer 的使用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)myLayerExample</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建自定义 layer 实例</span></span><br><span class="line">    My<span class="built_in">CALyer</span> *layer = [My<span class="built_in">CALyer</span> layer];</span><br><span class="line">    <span class="comment">// 设置该 layer 实例</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 绘制该layer</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 调用该方法，layer 的 drawInContext 方法才会被调用</span></span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：实现代理当法"><a href="#方式二：实现代理当法" class="headerlink" title="方式二：实现代理当法"></a>方式二：实现代理当法</h5><blockquote>
<p><strong>说明：</strong>和方式一一样要创建<code>CALayer</code>的子类，但不用实现<code>drawInContext</code>方法，而是设置代理对象（可以是任何类的实例），绘制的过程由代理对象重写<code>drawInContext</code>方法来实现。<br><em>JKLayer.h</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKLayer</span> : <span class="title">CALayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKLayer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKLayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    JKLayer *layer = [JKLayer layer];</span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;<span class="comment">// 不用采纳额外协议，任何对象可以作为代理对象</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 必须调用这个方法，代理对象的 drawLayer方法 才会显被调用</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到父图层</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 代理方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  修改当前ViewController的根Layer</span><br><span class="line"> *  @param layer 图层</span><br><span class="line"> *  @param ctx   绘制上下文</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-2-CAAnimation-动画"><a href="#2-15-2-CAAnimation-动画" class="headerlink" title="2.15.2    CAAnimation 动画"></a>2.15.2    CAAnimation 动画</h3><blockquote>
<p><strong>说明：</strong>基本动画、关键帧动画、组动画</p>
</blockquote>
<table>
<thead>
<tr>
<th>基本动画类型</th>
<th>说明</th>
<th>父类</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CABasicAnimation</code></td>
<td>基础动画</td>
<td>属性动画</td>
<td>平移、旋转、缩放</td>
</tr>
<tr>
<td><code>CAKeyframeAnimation</code></td>
<td>关键帧动画</td>
<td>属性动画</td>
<td>按照某种自定义路径移动</td>
</tr>
<tr>
<td><code>CATransition</code></td>
<td>转场动画</td>
<td><code>CAAnimation</code></td>
<td>不同layer之间的切换</td>
</tr>
<tr>
<td><code>CAAnimationGroup</code></td>
<td>组动画</td>
<td><code>CAAnimation</code></td>
<td>将几个不同的动画放在同一个组里</td>
</tr>
</tbody>
</table>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *layer;<span class="comment">// 用于演示动画的图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 创建图层</span></span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.position = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.backgroundColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;</span><br><span class="line">    <span class="comment">// 添加图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">    <span class="keyword">self</span>.layer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">// [self animationScale];</span></span><br><span class="line">    <span class="comment">// [self animationTranslate];</span></span><br><span class="line">    <span class="comment">// [self animationRotation];</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 基本动画(CABasicAnimation)</span></span><br><span class="line"><span class="comment">// 缩放</span></span><br><span class="line">- (<span class="keyword">void</span>)animationScale</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置 动画</span></span><br><span class="line">    <span class="comment">// keyPath ：决定了基本动画的类型</span></span><br><span class="line">    animation.keyPath = <span class="string">@"bounds"</span>;</span><br><span class="line">    <span class="comment">// toValue 到达哪个点，byValue 增加多少值, fromValue 从哪个点开始移动</span></span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];<span class="comment">// toValue ：到达哪个点</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;<span class="comment">// 动画持续时间</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;<span class="comment">// 动画完毕之后不删除动画（即，可以再次触发）</span></span><br><span class="line">    animation.fillMode = <span class="string">@"forwords"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画到图层</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平移</span></span><br><span class="line">- (<span class="keyword">void</span>)animationTranslate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forwards"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)animationRotation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"transform"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forward"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 关键帧动画</span></span><br><span class="line"><span class="comment">// 让图层做一个圆形移动</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *animation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = k<span class="built_in">CAFillModeForwards</span>;<span class="comment">// 保持最新的状态</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();<span class="comment">// 创建一个可变路径</span></span><br><span class="line">    <span class="built_in">CGPathAddEllipseInRect</span>(path, <span class="literal">NULL</span>, <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>));<span class="comment">// 画一个圆</span></span><br><span class="line">    animation.path = path;<span class="comment">// 设置动画路径</span></span><br><span class="line">    <span class="comment">// CGPathRelease(path);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置动画的执行节奏</span></span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.delegate = <span class="keyword">self</span>;<span class="comment">// 也可以将动画设置工作交给代理对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 组动画</span></span><br><span class="line"><span class="comment">// 组动画</span></span><br><span class="line">- (<span class="keyword">void</span>)animationGroup</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建组动画对象</span></span><br><span class="line">    <span class="comment">// CAAnimationGroup *animationGroup = [CAAnimationGroup animation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建多个动画，添加到组动画（数组）中</span></span><br><span class="line">    <span class="comment">// animationGroup.animations = @[];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    <span class="comment">// [self.layer addAnimation:animationGroup forKey:nil];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-3-转场动画"><a href="#2-15-3-转场动画" class="headerlink" title="2.15.3    转场动画"></a>2.15.3    转场动画</h3><blockquote>
<p><strong>说明：</strong>本课时讲解核心动画的两个子类即<code>转场动画</code>和<code>组动画</code>，并介绍了转场动画的私有 API ，全面理解 <code>CAAnimation</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_animation.gif" alt="Alt text|200x200"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 转场动画</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)exchangeView &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"pageCurl"</span>;<span class="comment">// 翻页效果：私有API的动画类型</span></span><br><span class="line">    animation.subtype = k<span class="built_in">CATransitionFromRight</span>;<span class="comment">// 翻页方向</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 实施动画</span></span><br><span class="line">    [_animView exchangeSubviewAtIndex:<span class="number">0</span> withSubviewAtIndex:<span class="number">1</span>];</span><br><span class="line">    [_animView.layer addAnimation:animation forKey:<span class="string">@"myAnimation"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)pushAction &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"cube"</span>;<span class="comment">// 立体翻转</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 将动画添加到导航控制器视图图层</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController.view.layer addAnimation:animation forKey:<span class="string">@"navAnimation"</span>];</span><br><span class="line">    <span class="comment">// 4. 实施动画</span></span><br><span class="line">    DetailViewController *detailVC = [[DetailViewController alloc] init];<span class="comment">// 创建要导航到的视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController showViewController:detailVC sender:<span class="literal">nil</span>];<span class="comment">// 导航到目标视图控制器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-15-4-实例动画按钮布局"><a href="#2-15-4-实例动画按钮布局" class="headerlink" title="2.15.4    实例动画按钮布局"></a>2.15.4    实例动画按钮布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解转盘动画实例，进行效果展示并完成 <code>UI</code> 布局，介绍了裁剪图片的新方法。</p>
<ol>
<li>导入资源</li>
<li>创建轮盘类（<code>WheelView</code>，继承<code>UIView</code>）</li>
<li>创建轮盘类对应的<code>xib</code>文件</li>
</ol>
<p><strong>要点：</strong> 使用<code>CGImageCreateWithImageInRect</code>裁剪图片</p>
</blockquote>
<h3 id="2-15-5-CADisplayLink实现动画效果"><a href="#2-15-5-CADisplayLink实现动画效果" class="headerlink" title="2.15.5    CADisplayLink实现动画效果"></a>2.15.5    CADisplayLink实现动画效果</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>CADisplayLink</code> 实现动画效果，完善实例动画功能，复习了 <code>CABasicAnimation</code> 的属性和方法。</p>
<p><strong>要点：</strong>使用<code>CADisplayLink</code>通过刷新实现动画，<br><strong>注意：</strong>这里没有使用核心动画，因为它们在动画过程中响应点击的位置并没有真的发生变化。<code>CADisplayLink</code>就可以做到。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_wheel.gif" alt="Alt text"></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/" itemprop="url">
                  1 了解ios项目开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:54:40+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-ios开发前准备"><a href="#1-1-ios开发前准备" class="headerlink" title="1.1    ios开发前准备"></a>1.1    ios开发前准备</h2><h3 id="1-1​-苹果公司介绍"><a href="#1-1​-苹果公司介绍" class="headerlink" title="1.1​    苹果公司介绍"></a>1.1​    苹果公司介绍</h3><blockquote>
<p><strong>重要事件</strong><br>1976年创立<br>1976年推出Apple 1<br>1977年推出Apple 2<br>1980年推出Apple 3<br>1983年推出Apple Lisa<br>1984年推出Macintosh<br>1991年推出PowerBook，2006年被MacBook系列取代<br>1993年推出Apple Newton掌上电脑（已死）</p>
<p><strong>苹果电脑</strong><br>1998年推出iMac<br>2005年推出Mac mini<br>2006年推出Mac Pro<br>2006年推出MacBook（已死）<br>2008年推出MacBook air</p>
<p><strong>苹果音乐播放器</strong><br>2001年推出ipod<br>2004年推出iPod Mini<br>2005年推出iPod nano、iPod Shuffle<br>2007年推出iPod Classic、iPod Touch</p>
<p><strong>苹果手机产品</strong><br>2007年推出iPhone<br>2008年推出iPhone 3G<br>2009年推出iPhone 3GS<br>2010年推出iPhone 4<br>2011年推出iPhone 4s<br>2012年推出iPhone 5<br>2013年推出iPhone 5s、iPhone 5c</p>
<p><strong>苹果公司平板电脑</strong><br>2010年推出iPad<br>2011年推出iPad2<br>2012年推出iPad Mini</p>
<p><strong>苹果电视</strong><br>2006年发布Apple TV</p>
</blockquote>
<h3 id="1-1-2-苹果Mac-OX-操作系统介绍"><a href="#1-1-2-苹果Mac-OX-操作系统介绍" class="headerlink" title="1.1.2  苹果Mac OX 操作系统介绍"></a>1.1.2  苹果Mac OX 操作系统介绍</h3><blockquote>
<p><strong>历史版本</strong><br>2001年从Macintosh电脑上分离出来成为OS X10.0<br>2001年推出OS X 10.1<br>2002年推出OS X 10.2、10.3<br>2005年推出OS X 10.4<br>2006年推出OS X 10.5<br>2008年推出OS X 10.6<br>2010年推出OS X 10.7(App Store)<br>2012年推出OS X 10.8<br>2013年推出OS X 10.9(后台程序省电优化、内存压缩技术)<br>2014年推出OS X 10.10</p>
<p><strong>OS X系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260954919.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-3-苹果ios操作系统"><a href="#1-1-3-苹果ios操作系统" class="headerlink" title="1.1.3    苹果ios操作系统"></a>1.1.3    苹果ios操作系统</h3><blockquote>
<p><strong>历史版本</strong><br>2007年发布iPhone Runs OS X<br>2008年改名为iPhone OS<br>2010年改名为ios，发布ios4（多任务）<br>2011年发布ios5<br>2012年发布ios6<br>2013年发布ios7(扁平化)<br>2014年发布ios8</p>
<p><strong>ios系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260989517.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-4-软硬件开发环境要求"><a href="#1-1-4-软硬件开发环境要求" class="headerlink" title="1.1.4    软硬件开发环境要求"></a>1.1.4    软硬件开发环境要求</h3><blockquote>
<p><strong>硬件环境</strong><br>CPU双核<br>内存8G<br>最好选择Macbook Pro,也可以使用Macbook Air<br>测试手机iPhone 5+(发布)</p>
<p><strong>环境要求</strong><br>OS X 10.9.3+<br>Xcode 6.0+</p>
</blockquote>
<h2 id="1-2-Xcode继承开发环境的安装使用与项目建立流程"><a href="#1-2-Xcode继承开发环境的安装使用与项目建立流程" class="headerlink" title="1.2    Xcode继承开发环境的安装使用与项目建立流程"></a>1.2    Xcode继承开发环境的安装使用与项目建立流程</h2><h3 id="1-2-1-xcode的下载和安装"><a href="#1-2-1-xcode的下载和安装" class="headerlink" title="1.2.1    xcode的下载和安装"></a>1.2.1    xcode的下载和安装</h3><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>AppStore</li>
<li>开发者中心下载链接：<a href="https://developer.apple.com/xcode/downloads" target="_blank" rel="external">https://developer.apple.com/xcode/downloads</a></li>
</ul>
</blockquote>
<h3 id="1-2-2-xcode创建ios-single-view项目"><a href="#1-2-2-xcode创建ios-single-view项目" class="headerlink" title="1.2.2    xcode创建ios single view项目"></a>1.2.2    xcode创建ios single view项目</h3><h3 id="1-2-3-工作空间创建和使用"><a href="#1-2-3-工作空间创建和使用" class="headerlink" title="1.2.3    工作空间创建和使用"></a>1.2.3    工作空间创建和使用</h3><h3 id="1-2-4-xcode快捷键及常用功能"><a href="#1-2-4-xcode快捷键及常用功能" class="headerlink" title="1.2.4    xcode快捷键及常用功能"></a>1.2.4    xcode快捷键及常用功能</h3><blockquote>
<p><strong>常用</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>option + cmd + 向上箭头</td>
<td>m/h文件切换</td>
</tr>
<tr>
<td>ctrl + a</td>
<td>光标移动到行头</td>
</tr>
<tr>
<td>ctrl + e</td>
<td>光标移动到行末</td>
</tr>
<tr>
<td>command + G</td>
<td>查找下一个</td>
</tr>
<tr>
<td>command + w</td>
<td>关闭一个文件</td>
</tr>
<tr>
<td>option + command + m</td>
<td>窗口最小化</td>
</tr>
<tr>
<td>command + /</td>
<td>注释</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>调试</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>alt + command + y</td>
<td>degug 调试</td>
</tr>
<tr>
<td>alt + command + R</td>
<td>Run运行</td>
</tr>
<tr>
<td>alt + command + p</td>
<td>到下一个断点</td>
</tr>
<tr>
<td>shift + cmd + o</td>
<td>执行下一步(step over)</td>
</tr>
<tr>
<td>shift + cmd + i</td>
<td>执行进入函数(step into)</td>
</tr>
<tr>
<td>shift + cmd + t</td>
<td>step out</td>
</tr>
<tr>
<td>command + /</td>
<td>取消断点</td>
</tr>
<tr>
<td>command + shift + F</td>
<td>查找</td>
</tr>
<tr>
<td>command + enter</td>
<td>等于bulid and debug</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>移动</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>control＋F</td>
<td>在同一行上将光标向右移动</td>
</tr>
<tr>
<td>control＋B</td>
<td>在同一行上将光标向左移动</td>
</tr>
<tr>
<td>control＋P</td>
<td>将光标移动到前一行</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到后一行</td>
</tr>
<tr>
<td>control＋A</td>
<td>将光标移动到本行的行首</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到本行的行尾</td>
</tr>
<tr>
<td>control＋T</td>
<td>将光标两边的字符对调</td>
</tr>
<tr>
<td>control＋D</td>
<td>删除光标右边的字符</td>
</tr>
<tr>
<td>control＋k 删除光标所在行 光标后面的代码，便于你重写行尾代码</td>
</tr>
<tr>
<td>control + L</td>
<td>将光标插点置于窗口正中</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>缩进</strong></p>
<ul>
<li>第一种方法：选中需要缩进的代码，按住control键后单击光标，出现pop菜单，然后选择Re-indent selection。</li>
<li>第二种方法：选择需要调整的代码，同时按下<code>command＋［ （左移动代码）</code>或 <code>command＋］（右移动代码）</code>。</li>
</ul>
</blockquote>
<h3 id="1-2-5-xcode中创建os-x命令行控制台项目"><a href="#1-2-5-xcode中创建os-x命令行控制台项目" class="headerlink" title="1.2.5    xcode中创建os x命令行控制台项目"></a>1.2.5    xcode中创建os x命令行控制台项目</h3><h3 id="1-2-6-xcode中创建os-x窗体程序项目"><a href="#1-2-6-xcode中创建os-x窗体程序项目" class="headerlink" title="1.2.6    xcode中创建os x窗体程序项目"></a>1.2.6    xcode中创建os x窗体程序项目</h3><h3 id="1-2-7-xcode中创建os-x游戏项目"><a href="#1-2-7-xcode中创建os-x游戏项目" class="headerlink" title="1.2.7    xcode中创建os x游戏项目"></a>1.2.7    xcode中创建os x游戏项目</h3><h3 id="1-2-8-xcode中创建ios游戏项目"><a href="#1-2-8-xcode中创建ios游戏项目" class="headerlink" title="1.2.8    xcode中创建ios游戏项目"></a>1.2.8    xcode中创建ios游戏项目</h3><h2 id="1-3-Xcode常用项目模版"><a href="#1-3-Xcode常用项目模版" class="headerlink" title="1.3    Xcode常用项目模版"></a>1.3    Xcode常用项目模版</h2><blockquote>
<p><strong>说明：</strong><code>5</code>种</p>
<ul>
<li>Master-Detail Application：<code>列表页-详情页</code>类型</li>
<li>Page-Based Application：<code>电子书</code>类型</li>
<li>Single View Application：</li>
<li>Tabbed Application</li>
<li>Game</li>
</ul>
</blockquote>
<h3 id="1-3-1-Master-Detail-Application"><a href="#1-3-1-Master-Detail-Application" class="headerlink" title="1.3.1    Master-Detail Application"></a>1.3.1    Master-Detail Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.26.53.png" alt="Alt text"></p>
<h3 id="1-3-2-Page-Based-Application"><a href="#1-3-2-Page-Based-Application" class="headerlink" title="1.3.2    Page-Based Application"></a>1.3.2    Page-Based Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.38.45.png" alt="Alt text"></p>
<h3 id="1-3-3-Tabbed-Application"><a href="#1-3-3-Tabbed-Application" class="headerlink" title="1.3.3    Tabbed Application"></a>1.3.3    Tabbed Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.56.30.png" alt="Alt text"></p>
<h2 id="1-4-ios用户界面开发基本流程"><a href="#1-4-ios用户界面开发基本流程" class="headerlink" title="1.4    ios用户界面开发基本流程"></a>1.4    ios用户界面开发基本流程</h2><h3 id="1-4-1-StoryBoard的基本使用方法"><a href="#1-4-1-StoryBoard的基本使用方法" class="headerlink" title="1.4.1    StoryBoard的基本使用方法"></a>1.4.1    StoryBoard的基本使用方法</h3><blockquote>
<p><strong>说明：</strong><code>Storybiard(故事版)</code>是<code>Xcode4.2</code>才开始支持的，为了使设计<code>View</code>更加容易。</p>
</blockquote>
<ul>
<li>可以在<code>Info.plist</code>文件中设置应用启动时首次加载的<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%885.08.53.png" alt="Alt text"></li>
<li>一个应用中可以有多个<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8810.48.12.png" alt="Alt text"></li>
<li><code>storyboard</code>中指出了首先会被加载的<code>view</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.42.10.png" alt="Alt text"></li>
<li>查看视图控制器绑定的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.48.33.png" alt="Alt text"></li>
<li>在多个视图之间建立动作关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-storyboard-1.gif" alt="Alt text"></li>
</ul>
<h3 id="1-4-2-图片控件"><a href="#1-4-2-图片控件" class="headerlink" title="1.4.2    图片控件"></a>1.4.2    图片控件</h3><blockquote>
<p><strong>说明：</strong>在<code>xcode</code>中图片控件的创建和使用</p>
</blockquote>
<ol>
<li>将本地的图片拖入到项目中<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img.gif" alt="Alt text"></li>
<li>创建<code>Image View</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img-02.gif" alt="Alt text"></li>
</ol>
<h3 id="1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码"><a href="#1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码" class="headerlink" title="1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码"></a>1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码</h3><blockquote>
<p><strong>说明：</strong><code>程序</code>和<code>控件</code>的绑定，有两种方式</p>
</blockquote>
<h4 id="方式1：ios-UI界面设计中传统方法"><a href="#方式1：ios-UI界面设计中传统方法" class="headerlink" title="方式1：ios UI界面设计中传统方法"></a>方式1：ios UI界面设计中传统方法</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>在<code>Controller</code>中定义<code>@IBOutlet</code>修饰的引用控件的属性</li>
<li>通过拖动建立<code>@IBOutlet</code>引用的控件和属性所在类文件之间的关联</li>
<li>在<code>Controller</code>中通过<code>@IBOutlet</code>属性使用控件</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bind.gif" alt="Alt text"></p>
</blockquote>
<h4 id="方式2：借助Assistant-editor绑定代码"><a href="#方式2：借助Assistant-editor绑定代码" class="headerlink" title="方式2：借助Assistant editor绑定代码"></a>方式2：借助<code>Assistant editor</code>绑定代码</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>打开辅助窗口</li>
<li>拖线</li>
<li>设置关联</li>
<li>connect</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bond2.gif" alt="Alt text"></p>
</blockquote>
<h3 id="1-4-4-ios-Story-Board控制事件绑定"><a href="#1-4-4-ios-Story-Board控制事件绑定" class="headerlink" title="1.4.4    ios Story Board控制事件绑定"></a>1.4.4    ios Story Board控制事件绑定</h3><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>编写<code>@IBAction</code></li>
<li>在<code>storyboard</code>中通过拖动在控件与<code>controller</code>中相应的<code>IBAction</code>之间建立关联</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-event.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 和按钮建立关联的点击事件响应函数</span></span><br><span class="line">    @IBAction func btnClicked(sender:AnyObject) &#123;</span><br><span class="line">        print(<span class="string">"clicked"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-5-iOS-Storyboard控件与Swift类绑定"><a href="#1-4-5-iOS-Storyboard控件与Swift类绑定" class="headerlink" title="1.4.5    iOS Storyboard控件与Swift类绑定"></a>1.4.5    iOS Storyboard控件与Swift类绑定</h3><blockquote>
<p><strong>说明：</strong>新添加的<code>Storyboard</code>控件默认并没有和自定义的类绑定，和自定义的类绑定就可以通过代码自定义该控件</p>
<ol>
<li>设置绑定的类的类名<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-09%20%E4%B8%8B%E5%8D%8811.53.07.png" alt="Alt text"></li>
<li>对应的自定义类中要实现父类的必要构造器（如果有的话）</li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 必须重写该 必要构造器</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-6-ios源代码添加控件"><a href="#1-4-6-ios源代码添加控件" class="headerlink" title="1.4.6    ios源代码添加控件"></a>1.4.6    ios源代码添加控件</h3><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	...</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个控件</span></span><br><span class="line">        var label = <span class="built_in">UILabel</span>(frame: <span class="built_in">CGRect</span>(x: <span class="number">50</span>, y: <span class="number">50</span>, width: <span class="number">200</span>, height: <span class="number">100</span>))</span><br><span class="line">        <span class="comment">// 设置控件</span></span><br><span class="line">        label.text = <span class="string">"Hello jikexueyuan"</span></span><br><span class="line">        <span class="comment">// 将控件添加到视图</span></span><br><span class="line">        view.addSubview(label)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<h3 id="1-4-7-ios浏览器开发制作"><a href="#1-4-7-ios浏览器开发制作" class="headerlink" title="1.4.7    ios浏览器开发制作"></a>1.4.7    ios浏览器开发制作</h3><blockquote>
<p><strong>说明：</strong>需要解决<code>http</code>请求受限的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.55.08.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.54.48.png" alt="Alt text"><br><img src="./屏幕快照 2016-02-10 上午1.59.15.png" alt="Alt text"></p>
<h2 id="1-5-ios自定义控件实例"><a href="#1-5-ios自定义控件实例" class="headerlink" title="1.5    ios自定义控件实例"></a>1.5    ios自定义控件实例</h2><h3 id="1-5-1-配置iOS自定义控件属性"><a href="#1-5-1-配置iOS自定义控件属性" class="headerlink" title="1.5.1    配置iOS自定义控件属性"></a>1.5.1    配置iOS自定义控件属性</h3><blockquote>
<p><strong>说明：</strong><code>Xcode</code>提供的所有控件都可以在<code>Storyboard</code>中进行一系列的配置。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%886.02.15.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-button.gif" alt="Alt text"></p>
<h3 id="1-5-2-自定义原型进度指示控件实例"><a href="#1-5-2-自定义原型进度指示控件实例" class="headerlink" title="1.5.2    自定义原型进度指示控件实例"></a>1.5.2    自定义原型进度指示控件实例</h3><blockquote>
<p><strong>说明：</strong>使用绘图<code>API</code>编写自定义一个进度条控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%8811.38.03.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
</blockquote>
<p><code>ProgressBar.swift</code></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ProgressBar: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">        <span class="comment">// 设置背景透明</span></span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = <span class="built_in">UIColor</span>(white: <span class="number">1</span>, alpha: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进度值</span></span><br><span class="line">    private var _progressValue: <span class="built_in">CGFloat</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意：不可以在某个实体中定义访问级别更高的实体</span></span><br><span class="line">    internal func getProgressValue() -&gt; <span class="built_in">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> _progressValue</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    internal func setProgressValue (value: <span class="built_in">CGFloat</span>) &#123;</span><br><span class="line">        _progressValue = value</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 改变值后需要重绘</span></span><br><span class="line">        setNeedsDisplay()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 控件绘制函数</span></span><br><span class="line">    <span class="comment">// Only override drawRect: if you perform custom drawing.</span></span><br><span class="line">    <span class="comment">// An empty implementation adversely affects performance during animation.</span></span><br><span class="line">    override func drawRect(rect: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="comment">// Drawing code</span></span><br><span class="line">        <span class="comment">// 获得当前图形绘制的上下文</span></span><br><span class="line">        let ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="comment">// 半径</span></span><br><span class="line">        let r = rect.width / <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 绘制圆</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 设置圆的填充色：灰色、不透明</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加一段弧形弧形</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span> * _progressValue , <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 添加一条线</span></span><br><span class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, r, r)</span><br><span class="line">        <span class="comment">// 设置扇形的填充色</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 绘制</span></span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var pc: ProgressBar!</span><br><span class="line">    <span class="comment">// 响应AddProgress点击</span></span><br><span class="line">    @IBAction func addProgressBtnPressed(sender: AnyObject) &#123;</span><br><span class="line">        pc.setProgressValue(pc.getProgressValue() + <span class="number">0.1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="comment">// 创建进度条</span></span><br><span class="line">        pc = ProgressBar(frame: <span class="built_in">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">100</span>, height: <span class="number">100</span>))</span><br><span class="line">        pc.setProgressValue(<span class="number">0.2</span>)</span><br><span class="line">        <span class="comment">// 将该进度条添加到所在控制器绑定的视图中</span></span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(pc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override func didReceiveMemoryWarning() &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-实时预览自定义控件效果"><a href="#1-5-3-实时预览自定义控件效果" class="headerlink" title="1.5.3    实时预览自定义控件效果"></a>1.5.3    实时预览自定义控件效果</h3><blockquote>
<p><strong>说明：</strong><code>自定义控件</code>也可以使用<code>Storyboard</code>设置。步骤如下<br><strong>意义：</strong>开发人员通过代码开发的<code>自定义控件</code>，也可以交给设计人员通过<code>Storyboard</code>进行设计了<br><strong>相关指令：</strong>用来和<code>Storyboard</code>建立关联</p>
</blockquote>
<table>
<thead>
<tr>
<th>指令</th>
<th>修饰目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@IBDesignable</code></td>
<td><code>class</code></td>
<td>使被修饰的类可以通过<code>Storyboard</code>设置</td>
</tr>
<tr>
<td><code>@IBInspectable</code></td>
<td>属性</td>
<td>使被修饰的属性可以在<code>Storyboard</code>中设置</td>
</tr>
</tbody>
</table>
<ol>
<li>在<code>Project</code>中创建新<code>target</code>（自定义需要在单独的<code>target</code>中才能被<code>Storyboard</code>管理）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-custom.gif" alt="Alt text"></li>
<li>在新创建的<code>target</code>中创建自定义控件的类（<code>@IBDesignable</code>），类中可以设置一些可在<code>Storyboard</code>设置的属性（<code>@IBInspectable</code>）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.13.21.png" alt="Alt text"></li>
</ol>
<p><em>MyView.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">@IBDesignable class MyView: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写必要构造器（否则不会被Storyboard初始化）</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义一些可以在Storyboard中设置的项</span></span><br><span class="line">    @IBInspectable var str: String = <span class="string">"Hello"</span><span class="comment">// 字符串</span></span><br><span class="line">    @IBInspectable var borderWidth: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框宽度</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderWidth = borderWidth</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var borderColor: <span class="built_in">UIColor</span> = <span class="built_in">UIColor</span>.clearColor() &#123;<span class="comment">// 边框颜色</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderColor = borderColor.CGColor</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var cornerRadius: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框圆角</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.cornerRadius = cornerRadius</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>Storyboard</code>中添加一个<code>View</code>（控件），并设置关联的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.04.07.png" alt="Alt text"></li>
</ol>
<h2 id="1-6-使用StoryBoard做ios-UI界面跳转"><a href="#1-6-使用StoryBoard做ios-UI界面跳转" class="headerlink" title="1.6    使用StoryBoard做ios UI界面跳转"></a>1.6    使用StoryBoard做ios UI界面跳转</h2><h3 id="1-6-1-用iOS-Storyboard做界面跳转"><a href="#1-6-1-用iOS-Storyboard做界面跳转" class="headerlink" title="1.6.1    用iOS Storyboard做界面跳转"></a>1.6.1    用iOS Storyboard做界面跳转</h3><blockquote>
<p><strong>说明：</strong>跳转到下一个<code>view</code>并且能够返回<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_switch.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-6-1-2-跳转到下一页"><a href="#1-6-1-2-跳转到下一页" class="headerlink" title="1.6.1.2    跳转到下一页"></a>1.6.1.2    跳转到下一页</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_next.gif" alt="Alt text"></p>
<h4 id="1-6-1-3-返回"><a href="#1-6-1-3-返回" class="headerlink" title="1.6.1.3    返回"></a>1.6.1.3    返回</h4><blockquote>
<p><strong>说明：</strong>使用<code>IBAction</code>结合<code>dismissViewControllerAnimated</code>方法，步骤如下</p>
<ol>
<li>新建一个和第二个<code>view</code>关联的类（<code>UIViewController</code>子类）</li>
<li>结合<code>辅助窗口</code>在第二个<code>view controller</code>做<code>IBAction</code>并在响应方法中调用<code>dismissViewControllerAnimated</code><br><em>ImgViewController.swift</em></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ImgViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func backBtnClicked(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;() -&gt; Void <span class="keyword">in</span></span><br><span class="line">            print(<span class="string">"return"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// storyboard载入时调用的初始化方法</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-使用nib文件做iOS界面设计"><a href="#1-6-2-使用nib文件做iOS界面设计" class="headerlink" title="1.6.2    使用nib文件做iOS界面设计"></a>1.6.2    使用nib文件做iOS界面设计</h3><blockquote>
<p><strong>说明：</strong><code>Xcode4</code>之后<code>IB(Interface Builder)</code>和<code>Xcode</code>才集成在一起。使用方式如下</p>
<ol>
<li><p>创建<code>Cocoa class</code>时勾选<code>Alse create XIB File</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8B%E5%8D%885.22.14.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.47.13.png" alt="Alt text"></p>
</li>
<li><p>使用<code>presentModalViewController方法</code>从<code>Storyboard</code>管理的<code>view</code>跳转到<code>nib</code>管理的<code>view</code></p>
</li>
</ol>
<p><strong>注意：</strong>传统使用的是<code>nib</code>（而不是<code>Storyboard</code>）进行界面设计的。<code>nib</code>的操作方式和<code>Storyboard</code>中单个<code>view</code>类似。</p>
</blockquote>
<hr>
<p><em>ViewControllew.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.58.26.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 下一个view</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>MyViewController.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.59.55.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-在iOS界面间传递数据"><a href="#1-6-3-在iOS界面间传递数据" class="headerlink" title="1.6.3    在iOS界面间传递数据"></a>1.6.3    在iOS界面间传递数据</h3><blockquote>
<p><strong>说明：</strong>本质上只是为和下一个<code>view</code>绑定的<code>controller</code>设置一个属性。<br><strong>扩展：</strong>也可以在后一个<code>view</code>通过<code>parentViewController</code>访问前一个<code>view</code></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.16.29.png" alt="Alt text"></p>
<p><em>ViewControllew.swift：设置信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输入框</span></span><br><span class="line">    @IBOutlet var input: <span class="built_in">UITextField</span>!</span><br><span class="line">    <span class="comment">// 下一页</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 设置信息</span></span><br><span class="line">        vc.labelContent = input.text!</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>MyViewControllew.swift：展示信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    var labelContent: String = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var myLabel: <span class="built_in">UILabel</span>!</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        myLabel.text = labelContent<span class="comment">// 展示信息</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-7-屏幕适配"><a href="#1-7-屏幕适配" class="headerlink" title="1.7    屏幕适配"></a>1.7    屏幕适配</h2><blockquote>
<p><strong>变动：</strong>在<code>Xcode 7</code>中，<code>Editor(menu)-&gt;Pin</code>消失了，该菜单项中原本有一些样式设计功能。</p>
</blockquote>
<h3 id="1-7-1-匹配父级容器"><a href="#1-7-1-匹配父级容器" class="headerlink" title="1.7.1    匹配父级容器"></a>1.7.1    匹配父级容器</h3><blockquote>
<p><strong>说明：</strong>就是让<code>目标容器</code>以他的<code>父级容器</code>为参照系进行设置<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.56.36.png" alt="Alt text"><br><strong>扩展：</strong>控件<code>UIImageVIew</code>可以设置其中图片的铺排模式<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-14%20%E4%B8%8A%E5%8D%8812.00.37.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-7-2-分割父级容器"><a href="#1-7-2-分割父级容器" class="headerlink" title="1.7.2    分割父级容器"></a>1.7.2    分割父级容器</h3><blockquote>
<p><strong>说明：</strong>指的是多个兄弟<code>view</code>使用父级<code>view</code>的方式。<br><strong>扩展：</strong><code>Xcode 7</code>推出了一种新的方式<code>stack view</code>，来进行布局管理，可以将多个<code>view</code>作为一个组合进行操作。<br><strong>技巧：</strong><code>stack view</code>可以取代之前需要<code>Horizontal Space</code>（连个<code>view</code>之间的水平间距）的场景</p>
</blockquote>
<h4 id="1-7-2-1-左边固定，右边自适应"><a href="#1-7-2-1-左边固定，右边自适应" class="headerlink" title="1.7.2.1    左边固定，右边自适应"></a>1.7.2.1    左边固定，右边自适应</h4><blockquote>
<p><strong>约束：</strong>设置以下约束</p>
<ul>
<li>两个<code>View</code>之间：<code>Horizontal Spacing</code></li>
<li>左边<code>View</code>：<code>leading</code>、<code>top</code></li>
<li>右边<code>View</code>：<code>tailing</code>、<code>top</code></li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.12.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%888.00.01.png" alt="Alt text"></p>
<h4 id="1-7-2-2-多个View按比例"><a href="#1-7-2-2-多个View按比例" class="headerlink" title="1.7.2.2    多个View按比例"></a>1.7.2.2    多个<code>View</code>按比例</h4><blockquote>
<p><strong>说明：</strong>2个或更多个<code>View</code>的宽度（或高度）按一定比例分割父级容器的剩余空间<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8A%E5%8D%889.51.01.png" alt="Alt text"></p>
</blockquote>
<p><img src="./http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.27.png" alt="Alt text"></p>
<h3 id="1-7-3-复杂布局适配"><a href="#1-7-3-复杂布局适配" class="headerlink" title="1.7.3    复杂布局适配"></a>1.7.3    复杂布局适配</h3><blockquote>
<p><strong>说明：</strong>上部左右均分，下部占用剩余部分<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.53.19.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%886.05.43.png" alt="Alt text"> </p>
</blockquote>
<p><em>底层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.58.22.png" alt="Alt text"></p>
<p><em>顶层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%889.41.32.png" alt="Alt text"></p>
<h2 id="1-8-iOS平台常用传感器"><a href="#1-8-iOS平台常用传感器" class="headerlink" title="1.8    iOS平台常用传感器"></a>1.8    iOS平台常用传感器</h2><h4 id="CMMotionManager类"><a href="#CMMotionManager类" class="headerlink" title="CMMotionManager类"></a>CMMotionManager类</h4><blockquote>
<p><strong>说明：</strong>管理传感器的类。<br><strong>库：</strong><code>CoreMotion</code></p>
</blockquote>
<h3 id="1-8-1-iOS平台加速度传感器的使用方式"><a href="#1-8-1-iOS平台加速度传感器的使用方式" class="headerlink" title="1.8.1    iOS平台加速度传感器的使用方式"></a>1.8.1    iOS平台加速度传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>可以获得三个方向上的加速度。</p>
</blockquote>
<table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>accelerometerAvailable</td>
<td>Bool</td>
<td>加速器是否可用</td>
</tr>
<tr>
<td>accelerometerUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startAccelerometerUpdatesToQueue</td>
<td>func</td>
<td>启动加速器</td>
</tr>
<tr>
<td>stopAccelerometerUpdates</td>
<td>func</td>
<td>停止加速器</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>加速度传感器<code>启动</code>后，应当在适当的时候<code>停掉</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取减速器数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 加速度 */</span></span><br><span class="line">        cmm.accelerometerUpdateInterval = <span class="number">1</span><span class="comment">// 每秒获取的次数</span></span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerAvailable &amp;&amp; !cmm.accelerometerActive &#123;</span><br><span class="line">            <span class="comment">// start后一定要stop</span></span><br><span class="line">            cmm.startAccelerometerUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMAccelerometerData</span>?, err:<span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"AccesslateData: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"加速器传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦测加速度</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerActive &amp;&amp; cmm.accelerometerActive &#123;</span><br><span class="line">            cmm.stopAccelerometerUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-2-iOS平台陀螺仪的使用方式"><a href="#1-8-2-iOS平台陀螺仪的使用方式" class="headerlink" title="1.8.2    iOS平台陀螺仪的使用方式"></a>1.8.2    iOS平台陀螺仪的使用方式</h3><table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>gyroAvailable</td>
<td>Bool</td>
<td>陀螺仪是否可用</td>
</tr>
<tr>
<td>gyroUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startGyroUpdatesToQueue</td>
<td>func</td>
<td>开始读区陀螺仪数据</td>
</tr>
<tr>
<td>stopGyroUpdates</td>
<td>func</td>
<td>停止读取陀螺仪数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取陀螺仪数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        cmm.gyroUpdateInterval = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroAvailable &amp;&amp; !cmm.gyroActive &#123;</span><br><span class="line">            cmm.startGyroUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMGyroData</span>?, err: <span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Gyno data: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"陀螺仪传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测陀螺仪</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroActive &amp;&amp; cmm.gyroActive &#123;</span><br><span class="line">            cmm.stopGyroUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-3-iOS平台距离传感器的使用方式"><a href="#1-8-3-iOS平台距离传感器的使用方式" class="headerlink" title="1.8.3    iOS平台距离传感器的使用方式"></a>1.8.3    iOS平台距离传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">     <span class="comment">/**</span><br><span class="line">     * 开始侦听距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().proximityMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听距离传感器</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="type">Selector</span>(<span class="string">"proximityChanged"</span>), name: <span class="type">UIDeviceProximityStateDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到proximityChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 距离变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">proximityChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().proximityState)"</span>)<span class="comment">// 距离传感器前是否有障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-4-iOS平台电源传感器的使用方式"><a href="#1-8-4-iOS平台电源传感器的使用方式" class="headerlink" title="1.8.4    iOS平台电源传感器的使用方式"></a>1.8.4    iOS平台电源传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().batteryMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听电量</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="string">"levelChanged"</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到levelChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 电量变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">levelChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().batteryLevel)"</span>)<span class="comment">// 0～1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 移除当前view中的所有电量侦听任务</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">	    stopListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-5-iOS平台磁场传感器的使用方式"><a href="#1-8-5-iOS平台磁场传感器的使用方式" class="headerlink" title="1.8.5    iOS平台磁场传感器的使用方式"></a>1.8.5    iOS平台磁场传感器的使用方式</h3><h4 id="CLLocationManager类"><a href="#CLLocationManager类" class="headerlink" title="CLLocationManager类"></a>CLLocationManager类</h4><table>
<thead>
<tr>
<th>相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>delegate</td>
<td>Class(采纳CLLocationManagerDelegate协议)</td>
<td>委托对象</td>
</tr>
<tr>
<td>startUpdatingHeading</td>
<td>func</td>
<td>开始侦测方位数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">CLLocationManagerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* 1. 声明方位管理器 */</span></span><br><span class="line">    <span class="keyword">var</span> lm:<span class="type">CLLocationManager</span>!</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="comment">/* 2. 初始化方位管理器 */</span></span><br><span class="line">        lm = <span class="type">CLLocationManager</span>()</span><br><span class="line">        lm.delegate = <span class="keyword">self</span><span class="comment">// 指定 delegate（需要采纳CLLocationManagerDelegate协议）</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 3. view渲染时启动侦测 */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 启动任务：不断获取指南针数据</span></span><br><span class="line">        lm.startUpdatingHeading()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 采纳协议（CLLocationManagerDelegate）</span><br><span class="line">    * 当方位发生变化时调用该方法</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">locationManager</span><span class="params">(manager: CLLocationManager, didUpdateHeading newHeading: CLHeading)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(newHeading)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-6-使用磁场传感器制作指南针实例"><a href="#1-8-6-使用磁场传感器制作指南针实例" class="headerlink" title="1.8.6    使用磁场传感器制作指南针实例"></a>1.8.6    使用磁场传感器制作指南针实例</h3><h2 id="1-9-多点触控"><a href="#1-9-多点触控" class="headerlink" title="1.9    多点触控"></a>1.9    多点触控</h2><h3 id="1-9-1-触摸事件处理"><a href="#1-9-1-触摸事件处理" class="headerlink" title="1.9.1    触摸事件处理"></a>1.9.1    触摸事件处理</h3><blockquote>
<p><strong>说明：</strong>触摸事件分4种，分别对应四种方法（<code>ViewController</code>的成员方法）</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>touchesBegin</td>
<td>手指接触屏幕</td>
</tr>
<tr>
<td>touchesCancel</td>
<td>系统事件打断了触摸事件时</td>
</tr>
<tr>
<td>touchesEnded</td>
<td>手指离开屏幕</td>
</tr>
<tr>
<td>touchesMoved</td>
<td>手指在屏幕上滑动</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesBegin"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        <span class="comment">// 获得在滑动屏幕时手指所在的区域的坐标（只获得了其中一个手指的）</span></span><br><span class="line">        touches.first?.locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesEnded</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesEnded"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesCancelled</span><span class="params">(touches: Set&lt;UITouch&gt;?, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesCancelled"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-2-处理多个触摸点"><a href="#1-9-2-处理多个触摸点" class="headerlink" title="1.9.2    处理多个触摸点"></a>1.9.2    处理多个触摸点</h3><blockquote>
<p><strong>技巧：</strong>可以在模拟器中模拟多点触控，方式是鼠标在模拟器上滑动式按住<code>alt(option)</code>键。<br><strong>注意：</strong>程序默认不启动对多点触控的支持，需要在代码中设置开启多点触控。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得触摸点数量</span></span><br><span class="line">        <span class="built_in">print</span>(touches.<span class="built_in">count</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得每个触摸点在滑动屏幕时所在的区域的坐标</span></span><br><span class="line">        <span class="keyword">for</span> touch <span class="keyword">in</span> touches &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(touch.locationInView(self.view))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-3-缩放图片实例"><a href="#1-9-3-缩放图片实例" class="headerlink" title="1.9.3    缩放图片实例"></a>1.9.3    缩放图片实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_touch.gif" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var lastDistance: Float = <span class="number">0.0</span><span class="comment">// 两个触摸点之间的距离</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var iv: <span class="built_in">UIImageView</span>!<span class="comment">// 图片控件</span></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesBegan(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        lastDistance = <span class="number">0.0</span><span class="comment">// 用户开始触摸屏幕时设置初始值</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesMoved(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        <span class="comment">// 判断是不是两点触控</span></span><br><span class="line">        <span class="keyword">if</span> touches.count == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="comment">// 对 Set 排序，才能通过下标进行索引</span></span><br><span class="line">            var touchesSorted = touches.sort(&#123;s1, s2 <span class="keyword">in</span> s1.tapCount.bigEndian &gt; s1.tapCount.bigEndian&#125;)</span><br><span class="line">            <span class="comment">// 通过勾股定理计算两点之间的距离</span></span><br><span class="line">            let p1 = touchesSorted[<span class="number">0</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let p2 = touchesSorted[<span class="number">1</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let xx = p1.x - p2.x</span><br><span class="line">            let yy = p1.y - p2.y</span><br><span class="line">            </span><br><span class="line">            let curDistance = Float(sqrt(xx * xx + yy * yy))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 首次缩放触摸操作</span></span><br><span class="line">            <span class="keyword">if</span> lastDistance == <span class="number">0.0</span> &#123;</span><br><span class="line">                lastDistance = curDistance</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 缩小</span></span><br><span class="line">                <span class="keyword">if</span> lastDistance - curDistance &gt; <span class="number">5</span> &#123;</span><br><span class="line">                    print(<span class="string">"缩小"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">0.9</span>, <span class="number">0.9</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 放大</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> lastDistance - curDistance &lt; <span class="number">-5</span>&#123;</span><br><span class="line">                    print(<span class="string">"放大"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">1.1</span>, <span class="number">1.1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-10-常用其它功能"><a href="#1-10-常用其它功能" class="headerlink" title="1.10    常用其它功能"></a>1.10    常用其它功能</h2><h3 id="1-10-1-打开网页"><a href="#1-10-1-打开网页" class="headerlink" title="1.10.1    打开网页"></a>1.10.1    打开网页</h3><blockquote>
<p><strong>说明：</strong>在<code>Safari</code>中打开指定连接<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S_call.gif" alt="Alt text"><br><strong>相关类：</strong><code>UIApplication</code></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">openJikexueyuanPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-2-常用打开操作（发邮件、打电话、发短信）"><a href="#1-10-2-常用打开操作（发邮件、打电话、发短信）" class="headerlink" title="1.10.2    常用打开操作（发邮件、打电话、发短信）"></a>1.10.2    常用打开操作（发邮件、打电话、发短信）</h3><blockquote>
<p><strong>说明：</strong>和打开网页类似，只是使用的<code>URL</code>协议不同</p>
</blockquote>
<p><em>ViewController.swift</em> </p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 发短信</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendSMSBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"sms://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 打电话</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCallBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"tel://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发邮件</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendMailBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"mailto://xx@jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-3-自定义打开协议"><a href="#1-10-3-自定义打开协议" class="headerlink" title="1.10.3    自定义打开协议"></a>1.10.3    自定义打开协议</h3><blockquote>
<p><strong>说明：</strong>可以通过自定一些<code>URL</code>协议<br><strong>案例：</strong>通过自定义的<code>URL</code>协议<code>ime</code>打开另一个<code>App</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_handler.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-10-3-1-注册协议的app"><a href="#1-10-3-1-注册协议的app" class="headerlink" title="1.10.3.1    注册协议的app"></a>1.10.3.1    注册协议的app</h4><ol>
<li><p>在<code>Info.list</code>中设置一个<code>URL Schemes</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-25%20%E4%B8%8B%E5%8D%889.42.43.png" alt="Alt text"></p>
</li>
<li><p>创建要被协议打开的<code>View</code>（带有<code>xib</code>）<br><em>LabelViewController.swift</em></p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> myLabel: <span class="type">UILabel</span>!</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>LabelViewController.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.55.25.png" alt="Alt text"></p>
<ol>
<li><code>AppDelegate.swift</code>：实现通过URL打开该<code>App</code>的构造函数</li>
</ol>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// 为自定义的URL协议注册实现</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, handleOpenURL url: NSURL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// 从应用的LabelViewController.xib指定的view启动</span></span><br><span class="line">        <span class="keyword">let</span> vc = <span class="type">LabelViewController</span>(nibName: <span class="string">"LabelViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        window?.addSubview(vc.view)</span><br><span class="line">        <span class="comment">// 设置view</span></span><br><span class="line">        vc.myLabel.text = <span class="string">"\(url)"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-10-3-2-通过协议打开app"><a href="#1-10-3-2-通过协议打开app" class="headerlink" title="1.10.3.2    通过协议打开app"></a>1.10.3.2    通过协议打开app</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.58.00.png" alt="Alt text"></p>
<p><em>viewcontroller.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ime</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">callImePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"ime://i.loce.you?h=Hello&amp;b=world"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-4-获取photo"><a href="#1-10-4-获取photo" class="headerlink" title="1.10.4    获取photo"></a>1.10.4    获取photo</h3><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/" itemprop="url">
                  4 初级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:38:36+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-c语言"><a href="#4-1-c语言" class="headerlink" title="4.1    c语言"></a>4.1    c语言</h2><h3 id="4-1-1-指针"><a href="#4-1-1-指针" class="headerlink" title="4.1.1    指针"></a>4.1.1    指针</h3><blockquote>
<p><strong>说明：</strong><code>a</code>和<code>&amp;a</code>包含的地址相同，但含义不同</p>
<ul>
<li>a：数组的首地址，也就是 a[0]的地址</li>
<li>&amp;a：对象的首地址，也就是数组的地址</li>
</ul>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">main &#123;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">	<span class="comment">// a:相当于a[0]</span></span><br><span class="line">	<span class="comment">// &amp;a：数组的地址</span></span><br><span class="line">	<span class="comment">// (&amp;a + 1)：指针加1根据指针的类型增加的量不同，a是指向数组的指针，数组的大小为5个Int，因此(&amp;a + 1)指向a[5]（溢出）</span></span><br><span class="line">	<span class="comment">// *(ptr - 1)：因为ptr指向的是元素，因此*(ptr - 1)为a[4]</span></span><br><span class="line">	<span class="keyword">int</span> *ptr = (int *)(&amp;a + <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d, %d"</span>, *(a + <span class="number">1</span>), *(ptr - <span class="number">1</span>));<span class="comment">// 2, 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-Object-C笔试"><a href="#4-2-Object-C笔试" class="headerlink" title="4.2    Object-C笔试"></a>4.2    Object-C笔试</h2><h3 id="4-2-1-写一个NSString类的实现"><a href="#4-2-1-写一个NSString类的实现" class="headerlink" title="4.2.1     写一个NSString类的实现"></a>4.2.1     写一个NSString类的实现</h3><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法：初始化</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法（工厂方法）</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">* @return &#123;&#125; 实例</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *obj;</span><br><span class="line">	<span class="comment">// 分配内存</span></span><br><span class="line">	obj = [slef allocWithZero: <span class="built_in">NSDefaultMallocZone</span>()];</span><br><span class="line">	<span class="comment">// 初始化</span></span><br><span class="line">	obj = [obj initWithCString: nullTerminatedCString encodign: encoding];</span><br><span class="line">	<span class="keyword">return</span> AUTORELEASE(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？"><a href="#4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？" class="headerlink" title="4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？"></a>4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？</h3><blockquote>
<p><strong>答：</strong><code>cocoa</code>中所有的类都是<code>NSObject</code>的子类，多继承在这里是用<code>protocol</code>委托代理来实现的。</p>
</blockquote>
<h3 id="4-2-3-Object-C有私有方法吗？私有变量呢？"><a href="#4-2-3-Object-C有私有方法吗？私有变量呢？" class="headerlink" title="4.2.3    Object-C有私有方法吗？私有变量呢？"></a>4.2.3    Object-C有私有方法吗？私有变量呢？</h3><blockquote>
<p><strong>答：</strong><code>Object-C</code>类里面的方法只有两种，<code>静态方法</code>和<code>实例方法</code>。</p>
<ul>
<li>实例变量：默认都是私有的</li>
<li>实例方法：默认都是共有的</li>
</ul>
</blockquote>
<h3 id="4-2-4-const以为这只读，下面的声明都是什么意思？"><a href="#4-2-4-const以为这只读，下面的声明都是什么意思？" class="headerlink" title="4.2.4    const以为这只读，下面的声明都是什么意思？"></a>4.2.4    const以为这只读，下面的声明都是什么意思？</h3><blockquote>
<p><strong>const作用：</strong></p>
<ol>
<li>声明变量：阻止一个变量被修改 </li>
<li>声明指针：可以指定指针本身为<code>const</code>，也可以指定指针所指的数据为<code>const</code></li>
<li>声明函数：可以修饰形参，表明它是一个输入参数，在函数内部不能改变值</li>
<li>类的成员函数：若指定为<code>const</code>类型，则表明其是一个常函数，不能修改类的成员变量</li>
</ol>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> *a;<span class="comment">// 指向int型常量的指针（整型数不可修改，指针可修改）</span></span><br><span class="line"><span class="keyword">int</span> * <span class="keyword">const</span> a;<span class="comment">//  指向int型变量的只读指针（整型数可修改，指针不可修改）</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> * a <span class="keyword">const</span>;<span class="comment">// 指向int型常量的只读指针(整型不可修改，指针不可修改)</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-static的作用"><a href="#4-2-5-static的作用" class="headerlink" title="4.2.5    static的作用"></a>4.2.5    static的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>函数体内：函数体内<code>static</code>变量的作用范围为改函数体，不同于<code>auto</code>变量，该变量的内存只被分配一次，因此其值在下次调用时仍维持上次的值</li>
<li>全局变量：在模块内的<code>static</code>全局变量可以被模块内所有函数访问，但不能被模块外其它函数访问</li>
<li>全局函数：模块内的<code>static</code>函数只可被这一模块内的其它函数调用，这个函数的使用范围被限制在声明它的模块内</li>
<li>类中的成员变量：在类中的<code>static</code>成员变量属于整个类所有，对类的所有对象只有一份拷贝。</li>
<li>类中的成员函数：在类中的<code>static</code>成员函数属于整个类所有，这个函数不接收<code>this</code>指针，因而只能访问类的<code>static</code>成员变量。</li>
</ol>
</blockquote>
<h3 id="4-2-6-extern-“C”的作用"><a href="#4-2-6-extern-“C”的作用" class="headerlink" title="4.2.6    extern “C”的作用"></a>4.2.6    extern “C”的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>被<code>extern &quot;C&quot;</code>限定的函数或变量是<code>extern</code>类型的</li>
<li>被<code>extern &quot;C&quot;</code>限定的变量和函数是按照<code>C</code>语言方式编译和链接的</li>
</ol>
</blockquote>
<h3 id="4-2-7-import跟-include区别，-class呢？"><a href="#4-2-7-import跟-include区别，-class呢？" class="headerlink" title="4.2.7 #import跟#include区别，@class呢？"></a>4.2.7 #import跟#include区别，@class呢？</h3><blockquote>
<p><strong>答：</strong><code>@class</code>一般用于头文件中需要声明该类的某个实例变量的时候用到，在<code>.m</code><br>文件中还是需要使用<code>#import</code>；而<code>#import</code>比起<code>#include</code>的好处就是好不会引起交叉编译。</p>
</blockquote>
<h3 id="4-2-8-Object-C的优缺点"><a href="#4-2-8-Object-C的优缺点" class="headerlink" title="4.2.8    Object-C的优缺点"></a>4.2.8    Object-C的优缺点</h3><blockquote>
<p><strong>优点：</strong></p>
<ol>
<li><code>Cateogies</code></li>
<li><code>Posing</code></li>
<li>动态识别</li>
<li>指标计算</li>
<li>弹性信息传递</li>
<li>不是一个过度复杂的<code>C</code>衍生语言</li>
<li><code>Object-C</code>与<code>C++</code>可以混合编程</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>不支持命名空间</li>
<li>不支持运算符重载</li>
<li>不支持多重继承</li>
<li>使用动态运行时类型，所有的方法都是函数调用，所以很多编译时优化方法都用不到。</li>
</ol>
</blockquote>
<h3 id="4-2-9-Object-C的内存管理"><a href="#4-2-9-Object-C的内存管理" class="headerlink" title="4.2.9    Object-C的内存管理"></a>4.2.9    Object-C的内存管理</h3><blockquote>
<p><strong>说明：</strong>通过分配和初始化（比如<code>[[MyClass alloc] init]</code>）的方式来创建对象，那就拥有这个对象，需要负责该对象的释放。这个规则在使用<code>NSObject</code>的便利方法<code>new</code>时也同样适用。</p>
<ul>
<li><code>拷贝(copy)对象</code>：也会拥有拷贝得到的对象，需要负责该对象的释放</li>
<li><code>保持(retain)对象</code>：部分拥有这个对象，需要在不再适用时释放该对象。</li>
</ul>
<p><strong>注意：</strong>反过来如果从其它对象那里接收到一个对象，则不拥有该对象，也不应该释放它。</p>
</blockquote>
<h3 id="4-2-10-自动释放池是什么，如何工作？"><a href="#4-2-10-自动释放池是什么，如何工作？" class="headerlink" title="4.2.10    自动释放池是什么，如何工作？"></a>4.2.10    自动释放池是什么，如何工作？</h3><blockquote>
<p><strong>答：</strong>当向一个对象发送一个<code>autorelease</code>消息时，<code>Cocoa</code>就会将改对象的一个引用放入到最新的<code>自动释放池</code>。它仍然是个正当的对象，因此<code>自动释放池</code>定义的作用域内的其它对象可以向它发送消息。当程序执行到作用域结束的位置时，自动释放池就会被释放，池中的对象也就被释放。</p>
</blockquote>
<h3 id="4-2-11-堆和栈的区别"><a href="#4-2-11-堆和栈的区别" class="headerlink" title="4.2.11    堆和栈的区别"></a>4.2.11    堆和栈的区别</h3><table>
<thead>
<tr>
<th><em>**</em></th>
<th>堆</th>
<th>栈</th>
</tr>
</thead>
<tbody>
<tr>
<td>管理方式</td>
<td>由编译器自动管理，无序手工控制</td>
<td>释放工作由程序控制，容易产生内存泄漏</td>
</tr>
<tr>
<td>申请大小</td>
<td>是向高地址扩展的数据结构，是不连续的内存区域。堆获得空间比较<code>灵活</code>，也比较<code>大</code>。</td>
<td>在<code>Windows</code>下，栈时向低地址扩展的数据结构，是一块连续的内存区域。能从栈获得的空间较<code>小</code></td>
</tr>
<tr>
<td>碎片问题</td>
<td>频繁的<code>new/delete</code>势必会造成内存空间的不连续，从而造成大量的碎片，使程序效率降低</td>
<td>栈是先进先出的队列，不会产生碎片</td>
</tr>
<tr>
<td>分配方式</td>
<td>动态分配</td>
<td>静态分配和动态分配</td>
</tr>
<tr>
<td>分配效率</td>
<td>堆是<code>c/c++</code>函数库提供的，机制比较复杂</td>
<td>栈是及其系统提供的数据结构，计算机在底层对栈提供支持</td>
</tr>
</tbody>
</table>
<h2 id="4-3-Swift特性"><a href="#4-3-Swift特性" class="headerlink" title="4.3    Swift特性"></a>4.3    Swift特性</h2><blockquote>
<p><strong>答：</strong></p>
<ol>
<li>支持所有<code>C</code>和<code>Object-C</code>的基本类型</li>
<li>提供了两种功能强劲的集合类型<code>Array</code>和<code>Dictionary</code></li>
<li>支持一种新的高级类型<code>元组</code></li>
<li>可选类型</li>
<li>闭包特性</li>
<li>支持脚本语言的特性，但能高效地编译运行</li>
<li>类型安全</li>
</ol>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_25 高级运算符/" itemprop="url">
                  25 高级运算符
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:24+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="25-1-位运算符"><a href="#25-1-位运算符" class="headerlink" title="25.1    位运算符"></a>25.1    位运算符</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 支持 <code>C</code> 语言中的全部位运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th>名称</th>
<th>返回值</th>
<th>复合运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>~</code></td>
<td>按位取反</td>
<td>将每一个0替换成1，每一个1替换成0</td>
<td><code>~=</code></td>
</tr>
<tr>
<td><code>&amp;</code></td>
<td>按位与</td>
<td>对两个操作数相应的位执行逻辑与运算</td>
<td><code>&amp;=</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>按位亦或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生0</td>
<td><code>^=</code></td>
</tr>
<tr>
<td><code>\</code></td>
<td>按位或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生1</td>
<td><code>\=</code></td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td>按位左移</td>
<td>左移n位的结果（左端溢出，右端补0）</td>
<td><code>&lt;&lt;=</code></td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td>按位右移</td>
<td>右移n位的结果（右端溢出，左端补0或保存符号位而补1</td>
<td><code>&gt;&gt;=</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>用途：</strong>通常被用在底层开发中</p>
<ul>
<li>图形编程</li>
<li>设备驱动</li>
<li>处理外部资源的原始数据（比如对自定义通信协议传输的数据进行编码和解码）</li>
</ul>
</blockquote>
<h3 id="25-1-1-按位取反运算符"><a href="#25-1-1-按位取反运算符" class="headerlink" title="25.1.1    按位取反运算符"></a>25.1.1    按位取反运算符</h3><blockquote>
<p><strong>按位取反操作符：</strong><code>~</code><br><strong>说明：</strong><code>按位取反运算符</code>可以对一个数值的全部比特位进行<code>取反</code><br><strong>语法：</strong>按位取反运算符是一个<code>前缀运算符</code>，需要直接放在<code>运算的数</code>之前，并且它们之间不能添加任何<code>空格</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 00001111</span></span><br><span class="line"><span class="keyword">let</span> initialBits: <span class="type">UInt8</span> = <span class="number">0b00001111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0b11110000</span></span><br><span class="line"><span class="keyword">let</span> invertedBits = ~initialBits</span><br></pre></td></tr></table></figure>
<h3 id="25-2-2-按位与运算符"><a href="#25-2-2-按位与运算符" class="headerlink" title="25.2.2    按位与运算符"></a>25.2.2    按位与运算符</h3><blockquote>
<p><strong>按位与操作符：</strong><code>&amp;</code><br><strong>说明：</strong><code>按位与运算符</code>可以对两个数的比特位进行合并。它返回一个新的数，只有当两个数的对应位都为 <code>1</code> 的时候，新数的对应位才为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 11111100</span></span><br><span class="line"><span class="keyword">let</span> firstSixBits: <span class="type">UInt8</span> = <span class="number">0b11111100</span></span><br><span class="line"><span class="comment">// 00111111</span></span><br><span class="line"><span class="keyword">let</span> lastSixBits: <span class="type">UInt8</span>  = <span class="number">0b00111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00111100</span></span><br><span class="line"><span class="keyword">let</span> middleFourBits = firstSixBits &amp; lastSixBits<span class="comment">// 按位与运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-3-按位或运算符"><a href="#25-2-3-按位或运算符" class="headerlink" title="25.2.3    按位或运算符"></a>25.2.3    按位或运算符</h3><blockquote>
<p><strong>按位或运算符：</strong><code>|</code><br><strong>说明：</strong><code>按位或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，只要两个数的对应位中有任意一个为 <code>1</code> 时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 10110010</span></span><br><span class="line"><span class="keyword">let</span> someBits: <span class="type">UInt8</span> = <span class="number">0b10110010</span></span><br><span class="line"><span class="comment">// 01011110</span></span><br><span class="line"><span class="keyword">let</span> moreBits: <span class="type">UInt8</span> = <span class="number">0b01011110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11111110</span></span><br><span class="line"><span class="keyword">let</span> combinedbits = someBits | moreBits <span class="comment">// 按位或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-4-按位亦或运算符"><a href="#25-2-4-按位亦或运算符" class="headerlink" title="25.2.4    按位亦或运算符"></a>25.2.4    按位亦或运算符</h3><blockquote>
<p><strong>按位亦或运算符：</strong><code>^</code><br><strong>说明：</strong><code>按位异或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，当两个数的<code>对应位不相同</code>时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 00010100</span></span><br><span class="line"><span class="keyword">let</span> firstBits: <span class="type">UInt8</span> = <span class="number">0b00010100</span></span><br><span class="line"><span class="comment">// 00000101</span></span><br><span class="line"><span class="keyword">let</span> otherBits: <span class="type">UInt8</span> = <span class="number">0b00000101</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00010001</span></span><br><span class="line"><span class="keyword">let</span> outputBits = firstBits ^ otherBits <span class="comment">// 按位亦或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-5-按位左移、右移运算符"><a href="#25-2-5-按位左移、右移运算符" class="headerlink" title="25.2.5    按位左移、右移运算符"></a>25.2.5    按位左移、右移运算符</h3><blockquote>
<p><strong>说明：</strong><code>有符号整数</code>和<code>无符号整数</code>的情况有所不同。值得注意的是</p>
</blockquote>
<table>
<thead>
<tr>
<th>位移操作</th>
<th>无符号整数</th>
<th>有符号整数</th>
</tr>
</thead>
<tbody>
<tr>
<td>左移<code>&lt;&lt;</code></td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
</tr>
<tr>
<td>右移<code>&gt;&gt;</code></td>
<td>丢弃溢出，高位用<code>0</code>填充</td>
<td>丢弃溢出，高位用<code>符号位</code>填充</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>有符号整数</code>中的<code>负数</code>和其它整数不同，使用的是<code>二进制补码</code>的表示形式。</p>
<ul>
<li><code>减法</code>在底层可以用<code>加法</code>实现</li>
<li>可以使负数的按位左移和右移运算得到跟正数同样的<code>效果</code></li>
</ul>
<p><strong>技巧：</strong>移位运算（无论<code>有符号整数</code>还是<code>无符号整数</code>）遵守下面定义的规则</p>
<ul>
<li>将一个整数<code>左移</code>一位，等价于将这个数<code>乘以 2</code></li>
<li>将一个整数<code>右移</code>一位，等价于将这个数<code>除以 2</code></li>
</ul>
</blockquote>
<h2 id="25-2-溢出运算符"><a href="#25-2-溢出运算符" class="headerlink" title="25.2    溢出运算符"></a>25.2    溢出运算符</h2><blockquote>
<p><strong>溢出：</strong>默认情况下，当向一个整数赋超过它容量的值时，<code>Swift</code>默认会报错。这一意味着，不会真的发生溢出－除非使用<code>溢出运算符</code>。<br><strong>说明：</strong><code>Swift</code>提供了<code>3</code>个溢出操作符，会让系统在数值溢出的时候采取<code>阶段操作</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>溢出运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;+</code></td>
<td>溢出加法</td>
</tr>
<tr>
<td><code>&amp;-</code></td>
<td>溢出减法</td>
</tr>
<tr>
<td><code>&amp;*</code></td>
<td>溢出乘法</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***** &amp;+ ****/</span></span><br><span class="line"><span class="comment">//  11111111</span></span><br><span class="line"><span class="keyword">var</span> unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">max</span><span class="comment">// 255</span></span><br><span class="line"><span class="comment">// 100000000 -&gt; 00000000</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;+ <span class="number">1</span><span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**** &amp;- ****/</span></span><br><span class="line"><span class="comment">// 00000000</span></span><br><span class="line">unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">min</span><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 111111111 -&gt; 11111111</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;- <span class="number">1</span><span class="comment">// 255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10000000</span></span><br><span class="line"><span class="keyword">var</span> signedOverflow = <span class="type">Int8</span>.<span class="built_in">min</span><span class="comment">// -128</span></span><br><span class="line"><span class="comment">// 01111111</span></span><br><span class="line">signedOverflow = signedOverflow &amp;- <span class="number">1</span><span class="comment">// 127</span></span><br></pre></td></tr></table></figure>
<h3 id="数值溢出"><a href="#数值溢出" class="headerlink" title="数值溢出"></a>数值溢出</h3><blockquote>
<p><strong>说明：</strong>数值溢出分为<code>上溢</code>和<code>下溢</code><br><strong>技巧：</strong>对于整数型数值（无论是<code>有符号</code>还是<code>无符号</code>）</p>
<ul>
<li>最大数：上溢1变成最小的数</li>
<li>最小数：下溢1变成最大的数</li>
</ul>
</blockquote>
<h2 id="25-3-优先级和结合性"><a href="#25-3-优先级和结合性" class="headerlink" title="25.3    优先级和结合性"></a>25.3    优先级和结合性</h2><blockquote>
<p><strong>说明：</strong>相比<code>C语言</code>和<code>Object-C</code>，<code>Swift</code>的运算符优先级和结合型规则更加简洁和可预测。</p>
</blockquote>
<h2 id="25-4-运算符函数"><a href="#25-4-运算符函数" class="headerlink" title="25.4    运算符函数"></a>25.4    运算符函数</h2><blockquote>
<p><strong>运算符重载：</strong><code>类</code>或<code>结构</code>可以为现有的操作符提供自定义的实现。</p>
</blockquote>
<h3 id="25-4-1-中缀运算符"><a href="#25-4-1-中缀运算符" class="headerlink" title="25.4.1    中缀运算符"></a>25.4.1    中缀运算符</h3><blockquote>
<p><strong>说明：</strong>也叫做<code>双目运算符</code>出现在两个<code>目标</code>之间，比如<code>+</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载“加号”，定义 Vector2D 类型实例之间的“加法”</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 向量之和</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数1</span></span><br><span class="line"><span class="keyword">let</span> vector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line"><span class="comment">// 操作数2</span></span><br><span class="line"><span class="keyword">let</span> anotherVector = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="comment">// 相加</span></span><br><span class="line"><span class="keyword">let</span> combinedVector = vector + anotherVector</span><br></pre></td></tr></table></figure>
<h3 id="25-4-2-前缀和后缀运算符"><a href="#25-4-2-前缀和后缀运算符" class="headerlink" title="25.4.2    前缀和后缀运算符"></a>25.4.2    前缀和后缀运算符</h3><blockquote>
<p><strong>说明：</strong><code>单目运算符</code>有<code>前缀</code>和<code>后缀</code>之分。</p>
</blockquote>
<table>
<thead>
<tr>
<th>单目运算符</th>
<th>说明</th>
<th>重载使用的关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>前缀</code></td>
<td>运算符出现在值之前</td>
<td><code>prefix</code></td>
</tr>
<tr>
<td><code>后缀</code></td>
<td>运算符出现在值之后</td>
<td><code>postfix</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获取相反向量</span><br><span class="line">* @param &#123;Vector2D&#125; vector 向量实例</span><br><span class="line">* @return &#123;Vector2D&#125; 相反向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> - <span class="params">(vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: -vector.x, y: -vector.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3.0, 4.0)</span></span><br><span class="line"><span class="keyword">let</span> positive = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-3.0, -4.0)</span></span><br><span class="line"><span class="keyword">let</span> negative = -positive</span><br></pre></td></tr></table></figure>
<h3 id="25-4-3-复合赋值运算符"><a href="#25-4-3-复合赋值运算符" class="headerlink" title="25.4.3    复合赋值运算符"></a>25.4.3    复合赋值运算符</h3><blockquote>
<p><strong>说明：</strong>重载<code>复合赋值运算符</code>（比如<code>+=</code>、<code>++</code>、<code>--</code>）</p>
<ul>
<li>第一个参数必需声明为<code>inout</code>类型，因为这个参数的值会在运算符函数内直接被修改</li>
</ul>
<p><strong>注意：</strong>不能对默认的<code>赋值运算符</code>和<code>三目条件运算符</code>进行重载。只有组合赋值运算符可以被重载。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载 "+="</span><br><span class="line">* @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line">* @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载前缀 "++"</span><br><span class="line">* @param &#123;Vector2D&#125; inout vector 要自增的向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> ++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toIncrement = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterIncrement = ++toIncrement</span><br></pre></td></tr></table></figure>
<h3 id="25-4-4-等价操作符"><a href="#25-4-4-等价操作符" class="headerlink" title="25.4.4    等价操作符"></a>25.4.4    等价操作符</h3><blockquote>
<p><strong>说明：</strong>属于<code>中缀运算符</code>（或<code>双目运算符</code>），包括<code>==</code>和<code>!=</code><br><strong>扩展：</strong>自定义的<code>类</code>和<code>结构体</code>没有对<code>等价运算符</code>进行默认实现，为了使用<code>等价运算符</code>能对自定义的类型进行<code>判等运算</code>，需要为其提供自定义实现</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"＝＝"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> == <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">left</span>.x == <span class="keyword">right</span>.x) &amp;&amp; (<span class="keyword">left</span>.y == <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"!="</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"不相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> != <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !(<span class="keyword">left</span> == <span class="keyword">right</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> twoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherTwoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">if</span> twoThree == anotherTwoThree &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"These two vectors are equivalent."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="25-5-自定义运算符"><a href="#25-5-自定义运算符" class="headerlink" title="25.5    自定义运算符"></a>25.5    自定义运算符</h2><blockquote>
<p><strong>说明：</strong>除了实现标准运算符，在 <code>Swift</code> 中还可以声明和实现自定义运算符。<br><strong>参考：</strong>可以用来自定义运算符的字符列表请参考<a href="">运算符</a>。<br><strong>语法：</strong>新的运算符要使用 <code>operator</code> 关键字在全局作用域内进行定义，同时还要指定 <code>prefix</code>、<code>infix</code> 或者 <code>postfix</code> 修饰符。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载 "+="</span><br><span class="line"> * @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line"> * @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">prefix</span> <span class="keyword">operator</span> +++ &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 自定义"+++"：前缀双自增</span><br><span class="line"> * @param &#123;Vector2D&#125; vector 向量</span><br><span class="line"> * @return &#123;Bool&#125; 计算结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> +++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += vector</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> toBeDoubled = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterDoubling = +++toBeDoubled</span><br></pre></td></tr></table></figure>
<h3 id="自定义中缀运算符的优先级和结合性"><a href="#自定义中缀运算符的优先级和结合性" class="headerlink" title="自定义中缀运算符的优先级和结合性"></a>自定义中缀运算符的优先级和结合性</h3><blockquote>
<p><strong>说明：</strong>自定义的<code>中缀运算符</code>也可以指定<code>优先级</code>(默认为<code>100</code>)和<code>结合性</code>(默认为<code>none</code>)</p>
</blockquote>
<table>
<thead>
<tr>
<th>优先级</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>left</code></td>
<td>左结合</td>
<td>跟左边的值进行结合</td>
</tr>
<tr>
<td><code>right</code></td>
<td>右结合</td>
<td>会跟右边的值进行结合</td>
</tr>
<tr>
<td><code>none</code></td>
<td>非结合</td>
<td>不能跟其他相同优先级的运算符写在一起</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>在定义前缀与后缀运算符的时候，如果没有指定优先级，则对同一个值同时使用前缀与后缀运算符，后缀运算符会先参与运算。<br><strong>参考：</strong> <a href="https://developer.apple.com/library/ios/documentation/Swift/Reference/Swift_StandardLibrary_Operators/index.html#//apple_ref/doc/uid/TP40016054" target="_blank" rel="external">Swift 标准库提供的运算符的结合性与优先级</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 自定义中缀运算符"+-"</span><br><span class="line">* 结合性：left</span><br><span class="line">* 优先级：140</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> +- &#123; <span class="keyword">associativity</span> <span class="keyword">left</span> <span class="keyword">precedence</span> <span class="number">140</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重写"+-"</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 计算结果</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> +- <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y - <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstVector = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">2.0</span>)</span><br><span class="line"><span class="keyword">let</span> secondVector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> plusMinusVector = firstVector +- secondVector</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_24 访问控制/" itemprop="url">
                  24 访问控制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:04+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>访问控制可以限定其他源文件或模块中的代码对你的代码的访问级别。<br><strong>用途：</strong>这个特性可以让我们<code>隐藏代码的一些实现细节</code>，并且可以为其他人可以访问和使用的代码<code>提供接口</code>。<br><strong>约定：</strong>为了简单起见，对于代码中可以设置访问级别的特性（属性、基本类型、函数等），在下面的章节中我们会称之为<code>实体</code>。</p>
</blockquote>
<h2 id="24-1-模块和源代码"><a href="#24-1-模块和源代码" class="headerlink" title="24.1    模块和源代码"></a>24.1    模块和源代码</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 中的访问控制模型基于<code>模块</code>和<code>源文件</code>这两个概念。<br><strong>模块：</strong>模块指的是独立的<code>代码单元</code>，<code>框架</code>或<code>应用程序</code></p>
<ul>
<li>作为一个独立的模块来构建和发布</li>
<li>一个模块可以使用 <code>import</code> 关键字导入另外一个模块</li>
<li><code>Xcode</code> 的每个 <code>target</code>（例如框架或应用程序）都被当作独立的模块处理</li>
</ul>
<p><strong>源文件：</strong>源文件就是 <code>Swift</code> 中的源代码文件</p>
<ul>
<li>通常属于一个模块，即一个应用程序或者框架</li>
<li>同一个源文件也可以包含多个类型、函数之类的定义(一般会将不同的类型分别定义在不同的源文件中)</li>
</ul>
</blockquote>
<h2 id="24-2-访问级别"><a href="#24-2-访问级别" class="headerlink" title="24.2    访问级别"></a>24.2    访问级别</h2><blockquote>
<p><strong>说明：</strong><code>3</code>种</p>
</blockquote>
<table>
<thead>
<tr>
<th>访问级别</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td>可以访问同一模块源文件中的任何实体，在模块外也可以通过导入该模块来访问源文件里的所有实体</td>
<td>框架中的某个接口可以被任何人使用时</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>可以访问同一模块源文件中的任何实体，但是不能从模块外访问该模块源文件中的实体</td>
<td>某个接口只在应用程序或框架内部使用时</td>
</tr>
<tr>
<td><code>private</code></td>
<td>限制实体只能在所在的源文件内部使用</td>
<td>需要隐藏某些功能的实现细节时</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>Swift</code> 中的 <code>private</code> 访问级别不同于其他语言，它的范围限于源文件，而不是声明范围内。这就意味着，一个类型可以访问其所在源文件中的所有 <code>private</code> 实体，但是如果它的扩展定义在其他源文件中，那么它的扩展就不能访问它在这个源文件中定义的 <code>private</code> 实体。</p>
</blockquote>
<h3 id="24-2-1-访问级别基本原则"><a href="#24-2-1-访问级别基本原则" class="headerlink" title="24.2.1    访问级别基本原则"></a>24.2.1    访问级别基本原则</h3><blockquote>
<p><strong>说明：</strong>不可以在某个实体中定义访问级别更高的实体。</p>
<ul>
<li>一个 <code>public</code> 访问级别的变量，其类型的访问级别不能是 <code>internal</code> 或 <code>private</code>。</li>
<li><code>函数</code>的访问级别不能高于它的<code>参数类型</code>和<code>返回类型</code>的访问级别</li>
</ul>
</blockquote>
<h3 id="24-2-2-默认访问级别"><a href="#24-2-2-默认访问级别" class="headerlink" title="24.2.2    默认访问级别"></a>24.2.2    默认访问级别</h3><blockquote>
<p><strong>说明：</strong>代码默认的访问级别为<code>internal</code></p>
</blockquote>
<h3 id="24-2-3-单target应用程序的访问级别"><a href="#24-2-3-单target应用程序的访问级别" class="headerlink" title="24.2.3    单target应用程序的访问级别"></a>24.2.3    单target应用程序的访问级别</h3><blockquote>
<p><strong>单target应用程序：</strong>应用的所有功能都是为该应用服务，而<code>不需要提供给其他应用或者模块使用</code>，所以我们不需要明确设置访问级别<br><strong>说明：</strong>建议访问级别设置</p>
<ul>
<li>通常使用默认的访问级别 <code>internal</code> 即可</li>
<li>也可以使用 <code>private</code> 级别，用于隐藏一些功能的实现细节</li>
</ul>
</blockquote>
<h3 id="24-2-4-框架的访问级别"><a href="#24-2-4-框架的访问级别" class="headerlink" title="24.2.4    框架的访问级别"></a>24.2.4    框架的访问级别</h3><blockquote>
<p><strong>框架：</strong>主要是被其它模块导入使用<br><strong>说明：</strong>把一些对外的接口定义为 <code>public</code> 级别</p>
<ul>
<li>框架依然会使用默认的 <code>internal</code> 级别，也可以指定为 <code>private</code> 级别</li>
<li>当你想把某个实体作为框架的 <code>API</code> 的时候，需显式为其指定 <code>public</code> 级别</li>
</ul>
</blockquote>
<h3 id="24-2-5-单元测试target的访问级别"><a href="#24-2-5-单元测试target的访问级别" class="headerlink" title="24.2.5    单元测试target的访问级别"></a>24.2.5    单元测试target的访问级别</h3><blockquote>
<p><strong>单元测试target：</strong>当你的应用程序包含<code>单元测试 target</code> 时，为了测试，测试模块需要访问应用程序模块中的代码。<br><strong>说明：</strong>默认情况下只有 <code>public</code> 级别的实体才可以被其他模块访问。然而，如果在<code>导入应用程序模块的语句</code>前使用 <code>@testable</code> 特性，然后在允许测试的编译设置<code>（Build Options -&gt; Enable Testability）</code>下编译这个应用程序模块，<code>单元测试 target</code> 就可以访问应用程序模块中<code>所有 internal 级别</code>的实体。</p>
</blockquote>
<h2 id="24-3-访问控制语法"><a href="#24-3-访问控制语法" class="headerlink" title="24.3    访问控制语法"></a>24.3    访问控制语法</h2><blockquote>
<p><strong>说明：</strong>通过修饰符 <code>public</code>、<code>internal</code>、<code>private</code> 来声明实体的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**** 声明类 ****/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// internal(默认的，可省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 声明变量 ******/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> somePublicVariable = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明常量 ******/</span></span><br><span class="line"><span class="comment">// internal(可以省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">let</span> someInternalConstant = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明方法 *********/</span></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateFunction</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-4-自定义类型"><a href="#24-4-自定义类型" class="headerlink" title="24.4    自定义类型"></a>24.4    自定义类型</h2><blockquote>
<p><strong>说明：</strong>一个类型的访问级别也会影响到类型成员（<code>属性</code>、<code>方法</code>、<code>构造器</code>、<code>下标</code>）的默认访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型的访问级别</th>
<th>类型成员的默认访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>internal</code>（或不指定）</td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>为什么：</strong>一个 <code>public</code> 类型的所有成员的访问级别默认为 <code>internal</code> 级别，而不是 <code>public</code> 级别？</p>
<blockquote>
<p>好处是，在你定义公共接口的时候，可以明确地选择哪些接口是需要公开的，哪些是内部使用的，避免不小心将内部使用的接口公开。</p>
</blockquote>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// public</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> somePublicProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-1-元组类型"><a href="#24-4-1-元组类型" class="headerlink" title="24.4.1    元组类型"></a>24.4.1    元组类型</h3><blockquote>
<p><strong>说明：</strong>元组不同于类、结构体、枚举、函数那样有单独的定义。元组的访问级别是在它被使用时<code>自动推断</code>出的，而无法明确指定。<br><strong>访问级别：</strong>元组的访问级别将由元组中<code>访问级别最严格的类型</code>来决定。</p>
</blockquote>
<h3 id="24-4-2-函数类型"><a href="#24-4-2-函数类型" class="headerlink" title="24.4.2    函数类型"></a>24.4.2    函数类型</h3><blockquote>
<p><strong>访问级别：</strong>函数的访问级别根据访问级别最严格的<code>参数</code>类型或<code>返回</code>类型的访问级别来决定<br><strong>说明：</strong>如果这种访问级别不符合函数定义所在环境的默认访问级别，那么就需要<code>明确地指定该函数的访问级别</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为该函数返回类型的访问级别是 private，所以你必须使用 private 修饰符</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>) &#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-3-枚举类型"><a href="#24-4-3-枚举类型" class="headerlink" title="24.4.3    枚举类型"></a>24.4.3    枚举类型</h3><blockquote>
<p><strong>访问级别：</strong><code>枚举成员</code>的访问级别和该<code>枚举类型</code>相同<br><strong>说明：</strong>你不能为<code>枚举成员</code>单独指定不同的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CompassPoint</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">North</span><span class="comment">// public</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">South</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">East</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">West</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原始值和关联值"><a href="#原始值和关联值" class="headerlink" title="原始值和关联值"></a>原始值和关联值</h4><blockquote>
<p><strong>说明：</strong><code>枚举定义</code>中的任何<code>原始值</code>或<code>关联值</code>的类型的访问级别至少不能低于<code>枚举类型</code>的访问级别</p>
</blockquote>
<h3 id="24-4-4-嵌套类型"><a href="#24-4-4-嵌套类型" class="headerlink" title="24.4.4    嵌套类型"></a>24.4.4    嵌套类型</h3><table>
<thead>
<tr>
<th>环境类型</th>
<th>嵌套类型默认</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
<tr>
<td><code>internal</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
<td>如果想让嵌套类型拥有 <code>public</code> 访问级别，那么需要明确指定该嵌套类型的访问级别</td>
</tr>
</tbody>
</table>
<h2 id="24-5-子类"><a href="#24-5-子类" class="headerlink" title="24.5    子类"></a>24.5    子类</h2><blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>子类的访问级别<code>不得高于</code>父类的访问级别</li>
<li>可以通过<code>重写</code>为继承来的<code>类成员</code>提供<code>更高的访问级别</code></li>
<li>用<code>子类成员</code>去访问访问级别更低的<code>父类成员</code>，只要这一操作在相应访问级别的限制范围内</li>
</ul>
<ol>
<li><strong>同一源文件：</strong>可以访问访问父类 <code>private</code> 级别的成员</li>
<li><strong>同一模块：</strong>访问父类 <code>internal</code> 级别的成员</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类（访问级别不能高于父类）</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写父类方法，提高访问级别</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 调用父类 private 方法（同一源文件）</span></span><br><span class="line">        <span class="keyword">super</span>.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-6-常量、变量、属性、下标"><a href="#24-6-常量、变量、属性、下标" class="headerlink" title="24.6    常量、变量、属性、下标"></a>24.6    常量、变量、属性、下标</h2><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性</code>不能拥有比它们<code>所在的类型</code>更高的访问级别；<code>下标</code>也不能拥有比<code>索引类型</code>或<code>返回类型</code>更高的访问级别。</p>
</blockquote>
<h3 id="24-6-1-Getter-和-Setter"><a href="#24-6-1-Getter-和-Setter" class="headerlink" title="24.6.1    Getter 和 Setter"></a>24.6.1    Getter 和 Setter</h3><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性（包括计算属性 和 存储型属性）</code>、<code>下标</code>的 <code>Getters</code> 和 <code>Setters</code> 的访问级别和它们<code>所在类型</code>的访问级别相同。<br><strong>改变访问级别：</strong>只能改变<code>Setter</code><br> |改变<code>Setter</code>访问权限的关键字|访问级别|<br> |-|-|<br> |<code>private(set)</code> |<code>private</code>|<br> |<code>internal(set)</code>|<code>internal</code>|<br><strong>注意：</strong>存储属性也有<code>Getter</code>和<code>Setter</code>，<code>Swift</code>会隐式地为其创建 <code>Getter</code> 和 <code>Setter</code>，用于访问该属性的<code>后备存储</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 结构体(internal)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrackedString</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储属性：setter 为 private（该属性只有在当前的源文件中是可读写的，而在当前源文件所属的模块中只是一个可读的属性）</span></span><br><span class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> numberOfEdits = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 计算属性: internal</span></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结构体实例</span></span><br><span class="line"><span class="keyword">var</span> stringToEdit = <span class="type">TrackedString</span>()</span><br><span class="line"><span class="comment">// 写（在同一源文件中）</span></span><br><span class="line">stringToEdit.value = <span class="string">"This string will be tracked."</span></span><br><span class="line">stringToEdit.value += <span class="string">" This edit will increment numberOfEdits."</span></span><br><span class="line">stringToEdit.value += <span class="string">" So will this one."</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The number of edits is \(stringToEdit.numberOfEdits)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="24-7-构造器"><a href="#24-7-构造器" class="headerlink" title="24.7    构造器"></a>24.7    构造器</h2><blockquote>
<p><strong>说明：</strong>构造器的访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>构造器</th>
<th>访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>自定义构造器</td>
<td>可以<code>低于或等于</code>其<code>所属类型</code>的访问级别</td>
</tr>
<tr>
<td>必要构造器</td>
<td>必须和所属类型的访问级别<code>相同</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>构造器参数的访问级别：</strong>如同函数或方法的参数，<code>构造器参数</code>的访问级别也不能低于<code>构造器本身</code>的访问级别。</p>
</blockquote>
<h3 id="24-7-1-默认构造器"><a href="#24-7-1-默认构造器" class="headerlink" title="24.7.1    默认构造器"></a>24.7.1    默认构造器</h3><blockquote>
<p><strong>默认构造器存在条件：</strong>为所有存储型属性设置了默认初始值，并且未提供自定义的构造器。<br><strong>说明：</strong>默认构造器的访问级别<code>与所属类型的访问级别相同</code>，除非类型的访问级别是 <code>public</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>所在类型访问级别</th>
<th>默认构造器访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code>或<code>internal</code></td>
<td>和所在类型相同</td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果你希望一个 <code>public</code> 级别的类型也能在其他模块中使用这种<code>无参数的默认构造器</code>，你只能<code>自己提供一个 public 访问级别的无参数构造器</code>。</p>
</blockquote>
<h3 id="24-7-2-结构体默认的成员逐一构造器"><a href="#24-7-2-结构体默认的成员逐一构造器" class="headerlink" title="24.7.2    结构体默认的成员逐一构造器"></a>24.7.2    <code>结构体</code>默认的成员逐一构造器</h3><blockquote>
<p><strong>说明：</strong>和结构体中的<code>存储属性成员</code>的访问级别有关。</p>
</blockquote>
<table>
<thead>
<tr>
<th>所有存储型属性的访问级别都为<code>private</code></th>
<th>逐一成员构造器的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td><code>private</code></td>
</tr>
<tr>
<td>否</td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果希望一个 <code>public</code> 级别的结构体也能在其他模块中使用<code>其默认的成员逐一构造器</code>，依然只能<code>自己提供一个 public 访问级别的成员逐一构造器</code>。</p>
</blockquote>
<h2 id="24-8-协议"><a href="#24-8-协议" class="headerlink" title="24.8    协议"></a>24.8    协议</h2><blockquote>
<p><strong>说明：</strong>可以在<code>定义协议</code>时明确指定协议的访问级别。</p>
<ul>
<li>协议中的每一个<code>要求</code>都具有和<code>该协议</code>相同的访问级别</li>
</ul>
</blockquote>
<h3 id="24-8-1-协议继承"><a href="#24-8-1-协议继承" class="headerlink" title="24.8.1    协议继承"></a>24.8.1    协议继承</h3><blockquote>
<p><strong>说明：</strong>如果定义了一个继承自其他协议的新协议，那么<code>新协议</code>拥有的访问级别最高也只能和<code>被继承协议</code>的访问级别相同</p>
</blockquote>
<h3 id="24-8-2-协议一致性"><a href="#24-8-2-协议一致性" class="headerlink" title="24.8.2    协议一致性"></a>24.8.2    协议一致性</h3><blockquote>
<p><strong>说明：</strong>一个<code>类型</code>可以采纳比自身访问级别低的<code>协议</code><br><strong>采纳协议的类型的访问级别：</strong>采纳了协议的类型的访问级别取它本身和所采纳协议<code>两者间最低的访问级别</code></p>
</blockquote>
<h2 id="24-9-扩展"><a href="#24-9-扩展" class="headerlink" title="24.9    扩展"></a>24.9    扩展</h2><blockquote>
<p><strong>说明：</strong>你可以在访问级别允许的情况下对<code>类</code>、<code>结构体</code>、<code>枚举</code>进行扩展。</p>
</blockquote>
<table>
<thead>
<tr>
<th>是否给扩展指定访问级别</th>
<th>扩展的成员的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td>扩展的访问级别下成员获得的默认访问级别（规则同<code>自定义类型</code>）</td>
</tr>
<tr>
<td>否</td>
<td>和原始类型成员一致</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>用于采纳协议的扩展不能指定扩展的访问级别。</p>
</blockquote>
<h3 id="24-9-1-通过扩展添加协议一致性"><a href="#24-9-1-通过扩展添加协议一致性" class="headerlink" title="24.9.1    通过扩展添加协议一致性"></a>24.9.1    通过扩展添加协议一致性</h3><blockquote>
<p><strong>说明：</strong>如果你通过扩展来采纳协议，那么你就<code>不能显式指定</code>该扩展的访问级别了<br>扩展的访问级别<br><strong>扩展中提供的实现协议要求的成员的访问级别：</strong>协议拥有相应的访问级别，并会为该扩展中所有协议要求的实现提供默认的访问级别。</p>
</blockquote>
<h2 id="24-10-泛型"><a href="#24-10-泛型" class="headerlink" title="24.10    泛型"></a>24.10    泛型</h2><blockquote>
<p><strong>说明：</strong>泛型函数和泛型类型放在一起讨论。<br><strong>访问级别：</strong>取<code>自身</code>访问级别和<code>类型参数</code>访问级别中最低的访问级别</p>
</blockquote>
<h2 id="24-11-类型别名"><a href="#24-11-类型别名" class="headerlink" title="24.11    类型别名"></a>24.11    类型别名</h2><blockquote>
<p><strong>说明：</strong>你定义的任何<code>类型别名</code>都会被当作不同的类型，以便于进行访问控制。<br><strong>访问级别限制：</strong><code>类型别名</code>的访问级别不可高于<code>其表示的类型</code>的访问级别。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_23 范型/" itemprop="url">
                  23 范型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:05:48+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>泛型代码可以让你编写<code>适用自定义需求以及任意类型</code>的<code>灵活可重用</code>的<code>函数</code>和<code>类型</code>。<br><strong>意义：</strong>它的可以让你<code>避免重复的代码</code>，用一种清晰和抽象的方式来表达代码的意图。</p>
</blockquote>
<h2 id="23-1-泛型所解决的问题"><a href="#23-1-泛型所解决的问题" class="headerlink" title="23.1    泛型所解决的问题"></a>23.1    泛型所解决的问题</h2><blockquote>
<p><strong>说明：</strong>有了泛型，就不必为各种不同类型重复创建类似的<code>函数</code>或<code>类型</code>。</p>
</blockquote>
<h2 id="23-2-泛型函数"><a href="#23-2-泛型函数" class="headerlink" title="23.2    泛型函数"></a>23.2    泛型函数</h2><blockquote>
<p><strong>说明：</strong><code>泛型函数</code>可以适用于<code>任何类型</code><br><strong>语法：</strong><code>func 函数名&lt;T&gt;(){...}</code></p>
<ul>
<li>函数名后面跟着<code>&lt;占位类型名&gt;</code>（比如字母 <code>T</code>）来代替实际类型名</li>
<li>函数被调用时，<code>T</code> 所代表的类型都会<code>由传入的值的类型推断出来</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***************** 不使用泛型的方法 ****************/</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 交换两个值</span><br><span class="line">* @param &#123;String&#125; inout a 第一个值</span><br><span class="line">* @param &#123;String&#125; inout b 第二个值</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwStrings</span><span class="params">(<span class="keyword">inout</span> a: String, <span class="keyword">inout</span> <span class="number">_</span> b: String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 交换两个值</span><br><span class="line"> * @param &#123;Double&#125; inout a 第一个值</span><br><span class="line"> * @param &#123;Double&#125; inout b 第二个值</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoDoubles</span><span class="params">(<span class="keyword">inout</span> a: Double, <span class="keyword">inout</span> <span class="number">_</span> b: Double)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** 使用泛型的方法 ******************/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoValues</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> a: T, <span class="keyword">inout</span> <span class="number">_</span> b: T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型（自动推断 T 占位符的类型）</span></span><br><span class="line"><span class="keyword">var</span> someInt = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> anotherInt = <span class="number">107</span></span><br><span class="line">swapTwoValues(&amp;someInt, &amp;anotherInt)</span><br></pre></td></tr></table></figure>
<h2 id="23-3-类型参数"><a href="#23-3-类型参数" class="headerlink" title="23.3    类型参数"></a>23.3    类型参数</h2><blockquote>
<p><strong>说明：</strong>类型参数指定并命名一个<code>占位类型</code>，并且紧随在函数名后面，使用一对尖括号括起来（例如 <code>&lt;T&gt;</code>）。<code>类型参数</code>会在函数调用时被实际类型所替换。在<code>泛型函数体</code>中可以用来</p>
<ul>
<li>定义一个函数的<code>参数类型</code></li>
<li>作为函数的<code>返回类型</code></li>
<li>用作函数主体中的<code>注释类型</code></li>
</ul>
</blockquote>
<h2 id="23-4-命名类型参数"><a href="#23-4-命名类型参数" class="headerlink" title="23.4    命名类型参数"></a>23.4    命名类型参数</h2><blockquote>
<p><strong>说明：</strong>下面是一些指导性的意见。</p>
<ul>
<li>在大多数情况下，类型参数具有一个<code>描述性名字</code></li>
<li>当它们之间的关系没有意义时，通常使用<code>单一的字母</code>来命名</li>
</ul>
<p><strong>注意：</strong>始终使用<code>大写字母开头的驼峰式命名法</code>来为类型参数命名，以表明它们是占位类型，而不是一个值。</p>
</blockquote>
<h2 id="23-5-泛型类型"><a href="#23-5-泛型类型" class="headerlink" title="23.5    泛型类型"></a>23.5    泛型类型</h2><blockquote>
<p><strong>说明：</strong>除了泛型函数，<code>Swift</code> 还允许你定义泛型类型。这些自定义<code>类</code>、<code>结构体</code>和<code>枚举</code>可以适用于<code>任何类型</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****************** 不使用泛型的结构体 ******************/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IntStack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Int</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** 使用泛型的机构体 ******************/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串栈实例</span></span><br><span class="line"><span class="keyword">var</span> stackOfStrings = <span class="type">Stack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stackOfStrings.push(<span class="string">"uno"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"dos"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"tres"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"cuatro"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈</span></span><br><span class="line"><span class="keyword">let</span> fromTheTop = stackOfStrings.pop()</span><br></pre></td></tr></table></figure>
<h2 id="23-6-扩展一个泛型类型"><a href="#23-6-扩展一个泛型类型" class="headerlink" title="23.6    扩展一个泛型类型"></a>23.6    扩展一个泛型类型</h2><blockquote>
<p><strong>说明：</strong>扩展泛型类型和扩展普通类型类似，特别的地方在于</p>
<ul>
<li><code>不需要</code>在扩展的定义中提供<code>类型参数列表</code></li>
<li>原始类型定义中声明的类型参数列表在扩展中可以直接使用</li>
<li>这些来自原始类型中的参数名称会被用作<code>原始定义中类型参数的引用</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型结构体：栈</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展泛型类型(原始类型定义中声明的类型参数列表在扩展中可以直接使用)</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Stack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> topItem: <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> items.isEmpty ? <span class="literal">nil</span> : items[items.<span class="built_in">count</span> - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 字符串栈实例</span></span><br><span class="line"><span class="keyword">var</span> stackOfStrings = <span class="type">Stack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stackOfStrings.push(<span class="string">"uno"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"dos"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"tres"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"cuatro"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈</span></span><br><span class="line"><span class="keyword">let</span> fromTheTop = stackOfStrings.pop()</span><br></pre></td></tr></table></figure>
<h2 id="23-6-类型约束"><a href="#23-6-类型约束" class="headerlink" title="23.6    类型约束"></a>23.6    类型约束</h2><blockquote>
<p><strong>说明：</strong>类型约束可以指定一个<code>类型参数</code>必须继承自指定类，或者符合一个特定的协议或协议组合。</p>
</blockquote>
<h3 id="23-6-1-类型约束语法"><a href="#23-6-1-类型约束语法" class="headerlink" title="23.6.1    类型约束语法"></a>23.6.1    类型约束语法</h3><blockquote>
<p><strong>说明：</strong>在一个<code>类型参数名</code>后面放置一个<code>类名</code>或者<code>协议名</code>，通过<code>:</code>分隔，从而定义类型约束，它们将作为类型参数列表的一部分。<br><strong>语法：</strong>以<code>泛型函数</code>为例（<code>泛型类型</code>与此类似）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someFunction</span>&lt;T: SomeClass, U: SomeProtocol&gt;<span class="params">(someT: T, someU: U)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里是泛型函数的函数体部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-6-2-类型约束实践"><a href="#23-6-2-类型约束实践" class="headerlink" title="23.6.2    类型约束实践"></a>23.6.2    类型约束实践</h3><blockquote>
<p><strong>注意：</strong>不是所有的 <code>Swift</code> 类型都可以用等式符<code>==</code>进行比较。Swift 标准库中定义了一个 <code>Equatable</code> 协议，该协议要求任何符合该协议的类型必须实现等式符<code>==</code>。<br><strong>扩展：</strong>所有的 <code>Swift 标准类型</code>自动支持 <code>Equatable</code> 协议</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/************  非泛型   ************/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findStringIndex</span><span class="params">(array: [String], <span class="number">_</span> valueToFind: String)</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">for</span> (index, value) <span class="keyword">in</span> array.<span class="built_in">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> value == valueToFind &#123;</span><br><span class="line">            <span class="keyword">return</span> index</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">let</span> strings = [<span class="string">"cat"</span>, <span class="string">"dog"</span>, <span class="string">"llama"</span>, <span class="string">"parakeet"</span>, <span class="string">"terrapin"</span>]</span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> foundIndex = findStringIndex(strings, <span class="string">"llama"</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The index of llama is \(foundIndex)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********  泛型（带有约束）  *********/</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获得相应值在数组中的位置</span><br><span class="line">* @desc 为了保证证支持等式操作符，T 必需实现 Equatable 协议</span><br><span class="line">* @param &#123;[T]&#125; 目标数组</span><br><span class="line">* @param &#123;T&#125; 目标值</span><br><span class="line">* @reutrn &#123;Int?&#125; 下标</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findIndex</span>&lt;T: Equatable&gt;<span class="params">(array: [T], <span class="number">_</span> valueToFind: T)</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">for</span> (index, value) <span class="keyword">in</span> array.<span class="built_in">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> value == valueToFind &#123;</span><br><span class="line">            <span class="keyword">return</span> index</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="23-7-关联类型"><a href="#23-7-关联类型" class="headerlink" title="23.7    关联类型"></a>23.7    关联类型</h2><blockquote>
<p><strong>用途：</strong><code>定义一个协议时</code>，有的时候声明<code>一个或多个</code>关联类型作为协议定义的一部分将会，作为一种用来<code>占位</code>的类型，实现协议是会推断出<code>实际类型</code>。<br><strong>说明：</strong>关联类型作为协议的一部分，为某个类型提供了一个<code>占位名</code>（或者说别名），其代表的<code>实际类型在协议被采纳时才会被指定</code>。<br><strong>语法：</strong>你可以通过 <code>typealias</code> 关键字来指定关联类型。</p>
</blockquote>
<h3 id="23-7-1-关联类型实践"><a href="#23-7-1-关联类型实践" class="headerlink" title="23.7.1    关联类型实践"></a>23.7.1    关联类型实践</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议（非泛型）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IntStack</span>: <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自身部分</span></span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Int</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Container 协议的实现部分</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span> = <span class="type">Int</span><span class="comment">// 可以省略（因为类型推断）</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议（泛型）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt;: <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Stack&lt;Element&gt; 的原始实现部分</span></span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Container 协议的实现部分</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-7-2-通过扩展一个存在的类型来指定关联类型"><a href="#23-7-2-通过扩展一个存在的类型来指定关联类型" class="headerlink" title="23.7.2    通过扩展一个存在的类型来指定关联类型"></a>23.7.2    通过扩展一个存在的类型来指定关联类型</h3><blockquote>
<p><strong>说明：</strong>扩展让一个已存在的类型符合一个协议，其中就包括使用了关联类型的协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议：容器</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array 本身就具备 Container 指定的实现</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span>: <span class="title">Container</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="23-8-where字句"><a href="#23-8-where字句" class="headerlink" title="23.8    where字句"></a>23.8    where字句</h2><blockquote>
<p><strong>说明：</strong>可以在<code>参数列表</code>中通过 <code>where</code> 子句为<code>关联类型</code>定义约束</p>
<ul>
<li>使一个<code>关联类型</code>符合某个特定的协议</li>
<li>使某个特定的类型参数和<code>关联类型</code>必须类型相同</li>
</ul>
<p><strong>语法：</strong>将 <code>where</code> 关键字紧跟在类型参数列表后面来定义 <code>where</code> 子句</p>
<ul>
<li><code>where</code> 子句后跟<code>一个或者多个</code>针对关联类型的约束</li>
<li>以及<code>一个或多个</code>类型参数和关联类型间的相等关系</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议：容器</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 检查两个 Container 实例是否包含相同顺序的相同元素</span><br><span class="line">* @param &#123;C1&#125; someContainer</span><br><span class="line">* @param &#123;C2&#125; anotherContainer</span><br><span class="line">* @return &#123;Bool&#125; true 匹配，false 不匹配</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">allItemsMatch</span>&lt;</span><br><span class="line">    C1: Container, C2: Container</span><br><span class="line">    where C1.ItemType == C2.ItemType, C1.ItemType: Equatable&gt;</span><br><span class="line">    <span class="params">(someContainer: C1, <span class="number">_</span> anotherContainer: C2)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查两个容器含有相同数量的元素</span></span><br><span class="line">        <span class="keyword">if</span> someContainer.<span class="built_in">count</span> != anotherContainer.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查每一对元素是否相等</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;someContainer.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> someContainer[i] != anotherContainer[i] &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;       </span><br><span class="line">        <span class="comment">// 所有元素都匹配，返回 true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_22 协议/" itemprop="url">
                  22 协议
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:05:28+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="22-1-协议的语法"><a href="#22-1-协议的语法" class="headerlink" title="22.1    协议的语法"></a>22.1    协议的语法</h2><blockquote>
<p><strong>说明：</strong>协议的定义方式与<code>类</code>,<code>结构体</code>,<code>枚举</code>的定义非常相似。</p>
<ul>
<li>要使类遵循某个协议,需要在<code>类型名称后</code>加上<code>协议名称</code>,中间以<code>:</code> 分隔,作为类型定义的一部分</li>
<li>遵循多个 协议时,各协议之间用逗号<code>,</code> 分隔</li>
<li>如果类在遵循协议的同时拥有父类,应该将<code>父类名</code>放在<code>协议名之前</code>,以<code>,</code>分隔</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 协议内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SomeStructure</span>: <span class="title">FirstProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 结构体内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承类并实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span>: <span class="title">SomeSuperClass</span>, <span class="title">FirstProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 类的内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-2-对属性的规定"><a href="#22-2-对属性的规定" class="headerlink" title="22.2    对属性的规定"></a>22.2    对属性的规定</h2><blockquote>
<p><strong>说明：</strong>表现在<code>4</code>个方面</p>
<ul>
<li>名称</li>
<li>类型</li>
<li>可读还是可写</li>
<li>实例属性还是类属性</li>
</ul>
<p><strong>注意：</strong>不指定是<code>存储型属性</code>还是<code>计算型属性</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">FullyNamed</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 只读属性</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starship</span>: <span class="title">FullyNamed</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">prefix</span>: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, <span class="keyword">prefix</span>: <span class="type">String</span>? = <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">prefix</span> = <span class="keyword">prefix</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">prefix</span> != <span class="literal">nil</span> ? <span class="keyword">prefix</span>! + <span class="string">" "</span> : <span class="string">""</span>) + name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> ncc1701 = <span class="type">Starship</span>(name: <span class="string">"Enterprise"</span>, <span class="keyword">prefix</span>: <span class="string">"USS"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="22-2-1-可读-amp-可写"><a href="#22-2-1-可读-amp-可写" class="headerlink" title="22.2.1    可读&amp;可写"></a>22.2.1    可读&amp;可写</h3><blockquote>
<p><strong>说明：</strong>在协议中指定属性规则是都使用<code>var</code>（不使用<code>let</code>）</p>
</blockquote>
<table>
<thead>
<tr>
<th>可读&amp;可写</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>可读</td>
<td><code>{get}</code></td>
<td>可以只读，可以可读可写</td>
</tr>
<tr>
<td>可写</td>
<td><code>{get set}</code></td>
<td>不能是<code>常量</code>或<code>只读计算属性</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 可读可写</span></span><br><span class="line">    <span class="keyword">var</span> mustBeSettable : <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="comment">// 只读</span></span><br><span class="line">    <span class="keyword">var</span> doesNotNeedToBeSettable: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-2-2-实例属性-amp-类属性"><a href="#22-2-2-实例属性-amp-类属性" class="headerlink" title="22.2.2    实例属性&amp;类属性"></a>22.2.2    实例属性&amp;类属性</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>实例属性&amp;类属性</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>实例属性</td>
<td>默认</td>
<td>默认</td>
</tr>
<tr>
<td>类属性</td>
<td><code>static</code></td>
<td><code>static</code>或<code>class</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 类属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> someTypeProperty: <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-3-对方法的规定"><a href="#22-3-对方法的规定" class="headerlink" title="22.3    对方法的规定"></a>22.3    对方法的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以要求采纳协议的类型实现某些指定的<code>实例方法</code>或<code>类方法</code>。<br><strong>语法：</strong>像普通方法一样放在协议的定义中，但是不需要<code>{}</code>和方法体</p>
<ul>
<li>可以在协议中定义具有<code>可变参数</code>的方法，和普通方法的定义方式相同</li>
<li><code>不支持</code>为协议中的方法的参数提供默认值</li>
<li>在协议中定义类方法的时候，总是使用 <code>static</code> 关键字作为前缀；当类类型采纳协议时，除了 <code>static</code> 关键字，还可以使用 <code>class</code> 关键字作为前缀</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 类方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">someTypeMethod</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线性同余随机数生成器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> generator = <span class="type">LinearCongruentialGenerator</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Here's a random number: \(generator.random())"</span>)<span class="comment">// 0.37464991998171”</span></span><br></pre></td></tr></table></figure>
<h2 id="22-4-对Mutating方法的规定"><a href="#22-4-对Mutating方法的规定" class="headerlink" title="22.4    对Mutating方法的规定"></a>22.4    对Mutating方法的规定</h2><blockquote>
<p><strong>说明：</strong>如果你在<code>协议中</code>定义了一个<code>实例方法</code>，该方法会改变采纳该协议的类型的<code>实例</code>，那么在定义协议时需要在方法前加 <code>mutating</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>实现者</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>类类型</td>
<td><code>mutating</code></td>
<td>不用写 <code>mutating</code> 关键字</td>
</tr>
<tr>
<td>值类型</td>
<td><code>mutating</code></td>
<td>必须写<code>mutating</code> 关键字</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Togglable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当它被调用时，将改变实例属性，从而切换采纳该协议类型的实例的状态</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议：开关</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">OnOffSwitch</span>: <span class="title">Togglable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Off</span>, <span class="type">On</span></span><br><span class="line">    <span class="comment">// 实现协议定义的 mutating 方法</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Off</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">On</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">On</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">Off</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> lightSwitch = <span class="type">OnOffSwitch</span>.<span class="type">Off</span></span><br><span class="line"><span class="comment">// 调用 mutating 方法</span></span><br><span class="line">lightSwitch.toggle()</span><br></pre></td></tr></table></figure>
<h2 id="22-5-对构造器的规定"><a href="#22-5-对构造器的规定" class="headerlink" title="22.5    对构造器的规定"></a>22.5    对构造器的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以要求采纳协议的类型实现指定的构造器<br><strong>语法：</strong>你可以像编写普通构造器那样，在协议的定义里<code>写下构造器的声明</code>，但<code>不需要写{}和构造器的实体</code></p>
</blockquote>
<h3 id="22-5-1-构造器要求在类中的实现"><a href="#22-5-1-构造器要求在类中的实现" class="headerlink" title="22.5.1    构造器要求在类中的实现"></a>22.5.1    构造器要求在类中的实现</h3><blockquote>
<p><strong>说明：</strong>使用<code>required</code> 修饰符（除非在<code>final</code>类中），可以是<code>指定构造器</code>或<code>便利构造器</code></p>
<ul>
<li>如果一个子类<code>重写</code>了父类的指定构造器，并且该构造器<code>满足了某个协议</code>的要求，那么该构造器的实现需要同时标注 <code>required</code> 和 <code>override</code> 修饰符</li>
<li>如果类已经被标记为 <code>final</code>，那么不需要在协议构造器的实现中使用 <code>required</code> 修饰符，因为<code>final</code> 类不能有子类</li>
</ul>
<p><strong>注意：</strong>使用 <code>required</code> 修饰符可以确保所有子类也必须提供此构造器实现，从而也能符合协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 构造器要求</span></span><br><span class="line">    <span class="keyword">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类：没有实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSuperClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 这里是构造器的实现部分</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类：既继承了父类，也实现了协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSubClass</span>: <span class="title">SomeSuperClass</span>, <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 因为继承自父类，需要加上 override</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 这里是构造器的实现部分</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-5-2-可失败构造器要求"><a href="#22-5-2-可失败构造器要求" class="headerlink" title="22.5.2    可失败构造器要求"></a>22.5.2    可失败构造器要求</h3><blockquote>
<p><strong>说明：</strong>协议还可以为采纳协议的类型定义<code>可失败构造器要求</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>构造器</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>可失败构造器</td>
<td><code>init?</code></td>
<td><code>init?</code>或<code>init</code></td>
</tr>
<tr>
<td>非可失败构造器</td>
<td><code>init</code></td>
<td><code>init</code>或<code>init!</code></td>
</tr>
</tbody>
</table>
<h2 id="22-6-协议作为类型"><a href="#22-6-协议作为类型" class="headerlink" title="22.6    协议作为类型"></a>22.6    协议作为类型</h2><blockquote>
<p><strong>说明：</strong>尽管协议本身并未实现任何功能，但是协议可以被当做一个成熟的类型来使用。</p>
<ul>
<li>作为函数、方法或构造器中的<code>参数类型</code>或<code>返回值类型</code></li>
<li>作为<code>常量</code>、<code>变量</code>或<code>属性</code>的类型</li>
<li>作为数组、字典或其他<code>容器中的元素类型</code></li>
</ul>
<p><strong>注意：</strong>作为一种类型，协议类型的名称应与其他类型的写法相同（<code>大写字母开头的驼峰式写法</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 使用协议类型声明常量</span></span><br><span class="line">    <span class="keyword">let</span> generator: <span class="type">RandomNumberGenerator</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用协议类型作为参数（需要传递一个实现了该协议枚举、结构体或类的实例）</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>, generator: <span class="type">RandomNumberGenerator</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">        <span class="keyword">self</span>.generator = generator</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 掷骰子</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">roll</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(generator.random() * <span class="type">Double</span>(sides)) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建骰子实例</span></span><br><span class="line"><span class="keyword">var</span> d6 = <span class="type">Dice</span>(sides: <span class="number">6</span>, generator: <span class="type">LinearCongruentialGenerator</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 掷骰子5次</span></span><br><span class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">1</span>...<span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Random dice roll is \(d6.roll())"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-7-委托（代理）模式"><a href="#22-7-委托（代理）模式" class="headerlink" title="22.7    委托（代理）模式"></a>22.7    委托（代理）模式</h2><blockquote>
<p><strong>描述：</strong>委托是一种<code>设计模式</code>，它允许<code>类或结构体</code>将一些需要它们负责的功能委托给其他类型的实例。<br><strong>说明：</strong>委托模式的实现很简单</p>
<ul>
<li>定义协议来封装那些需要被委托的功能，这样就能确保采纳协议的类型能提供这些功能</li>
<li>委托模式可以用来响应特定的动作，或者接收外部数据源提供的数据，而无需关心外部数据源的类型。</li>
</ul>
<p><strong>案例：</strong><code>游戏</code>将监控这一功能委托给<code>游戏监控器</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 使用协议类型声明常量</span></span><br><span class="line">    <span class="keyword">let</span> generator: <span class="type">RandomNumberGenerator</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用协议类型作为参数（需要传递一个实现了该协议枚举、结构体或类的实例）</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>, generator: <span class="type">RandomNumberGenerator</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">        <span class="keyword">self</span>.generator = generator</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 掷骰子</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">roll</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(generator.random() * <span class="type">Double</span>(sides)) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议：掷骰子游戏</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DiceGame</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子</span></span><br><span class="line">    <span class="keyword">var</span> dice: <span class="type">Dice</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 进行游戏</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">play</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议：追踪 DiceGame</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DiceGameDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 游戏开始</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidStart</span><span class="params">(game: DiceGame)</span></span></span><br><span class="line">    <span class="comment">// 游戏进行</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">game</span><span class="params">(game: DiceGame, didStartNewTurnWithDiceRoll diceRoll:Int)</span></span></span><br><span class="line">    <span class="comment">// 游戏结束</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidEnd</span><span class="params">(game: DiceGame)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现：蛇梯棋游戏</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SnakesAndLadders</span>: <span class="title">DiceGame</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> finalSquare = <span class="number">25</span></span><br><span class="line">    <span class="comment">// 实现属性（要求只读，可以声明为 let ）</span></span><br><span class="line">    <span class="keyword">let</span> dice = <span class="type">Dice</span>(sides: <span class="number">6</span>, generator: <span class="type">LinearCongruentialGenerator</span>())</span><br><span class="line">    <span class="keyword">var</span> square = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> board: [<span class="type">Int</span>]</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        board = [<span class="type">Int</span>](<span class="built_in">count</span>: finalSquare + <span class="number">1</span>, repeatedValue: <span class="number">0</span>)</span><br><span class="line">        board[<span class="number">03</span>] = +<span class="number">08</span>; board[<span class="number">06</span>] = +<span class="number">11</span>; board[<span class="number">09</span>] = +<span class="number">09</span>; board[<span class="number">10</span>] = +<span class="number">02</span></span><br><span class="line">        board[<span class="number">14</span>] = -<span class="number">10</span>; board[<span class="number">19</span>] = -<span class="number">11</span>; board[<span class="number">22</span>] = -<span class="number">02</span>; board[<span class="number">24</span>] = -<span class="number">08</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏监控器</span></span><br><span class="line">    <span class="keyword">var</span> delegate: <span class="type">DiceGameDelegate</span>?</span><br><span class="line">    <span class="comment">// 实现方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">play</span><span class="params">()</span></span> &#123;</span><br><span class="line">        square = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 开始游戏</span></span><br><span class="line">        delegate?.gameDidStart(<span class="keyword">self</span>)</span><br><span class="line">        gameLoop: <span class="keyword">while</span> square != finalSquare &#123;</span><br><span class="line">            <span class="keyword">let</span> diceRoll = dice.roll()</span><br><span class="line">            delegate?.game(<span class="keyword">self</span>, didStartNewTurnWithDiceRoll: diceRoll)</span><br><span class="line">            <span class="keyword">switch</span> square + diceRoll &#123;</span><br><span class="line">            <span class="keyword">case</span> finalSquare:</span><br><span class="line">                <span class="keyword">break</span> gameLoop</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> newSquare <span class="keyword">where</span> newSquare &gt; finalSquare:</span><br><span class="line">                <span class="keyword">continue</span> gameLoop</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                square += diceRoll</span><br><span class="line">                square += board[square]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 结束游戏</span></span><br><span class="line">        delegate?.gameDidEnd(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现：游戏监控器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiceGameTracker</span>: <span class="title">DiceGameDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfTurns = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 游戏开始时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidStart</span><span class="params">(game: DiceGame)</span></span> &#123;</span><br><span class="line">        numberOfTurns = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> game <span class="keyword">is</span> <span class="type">SnakesAndLadders</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Started a new game of Snakes and Ladders"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"The game is using a \(game.dice.sides)-sided dice"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏进行时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">game</span><span class="params">(game: DiceGame, didStartNewTurnWithDiceRoll diceRoll: Int)</span></span> &#123;</span><br><span class="line">        ++numberOfTurns</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Rolled a \(diceRoll)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏结束时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidEnd</span><span class="params">(game: DiceGame)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"The game lasted for \(numberOfTurns) turns"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监控器实例</span></span><br><span class="line"><span class="keyword">let</span> tracker = <span class="type">DiceGameTracker</span>()</span><br><span class="line"><span class="comment">// 游戏实例</span></span><br><span class="line"><span class="keyword">let</span> game = <span class="type">SnakesAndLadders</span>()</span><br><span class="line"><span class="comment">// 将监控器实例提供给游戏实例(不是必需的)</span></span><br><span class="line">game.delegate = tracker</span><br><span class="line"><span class="comment">// 游戏开始</span></span><br><span class="line">game.play()</span><br></pre></td></tr></table></figure>
<h2 id="22-8-在扩展中添加协议成员"><a href="#22-8-在扩展中添加协议成员" class="headerlink" title="22.8    在扩展中添加协议成员"></a>22.8    在扩展中添加协议成员</h2><blockquote>
<p><strong>说明：</strong>即便无法修改源代码，依然可以通过扩展令已有类型采纳并符合协议。<br><strong>原理：</strong>通过扩展令已有类型采纳并符合协议时，该类型的所有实例也会随之获得协议中定义的各项功能。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  通过extension使骰子实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dice</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A \(sides)-sided dice"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> d12 = <span class="type">Dice</span>(sides: <span class="number">12</span>)</span><br><span class="line"><span class="built_in">print</span>(d12.textualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-9-通过扩展补充协议声明"><a href="#22-9-通过扩展补充协议声明" class="headerlink" title="22.9    通过扩展补充协议声明"></a>22.9    通过扩展补充协议声明</h2><blockquote>
<p><strong>说明：</strong>可以通过扩展<code>空的扩展体</code>补充协议声明。需要两个前提</p>
<ul>
<li><code>已经实现了</code>协议中所有要求</li>
<li><code>没有声明</code>为遵循该协议</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体（没有声明实现的协议）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hamster</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A hamster named \(name)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展补充协议声明</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Hamster</span>: <span class="title">TextRepresentable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> simonTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Simon"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为 TextRepresentable 类型使用</span></span><br><span class="line"><span class="keyword">let</span> somethingTextRepresentable: <span class="type">TextRepresentable</span> = simonTheHamster</span><br><span class="line"><span class="built_in">print</span>(somethingTextRepresentable.textualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-10-集合中的协议类型"><a href="#22-10-集合中的协议类型" class="headerlink" title="22.10    集合中的协议类型"></a>22.10    集合中的协议类型</h2><blockquote>
<p><strong>说明：</strong>协议类型可以在集合使用,表示<code>集合中的元素均为协议类型</code><br><strong>注意：</strong>被当作协议类型使用后，只能使用和访问协议指定的功能（丢失具体类型的特色能力）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议类型数组</span></span><br><span class="line"><span class="keyword">let</span> things: [<span class="type">TextRepresentable</span>] = [game, d12, simonTheHamster]</span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> things &#123;</span><br><span class="line">    <span class="built_in">print</span>(thing.textualDescription)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-11-协议的继承"><a href="#22-11-协议的继承" class="headerlink" title="22.11    协议的继承"></a>22.11    协议的继承</h2><blockquote>
<p><strong>说明：</strong>协议能够继承一个或多个其他协议，可以在继承的协议的基础上增加新的要求。和类的继承类似<br><strong>语法：</strong>多个被继承的协议间用<code>,</code>分隔</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">InheritingProtocol</span>: <span class="title">SomeProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里是协议的定义部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">PrettyTextRepresentable</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 额外要求采纳协议的类型提供一个返回值为 String 类型的 prettyTextualDescription 属性</span></span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展让已有类实现子类协议（要同时实现父类协议）</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SnakesAndLadders</span>: <span class="title">PrettyTextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> output = textualDescription + <span class="string">":\n"</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...finalSquare &#123;</span><br><span class="line">            <span class="keyword">switch</span> board[index] &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> ladder <span class="keyword">where</span> ladder &gt; <span class="number">0</span>:</span><br><span class="line">                output += <span class="string">"▲ "</span></span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> snake <span class="keyword">where</span> snake &lt; <span class="number">0</span>:</span><br><span class="line">                output += <span class="string">"▼ "</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                output += <span class="string">"○ "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 已有的实例也会获取到这种实现</span></span><br><span class="line"><span class="built_in">print</span>(game.prettyTextualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-12-类类型专属协议"><a href="#22-12-类类型专属协议" class="headerlink" title="22.12    类类型专属协议"></a>22.12    类类型专属协议</h2><blockquote>
<p><strong>说明：</strong>以在<code>协议的继承列表</code>中，通过添加 <code>class</code> 关键字来限制协议只能被<code>类</code>类型采纳，而<code>结构体</code>或<code>枚举</code>不能采纳该协议<br><strong>语法：</strong><code>class</code> 关键字必须<code>第一个出现在协议的继承列表中</code>(在其他继承的协议之前)<br><strong>应用：</strong>当协议定义的要求需要采纳协议的类型必须是<code>引用</code>语义而非<code>值</code>语义时，应该采用类类型专属协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeClassOnlyProtocol</span>: <span class="title">class</span>, <span class="title">SomeInheritedProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里是类类型专属协议的定义部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-13-协议合成"><a href="#22-13-协议合成" class="headerlink" title="22.13    协议合成"></a>22.13    协议合成</h2><blockquote>
<p><strong>说明：</strong>有时候需要同时采纳多个协议，你可以将多个协议采用 <code>protocol&lt;SomeProtocol, AnotherProtocol&gt;</code> 这样的格式进行组合，作为一种<code>临时协议</code>存在，这个过程称为 <code>协议合成</code>。<br><strong>语法：</strong>可以在 <code>protocol&lt;&gt;</code> 中罗列任意多个你想要采纳的协议，以<code>,</code>分隔。<br><strong>注意：</strong>协议合成并不会生成新的、永久的协议类型，而是将多个协议中的要求合成到一个<code>只在局部作用域有效</code>的<code>临时协议</code>中。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议1</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Named</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 协议2</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Aged</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现两个协议</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span>: <span class="title">Named</span>, <span class="title">Aged</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 协议合成</span><br><span class="line">* @param &#123;protocol&lt;Named, Aged&gt;&#125; celebrator 实现了两种协议的类型的实例</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wishHappyBirthday</span><span class="params">(celebrator: <span class="keyword">protocol</span>&lt;Named, Aged&gt;)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Happy birthday \(celebrator.name) - you're \(celebrator.age)!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> birthdayPerson = <span class="type">Person</span>(name: <span class="string">"Malcolm"</span>, age: <span class="number">21</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递符合两种协议的实例给函数</span></span><br><span class="line">wishHappyBirthday(birthdayPerson)</span><br></pre></td></tr></table></figure>
<h2 id="22-14-检验协议的一致性"><a href="#22-14-检验协议的一致性" class="headerlink" title="22.14    检验协议的一致性"></a>22.14    检验协议的一致性</h2><blockquote>
<p><strong>说明：</strong>其实就是检验<code>是否符合某协议</code>，或者转换到指定的协议类型。检查和转换到某个协议类型在语法上和<code>类型的检查和转换</code>完全相同</p>
</blockquote>
<table>
<thead>
<tr>
<th>操作符</th>
<th>用途</th>
<th>返回值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>is</code></td>
<td>用来检查实例是否符合某个协议</td>
<td>符合则返回 <code>true</code>，否则返回 <code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>as?</code></td>
<td>返回指定协议的可选值</td>
<td>，当实例符合某个协议时，返回类型为协议类型的可选值，否则返回 <code>nil</code></td>
<td></td>
</tr>
<tr>
<td><code>as!</code></td>
<td>将实例强制向下转换到某个协议类型</td>
<td>指定的协议类型</td>
<td>如果强转失败，会引发运行时错误</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>: <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> pi = <span class="number">3.1415927</span></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123; <span class="keyword">return</span> pi * radius * radius &#125;</span><br><span class="line">    <span class="keyword">init</span>(radius: <span class="type">Double</span>) &#123; <span class="keyword">self</span>.radius = radius &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span>: <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>(area: <span class="type">Double</span>) &#123; <span class="keyword">self</span>.area = area &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> legs: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(legs: <span class="type">Int</span>) &#123; <span class="keyword">self</span>.legs = legs &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应实例</span></span><br><span class="line"><span class="keyword">let</span> objects: [<span class="type">AnyObject</span>] = [</span><br><span class="line">    <span class="type">Circle</span>(radius: <span class="number">2.0</span>),</span><br><span class="line">    <span class="type">Country</span>(area: <span class="number">243_610</span>),</span><br><span class="line">    <span class="type">Animal</span>(legs: <span class="number">4</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历，使用 as?</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> objects &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> objectWithArea = object <span class="keyword">as</span>? <span class="type">HasArea</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Area is \(objectWithArea.area)"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Something that doesn't have an area"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-15-对可选协议的规定"><a href="#22-15-对可选协议的规定" class="headerlink" title="22.15    对可选协议的规定"></a>22.15    对可选协议的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以定义可选要求，采纳协议的类型可以选择是否实现这些要求。<br><strong>语法：</strong>在协议中使用 <code>optional</code>关键字作为前缀来定义可选要求。</p>
<ul>
<li>使用可选要求时，它们的类型会自动变成可选的</li>
<li>需要<code>import Foundation</code></li>
</ul>
<p><strong>限制：</strong></p>
<ul>
<li><strong>定义协议：</strong>可选的协议要求只能用在标记 <code>@objc</code> 特性的协议中</li>
<li><strong>采纳协议：</strong>标记 <code>@objc</code> 特性的协议只能被<code>继承自 Objective-C 类的类</code>或者<code>@objc 类</code>采纳</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* @objc</span><br><span class="line">* 协议：只能被 [继承自 Objective-C 类的类] 或者 [@objc 类]采纳</span><br><span class="line">*/</span></span><br><span class="line">objc <span class="class"><span class="keyword">protocol</span> <span class="title">CounterDataSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">incrementForCount</span><span class="params">(<span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="keyword">var</span> fixedIncrement: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> dataSource: <span class="type">CounterDataSource</span>?</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> amount = dataSource?.incrementForCount?(<span class="built_in">count</span>) &#123;</span><br><span class="line">            <span class="built_in">count</span> += amount</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> amount = dataSource?.fixedIncrement &#123;</span><br><span class="line">            <span class="built_in">count</span> += amount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 采纳协议</span><br><span class="line">* 继承了 NSObject，所以可以采纳 CounterDataSource</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreeSource</span>: <span class="title">NSObject</span>, <span class="title">CounterDataSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fixedIncrement = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = <span class="type">Counter</span>()</span><br><span class="line">counter.dataSource = <span class="type">ThreeSource</span>()</span><br><span class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">1</span>...<span class="number">4</span> &#123;</span><br><span class="line">    counter.increment()</span><br><span class="line">    <span class="built_in">print</span>(counter.<span class="built_in">count</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-16-协议扩展"><a href="#22-16-协议扩展" class="headerlink" title="22.16    协议扩展"></a>22.16    协议扩展</h2><blockquote>
<p><strong>说明：</strong>协议可以通过<code>扩展</code>来为<code>采纳协议的类型</code>提供属性、方法以及下标脚本的实现。<br><strong>优点：</strong>扩展协议不但扩展了要求，同时提供了实现。因而<code>无需</code>在每个采纳协议的类型中都重复同样的实现，也<code>无需</code>使用全局函数。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议：线性同余随机数生成器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展协议（同时提供了实现）</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomBool</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> random() &gt; <span class="number">0.5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳了协议的类型的实例</span></span><br><span class="line"><span class="keyword">let</span> generator = <span class="type">LinearCongruentialGenerator</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Here's a random number: \(generator.random())"</span>)</span><br><span class="line"><span class="comment">// 打印 “Here's a random number: 0.37464991998171”</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"And here's a random Boolean: \(generator.randomBool())"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="22-16-1-提供默认实现"><a href="#22-16-1-提供默认实现" class="headerlink" title="22.16.1    提供默认实现"></a>22.16.1    提供默认实现</h3><blockquote>
<p><strong>说明：</strong>可以通过<code>协议扩展</code>来为协议要求的属性、方法以及下标脚本提供<code>默认的实现</code>。<br><strong>注意：</strong>如果采纳协议的类型为这些要求提供了自己的实现，那么这些<code>自定义实现将会替代扩展中的默认实现</code>被使用。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PrettyTextRepresentable</span>  </span>&#123;</span><br><span class="line">	<span class="comment">// 为协议提供一个默认的属性</span></span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> textualDescription</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-16-2-为协议扩展添加限制条件"><a href="#22-16-2-为协议扩展添加限制条件" class="headerlink" title="22.16.2    为协议扩展添加限制条件"></a>22.16.2    为协议扩展添加限制条件</h3><blockquote>
<p><strong>说明：</strong>在<code>扩展协议</code>的时候，可以<code>指定一些限制条件</code>，只有采纳协议的类型满足这些限制条件时，才能获得协议扩展提供的<code>默认实现</code>。<br><strong>语法：</strong>这些限制条件写在<code>协议名之后</code>，使用 <code>where</code> 子句来描述.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体（没有声明实现的协议）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hamster</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A hamster named \(name)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展补充协议声明</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Hamster</span>: <span class="title">TextRepresentable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展采纳协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CollectionType</span> <span class="title">where</span> <span class="title">Generator</span>.<span class="title">Element</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> itemsAsText = <span class="keyword">self</span>.<span class="built_in">map</span> &#123; $<span class="number">0</span>.textualDescription &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"["</span> + itemsAsText.joinWithSeparator(<span class="string">", "</span>) + <span class="string">"]"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> murrayTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Murray"</span>)</span><br><span class="line"><span class="keyword">let</span> morganTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Morgan"</span>)</span><br><span class="line"><span class="keyword">let</span> mauriceTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Maurice"</span>)</span><br><span class="line"><span class="keyword">let</span> hamsters = [murrayTheHamster, morganTheHamster, mauriceTheHamster]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hamsters.textualDescription)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_21 扩展/" itemprop="url">
                  21 扩展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:57:35+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>扩展</code>就是为一个已有的<code>类</code>、<code>结构体</code>、<code>枚举类型</code>或者<code>协议类型</code>添加新功能(包括没有权限获取原始源代码的情况)。</p>
<ul>
<li>添加<code>计算型属性</code>和<code>计算类型属性</code></li>
<li>定义<code>实例方法</code>和<code>类型方法</code></li>
<li>提供新的<code>构造器</code></li>
<li>定义<code>下标</code></li>
<li>定义和使用新的<code>嵌套类型</code></li>
<li>是一个有类型符合某个<code>协议</code></li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>扩展可以为一个类型添加新的功能，但是<code>不能重写已有的功能</code>。</li>
<li>如果你通过扩展为一个已有类型添加新功能，那么新功能对该类型的所有已有实例都是可用的，<code>即使它们是在这个扩展定义之前创建的</code>。</li>
</ul>
</blockquote>
<h2 id="21-1-扩展语法"><a href="#21-1-扩展语法" class="headerlink" title="21.1    扩展语法"></a>21.1    扩展语法</h2><blockquote>
<p><strong>说明：</strong>使用<code>extension</code>声明扩展</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 形式一：为SomeType添加功能</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SomeType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 为 SomeType 添加的新功能写到这里</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 形式二：使SomeType实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SomeType</span>: <span class="title">SomeProtocol</span>, <span class="title">AnotherProctocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 协议实现写到这里</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="21-2-计算型属性"><a href="#21-2-计算型属性" class="headerlink" title="21.2    计算型属性"></a>21.2    计算型属性</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加<code>计算型实例属性</code>和<code>计算型类型属性</code>。<br><strong>注意：</strong>不可以添加<code>存储型属性</code>，也不可以为已有属性<code>添加属性观察器</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为Double添加一些只读计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Double</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 千米</span></span><br><span class="line">    <span class="keyword">var</span> km: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> * <span class="number">1_000.0</span> &#125;</span><br><span class="line">    <span class="comment">// 米</span></span><br><span class="line">    <span class="keyword">var</span> m : <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> &#125;</span><br><span class="line">    <span class="comment">// 厘米</span></span><br><span class="line">    <span class="keyword">var</span> cm: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">100.0</span> &#125;</span><br><span class="line">    <span class="comment">// 毫米</span></span><br><span class="line">    <span class="keyword">var</span> mm: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">1_000.0</span> &#125;</span><br><span class="line">    <span class="comment">// 尺</span></span><br><span class="line">    <span class="keyword">var</span> ft: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">3.28084</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问计算属性</span></span><br><span class="line"><span class="keyword">let</span> oneInch = <span class="number">25.4</span>.mm<span class="comment">// 0.0254</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> threeFeet = <span class="number">3</span>.ft<span class="comment">// 0.914399970739201</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> aMarathon = <span class="number">42</span>.km + <span class="number">195</span>.m<span class="comment">// 42195.0</span></span><br></pre></td></tr></table></figure>
<h2 id="21-3-构造器"><a href="#21-3-构造器" class="headerlink" title="21.3    构造器"></a>21.3    构造器</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加<code>新的构造器</code>(便利构造器)</p>
<ul>
<li>在为值类型扩展的构造器中调用<code>逐一构造器</code>：值类型的原始实现中未定义任何定制的构造器时</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 大小</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 坐标</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正方形</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 原点</span></span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="comment">// 大小</span></span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例：默认构造器</span></span><br><span class="line"><span class="keyword">let</span> defaultRect = <span class="type">Rect</span>()</span><br><span class="line"><span class="comment">// 创建实例：逐一成员构造器</span></span><br><span class="line"><span class="keyword">let</span> memberwiseRect = <span class="type">Rect</span>(origin: <span class="type">Point</span>(x: <span class="number">2.0</span>, y: <span class="number">2.0</span>),</span><br><span class="line">    size: <span class="type">Size</span>(width: <span class="number">5.0</span>, height: <span class="number">5.0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展 Rect</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加一个新的构造器</span></span><br><span class="line">    <span class="keyword">init</span>(center: <span class="type">Point</span>, size: <span class="type">Size</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> originX = center.x - (size.width / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">let</span> originY = center.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        <span class="comment">// 调用逐一成员构造器</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(origin: <span class="type">Point</span>(x: originX, y: originY), size: size)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用扩展的构造器创建 Rect 的实例</span></span><br><span class="line"><span class="keyword">let</span> centerRect = <span class="type">Rect</span>(center: <span class="type">Point</span>(x: <span class="number">4.0</span>, y: <span class="number">4.0</span>),</span><br><span class="line">    size: <span class="type">Size</span>(width: <span class="number">3.0</span>, height: <span class="number">3.0</span>))</span><br></pre></td></tr></table></figure>
<h2 id="21-4-方法"><a href="#21-4-方法" class="headerlink" title="21.4    方法"></a>21.4    方法</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加新的<code>实例方法</code>和<code>类型方法</code>。<br><strong>注意：</strong><code>结构体</code>和<code>枚举</code>类型中修改 <code>self</code> 或<code>其属性</code>的方法必须将该实例方法标注为 <code>mutating</code>，正如来自原始实现的<code>变异方法</code>一样。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 添加一个实例方法</span><br><span class="line">    * 按照自身数目重复执行一个任务</span><br><span class="line">    * @param &#123;() -&gt; Void&#125; task 函数</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">repetitions</span><span class="params">(task: <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="keyword">self</span> &#123;</span><br><span class="line">            task()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用扩展的实例方法</span></span><br><span class="line"><span class="number">3</span>.repetitions(&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更简洁的方式（使用尾随闭包）</span></span><br><span class="line"><span class="number">3</span>.repetitions &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Goodbye!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>添加变异方法</em></p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 结构体和枚举类型中修改 self 或其属性的方法必须将该实例方法标注为 mutating</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">square</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="keyword">self</span> * <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> someInt = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用扩展的实例方法</span></span><br><span class="line">someInt.square()</span><br></pre></td></tr></table></figure>
<h2 id="21-5-下标"><a href="#21-5-下标" class="headerlink" title="21.5    下标"></a>21.5    下标</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加新<code>下标</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* 添加一个下标</span><br><span class="line">     * 从右往左数</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="keyword">var</span> digitIndex: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> decimalBase = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> digitIndex &gt; <span class="number">0</span> &#123;</span><br><span class="line">            decimalBase *= <span class="number">10</span></span><br><span class="line">            --digitIndex</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> / decimalBase) % <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">746381295</span>[<span class="number">0</span>]<span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">1</span>]<span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">2</span>]<span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">8</span>]<span class="comment">// 7</span></span><br></pre></td></tr></table></figure>
<h2 id="21-6-嵌套类型"><a href="#21-6-嵌套类型" class="headerlink" title="21.6    嵌套类型"></a>21.6    嵌套类型</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有的<code>类</code>、<code>结构体</code>和<code>枚举</code>添加新的<code>嵌套类型</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 数字类型（正、0、负）</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Kind</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Negative</span>, <span class="type">Zero</span>, <span class="type">Positive</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算属性：获取数字类型</span></span><br><span class="line">    <span class="keyword">var</span> kind: <span class="type">Kind</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Zero</span></span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Positive</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Negative</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 判断数组中 Int 的类型</span><br><span class="line">* @param &#123;[Int]&#125; numbers Int数组</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printIntegerKinds</span><span class="params">(numbers: [Int])</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">switch</span> number.kind &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Negative</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"- "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Zero</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"0 "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Positive</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"+ "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">printIntegerKinds([<span class="number">3</span>, <span class="number">19</span>, -<span class="number">27</span>, <span class="number">0</span>, -<span class="number">6</span>, <span class="number">0</span>, <span class="number">7</span>])<span class="comment">// + + - 0 - 0 +swift</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_20 类型嵌套/" itemprop="url">
                  20 类型嵌套
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:57:17+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Swift</code> 允许你定义嵌套类型，可以在支持的类型中定义嵌套的<code>枚举</code>、<code>类</code>和<code>结构体</code>。可以根据需要定义<code>多级嵌套</code>。<br><strong>用途：</strong>方便地定义工具类或结构体来使用。</p>
</blockquote>
<h2 id="20-1-嵌套类型实践"><a href="#20-1-嵌套类型实践" class="headerlink" title="20.1    嵌套类型实践"></a>20.1    嵌套类型实践</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">* 扑克牌</span><br><span class="line">* 没有自定义构造器的结构体：因此有默认的成员构造器</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlackjackCard</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 嵌套的 Suit 枚举</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Suit</span>: <span class="title">Character</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Spades</span> = <span class="string">"♠"</span>, <span class="type">Hearts</span> = <span class="string">"♡"</span>, <span class="type">Diamonds</span> = <span class="string">"♢"</span>, <span class="type">Clubs</span> = <span class="string">"♣"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 嵌套的 Rank 枚举</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Rank</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Two</span> = <span class="number">2</span>, <span class="type">Three</span>, <span class="type">Four</span>, <span class="type">Five</span>, <span class="type">Six</span>, <span class="type">Seven</span>, <span class="type">Eight</span>, <span class="type">Nine</span>, <span class="type">Ten</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Jack</span>, <span class="type">Queen</span>, <span class="type">King</span>, <span class="type">Ace</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Values</span> </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> first: <span class="type">Int</span>, second: <span class="type">Int</span>?</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> values: <span class="type">Values</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Ace</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="number">1</span>, second: <span class="number">11</span>)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Jack</span>, .<span class="type">Queen</span>, .<span class="type">King</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="number">10</span>, second: <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="keyword">self</span>.rawValue, second: <span class="literal">nil</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用嵌套在结构体内部的类型声明属性</span></span><br><span class="line">    <span class="keyword">let</span> rank: <span class="type">Rank</span>, suit: <span class="type">Suit</span></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> output = <span class="string">"suit is \(suit.rawValue),"</span></span><br><span class="line">        output += <span class="string">" value is \(rank.values.first)"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> second = rank.values.second &#123;</span><br><span class="line">            output += <span class="string">" or \(second)"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例（嵌套类型也能用于类型推断）</span></span><br><span class="line"><span class="keyword">let</span> theAceOfSpades = <span class="type">BlackjackCard</span>(rank: .<span class="type">Ace</span>, suit: .<span class="type">Spades</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"theAceOfSpades:\(theAceOfSpades.description)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="20-2-嵌套类型的引用"><a href="#20-2-嵌套类型的引用" class="headerlink" title="20.2    嵌套类型的引用"></a>20.2    嵌套类型的引用</h2><blockquote>
<p><strong>说明：</strong>在外部引用嵌套类型时，在<code>嵌套类型的类型名</code>前加上<code>其外部类型的类型名</code>作为前缀。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引用嵌套类型</span></span><br><span class="line"><span class="keyword">let</span> heartsSymbol = <span class="type">BlackjackCard</span>.<span class="type">Suit</span>.<span class="type">Hearts</span>.rawValue</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_19 类型转换（Type Casting）/" itemprop="url">
                  19 类型转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:56:57+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>类型转换</code>可以判断实例的类型，也可以将实例看做是其父类或者子类的实例。<br><strong>操作符：</strong><code>is</code>和<code>as</code></p>
<ul>
<li>检查值的类型：<code>is</code></li>
<li>转换类型：<code>as</code></li>
</ul>
</blockquote>
<h2 id="19-1-定义一个类层次作为例子"><a href="#19-1-定义一个类层次作为例子" class="headerlink" title="19.1    定义一个类层次作为例子"></a>19.1    定义一个类层次作为例子</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//多媒体文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//电影</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span>:<span class="title">MediaItem</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> director:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, director:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.director = director</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//歌曲</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Song</span>:<span class="title">MediaItem</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> artist:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>,artist:<span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.artist = artist</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//存储多媒体文件的数组（迭代该数组取出的每一项类型都会是MediaItem）</span></span><br><span class="line"><span class="keyword">let</span> library = [</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Casablance"</span>, director: <span class="string">"Michael Curtiz"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"Blue Suede Shoes"</span>, artist: <span class="string">"Elvis Presley"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Citizen Kane"</span>, director: <span class="string">"Orson Welles"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"The One And The Only"</span>, artist: <span class="string">"Chesney Jawkes"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"Never Gonna Give You up"</span>, artist: <span class="string">"Rick Astley"</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="19-2-检查类型"><a href="#19-2-检查类型" class="headerlink" title="19.2    检查类型"></a>19.2    检查类型</h2><blockquote>
<p><strong>说明：</strong><code>类型检查操作符(is)</code>，用来检查一个实例是否属于<code>特定子类型</code>。若实例属于那个子类型，类型检查操作符返回 <code>true</code>，否则返回 <code>false</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//计算电影和歌曲类型分别的有多少个</span></span><br><span class="line"><span class="keyword">var</span> movieCount = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> songCount = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> library&#123;</span><br><span class="line">    <span class="comment">//通过is判断一个实例具体是某种类型的哪种子类型</span></span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">Movie</span>&#123;</span><br><span class="line">        ++movieCount</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">Song</span>&#123;</span><br><span class="line">        ++songCount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"Media library contains \(movieCount) movies and \(songCount) songs"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="19-3-向下转型"><a href="#19-3-向下转型" class="headerlink" title="19.3    向下转型"></a>19.3    向下转型</h2><blockquote>
<p><strong>两种方式：</strong>可选形式和强制形式<br><strong>注意：</strong>类型转换不影响原本被转换的实例</p>
</blockquote>
<table>
<thead>
<tr>
<th><em>**</em></th>
<th>可选形式</th>
<th>强制形式</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型转换操作符</td>
<td><code>as?</code></td>
<td><code>as</code></td>
</tr>
<tr>
<td>适用场景</td>
<td>试图向下转型为一个不确定的类型</td>
<td>向下转成一个确定的类型</td>
</tr>
<tr>
<td>返回值</td>
<td>返回试图向下转成的的类型的可选值</td>
<td>返回目标类型</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//向下转型(不改变原本实例，指示获得转变后的实例来使用)</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> library&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> movie = item <span class="keyword">as</span>? <span class="type">Movie</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.\(movie.director)"</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> song = item <span class="keyword">as</span>? <span class="type">Song</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Song:'\(song.name)',by \(song.artist)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="19-4-Any和AnyObject的类型转换"><a href="#19-4-Any和AnyObject的类型转换" class="headerlink" title="19.4    Any和AnyObject的类型转换"></a>19.4    <code>Any</code>和<code>AnyObject</code>的类型转换</h2><blockquote>
<p><strong>Swift为不确定类型提供了两种特殊类型别名：</strong></p>
<ul>
<li><code>AnyObject</code>：可以代表任何<code>class</code>类型的实例</li>
<li><code>Any</code>：可以表示任何类型，除了方法类型</li>
</ul>
<p><strong>注意：</strong>只有当你明确的需要它的行为和功能时才使用<code>Any</code>和<code>AnyObject</code></p>
</blockquote>
<h3 id="19-4-1-AnyObject类型"><a href="#19-4-1-AnyObject类型" class="headerlink" title="19.4.1    AnyObject类型"></a>19.4.1    <code>AnyObject</code>类型</h3><blockquote>
<p><strong>用途：</strong>在工作中使用 <code>Cocoa APIs</code> 时，我们经常会接收到一个 <code>[AnyObject]</code> 类型的数组，或者说“一个任意类型对象的数组”。这是因为 <code>Objective-C</code> 没有明确的类型化数组。<br><strong>说明：</strong>从 <code>Xcode 7</code> 和 <code>Swift 2.0</code> 开始，由于 <code>Objective-C</code> 引入了轻量泛型，集合类型已经可以类型化了，在 <code>Swift</code> 中使用 <code>Cocoa API</code> 也越来越少遇到 <code>AnyObjec</code> 类型了。<br><strong>技巧：</strong>可以使用强制形式的类型转换<code>as</code>来下转数组中的每一项到比 <code>AnyObject</code> 更明确的类型</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//AnyObject:可以代表任何class类型的实例</span></span><br><span class="line"><span class="keyword">let</span> someObjects:[<span class="type">AnyObject</span>] = [</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"2001:A Space Obyssey"</span>, director: <span class="string">"Stanley Kubrick"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Moon"</span>, director: <span class="string">"Duncan Jones"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Alien"</span>, director: <span class="string">"Ridley Scott"</span>)</span><br><span class="line">]</span><br><span class="line"><span class="comment">//方式一</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> someObjects&#123;</span><br><span class="line">    <span class="keyword">let</span> movie = object <span class="keyword">as</span> <span class="type">Movie</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.Stanley Kubrick"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//方式二（更简洁）</span></span><br><span class="line"><span class="keyword">for</span> movie <span class="keyword">in</span> someObjects <span class="keyword">as</span> [<span class="type">Movie</span>]&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.\(movie.director)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-4-2-Any类型"><a href="#19-4-2-Any类型" class="headerlink" title="19.4.2    Any类型"></a>19.4.2    <code>Any</code>类型</h3><p><strong>注意：</strong>在<code>switch</code>语句的<code>case</code>中使用<code>as</code>而不是<code>as?</code>是安全的，不会导致运行时错误</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Any类型</span></span><br><span class="line"><span class="keyword">var</span> things = [<span class="type">Any</span>]()</span><br><span class="line">things.append(<span class="number">0</span>)</span><br><span class="line">things.append(<span class="number">0.0</span>)</span><br><span class="line">things.append(<span class="number">42</span>)</span><br><span class="line">things.append(<span class="number">3.141592654</span>)</span><br><span class="line">things.append(<span class="string">"hello"</span>)</span><br><span class="line">things.append(<span class="type">Movie</span>(name: <span class="string">"Ghostbusters"</span>, director: <span class="string">"Ivan Reitman"</span>))</span><br><span class="line">things.append(&#123;(name:<span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span> <span class="string">"Hello,\(name)"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> things &#123;</span><br><span class="line">    <span class="keyword">switch</span> thing &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"zero as an Int"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"zero as a Double"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someInt <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"an integer value of \(someInt)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someDouble <span class="keyword">as</span> <span class="type">Double</span> <span class="keyword">where</span> someDouble &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a positive double value of \(someDouble)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"some other double value that I don't want to print"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someString <span class="keyword">as</span> <span class="type">String</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a string value of \"\(someString)\""</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">as</span> (<span class="type">Double</span>, <span class="type">Double</span>):</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"an (x, y) point at \(x), \(y)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> movie <span class="keyword">as</span> <span class="type">Movie</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a movie called '\(movie.name)', dir. \(movie.director)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> stringConverter <span class="keyword">as</span> <span class="type">String</span> -&gt; <span class="type">String</span>:</span><br><span class="line">        <span class="built_in">println</span>(stringConverter(<span class="string">"Michael"</span>))</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"something else"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_18 错误处理/" itemprop="url">
                  18 错误处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:56:39+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>错误处理</code>是响应错误以及从错误中恢复的过程。<code>可选类型</code>可用来表示值缺失，但是当某个操作失败时，最好能得知失败的原因，从而可以作出相应的应对。<br><strong>扩展：</strong><code>Swift</code> 中的错误处理涉及到错误处理模式，这会用到 <code>Cocoa</code> 和 <code>Objective-C</code> 中的<code>NSError</code></p>
</blockquote>
<h2 id="18-1-表示并抛出错误"><a href="#18-1-表示并抛出错误" class="headerlink" title="18.1    表示并抛出错误"></a>18.1    表示并抛出错误</h2><blockquote>
<p><strong>说明：</strong>错误用符合<code>ErrorType</code>协议的类型的值来表示。这个空协议表明该类型可以用于错误处理。<br><strong>技巧：</strong>Swift 的<code>枚举</code>类型尤为适合构建一组相关的错误状态，枚举的关联值还可以提供错误状态的额外信息。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自动贩卖机错误</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">VendingMachineError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">InvalidSelection</span><span class="comment">// 选择无效</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">InsufficientFunds</span>(coinsNeeded: <span class="type">Int</span>)<span class="comment">// 金额不足</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">OutOfStock</span><span class="comment">// 缺货</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抛出“金额不足”的错误</span></span><br><span class="line"><span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(coinsNeeded: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h2 id="18-2-处理错误"><a href="#18-2-处理错误" class="headerlink" title="18.2    处理错误"></a>18.2    处理错误</h2><blockquote>
<p><strong>说明：</strong>某个错误被抛出时，附近的某部分代码必须负责处理这个错误。有<code>4</code>中给处理错误的方式</p>
<ul>
<li>把函数<code>抛出</code>的错误传递给调用此函数的代码</li>
<li>用<code>do-catch</code>语句处理错误</li>
<li>将错误作为<code>可选类型</code>处理</li>
<li><code>断言</code>此错误根本不会发生</li>
</ul>
<p><strong>标识可能出错的地方：</strong>在调用一个能抛出错误的<code>函数</code>、<code>方法</code>或者<code>构造器</code>之前，加上<code>try</code>关键字，或者<code>try?</code>或<code>try!</code>这种变体</p>
<p><strong>引伸：</strong>和其他语言中的异常处理不同的是，Swift 中的错误处理并不涉及解除调用栈，就此而言，<code>throw语句</code>的性能特性是可以和<code>return语句</code>相媲美的。</p>
</blockquote>
<h3 id="18-2-1-用throwing函数传递错误"><a href="#18-2-1-用throwing函数传递错误" class="headerlink" title="18.2.1    用throwing函数传递错误"></a>18.2.1    用throwing函数传递错误</h3><blockquote>
<p><strong>说明：</strong>一个标有<code>throws</code>关键字的函数被称作<code>throwing 函数</code>。</p>
<ul>
<li>调用<code>throwing函数</code>必须使用<code>try</code></li>
<li>调用<code>throwing函数</code>必须要么直接处理这些错误（使用<code>do-catch</code>语句，<code>try?</code>或<code>try!</code>）；要么继续将这些错误传递下去</li>
</ul>
<p><strong>用途：</strong>可以在其内部抛出错误，并将错误传递到函数<code>被调用时的作用域</code>。<br><strong>语法：</strong>在函数声明的<code>参数列表</code>和<code>-&gt;</code>之间加上<code>throws</code>关键字。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canThrowErrors</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>只有 <code>throwing函数</code>可以传递错误。任何在某个<code>非 throwing 函数</code>内部抛出的错误只能在函数内部处理。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 自动贩卖机错误</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">VendingMachineError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">InvalidSelection</span><span class="comment">// 选择无效</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">InsufficientFunds</span>(coinsNeeded: <span class="type">Int</span>)<span class="comment">// 金额不足</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">OutOfStock</span><span class="comment">// 缺货</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 商品</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动贩卖机</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VendingMachine</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 食品清单</span></span><br><span class="line">    <span class="keyword">var</span> inventory = [</span><br><span class="line">        <span class="string">"Candy Bar"</span>: <span class="type">Item</span>(price: <span class="number">12</span>, <span class="built_in">count</span>: <span class="number">7</span>),</span><br><span class="line">        <span class="string">"Chips"</span>: <span class="type">Item</span>(price: <span class="number">10</span>, <span class="built_in">count</span>: <span class="number">4</span>),</span><br><span class="line">        <span class="string">"Pretzels"</span>: <span class="type">Item</span>(price: <span class="number">7</span>, <span class="built_in">count</span>: <span class="number">11</span>)</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// 投币数量</span></span><br><span class="line">    <span class="keyword">var</span> coinsDeposited = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 发放食品</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dispenseSnack</span><span class="params">(snack: String)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Dispensing \(snack)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    * 出售</span><br><span class="line">    * throwing方法：会抛出相应错误（如果有的话）</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">vend</span><span class="params">(itemNamed name: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="comment">// 是否有对应商品</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">var</span> item = inventory[name] <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InvalidSelection</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 是否还有剩余</span></span><br><span class="line">        <span class="keyword">guard</span> item.<span class="built_in">count</span> &gt; <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">OutOfStock</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 投币是否足够</span></span><br><span class="line">        <span class="keyword">guard</span> item.price &lt;= coinsDeposited <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(coinsNeeded: item.price - coinsDeposited)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 没问题，进行交易</span></span><br><span class="line">        coinsDeposited -= item.price</span><br><span class="line">        --item.<span class="built_in">count</span></span><br><span class="line">        inventory[name] = item</span><br><span class="line">        dispenseSnack(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> favoriteSnacks = [</span><br><span class="line">    <span class="string">"Alice"</span>: <span class="string">"Chips"</span>,</span><br><span class="line">    <span class="string">"Bob"</span>: <span class="string">"Licorice"</span>,</span><br><span class="line">    <span class="string">"Eve"</span>: <span class="string">"Pretzels"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">* 买小吃</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buyFavoriteSnack</span><span class="params">(person: String, vendingMachine: VendingMachine)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> snackName = favoriteSnacks[person] ?? <span class="string">"Candy Bar"</span></span><br><span class="line">    <span class="comment">// 调用throwing方法必须使用try关键字</span></span><br><span class="line">    <span class="keyword">try</span> vendingMachine.vend(itemNamed: snackName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-2-用Do-Catch处理错误"><a href="#18-2-2-用Do-Catch处理错误" class="headerlink" title="18.2.2    用Do-Catch处理错误"></a>18.2.2    用Do-Catch处理错误</h3><blockquote>
<p><strong>说明：</strong>可以使用一个<code>do-catch</code>语句运行一段闭包代码来处理错误。如果在<code>do</code>子句中的代码抛出了一个错误，这个错误会与<code>catch</code>子句做匹配，从而决定哪条子句能处理它。</p>
<ul>
<li>在<code>catch</code>后面写一个匹配模式来表明这个子句能处理什么样的错误</li>
<li>如果一条<code>catch</code>子句没有指定匹配模式，那么这条子句可以匹配任何错误，并且把错误绑定到一个名字为<code>error</code>的局部常量</li>
<li><code>catch</code>子句不必将<code>do</code>子句中的代码所抛出的每一个可能的错误都作处理</li>
<li>如果所有<code>catch</code>子句都未处理错误，错误就会传递到周围的作用域（要么是一个外围的<code>do-catch</code>错误处理语句，要么是一个<code>throwing</code> 函数的内部）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个售卖机实例</span></span><br><span class="line"><span class="keyword">var</span> vendingMachine = <span class="type">VendingMachine</span>()</span><br><span class="line"><span class="comment">// 投币</span></span><br><span class="line">vendingMachine.coinsDeposited = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 买最喜欢的零食</span></span><br><span class="line">    <span class="keyword">try</span> buyFavoriteSnack(<span class="string">"Alice"</span>, vendingMachine: vendingMachine)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 没有该商品</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">InvalidSelection</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Invalid Selection"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 卖完了</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">OutOfStock</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Out of Stock."</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 投币不足</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(<span class="keyword">let</span> coinsNeeded) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Insufficent funds. Please insert an additional \(coinsNeeded)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-3-将错误转换成可选值"><a href="#18-2-3-将错误转换成可选值" class="headerlink" title="18.2.3    将错误转换成可选值"></a>18.2.3    将错误转换成可选值</h3><blockquote>
<p><strong>语法：</strong><code>try?</code><br><strong>说明：</strong>使用<code>try?</code>调用表达式，返回相应表达式返回值的<code>可选类型</code>（如果表达式抛出错误，则表达式<code>nil</code>）<br><strong>技巧：</strong>如果你想对所有的错误都采用同样的方式来处理，用<code>try?</code>就可以让你写出简洁的错误处理代码</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// throwing 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someThrowingFunction</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调用 throwing 函数 */</span></span><br><span class="line"><span class="comment">// 方式一：使用 try? 调用</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="keyword">try</span>? someThrowingFunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：方式一的等价形式</span></span><br><span class="line"><span class="keyword">let</span> y: <span class="type">Int</span>?</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    y = <span class="keyword">try</span> someThrowingFunction()</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    y = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从磁盘获取</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchDataFromDisk</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从服务器获取</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchDataFromServer</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获取数据</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchData</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? fetchDataFromDisk() &#123;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? fetchDataFromServer() &#123;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-4-禁用错误传递"><a href="#18-2-4-禁用错误传递" class="headerlink" title="18.2.4        禁用错误传递"></a>18.2.4        禁用错误传递</h3><blockquote>
<p><strong>语法：</strong><code>try!</code><br><strong>说明：</strong>其实就是把<code>抛出错误</code>转变为<code>运行时断言</code><br><strong>应用：</strong>确定<code>throwing</code> 函数实际上在运行时<code>不会抛出错误</code>的才能使用。<br><strong>注意：</strong>如果实际上抛出了错误，你会得到一个运行时错误（而不会传递错误）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 确定图片资源是存在的</span></span><br><span class="line"><span class="keyword">let</span> photo = <span class="keyword">try</span>! loadImage(<span class="string">"./Resources/John Appleseed.jpg"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="18-3-指定清理操作"><a href="#18-3-指定清理操作" class="headerlink" title="18.3    指定清理操作"></a>18.3    指定清理操作</h2><blockquote>
<p><strong>说明：</strong>使用<code>defer</code>语句指定在即将离开<code>当前代码块</code>时执行一系列语句。<br><strong>支持情景：</strong>不管是以何种方式离开当前代码块的</p>
<ul>
<li>由于抛出错误而离开</li>
<li>诸如<code>return</code>或者<code>break</code>的语句</li>
</ul>
<p><strong>语法：</strong>由<code>defer</code>关键字和要被延迟执行的语句组成</p>
<ul>
<li>延迟执行的语句不能包含任何<code>控制转移语句</code>（<code>break</code>或是<code>return</code>语句，或是抛出一个错误）</li>
<li>延迟执行的操作会按照它们被指定时的顺序的<code>相反顺序</code>执行</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理文件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processFile</span><span class="params">(filename: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// 如果文件存在</span></span><br><span class="line">    <span class="keyword">if</span> exists(filename) &#123;</span><br><span class="line">        <span class="comment">// 打开文件</span></span><br><span class="line">        <span class="keyword">let</span> file = open(filename)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当前代码块结束时执行</span></span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            close(file)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理打开的文件</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> line = <span class="keyword">try</span> file.readline() &#123;</span><br><span class="line">            <span class="comment">// 处理文件。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据 defer 语句的指定，close(file) 会在这里被隐式调用，即作用域的最后。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_17 可选链式调用/" itemprop="url">
                  17 可选链式调用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:56:10+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>是什么：</strong>是一种可以在当前值可能为<code>nil</code>的可选值上调用属性、方法及下标脚本的过程<br><strong>使用场景</strong>：请求或调用的目标当前可能为空(<code>nil</code>)，这时使用<code>!</code>在一个连续调用的过程中有报错的可能。这时可以用作用域链的方式。<br><strong>特点：</strong></p>
<ol>
<li>如果可选的目标有值，调用成功；否则一律返回<code>nil</code>。</li>
<li>多次请求或调用可以被链接在一起形成一个链，如果任何一个节点为<code>nil</code>，将导致整个链实效。</li>
<li>不论你调用的属性、方法、下标脚本等返回的值是不是可选值，返回结果都是一个可选值。</li>
</ol>
<p><strong>适用类型：</strong>任意类型</p>
</blockquote>
<h2 id="17-1-可选链可替代强制解析"><a href="#17-1-可选链可替代强制解析" class="headerlink" title="17.1    可选链可替代强制解析"></a>17.1    可选链可替代强制解析</h2><blockquote>
<p><strong>说明：</strong>在调用的属性、方法或下标脚本的可选值后面放一个<code>?</code><br><strong>比较（与<code>!</code>）：</strong>当可选值为<code>nil</code>时</p>
</blockquote>
<table>
<thead>
<tr>
<th>强制解析</th>
<th>可选链</th>
</tr>
</thead>
<tbody>
<tr>
<td>引发运行时错误</td>
<td>可选链即刻实效</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//人</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">//无论该属性是否设置为可选型，都可以通过可选链的方式（?）访问</span></span><br><span class="line">    <span class="keyword">var</span> residence:<span class="type">Residence</span>?</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//住宅</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Residence</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfRooms = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实例化一个人的实例，拥有一个默认值为nil的可选型属性</span></span><br><span class="line"><span class="keyword">let</span> john = <span class="type">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//let roomCount = join.residence!.numberOfRooms//join.residence使用感叹号将导致运行时错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*join.residence?.numberOfRooms：始终返回一个可选型（不会像!，当join.residence为nil时报错）</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> roomCount = john.residence?.numberOfRooms &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"John's residence has \(roomCount) room(s)."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to retrieve the number of rooms."</span>)<span class="comment">//residence的值为nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-2-为可选链定义模型类"><a href="#17-2-为可选链定义模型类" class="headerlink" title="17.2    为可选链定义模型类"></a>17.2    为可选链定义模型类</h2><blockquote>
<p><strong>和定义普通类区别：</strong>期望用可选链调用的属性应当定义为可选型</p>
</blockquote>
<h2 id="17-3-通过可选链调用属性"><a href="#17-3-通过可选链调用属性" class="headerlink" title="17.3    通过可选链调用属性"></a>17.3    通过可选链调用属性</h2><blockquote>
<p><strong>方式：</strong>调用时在属性后面添加后缀<code>?</code></p>
</blockquote>
<h2 id="17-4-通过可选链调用方法"><a href="#17-4-通过可选链调用方法" class="headerlink" title="17.4    通过可选链调用方法"></a>17.4    通过可选链调用方法</h2><blockquote>
<p><strong>方式：</strong>调用时在方法名后面添加后缀<code>?</code></p>
</blockquote>
<h2 id="17-5-使用可选链调用下标脚本"><a href="#17-5-使用可选链调用下标脚本" class="headerlink" title="17.5    使用可选链调用下标脚本"></a>17.5    使用可选链调用下标脚本</h2><blockquote>
<p><strong>方式：</strong>在下标脚本括号的前面添加<code>?</code></p>
</blockquote>
<h2 id="17-6-连接多层可选链式调用"><a href="#17-6-连接多层可选链式调用" class="headerlink" title="17.6    连接多层可选链式调用"></a>17.6    连接多层可选链式调用</h2><blockquote>
<p><strong>说明：</strong>可以通过连接多个可选链式调用在更深的模型层级中访问属性、方法以及下标。</p>
<ul>
<li>如果你访问的值不是可选的，可选链式调用将会返回可选值</li>
<li>如果你访问的值就是可选的，可选链式调用不会让可选返回值变得“更可选”</li>
</ul>
</blockquote>
<h2 id="17-7-链接可选返回值的方法"><a href="#17-7-链接可选返回值的方法" class="headerlink" title="17.7    链接可选返回值的方法"></a>17.7    链接可选返回值的方法</h2><p><strong>说明：</strong>除了获得可选类型属性值，还可以通过可选链调用一个返回可选类型值的方法并按需链接该方法的返回值。<br><strong>方式：</strong>在调用方法的括号的后面添加<code>?</code></p>
<p>#综合案例：</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//人</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">//无论该属性是否设置为可选型，都可以通过可选链的方式（?）访问</span></span><br><span class="line">    <span class="keyword">var</span> residence:<span class="type">Residence</span>?</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//房间</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//住宅</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Residence</span></span>&#123;</span><br><span class="line">    <span class="comment">//存储房间的数组</span></span><br><span class="line">    <span class="keyword">var</span> rooms = [<span class="type">Room</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算属性（返回房间数）</span></span><br><span class="line">    <span class="keyword">var</span> numberOfRooms:<span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rooms.<span class="built_in">count</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//下标脚本（使能通过下标直接访问房间）</span></span><br><span class="line">    <span class="keyword">subscript</span>(i:<span class="type">Int</span>)-&gt;<span class="type">Room</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rooms[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    *打印房间数目</span><br><span class="line">    *有一个隐式的返回值类型void，使用可选链的方式调用返回void?(可选型)</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">printNumberOfRooms</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"The number of rooms is \(numberOfRooms)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//地址</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buildingName:<span class="type">String</span>?<span class="comment">//大厦名称</span></span><br><span class="line">    <span class="keyword">var</span> buildingNumber:<span class="type">String</span>?<span class="comment">//楼牌号</span></span><br><span class="line">    <span class="keyword">var</span> street:<span class="type">String</span>?<span class="comment">//大街</span></span><br><span class="line">    <span class="comment">//获得大厦的名称或楼牌号</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">buildingIdentifier</span><span class="params">()</span></span> -&gt; <span class="type">String</span>?&#123;</span><br><span class="line">        <span class="keyword">if</span> (buildingName != <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> buildingName</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buildingNumber != <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> buildingNumber</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化一个人的实例，拥有一个默认值为nil的可选型属性</span></span><br><span class="line"><span class="keyword">let</span> john = <span class="type">Person</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过可选链调用属性:下面的写法有问题，不知道为什么</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> roomCount = john.residence?.numberOfRooms &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"John's residence has \(roomCount) rooms."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to retrieve the number of rooms."</span>)<span class="comment">//residence的值为nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过可选链调用方法:下面的写法报错了，不明白为什么</span></span><br><span class="line"><span class="keyword">if</span> john.residence?.printNumberOfRooms?()&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"It was possible to print the number of rooms."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"It was possible to print the number of rooms."</span>)<span class="comment">//john的residence不存在</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过可选链调用下标脚本</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> firstRoomName = <span class="built_in">join</span>.residence?[<span class="number">0</span>].name&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"The first room name is \(firstRoomName)."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to retrieve the fit=rst room name."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> johnsHouse = <span class="type">Residence</span>()</span><br><span class="line">johnsHouse.rooms += <span class="type">Room</span>(name:<span class="string">"Living Room"</span>)</span><br><span class="line">johnsHouse.rooms += <span class="type">Room</span>(name:<span class="string">"Kitchen"</span>)</span><br><span class="line">john.residence = johnsHouse</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> firstRoomName = john.residence?[<span class="number">0</span>].name&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"The first room name is \(firstRoomName)."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to retrieve the first room name."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接多层链接</span></span><br><span class="line"><span class="keyword">let</span> johnsAddress = <span class="type">Address</span>()</span><br><span class="line">johnsAddress.buildingName = <span class="string">"The Larches"</span></span><br><span class="line">johnsAddress.street = <span class="string">"Laurel Street"</span></span><br><span class="line">john.residence!.address = johnsAddress</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> johnsStreet = john.residence?.address?.street&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"John's street name is \(johnsStreet)."</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to retrieve the address."</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//链接可选返回值的方法</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> buildingIdentifier = john.residence?.address?.buildingIdentifier()&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"John's building idetifier is \(buildingIdentifier)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> upper = john.residence?.address?.buildingIdentifier()?.uppercaseString&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"John's uppercase building identifier is \(upper)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_16 自动引用计数(ARC)/" itemprop="url">
                  16 自动引用计数（ARC）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:47:34+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Swift</code> 使用自动引用计数<code>（ARC）</code>机制来跟踪和管理你的应用程序的内存。<br><strong>适用类型：</strong>类(结构体和枚举是值类型)</p>
</blockquote>
<h2 id="16-1-自动引用计数的工作机制"><a href="#16-1-自动引用计数的工作机制" class="headerlink" title="16.1        自动引用计数的工作机制"></a>16.1        自动引用计数的工作机制</h2><blockquote>
<p><strong>说明：</strong>当你每次创建一个类的新的实例的时候，<code>ARC</code> 会分配一大块内存用来储存实例的信息。内存中会包含实例的类型信息，以及这个实例所有相关属性的值。</p>
<p><strong>强引用：</strong>无论将实例赋值给<code>属性</code>、<code>常量</code>还是<code>变量</code>，都会对此实例创建<code>强引用</code>。当一个实例的引用计数为0时，实例将被<code>ARC</code>销毁。</p>
</blockquote>
<h2 id="16-2-自动引用计数实践"><a href="#16-2-自动引用计数实践" class="headerlink" title="16.2        自动引用计数实践"></a>16.2        自动引用计数实践</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.创建类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"\(name) is being initialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"\(name) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.创建实例</span></span><br><span class="line"><span class="keyword">var</span> reference1:<span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> reference2:<span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> reference3:<span class="type">Person</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">//reference1和Person类的新实例之间建立了一个强引用</span></span><br><span class="line">reference1 = <span class="type">Person</span>(name: <span class="string">"Join Appleseed"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//为该实例再增加两个强引用</span></span><br><span class="line">reference2 = reference1</span><br><span class="line">reference3 = reference1</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.断开所有强引用，之后ARC销毁实例的内存</span></span><br><span class="line">reference1 = <span class="literal">nil</span></span><br><span class="line">reference2 = <span class="literal">nil</span></span><br><span class="line">reference3 = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<h2 id="16-3-类实例之间的循环强引用"><a href="#16-3-类实例之间的循环强引用" class="headerlink" title="16.3        类实例之间的循环强引用"></a>16.3        类实例之间的循环强引用</h2><blockquote>
<p><strong>循环强引用：</strong>两个类实例互相保持对方的<code>强引用</code>，并让对方不被销毁。<br><strong>解决思路：</strong>通过定义类之间的关系为<code>弱引用</code>或<code>无主引用</code>，以此替代强引用。</p>
</blockquote>
<table>
<thead>
<tr>
<th>细分情况</th>
<th>分析（两个实例各自引用对方的属性）</th>
<th>解决思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>情况1</td>
<td>都允许为<code>nil</code></td>
<td>其中一个属性使用<code>弱引用</code></td>
</tr>
<tr>
<td>情况2</td>
<td>一个允许为<code>nil</code>，另一个不允许</td>
<td>不允许为<code>nil</code>的属性使用<code>无主引用</code></td>
</tr>
<tr>
<td>情况3</td>
<td>都不允许为<code>nil</code></td>
<td>一个使用<code>无主引用</code>，一个使用<code>隐式解析可选属性</code></td>
</tr>
</tbody>
</table>
<h2 id="16-4-解决实例之间的循环强引用"><a href="#16-4-解决实例之间的循环强引用" class="headerlink" title="16.4        解决实例之间的循环强引用"></a>16.4        解决实例之间的循环强引用</h2><blockquote>
<p><strong>解决方法：</strong>用弱引用或无主导引用替代强引用</p>
<ol>
<li><strong>弱引用（weak reference）适用：</strong>生命周期中会变为<code>nil</code>的实例</li>
<li><strong>无主引用（unowned reference）适用：</strong>初始化赋值后再也不会被赋值为nil的实例</li>
</ol>
</blockquote>
<h3 id="16-4-1-弱引用"><a href="#16-4-1-弱引用" class="headerlink" title="16.4.1        弱引用"></a>16.4.1        弱引用</h3><blockquote>
<p><strong>关键字：</strong><code>weak</code><br><strong>说明：</strong>弱引用不会对其引用的实例保持强引用，因而不会阻止 <code>ARC</code> 销毁被引用的实例</p>
<ul>
<li>因为弱引用可以没有值，你必须将每一个弱引用声明为可选类型</li>
<li>弱引用必须被声明为变量（<code>var</code>），表明需要在运行时修改</li>
<li><code>ARC</code>在引用的实例被销毁之后自动将弱引用关联的变量或属性赋值为<code>nil</code></li>
</ul>
<p><strong>语法：</strong>声明<code>属性</code>或者<code>变量</code>时，在前面加上<code>weak</code>关键字</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> apartment:<span class="type">Apartment</span>?</span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Apartment #\(name) is being dinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//旅馆可以没有客人，客人声明为弱引用类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apartment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> number:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(number:<span class="type">Int</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.number = number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> tenant:<span class="type">Person</span>?</span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Apartment #\(number) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建实例</span></span><br><span class="line"><span class="keyword">var</span> john:<span class="type">Person</span>?</span><br><span class="line"><span class="keyword">var</span> number73:<span class="type">Apartment</span>?</span><br><span class="line">john = <span class="type">Person</span>(name: <span class="string">"John Appleseed"</span>)</span><br><span class="line">number73 = <span class="type">Apartment</span>(number: <span class="number">73</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//引用</span></span><br><span class="line">john!.apartment = number73<span class="comment">//强引用</span></span><br><span class="line">number73!.tenant = john<span class="comment">//弱引用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//断开两个实例和变量之间的引用（引用计数降为0）</span></span><br><span class="line">john = <span class="literal">nil</span><span class="comment">//因为另一个指向Person实例的引用是弱引用，因此Person实例被销毁</span></span><br><span class="line">number73 = <span class="literal">nil</span><span class="comment">//另一个指向Apartment实例的引用所在的实例已经被销毁，因此Apartment此时讲呗销毁</span></span><br></pre></td></tr></table></figure>
<h3 id="16-4-2-无主引用"><a href="#16-4-2-无主引用" class="headerlink" title="16.4.2        无主引用"></a>16.4.2        无主引用</h3><blockquote>
<p><strong>关键字：</strong><code>unowned</code><br><strong>说明：</strong>在声明属性或者变量时，在前面加上关键字unowned表示这是一个无主引用。</p>
<ul>
<li>不会牢牢保持住引用的实例</li>
<li>总是被定义为非可选型（永远是有值的），总是可以被直接访问</li>
<li><code>ARC</code>无法在实例被销毁后将无主引用设为<code>nil</code>（因为非可选类型的变量不允许被赋值为<code>nil</code>）</li>
</ul>
<p><strong>注意：</strong>使用无主引用，必须确保引用始终指向一个未销毁的实例。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用户</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> card:<span class="type">CreditCard</span>?</span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"\(name) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//信用卡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreditCard</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> number:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> customer:<span class="type">Customer</span></span><br><span class="line">    <span class="keyword">init</span>(number:<span class="type">Int</span>, customer:<span class="type">Customer</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.number = number</span><br><span class="line">        <span class="keyword">self</span>.customer = customer</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Card #\(number) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> john:<span class="type">Customer</span>?</span><br><span class="line">john = <span class="type">Customer</span>(name: <span class="string">"John Appleseed"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//给john一张信用卡（同时给信用卡关联一个用户）</span></span><br><span class="line">john!.card = <span class="type">CreditCard</span>(number:<span class="number">1234_5678_9021_3456</span>, customer:john!)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Customer实例的引用被断开后，实例被销毁，同时断开了对信用卡实例的引用，因此信用卡实例也被销毁</span></span><br><span class="line">john = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<h3 id="16-4-3-无主引用以及隐式可选属性"><a href="#16-4-3-无主引用以及隐式可选属性" class="headerlink" title="16.4.3         无主引用以及隐式可选属性"></a>16.4.3         无主引用以及隐式可选属性</h3><blockquote>
<p><strong>说明：</strong>两个属性都必须有值，并且初始化完成后永远不会为<code>nil</code>。在这种场景中，需要一个类使用<code>无主属性</code>，而另外一个类使用<code>隐式解析可选属性</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//国家</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="comment">//首都：声明为隐式解析可选类型的属性，默认值为nil，但是不需要展开值就能够访问。</span></span><br><span class="line">    <span class="keyword">let</span> capitality:<span class="type">City</span>!</span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, capitalName:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name<span class="comment">//给name属性赋值后，构造过程第一阶段就结束了（完成初始化）</span></span><br><span class="line">        <span class="keyword">self</span>.capitality = <span class="type">City</span>(name:capitalName, country:<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//城市</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">City</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">unowned</span> <span class="keyword">let</span> country:<span class="type">Country</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, country:<span class="type">Country</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.country = country</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> country = <span class="type">Country</span>(name: <span class="string">"Canada"</span>, capitalName: <span class="string">"Ottawa"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="16-5-闭包引起的循环强引用"><a href="#16-5-闭包引起的循环强引用" class="headerlink" title="16.5        闭包引起的循环强引用"></a>16.5        闭包引起的循环强引用</h2><blockquote>
<p><strong>原理：</strong>实例内部的闭包捕获<code>self</code>，从而在实例和闭包之间产生循环强引用。<br><strong>情景：</strong></p>
<ol>
<li>闭包中访问实例的属性（<code>self.someproperty</code>）</li>
<li>闭包中访问实例的方法（<code>self.someMethod</code>）</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">    <span class="comment">//元素名称</span></span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//元素文本</span></span><br><span class="line">    <span class="keyword">let</span> text:<span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//闭包:根据text是否存在值，该闭包返回带文本的标签或仅仅是标签</span></span><br><span class="line">    <span class="comment">//声明为lazy:意味着使用该闭包时，实例的初始化一定已经完成，因此在闭包中可以访问`self`</span></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> asHTML:()-&gt;<span class="type">String</span>=&#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> text = <span class="keyword">self</span>.text &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;\(self.name)\(text)&lt;/\(self.name)&gt;"</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;\(self.name)&gt;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, text:<span class="type">String</span>? = <span class="literal">nil</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.text = text</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//析构函数</span></span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"\(name) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> paragraph:<span class="type">HTMLElement</span>? = <span class="type">HTMLElement</span>(name: <span class="string">"p"</span>, text: <span class="string">"hello, world"</span>)<span class="comment">//该类实例和其中的闭包之间产生了循环强引用</span></span><br><span class="line"><span class="built_in">println</span>(paragraph!.asHTML())</span><br><span class="line"></span><br><span class="line">paragraph = <span class="literal">nil</span><span class="comment">//实例并没有被销毁</span></span><br></pre></td></tr></table></figure>
<h2 id="16-6-解决闭包引起的循环强引用"><a href="#16-6-解决闭包引起的循环强引用" class="headerlink" title="16.6        解决闭包引起的循环强引用"></a>16.6        解决闭包引起的循环强引用</h2><blockquote>
<p><strong>捕获列表：</strong>定义了闭包体内捕获一个或多个引用类型的规则（<code>弱引用</code>或<code>无主引用</code>）。<br><strong>解决方式：</strong>在定义<code>闭包</code>时同时定义<code>捕获列表</code>作为闭包的一部分<br><strong>注意：</strong>只要在闭包中使用<code>self</code>的成员，就要用<code>self.someProperty</code>或<code>self.someMethod</code></p>
</blockquote>
<h3 id="16-6-1-定义捕获列表"><a href="#16-6-1-定义捕获列表" class="headerlink" title="16.6.1        定义捕获列表"></a>16.6.1        定义捕获列表</h3><blockquote>
<p><strong>捕获列表：</strong>[{<code>weak</code>|<code>unknowed</code>} {实例}, {<code>weak</code>|<code>unknowed</code>} {实例}, …]<br><strong>说明：</strong>捕获列表中的每一项都由一对元素组成，一个元素是<code>weak</code>或<code>unowned</code>关键字，另一个元素是类实例的引用</p>
<ol>
<li>捕获列表放在闭包参数和返回值之前（需要指出闭包的参数和返回值类型）：有参数列表和返回类型</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//类或结构体中定义一个闭包</span></span><br><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> someClosure:(<span class="type">Int</span>, <span class="type">String</span>) -&gt; <span class="type">String</span> = &#123;</span><br><span class="line">    <span class="comment">// 闭包定义一个捕获列表</span></span><br><span class="line">    [<span class="keyword">unowned</span> <span class="keyword">self</span>, <span class="keyword">weak</span> delegate = <span class="keyword">self</span>.delegate] (index:<span class="type">Int</span>, stringToProcess:<span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 下面时闭包函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>通过上下文推断（省略类型说明）：闭包没有定义参数列表或返回值时</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> someClosure:()-&gt;<span class="type">String</span> = &#123;</span><br><span class="line">	<span class="comment">// 定义捕获列表</span></span><br><span class="line">    [unknowed <span class="keyword">self</span>, <span class="keyword">weak</span> delegate = <span class="keyword">self</span>.delegate] <span class="keyword">in</span></span><br><span class="line">    <span class="comment">// 下面时闭包函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16-6-2-弱引用和无主引用"><a href="#16-6-2-弱引用和无主引用" class="headerlink" title="16.6.2        弱引用和无主引用"></a>16.6.2        弱引用和无主引用</h3><blockquote>
<p><strong>说明：</strong><code>捕获列表</code>中引用的引用类型可以是<code>weak</code>或<code>unowned</code>，选择的依据是</p>
<ul>
<li>捕获的引用绝对不会为<code>nil</code>：将闭包内的捕获定义为<code>无主引用</code></li>
<li>捕获引用有可能为<code>nil</code>：将闭包内的捕获定义为<code>弱引用</code>（可选型）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLElement</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 元素名称</span></span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 元素文本</span></span><br><span class="line">    <span class="keyword">let</span> text:<span class="type">String</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭包:根据text是否存在值，该闭包返回带文本的标签或仅仅是标签</span></span><br><span class="line">    <span class="comment">// 声明为lazy:意味着使用该闭包时，实例的初始化一定已经完成，因此在必报中可以访问`self`</span></span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> asHTML:<span class="type">Void</span> &gt; <span class="type">String</span> = &#123;</span><br><span class="line">        [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span><span class="comment">// 用无助引用而不是强引用捕获`self`</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> text = <span class="keyword">self</span>.text &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;\(self.name)\(text)&lt;/\(self.name)&gt;"</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;\(self.name)&gt;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, text:<span class="type">String</span>? = <span class="literal">nil</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.text = text</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 析构函数</span></span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"\(name) is being deinitialized"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> paragraph:<span class="type">HTMLElement</span>? = <span class="type">HTMLElement</span>(name: <span class="string">"p"</span>, text: <span class="string">"hello, world"</span>)<span class="comment">// 该类实例和其中的闭包之间产生了循环强引用</span></span><br><span class="line"><span class="built_in">println</span>(paragraph!.asHTML())</span><br><span class="line"></span><br><span class="line">paragraph = <span class="literal">nil</span><span class="comment">// 实例被销毁</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_15 析构过程/" itemprop="url">
                  15 析构过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:47:13+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>关键字：</strong><code>deinit</code><br><strong>支持：</strong>类<br><strong>数量：</strong>最多一个<br><strong>参数：</strong>无<br><strong>如何被调用：</strong>类的实例被释放之前自动调用（不允许主动调用）<br><strong>用途：</strong>当实例释放时进行一些额外的处理（比如关闭打开的文件）</p>
</blockquote>
<h2 id="15-1-析构过程原理"><a href="#15-1-析构过程原理" class="headerlink" title="15.1        析构过程原理"></a>15.1        析构过程原理</h2><blockquote>
<p><strong>语法：</strong>不带<code>()</code>也不需要<code>参数</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">deinit</span>&#123;</span><br><span class="line">	<span class="comment">// 手动释放一些资源</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>父类析构器的调用：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>子类是否定义了析构函数</th>
<th>具体析构过程</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td>子类析构函数实现的最后，父类的析构函数被调用</td>
</tr>
<tr>
<td>否</td>
<td>父类的析构函数被自动调用</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>访问属性：</strong>可以访问所有请求实例的属性</p>
</blockquote>
<h2 id="15-2-析构过程操作"><a href="#15-2-析构过程操作" class="headerlink" title="15.2        析构过程操作"></a>15.2        析构过程操作</h2><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//银行</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Bank</span> </span>&#123;</span><br><span class="line">    <span class="comment">//硬币数量</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> coinsInBank = <span class="number">10_000</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//分发硬币</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">vendCoins</span><span class="params">(<span class="keyword">var</span> numberOfCoinsToVend:Int)</span></span>-&gt;<span class="type">Int</span>&#123;</span><br><span class="line">        numberOfCoinsToVend = <span class="built_in">min</span>(numberOfCoinsToVend, coinsInBank)</span><br><span class="line">        coinsInBank -= numberOfCoinsToVend</span><br><span class="line">        <span class="keyword">return</span> numberOfCoinsToVend</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得硬币</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">receiveCoins</span><span class="params">(coins:Int)</span></span>&#123;</span><br><span class="line">        coinsInBank += coins</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//玩家</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> coinsInPurse:<span class="type">Int</span></span><br><span class="line">    <span class="comment">//初始化玩家的硬币数量</span></span><br><span class="line">    <span class="keyword">init</span>(coins:<span class="type">Int</span>)&#123;</span><br><span class="line">        coinsInPurse = <span class="type">Bank</span>.vendCoins(coins)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//玩家从银行获得硬币</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">winCoins</span><span class="params">(coins:Int)</span></span>&#123;</span><br><span class="line">        coinsInPurse += <span class="type">Bank</span>.vendCoins(coins)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//玩家退出时归还所有硬币</span></span><br><span class="line">    <span class="keyword">deinit</span>&#123;</span><br><span class="line">        <span class="type">Bank</span>.receiveCoins(coinsInPurse)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> playerOne:<span class="type">Player</span>? = <span class="type">Player</span>(coins: <span class="number">100</span>)<span class="comment">//拥有100个硬币的玩家</span></span><br><span class="line">playerOne!.winCoins(<span class="number">2_000</span>)<span class="comment">//赢得2000个硬币</span></span><br><span class="line">playerOne = <span class="literal">nil</span><span class="comment">//玩家退出</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_14  构造过程/" itemprop="url">
                  14 构造过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:46:54+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>构造过程：</strong>为某个类、结构体或枚举的实例中的每个属性设置初始值和为其执行必要准备和初始化任务。<br><strong>构造器：</strong>用来创建特定类型实例的特殊方法，保证实例在第一次使用前完成正确的初始化。</p>
</blockquote>
<h2 id="14-1-存储型属性的初始赋值"><a href="#14-1-存储型属性的初始赋值" class="headerlink" title="14.1    存储型属性的初始赋值"></a>14.1    存储型属性的初始赋值</h2><blockquote>
<p><strong>背景：</strong>类和结构体在创建实例时，必须为所有<code>存储型属性</code>设置合适的初始值。存储型属性的值不能处于一个未知的状态。<br><strong>说明：</strong>可以在<code>构造器中</code>为存储型属性赋初值，也可以在<code>定义属性时</code>为其设置默认值</p>
</blockquote>
<table>
<thead>
<tr>
<th>初始化时机</th>
<th>初始化方式</th>
<th>是否触发属性观察器</th>
<th>是否自动推导类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>定义属性时</td>
<td>设置默认值</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>构造器中</td>
<td>为存储型属性赋初始值</td>
<td>否</td>
<td>否</td>
</tr>
</tbody>
</table>
<h3 id="14-1-1-构造器"><a href="#14-1-1-构造器" class="headerlink" title="14.1.1    构造器"></a>14.1.1    构造器</h3><blockquote>
<p><strong>说明：</strong>构造器在创建某个特定类型的新实例时被调用，以<code>init</code>关键字声明构造函数</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fahrenheit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temperature:<span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>()&#123;</span><br><span class="line">        temperature = <span class="number">32.0</span><span class="comment">//在构造其中为存储型属性赋初值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = <span class="type">Fahrenheit</span>()</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"The default temperature is \(f.temperature) Fahrenheit"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="14-1-2-默认属性值"><a href="#14-1-2-默认属性值" class="headerlink" title="14.1.2        默认属性值"></a>14.1.2        默认属性值</h3><blockquote>
<p><strong>说明：</strong>相比<code>在构造器中设置初始值</code>有如下优点</p>
<ol>
<li>将属性的声明和初始化结合得更紧密</li>
<li>使构造器更加简洁、清晰</li>
<li>能够自动推导出属性的类型（不需要声明属性的类型）</li>
<li>充分利用默认构造器、构造器继承</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fahrenheit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temperature = <span class="number">32.0</span><span class="comment">//在构造其中为存储型属性赋初值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-2-自定义构造过程"><a href="#14-2-自定义构造过程" class="headerlink" title="14.2    自定义构造过程"></a>14.2    自定义构造过程</h2><h3 id="14-2-1-构造参数"><a href="#14-2-1-构造参数" class="headerlink" title="14.2.1    构造参数"></a>14.2.1    构造参数</h3><blockquote>
<p><strong>说明：</strong>构造器参数的功能和语法跟函数和方法参数相同。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Celsius</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temperatureInCelsius:<span class="type">Double</span> = <span class="number">0.0</span></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    *第一个构造器：带有一个构造参数</span><br><span class="line">    *外部名：fromFahrenheit;内部名：fahreheit</span><br><span class="line">    */</span></span><br><span class="line">    <span class="keyword">init</span>(fromFshreheit fahreheit:<span class="type">Double</span>)&#123;</span><br><span class="line">        temperatureInCelsius = (fahreheit - <span class="number">32.0</span>) / <span class="number">1.8</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    *第二个构造器：带有一个构造参数</span><br><span class="line">    *外部名：fromKelvin;内部名：kelvin</span><br><span class="line">    */</span></span><br><span class="line">    <span class="keyword">init</span>(fromKelvin kelvin:<span class="type">Double</span>)&#123;</span><br><span class="line">        temperatureInCelsius = kelvin - <span class="number">273.15</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> boilingPointOfWater = <span class="type">Celsius</span>(fromFshreheit: <span class="number">212.0</span>)</span><br><span class="line"><span class="keyword">let</span> freezingPointOfWater = <span class="type">Celsius</span>(fromFshreheit: <span class="number">273.15</span>)</span><br></pre></td></tr></table></figure>
<h3 id="14-2-2-内部和外部参数名"><a href="#14-2-2-内部和外部参数名" class="headerlink" title="14.2.2    内部和外部参数名"></a>14.2.2    内部和外部参数名</h3><blockquote>
<p><strong>说明：</strong>和<code>函数（方法）</code>不同点在于第一个参数也会有外部参数名（同后面的其它参数一样）。<br><strong>注意：</strong>如果构造起定义了某个外部参数名，就必须使用它。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Color</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> red, green, blue: <span class="type">Double</span></span><br><span class="line">    <span class="comment">// 外部参数名默认同内部参数名</span></span><br><span class="line">    <span class="keyword">init</span>(red: <span class="type">Double</span>, green: <span class="type">Double</span>, blue: <span class="type">Double</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.red   = red</span><br><span class="line">        <span class="keyword">self</span>.green = green</span><br><span class="line">        <span class="keyword">self</span>.blue  = blue</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取消外部参数名</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> white: <span class="type">Double</span>) &#123;</span><br><span class="line">        red   = white</span><br><span class="line">        green = white</span><br><span class="line">        blue  = white</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你在定义构造器时没有提供参数的外部名字，Swift 会为每个构造器的参数自动生成一个跟内部名字相同的外部名。</span></span><br><span class="line"><span class="keyword">let</span> magenta = <span class="type">Color</span>(red: <span class="number">1.0</span>, green: <span class="number">0.0</span>, blue: <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> halfGray = <span class="type">Color</span>(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>
<h3 id="14-2-3-可选属性类型"><a href="#14-2-3-可选属性类型" class="headerlink" title="14.2.3    可选属性类型"></a>14.2.3    可选属性类型</h3><blockquote>
<p><strong>说明：</strong>如果你定制的类型包含一个逻辑上允许取值为空的存储型属性，需要将它定义为可选类型。</p>
<ul>
<li>可选类型的属性将自动初始化为<code>nil</code></li>
</ul>
<p><strong>使用场景</strong>：</p>
<ol>
<li>无法在初始化时赋值</li>
<li>在之后某个时间点可以赋值为空</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 问题调查</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SurveryQuestion</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> text:<span class="type">String</span></span><br><span class="line">    <span class="comment">// 回答可以为空</span></span><br><span class="line">    <span class="keyword">var</span> response:<span class="type">String</span>?<span class="comment">// nil</span></span><br><span class="line">    <span class="keyword">init</span>(text:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.text = text</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">ask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cheeseQuestion = <span class="type">SurveryQuestion</span>(text: <span class="string">"Do you like cheese?"</span>)</span><br><span class="line">cheeseQuestion.ask()</span><br><span class="line">cheeseQuestion.response = <span class="string">"Yes, I do like cheese."</span></span><br></pre></td></tr></table></figure>
<h3 id="14-2-4-构造过程中常量属性的修改"><a href="#14-2-4-构造过程中常量属性的修改" class="headerlink" title="14.2.4    构造过程中常量属性的修改"></a>14.2.4    构造过程中常量属性的修改</h3><blockquote>
<p><strong>说明：</strong>可以在构造过程中的任意时间点修改常量属性的值</p>
</blockquote>
<table>
<thead>
<tr>
<th>实例属性类型</th>
<th>可修改时机</th>
<th>是否可在子类中修改</th>
</tr>
</thead>
<tbody>
<tr>
<td>常量属性</td>
<td>构造过程结束前</td>
<td>否</td>
</tr>
<tr>
<td>变量属性</td>
<td>实例的整个生命周期</td>
<td>是</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SurveyQuestion</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 常量属性</span></span><br><span class="line">    <span class="keyword">let</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> response: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">init</span>(text: <span class="type">String</span>) &#123;</span><br><span class="line">	    <span class="comment">// 在构造过程中修改常量</span></span><br><span class="line">        <span class="keyword">self</span>.text = text</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">ask</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> beetsQuestion = <span class="type">SurveyQuestion</span>(text: <span class="string">"How about beets?"</span>)</span><br><span class="line">beetsQuestion.ask()</span><br><span class="line"><span class="comment">// 输出 "How about beets?"</span></span><br><span class="line">beetsQuestion.response = <span class="string">"I also like beets. (But not with cheese.)"</span></span><br></pre></td></tr></table></figure>
<h2 id="14-3-默认构造器"><a href="#14-3-默认构造器" class="headerlink" title="14.3    默认构造器"></a>14.3    默认构造器</h2><blockquote>
<p><strong>说明：</strong>满足以下条件的<code>结构体</code>或<code>类</code>会拥有一个默认的构造器。</p>
<ol>
<li>所有属性已提供默认值</li>
<li>自身没有定义任何构造器</li>
</ol>
<p><strong>注意：</strong>类必须要没有父类的基类</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1:所有属性都有默认值；2:基类；3:没有定义构造器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoppingListItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> quantity = <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> purchased = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> item = <span class="type">ShoppingListItem</span>()</span><br></pre></td></tr></table></figure>
<h3 id="14-3-1-结构体的逐一成员构造器"><a href="#14-3-1-结构体的逐一成员构造器" class="headerlink" title="14.3.1    结构体的逐一成员构造器"></a>14.3.1    结构体的逐一成员构造器</h3><blockquote>
<p><strong>说明：</strong>满足了以下条件的<code>结构体</code>将自动获得一个<code>逐一成员构造器</code>。</p>
<ul>
<li>没有自定义构造器</li>
</ul>
<p><strong>用途</strong>：用来初始化结构体新实例里成员属性的快捷方法<br><strong>语法</strong>：在调用逐一成员构造器时，通过与成员属性名相同的参数名进行传值来完成对成员属性的初始赋值。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过逐一成员构造器创建结构体实例</span></span><br><span class="line"><span class="keyword">let</span> twoByTwo = <span class="type">Size</span>(width: <span class="number">2.0</span>, height: <span class="number">2.0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="14-4-值类型的构造器代理"><a href="#14-4-值类型的构造器代理" class="headerlink" title="14.4    值类型的构造器代理"></a>14.4    值类型的构造器代理</h2><blockquote>
<p><strong>说明</strong>：<code>构造器代理</code>指在构造器中调用其它构造器完成构造过程</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型</th>
<th></th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>值类型</td>
<td>结构体、枚举</td>
<td>只能代理给本身提供的其它构造器，可以在构造器内部使用<code>self.init</code>调用其它构造器</td>
</tr>
<tr>
<td>类类型</td>
<td>类</td>
<td>代理给本身的构造器或父类的构造器（完成父类的初始化）</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>一旦在类型的原始定义中定义了构造器</p>
<ul>
<li><strong>结构体：</strong>无法访问<code>默认构造器</code>和<code>逐一成员构造器</code></li>
<li><strong>类：</strong>无法访问<code>默认构造器</code></li>
</ul>
<p><strong>引伸：</strong>假如你希望<code>默认构造器</code>、<code>逐一成员构造器</code>以及你自己的<code>自定义构造器</code>都能用来创建实例，可以将自定义的构造器写到<code>扩展</code>中。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">    <span class="comment">//充当默认构造器（原本的默认构造器不符合存在条件）:没有执行任何定制的构造过程，将返回一个Rect实例</span></span><br><span class="line">    <span class="keyword">init</span>()&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//充当逐一成员构造器（原本的默认成员逐一构造器不符合存在条件）</span></span><br><span class="line">    <span class="keyword">init</span>(origin:<span class="type">Point</span>, size:<span class="type">Size</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.origin = origin</span><br><span class="line">        <span class="keyword">self</span>.size = size</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//该构造器将部分构造过程代理给上面的第二个构造器</span></span><br><span class="line">    <span class="keyword">init</span>(center:<span class="type">Point</span>, size:<span class="type">Size</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> originX = center.x - (size.width / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">let</span> originY = center.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(origin:<span class="type">Point</span>(x:originX, y:originY), size:size)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用第一个构造器</span></span><br><span class="line"><span class="keyword">let</span> basicRect = <span class="type">Rect</span>()<span class="comment">//basicRect的原点(0.0, 0.0)，尺寸是(5.0, 5.0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用第二个构造器</span></span><br><span class="line"><span class="keyword">let</span> originRect = <span class="type">Rect</span>(origin: <span class="type">Point</span>(x: <span class="number">2.0</span>, y: <span class="number">2.0</span>), size:<span class="type">Size</span>(width: <span class="number">3.0</span>, height: <span class="number">3.0</span>))<span class="comment">//originRect的原点是（2.0, 2.0）,尺寸是(5.0, 5.0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用第三个构造器</span></span><br><span class="line"><span class="keyword">let</span> centerRect = <span class="type">Rect</span>(center: <span class="type">Point</span>(x:<span class="number">4.0</span>, y:<span class="number">4.0</span>), size: <span class="type">Size</span>(width: <span class="number">3.0</span>, height: <span class="number">3.0</span>))<span class="comment">//centerRect的原点是（2.5, 2.5）,尺寸是(3.0, 3.0)</span></span><br></pre></td></tr></table></figure>
<h2 id="14-5-类的继承和构造过程"><a href="#14-5-类的继承和构造过程" class="headerlink" title="14.5    类的继承和构造过程"></a>14.5    类的继承和构造过程</h2><blockquote>
<p><strong>说明：</strong><code>类</code>里面的所有<code>存储型属性</code>（包括所有继承自父类的属性）都必须在构造过程中设置初始值。<code>Swift</code> 为类提供了两种构造器来确保实例中所有存储型属性都能获得初始值</p>
<ul>
<li>指定构造器</li>
<li>便利构造器</li>
</ul>
</blockquote>
<h3 id="14-5-1-指定构造器和便利构造器"><a href="#14-5-1-指定构造器和便利构造器" class="headerlink" title="14.5.1    指定构造器和便利构造器"></a>14.5.1    指定构造器和便利构造器</h3><blockquote>
<p><strong>说明：</strong><code>指定构造器</code>是类中最主要的构造器，<code>便利构造器</code>是类中比较次要的、辅助型的构造器。</p>
</blockquote>
<table>
<thead>
<tr>
<th>特性</th>
<th>指定构造器</th>
<th>便利构造器</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>使用场景</strong></td>
<td>必需</td>
<td>必要时（快捷调用某个指定构造器来使类更加清晰）</td>
</tr>
<tr>
<td><strong>数量</strong></td>
<td>至少一个(可以从父类继承)</td>
<td>至少零个</td>
</tr>
<tr>
<td><strong>用途</strong></td>
<td>初始化类中所有属性，初始化父类</td>
<td>次要、辅助型构造器</td>
</tr>
<tr>
<td><strong>使用</strong></td>
<td>根据父类链往上调用父类的构造器</td>
<td>调用同一个类中的指定构造器</td>
</tr>
<tr>
<td><strong>构造器链规则</strong></td>
<td>总是向上代理</td>
<td>总是横向代理</td>
</tr>
</tbody>
</table>
<pre><code>&gt;**语法：**`指定构造器`和`便利构造器`
</code></pre><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定构造器</span></span><br><span class="line"><span class="keyword">init</span>(parameters) &#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 便利构造器：init关键字之前放置convenience关键字</span></span><br><span class="line"><span class="keyword">convenience</span> <span class="keyword">init</span>(parameters) &#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-5-2-构造器链"><a href="#14-5-2-构造器链" class="headerlink" title="14.5.2    构造器链"></a>14.5.2    构造器链</h3><ul>
<li><strong>指定构造器</strong></li>
</ul>
<ol>
<li>必须调用直接父类的指定构造器</li>
</ol>
<ul>
<li><strong>便利构造器</strong></li>
</ul>
<ol>
<li>必须调用同一类中的其它构造器</li>
<li>必须最终以调用一个指定构造器结束</li>
</ol>
<h3 id="14-5-3-两段式构造过程"><a href="#14-5-3-两段式构造过程" class="headerlink" title="14.5.3    两段式构造过程"></a>14.5.3    两段式构造过程</h3><h4 id="14-5-3-1-两个阶段"><a href="#14-5-3-1-两个阶段" class="headerlink" title="14.5.3.1     两个阶段"></a>14.5.3.1     两个阶段</h4><blockquote>
<p><strong>阶段一：</strong>通过构造器设置初始值</p>
</blockquote>
<table>
<thead>
<tr>
<th>成员</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>实例方法</td>
<td>不能调用</td>
</tr>
<tr>
<td>实例属性</td>
<td>不能读取</td>
</tr>
<tr>
<td><code>self</code></td>
<td>不能引用</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">op1=&gt;operation: 构造器被调用（某个指定构造器或便利构造器）</span><br><span class="line">op2=&gt;operation: 完成新实例内存的分配（内存并没有真的被初始化）</span><br><span class="line">op3=&gt;operation: 由指定构造器确保所在类中的所有存储属性完成赋值（内存完成初始化）</span><br><span class="line">op4=&gt;operation: 指定构造器沿着构造器链依次调用父类构造器（完成父类属性初始化）</span><br><span class="line">cond=&gt;condition: 是否有父类?</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op3-&gt;cond</span><br><span class="line">cond(yes)-&gt;op4-&gt;e</span><br><span class="line">cond(no)-&gt;e</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>阶段二：</strong>在新实例准备使用之前进一步定制它们的存储型属性(可以访问<code>self</code>，修改属性、调用实例方法)<br><strong>特点：</strong>沿构造器链从上往下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">op1=&gt;operation: 构造器链上的每个类的指定构造器完成对父类的构造（代理方式）之后，进一步定制实例</span><br><span class="line"> </span><br><span class="line">st-&gt;op1-&gt;e</span><br></pre></td></tr></table></figure>
<h4 id="14-5-3-2-安全检查"><a href="#14-5-3-2-安全检查" class="headerlink" title="14.5.3.2        安全检查"></a>14.5.3.2        安全检查</h4><ul>
<li>指定构造器中的安全检查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st=&gt;start: 调用指定构造器</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">op1=&gt;operation: 所在类所有属性初始化完成</span><br><span class="line">op2=&gt;operation: 将其它构造任务向上代理给父类的构造器</span><br><span class="line">op3=&gt;operation: 为继承的属性设置新值</span><br><span class="line">op5=&gt;operation: 指定构造器赋予的新值将被父类中的构造器覆盖</span><br><span class="line">op4=&gt;operation: 对象内存初始化失败</span><br><span class="line">cond1=&gt;condition: 检查1：上一步是否完成？</span><br><span class="line">cond2=&gt;condition: 检查2：上一步是否执行？</span><br><span class="line">st-&gt;op1-&gt;cond1</span><br><span class="line">cond1(yes)-&gt;op2-&gt;cond2</span><br><span class="line">cond1(no)-&gt;op4-&gt;op2</span><br><span class="line">cond2(yes)-&gt;op3-&gt;e</span><br><span class="line">cond2(no)-&gt;op5-&gt;op3</span><br></pre></td></tr></table></figure>
<ul>
<li>便利构造器中的安全检查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st=&gt;start: 调用便利构造器</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">op1=&gt;operation: 代理调用所在类中的其它构造器</span><br><span class="line">op2=&gt;operation: 为继承的属性设置新值</span><br><span class="line">op3=&gt;operation: 便利构造器赋予的新值将被所在类中的其它指定构造器覆盖</span><br><span class="line">op4=&gt;operation: 不能调用方法、访问属性的值、调用self</span><br><span class="line">cond1=&gt;condition: 检查3：上一步是否完成？</span><br><span class="line">cond2=&gt;condition: 检查4：第一阶段是否构造完成？</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;cond1</span><br><span class="line">cond1(yes)-&gt;op2-&gt;cond2</span><br><span class="line">cond1(no)-&gt;op3-&gt;op2</span><br><span class="line">cond2(yes)-&gt;e</span><br><span class="line">cond2(no)-&gt;op4-&gt;e</span><br></pre></td></tr></table></figure>
<h3 id="14-5-4-构造器的继承和重写"><a href="#14-5-4-构造器的继承和重写" class="headerlink" title="14.5.4    构造器的继承和重写"></a>14.5.4    构造器的继承和重写</h3><blockquote>
<p><strong>说明：</strong>编写一个和父类中指定构造器相匹配的子类构造器时，你实际上是在重写父类的这个指定构造器。</p>
<ul>
<li>子类不会默认继承父类的构造器(除非满足一定条件)</li>
<li>子类可以重载父类的构造器</li>
<li>子类可以在初始化时修改继承来的<code>变量属性</code>，但是不能修改继承来的<code>常量属性</code></li>
<li>重载构造器一定需要使用<code>override</code>（即使将父类的指定构造器重写为了便利构造器）</li>
</ul>
<p><strong>注意：</strong>子类中“重写”一个父类<code>便利构造器</code>时，不需要加<code>override</code>前缀（子类不能直接调用父类的<code>便利构造器</code>，因此并没有真的<code>重写</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基类（超类、父类）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfWheels = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\(numberOfWheels) wheel(s)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> vehicle = <span class="type">Vehicle</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Vehicle:\(vehicle.description)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bicycle</span>: <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写父类的默认构造器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 代理到父类的默认构造器</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        numberOfWheels = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bicycle = <span class="type">Bicycle</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Bicycle:\(bicycle.description)"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="14-5-5-自动构造器的继承"><a href="#14-5-5-自动构造器的继承" class="headerlink" title="14.5.5    自动构造器的继承"></a>14.5.5    自动构造器的继承</h3><blockquote>
<p><strong>说明：</strong>子类在默认情况下不会继承父类的构造器。但是如果满足特定条件，父类构造器是可以被自动继承的。</p>
</blockquote>
<table>
<thead>
<tr>
<th>特定条件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>子类没有定义任何指定构造器</td>
<td>自动继承父类所有的指定构造器</td>
</tr>
<tr>
<td>子类提供了所有父类构造器的实现（继承过来的也算）</td>
<td>自动继承所有父类的便利构造器</td>
</tr>
</tbody>
</table>
<h4 id="14-5-5-1-指定构造器和便利构造器语法"><a href="#14-5-5-1-指定构造器和便利构造器语法" class="headerlink" title="14.5.5.1        指定构造器和便利构造器语法"></a>14.5.5.1        指定构造器和便利构造器语法</h4><blockquote>
<ul>
<li><strong>指定构造器</strong></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>(parameters)&#123;</span><br><span class="line">	<span class="comment">//构造过程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><strong>便利构造器</strong></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">convenience</span> <span class="keyword">init</span>(paramaters)&#123;</span><br><span class="line">	<span class="comment">//构造过程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-5-5-2-指定构造器和便利构造器实战"><a href="#14-5-5-2-指定构造器和便利构造器实战" class="headerlink" title="14.5.5.2        指定构造器和便利构造器实战"></a>14.5.5.2        指定构造器和便利构造器实战</h4><blockquote>
<p>第一层：食品类</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*父类</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Food</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">    <span class="comment">//指定构造器</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//便利构造器</span></span><br><span class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>()&#123;</span><br><span class="line">        <span class="comment">//代理给指定构造器</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name:<span class="string">"[Unnamed]"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用指定构造器</span></span><br><span class="line"><span class="keyword">let</span> namedMeat = <span class="type">Food</span>(name:<span class="string">"Bacon"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用便利构造器</span></span><br><span class="line"><span class="keyword">let</span> mysteryMeat = <span class="type">Food</span>();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第二层：调味剂类</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*子类(继承了父类的构造器)</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecipeIngredient</span>:<span class="title">Food</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> quantity:<span class="type">Int</span></span><br><span class="line">    <span class="comment">//子类特制的构造器</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, quantity:<span class="type">Int</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.quantity = quantity</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name:name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//重写父类的便利构造器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(name:name, quantity:<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用父类的便利构造器</span></span><br><span class="line"><span class="keyword">let</span> oneMysteryItem = <span class="type">RecipeIngredient</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用子类的便利构造器（重写了父类的指定构造器）</span></span><br><span class="line"><span class="keyword">let</span> oneBacon = <span class="type">RecipeIngredient</span>(name:<span class="string">"Bacon"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用子类自己的指定构造器</span></span><br><span class="line"><span class="keyword">let</span> sixEggs = <span class="type">RecipeIngredient</span>(name: <span class="string">"Eggs"</span>, quantity: <span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>第三层：购物清单类</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*子类的子类</span><br><span class="line">*继承父类所有指定构造器和便利构造器（1.所有属性提供了默认值；2.自己没有定义任何构造器；）</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoppingListItem</span>:<span class="title">RecipeIngredient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> purchased = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> description:<span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> output = <span class="string">"\(quantity) x \(name)"</span></span><br><span class="line">        output += purchased ? <span class="string">"√"</span> : <span class="string">"x"</span></span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> breakfastList = [</span><br><span class="line">    <span class="type">ShoppingListItem</span>(),</span><br><span class="line">    <span class="type">ShoppingListItem</span>(name: <span class="string">"Bacon"</span>),</span><br><span class="line">    <span class="type">ShoppingListItem</span>(name: <span class="string">"Eggs"</span>, quantity: <span class="number">6</span>)</span><br><span class="line">]</span><br><span class="line">breakfastList[<span class="number">0</span>].name = <span class="string">"Orange juice"</span></span><br><span class="line">breakfastList[<span class="number">0</span>].purchased = <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> breakfastList&#123;</span><br><span class="line">    <span class="built_in">println</span>(item.description)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-6-可失败构造器"><a href="#14-6-可失败构造器" class="headerlink" title="14.6    可失败构造器"></a>14.6    可失败构造器</h2><blockquote>
<p><strong>支持：</strong>类、结构体、枚举<br><strong>说明：</strong>在构造自身的过程中有可能失败的情况，可以定义一个（或多个）可失败的构造器，“失败”是指</p>
<ol>
<li>构造器传入无效的参数</li>
<li>缺少某种需要的外部资源</li>
<li>不满足某种必要条件等</li>
</ol>
<p><strong>语法：</strong><code>init?</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span>? (...) &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>严格说来构造器并不支持返回值（失败构造器表明失败的<code>return</code>是个特例）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> species:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>?(species:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> species.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.species = species</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//构造成功案例</span></span><br><span class="line"><span class="keyword">let</span> someCreature = <span class="type">Animal</span>(species: <span class="string">"Giraffe"</span>)<span class="comment">//Animal?类型</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> giraffe = someCreature&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"An animal was initialzed with a species of \(giraffe.species)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造失败案例</span></span><br><span class="line"><span class="keyword">let</span> anonymousCreature = <span class="type">Animal</span>(species: <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> anonymousCreature == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"The anonymous creature could not be initialized"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-1-枚举类型的可失败构造器"><a href="#14-6-1-枚举类型的可失败构造器" class="headerlink" title="14.6.1        枚举类型的可失败构造器"></a>14.6.1        枚举类型的可失败构造器</h3><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TemperatureUnit</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Kelvin</span>, <span class="type">Celsius</span>, <span class="type">Fahrenheit</span></span><br><span class="line">    <span class="comment">//可失败构造器：当没有匹配的项时构造失败</span></span><br><span class="line">    <span class="keyword">init</span>?(symbol:<span class="type">Character</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span> symbol &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"K"</span>:</span><br><span class="line">                <span class="keyword">self</span> = .<span class="type">Kelvin</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">"C"</span>:</span><br><span class="line">                <span class="keyword">self</span> = .<span class="type">Celsius</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">"F"</span>:</span><br><span class="line">                <span class="keyword">self</span> = .<span class="type">Fahrenheit</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//构造成功例子</span></span><br><span class="line"><span class="keyword">let</span> fahrenheitUnit = <span class="type">TemperatureUnit</span>(symbol: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">if</span> fahrenheitUnit != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"This is a defined temperature unit , so initialization succeeded."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造失败例子</span></span><br><span class="line"><span class="keyword">let</span> unknowUnit = <span class="type">TemperatureUnit</span>(symbol:<span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">if</span> unknowUnit == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"This is a defined temperature unit, so initialization succeeded."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-2-带原始值的枚举类型的可失败构造器"><a href="#14-6-2-带原始值的枚举类型的可失败构造器" class="headerlink" title="14.6.2        带原始值的枚举类型的可失败构造器"></a>14.6.2        带原始值的枚举类型的可失败构造器</h3><blockquote>
<p><strong>说明：</strong>带原始值的枚举类型会自带一个可失败构造器</p>
<ul>
<li>该可失败构造器有一个名为<code>rawValue</code>的参数，其类型和枚举类型的原始值类型一致</li>
<li>如果该参数的值能够和某个枚举成员的原始值匹配，则该构造器会构造相应的枚举成员，否则构造失败</li>
</ul>
<p><strong>语法：</strong><code>init?(rawValue:)</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>组成</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>参数名</td>
<td><code>rawValue</code></td>
</tr>
<tr>
<td>参数类型</td>
<td>和case的原始值（绑定的值）类型一致</td>
</tr>
<tr>
<td>返回值</td>
<td>参数和某个成员的原始值匹配则返回该值；否则构造失败，返回<code>nil</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TemperatureUnit</span>:<span class="title">Character</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Kelvin</span> = <span class="string">"K"</span>, <span class="type">Celsius</span> = <span class="string">"C"</span>, <span class="type">Fahrenheit</span> = <span class="string">"F"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//构造成功例子</span></span><br><span class="line"><span class="keyword">let</span> fahrenheitUnit = <span class="type">TemperatureUnit</span>(rawValue: <span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">if</span> fahrenheitUnit != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"This is a defined temperature unit , so initialization succeeded."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造失败例子</span></span><br><span class="line"><span class="keyword">let</span> unknowUnit = <span class="type">TemperatureUnit</span>(rawValue:<span class="string">"F"</span>)</span><br><span class="line"><span class="keyword">if</span> unknowUnit == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"This is a defined temperature unit, so initialization succeeded."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-3-类的可失败构造器"><a href="#14-6-3-类的可失败构造器" class="headerlink" title="14.6.3        类的可失败构造器"></a>14.6.3        类的可失败构造器</h3><blockquote>
<p><strong>说明：</strong>类的所有属性被初始化完毕，以及构造器之间的代理调用都结束后才能触发败行为。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="comment">//隐式解析可选类型</span></span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span>!<span class="comment">//默认为nil</span></span><br><span class="line">    <span class="keyword">init</span>?(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> name.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-4-构造失败的传递"><a href="#14-6-4-构造失败的传递" class="headerlink" title="14.6.4        构造失败的传递"></a>14.6.4        构造失败的传递</h3><blockquote>
<p><strong>传递方式：</strong><code>横向代理</code>和<code>向上代理</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>传递方式</th>
<th>支持</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>横向代理</td>
<td>结构体、枚举、类</td>
<td>可失败构造器可以横向代理其它构造器（包括可失败构造器）</td>
</tr>
<tr>
<td>向上代理</td>
<td>类</td>
<td>子类的可失败构造器可以向上代理父类的构造器（包括可失败构造器）</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong></p>
<ol>
<li>当代理可失败构造器触发构造失败时，整个构造过程将终止（无论横向代理还是向上代理）</li>
<li>非可失败构造器不能代理失败构造器 (<code>init!</code>声明的除外，但会触发断言)</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="comment">//隐式解析可选类型</span></span><br><span class="line">    <span class="keyword">let</span> name:<span class="type">String</span>!<span class="comment">//默认为nil</span></span><br><span class="line">    <span class="keyword">init</span>?(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> name.isEmpty &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartItem</span>:<span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> quantity:<span class="type">Int</span>!<span class="comment">//确保构造失败仍完成初始化</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//可失败构造器</span></span><br><span class="line">    <span class="keyword">init</span>?(name:<span class="type">String</span>, quantity:<span class="type">Int</span>)&#123;</span><br><span class="line">        <span class="comment">//在可能触发构造失败的代理之前完成代理构造过程</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        <span class="keyword">if</span> quantity &lt; <span class="number">1</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.quantity = quantity</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.构造成功案例</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> twoSocks = <span class="type">CartItem</span>(name: <span class="string">"sock"</span>, quantity: <span class="number">2</span>)&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Item:\(twoSocks.name), quantity:\(twoSocks.quantity)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.子类自身构造失败</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> zeroShirts = <span class="type">CartItem</span>(name: <span class="string">"shirt"</span>, quantity: <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Item:\(zeroShirts.name), quantity:\(zeroShirts.quantity)"</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to initialize zero shirt"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.代理父类构造过程失败</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> oneUnnamed = <span class="type">CartItem</span>(name: <span class="string">""</span>, quantity: <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Item:\(oneUnnamed.name),quantity:\(oneUnnamed.quantity)"</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Unable to initialize one unnamed product"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-5-重写一个可失败构造器"><a href="#14-6-5-重写一个可失败构造器" class="headerlink" title="14.6.5        重写一个可失败构造器"></a>14.6.5        重写一个可失败构造器</h3><blockquote>
<p><strong>说明：</strong>可以在子类中重写父类的<code>可失败构造器</code>（通过定义一个<code>可失败构造器</code>或<code>非可失败构造器</code>）<br><strong>用途：</strong>即使父类的构造器为可失败构造器，但当子类的构造器在构造过程不可能失败时，我们也可以把它修改过来。<br><strong>情景：</strong></p>
<ol>
<li>子类的<code>可失败构造器</code>覆盖父类的可失败构造器</li>
<li>子类的<code>非可失败构造器</code>覆盖父类的可失败构造器</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>当你用子类的<code>非可失败构造器</code>重写父类的可失败构造器时，向上代理到父类的可失败构造器的唯一方式是对父类的可失败构造器的返回值进行<code>强制解包</code>。</li>
<li>你可以用<code>非可失败构造器</code>重写可失败构造器，但反过来却不行</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Document</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 该构造器创建了一个 name 属性的值为 nil 的 document 实例</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span>?</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非可失败构造器</span></span><br><span class="line">    <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可失败构造器</span></span><br><span class="line">    <span class="keyword">init</span>?(name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">if</span> name.isEmpty &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutomaticallyNamedDocument</span>: <span class="title">Document</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写非可失败构造器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 代理到父类的可失败构造器</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.name = <span class="string">"[Untitled]"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写失败构造器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="comment">// 代理到父类的非可失败构造器</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">if</span> name.isEmpty &#123;</span><br><span class="line">            <span class="keyword">self</span>.name = <span class="string">"[Untitled]"</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.name = name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UntitledDocument</span>: <span class="title">Document</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写父类的非可失败构造器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 使用强制解包来调用父类的可失败构造器</span></span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: <span class="string">"[Untitled]"</span>)!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14-6-6-可失败构造器init"><a href="#14-6-6-可失败构造器init" class="headerlink" title="14.6.6        可失败构造器init!"></a>14.6.6        可失败构造器<code>init!</code></h3><blockquote>
<p><strong>说明：</strong>构造<code>可失败构造器</code>其实有两种方式，两种方式创建的构造器可以相互<code>代理调用</code>，也可以相互<code>重写</code>对方。</p>
<ul>
<li><code>init?</code></li>
<li><code>init!</code>：会构建一个相应类型的隐式解包可选类型的对象。</li>
</ul>
<p><strong>描述：</strong>用<code>init!</code>声明的<code>可失败构造器</code><br><strong>注意：</strong>还可以用<code>init</code>代理到<code>init!</code>，不过，一旦<code>init!</code>构造失败，则会触发一个断言。</p>
</blockquote>
<h2 id="14-7-必要构造器"><a href="#14-7-必要构造器" class="headerlink" title="14.7    必要构造器"></a>14.7    必要构造器</h2><blockquote>
<p><strong>说明：</strong>在类的构造器前添加<code>required</code>修饰符，称为<code>必要构造器</code>。所有该类的子类都必须实现该构造器。在子类重写父类的<code>必要构造器时</code>，必须在子类的构造器前也添加<code>required</code>修饰符。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>()&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSubClass</span>:<span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-8-通过闭包和函数来设置属性的默认值"><a href="#14-8-通过闭包和函数来设置属性的默认值" class="headerlink" title="14.8    通过闭包和函数来设置属性的默认值"></a>14.8    通过闭包和函数来设置属性的默认值</h2><blockquote>
<p><strong>说明：</strong>如果某个<code>存储型属性的默认值</code>需要一些<code>定制或设置</code>，你可以使用<code>闭包</code>或<code>全局函数</code>为其提供定制的默认值。<br><strong>限制：</strong><code>立即执行闭包</code>执行时，实例的其他部分还没有初始化，因此</p>
<ol>
<li>不能够在闭包中访问其它属性</li>
<li>不能使用<code>self</code>属性</li>
<li>不能调用其它实例方法</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line">&gt;<span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span>:<span class="title">SomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> someProperty:<span class="type">SomeType</span> = &#123;</span><br><span class="line">        <span class="comment">//在这个必包中给someProperty创建一个默认值</span></span><br><span class="line">        <span class="comment">//someValue必须和SomeType类型相同</span></span><br><span class="line">        <span class="keyword">return</span> someValue</span><br><span class="line">    &#125;()<span class="comment">//立即执行此闭包（否则将会将必包本身赋值给属性）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Checkedboard</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> boardColors:[<span class="type">Bool</span>] = &#123;</span><br><span class="line">        <span class="keyword">var</span> temporaryBoard = [<span class="type">Bool</span>]()</span><br><span class="line">        <span class="keyword">var</span> isBlack = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...<span class="number">10</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="number">1</span>...<span class="number">10</span>&#123;</span><br><span class="line">                temporaryBoard.append(isBlack)</span><br><span class="line">                isBlack = !isBlack</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temporaryBoard</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">squareIsBlackAtRow</span><span class="params">(row:Int, column:Int)</span></span>-&gt;<span class="type">Bool</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> boardColors[(row * <span class="number">10</span>) + column]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> board = <span class="type">Checkedboard</span>()</span><br><span class="line"><span class="built_in">println</span>(board.squareIsBlackAtRow(<span class="number">0</span>, column: <span class="number">1</span>))</span><br><span class="line"><span class="built_in">println</span>(board.squareIsBlackAtRow(<span class="number">9</span>, column: <span class="number">9</span>))</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_13 继承/" itemprop="url">
                  13 继承
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:46:35+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明</strong>：一个类可以继承另一个类的方法,属性和其它特性</p>
</blockquote>
<table>
<thead>
<tr>
<th>能力</th>
<th>相关成员</th>
<th>价值</th>
</tr>
</thead>
<tbody>
<tr>
<td>调用</td>
<td>超类的方法、属性、下标脚本</td>
<td>代码重用</td>
</tr>
<tr>
<td>重写</td>
<td>超类的方法、属性、下标脚本</td>
<td>优化或修改它们的行为</td>
</tr>
<tr>
<td>监视</td>
<td>继承来的属性（通过添加属性(存储属性或计算属性)观察器）</td>
<td>当值改变时，类就会被通知到</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>只有类能够继承</p>
</blockquote>
<h2 id="13-1-定义一个基类"><a href="#13-1-定义一个基类" class="headerlink" title="13.1    定义一个基类"></a>13.1    定义一个基类</h2><blockquote>
<p><strong>基类：</strong>不继承其它类的类（swift的类并不是从一个通用的基类继承而来）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义一个基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentSpeed = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">var</span> description:<span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"traveling at \(currentSpeed) miles per hour"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeNoise</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//什么也不做－因为车辆不一定有噪音</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> someVehicle = <span class="type">Vehicle</span>()</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"Vehicle:\(someVehicle.description)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="13-2-子类生成"><a href="#13-2-子类生成" class="headerlink" title="13.2    子类生成"></a>13.2    子类生成</h2><blockquote>
<p><strong>说明</strong>：<code>class 子类:超类 ｛｝</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//继承Vehicle</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bicycle</span>:<span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> hasBasket = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bicycle = <span class="type">Bicycle</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置子类自己的实例属性</span></span><br><span class="line">bicycle.hasBasket = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//修改继承来的属性</span></span><br><span class="line">bicycle.currentSpeed = <span class="number">15.0</span></span><br></pre></td></tr></table></figure>
<h2 id="13-3-重写"><a href="#13-3-重写" class="headerlink" title="13.3    重写"></a>13.3    重写</h2><blockquote>
<p><strong>关键字：</strong><code>override</code>(会提醒编译器检查该类是否有匹配重写版本的声明)</p>
<p><strong>说明：</strong>子类可以为继承来的实例方法、类方法、实例属性、下标脚本提供自己定制的实现。</p>
</blockquote>
<h3 id="13-3-1-访问超类的方法、属性及下标脚本"><a href="#13-3-1-访问超类的方法、属性及下标脚本" class="headerlink" title="13.3.1    访问超类的方法、属性及下标脚本"></a>13.3.1    访问超类的方法、属性及下标脚本</h3><table>
<thead>
<tr>
<th>成员</th>
<th>访问方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>方法</td>
<td><code>super.someMethod()</code></td>
</tr>
<tr>
<td>属性</td>
<td><code>super.someProperty</code></td>
</tr>
<tr>
<td>下标脚本</td>
<td><code>super[someIndex]</code></td>
</tr>
</tbody>
</table>
<h3 id="13-3-2-重写方法"><a href="#13-3-2-重写方法" class="headerlink" title="13.3.2    重写方法"></a>13.3.2    重写方法</h3><blockquote>
<p><strong>关键字</strong>：<code>override</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Train</span>:<span class="title">Vechicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">makeNoise</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Choo Choo"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> train = <span class="type">Train</span>()</span><br><span class="line">train.makeNoise()</span><br></pre></td></tr></table></figure>
<h3 id="13-3-3-重写属性"><a href="#13-3-3-重写属性" class="headerlink" title="13.3.3     重写属性"></a>13.3.3     重写属性</h3><blockquote>
<p><strong>说明</strong>：重写什么？</p>
<ol>
<li>重写继承来的<code>实例属性</code>或<code>类属性</code></li>
<li>提供自己定制的<code>getter</code>和<code>setter</code></li>
<li>重写属性观察器观察被重写的属性的变化（非只读属性不可以设置）</li>
</ol>
<p><strong>注意</strong></p>
<ol>
<li>存储型或计算型属性都可以被重写（包括<code>getters</code>和<code>setters</code>）</li>
<li>计算机会根据属性的名字和类型检查重写的属性是否与超累中同名同类型的属性相匹配</li>
<li>可以将继承来的只读属性重写为一个读写属性（通过重写属性的<code>getters</code>和<code>setters</code>）</li>
</ol>
<ul>
<li>如果重写属性提供了<code>setter</code>,也一定要提供<code>getter</code></li>
<li><code>setter</code>中可以通过<code>super.someProperty</code>来返回继承来的值</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>:<span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> gear = <span class="number">1</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description:<span class="type">String</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.description + <span class="string">" in gear \(gear)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="type">Car</span>()</span><br><span class="line">car.currentSpeed = <span class="number">25.0</span></span><br><span class="line">car.gear = <span class="number">3</span></span><br><span class="line"><span class="built_in">println</span>(<span class="string">"Car:\(car.description)"</span>)</span><br><span class="line">+ 重写属性观察器</span><br><span class="line"><span class="number">1</span>. 不可重写属性观察器的继承来的属性：常量存储属性、只读计算属性</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutomaticCar</span>:<span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="comment">//重写属性及其属性观察器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> currentSpeed:<span class="type">Double</span>&#123;</span><br><span class="line">        <span class="keyword">didSet</span>&#123;</span><br><span class="line">            gear = <span class="type">Int</span>(currentSpeed / <span class="number">10.0</span>) + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> automatic = <span class="type">AutomaticCar</span>()</span><br><span class="line">automatic.currentSpeed = <span class="number">35.0</span></span><br><span class="line"><span class="built_in">println</span>(<span class="string">"AutomaticCar:\(automatic.description)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="13-4-防止重写"><a href="#13-4-防止重写" class="headerlink" title="13.4    防止重写"></a>13.4    防止重写</h2><blockquote>
<p><strong>关键字：</strong><code>final</code><br><strong>说明：</strong>可以通过把方法,属性或下标脚本标记为 <code>final</code> 来防止它们被重写,只需要在声明关键字前加上 <code>final</code> 特性即<br>可</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型</th>
<th><code>final</code>声明方式</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>属性</td>
<td><code>final var</code></td>
<td>不可被重写</td>
</tr>
<tr>
<td>实例方法</td>
<td><code>final func</code></td>
<td>不可被重写</td>
</tr>
<tr>
<td>下标脚本</td>
<td><code>final subscript</code></td>
<td>不可被重写</td>
</tr>
<tr>
<td>类方法</td>
<td><code>final class func</code></td>
<td>不可被重写</td>
</tr>
<tr>
<td>类</td>
<td><code>final class</code></td>
<td>不可被继承</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_12 下标脚本/" itemprop="url">
                  12 下标脚本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:46:20+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>用途</strong>：访问对象、集合、序列的快捷方式，可以使用下标脚本的索引设置和获取值，不需要再调用对应的存取方法<br><strong>支持</strong>：类、结构体、枚举<br><strong>特点</strong>:</p>
<ol>
<li>同一个目类型可以定义多个附属脚本</li>
<li>可以通过索引值的类型进行重载</li>
<li>语法类似实例方法和计算属性的混合</li>
</ol>
</blockquote>
<h2 id="12-1-语法"><a href="#12-1-语法" class="headerlink" title="12.1    语法"></a>12.1    语法</h2><blockquote>
<p><strong>关键字</strong>：<code>subscript</code>、<code>set</code>、<code>get</code><br><strong>说明：</strong>语法类似于<code>实例方法</code>语法和<code>计算型属性</code>语法的混合。</p>
<ul>
<li>显式声明入参和返回值（类似实例方法）</li>
<li>可以设定为读写或只读，由 <code>getter</code> 和<code>setter</code> 实现（类似计算属性）</li>
</ul>
<p><strong>setter和getter：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th><em>**</em></th>
<th>参数</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>set</td>
<td>0或多个参数类型必须与<code>get</code>返回类型相同，如果不指定参数，会提供一个名为<code>newValue</code>的默认参数</td>
<td>无</td>
</tr>
<tr>
<td>get</td>
<td>无</td>
<td>和脚本入参类型相同值</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//具备读写能力的附属脚本</span></span><br><span class="line"><span class="keyword">subscript</span>(index:<span class="type">Int</span>)-&gt;<span class="type">Int</span>&#123;</span><br><span class="line">    <span class="keyword">get</span>&#123;</span><br><span class="line">        <span class="comment">//返回与入參匹配的Int类型的值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span>(newValue)&#123;</span><br><span class="line">        <span class="comment">//执行赋值操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只读的附属脚本（简写形式）</span></span><br><span class="line"><span class="keyword">subscript</span>(index:<span class="type">Int</span>)-&gt;<span class="type">Int</span>&#123;</span><br><span class="line">    <span class="comment">//返回与入參匹配的Int类型的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>案例</strong>：展示传入整数的n倍数（结构体中使用只读下标脚本）</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TimesTable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> multiplier:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">subscript</span>(index:<span class="type">Int</span>)-&gt;<span class="type">Int</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> multiplier * index</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> threeTimesTable = <span class="type">TimesTable</span>(multiplier: <span class="number">3</span>)</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"3的6倍是\(threeTimesTable[6])"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="12-2-用法（以字典为例）"><a href="#12-2-用法（以字典为例）" class="headerlink" title="12.2    用法（以字典为例）"></a>12.2    用法（以字典为例）</h2><blockquote>
<p><strong>说明：</strong>字典本身是由结构体实现的，通过下标脚本来对其实例来进行存取操作。<br><strong>特点：</strong></p>
<ol>
<li>字典实例在下标脚本中使用和字典索引相同类型的值</li>
<li>字典通过附属脚本返回的实际是一个可选值</li>
<li>从字典实例中删除某个索引下的值也需要给这个索引赋值为<code>nil</code></li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> numberOfLogs = [<span class="string">"spider"</span>:<span class="number">8</span>, <span class="string">"ant"</span>:<span class="number">6</span>, <span class="string">"cat"</span>:<span class="number">4</span>]</span><br><span class="line">numberOfLogs[<span class="string">"birds"</span>] = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="12-3-高级"><a href="#12-3-高级" class="headerlink" title="12.3    高级"></a>12.3    高级</h2><blockquote>
<p><strong>说明：</strong>下面详细说明下标脚本的一些特点</p>
<ul>
<li><em>参数：</em>下标脚本可以接受任意数量的入参，并且这些入参可以是任意类型</li>
<li><em>返回值：</em>下标脚本的返回值也可以是任意类型</li>
<li><em>变量：</em>下标脚本可以使用变量参数和可变参数</li>
<li><em>重载：</em>一个类或结构体可以根据自身需要提供多个下标脚本实现，使用下标脚本时将通过入参的数量和类型进行区分，自动匹配合适的下标脚本，这就是下标脚本的重载</li>
</ul>
<p><strong>限制：</strong></p>
<ul>
<li><em>参数：</em>不能使用输入输出参数，也不能给参数设置默认值</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//矩阵</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rows:<span class="type">Int</span>, columns:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> grid:[<span class="type">Double</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法：包含两个入參</span></span><br><span class="line">    <span class="keyword">init</span>(rows:<span class="type">Int</span>, columns:<span class="type">Int</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.rows = rows</span><br><span class="line">        <span class="keyword">self</span>.columns = columns</span><br><span class="line">        grid = <span class="type">Array</span>(<span class="built_in">count</span>:rows * columns, repeatedValue:<span class="number">0.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//确保入參的row货column不会造成数组越界</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">indexIsVaildForRow</span><span class="params">(row:Int, column:Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> row &gt;= <span class="number">0</span> &amp;&amp; row &lt; rows &amp;&amp; column &gt;= <span class="number">0</span> &amp;&amp;  column &lt; columns</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下标脚本（两个参数）</span></span><br><span class="line">    <span class="keyword">subscript</span>(row:<span class="type">Int</span>, column:<span class="type">Int</span>)-&gt;<span class="type">Double</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="built_in">assert</span>(indexIsVaildForRow(row, column:column), <span class="string">"Index out of range"</span>)</span><br><span class="line">            <span class="keyword">return</span> grid[(row * columns) + column]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>&#123;</span><br><span class="line">            <span class="built_in">assert</span>(indexIsVaildForRow(row, column: column), <span class="string">"Index out of range"</span>)</span><br><span class="line">            grid[(row * columns) + column] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建结构体实例</span></span><br><span class="line"><span class="keyword">var</span> matrix = <span class="type">Matrix</span>(rows: <span class="number">2</span>, columns: <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//利用下标脚本赋值</span></span><br><span class="line">matrix[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">1.5</span></span><br><span class="line">matrix[<span class="number">1</span>, <span class="number">0</span>] = <span class="number">3.2</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_11 方法/" itemprop="url">
                  11 方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:45:53+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>定义</strong>：与某些特定类型相关联的函数。</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>支持类型</th>
<th>关联对象</th>
</tr>
</thead>
<tbody>
<tr>
<td>实例方法</td>
<td>类、结构体、枚举</td>
<td>实例</td>
</tr>
<tr>
<td>类型方法</td>
<td>类、结构体、枚举</td>
<td>类型</td>
</tr>
</tbody>
</table>
<h2 id="11-1-实例方法"><a href="#11-1-实例方法" class="headerlink" title="11.1    实例方法"></a>11.1    实例方法</h2><blockquote>
<p><strong>说明：</strong>写在它所属的类型的前后<code>{}</code>之间</p>
<ul>
<li>能够隐式访问它所属类型的所有的其他实例方法和属性</li>
<li>只能被它所属的类的某个特定实例调用</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>调用位置</th>
<th>调用方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>内部</td>
<td>能够隐式访问它所属类型的所有其它实例方法和属性</td>
</tr>
<tr>
<td>外部</td>
<td>只能被它所属的类的某个特定实例调用</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//实例属性</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//实例方法1</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">count</span>++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//实例方法2</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">incrementBy</span><span class="params">(amount:Int)</span></span>&#123;</span><br><span class="line">        <span class="built_in">count</span> += amount</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//实例方法3</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="type">Counter</span>()</span><br><span class="line">counter.increment()</span><br><span class="line">counter.incrementBy(<span class="number">5</span>)</span><br><span class="line">counter.reset()</span><br></pre></td></tr></table></figure>
<h3 id="11-1-1-方法的内部参数名和外部参数名"><a href="#11-1-1-方法的内部参数名和外部参数名" class="headerlink" title="11.1.1    方法的内部参数名和外部参数名"></a>11.1.1    方法的内部参数名和外部参数名</h3><blockquote>
<p><strong>说明：</strong>同函数。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//实例属性</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">incrementBy</span><span class="params">(amount:Int, numberOfTime:Int)</span></span>&#123;</span><br><span class="line">        <span class="built_in">count</span> += amount * numberOfTime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="type">Counter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一个参数：不必为再定义一个外部变量名，因为通过incrementBy已经很清楚地看出它的作用</span></span><br><span class="line"><span class="comment">//其它参数：需要被一个外部参数名所限制，以便在方法呗调用时明确它的作用</span></span><br><span class="line">counter.incrementBy(<span class="number">5</span>, numberOfTime:<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="11-1-2-修改方法的外部参数名称"><a href="#11-1-2-修改方法的外部参数名称" class="headerlink" title="11.1.2  修改方法的外部参数名称"></a>11.1.2  修改方法的外部参数名称</h3><blockquote>
<p><strong>说明：</strong>同函数。</p>
<ul>
<li>可以为第一个参数添加一个显式的外部名称</li>
<li>不想为方法的第二个及后续的参数提供一个外部名称，可以通过使用下划线<code>_</code>作为该参数的显式外部名称</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*覆盖参数的默认行为</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="comment">//实例属性</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//其它参数：使用_作为前缀，参数不在具有外部名称</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">incrementBy</span><span class="params">(amount:Int, <span class="number">_</span> numberOfTime:Int)</span></span>&#123;</span><br><span class="line">        <span class="built_in">count</span> += amount * numberOfTime</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="type">Counter</span>()</span><br><span class="line">counter.incrementBy(amount:<span class="number">5</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="11-1-3-self属性"><a href="#11-1-3-self属性" class="headerlink" title="11.1.3  self属性"></a>11.1.3  self属性</h3><blockquote>
<p><strong>说明：</strong>类型的每一个实例都有一个隐含属性叫做<code>self</code>，<code>self</code>完全等同于该实例本身。</p>
<ul>
<li>在方法中调用实例的其它方法和属性时可以省略<code>self</code>（除非需要区分参数名和属性名）</li>
</ul>
<p><strong>用途：</strong>在一个实例的实例方法中使用这个隐含的self属性来引用当前实例</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isToTheRightOfX</span><span class="params">(x:Double)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.x &gt; x<span class="comment">//使用self.x指明使用属性x而不是参数x</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> somePoint = <span class="type">Point</span>(x:<span class="number">4.0</span>, y:<span class="number">5.0</span>)</span><br><span class="line"><span class="keyword">if</span> somePoint.isToTheRightOfX(<span class="number">1.0</span>)&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"This point to the right of the line where x == 1.0"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-1-4-在实例方法中修改值类型"><a href="#11-1-4-在实例方法中修改值类型" class="headerlink" title="11.1.4  在实例方法中修改值类型"></a>11.1.4  在实例方法中修改值类型</h3><blockquote>
<p><strong>背景</strong>：值类型（结构体和枚举）的属性不能在普通实例方法中被修改<br><strong>说明</strong>：关键字<code>mutating</code> 放到方法的<code>func</code>关键字之前，使变量实例属性的方法具备修改实例中的属性（包括<code>self</code>）的能力。<br><strong>注意</strong>：不能在结构体类型的常量上调用可变方法，因为此时所有属性都无法修改。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">moveByX</span><span class="params">(deltaX:Double,y deltaY:Double)</span></span>&#123;</span><br><span class="line">        x += deltaX</span><br><span class="line">        y += deltaY</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> somePoint = <span class="type">Point</span>(x:<span class="number">4.0</span>, y:<span class="number">5.0</span>)<span class="comment">//声明为let再调用mutating方法将报错</span></span><br><span class="line">somePoint.moveByX(<span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="11-1-5-在变异方法中给self赋值-通过mutating"><a href="#11-1-5-在变异方法中给self赋值-通过mutating" class="headerlink" title="11.1.5  在变异方法中给self赋值(通过mutating)"></a>11.1.5  在变异方法中给self赋值(通过<code>mutating</code>)</h3><blockquote>
<p><strong>说明：</strong>可变方法能够赋给隐含属性self一个全新的实例</p>
<h4 id="结构体中使用"><a href="#结构体中使用" class="headerlink" title="结构体中使用"></a>结构体中使用</h4></blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">moveByX</span><span class="params">(deltaX:Double,y deltaY:Double)</span></span>&#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="type">Point</span>(x: x + deltaX, y: y + deltaY)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> somePoint = <span class="type">Point</span>(x:<span class="number">4.0</span>, y:<span class="number">5.0</span>)<span class="comment">//声明为let再调用mutating方法将报错</span></span><br><span class="line">somePoint.moveByX(<span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="枚举中使用"><a href="#枚举中使用" class="headerlink" title="枚举中使用"></a>枚举中使用</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义一个三态开关的枚举，具备循环切换状态的能力</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TriStateSwitch</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Off</span>, <span class="type">Low</span>, <span class="type">High</span></span><br><span class="line">    <span class="comment">//该方法的每次调用都会导致值的改变（通过修改self）</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Off</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">Low</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Low</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">High</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">High</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">Off</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ovenLight = <span class="type">TriStateSwitch</span>.<span class="type">Low</span></span><br><span class="line">ovenLight.next()<span class="comment">//.High</span></span><br><span class="line">ovenLight.next()<span class="comment">//.Off</span></span><br></pre></td></tr></table></figure>
<h2 id="11-2-类型（静态）方法"><a href="#11-2-类型（静态）方法" class="headerlink" title="11.2    类型（静态）方法"></a>11.2    类型（静态）方法</h2><blockquote>
<p><strong>关键字：</strong>使用的关键字同类型（静态）属性。</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型</th>
<th>关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td>类</td>
<td><code>class</code></td>
</tr>
<tr>
<td>结构体、枚举</td>
<td><code>static</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>说明：</strong>类型方法和实例方法一样用<code>点语法</code>调用</p>
<ol>
<li><code>self</code>属性指向类型本身</li>
<li>静态(类型)方法法中<code>能也只能</code>直接（不需要类型名称前缀）访问其它静态方法和属性</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LevelTracker</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> highestUnlocked = <span class="number">1</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">unlockLevel</span><span class="params">(level:Int)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> level &gt; highestUnlocked&#123;</span><br><span class="line">            highestUnlocked = level</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态方法中访问静态变量</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">levelIsUnlocked</span><span class="params">(level:Int)</span></span>-&gt;<span class="type">Bool</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> level &lt;= highestUnlocked</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> currentLevel = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//变异实例方法中修改实例属性的值（只有当实例赋值为变量时）</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">advanceToLevel</span><span class="params">(level:Int)</span></span>-&gt;<span class="type">Bool</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">LevelTracker</span>.levelIsUnlocked(level)&#123;</span><br><span class="line">            currentLevel = level</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">someMethod</span>()</span>&#123;</span><br><span class="line">        <span class="comment">//type method implementation goes here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">SomeClass</span>.someMethod()</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_10  属性/" itemprop="url">
                  10 属性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:45:28+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>按从属区分</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>属性类型</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>类型属性</td>
<td>类型本身的属性</td>
</tr>
<tr>
<td>实例属性</td>
<td>特定类型的实例的属性</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>按存储数据的方式区分</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>属性类型</strong></th>
<th><strong>特点</strong></th>
<th><strong>限制</strong></th>
<th><strong>定义方式</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>存储属性</td>
<td>存储常量或变量作为实例的一部分</td>
<td>类、结构体</td>
<td><code>let</code>、<code>var</code></td>
</tr>
<tr>
<td>计算属性</td>
<td>通过计算获取值的，值是不固定的</td>
<td>类、结构体、枚举</td>
<td><code>var</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>计算属性分类</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>计算属性</strong></th>
<th><strong>特点</strong></th>
<th><strong>定义方式</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>读写计算属性</td>
<td>既可以获取值，也可以设置值</td>
<td>只提供getter没有setter</td>
</tr>
<tr>
<td>只读计算属性</td>
<td>总是返回一个值，可以通过点运算符访问，但不能设置新的值。</td>
<td>同时设置getter和setter</td>
</tr>
</tbody>
</table>
<h2 id="10-1-存储属性-Stored-Properties"><a href="#10-1-存储属性-Stored-Properties" class="headerlink" title="10.1    存储属性(Stored Properties)"></a>10.1    存储属性(Stored Properties)</h2><table>
<thead>
<tr>
<th><strong>存储属性类型</strong></th>
<th><strong>定义方式</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>变量存储属性</td>
<td>使用<code>var</code>定义</td>
<td>可以修改</td>
</tr>
<tr>
<td>常量存储属性</td>
<td>使用<code>let</code>定义</td>
<td>初始化后不可修改</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.声明一个结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FixedLengthRange</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> firstValue:<span class="type">Int</span></span><br><span class="line">    <span class="keyword">let</span> length:<span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2.创建结构体实例</span></span><br><span class="line"><span class="keyword">var</span> rangeOfThreeItems = <span class="type">FixedLengthRange</span>(firstValue: <span class="number">0</span>, length: <span class="number">3</span>)</span><br><span class="line"><span class="comment">//3.修改结构体实例的变量存储属性</span></span><br><span class="line">rangeOfThreeItems.firstValue = <span class="number">6</span></span><br></pre></td></tr></table></figure>
<h3 id="10-1-1-常量结构体实例和常量类实例的存储属性"><a href="#10-1-1-常量结构体实例和常量类实例的存储属性" class="headerlink" title="10.1.1    常量结构体实例和常量类实例的存储属性"></a>10.1.1    常量结构体实例和常量类实例的存储属性</h3><blockquote>
<p><strong>说明：</strong>创建了一个结构体的实例并将其赋值给一个常量，则无法修改该实例的任何属性，即使定义了变量存储属性</p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>特指</strong></th>
<th><strong>被赋值给常量</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>结构体(struct)实例</td>
<td>它的所有属性（包括<code>var</code>声明的）也就成了常量。</td>
</tr>
<tr>
<td>类(class)实例</td>
<td>仍然可以修改实例的变量属性（<code>var</code>）</td>
</tr>
</tbody>
</table>
<h3 id="10-1-2-延迟存储属性"><a href="#10-1-2-延迟存储属性" class="headerlink" title="10.1.2    延迟存储属性"></a>10.1.2    延迟存储属性</h3><blockquote>
<p><strong>关键字：</strong><code>lazy</code><br><strong>说明：</strong>第一次被调用的时候才会计算其初始值的属性<br><strong>注意：</strong>必须将延迟存储属性声明为变量(<code>var</code>)，因为常量属性在构造完成之前必须要有初始值，延迟属性不能保证这一点。<br><strong>应用</strong>：</p>
<ol>
<li>当属性的值依赖于在实例的构造过程结束前无法知道具体值的外部因素时</li>
<li>当属性的值需要复杂或大量计算时</li>
</ol>
</blockquote>
<pre><code>class DataImporter {
    /*
    DataImporter是一个将外部文件中的数据导入的类。这个类的初始化会消耗不少时间。
    */
    var fileName = &quot;data.txt&quot;;
}

class DataManager {
    lazy var impoter = DataImporter()
    var data = [String]()
    //这里提供数据管理功能
}
let manager = DataManager()
manager.data.append(&quot;Some data&quot;)
manager.data.append(&quot;Some more data&quot;)
//DataImporter实例的importer属性还没有被创建

println(manager.impoter.fileName)//DataImporter的实例现在被创建了，输出&quot;data.txt&quot;
</code></pre><h3 id="10-1-3-存储属性和实例变量"><a href="#10-1-3-存储属性和实例变量" class="headerlink" title="10.1.3    存储属性和实例变量"></a>10.1.3    存储属性和实例变量</h3><blockquote>
<p>说明：<code>swift</code>的属性没有对应的实例变量，属性的后端存储也无法直接访问。</p>
</blockquote>
<h2 id="10-2-计算属性"><a href="#10-2-计算属性" class="headerlink" title="10.2    计算属性"></a>10.2    计算属性</h2><blockquote>
<p><strong>说明：</strong>计算属性不直接存储值，而是提供一个 <code>getter</code> 和一个可选的 <code>setter</code>，来间接获取和设置其他属性或变量的值。</p>
<ul>
<li>定义<code>getter</code>计算并返回属性值</li>
<li>定义可选的<code>setter</code>间接设置其它属性或变量的值。</li>
</ul>
<p><strong>注意</strong>:创建实例时可以不必为计算属性赋值，因为计算属性并不存储值，而是通过计算动态得出的。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>,y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//计算属性</span></span><br><span class="line">    <span class="keyword">var</span> center:<span class="type">Point</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> centerX = origin.x + (size.width / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">let</span> centerY = origin.y + (size.height / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Point</span>(x:centerX, y:centerY)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newCenter)&#123;</span><br><span class="line">            origin.x = newCenter.x - (size.width / <span class="number">2</span>)</span><br><span class="line">            origin.y = newCenter.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> square = <span class="type">Rect</span>(origin: <span class="type">Point</span>(x:<span class="number">15.0</span>,y:<span class="number">0.0</span>), size: <span class="type">Size</span>(width: <span class="number">10.0</span>, height: <span class="number">10.0</span>))</span><br><span class="line"><span class="keyword">let</span> initialSquareCenter = <span class="type">Point</span>(x:<span class="number">15.0</span>, y:<span class="number">15.0</span>)</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"Square.origin is now at (\(square.origin.x),\(square.origin.y))"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="10-2-1-便捷setter声明"><a href="#10-2-1-便捷setter声明" class="headerlink" title="10.2.1    便捷setter声明"></a>10.2.1    便捷setter声明</h3><blockquote>
<p><strong>说明</strong>:如果计算属性的<code>setter</code>没有定义标识新值的参数名，则可以使用默认名称<code>newValue</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//不使用便捷setter声明</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">    <span class="keyword">var</span> center:<span class="type">Point</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> centerX = origin.x + (size.width / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">let</span> centerY = origin.y + (size.height / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Point</span>(x:centerX, y:centerY)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(newCenter)&#123;</span><br><span class="line">            origin.x = newCenter.x - (size.width / <span class="number">2</span>)</span><br><span class="line">            origin.y = newCenter.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用便捷setter声明</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AlternativeRect</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">    <span class="keyword">var</span> center:<span class="type">Point</span>&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> centerX = origin.x + (size.width / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">let</span> centerY = origin.y + (size.height / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="type">Point</span>(x:centerX, y:centerY)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>&#123;</span><br><span class="line">            origin.x = newValue.x - (size.width / <span class="number">2</span>)</span><br><span class="line">            origin.y = newValue.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">### <span class="number">10.2</span>.<span class="number">2</span> 只读计算属性</span><br><span class="line">&gt;**说明：**只有 `getter` 没有 `setter` 的计算属性就是只读计算属性</span><br><span class="line">&gt;**用途**：当一个属性的值完全只需要计算得出而不需要设置值时。</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cuboid</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span>, depth = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">var</span> volume:<span class="type">Double</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width * height * depth</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fourByFiveByTwo = <span class="type">Cuboid</span>(width: <span class="number">4.0</span>, height: <span class="number">5.0</span>, depth: <span class="number">2.0</span>)</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"the volume of fourByFiveByTwo is 40.0"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="10-3-属性观察器"><a href="#10-3-属性观察器" class="headerlink" title="10.3    属性观察器"></a>10.3    属性观察器</h2><blockquote>
<p><strong>说明：</strong>属性观察器监控和响应属性值的变化，每次属性被设置值的时候都会调用属性观察器，甚至新值和当前值相同的时候也不例外。</p>
</blockquote>
<h3 id="10-3-1-哪些属性可以定义属性观察器？"><a href="#10-3-1-哪些属性可以定义属性观察器？" class="headerlink" title="10.3.1    哪些属性可以定义属性观察器？"></a>10.3.1    哪些属性可以定义属性观察器？</h3><table>
<thead>
<tr>
<th><strong>可以设置属性观察器</strong></th>
<th><strong>不可以设置属性观察器</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>结构体、类的静态(类型)属性和实例属性</td>
<td>类无法重载的计算属性</td>
</tr>
<tr>
<td>类继承的属性</td>
<td>延迟存储属性</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意</strong>：不需要为无法重载的计算属性添加属性观察器，因为可以通过<code>setter</code>直接监控和响应值的变化。</p>
</blockquote>
<h3 id="10-3-2-属性观察器有哪几种？"><a href="#10-3-2-属性观察器有哪几种？" class="headerlink" title="10.3.2    属性观察器有哪几种？"></a>10.3.2    属性观察器有哪几种？</h3><table>
<thead>
<tr>
<th>属性观察器</th>
<th>调用时机</th>
<th>参数</th>
<th>参数默认名</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>willSet</code></td>
<td>在设置新的值之前调用</td>
<td>新的属性的值</td>
<td>newValue</td>
</tr>
<tr>
<td><code>didSet</code></td>
<td>在新的值被设置之后被调用</td>
<td>旧的属性值</td>
<td>oldValue</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意</strong>：<code>willSet</code>和<code>didSet</code>观察器只会当属性的值在初始化之外的地方被设置时调用。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StepCounter</span> </span>&#123;</span><br><span class="line">	    <span class="comment">//定义一个属性及其属性观察器</span></span><br><span class="line">    <span class="keyword">var</span> totalSteps:<span class="type">Int</span> = <span class="number">0</span>&#123;</span><br><span class="line">        <span class="comment">//在设置新值之前调用</span></span><br><span class="line">        <span class="keyword">willSet</span>(newTotalSteps)&#123;</span><br><span class="line">            <span class="built_in">println</span>(<span class="string">"About to set totalSteps to \(newTotalSteps)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在新值被设置之后调用</span></span><br><span class="line">        <span class="keyword">didSet</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> totalSteps &gt; oldValue&#123;</span><br><span class="line">                <span class="built_in">println</span>(<span class="string">"aDDED \(totalSteps - oldValue) steps"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> stepCounter = <span class="type">StepCounter</span>()</span><br><span class="line">stepCounter.totalSteps = <span class="number">200</span></span><br><span class="line"><span class="comment">//About to set totalSteps to 200</span></span><br><span class="line"><span class="comment">//Added 200 steps</span></span><br></pre></td></tr></table></figure>
<h2 id="10-4-全局变量和局部变量"><a href="#10-4-全局变量和局部变量" class="headerlink" title="10.4 全局变量和局部变量"></a>10.4 全局变量和局部变量</h2><table>
<thead>
<tr>
<th><em>**</em></th>
<th>全局变量</th>
<th>局部变量</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>定义</strong></td>
<td>函数、方法、闭包或任何类型之外定义的变量</td>
<td>函数、方法或必包内部定义的变量</td>
</tr>
<tr>
<td><strong>默认是否延迟计算</strong></td>
<td>是</td>
<td>否（除非使用<code>lazy</code>）</td>
</tr>
<tr>
<td><strong>是否可以定义计算属性</strong></td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td><strong>是否可以为存储型变量定义观察器</strong></td>
<td>是</td>
<td>是</td>
</tr>
</tbody>
</table>
<h2 id="10-5-类型属性"><a href="#10-5-类型属性" class="headerlink" title="10.5    类型属性"></a>10.5    类型属性</h2><blockquote>
<p><strong>用途</strong>：用于定义特定类型所有实例共享的数据。<br><strong>注意</strong>：必须给存储类型属性设置默认值，因为类型本身无法在初始化过程中使用构造函器给类型属性赋值。<br><strong>说明：</strong>无论创建了多少个该类型的实例，这些属性都只有唯一一份。这种属性就是类型属性。</p>
</blockquote>
<table>
<thead>
<tr>
<th>分类</th>
<th>存储型类型属性</th>
<th>计算型类型属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>可以定义该类型属性的类型</td>
<td><code>struct</code>、<code>enum</code></td>
<td><code>struct</code>、<code>enum</code>、<code>class</code></td>
</tr>
<tr>
<td>可以为变量或常量</td>
<td>变量、常量</td>
<td>变量</td>
</tr>
<tr>
<td>是否需要指定默认值</td>
<td>是</td>
<td>否</td>
</tr>
</tbody>
</table>
<h3 id="10-5-1-类型属性语法"><a href="#10-5-1-类型属性语法" class="headerlink" title="10.5.1  类型属性语法"></a>10.5.1  类型属性语法</h3><blockquote>
<p><strong>说明：</strong>使用关键字static来定义类型属性。在为类定义计算型类型属性时，可以改用关键字class来支持子类对父类的实现进行重写</p>
</blockquote>
<table>
<thead>
<tr>
<th>定义类型属性的关键字</th>
<th>使用类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>static</code></td>
<td>值类型（结构体、枚举）</td>
</tr>
<tr>
<td><code>class</code></td>
<td>类</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SomeStructure</span> </span>&#123;</span><br><span class="line">    <span class="comment">//存储型类型属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> storedTypeProperty = <span class="string">"Some value"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算型类型属性（只读）</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> computedTypeProperty:<span class="type">Int</span>&#123;</span><br><span class="line">        <span class="comment">//这里返回一个int值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">SomeEnumeration</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> storedTypeProperty = <span class="string">"Some value"</span>  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">computedTypeProperty</span>:<span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-5-2-获取和设置类型属性的值"><a href="#10-5-2-获取和设置类型属性的值" class="headerlink" title="10.5.2  获取和设置类型属性的值"></a>10.5.2  获取和设置类型属性的值</h3><blockquote>
<p><strong>说明：</strong><code>类型名.类型属性</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AudioChannel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> thresholdLevel = <span class="number">10</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> maxInputLevelForAllChannels = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> currentLevel:<span class="type">Int</span> = <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> currentLevel &gt; <span class="type">AudioChannel</span>.thresholdLevel&#123;</span><br><span class="line">                <span class="comment">//将新电平值设置为阀值</span></span><br><span class="line">                currentLevel = <span class="type">AudioChannel</span>.thresholdLevel</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> currentLevel &gt; <span class="type">AudioChannel</span>.maxInputLevelForAllChannels&#123;</span><br><span class="line">                <span class="comment">//存储当前电平值作为新的最大输入电平</span></span><br><span class="line">                <span class="type">AudioChannel</span>.maxInputLevelForAllChannels = currentLevel</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> leftChannel = <span class="type">AudioChannel</span>()</span><br><span class="line"><span class="keyword">var</span> rightChannel = <span class="type">AudioChannel</span>()</span><br><span class="line"></span><br><span class="line">leftChannel.currentLevel = <span class="number">7</span></span><br><span class="line"><span class="built_in">println</span>(leftChannel.currentLevel)<span class="comment">//7</span></span><br><span class="line"><span class="built_in">println</span>(<span class="type">AudioChannel</span>.maxInputLevelForAllChannels)<span class="comment">//7</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_09  类和结构体/" itemprop="url">
                  9 类和结构体
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:44:57+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="9-1-类和结构体对比"><a href="#9-1-类和结构体对比" class="headerlink" title="9.1    类和结构体对比"></a>9.1    类和结构体对比</h2><blockquote>
<p><strong>背景:</strong></p>
<ol>
<li>不需要为自定义类和结构创建独立的接口和实现文件，系统会自动生成面向其它代码的外部接口  </li>
<li>类和结构体的关系比其它语言更加紧密  </li>
<li>结构体总是通过被复制的方式在代码中传递，因此请不要使用引用计数</li>
</ol>
</blockquote>
<h3 id="相同点"><a href="#相同点" class="headerlink" title="相同点"></a>相同点</h3><ol>
<li>定义属性用于存储值</li>
<li>定义方法用于提供功能</li>
<li>定义附属脚本用于访问值</li>
<li>定义构造器用于生成初始化值</li>
<li>通过扩展增加默认实现的功能</li>
<li>实现协议以提供某种标准功能</li>
</ol>
<h3 id="类比结构体多的附加功能"><a href="#类比结构体多的附加功能" class="headerlink" title="类比结构体多的附加功能"></a>类比结构体多的附加功能</h3><ol>
<li>继承允许一个类继承另一个类的特征</li>
<li>类型转换允许在运行时检查和解释一个类实例的类型</li>
<li>解构器允许一个类实例释放任何其所分配的资源</li>
<li>引用计数允许对一个类的多次引用</li>
</ol>
<h3 id="9-1-1-定义"><a href="#9-1-1-定义" class="headerlink" title="9.1.1    定义"></a>9.1.1    定义</h3><blockquote>
<p><strong>语法：</strong>类和结构体</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// class definition goes here</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SomeStructure</span> </span>&#123;</span><br><span class="line">    <span class="comment">// structure definition goes here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>命名风格</strong>：为了将<code>Swift</code>类型和其它标记的命名区分开，命名最好遵从一定规范</p>
<ol>
<li>类或结构体的命名必须符合Swift类型的大写命名风格（<code>UpperCamelCase</code>）</li>
<li>属性和方法命名要符合Swift类型的小写命名风格（<code>lowerCamelCase</code>）</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义一个结构体</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Resolution</span></span>&#123;</span><br><span class="line">    <span class="comment">//包含两个存储属性</span></span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> height = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VideoMode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> resolution = <span class="type">Resolution</span>()</span><br><span class="line">    <span class="keyword">var</span> interlaced = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> frameRate = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-1-2-类和结构体实例"><a href="#9-1-2-类和结构体实例" class="headerlink" title="9.1.2    类和结构体实例"></a>9.1.2    类和结构体实例</h3><blockquote>
<p><strong>最简单形式</strong>：<code>结构体或者类的类型名称()</code></p>
<ul>
<li>属性会被初始化为默认值</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> someResolution = <span class="type">Resolution</span>()<span class="comment">//创建结构体实例</span></span><br><span class="line"><span class="keyword">let</span> someVideoMode = <span class="type">VideoMode</span>()<span class="comment">//创建类实例</span></span><br></pre></td></tr></table></figure>
<h3 id="9-1-3-属性访问"><a href="#9-1-3-属性访问" class="headerlink" title="9.1.3    属性访问"></a>9.1.3    属性访问</h3><blockquote>
<p><strong>说明</strong>：点语法（dot syntax）<br><strong>注意</strong>：Swift允许直接设置结构体属性的<code>子属性</code>（不同于o-c）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="built_in">println</span>(<span class="string">"The width of someResolution is \(someResolution.width)"</span>)<span class="comment">//访问结构体实例的属性</span></span><br><span class="line">someVideoMode.resolution.width = <span class="number">1280</span><span class="comment">//为结构体的属性的字属性赋值</span></span><br><span class="line"><span class="built_in">println</span>(<span class="string">"The width of someVideoMode is now \(someVideoMode.resolution.width)"</span>)<span class="comment">//访问结构体属性的字属性</span></span><br></pre></td></tr></table></figure>
<h3 id="9-1-4-结构体类型的成员逐一构造器"><a href="#9-1-4-结构体类型的成员逐一构造器" class="headerlink" title="9.1.4        结构体类型的成员逐一构造器"></a>9.1.4        结构体类型的成员逐一构造器</h3><blockquote>
<p><strong>说明</strong>：结构体自动生成（类实例没有默认的成员逐一构造器）<br><strong>用途：</strong>始化新结构体实例中成员的属性<br><strong>调用</strong>：将结构体实例中<code>各个属性的初始值</code>，通过<code>属性的名称</code>传递到<code>成员逐一构造器</code>之中</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用逐一成员构造器</span></span><br><span class="line"><span class="keyword">let</span> vga = <span class="type">Resolution</span>(width: <span class="number">640</span>, height: <span class="number">480</span>);</span><br></pre></td></tr></table></figure>
<h2 id="9-2-结构体和枚举是值类型"><a href="#9-2-结构体和枚举是值类型" class="headerlink" title="9.2    结构体和枚举是值类型"></a>9.2    结构体和枚举是值类型</h2><blockquote>
<p><strong>值类型特点</strong>：值类型被<code>赋给一个常量(变量)</code>或者被<code>传递给一个函数</code>的时候，实际上操作的是其<code>副本</code>。<br><strong>扩展</strong>：所有<code>基本数据类型</code>在都是通过<code>结构体</code>来实现的。</p>
</blockquote>
<table>
<thead>
<tr>
<th>值类型</th>
<th>引用类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数(Integer)</td>
<td>类(Class)</td>
</tr>
<tr>
<td>浮点数(floating-point)</td>
<td></td>
</tr>
<tr>
<td>布尔值(Booleans)</td>
<td></td>
</tr>
<tr>
<td>字符串(string)</td>
<td></td>
</tr>
<tr>
<td>数组(array)</td>
<td></td>
</tr>
<tr>
<td>字典(directionaries)</td>
<td></td>
</tr>
<tr>
<td>结构体(struc)</td>
<td></td>
</tr>
<tr>
<td>枚举(enum)</td>
</tr>
</tbody>
</table>
<p>&gt;</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="comment">//结构体是值类型</span></span><br><span class="line"><span class="keyword">let</span> hd = <span class="type">Resolution</span>(width: <span class="number">1920</span>, height: <span class="number">1080</span>)</span><br><span class="line"><span class="keyword">var</span> cinema = hd</span><br><span class="line">cinema.width = <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println</span>(<span class="string">"cinema is now \(cinema.width) pixels wide"</span>)<span class="comment">//2048</span></span><br><span class="line"><span class="built_in">println</span>(<span class="string">"hd is still \(hd.width) pixels wide"</span>)<span class="comment">//1920</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//枚举类型也是值类型</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">CompassPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">North</span>, <span class="type">South</span>, <span class="type">East</span>, <span class="type">West</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> currentDirection = <span class="type">CompassPoint</span>.<span class="type">West</span></span><br><span class="line"><span class="keyword">let</span> rememberedDirection = currentDirection</span><br><span class="line">currentDirection = .<span class="type">East</span></span><br><span class="line"><span class="keyword">if</span> rememberedDirection == .<span class="type">West</span>&#123;<span class="comment">//拷贝赋值并不影响原始值</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"The remembered direction is still .West"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-3-类是引用类型"><a href="#9-3-类是引用类型" class="headerlink" title="9.3    类是引用类型"></a>9.3    类是引用类型</h2><blockquote>
<p><strong>说明：</strong>被赋予到一个变量、常量或者被传递到一个函数时，引用的是已存在的实例本身而不是其拷贝。<br><strong>注意</strong>：用类型的实例即使被声明为常量，成员的值依然可以改变，因为改变实例的内容并没有改变引用用本身（因为引用不过是个地址）。</p>
</blockquote>
<pre><code class="swift"><span class="comment">//创建类实例</span>
<span class="keyword">let</span> tenEighty = <span class="type">VideoMode</span>()
tenEighty.resolution = hd
tenEighty.interlaced = <span class="literal">true</span>
tenEighty.name = <span class="string">"1080i"</span>
tenEighty.frameRate = <span class="number">25.0</span>

<span class="keyword">let</span> alseTenEighty = tenEighty
alseTenEighty.frameRate = <span class="number">30.0</span>

<span class="built_in">println</span>(<span class="string">"The frameRate property of tenEighty is now \(tenEighty.frameRate)"</span>)
</code></pre>
<h3 id="9-3-1-恒等运算符"><a href="#9-3-1-恒等运算符" class="headerlink" title="9.3.1    恒等运算符"></a>9.3.1    恒等运算符</h3><blockquote>
<p><strong>说明：</strong><code>!===</code>、<code>===</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>区分</th>
<th>含义</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>===</code></td>
<td>恒等于</td>
<td>引用同一个类实例</td>
</tr>
<tr>
<td><code>==</code></td>
<td>等于</td>
<td>两个实例的值<code>相等</code>或<code>相同</code>（遵照设计者定义的评判标准）</td>
</tr>
</tbody>
</table>
<h3 id="9-3-2-指针"><a href="#9-3-2-指针" class="headerlink" title="9.3.2    指针"></a>9.3.2    指针</h3><blockquote>
<p><strong>说明：</strong>引用类似c中的指针（swift没有指针），区别于指针，引用的特点如下</p>
<ol>
<li>和其它常量或变量的定义方式相同</li>
<li>并不直接指向内存中的某个地址</li>
<li>不要求使用<code>*</code>来表明创建一个引用</li>
</ol>
</blockquote>
<h2 id="9-4-类和结构体的选择"><a href="#9-4-类和结构体的选择" class="headerlink" title="9.4    类和结构体的选择"></a>9.4    类和结构体的选择</h2><blockquote>
<p><strong>关键区别</strong>：结构体实例总是通过值传递，类实例总是通过引用传递。<br><strong>技巧</strong>：除非是以下情况，绝大多数自定义数据结构都应该该是类，而非结构体。</p>
<ul>
<li>封装少量相关简单数据值</li>
<li>封装的数据会被拷贝，而不是引用</li>
<li>属性会被拷贝而不是引用</li>
<li>不需要继承另一个已经存在的类型的属性或者行为</li>
</ul>
</blockquote>
<h2 id="9-5-集合类型的赋值与拷贝行为"><a href="#9-5-集合类型的赋值与拷贝行为" class="headerlink" title="9.5    集合类型的赋值与拷贝行为"></a>9.5    集合类型的赋值与拷贝行为</h2><blockquote>
<p><strong>集合类型：</strong><code>String</code>，<code>Array</code>和<code>Dictionary</code>（均以结构体的形式实现）<br><strong>说明</strong>：所有以结构体方式实现的数据类型在被赋值给常量（或变量）以及传入函数（或方法）中时，它们的值就会发生拷贝行为。<br><strong>注意</strong>：没必要避免拷贝来保证最有性能，因为在swift会进行相应优化：只有确有必要，实际的拷贝才会执行。<br><strong>扩展：</strong><code>Objective-C</code> 中<code>NSString</code>，<code>NSArray</code>和<code>NSDictionary</code>类型均以类的形式实现，而并非结构体。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">85</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
