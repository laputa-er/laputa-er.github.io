<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="js," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="1 选择符APISelectors API☑︎ 官方API：www.w3.org/TR/selectors-api☑︎ 用途：通过CSS选择符查询DOM文档取得元素的引用☑︎ 兼容性：IE8+ Firefox3.5+ Safari3.1+ Chrome Opera10+
1.1 querySelector()方法querySelector(cssSelector)：通过css选择符查询DOM节点☑">
<meta property="og:type" content="article">
<meta property="og:title" content="11 Dom扩展">
<meta property="og:url" content="http://laputa-er.github.io/2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="1 选择符APISelectors API☑︎ 官方API：www.w3.org/TR/selectors-api☑︎ 用途：通过CSS选择符查询DOM文档取得元素的引用☑︎ 兼容性：IE8+ Firefox3.5+ Safari3.1+ Chrome Opera10+
1.1 querySelector()方法querySelector(cssSelector)：通过css选择符查询DOM节点☑">
<meta property="og:updated_time" content="2017-04-18T08:13:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11 Dom扩展">
<meta name="twitter:description" content="1 选择符APISelectors API☑︎ 官方API：www.w3.org/TR/selectors-api☑︎ 用途：通过CSS选择符查询DOM文档取得元素的引用☑︎ 兼容性：IE8+ Firefox3.5+ Safari3.1+ Chrome Opera10+
1.1 querySelector()方法querySelector(cssSelector)：通过css选择符查询DOM节点☑">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/"/>

  <title> 11 Dom扩展 | Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?898688f51c5a3d6b37dd23e04441e5bd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                11 Dom扩展
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-11-08T21:20:29+08:00" content="2014-11-08">
              2014-11-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JS高级程序设计-第三版/" itemprop="url" rel="index">
                    <span itemprop="name">JS高级程序设计(第三版)</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="1-选择符API"><a href="#1-选择符API" class="headerlink" title="1 选择符API"></a>1 选择符API</h1><p><strong>Selectors API</strong><br>☑︎ 官方API：www.w3.org/TR/selectors-api<br>☑︎ 用途：通过CSS选择符查询DOM文档取得元素的引用<br>☑︎ 兼容性：<code>IE8+</code> <code>Firefox3.5+</code> <code>Safari3.1+</code> <code>Chrome</code> <code>Opera10+</code></p>
<h2 id="1-1-querySelector-方法"><a href="#1-1-querySelector-方法" class="headerlink" title="1.1 querySelector()方法"></a>1.1 querySelector()方法</h2><p><strong>querySelector(cssSelector)</strong>：通过css选择符查询DOM节点<br>☑︎ 参数：CSS选择符<br>☑︎ 返回值：返回与该模式匹配的第一个元素，如果没有匹配的元素，返回null</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取得body元素</span></span><br><span class="line"><span class="keyword">var</span> body = <span class="built_in">document</span>.querySelector(<span class="string">"body"</span>);</span><br><span class="line"><span class="comment">//取得ID为"myDiv"的元素</span></span><br><span class="line"><span class="keyword">var</span> myDiv = <span class="built_in">document</span>.querySelector(<span class="string">"#myDiv"</span>);</span><br><span class="line"><span class="comment">//取得类为"button"的第一个图像元素</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.body.querySelector(<span class="string">"img.button"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="1-2-querySelectorAll-方法"><a href="#1-2-querySelectorAll-方法" class="headerlink" title="1.2 querySelectorAll()方法"></a>1.2 querySelectorAll()方法</h2><p><strong>querySelectorAll(cssSelector)</strong>：通过css选择符查询包含所有匹配的DOM节点的NodeList对象<br>☑︎ 参数：CSS选择符<br>☑︎ 返回值：NodeList对象（快照而非动态查询），如果没有匹配的元素，NodeList就是空的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取得某&lt;div&gt;中的所有&lt;em&gt;元素（类似于getElementByTagName("em")）</span></span><br><span class="line"><span class="keyword">var</span> ems = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>).querySelectorAll(<span class="string">"em"</span>);</span><br><span class="line"><span class="comment">//取得类为"selected"的所有元素</span></span><br><span class="line"><span class="keyword">var</span> selecteds = <span class="built_in">document</span>.querySelectorAll(<span class="string">".selected"</span>);</span><br><span class="line"><span class="comment">//取得所有&lt;p&gt;元素中的所有&lt;strong&gt;元素</span></span><br><span class="line"><span class="keyword">var</span> strongs = <span class="built_in">document</span>.querySelectorAll(<span class="string">".p strong"</span>);</span><br><span class="line"><span class="keyword">var</span> i, len, strong;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>,len=strongs.length; i &lt; len; i++)&#123;</span><br><span class="line">  strong = strong[i]; <span class="comment">//或者strings.item[i]</span></span><br><span class="line">  strong.className = <span class="string">"important"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-matchesSelector-方法"><a href="#1-3-matchesSelector-方法" class="headerlink" title="1.3 matchesSelector()方法"></a>1.3 matchesSelector()方法</h2><p><strong>matchsSelector(cssSelector)</strong>：检测调用元素与指定css选择符是否匹配<br>☑︎ 参数：css选择符<br>☑︎ 返回值：如果匹配返回true；否则返回false<br>☑︎ 来源：Selector API Level 2<br>☑︎ 兼容性：2011年中还没有浏览器实现，但有一些实验性实现</p>
<table>
<thead>
<tr>
<th>浏览器</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE9+</td>
<td>msMatchesSelector()</td>
</tr>
<tr>
<td>Firefox3.6+</td>
<td>mozMatchesSelector()</td>
</tr>
<tr>
<td>Chrome、Safari5+</td>
<td>webkitMatchesSelector()</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matchesSelector</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (element.matchesSelector) &#123;</span><br><span class="line">    <span class="keyword">return</span> element.matchesSelector(selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (element.msMatchesSelector) &#123;</span><br><span class="line">    <span class="keyword">return</span> element.msMatchesSelector(selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (element.mozMatchesSelector) &#123;</span><br><span class="line">    <span class="keyword">return</span> element.mozMatchesSelector(selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (element.webkitMatchesSelector) &#123;</span><br><span class="line">    <span class="keyword">return</span> element.webkitMatchesSelector(selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Not supported.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (matchesSelector(<span class="built_in">document</span>.body, <span class="string">'body.page1'</span>)) &#123;</span><br><span class="line">  <span class="comment">// 执行操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-元素遍历"><a href="#2-元素遍历" class="headerlink" title="2 元素遍历"></a>2 元素遍历</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">背景：浏览器旧的 API 处理元素间的空格存在差异</span><br><span class="line">☑︎ IE9- 不会将元素间的空格作为文本节点返回；</span><br><span class="line">☑︎ 其它所有浏览器都会将空格作为返回文本节点。</span><br></pre></td></tr></table></figure>
<p>Element Traversal API 为 DOM 元素添加了以下 5 个属性</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>对应的旧属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>childElementCount</td>
<td>返回子元素（不包括文本节点和注释）的个数</td>
<td>无</td>
</tr>
<tr>
<td>firstElementChild</td>
<td>指向第一个子元素</td>
<td>firstChild</td>
</tr>
<tr>
<td>lastElementChild</td>
<td>指向最后一个子元素</td>
<td>lastChild</td>
</tr>
<tr>
<td>previousElementSibling</td>
<td>指向前一个同辈元素</td>
<td>previousSibling</td>
</tr>
<tr>
<td>nextElementSibling</td>
<td>指向后一个同辈元素</td>
<td>nextSibling</td>
</tr>
</tbody>
</table>
<p>☑︎ 兼容性: <code>IE 9+</code> <code>Firefox 3.5+</code> <code>Safari 4+</code> <code>Chrome</code> <code>Opera 10+</code> </p>
<p><strong>遍历子元素（使用旧 API）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i,</span><br><span class="line">    len,</span><br><span class="line">    child = element.firstChild</span><br><span class="line"><span class="keyword">while</span> (child != element.lastChild) &#123;</span><br><span class="line">  <span class="comment">// 检查是不是元素</span></span><br><span class="line">  <span class="keyword">if</span> (child.nodeType == <span class="number">1</span>) &#123;</span><br><span class="line">    processChild(child)</span><br><span class="line">  &#125;</span><br><span class="line">  child = child.nextSibling</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>遍历子元素（使用新增 API）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i,</span><br><span class="line">    len,</span><br><span class="line">    child = element.firstElementChild</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (child != element.lastElementChild) &#123;</span><br><span class="line">  processChild(child) <span class="comment">// 已知其是元素</span></span><br><span class="line">  child = child.nextElementSibling</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-HTML-5"><a href="#3-HTML-5" class="headerlink" title="3 HTML 5"></a>3 HTML 5</h1><h2 id="3-1-与类相关的扩展"><a href="#3-1-与类相关的扩展" class="headerlink" title="3.1 与类相关的扩展"></a>3.1 与类相关的扩展</h2><h3 id="getElementsByClassName-方法"><a href="#getElementsByClassName-方法" class="headerlink" title="getElementsByClassName() 方法"></a>getElementsByClassName() 方法</h3><p>☑︎ 调用：包括 document 对象在内的所有 HTML 元素都可以调用。</p>
<p>☑︎ 参数：一个包含一或多个 class 名的字符串，传入多个类名时，类型的先后顺序不重要。</p>
<p>☑︎ 返回：带有指定  class 名的所有元素的 NodeList。</p>
<p>☑︎ 兼容性：<code>IE9+</code> <code>Firefox3+</code> <code>Safari3.1+</code> <code>Chrome</code> <code>Opera9.5+</code></p>
<p>☑︎ 价值：可以更方便地为带有某些类的元素添加事件处理程序，不在局限于使用 ID 或标签名。</p>
<figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 取得所有类中包含 <span class="string">'username'</span> 和 <span class="string">'current'</span> 的元素，类名的先后顺序无所谓</span><br><span class="line"><span class="keyword">var</span> allCurrentUsernames = document.getElementsByClassName(<span class="string">'username current'</span>)</span><br><span class="line"></span><br><span class="line">// 取得 ID 为 <span class="string">'myDiv'</span> 的元素中带有类名 <span class="string">'selected'</span> 的所有元素</span><br><span class="line"><span class="keyword">var</span> selected = document.getElementById(<span class="string">'myDiv'</span>).getElementsByClassName(<span class="string">'selected'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="classList-属性"><a href="#classList-属性" class="headerlink" title="classList 属性"></a>classList 属性</h3><p>该属性是新集合类型 <code>DOMTokenList</code> 的实例。</p>
<table>
<thead>
<tr>
<th>DOMTokenList 实例的属性和方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>length</td>
<td>包含元素的个数</td>
</tr>
<tr>
<td>add(value)</td>
<td>将给定的字符串值添加到列表中。如果值已经存在了，就不添加了。</td>
</tr>
<tr>
<td>contains(value)</td>
<td>表示列表中是否存在给定的值，如果存在则返回 true，否则返回 false。</td>
</tr>
<tr>
<td>remove(value)</td>
<td>从列表中删除给定的字符串</td>
</tr>
<tr>
<td>toggle(value)</td>
<td>如果列表中已经存在给定的值，删除它；否则，添加它。</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除 'disabled' 类</span></span><br><span class="line">div.classList.remove(<span class="string">'disabled'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加 'current' 类</span></span><br><span class="line">div.classList.add(<span class="string">'current'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换 'user' 类</span></span><br><span class="line">div.classList.toggle(<span class="string">'user'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定元素中是否包含既定的类名</span></span><br><span class="line"><span class="keyword">if</span> (div.classList.contains(<span class="string">'bd'</span>) &amp;&amp; !div.classList.contains(<span class="string">'disabled'</span>)) &#123;</span><br><span class="line">  <span class="comment">// 执行操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代类名</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = div.classList.length; i &lt; len; i++) &#123;</span><br><span class="line">  doSomething(div.classList[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>删除类名</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bd user disabled"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>旧的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除 'user' 类</span></span><br><span class="line"><span class="comment">// 首先，取得类名字符串并拆成数组</span></span><br><span class="line"><span class="keyword">var</span> classNames = div.className.split(<span class="regexp">/\s+/</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到要删除的类名</span></span><br><span class="line"><span class="keyword">var</span> pos = <span class="number">-1</span>,</span><br><span class="line">    i,</span><br><span class="line">    len</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>, len = classNames.length; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (classNames[i] == <span class="string">'user'</span>) &#123;</span><br><span class="line">    pos = <span class="number">1</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除类名</span></span><br><span class="line">classNames.splice(i, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把剩下的类名拼成字符串并重新设置</span></span><br><span class="line">div.className = classNames.join(<span class="string">' '</span>)</span><br></pre></td></tr></table></figure>
<p>新的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.classList,remove(<span class="string">'user'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="3-2-焦点管理"><a href="#3-2-焦点管理" class="headerlink" title="3.2 焦点管理"></a>3.2 焦点管理</h2><h3 id="document-activeElement-属性"><a href="#document-activeElement-属性" class="headerlink" title="document.activeElement 属性"></a>document.activeElement 属性</h3><p>☑︎ 读：这个属性始终会引用 DOM 中当前获得了焦点的元素。</p>
<p>☑︎ 用途：查询文档是否获得了焦点，以及确定文档是否获得了焦点，这两个功能是最重要的用途是提供 Web 应用的无障碍性。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">元素获得焦点的方式</span><br><span class="line">☑︎ 页面加载（文档加载期间，<span class="built_in">document</span>.activeElement 为 <span class="literal">null</span>；文档加载完成时，<span class="built_in">document</span>.activeElement 中保存的是 <span class="built_in">document</span>.body）</span><br><span class="line">☑︎ 用户输入（通常是通过按 Tab 键）</span><br><span class="line">☑︎ 在代码中调用 focus() 方法</span><br></pre></td></tr></table></figure>
<p>☑︎ 兼容性：<code>IE4+</code> <code>Firefox3+</code> <code>Safari4+</code> <code>Chrome</code> 和 <code>Opera8+</code></p>
<h2 id="3-3-HTMLDocument-的变化"><a href="#3-3-HTMLDocument-的变化" class="headerlink" title="3.3 HTMLDocument 的变化"></a>3.3 HTMLDocument 的变化</h2><h3 id="document-readState"><a href="#document-readState" class="headerlink" title="document.readState"></a>document.readState</h3><p>☑︎ 读： <code>loading</code>  正在加载文档，<code>complete</code> 已经加载完文档</p>
<p>☑︎ 用途：通过它来实现一个指示文档已经加载完成的指示器。</p>
<p>☑︎ 价值：在这个属性得到广泛支持之前，要实现这样一个指示器，必须借助 <code>onload</code> 时间处理程序设置一个标签，表明文档已经加载完毕。</p>
<p>☑︎ 兼容性：<code>IE4+</code> <code>Firefox3.6+</code> <code>Safari</code> <code>Chrome</code> <code>Opera9+</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.readyState == <span class="string">'complete'</span>) &#123;</span><br><span class="line">  <span class="comment">// 执行操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="document-compatMode"><a href="#document-compatMode" class="headerlink" title="document.compatMode"></a>document.compatMode</h3><p>☑︎ 读：<code>CSS1Compat</code> 标准模式，<code>BackCompat</code> 混杂模式。</p>
<p>☑︎ 用途：自从 IE6 开始区分渲染页面的模式是标准还是混杂的，检测页面的兼容模式就称为浏览器的必要功能。</p>
<p>☑︎ 兼容性：<code>IE6+</code> <code>Firefox</code> <code>Safari3.1+</code> <code>Opera</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.compatMode == <span class="string">'CSS1Compat'</span>) &#123;</span><br><span class="line">  alert(<span class="string">'Standards mode'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  alert(<span class="string">'Quirks mode'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="document-head"><a href="#document-head" class="headerlink" title="document.head"></a>document.head</h3><p>☑︎ 读：引用文档的 <code>&lt;head&gt;</code> 元素</p>
<p>☑︎ 兼容性：<code>Chrome</code> <code>Safari5</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> head = <span class="built_in">document</span>.head || <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h2 id="3-4-字符集属性"><a href="#3-4-字符集属性" class="headerlink" title="3.4 字符集属性"></a>3.4 字符集属性</h2><h4 id="document-charset"><a href="#document-charset" class="headerlink" title="document.charset"></a>document.charset</h4><p>☑︎ 读：文档中实际使用的字符集，默认 <code>UTF-16</code></p>
<p>☑︎ 写：指定新字符集。</p>
<p>☑︎ 兼容性：<code>IE</code> <code>Firefox</code> <code>Safari</code> <code>Opera</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="built_in">document</span>.charset) <span class="comment">// 'UTF-16'</span></span><br><span class="line"><span class="built_in">document</span>.charset = <span class="string">'UTF-8'</span></span><br></pre></td></tr></table></figure>
<h4 id="document-defaultCharset"><a href="#document-defaultCharset" class="headerlink" title="document.defaultCharset"></a>document.defaultCharset</h4><p><code>只读</code></p>
<p>☑︎ 读：根据默认浏览器及操作系统的设置，当前文档默认的字符集应该是什么。</p>
<p>☑︎ 兼容性：<code>IE</code> <code>Safari</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查是否没有使用默认字符集</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.charset != <span class="built_in">document</span>.defaultCharset) &#123;</span><br><span class="line">  alert(<span class="string">'Custom character set being used.'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-自定义数据属性"><a href="#3-5-自定义数据属性" class="headerlink" title="3.5 自定义数据属性"></a>3.5 自定义数据属性</h2><h3 id="element-dataset"><a href="#element-dataset" class="headerlink" title="element.dataset"></a>element.dataset</h3><p>☑︎ 类型： <code>DOMStringMap</code></p>
<p>☑︎ 读：保存着元素上每个 <code>data-自定义属性名</code> 键值对的映射。</p>
<p>☑︎ 用途：如果需要给元素添加一些已不见的数据以便进行其他处理，那就咬用到自定义属性。</p>
<p>☑︎ 兼容性：<code>Firefox6+</code> <code>Chrome</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span> <span class="attr">data-appId</span> = <span class="string">"12345"</span> <span class="attr">data-myname</span>=<span class="string">"sean"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>div&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本例中使用的方法仅用于演示</span></span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取得自定义属性的值</span></span><br><span class="line"><span class="keyword">var</span> appId = div.dataset.appId</span><br><span class="line"><span class="keyword">var</span> myName = div.dataset.myname</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置值</span></span><br><span class="line">div.dataset.appId = <span class="number">23456</span></span><br><span class="line">div.dataset.myname = <span class="string">'Michael'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有没有 'myname' 值呢？</span></span><br><span class="line"><span class="keyword">if</span> (div.dataset.myname) &#123;</span><br><span class="line">  alert(<span class="string">'Hello, '</span> + div.dataset.myname)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-6-插入标记"><a href="#3-6-插入标记" class="headerlink" title="3.6 插入标记"></a>3.6 插入标记</h2><p>一般来说，在插入大量新 HTML 标记时，用 <code>inserHTML</code>、<code>outerHTML</code>、<code>insertAdjacentHTML()</code> 比通过多次 DOM 操作先创建节点再插入的方式效率要高很多。</p>
<h3 id="3-6-1-element-innerHTML"><a href="#3-6-1-element-innerHTML" class="headerlink" title="3.6.1 element.innerHTML"></a>3.6.1 element.innerHTML</h3><p>☑︎ 读：与调用元素的所有子节点（包括元素、注释和文本节点）对应的 HTML 标记。</p>
<p>☑︎ 写：根据指定的值创建新的 DOM 树，然后用这个 DOM 树完全替换调用元素原先的所有子节点。如果设置的值仅仅是文本而没有 HTML 标签，那么结果就是设置纯文本。<br>☑︎ 行为差异：不要指望所有浏览器返回的 innerHTML 值完全相同</p>
<table>
<thead>
<tr>
<th>浏览器</th>
<th>innerHTML</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE、Opera</td>
<td>将所有标签转换为大写形式</td>
</tr>
<tr>
<td>Safari、Chrome、Firefox</td>
<td>原原本本地按照文档中的格式返回 HTML，包括空格和缩进</td>
</tr>
</tbody>
</table>
<p><strong>读</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is <span class="tag">&lt;<span class="name">strong</span>&gt;</span>paragragph<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> with a list following it.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> content = <span class="built_in">document</span>.getElementById(<span class="string">'content'</span>)</span><br><span class="line">content.innerHTML</span><br><span class="line"><span class="comment">// &lt;p&gt;This is &lt;strong&gt;paragragph&lt;/strong&gt; with a list following it.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">// &lt;ul&gt;</span></span><br><span class="line"><span class="comment">//  &lt;li&gt;Item 1&lt;/li&gt;</span></span><br><span class="line"><span class="comment">//  &lt;li&gt;Item 2&lt;/li&gt;</span></span><br><span class="line"><span class="comment">//  &lt;li&gt;Item 3&lt;/li&gt;</span></span><br><span class="line"><span class="comment">// &lt;/ul&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>写</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.innerHTML = <span class="string">'Hello &amp; welcome, &lt;b&gt;\"reader\"!&lt;/b&gt;'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span>Hello &amp;amp; welcome, <span class="tag">&lt;<span class="name">b</span>&gt;</span>&amp;quot;reader&amp;quot;!<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-限制"><a href="#1-限制" class="headerlink" title="(1) 限制"></a>(1) 限制</h4><p><strong>插入 script 标签</strong></p>
<p>这时，除了 IE8- 在一些条件下会执行 <code>&lt;script&gt;</code>中的脚本外，其它浏览器并不会。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iE8- 执行通过 innerHTML 插入的 <span class="keyword">script </span>标签中的脚本的条件：</span><br><span class="line">☑︎ 必须为 <span class="keyword">script </span>标签指定 defer 属性</span><br><span class="line">☑︎ <span class="keyword">script </span>元素必须位于 <span class="keyword">scoped </span>element 之后(如果不满足该条件，却存在 <span class="keyword">script </span>标签，全部字符串都将无效，替代以插入一个空字符串)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* IE8- 中需要特殊处理*/</span> </span><br><span class="line"><span class="comment">// 不满足条件的情况</span></span><br><span class="line">div.innerHTML = <span class="string">'&lt;script defer&gt;alert('</span>hi<span class="string">');&lt;/script&gt;'</span> <span class="comment">// 插入 ''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 满足条件的情况(脚本执行后需要删除前面的 scoped element)</span></span><br><span class="line">div.innerHTML = <span class="string">'_&lt;script defer&gt;alert('</span>hi<span class="string">');&lt;/script&gt;'</span></span><br><span class="line">div.innerHTML = <span class="string">'&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;script defer&gt;alert('</span>hi<span class="string">');&lt;/script&gt;'</span> <span class="comment">// 空 div 无法生成 element scoped，因此需要加点儿内容</span></span><br><span class="line">div.innerHTML = <span class="string">'&lt;input type="hidden"&gt;&lt;script defer&gt;alert('</span>hi<span class="string">');&lt;/script&gt;'</span> <span class="comment">// 推荐</span></span><br></pre></td></tr></table></figure>
<p><strong>插入 style 标签</strong></p>
<p>和 script 不同的是，除了 IE8- ，所有浏览器都能正确插入 style 标签且正常工作。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IE8- 中插入 <span class="built_in">style</span> 标签生效的必要条件和插入 script 标签的需要满足的第二个条件类似，即</span><br><span class="line">☑︎ <span class="built_in">style</span> 元素必须位于 scoped element 之后(如果不满足该条件，却存在 <span class="built_in">style</span> 标签，全部字符串都将无效，替代以插入一个空字符串)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* IE8- 中需要特殊处理*/</span></span><br><span class="line"><span class="comment">// 错误的情况</span></span><br><span class="line">div.innerHTML = <span class="string">'&lt;style type="text/css"&gt;body &#123; background-color: red; &#125;&lt;/style&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的情况</span></span><br><span class="line">div.innerHTML = <span class="string">'_&lt;style type="text/css"&gt;body &#123; background-color: red; &#125;&lt;/style&gt;'</span></span><br><span class="line">div.removeChild(div.firstChild)</span><br></pre></td></tr></table></figure>
<p><strong>不支持 innerHTML 属性的标签</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">☑︎ col</span><br><span class="line">☑︎ colgroup</span><br><span class="line">☑︎ frameset</span><br><span class="line">☑︎ head</span><br><span class="line">☑︎ <span class="selector-tag">html</span></span><br><span class="line">☑︎ style</span><br><span class="line">☑︎ <span class="selector-tag">table</span></span><br><span class="line">☑︎ <span class="selector-tag">tbody</span></span><br><span class="line">☑︎ <span class="selector-tag">thead</span></span><br><span class="line">☑︎ <span class="selector-tag">tfoot</span></span><br><span class="line">☑︎ <span class="selector-tag">tr</span></span><br><span class="line">☑︎ title(IE8-)</span><br></pre></td></tr></table></figure>
<p><strong>在 XHTML 文档中 Firefox 的限制</strong></p>
<p>Firefox 对在内容类型为<code>application/xhtml+xml</code> 的 XHTML 文档中设置 <code>innerHTML</code>有严格的限制。在 XHTML 文档中使用 innerHTML 时，XHTML 代码必须完全符合要求。如果代码格式不正确，设置 innerHTML 将会静默的失败。</p>
<h4 id="2-window-toStaticHTML"><a href="#2-window-toStaticHTML" class="headerlink" title="(2) window.toStaticHTML()"></a>(2) window.toStaticHTML()</h4><p>☑︎ 用途：对字符串进行无害化处理。</p>
<p>☑︎ 参数：一个 HTML 字符串。</p>
<p>☑︎ 返回值：一个经过无害化处理的字符串，即从源 HTML 中删除所有脚本节点(<code>&lt;script&gt;</code> 和 <code>&lt;style&gt;</code>)和事件处理程序属性。</p>
<p>☑︎ 兼容性：<code>IE8</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="string">'&lt;a href="#" onclick="alert(\'hi\')"&gt;Click Me&lt;/a&gt;'</span></span><br><span class="line"><span class="keyword">var</span> sanitized = <span class="built_in">window</span>.toStaticHTML(text) <span class="comment">// IE8 only</span></span><br><span class="line">alert(sanitized) <span class="comment">// &lt;a href="#"&gt;Click Me&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-element-outerHTML"><a href="#3-6-2-element-outerHTML" class="headerlink" title="3.6.2 element.outerHTML"></a>3.6.2 element.outerHTML</h3><p>☑︎ 读：调用它的元素及所有子节点的 HTML 标签。</p>
<p>☑︎ 写：根据指定的 HTML 字符串创建新的 DOM 子树，然后用这个 DOM 子树完全替换调用元素。</p>
<p>☑︎ 兼容性：<code>IE4+</code> <code>Safari4+</code> <code>Chrome</code> <code>Opera8+</code> <code>Firefox8+</code></p>
<p>☑︎ 行为差异：和 innerHTML 性质一样。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.outerHTML = <span class="string">'&lt;p&gt;This is a paragraph.&lt;/p&gt;'</span></span><br></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>)</span><br><span class="line">p.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">'This is a paragraph.'</span>))</span><br><span class="line">div.parentNode.replaceChild(p, div)</span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-element-insertAdjacentHTML"><a href="#3-6-3-element-insertAdjacentHTML" class="headerlink" title="3.6.3 element.insertAdjacentHTML()"></a>3.6.3 element.insertAdjacentHTML()</h3><p>☑︎ 用途：在特定的位置插入 HTML 字串儿。</p>
<p>☑︎ 参数1: 表示插入位置的字符串</p>
<table>
<thead>
<tr>
<th>参数1值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>beforebegin</td>
<td>在当前元素之前插入一个紧邻的同辈元素</td>
</tr>
<tr>
<td>afterbegin</td>
<td>在当前元素之前插入一个紧邻的同辈元素</td>
</tr>
<tr>
<td>beforeend</td>
<td>在当前元素之下插入一个新的子元素或在最后一个子元素之后再插入新的子元素</td>
</tr>
<tr>
<td>afterend</td>
<td>在当前元素之后掺入一个紧邻的同辈元素</td>
</tr>
</tbody>
</table>
<p>☑︎ 参数2: 要插入的 HTML 文本（如果无法解析会抛出错误）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 作为前一个同辈元素插入</span></span><br><span class="line">element.insertAdjacentHTML(<span class="string">'beforebegin'</span>, <span class="string">"&lt;p&gt;Hello World!&lt;/p&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为第一个子元素插入</span></span><br><span class="line">element.insertAdjacentHTML(<span class="string">'afterbegin'</span>, <span class="string">"&lt;p&gt;Hello World!&lt;/p&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为最后一个子元素插入</span></span><br><span class="line">element.insertAdjacentHTML(<span class="string">'beforeend'</span>, <span class="string">"&lt;p&gt;Hello World!&lt;/p&gt;"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为后一个同辈元素插入</span></span><br><span class="line">element.insertAdjacentHTML(<span class="string">'afterend'</span>, <span class="string">"&lt;p&gt;Hello World!&lt;/p&gt;"</span>)</span><br></pre></td></tr></table></figure>
<p>☑︎ 兼容性：<code>IE</code> <code>Firefox8+</code> <code>Safari</code> <code>Opera</code> <code>Chrome</code></p>
<h3 id="3-6-4-内存与性能问题"><a href="#3-6-4-内存与性能问题" class="headerlink" title="3.6.4 内存与性能问题"></a>3.6.4 内存与性能问题</h3><p>说明：假设某个元素有一个事件处理程序或者引用了一个 JavaScript 对象作为属性，在使用 <code>innerHTML</code>、 <code>outerHTMl</code>、 <code>inserAdjacentHTML()</code> 方式将该元素从文档树中删除后，元素与时间处理程序或 JavaScript 对象之间的绑定关系在内存中并不一定会被删除。</p>
<p><strong>建议</strong></p>
<p>☑︎ 在使用 <code>innerHTML</code>、<code>outerHTML</code>、<code>insertAdjacentHTML()</code> 时，最好先收工删除要被替换的元素的所有时间处理程序和 JavaScript 对象属性。</p>
<p>☑︎ 虽然使用前面提到的方式会创建 HTML 解析器，相比直接操作 DOM 效率更高。但创建和销毁 HTML 解析器也会带来性能损失，因此最好的做法是单独构建字符串，然后再一次性地将结果字符串赋值给 innerHTML。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> itemsHTML = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = values.length; i &lt; len; i++) &#123;</span><br><span class="line">  itemsHtml += <span class="string">'&lt;li&gt;'</span> + values[i] + <span class="string">'&lt;/i&gt;'</span></span><br><span class="line">&#125;</span><br><span class="line">ul.innerHTML = itemsHtml</span><br></pre></td></tr></table></figure>
<h2 id="3-7-element-scrollIntoView"><a href="#3-7-element-scrollIntoView" class="headerlink" title="3.7 element.scrollIntoView()"></a>3.7 element.scrollIntoView()</h2><p>☑︎ 用途：通过滚动浏览器窗口或某个容器元素，调用元素就可以出现在视口中。</p>
<p>☑︎ 参数：true(默认) 窗口滚动之后会让调用元素的顶部与视口顶部尽可能平齐，false 调用元素会尽可能全部出现在视口中（可能的话会与适口顶部平齐）。</p>
<p>☑︎ 兼容性：<code>IE</code> <code>Firefox</code> <code>Safari</code> <code>Opera</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">document</span><span class="selector-class">.forms</span><span class="selector-attr">[0]</span><span class="selector-class">.scrollIntoView</span>()</span><br></pre></td></tr></table></figure>
<h1 id="4-专用扩展"><a href="#4-专用扩展" class="headerlink" title="4 专用扩展"></a>4 专用扩展</h1><h2 id="4-1-文档模式"><a href="#4-1-文档模式" class="headerlink" title="4.1 文档模式"></a>4.1 文档模式</h2><p><strong>说明</strong>：<code>文档模式</code> 决定了可以使用什么功能</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">☑︎ 可以使用哪个级别的 <span class="type">CSS</span></span><br><span class="line">☑︎ 可以在 <span class="type">JavaScript</span> 中使用哪些 <span class="type">API</span></span><br><span class="line">☑︎ 如何对待文档类型(doc<span class="keyword">type</span>)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>4种文档模式</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE5</td>
<td>混杂模式</td>
<td>IE8+ 中的新功能都无法使用。</td>
</tr>
<tr>
<td>IE7</td>
<td>IE7 标准模型</td>
<td>IE8+ 的新功能无法使用。</td>
</tr>
<tr>
<td>IE8</td>
<td>IE8 标准模式</td>
<td>IE8+ 中的新功能(Selectors API、更多 CSS2 级选择符和某些 CSS3 功能，还有一些 HTML5 的功能)可以使用；IE9 中的新功能无法使用。</td>
</tr>
<tr>
<td>IE9</td>
<td>IE9 标准模式</td>
<td>IE9 中的新功能(ECMAScript5、完整的 CSS3、更多 HTML5 功能)都可以使用。</td>
</tr>
</tbody>
</table>
<p>☑︎ 兼容性：<code>IE8+</code></p>
<p>☑︎ 默认文档模式：浏览器会通过文档类型声明来确定是使用最佳的可用文档模式，还是使用混杂模式。</p>
<h3 id="设置浏览器的渲染模式"><a href="#设置浏览器的渲染模式" class="headerlink" title="设置浏览器的渲染模式"></a>设置浏览器的渲染模式</h3><p><strong>有两种方式：</strong></p>
<p>☑︎ 使用 HTTP 头部信息 <code>X-UA-Compatible</code> </p>
<p>☑︎ 设置 <code>&lt;meta&gt;</code> 标签: <code>&lt;meta http-equiv=&quot;X_UA_Compatible&quot; content=&quot;IE=IEVersion&quot;&gt;</code></p>
<table>
<thead>
<tr>
<th>IEVersion</th>
<th>文档模式</th>
<th>文档模式（如果有文档类型声明）</th>
</tr>
</thead>
<tbody>
<tr>
<td>Edge</td>
<td>最新的文档模式</td>
<td>忽略</td>
</tr>
<tr>
<td>EmulateIE9</td>
<td>IE5</td>
<td>IE9</td>
</tr>
<tr>
<td>EmulateIE8</td>
<td>IE5</td>
<td>IE8</td>
</tr>
<tr>
<td>EmulateIE7</td>
<td>IE5</td>
<td>IE7</td>
</tr>
<tr>
<td>9</td>
<td>IE9</td>
<td>忽略</td>
</tr>
<tr>
<td>8</td>
<td>IE8</td>
<td>忽略</td>
</tr>
<tr>
<td>7</td>
<td>IE7</td>
<td>忽略</td>
</tr>
<tr>
<td>5</td>
<td>IE5</td>
<td>忽略</td>
</tr>
</tbody>
</table>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 让文档模式像在 IE7 中一样 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X_UA_Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=EmulateIE7"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 不打算考虑文档类型声明，直接使用 IE7 标准模式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X_UA_Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=EmulateIE7"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="读取当前页面的文档模式"><a href="#读取当前页面的文档模式" class="headerlink" title="读取当前页面的文档模式"></a>读取当前页面的文档模式</h3><p><strong>document.documentMode</strong></p>
<p><code>只读</code></p>
<p>☑︎ 读：当前页面使用的是什么文档模式(IE8 返回文档模式字串，IE9 返回 5、7、8、9)。</p>
<p>☑︎ 兼容性：<code>IE8+</code></p>
<p>☑︎ 价值：知道页面采用的是什么文档模式，有助于理解页面的行为方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mode = <span class="built_in">document</span>.documentMode</span><br></pre></td></tr></table></figure>
<h2 id="4-2-element-children"><a href="#4-2-element-children" class="headerlink" title="4.2 element.children"></a>4.2 element.children</h2><p><code>只读</code></p>
<p><strong>说明：</strong>由于 IE8- 与其它浏览器在处理文本节点中的空白符时有差异，因此就出现了 children 属性。除了只包含 <code>Element</code> 类型的子节点外，和 <code>element.childNodes</code> 没有区别。</p>
<p>☑︎ 类型：<code>HTMLCollection</code></p>
<p>☑︎ 读：所有 <code>Element</code> 类型的子节点</p>
<p>☑︎ 兼容性：<code>IE8-(会包含注释节点)</code> <code>IE9</code>  <code>Firefox3.5</code> <code>Safari2(有 BUG)</code> <code>Safari3</code> <code>Opera8</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> childCount = element.children.length</span><br><span class="line"><span class="keyword">var</span> firstChild = element.children[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h2 id="4-3-element-contains"><a href="#4-3-element-contains" class="headerlink" title="4.3 element.contains()"></a>4.3 element.contains()</h2><p>☑︎ 参数：要检测的后代节点。</p>
<p>☑︎ 返回值：true 被检测的节点是后代节点，false 被检测的节点不是后代节点</p>
<p>☑︎ 价值：不通过早 DOM 文档树中查找即可获得这个信息。</p>
<p>☑︎ 兼容性：<code>IE</code> <code>Firefox9+</code> <code>Safari</code> <code>Opera</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试 body 是不是 html 的后代</span></span><br><span class="line">alert(<span class="built_in">document</span>.documentElement.contains(<span class="built_in">document</span>.body)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong></p>
<hr>
<h3 id="element-compareDocumentPosition"><a href="#element-compareDocumentPosition" class="headerlink" title="element.compareDocumentPosition()"></a>element.compareDocumentPosition()</h3><p><code>DOM Level 3</code></p>
<p>☑︎ 用途：确定节点之间的关系。</p>
<p>☑︎ 参数：要检测的节点</p>
<p>☑︎ 返回：一个表示该关系的位掩码(bitmask)</p>
<table>
<thead>
<tr>
<th>掩码</th>
<th>节点关系</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>无关（给定的节点不在当前文档中）</td>
</tr>
<tr>
<td>2</td>
<td>居前（给定的节点在 DOM 树中位于参考节点之前）</td>
</tr>
<tr>
<td>4</td>
<td>居后（给定的节点在 DOM 树中位于参考节点之后）</td>
</tr>
<tr>
<td>8</td>
<td>包含（给定的节点是参考节点的祖先）</td>
</tr>
<tr>
<td>16</td>
<td>被包含（给定的节点是参考节点的后代）</td>
</tr>
</tbody>
</table>
<p>☑︎ 兼容性：<code>IE9+</code> <code>Firefox</code> <code>Safari</code> <code>Opera9.5+</code> <code>Chrome</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="built_in">document</span>.documentElement.compareDocumentPosition(<span class="built_in">document</span>.body)</span><br><span class="line">alert(!!(result &amp; <span class="number">16</span>))</span><br></pre></td></tr></table></figure>
<p><strong>一个通用的 contains 函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 检测  otherNode 是不是 refNode 的子节点</span><br><span class="line">* @param &#123;Element&#125; refNode 参考节点</span><br><span class="line">* @param &#123;Element&#125; otherNode 被检测的节点</span><br><span class="line">* @param &#123;booleam&#125; true 是子节点，false 不是子节点</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">contains</span> (<span class="params">refNode, otherNode</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="comment">// 对 contains() 进行能力检测</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> refNode.contains == <span class="string">'Function'</span> &amp;&amp;</span><br><span class="line">      <span class="comment">// 如果是 webkit ，那么 webkit 的版本号不能小于 522，因为 webkit 小于 522 的 safari 中 contains() 有 bug</span></span><br><span class="line">     (!client.engine.webkit || client.engine.webkit &gt;= <span class="number">522</span>)) &#123;</span><br><span class="line">       <span class="keyword">return</span> refNode.contains(otherNode)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 对 compareDocumentPosition() 进行能力检测</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> refNode.compareDocumentPosition == <span class="string">'function'</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> !!(refNode.compareDocumentPosition(otherNode) &amp; <span class="number">16</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 往上层节点递归，如果能找到 refNode ，则说明 otherNode 时其子节点</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> node = otherNode.parentNode</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (node === refNode) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        node = node.parentNode</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (node !=== <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-4-插入文本"><a href="#4-4-插入文本" class="headerlink" title="4.4 插入文本"></a>4.4 插入文本</h2><p><code>innerText</code> 和 <code>outerText</code> 没有被纳入 HTML 5 规范。</p>
<h3 id="innerText"><a href="#innerText" class="headerlink" title="innerText"></a>innerText</h3><p>☑︎ 读：节点包含的所有文本拼接成的字符串。</p>
<p>☑︎ 写：将所有子节点替换为一个文本节点，会对文本中存在的 HTML 语法字符进行编码。</p>
<p>☑︎ 兼容性：<code>IE4+</code> <code>Safari3+</code> <code>Opera8+</code> <code>Chrome</code></p>
<p>☑︎ 技巧：可以利用 <code>innerText</code> 属性过滤掉 HTML 标签</p>
<p><strong>读</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is a <span class="tag">&lt;<span class="name">strong</span>&gt;</span>paragragh<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> with a list following it.<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  </span><br><span class="line">  	<span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  </span><br><span class="line">  	<span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 3<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不同浏览器处理空白符的方式不同，因此输出的文本不一定会包含原始 HTMl 代码中的缩进。</span></span><br><span class="line">This is a paragragh <span class="keyword">with</span> a list following it.</span><br><span class="line">Item <span class="number">1</span></span><br><span class="line">Item <span class="number">2</span></span><br><span class="line">Item <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p><strong>写</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.innerText = <span class="string">'Hello &amp; welcome, &lt;b&gt;"reader"&lt;/b&gt;!'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span>Hello &amp;amp; welcome, &amp;lt;b&amp;gt;&amp;quot;reader&amp;quot;!&amp;lt;/b&amp;gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>过滤 HTML 标签</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定这行代码后，就用原来的文本内容替换了容器元素中的所有内容（包括子节点，因而也就去掉了 HTML 标签）。</span></span><br><span class="line">div.innerText = div.innerText</span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong></p>
<hr>
<h3 id="element-textContent"><a href="#element-textContent" class="headerlink" title="element.textContent"></a>element.textContent</h3><p><code>DOM Level 3</code></p>
<p><strong>说明：</strong> 类似 innerText 属性，区别在于是否 script 和 style 标签中的文本。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">☑︎ <span class="string">textContent:</span> 会像返回其它文本一样返回行内的样式和脚本的代码。</span><br><span class="line">☑︎ <span class="string">innerText:</span> 会忽略行内的样式和脚本。</span><br></pre></td></tr></table></figure>
<p>☑︎ 兼容性：<code>IE9+</code> <code>Safari3+</code> <code>Opera10+</code> <code>Chrome</code></p>
<p><strong>封装一个通用的函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取元素的文本</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getInnerText</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">typeof</span> element.textContent == <span class="string">'string'</span>) ? element.textContent : element.innerText;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向元素中写入文本</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setInnerText</span> (<span class="params">element, text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> element.textContent == <span class="string">'string'</span>) &#123;</span><br><span class="line">    element.textContent = text</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    element.innerText = text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setInnerText(div, <span class="string">'Hello world!'</span>)</span><br><span class="line">alert(getInnerText(div)) <span class="comment">// 'Hello world!'</span></span><br></pre></td></tr></table></figure>
<h3 id="outerText-属性"><a href="#outerText-属性" class="headerlink" title="outerText 属性"></a>outerText 属性</h3><p><strong>说明：</strong>除了作用范围扩大到了包含调用它的节点之外，<code>outerText</code> 与 <code>innerText</code> 基本上没有多大区别。</p>
<p>☑︎ 读：和 <code>innerText</code> 完全一样，因为返回的是节点內的所有文本，包不包括最外层的节点没有区别。</p>
<p>☑︎ 写：不只是替换他的子节点，而是会替换整个元素。本质上，新的文本节点会完全取代调用 <code>outerText</code> 的元素。此后，该元素就从文档中被删除，无法访问。</p>
<p>☑︎ 兼容性：<code>IE4+</code> <code>Safari3+</code> <code>Opera8+</code> <code>Chrome</code></p>
<p>☑︎ 建议：由于这个属性导致元素不存在，因此并不常用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.outerText = <span class="string">'Hello world!'</span></span><br></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="built_in">document</span>.createTextNode(<span class="string">'Hello world!'</span>)</span><br><span class="line">div.parentNode.replaceChild(text, div)</span><br></pre></td></tr></table></figure>
<h2 id="4-5-滚动"><a href="#4-5-滚动" class="headerlink" title="4.5 滚动"></a>4.5 滚动</h2><p>几个对 <code>HTMLElement</code> 类型扩展的专有方法，只有<code>Safari</code> <code>Chrome</code>支持。</p>
<h3 id="element-scrollIntoViewNeeded-alignCenter"><a href="#element-scrollIntoViewNeeded-alignCenter" class="headerlink" title="element.scrollIntoViewNeeded(alignCenter)"></a>element.scrollIntoViewNeeded(alignCenter)</h3><p><strong>说明</strong>：只有当前元素在视口中不可兼得情况下，才滚动浏览器窗口或容器元素，最终让它可见。如果当前元素在视口中可见，这个方法什么也不做。</p>
<p>☑︎ 功能：滚动到指定元素。</p>
<p>☑︎ 参数：boolean,  是否尽量将元素先是在视口中部（垂直方向）。</p>
<h3 id="element-scrollByLines-lineCount"><a href="#element-scrollByLines-lineCount" class="headerlink" title="element.scrollByLines(lineCount)"></a>element.scrollByLines(lineCount)</h3><p>☑︎ 功能：将元素的内容滚动指定的行高。</p>
<p>☑︎ 参数：number, 滚动几行。可正（向下滚）可负（向上滚）。</p>
<h3 id="element-scrollByPages-pageCount"><a href="#element-scrollByPages-pageCount" class="headerlink" title="element.scrollByPages(pageCount)"></a>element.scrollByPages(pageCount)</h3><p>☑︎ 功能：将元素的内容滚动 pageCount 页，也就是说具体高速有元素的高度和 pageCount 共同决定。</p>
<p>☑︎ 参数：滚动多少页。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将页面主体滚动 5 行</span></span><br><span class="line"><span class="built_in">document</span>.body.scrollByLines(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在当前元素不可见的时候，让它进入浏览器的视口</span></span><br><span class="line"><span class="built_in">document</span>.images[<span class="number">0</span>].scrollIntoViewIfNeeded()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将页面主题往回滚动 1 页</span></span><br><span class="line"><span class="built_in">document</span>.body.scrollByPages(<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/js/" rel="tag">#js</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/11/03/BOOK_nodejs开发指南/nodejs开发指南_4_nodejs核心模块/" rel="next" title="4 nodejs核心模块">
                <i class="fa fa-chevron-left"></i> 4 nodejs核心模块
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/11/09/BOOK_MongoDB权威指南中文版/01_简介/" rel="prev" title="01 简介">
                01 简介 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/"
           data-title="11 Dom扩展" data-url="http://laputa-er.github.io/2014/11/08/BOOK_JS高级程序设计(第三版)/JSHPD_3rd_11_DOM扩展/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">218</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-选择符API"><span class="nav-text">1 选择符API</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-querySelector-方法"><span class="nav-text">1.1 querySelector()方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-querySelectorAll-方法"><span class="nav-text">1.2 querySelectorAll()方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-matchesSelector-方法"><span class="nav-text">1.3 matchesSelector()方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-元素遍历"><span class="nav-text">2 元素遍历</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-HTML-5"><span class="nav-text">3 HTML 5</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-与类相关的扩展"><span class="nav-text">3.1 与类相关的扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#getElementsByClassName-方法"><span class="nav-text">getElementsByClassName() 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#classList-属性"><span class="nav-text">classList 属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-焦点管理"><span class="nav-text">3.2 焦点管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#document-activeElement-属性"><span class="nav-text">document.activeElement 属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-HTMLDocument-的变化"><span class="nav-text">3.3 HTMLDocument 的变化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#document-readState"><span class="nav-text">document.readState</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#document-compatMode"><span class="nav-text">document.compatMode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#document-head"><span class="nav-text">document.head</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-字符集属性"><span class="nav-text">3.4 字符集属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#document-charset"><span class="nav-text">document.charset</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#document-defaultCharset"><span class="nav-text">document.defaultCharset</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-自定义数据属性"><span class="nav-text">3.5 自定义数据属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#element-dataset"><span class="nav-text">element.dataset</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-插入标记"><span class="nav-text">3.6 插入标记</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-1-element-innerHTML"><span class="nav-text">3.6.1 element.innerHTML</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-限制"><span class="nav-text">(1) 限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-window-toStaticHTML"><span class="nav-text">(2) window.toStaticHTML()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-2-element-outerHTML"><span class="nav-text">3.6.2 element.outerHTML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-3-element-insertAdjacentHTML"><span class="nav-text">3.6.3 element.insertAdjacentHTML()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-4-内存与性能问题"><span class="nav-text">3.6.4 内存与性能问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-7-element-scrollIntoView"><span class="nav-text">3.7 element.scrollIntoView()</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-专用扩展"><span class="nav-text">4 专用扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-文档模式"><span class="nav-text">4.1 文档模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设置浏览器的渲染模式"><span class="nav-text">设置浏览器的渲染模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取当前页面的文档模式"><span class="nav-text">读取当前页面的文档模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-element-children"><span class="nav-text">4.2 element.children</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-element-contains"><span class="nav-text">4.3 element.contains()</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#element-compareDocumentPosition"><span class="nav-text">element.compareDocumentPosition()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-插入文本"><span class="nav-text">4.4 插入文本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#innerText"><span class="nav-text">innerText</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#element-textContent"><span class="nav-text">element.textContent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#outerText-属性"><span class="nav-text">outerText 属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-滚动"><span class="nav-text">4.5 滚动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#element-scrollIntoViewNeeded-alignCenter"><span class="nav-text">element.scrollIntoViewNeeded(alignCenter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#element-scrollByLines-lineCount"><span class="nav-text">element.scrollByLines(lineCount)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#element-scrollByPages-pageCount"><span class="nav-text">element.scrollByPages(pageCount)</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
