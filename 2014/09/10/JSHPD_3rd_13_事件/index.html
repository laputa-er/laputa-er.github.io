<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="js," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="历史：

IE3和Netscape Navigator2    :       作为分担服务器负载的一种手段；
IE4和Naviscape4    :    提供了相似却不相同的API；
DOM2规范制定    :    开始尝试标准化DOM事件；
DOM2实现    ：    IE9、Firefox、Opera、Safari和Chrome全部实现‘DOM2级事件’核心部分；    + DOM3级">
<meta property="og:type" content="article">
<meta property="og:title" content="13 事件">
<meta property="og:url" content="http://laputa-er.github.io/2014/09/10/JSHPD_3rd_13_事件/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="历史：

IE3和Netscape Navigator2    :       作为分担服务器负载的一种手段；
IE4和Naviscape4    :    提供了相似却不相同的API；
DOM2规范制定    :    开始尝试标准化DOM事件；
DOM2实现    ：    IE9、Firefox、Opera、Safari和Chrome全部实现‘DOM2级事件’核心部分；    + DOM3级">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492716437.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492766187.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492821788.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492907289.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492916457.png">
<meta property="og:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492978446.png">
<meta property="og:updated_time" content="2017-03-31T05:11:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13 事件">
<meta name="twitter:description" content="历史：

IE3和Netscape Navigator2    :       作为分担服务器负载的一种手段；
IE4和Naviscape4    :    提供了相似却不相同的API；
DOM2规范制定    :    开始尝试标准化DOM事件；
DOM2实现    ：    IE9、Firefox、Opera、Safari和Chrome全部实现‘DOM2级事件’核心部分；    + DOM3级">
<meta name="twitter:image" content="http://o6ul1xz4z.bkt.clouddn.com/1443492716437.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/2014/09/10/JSHPD_3rd_13_事件/"/>

  <title> 13 事件 | Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?898688f51c5a3d6b37dd23e04441e5bd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                13 事件
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-09-10T13:39:36+08:00" content="2014-09-10">
              2014-09-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JS高级程序设计-第三版/" itemprop="url" rel="index">
                    <span itemprop="name">JS高级程序设计(第三版)</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/09/10/JSHPD_3rd_13_事件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/10/JSHPD_3rd_13_事件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong>历史：</strong></p>
<ul>
<li>IE3和Netscape Navigator2    :       作为分担服务器负载的一种手段；</li>
<li>IE4和Naviscape4    :    提供了相似却不相同的API；</li>
<li>DOM2规范制定    :    开始尝试标准化DOM事件；</li>
<li>DOM2实现    ：    IE9、Firefox、Opera、Safari和Chrome全部实现‘DOM2级事件’核心部分；    <h3 id="DOM3级出现-：-API变得更加繁琐。"><a href="#DOM3级出现-：-API变得更加繁琐。" class="headerlink" title="+ DOM3级出现    ：    API变得更加繁琐。"></a>+ DOM3级出现    ：    API变得更加繁琐。</h3><h2 id="13-1-事件流"><a href="#13-1-事件流" class="headerlink" title="13.1    事件流"></a>13.1    事件流</h2><h3 id="13-1-1-事件冒泡-：-最具体的元素-gt-…-gt-document"><a href="#13-1-1-事件冒泡-：-最具体的元素-gt-…-gt-document" class="headerlink" title="13.1.1    事件冒泡    ：    最具体的元素-&gt;…-&gt;document"></a>13.1.1    事件冒泡    ：    最具体的元素-&gt;…-&gt;document</h3><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492716437.png" alt="Alt text"><br><strong>支持情况</strong>： 所有浏览器。</li>
</ul>
<table>
<thead>
<tr>
<th>浏览器</th>
<th>表现</th>
</tr>
</thead>
<tbody>
<tr>
<td>IE5.5—</td>
<td>最具体的元素-&gt;…-&gt;body-&gt;document</td>
</tr>
<tr>
<td>IE9、Firefox、Chrome、Safari</td>
<td>最具体的元素-&gt;…-&gt;body-&gt;html-&gt;document-&gt;window</td>
</tr>
</tbody>
</table>
<h3 id="13-1-2-事件捕获-：-document-gt-html-gt-body-gt-…-gt-最具体的元素"><a href="#13-1-2-事件捕获-：-document-gt-html-gt-body-gt-…-gt-最具体的元素" class="headerlink" title="13.1.2    事件捕获    ：      document-&gt;html-&gt;body-&gt;…-&gt;最具体的元素"></a>13.1.2    事件捕获    ：      document-&gt;html-&gt;body-&gt;…-&gt;最具体的元素</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492766187.png" alt="Alt text"><br><strong>说明：</strong>DOM2级规范</p>
<ul>
<li>支持情况：IE9、Safari、Chrome、Opera、Firefox</li>
<li>不支持情况： 所有老版本浏览器<h3 id="13-1-3-DOM事件流"><a href="#13-1-3-DOM事件流" class="headerlink" title="13.1.3    DOM事件流"></a>13.1.3    DOM事件流</h3><strong>支持情况：</strong>    IE9、Safari、Chrome、Opera、Firefox</li>
</ul>
<ol>
<li>事件捕获阶段：    为截获事件提供机会</li>
<li>处于目标阶段：    实际的目标接收到事件</li>
<li>事件冒泡阶段：    冒泡阶段<br><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492821788.png" alt="Alt text"><h2 id="13-2-事件处理程序"><a href="#13-2-事件处理程序" class="headerlink" title="13.2    事件处理程序"></a>13.2    事件处理程序</h2><h3 id="13-2-1-HTML事件处理程序"><a href="#13-2-1-HTML事件处理程序" class="headerlink" title="13.2.1    HTML事件处理程序"></a>13.2.1    HTML事件处理程序</h3><strong>特点</strong></li>
</ol>
<ul>
<li>会创建一个封装着元素属性值的函数</li>
</ul>
<ol>
<li>this    ：    当前dom</li>
<li>event    :    事件对象</li>
</ol>
<ul>
<li>扩展了作用域</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//形象说明作用域的扩展情况</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">with</span>(<span class="built_in">document</span>)&#123;</span><br><span class="line">        <span class="keyword">with</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="comment">//HTML标签中的代码相当于在这里执行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//表单的情况</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">with</span>(<span class="built_in">document</span>)&#123;</span><br><span class="line">        <span class="keyword">with</span>(<span class="keyword">this</span>.form)&#123;</span><br><span class="line">            <span class="keyword">with</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">                <span class="comment">//HTML标签中的代码相当于在这里执行</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>方式一    :    直接在标签中嵌入JS代码</em><br><strong>注意：</strong>不能使用未经转义的HTML语法字符！</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'Click Me'</span> <span class="attr">onclick</span>=<span class="string">"alert('Clicked')"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>方式二    ：    调用其他地方定义的脚本</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        alert(<span class="string">'Hello world!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'Click Me'</span> <span class="attr">onclick</span>=<span class="string">"showMessage()"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2-2-DOM0级事件处理程序-将函数赋值给一个事件处理程序属性"><a href="#13-2-2-DOM0级事件处理程序-将函数赋值给一个事件处理程序属性" class="headerlink" title="13.2.2    DOM0级事件处理程序    :    将函数赋值给一个事件处理程序属性"></a>13.2.2    DOM0级事件处理程序    :    将函数赋值给一个事件处理程序属性</h3><p><strong>说明</strong></p>
<ul>
<li>DOM0级方法指定的事件处理程序被认为是元素的方法，因此程序中的this引用当前元素；</li>
<li>这种事件处理程序在事件流的冒泡阶段处理；</li>
<li>每个元素(包括window和document)都有自己的的事件处理程序。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.id);    <span class="comment">//'myBtn'</span></span><br><span class="line">&#125;;</span><br><span class="line">btn.onclick = <span class="literal">null</span>;    <span class="comment">//删除通过DOM0级方法指定的事件处理程序</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2-3-DOM2级事件处理程序"><a href="#13-2-3-DOM2级事件处理程序" class="headerlink" title="13.2.3    DOM2级事件处理程序"></a>13.2.3    DOM2级事件处理程序</h3><p><strong>兼容性：</strong>IE9    Firefox    Safari    Chrome    Opera</p>
<p>####addEventListener()<br><strong>说明：</strong> 添加事件，3个参数，要处理的事件名、作为事件处理处理程序的函数、布尔值（true表示捕获阶段；false表示冒泡阶段）</p>
<ul>
<li>依附元素的作用域</li>
<li>可以添加多个事件处理程序，事件触发后按添加的顺序执行</li>
<li>addEventListener()添加的事件处理程序只能使用removeEventListener()来移除</li>
<li>移除时传入的参数与添加处理程序使用相同的参数</li>
<li>添加的匿名函数无法移除<br>####removeEventListener()<br><strong>说明：</strong>移出addEventListener()添加的事件处理程序，参数和 addEventListener() 保持一致<br><strong>注意：</strong>  将事件添加到事件的冒泡阶段而不是捕获阶段可以最大程度兼容各种浏览器，除非需要在事件到达目标之前截获事件。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var btn = document.getElementById('myBtn');</span><br><span class="line">//添加多个事件处理程序</span><br><span class="line">btn.addEventListener('click', function()&#123;</span><br><span class="line">    alert(this.id);</span><br><span class="line">&#125;,false);</span><br><span class="line">btn.addEventListener('click', function()&#123;</span><br><span class="line">    alert('Hello World!');</span><br><span class="line">&#125;,false);</span><br><span class="line">//演示移除事件处理程序</span><br><span class="line">var handler = function()&#123;</span><br><span class="line">    alert(this.id);</span><br><span class="line">&#125;;</span><br><span class="line">btn.addEventListener('click', handler, false);</span><br><span class="line">btn.removeEventListener('click', handler, false);</span><br></pre></td></tr></table></figure>
<h3 id="13-2-4-IE事件处理程序"><a href="#13-2-4-IE事件处理程序" class="headerlink" title="13.2.4    IE事件处理程序"></a>13.2.4    IE事件处理程序</h3><p><strong>注意：</strong>该方法没有考虑只支持DOM0级浏览器只支持一个事件处理程序的问题，如果多次绑定处理程序，只有最后一个有效。</p>
<p>####attachEvent()<br><strong>说明：</strong>添加事件，两个参数，事件处理程序名称、事件处理函数</p>
<ul>
<li>IE8-只支持事件冒泡，因此会被添加到冒泡阶段</li>
<li>事件名带<code>on</code>前缀</li>
<li>事件处理程序在全局作用域中运行，<code>this</code>等于<code>window</code></li>
<li>可以添加多个事件处理程序，事件触发后按与添加的相反的顺序执行</li>
<li>移除时传入的参数与添加处理程序使用相同的参数</li>
<li>添加的匿名函数无法移除</li>
<li><code>attachEvent</code>添加的事件处理程序只能使用<code>detachEvent</code>移除</li>
<li>####detachEvent()<br><strong>说明：</strong>移除通过attachEvent()添加的事件处理函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line"><span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span> == <span class="built_in">window</span>);    <span class="comment">//true</span></span><br><span class="line">&#125;;</span><br><span class="line">btn.attachEvent(<span class="string">'onclick'</span>, handler);</span><br><span class="line">btn.detachEvent(<span class="string">'onclick'</span>, handler);</span><br><span class="line">IE	Opera</span><br><span class="line">    <span class="number">13.2</span><span class="number">.5</span>    跨浏览器的事件处理程序</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* DOM2&gt;IE&gt;DOM0</span><br><span class="line">* param&#123;object&#125; element - dom节点对象</span><br><span class="line">* param&#123;string&#125; type - 事件名称</span><br><span class="line">* param&#123;boolean&#125; handler - 函数的引用</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">//添加事件处理程序</span></span><br><span class="line">    addHandler:    <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.addEventListener)&#123;    <span class="comment">//DOM2</span></span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>)；</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;    <span class="comment">//IE8---</span></span><br><span class="line">            element.attachEvent(<span class="string">'on'</span>+type, handler);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;    <span class="comment">//DOM0</span></span><br><span class="line">            element[<span class="string">'on'</span>+type] = hanler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//移除事件处理程序</span></span><br><span class="line">    removeHandler:    <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.removeEventListener)&#123;    <span class="comment">//DOM2</span></span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>)；</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;    <span class="comment">//IE8---</span></span><br><span class="line">            element.detachEvent(<span class="string">'on'</span>+type, handler);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;    <span class="comment">//DOM0</span></span><br><span class="line">            element[<span class="string">'on'</span>+type] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="13-3-事件对象"><a href="#13-3-事件对象" class="headerlink" title="13.3    事件对象"></a>13.3    事件对象</h2><p><strong>说明：</strong> 触发DOM上的某个事件是会产生一个事件对象event（DOM0或DOM2），包含所有与时间有关的信息。<br><strong>特点</strong></p>
<ul>
<li>所有浏览器都支持event对象，但支持方式不同</li>
<li>只在事件处理程序执行期间存在，执行完毕后被销毁</li>
<li><p>不同事件类型可用的属性和方法不同，都包括的成员如下<br><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492907289.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492916457.png" alt="Alt text"></p>
<ul>
<li>event.type    ：    事件类型</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line"><span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(event.type)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"click"</span>:</span><br><span class="line">            alert(<span class="string">'Clicked'</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"mouseover"</span>:</span><br><span class="line">            event.target.style.backgroundColor = <span class="string">'red'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"mouseout"</span>:</span><br><span class="line">            event.target.style.backgroundColor = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">btn.onclick = handler;</span><br><span class="line">btn.onmouseover = handler;</span><br><span class="line">btn.onmouseout  = handler;</span><br></pre></td></tr></table></figure>
<ul>
<li>event.target: 事件的实际目标（最具体的那个元素）</li>
<li>event.currentTarget: 和this相同，注册事件的那个元素</li>
<li>event.eventPhase ：事件当前所在的事件流的阶段</li>
</ul>
<ol>
<li>捕获阶段调用事件处理程序</li>
<li>事件处理程序处在目标对象上</li>
<li>冒泡阶段调用事件处理程序</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line"><span class="comment">//捕获阶段</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.eventPhase);    <span class="comment">//1</span></span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//处于目标阶段</span></span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.eventPhase);    <span class="comment">//2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//冒泡阶段</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.eventPhase);    <span class="comment">//3</span></span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>event.preventDefault()    :    取消默认行为</li>
<li>event.stopPropagation()    :    立即停止事件在DOM层次中的传播，即取消进一步的事件捕获或冒泡</li>
</ul>
<h3 id="13-3-2-IE中的事件对象"><a href="#13-3-2-IE中的事件对象" class="headerlink" title="13.3.2    IE中的事件对象"></a>13.3.2    IE中的事件对象</h3><p><strong>说明：</strong>访问IE中的event对象的方式取决于指定事件处理程序的方法</p>
<p>####window.event(DOM0级方法)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> event = <span class="built_in">window</span>.event;</span><br><span class="line">    alert(event.type);    <span class="comment">//'click'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>####作为参数对象（attachEvent()）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line">btn.attachEvent(<span class="string">'onclick'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.type);    <span class="comment">//'click'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>####直接访问event（HTML中）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">tyep</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'Click Me'</span> <span class="attr">onclick</span>=<span class="string">'alert(event.type)'</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/1443492978446.png" alt="Alt text"></p>
<h3 id="13-3-3-跨浏览器的事件对象"><a href="#13-3-3-跨浏览器的事件对象" class="headerlink" title="13.3.3    跨浏览器的事件对象"></a>13.3.3    跨浏览器的事件对象</h3><p><strong>说明：</strong>创建一个兼容的操作事件对象的工具对象：因为兼容IE不支持阻止事件捕获</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 用来添加事件处理程序的方法</span><br><span class="line">    * param&#123;object&#125; element - dom</span><br><span class="line">    * param&#123;string&#125; type - 事件名称</span><br><span class="line">    * param&#123;function&#125; handler - 函数引用</span><br><span class="line">    */</span></span><br><span class="line">    addHandler:    <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.addEventListener)&#123;    <span class="comment">//DOM2</span></span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>)；</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.attachEvent)&#123;    <span class="comment">//IE8---</span></span><br><span class="line">            element.attachEvent(<span class="string">'on'</span>+type, handler);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;    <span class="comment">//DOM0</span></span><br><span class="line">            element[<span class="string">'on'</span>+type] = hanler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     <span class="comment">/**</span><br><span class="line">    * 用来移除事件处理程序的方法</span><br><span class="line">    * param&#123;object&#125; element - dom</span><br><span class="line">    * param&#123;string&#125; type - 事件名称</span><br><span class="line">    * param&#123;function&#125; handler - 函数引用</span><br><span class="line">    */</span></span><br><span class="line">    removeHandler:    <span class="function"><span class="keyword">function</span>(<span class="params">element, type, handler</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(element.removeEventListener)&#123;    <span class="comment">//DOM2</span></span><br><span class="line">            element.addEventListener(type, handler, <span class="literal">false</span>)；</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(element.detachEvent)&#123;    <span class="comment">//IE8---</span></span><br><span class="line">            element.detachEvent(<span class="string">'on'</span>+type, handler);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;    <span class="comment">//DOM0</span></span><br><span class="line">            element[<span class="string">'on'</span>+type] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 获得事件对象的方法</span><br><span class="line">    * param&#123;object&#125; event - 事件处理程序执行时产生的事件对象（如果有的话）</span><br><span class="line">    * return&#123;object&#125; 事件对象</span><br><span class="line">    */</span></span><br><span class="line">    getEvent:    <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> event ? event : <span class="built_in">window</span>.event;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 获得触发事件的目标的方法</span><br><span class="line">    * param&#123;event&#125; event    - 事件对象</span><br><span class="line">    * return&#123;object&#125; dom    - 触发事件的节点    </span><br><span class="line">    */</span></span><br><span class="line">    getTarget:    <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> event.target || event.srcElement;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 取消默认动作</span><br><span class="line">    * param&#123;object&#125; event    -事件对象</span><br><span class="line">    */</span></span><br><span class="line">    preventDefault:    <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(event.preventDefault)&#123;</span><br><span class="line">            event.preventDefault();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            event.returnValue = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 阻止事件冒泡（或捕获）</span><br><span class="line">    * param&#123;object&#125; event    -事件对象</span><br><span class="line">    */</span></span><br><span class="line">    stopPropagation:    <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(event.stopPropagation)&#123;</span><br><span class="line">            event.stopPropagation();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            event.cancelBubble =  <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">    使用上述快跨览器的工具</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);    <span class="comment">//    确保在不同浏览器都能获得event</span></span><br><span class="line">    <span class="keyword">var</span> target = EventUtil.getTarget(event);    <span class="comment">//确保获得target</span></span><br><span class="line">    EventUtil.preventDefault(event);    <span class="comment">//确保清除默认动作</span></span><br><span class="line">    EventUtil.stopPropagatiom(event);    <span class="comment">//阻止传播    </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="13-4-事件类型"><a href="#13-4-事件类型" class="headerlink" title="13.4    事件类型"></a>13.4    事件类型</h2><ul>
<li>DOM2级事件</li>
<li>DOM3级事件（以DOM2为基础）</li>
<li>UI事件</li>
<li>焦点事件</li>
<li>鼠标事件</li>
<li>滚轮事件</li>
<li>文本事件</li>
<li>键盘事件</li>
<li>合成事件</li>
<li>变动事件</li>
<li><p>变动名称事件</p>
</li>
<li><p>HTML5定义的一组事件</p>
</li>
<li>DOM和BOM中实现的其它专有事件（没有规范）</li>
</ul>
<h3 id="13-4-1-UI事件"><a href="#13-4-1-UI事件" class="headerlink" title="13.4.1    UI事件"></a>13.4.1    UI事件</h3><p><strong>历史：</strong>出现在DOM规范之前，被规范保留。<br><strong>分类：</strong>现有的UI事件</p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>事件名称</td><td>DOM</td><td>触发时机</td><td>备注</td></tr><br>    <tr><td>DOMActive </td><td>任何元素</td><td>元素已经被用户操作激活</td><td>被DOM3废弃</td></tr><br>    <tr><td colspan="1" rowspan="4">load</td><td>window</td><td>页面加载完后</td><td colspan="1" rowspan="4">HTML事件</td></tr><br>    <tr><td>框架集</td><td>所有框架都加载完毕</td></tr><br>    <tr><td>&lt;img&gt;</td><td>图像加载完毕</td></tr><br>    <tr><td>&lt;object&gt;</td><td>嵌入的内容加载完毕</td></tr><br>    <tr><td colspan="1" rowspan="4">unload</td><td>window</td><td>页面完全卸载</td><td colspan="1" rowspan="4">HTML事件 </td></tr><br>    <tr><td colspan="1">&lt;img&gt; </td><td colspan="1">无法加载图片</td></tr><br>    <tr><td colspan="1">框架集 </td><td colspan="1">所有框架都卸载</td></tr><br>    <tr><td colspan="1">&lt;object&gt; </td><td colspan="1">嵌入的内容卸载完毕</td></tr><br>    <tr><td colspan="1">abort</td><td colspan="1">&lt;object&gt;  </td><td colspan="1">用户停止下载，嵌入的内容没有加载完</td><td colspan="1">HTML事件 </td></tr><tr><td colspan="1" rowspan="4">error</td><td colspan="1">window</td><td colspan="1">JavaScript错误</td><td colspan="1" rowspan="4">HTML事件 </td></tr><br>    <tr><td colspan="1">&lt;img&gt;</td><td colspan="1">无法加载图像</td></tr><br>    <tr><td colspan="1">&lt;object&gt;</td><td colspan="1">无法加载嵌入内容</td></tr><br>    <tr><td colspan="1">框架集</td><td colspan="1">有框架无法加载</td></tr><br>    <tr><td colspan="1" rowspan="2">select</td><td colspan="1">&lt;input&gt;</td><td colspan="1">用户选择文本框一个或多个字符</td><td colspan="1" rowspan="2">HTML事件 </td></tr><br>    <tr><td colspan="1">&lt;textarea&gt;</td><td colspan="1">用户选择文本框一个或多个字符  </td></tr><br>    <tr><td colspan="1">resize</td><td colspan="1">window或框架</td><td colspan="1">窗口或框架变化</td><td colspan="1">HTML事件 </td></tr><br>    <tr><td colspan="1">scroll</td><td colspan="1">带滚动条的元素</td><td colspan="1">用户滚动带滚动条的元素中的内容</td><td colspan="1">HTML事件&lt;body&gt;元素中包含加载元素的滚动条</td></tr><br></table><br>####为UI事件定义事件处理程序<br>#### 13.4.1.1    load事件<br><strong>案例一：以body为例</strong><br><em>方式一：    JS（推荐）</em><br><br>+ 使用了跨浏览器的脚本；<br>+ 传入的event不包含有关这个时间的任何附加信息；<br>+ 兼容DOM时，event.target会被设置为document;IE不会为其设置srcElement属性;<br>+ “DOM2级事件”规范应该在document上而不是window上触发load事件，但所有浏览器都在window上面实现了该事件（确保向后兼容）。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Loaded!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二：    为元素添加onload属性</em><br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Load Event Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">'alert('</span><span class="attr">Loaded</span>!')'&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br><strong>案例二：img</strong><br><em>方式一</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> image = <span class="built_in">document</span>.getElementById(<span class="string">'myImage'</span>);</span><br><span class="line">EventUtil.addHandler(image, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    alert(EventUtil.getTarget(event).src);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二</em><br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">'smile.gif'</span> <span class="attr">onload</span>=<span class="string">'alert('</span><span class="attr">Image</span> <span class="attr">loaded.</span>')'&gt;</span></span><br></pre></td></tr></table></figure><br><br><strong>案例三：创建新的    <code>&lt;img&gt;</code>元素,同时指定一个事件处理程序</strong><br><br>+ 要在window上的onload事件触发后才添加DOM中，否则document.body会报错；<br>+ 一旦设置了src属性，新创建的图像就开始加载图像，和是否添加到文档中无关；<br><br><em>方式一：    DOM的方式</em><br><strong>注意：</strong>[IE8-]没有添加到DOM中的节点触发load事件时不会生成event对象。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> image = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">    EventUtil.addHandler(image, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        alert(EventUtil.getTarget(event).src);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(image);</span><br><span class="line">    image.src  = <span class="string">'smile.gif'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二：    Image对象</em><br><br>+ 可以像使用<code>&lt;img&gt;</code>元素一样使用Image对象（并非所有浏览器都将Image对象实现为<code>&lt;img&gt;</code>）；<br>+ 无法添加到DOM中；<br>+ 【IE8- 】Image对象触发load事件不会生成event对象。<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">    EventUtil.addHandler(image, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'Imaeg loaded!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><strong>案例四：    script元素</strong><br><strong>说明：</strong>指定src属性并将元素添加到文档后才开始下载。<br><strong>兼容性问题</strong><br><br>|浏览器版本|script元素onload事件|event.target|<br>|—|—|—|<br>|大多数浏览器|支持|<script>节点|<br>|Firefox3—|支持|document|<br>|IE8—|不支持||<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    EventUtil.addHandler(script, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'Loaded'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    script.src = <span class="string">'exaple.js'</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><strong>案例五：link属性</strong><br><strong>说明：</strong>和script类似<br><strong>兼容性问题</strong>IE    Opera<br>#### 13.4.1.2    unload事件<br><strong>发生时机举例：</strong>只要用户从一个页面切换到另外一个页面，就会发生unload事件；<br><strong>用途举例：</strong>清除引用避免内存泄漏;<br><strong>限制：</strong>DOM2级事件规定应该在<body>元素而不是window对象上触发unload事件。<br><em>方式一：    JS</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'unload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Unloaded'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二：    HTML</em><br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Unloaded<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onunload</span>=<span class="string">"alert('unloaded!')"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br>#### 13.4.1.3.    resize事件<br><strong>注意：</strong>浏览器最大化最小化时也会触发resize事件。<br><strong>event差异：</strong><br><br>|浏览器|event.target|备注|<br>|—|—|—|<br>|兼容DOM的|documen||<br>|IE8—|event没有任何属性||<br><strong>行为差异：</strong><br><br>|浏览器|触发时间|<br>|—|—|<br>|IE、Safari、Chrome、Opera|    窗口变化1像素时|<br>|Firefox|用户停止调整窗口大小时|<br><br><em>方式一：    JS</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'resize'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Resized'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二：    HTML</em><br><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Unloaded<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onresize</span>=<span class="string">"alert('resized!')"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br><br>#### 13.4..1.4    scroll事件<br><strong>说明：</strong>在window对象上触发，表现的是页面上元素的变化。<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>模式</td><td>浏览器</td><td>元素</td><td>具体表现</td></tr><br>    <tr><td>混杂模式</td><td>所有</td><td>body</td><td>scrollLeft和scrollTop</td></tr><br>    <tr><td  colspan="1" rowspan="2">标准模式</td><td>Safari</td><td>body</td><td>跟踪滚动位置</td></tr><br>    <tr><td>其它</td><td>html</td><td>跟踪滚动位置</td></tr><br></table>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//输出页面的垂直滚动位置，根据不同模式使用不同的元素</span><br><span class="line">EventUtil.addHandler(window, 'scroll', function(event)&#123;</span><br><span class="line">    if(document.compatMode == 'CSSCompat')&#123;</span><br><span class="line">        alert(document.documentElement.scrollTop);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        alert(document.body.scrollTop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="13-4-2-焦点事件"><a href="#13-4-2-焦点事件" class="headerlink" title="13.4.2    焦点事件"></a>13.4.2    焦点事件</h3><p><strong>触发：</strong>  页面获得或失去焦点<br><strong>使用：</strong> 利用这些事件并与document.hasFocus()方法及document.activeElement属性配合来知晓用户在页面上的行踪<br><strong>顺序：</strong>以焦点由A元素移动到B元素为例</p>
<ol>
<li>focusout(A)</li>
<li>focusin(B)</li>
<li>blur(A)</li>
<li>DOMFocusOut(A)</li>
<li>focus(B)</li>
<li>DOMFocusIn(B)<br><strong>兼容性：</strong></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSupported = <span class="built_in">document</span>.implementaation.hasFeature(<span class="string">'FocusEvent'</span>,<span class="string">'3.0'</span>);</span><br></pre></td></tr></table></figure>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td><div>焦点事件名 </div></td><td>冒泡</td><td>触发</td><td>兼容性</td><td>备注</td></tr><br>    <tr><td>blur</td><td colspan="1" rowspan="2">否</td><td>失去焦点</td><td  colspan="1" rowspan="2">所有</td><td>DOM3级事件（来自IE）</td></tr><br>    <tr><td>focus</td><td>获得焦点</td><td>DOM3级事件（来自IE）</td></tr><br>    <tr><td>DOMFocusIn</td><td  colspan="1" rowspan="4">是</td><td>获得焦点</td><td  colspan="1" rowspan="2">Opera</td><td>DOM3级事件中用focusin取代</td></tr><br>    <tr><td>DOMFocusOut</td><td>失去焦点</td><td>DOM3级事件中用focusout取代</td></tr><br>    <tr><td>focusin</td><td>获得焦点</td><td colspan="1" rowspan="2">IE5.5+、Safari5.1+、Opera11.5+、Chrome</td><td></td></tr><br>    <tr><td>focusout</td><td>失去焦点</td><td></td></tr><br></table>

<h3 id="13-4-3-鼠标与滚轮事件"><a href="#13-4-3-鼠标与滚轮事件" class="headerlink" title="13.4.3    鼠标与滚轮事件"></a>13.4.3    鼠标与滚轮事件</h3><p><strong>版本：</strong>DOM3级<br><strong>注意：</strong></p>
<ul>
<li>冒泡可以被取消，但会影响其他事件</li>
<li>click和dbclick事件会依赖其它先行事件的触发；mousedown和mouseup不受其它事件影响<br><strong>事件执行顺序（以双击鼠标主键为例）:</strong></li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>标准</th>
<th>IE8（会跳过括号中的事件）</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>mousedown</td>
<td>mousedown</td>
</tr>
<tr>
<td>2</td>
<td>mouseup</td>
<td>mouseup</td>
</tr>
<tr>
<td>3</td>
<td>click</td>
<td>click</td>
</tr>
<tr>
<td>4</td>
<td>mousedown</td>
<td>(mousedown)</td>
</tr>
<tr>
<td>5</td>
<td>mouseup</td>
<td>mouseup</td>
</tr>
<tr>
<td>6</td>
<td>click</td>
<td>(click)</td>
</tr>
<tr>
<td>7</td>
<td>dbclick</td>
<td>dbclick</td>
</tr>
</tbody>
</table>
<p><strong>兼容性检测：</strong></p>
<ul>
<li>DOM2</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSupported = <span class="built_in">document</span>.implementation.hasFeature(<span class="string">'MouseEvents'</span>, <span class="string">'2.0'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>DOM3</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSupported = <span class="built_in">document</span>.implementation.hasFeature(<span class="string">'MouseEvent'</span>, <span class="string">'2.0'</span>);</span><br></pre></td></tr></table></figure>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td >鼠标/滚轮事件名称</td><td >冒泡</td><td>触发</td><td >兼容性</td><td >备注</td></tr><br>    <tr><td>click</td><td colspan="1" rowspan="3">是</td><td >单机主鼠标按钮（通常是左键）或键盘回车键</td><td ></td><td ></td></tr><br>    <tr><td >dbclick</td><td >双击主鼠标按钮</td><td >非DOM2</td><td ></td></tr><tr><td >mousedown</td><td >用户按下任意鼠标按钮时</td><td ></td><td ></td></tr><br>    <tr><td >mouseenter</td><td colspan="1" rowspan="2">否</td><td >鼠标光标从元素外部首次移动到元素范围之内</td><td colspan="1" rowspan="2">IE、Firefox9+、Opera（非DOM2）</td><td>非子元素</td></tr><br>    <tr><td >mouseleave</td><td >鼠标光标移动到元素之外</td><td></td></tr><tr><td >mousemove</td><td  colspan="1" rowspan="4">是</td><td >鼠标光标在元素内移动时重复触发</td><td></td><td colspan="1" rowspan="4">非键盘</td></tr><br>    <tr><td >mouseout</td><td >从一个元素移动到另一个元素（父/子/兄弟）</td><td ></td></tr><br>    <tr><td >mouseover</td><td >从目标元素外部移动到另一个元素边界内</td><td ></td></tr><br>    <tr><td >mouseup</td><td >释放鼠标按钮</td><td ></td></tr><br></table><br>####鼠标事件信息<br>#####1.    客户区(Client)坐标位置：浏览器视窗作为参照<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>属性</td><td>作用</td><td>兼容性</td><td>特点</td></tr><br>    <tr><td>event.clientX</td><td>事件发生时鼠标指针在视口中的水平坐标</td><td colspan="1" rowspan="2">所有</td><td colspan="1" rowspan="2">不包括滚动的距离</td></tr><br>    <tr><td>event.clientY</td><td>事件发生时鼠标指针在视口中的垂直坐标</td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementByid(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    alert(<span class="string">'Client coordinates:'</span> + event.clientX + <span class="string">','</span> + event.clientY);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>#####2.    页面(Page)坐标位置</p>
<table cellspacing="0" cellpadding="0"><br>        <tr><td>属性</td><td>作用</td><td>兼容性</td><td>特点</td></tr><br>        <tr><td>event.pageX</td><td>事件发生时鼠标指针在页面中的水平坐标</td><td colspan="1" rowspan="2">IE8-之外</td><td colspan="1" rowspan="2">包括滚动的距离</td></tr><br>        <tr><td>event.pageY</td><td>事件发生时鼠标指针在页面中的垂直坐标</td></tr></table><br><em>方式一：兼容IE8-，兼容混杂模式（document.body）和标准模式</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">document</span>.documentElement)</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementByid(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> pageX = event.pageX, pageY = event.pageY;</span><br><span class="line">    <span class="keyword">if</span>(pageX === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        pageX = event.clientX + (<span class="built_in">document</span>.body.scrollLeft || <span class="built_in">document</span>.documentElement.scrollLeft);</span><br><span class="line">         pageY = event.clientY + (<span class="built_in">document</span>.body.scrollTop || <span class="built_in">document</span>.documentElement.scrollTop);</span><br><span class="line">    &#125;</span><br><span class="line">    alert(<span class="string">'Page coordinates:'</span> + pageX + <span class="string">','</span> + pageY);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>方式二：其它浏览器</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementByid(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    alert(<span class="string">'Page coordinates:'</span> + event.pageX + <span class="string">','</span> + event.pageY);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br>#####3.    屏幕(Screen)坐标位置<br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementByid(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    alert(<span class="string">'screen coordinates:'</span> + event.screenX + <span class="string">','</span> + event.screenY);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br>#####4.    修改键    ：    按下鼠标时键盘上的某些键会影响所要采取的操作<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>修改键</td><td>DOM规定的对应属性</td><td>兼容性</td></tr><br>    <tr><td>Shift</td><td>event.shiftKey</td><td colspan="1" rowspan="4">所有（IE8-除外）</td></tr><tr><td>Ctrl</td><td>event.ctrlKey</td></tr><br>    <tr><td>Alt</td><td>event.altKey</td></tr><br>    <tr><td>meta(win或Cmd)</td><td>event.metaKey</td></tr><br></table>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//如果某个修改键被按下，event中对应的属性值为true</span><br><span class="line">var div = document.getElementById('mDiv');</span><br><span class="line">EventUtil.addHandl(div, 'click', function(event)&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    var keys = new Array();</span><br><span class="line">    if(event.shiftKey)&#123;</span><br><span class="line">        keys.push('shift');</span><br><span class="line">    &#125;</span><br><span class="line">    if(event.altKey)&#123;</span><br><span class="line">        keys.push('alt');</span><br><span class="line">    &#125;</span><br><span class="line">    if(event.ctrlKey)&#123;</span><br><span class="line">        keys.push('ctrl');</span><br><span class="line">    &#125;</span><br><span class="line">    if(event.metaKey)&#123;</span><br><span class="line">        keys.push('meta');</span><br><span class="line">    &#125;</span><br><span class="line">    alert('Keys:' + keys.join(',’));</span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure>
<p>#####5.    相关元素    ：    mouseover和mouseout事件触发时，除住目标外还会涉及其它相关元素。</p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>event的属性</td><td>事件</td><td>属性值</td><td>触发时机</td><td>兼容性</td></tr><tr><td colspan="1" rowspan="2">relatedTarget</td><td>mouseover</td><td>A元素的dom</td><td>鼠标从A元素进入B（目标）元素</td><td colspan="1" rowspan="2">IE8-不支持</td></tr><br>    <tr><td>mouseout</td><td>B元素的dom</td><td>鼠标从A（目标）元素离开</td></tr><br>    <tr><td>fromElement</td><td>mouseover</td><td>A元素的dom</td><td>鼠标从A元素进入B（目标）元素</td><td colspan="1" rowspan="2">IE(包括IE8-)</td></tr><br>    <tr><td colspan="1">toElement</td><td colspan="1">mouseout</td><td colspan="1">B元素的dom</td><td colspan="1">鼠标从A（目标）元素离开 </td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">//省略其它代码</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 跨浏览器获得相关元素的方法</span><br><span class="line">    */</span></span><br><span class="line">    getRelatedTarget: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(event.relatedTarget)&#123;</span><br><span class="line">            <span class="keyword">return</span> event.relatedTarget;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(event.toElement)&#123;</span><br><span class="line">            <span class="keyword">return</span> event.toElement;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(event.fromElement)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//省略其它代码</span></span><br><span class="line">&#125;；</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'mouseout'</span>， <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">    <span class="keyword">var</span> relatedTarget = EventUtil.getRelatedTarget(event);</span><br><span class="line">    alert(<span class="string">'Mouse out of '</span> + target.tagName + <span class="string">' to '</span> + relatedTarget.tagName);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>#####6.    鼠标按钮（mousedown 和 mouseup发生时了解哪些鼠标按钮被ianxia）</p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td>event.button</td><td>DOM</td><td>IE8-</td></tr><tr><td>0</td><td>没有按下按钮</td><td>主</td></tr><br>    <tr><td>1</td><td>主</td><td>中</td></tr><tr><td>2</td><td>次</td><td>次</td></tr><br>    <tr><td>3</td><td>主+次</td><td></td></tr><tr><td>4</td><td>中</td><td></td></tr><tr><td>5</td><td>主+中</td><td></td></tr><br>    <tr><td>6</td><td>次+中</td><td></td></tr><tr><td>7</td><td>主+中+次</td><td></td></tr><br></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">//省略其它代码</span></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 检测是否兼容DOM并规范化对相应的值规范化</span><br><span class="line">    */</span></span><br><span class="line">    getButton: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">document</span>.implementation.hasFeature(<span class="string">'MouseEvents'</span>, <span class="string">'2.0'</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> event.button;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(event.button)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//省略其它代码</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>);</span><br><span class="line">EventUtil.addHandler(div, <span class="string">'mousedown'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getElement(event);</span><br><span class="line">    alert(EventUtil.getButton(event));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>#####7.    更多的事件信息</p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><br>    <tr><td colspan="3" rowspan="1">DOM2级事件</td><td colspan="3" rowspan="1">IE</td></tr><br>    <tr><td>event属性</td><td>类型</td><td>备注</td><td>event属性</td><td>类型</td><td>备注</td></tr><br>    <tr><td>detail</td><td>number</td><td>给定位置上发生点击的数量</td><td>altLeft</td><td>boolean</td><td>是否按了Alt</td></tr><tr><td></td><td></td><td></td><td>ctrlLeft</td><td>boolean</td><td>是否按了Ctrl</td></tr><br>    <tr><td></td><td></td><td></td><td>offSetX</td><td>number</td><td>光标相对于目标元素边界的x坐标</td></tr><tr><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td><td colspan="1">offSetY</td><td colspan="1">number</td><td colspan="1">光标相对于目标元素边界的y坐标 </td></tr><br>    <tr><td></td><td></td><td></td><td>shiftLeft</td><td>boolean</td><td>是否按下shift键</td></tr><br></table><br>#####8.    鼠标滚轮事件(mousewheel)<br><strong>说明：</strong> IE6首先实现<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>event属性</td><td>浏览器</td><td>冒泡到</td><td>表现</td></tr><tr><td colspan="1" rowspan="2">wheelDelta</td><td>IE8</td><td>document</td><td colspan="1" rowspan="2">向前滚动120的倍数；向后滚动-120的倍数</td></tr><tr><td colspan="1">IE9、Opera、Chrome、Safari</td><td colspan="1">window</td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解决Opera 9.5之前的版本wheelDelta值正负点到的问题</span></span><br><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'mousewheel'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> delta = (client.engine.opera &amp;&amp; client.opera &lt; <span class="number">9.5</span> ?-event.wheelDelta.opera:event.wheelDelta);</span><br><span class="line">    alert(delta);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 兼容opera9.5-的获取wheelDelta值得方法</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">//省略了其它代码</span></span><br><span class="line">    getWheelDelta: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(event.wheelDelta)&#123;</span><br><span class="line">            <span class="keyword">return</span> (client.engin.opera &amp;&amp; client.engin.opra &lt; <span class="number">9.5</span> ? -event.wheelDelta : event.wheelDelta);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> -event.detal * <span class="number">40</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>#####9.    触摸设备</p>
<ul>
<li>不支持dbclick事件。双击浏览器窗口会放大画面，而且没有办法改变；</li>
<li>轻击可单击元素会触发mousemove；</li>
<li>mousemove事件也会触发mouseover和mouseout事件；</li>
<li><p>两个手指放在屏幕上且页面随手指一动而滚动时会触发mousewheel和scroll事件。<br>#####10.    无障碍性问题<br><strong>拓展：</strong>www.webaim.org</p>
</li>
<li><p>不建议使用click之外的其他鼠标事件展示功能或引发代码执行；</p>
</li>
<li>不建议使用onmousedown,因为屏幕阅读器中无法触发mousedown事件；</li>
<li>不推荐使用的事件：<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>事件名</td><td>不推荐的原因</td></tr><tr><td>click之外的鼠标事件</td><td>无法通过键盘触发</td></tr><tr><td>onmousedown</td><td colspan="1" rowspan="2">屏幕阅读器无法触发该事件</td></tr><tr><td>onmouseover</td></tr><tr><td colspan="1">dbclick</td><td colspan="1">无法通过键盘触发</td></tr></table>

</li>
</ul>
<h3 id="13-4-4-键盘与文本事件"><a href="#13-4-4-键盘与文本事件" class="headerlink" title="13.4.4    键盘与文本事件"></a>13.4.4    键盘与文本事件</h3><p><strong>说明：</strong>支持修改键，IE不支持metaKey.</p>
<p>####键盘事件（3）<br><strong>历史：</strong></p>
<ol>
<li>位数  77DOM0    :    对键盘事件的支持主要遵循DOM0级；</li>
<li>DOM2    :    最终定稿时删除了相应的内容；</li>
<li>DOM3    :    为键盘事件制定了规范，IE9率先实现。</li>
</ol>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>键盘事件</td><td>触发</td><td>表现</td><td>兼容性</td></tr><tr><td>keydown</td><td>按下任意键</td><td colspan="1" rowspan="2">按住不放会重复触发</td><td></td></tr><tr><td>keypress</td><td>按下字符键（包括Esc）</td><td>Safari3.1-(非字符键也会触发)</td></tr><tr><td>keyup</td><td>释放键盘上的键</td><td></td><td></td></tr></table><br>####文本事件（1）<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>文本事件</td><td>触发</td><td>表现</td><td>兼容性</td></tr><tr><td>textInput</td><td>文本插入文本框之前</td><td>keydown-&gt;keypress-&gt;textInput-&gt;keyup</td><td></td></tr></table><br><strong>键码</strong><br><table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>event属性</td><td>对应事件</td><td>值</td><td>兼容性</td></tr><tr><td>keyCode</td><td><span style="font-family: 'Microsoft YaHei UI';">keydown 和 keyup</span></td><td><span style="font-family: 'Microsoft YaHei UI';">ASCLL码中对应小写字母或数字的编码相同(分号按键存在兼容性问题)</span></td><td>DOM和IE</td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.getElementById(<span class="string">'myText'</span>);</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        alert(event.keyCode);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>字符编码</strong></p>
<table cellspacing="0" cellpadding="0" style="width: 790px;"><tr><td>event属性</td><td>对应事件</td><td>值</td><td>兼容性</td></tr><tr><td>charCode</td><td><span style="font-family: 'Microsoft YaHei UI';">keypress</span></td><td><font face="Microsoft YaHei UI">按下的键对应的ASCLL</font></td><td>IE9、Firefox、Chrome、Safari</td></tr></table><br><em>不考虑兼容</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.getElementById(<span class="string">'myText'</span>);</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">'keypress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        alert(event.charCode);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br><br><em>考虑兼容</em><br><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> EventUtil = &#123;</span><br><span class="line">    <span class="comment">//省略的代码</span></span><br><span class="line">    </span><br><span class="line">    getCharCode: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> event.charCode == <span class="string">'number'</span>)&#123;</span><br><span class="line">            reutrn event.charCode;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            reutrn event.keyCode;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//省略的代码</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br><br><strong>DOM3级变化</strong><br><em>event中删除的成员</em><br><table cellspacing="0" cellpadding="0" style="width: 790px;"><tr><td>event属性</td><td>对应事件</td><td>值</td><td>兼容性</td></tr><tr><td>charCode</td><td><span style="font-family: 'Microsoft YaHei UI';">keypress</span></td><td><font face="Microsoft YaHei UI">按下的键对应的ASCLL</font></td><td>IE9、Firefox、Chrome、Safar</td></tr></table>

<p><em>event中添加的成员</em></p>
<table cellspacing="0" cellpadding="0" style="width: 790px;"><tr><td>event成员</td><td>对应事件</td><td>值</td><td>兼容性</td></tr><tr><td>key</td><td colspan="1" rowspan="6"><span style="font-family: 'Microsoft YaHei UI';"></span><span style="font-family: 'Microsoft YaHei UI'; font-size: 10.5pt; line-height: 1.5;">keypress</span><span style="font-family: 'Microsoft YaHei UI';"></span></td><td><font face="Microsoft YaHei UI">文本字符或键的名字</font>（非字符）</td><td>IE9支持</td></tr><tr><td colspan="1">char</td><td colspan="1">文本字符或null（非字符）</td><td colspan="1">IE9不支持</td></tr><tr><td colspan="1">keyIdentifier(非DOM3)</td><td colspan="1">‘U+000’字符串或键的名字（非字符）</td><td colspan="1">Sfari 5 和 Chrome</td></tr><tr><td colspan="1">location</td><td colspan="1">number（代表键盘区域的位置）</td><td colspan="1">IE9</td></tr><tr><td colspan="1">keyLocation</td><td colspan="1">有BUG</td><td colspan="1">Safari和Chrome</td></tr><tr><td colspan="1">getModifierState()</td><td colspan="1">boolean,检测某个修改键是否被按下</td><td colspan="1">IE9唯一支持</td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跨浏览器获得键盘字符</span></span><br><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.getElementById(<span class="string">'myText'</span>);</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">'keypress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> identifier = event.key || event.keyIdentifier;</span><br><span class="line">    <span class="keyword">if</span>(identifier)&#123;</span><br><span class="line">        alert(identifier);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//检测某个修改键是否被按下</span></span><br><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.getElementById(<span class="string">'myText'</span>);</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">'keypress'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">if</span>(event.getModifiedState)&#123;</span><br><span class="line">        alert( event.getModifiedState(<span class="string">'Shift'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>####textInput事件</p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>相关属性</td><td>有效元素</td><td>事件</td><td>值</td><td>来源</td><td>兼容性</td></tr><tr><td>event.data</td><td colspan="1" rowspan="2">可编辑区域</td><td colspan="1" rowspan="2">textInput(在可编辑区域输入字符时)</td><td>用户输入的字符（非字符编码）</td><td colspan="1" rowspan="2">DOM3级事件</td><td>IE9+、Safari、Chrome</td></tr><tr><td colspan="1">event.textInput</td><td colspan="1">0-9(表示输入到文本框中的方式)</td><td colspan="1">仅IE</td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得用户输入的字符</span></span><br><span class="line"><span class="keyword">var</span> textbox = <span class="built_in">document</span>.getElementById(<span class="string">'myText'</span>);</span><br><span class="line">EventUtil.addHandler(textbox, <span class="string">'textInput'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    alert(event.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>####设备中的键盘事件</p>
<h3 id="13-4-5-复合事件-缺少支持，用处不大"><a href="#13-4-5-复合事件-缺少支持，用处不大" class="headerlink" title="13.4.5    复合事件(缺少支持，用处不大)"></a>13.4.5    复合事件(缺少支持，用处不大)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isSupported = <span class="built_in">document</span>.implementation.hasFeature(<span class="string">'CompositionEvent'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="13-4-6-变动事件"><a href="#13-4-6-变动事件" class="headerlink" title="13.4.6    变动事件"></a>13.4.6    变动事件</h3><p><strong>说明：</strong>为XML或HTML DOM设计。</p>
<p><strong>DOM2级变动事件</strong></p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>变动事件</td><td>触发</td><td>补充</td></tr><tr><td>DOMSubtreeModified</td><td>在DOM结构中发生任何变化时</td><td>也就是说其它任何变动事件发生时都会触发</td></tr><tr><td>DOMNodeInstead</td><td>一个节点被作为子节点插入到另一个节点</td><td></td></tr><tr><td>DOMNodeRemoved</td><td>将节点从父节点移除时</td><td></td></tr><tr><td>DOMNodeInsertedIntoDocument</td><td>节点被插入文档或通过子树间接插入文档</td><td>在DOMNodeInstead之后触发 </td></tr><tr><td>DOMNodeRemovedFromDocument</td><td>节点从文档移除或通过子树间接移除之前</td><td>在DOMNodeRemoved之后触发</td></tr><tr><td>DOMAttrModified</td><td>特性被修改之后</td><td></td></tr><tr><td>DOMCharacterDataModified</td><td>文本节点的值发生变化</td><td></td></tr></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监测浏览器对变动事件的支持</span></span><br><span class="line"><span class="keyword">var</span> isSupported = <span class="built_in">document</span>.implementation.hasFeature(<span class="string">'MutationEvents'</span>, <span class="string">'2.0'</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/1443501467636.png" alt="Alt text"></p>
<h4 id="1-删除节点"><a href="#1-删除节点" class="headerlink" title="1. 删除节点"></a>1. 删除节点</h4><table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>事件（按触发先后顺序）</td><td>相关属性</td><td>属性值</td><td>dom位置</td><td>触发时机</td><td>冒泡</td><td>备注</td></tr><tr><td colspan="1" rowspan="2">DOMNodeRemoved</td><td>event.realtedNode</td><td>父节点</td><td colspan="1" rowspan="2">可以在DOM的任何层次处理 </td><td>使用removeChild()或replaceChild()删除节点</td><td colspan="1" rowspan="2">是</td><td colspan="1" rowspan="2"></td></tr><tr><td colspan="1">event.target</td><td>被删除的节点</td><td colspan="1"></td></tr><tr><td colspan="1">DOMNodeRemovedFromDocument</td><td colspan="1"></td><td></td><td colspan="1">被删除的子节点本身</td><td colspan="1">被移除的所有子节点会相继触发</td><td colspan="1">否</td><td colspan="1">因为不会冒泡，所有必需给子节点指定事件处理程序才会触发</td></tr></table><br>#### 2. 插入节点<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>事件（按触发先后顺序）</td><td>相关属性</td><td>属性值</td><td>dom位置</td><td>冒泡</td><td>触发时机</td><td>备注</td></tr><tr><td>DOMNodeInserted</td><td>event.relatedNode</td><td>对父节点的引用</td><td>各个层次</td><td>是</td><td>appendChild()、replaceChild()、insertBefore()</td><td></td></tr><tr><td>DOMNodeInsertedIntoDocument</td><td>event.target</td><td>被插入的节点</td><td>被插入的节点</td><td>否</td><td></td><td>必须在插入节点前为其添加事件处理程序</td></tr><tr><td colspan="1">DOMSubtreeModified</td><td colspan="1"></td><td colspan="1"></td><td colspan="1">新插入节点的父节点</td><td colspan="1"></td><td colspan="1"></td><td colspan="1"></td></tr></table><br>### 13.4.7    HTML5事件<br>#### 1. contextmenu事件<br><table cellspacing="0" cellpadding="0" style="width: 100%;"><tbody><tr><td>触发</td><td>用途</td><td>冒泡</td><td>屏蔽方式</td><td>备注</td></tr><tr><td>右键单击(win)；ctrl+单击(mac)</td><td>如何确定显示上下文菜单或如何自定义上下文菜单</td><td>是</td><td>DOM:event.preventDefault(); IE:event.returnValue = false;</td><td></td></tr></tbody></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>);</span><br><span class="line">    EventUtil.addHandler(div, <span class="string">'contextmenu'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        EventUtil.preventDefault(event);</span><br><span class="line">        <span class="keyword">var</span> menu = <span class="built_in">document</span>.getElementById(<span class="string">'myMenu'</span>);</span><br><span class="line">        menu.style.left = event.clientX + <span class="string">'px'</span>;</span><br><span class="line">        menu.style.top = event.clientY + <span class="string">'px'</span>;</span><br><span class="line">        menu.style.visibility = <span class="string">''</span>visable;</span><br><span class="line">    &#125;);</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'myMenu'</span>).style.visibility = <span class="string">'hidden'</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="2-beforeunload事件"><a href="#2-beforeunload事件" class="headerlink" title="2. beforeunload事件"></a>2. beforeunload事件</h4><p><strong>说明：</strong> 这个事件会在浏览器卸载页面之前触发    ，可以通过它来取消卸载并继续使用原有页面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为了显示这个弹出的对话框，必需将event.returnValue的值设置为要显示给用户的字符串。</span></span><br><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'beforeunload'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> message = <span class="string">'确定卸载页面吗？'</span>;</span><br><span class="line">    event.returnValue = message;</span><br><span class="line">    <span class="keyword">return</span> message;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-DOMContentLoaded事件"><a href="#3-DOMContentLoaded事件" class="headerlink" title="3. DOMContentLoaded事件"></a>3. DOMContentLoaded事件</h4><p><strong>说明：</strong>在形成完整的DOM树之后就会触发，不理会图像、JS文件、CSS文件或其它资源是否已经下载完毕。</p>
<ul>
<li>支持在页面下载的早期添加事件处理程序</li>
<li>事件会冒泡到window，但目标实际上是document</li>
<li>event.target值为document，此外event没有额外的信息</li>
</ul>
<p><strong>兼容性：</strong>IE9+    Firefox    Chrome    Safari3.1+    Opera9+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//会在load事件之前触发</span></span><br><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Content loaded'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">不支持DOMContentLoaded的浏览器：</span><br><span class="line"><span class="comment">//在当前JS处理完后立即运行，无法保证在所有环境下都早于load事件被触发。</span></span><br><span class="line">setTime(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//在此添加事件处理程序</span></span><br><span class="line">&#125;,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h4 id="4-readystatechange事件"><a href="#4-readystatechange事件" class="headerlink" title="4. readystatechange事件"></a>4. readystatechange事件</h4><p><strong>说明：</strong>提供与文档加载或元素加载状态有关的信息。<br><strong>特点：</strong></p>
<ul>
<li>对象不一定经历所有阶段，属性变化也不总是连续的；</li>
<li>因此readystatechange 事件经常会少于4次;</li>
<li>与load事件一起使用时，无法预测两个事件触发的先后顺序。</li>
</ul>
<p><strong>注意：</strong>可以很接近地模拟DOMContentLoaded事件，不能保证和load事件以相同的方式触发。<br><strong>兼容性：</strong>IE    Firefox4+    Opera</p>
<table>
<thead>
<tr>
<th>readyState属性值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>uninitialized</td>
<td>对象存在但未初始化</td>
</tr>
<tr>
<td>loading</td>
<td>对象正在加载数据</td>
</tr>
<tr>
<td>loaded</td>
<td>对象加载数据完毕</td>
</tr>
<tr>
<td>interactive</td>
<td>可以操作对象了，但还没有完全加载</td>
</tr>
<tr>
<td>complete</td>
<td>对象已经加载完毕</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'readystateChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">document</span>.readyState == <span class="string">'interactive'</span>)&#123;</span><br><span class="line">         alert(<span class="string">'Content loaded'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'readystatechange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">document</span>.readyState == <span class="string">'interactive'</span> || <span class="built_in">document</span>.readyState == <span class="string">'complete'</span>)&#123;</span><br><span class="line">        EventUtil.removeHandler(<span class="built_in">document</span>, <span class="string">'readystatechange'</span>, <span class="built_in">arguments</span>.callee);</span><br><span class="line">        alert(<span class="string">'Content loaded'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>#####link和script<br><em>script</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    EventUtil.addHandler(script, <span class="string">'readystatecange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(target.readyState == <span class="string">'loaded'</span>)&#123;</span><br><span class="line">            EventUtil.removeHandler(target, <span class="string">'readystatechange'</span>, argument.callee);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;);</span><br><span class="line">    script.src = <span class="string">'example.js'</span>;</span><br><span class="line">    docuemnt.body.appendChild(script);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>link</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> link = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>);</span><br><span class="line">    link.type = <span class="string">'text/css'</span>;</span><br><span class="line">    link.rel = <span class="string">'stylesheet'</span>;</span><br><span class="line">    EventUtil.addHandler(script, <span class="string">'readystatecange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        event = EventUtil.getEvent(event);</span><br><span class="line">        <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(target.readyState == <span class="string">'loaded'</span>)&#123;</span><br><span class="line">            EventUtil.removeHandler(target, <span class="string">'readystatechange'</span>, argument.callee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    link.href = <span class="string">'example.css'</span>;</span><br><span class="line">    docuemnt.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(link);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="5-pageshow-和-pagehide事件"><a href="#5-pageshow-和-pagehide事件" class="headerlink" title="5. pageshow 和 pagehide事件"></a>5. pageshow 和 pagehide事件</h4><blockquote>
<p><strong>往返缓存：</strong>Firefox和Opera的一个特性，这个缓存中保存着页面数据、DOM和JS状态，实际上将整个页面保存在内存里了。<br><strong>注意：</strong>指定了onunload事件处理程序的页面会被自动排除在bfcache之外。</p>
<p><table cellspacing="0" cellpadding="0" style="width: 100%;"><tbody><tr><td>事件名</td><td>触发</td><td>目标</td><td>绑定事件处理</td><td>event.persisted</td><td>兼容性</td></tr><tr><td colspan="1" rowspan="1">pageshow</td><td>重新加载：load事件触发后</td><td colspan="1" rowspan="3">document</td><td colspan="1" rowspan="3">window</td><td>false</td><td colspan="1" rowspan="3">FirefoxSafari5+ChromeOpera</td></tr><tr><td></td><td colspan="1">bfcache中的页面：页面状态完全恢复时</td><td colspan="1">true</td></tr><tr><td>pagehide</td><td>浏览器卸载页面时</td><td>会将该属性设为true</td></tr></tbody></table><br><em>观察pageshow事件</em></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> showCount = <span class="number">0</span>;</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">'Load fired'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'pageshow'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        showCount++;</span><br><span class="line">        alert(<span class="string">'Show has been fired '</span> + showCount + <span class="string">' times.'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p><em>观察pagehide事件</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'pagehide'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Hiding.Persisted?'</span> + event.persisted);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="6-haschange事件"><a href="#6-haschange事件" class="headerlink" title="6. haschange事件"></a>6. haschange事件</h4><p><strong>检测支持情况：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 考虑了IE8和IE7在文档模式下运行会发生BUG的问题</span></span><br><span class="line"><span class="keyword">var</span> isSupported = (<span class="string">'onhashchange'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &amp;&amp;（<span class="built_in">document</span>.documentMode === <span class="literal">undefined</span> || <span class="built_in">document</span>.documentMode &gt; <span class="number">7</span>）;</span><br></pre></td></tr></table></figure>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><tbody><tr><td>触发</td><td>对象</td><td>属性</td><td>属性值</td><td>来源</td><td>兼容性（属性）</td><td>兼容性(事件)</td></tr><tr><td colspan="1" rowspan="2">URL参数列表（包括后面的所有字符串）发生变化时</td><td colspan="1" rowspan="2">window</td><td>oldURL</td><td>变化前的URL</td><td colspan="1" rowspan="2">HTML5</td><td colspan="1" rowspan="2">Firefox6+、Chrome、Opera</td><td colspan="1" rowspan="2">IE8+、Firefox3.6+、Safari5+、Chrome、Opera10.6+</td></tr><tr><td colspan="1">newURL</td><td>变化后的URL</td></tr></tbody></table>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Firefox6+、Chrome、Opera</span></span><br><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'hashchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Old URL:'</span> + event.oldURL + <span class="string">'\nNew URL:'</span> + event.newURL);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用location对象确定当前的参数列表(考虑兼容不支持oldURL和newURL的浏览器)</span></span><br><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'hashChange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">'Current hash:'</span> + location.hash);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="13-4-8-设备事件"><a href="#13-4-8-设备事件" class="headerlink" title="13.4.8 设备事件"></a>13.4.8 设备事件</h3><p><strong>说明：</strong>W3C从2011年开始着手指定一份关于设备事件的新草案，以涵盖不断增长的设备类型并为它们定义相关的事件。</p>
<h4 id="1-orientationchange事件"><a href="#1-orientationchange事件" class="headerlink" title="1. orientationchange事件"></a>1. orientationchange事件</h4><table>
<thead>
<tr>
<th>触发</th>
<th>相关属性</th>
<th>支持</th>
<th>来源</th>
</tr>
</thead>
<tbody>
<tr>
<td>手机屏幕横纵切换方式变化</td>
<td>window.oritentation</td>
<td>Safari</td>
<td>苹果公司</td>
</tr>
</tbody>
</table>
<p>#####window.oritentation 属性</p>
<table>
<thead>
<tr>
<th>window.oritentation</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>肖像模式</td>
</tr>
<tr>
<td>90</td>
<td>向左旋转为横向</td>
</tr>
</tbody>
</table>
<p>|-90|向右旋转为横向|<br>|180|头向下    |无设备支持|<br><em>方式一：</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>);</span><br><span class="line">    div.innerHTML = <span class="string">'Current orentation is '</span> + <span class="built_in">window</span>.orientation;</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">'orientationchange'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        div.innerHTML = <span class="string">'current orientation is '</span> + <span class="built_in">window</span>.orientation;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>方式二：指定<body>元素的onorientationchange特性来指定事件处理程序</em></p>
<h4 id="2-MozOrientation事件"><a href="#2-MozOrientation事件" class="headerlink" title="2. MozOrientation事件"></a>2. MozOrientation事件</h4><h4 id="3-deviceorientation事件"><a href="#3-deviceorientation事件" class="headerlink" title="3. deviceorientation事件"></a>3. deviceorientation事件</h4><h3 id="13-4-9-触摸与手势事件"><a href="#13-4-9-触摸与手势事件" class="headerlink" title="13.4.9    触摸与手势事件"></a>13.4.9    触摸与手势事件</h3><h4 id="1-触摸事件（IOS-2-0开始）"><a href="#1-触摸事件（IOS-2-0开始）" class="headerlink" title="1. 触摸事件（IOS 2.0开始）"></a>1. 触摸事件（IOS 2.0开始）</h4><p><strong>注意：</strong>所有元素都可以触发下面的事件<br><strong>触摸事件（和鼠标事件）发生顺序：</strong></p>
<ol>
<li>touchstart</li>
<li>mouseover</li>
<li>mousemove(一次)</li>
<li>mousedown</li>
<li>mouseup</li>
<li>click</li>
<li>touched</li>
</ol>
<p><strong>兼容性</strong></p>
<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>设备类型</td><td>浏览器</td><td>多点触控支持</td></tr><tr><td colspan="1" rowspan="6">移动设备</td><td>ios的safari</td><td>是</td></tr><tr><td>Android版webkit</td><td colspan="1" rowspan="7">否</td></tr><tr><td>bada版Dolfin</td></tr><tr><td>os6+中的BlackBerry Webkit</td></tr><tr><td>Opera Mobile 10.1+</td></tr><tr><td>LG专有OD中的Phantom浏览器</td></tr><tr><td colspan="1" rowspan="2">PC</td><td>FireFox 6+</td></tr><tr><td>Chrome</td></tr></table>

<table>
<thead>
<tr>
<th>触摸事件</th>
<th>触发</th>
<th>备注</th>
<th>是否冒泡</th>
</tr>
</thead>
<tbody>
<tr>
<td>touchstart</td>
<td>手指触摸屏幕时触发    即使已经有一个手指放在了屏幕上也会触发</td>
<td>是</td>
</tr>
<tr>
<td>touchmove</td>
<td>手指在屏幕上连续地触发</td>
<td>在这个事件发生期间调用preventDefault()可以阻止滚动</td>
<td>是</td>
</tr>
<tr>
<td>touchend</td>
<td>手指从屏幕上移开时</td>
<td>是</td>
</tr>
<tr>
<td>touchcancel</td>
<td>系统停止跟踪触摸    文档没有明确说明</td>
<td>是</td>
</tr>
</tbody>
</table>
<p><em>触摸事件额外属性（event.property）</em></p>
<ul>
<li>event.touches：当前跟踪的触摸操作的Touch对象数组</li>
<li>event.targetTouchs：特定于事件目标的Touch对象的数组</li>
<li>event.changeTouches：自从上次触摸以来发生了什么改变的Touch对象的数组</li>
</ul>
<p><em>Touch对象：包含触摸目标DOM和相关信息</em></p>
<ul>
<li>clientX:触摸目标在视口中的x坐标</li>
<li>clientY:触摸目标在视口中的y坐标</li>
<li>identifier：标识触摸的唯一ID</li>
<li>pageX：触摸目标在页面中的x坐标</li>
<li>pageY：触摸目标在页面中的y坐标</li>
<li>screenX：触摸目标在屏幕中的x坐标</li>
<li>screenY：触摸目标在屏幕中的y坐标</li>
<li>target：触摸的DOM节点目标</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*跟踪屏幕上发生的一次触摸操作</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleTouchEvent</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//只跟踪一次触摸</span></span><br><span class="line">    <span class="keyword">if</span>(event.touches.length == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> output = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>);</span><br><span class="line">        <span class="keyword">switch</span>(event.type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchstart'</span>:</span><br><span class="line">                output.innerHTML = <span class="string">'Touch started ('</span>+ event.touches[<span class="number">0</span>].clientX +<span class="string">','</span>+ event.touches[<span class="number">0</span>].clientY +<span class="string">')'</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchend'</span>:</span><br><span class="line">                output.innerHTML = <span class="string">'Touch ended ('</span>+ event.changedTouches[<span class="number">0</span>].clientX +<span class="string">','</span>+ event.changedTouches[<span class="number">0</span>].clientY +<span class="string">')'</span>;   </span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchmove'</span>:</span><br><span class="line">                event.preventDefault();</span><br><span class="line">                output.innerHTML += <span class="string">'Touch moved ('</span>+ event.changedTouches[<span class="number">0</span>].clientX +<span class="string">','</span>+ event.changedTouches[<span class="number">0</span>].clientY +<span class="string">')'</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'touchstart'</span>, handleTouchEvent);</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'touchend'</span>, handleTouchEvent);</span><br><span class="line">    EventUtil.addHandler(<span class="built_in">document</span>, <span class="string">'touchmove'</span>, handleTouchEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-手势事件（IOS-2-0开始）"><a href="#2-手势事件（IOS-2-0开始）" class="headerlink" title="2. 手势事件（IOS 2.0开始）"></a>2. 手势事件（IOS 2.0开始）</h4><p><strong>触发：</strong>两个手指触摸屏幕时就会产生手势<br><strong>用途：</strong></p>
<ol>
<li>改变显示项的大小</li>
<li>旋转显示项<br><strong>注意：</strong></li>
</ol>
<ul>
<li>两个手指必需同时位于接受容器（注册事件的元素）时才会触发</li>
<li>触摸事件和手势事件之间存在一些关联<br><strong>事件</strong></li>
</ul>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>gesturestart</td>
<td>当一个手指已经按在屏幕上而另一个手指又触摸屏幕时触发</td>
</tr>
<tr>
<td>gesturechange</td>
<td>当触摸屏幕的任何一个手指的位置发生变化时触发</td>
</tr>
<tr>
<td>gestureend</td>
<td>当任何一个手指从屏幕上面移开时触发</td>
</tr>
</tbody>
</table>
<p><strong>event事件对象额外的属性：</strong></p>
<ul>
<li><p><strong>event.rotation</strong>属性：手指变化引起的旋转角度，负值表示逆时针旋转，正值表示顺时针旋转（该值从0开始）</p>
</li>
<li><p><strong>event.scale</strong>属性：两个手指间距离的变化，这个值从1开始，随距离拉大而增长，随距离缩短而减小</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleGestureEvent</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> output = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>);</span><br><span class="line">    <span class="keyword">switch</span>(event.type)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'gesturestart'</span>:</span><br><span class="line">            output.innerHTML = <span class="string">'Gesture started (rotation='</span>+ event.rotation +<span class="string">',scale='</span>+ event.scale +<span class="string">')'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'gestureend'</span>:</span><br><span class="line">            output.innerHTML = <span class="string">'Gesture ended (rotation='</span>+ event.rotation +<span class="string">',scale='</span>+ event.scale +<span class="string">')'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'gesturechange'</span>:</span><br><span class="line">            output.innerHTML = <span class="string">'Gesture changed (rotation='</span>+ event.rotation +<span class="string">',scale='</span>+ event.scale +<span class="string">')'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'gesturestart'</span>, handleGestureEvent, <span class="literal">false</span>);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'gestureend'</span>, handleGestureEvent, <span class="literal">false</span>);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'gesturechange'</span>, handleGestureEvent, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<h2 id="13-5-内存和性能"><a href="#13-5-内存和性能" class="headerlink" title="13.5    内存和性能"></a>13.5    内存和性能</h2><h3 id="13-5-1-事件委托"><a href="#13-5-1-事件委托" class="headerlink" title="13.5.1    事件委托"></a>13.5.1    事件委托</h3><p><strong>优点：</strong></p>
<ul>
<li>如果委托给document，无需等待DOMContentLoaded或load事件</li>
<li>设置的事件处理程序更少</li>
<li>占用内存少，提升整体性能</li>
</ul>
<p><strong>适合事件:</strong>click、mousedown、mouseup、keydown、keyup、keypress</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"myLinks"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"goSomewhere"</span>&gt;</span>Go somewhere<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"doSomething"</span>&gt;</span>Do something<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"sayHi"</span>&gt;</span>Say hi<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = <span class="built_in">document</span>.getElementById(<span class="string">'myLinks'</span>);</span><br><span class="line">EventUtil.addHandler(list, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	event = EventUtil.getEvent();</span><br><span class="line">	<span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">	<span class="keyword">switch</span>(target.id)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'doSomeing'</span>:</span><br><span class="line">			<span class="built_in">document</span>.title = <span class="string">'I changed the document\'s title'</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'goSomewhere'</span>:</span><br><span class="line">			location.href = <span class="string">'http://www.wrox.com'</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'sayHi'</span>:</span><br><span class="line">			alert(<span class="string">'hi'</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="13-5-2-移除事件处理程序"><a href="#13-5-2-移除事件处理程序" class="headerlink" title="13.5.2    移除事件处理程序"></a>13.5.2    移除事件处理程序</h3><p>####问题一：每个事件处理程序与绑定的元素之间存在连接，链接越多，页面越慢<br>解决：</p>
<ul>
<li>采用事件委托限制连接数量</li>
<li>在不需要时移除事件处理程序<br>###问题二：空事件处理程序<br><strong>起因：</strong></li>
</ul>
<ol>
<li>移除带有事件处理程序的元素：removeChild()、replaceChild()或编辑innerHTML;</li>
<li>卸载页面前没有清理干净事件处理程序</li>
</ol>
<p><strong>解决：</strong><br><em>方式1.    在移除元素前移除事件处理程序</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"myBtn"</span> <span class="attr">value</span>=<span class="string">"Click Me"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//限执行操作</span></span><br><span class="line">    btn.onclick = <span class="literal">null</span>;<span class="comment">//移除事件</span></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'myDiv'</span>).innerHTML = <span class="string">'Processing...'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>方式2.    为onunload事件绑定事件处理程序，移除所有事件处理程序</em></p>
<h2 id="13-6-模拟事件"><a href="#13-6-模拟事件" class="headerlink" title="13.6    模拟事件"></a>13.6    模拟事件</h2><p><strong>说明：</strong>使用JS在任意时刻触发特定的事件，如同浏览器创建的时间一样。</p>
<h3 id="13-6-1-DOM中的事件模拟"><a href="#13-6-1-DOM中的事件模拟" class="headerlink" title="13.6.1    DOM中的事件模拟"></a>13.6.1    DOM中的事件模拟</h3><p>####（1）创建事件<br><strong>document.createEvent()：创建event对象</strong><br><strong>返回值：</strong>事件对象<br><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th>DOM2</th>
<th>DOM3</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>UIEvents</td>
<td>UIEvent</td>
<td>一般化UI事件</td>
<td>鼠标事件和键盘事件都继承自UI事件</td>
</tr>
<tr>
<td>MouseEvents</td>
<td>MouseEvent</td>
<td>一般化的鼠标事件</td>
</tr>
<tr>
<td>MutationEvents</td>
<td>MutationEvent</td>
<td>一般化的DOM变动事件</td>
</tr>
<tr>
<td>HTMLEvents</td>
<td>被分散到其它类别</td>
<td>一般化HTML事件</td>
</tr>
</tbody>
</table>
<p>####（2）触发事件<br><strong>dom.dispatchEvent()：触发事件，dom是任何支持事件的dom节点</strong><br><strong>参数：</strong>document.createEvent()创建的事件对象</p>
<h3 id="13-6-1-模拟鼠标事件"><a href="#13-6-1-模拟鼠标事件" class="headerlink" title="13.6.1    模拟鼠标事件"></a>13.6.1    模拟鼠标事件</h3><p>####event.initMouseEvent():指定与鼠标事件有关的信息<br><strong>调用者：</strong>document.createEvent(‘MouseEvents’)的返回值<br><strong>参数（15）：</strong>与鼠标事件中每个典型的属性一一对应<br><strong>注意：</strong></p>
<ul>
<li>前4个参数对正确激发事件至关重要，因为浏览器要用到</li>
<li>剩下的所有参数只在事件的处理程序中才会用到</li>
<li>当把event对象传给dispatchEvent()方法时，这个对象的target属性会自动设置<table cellspacing="0" cellpadding="0" style="width: 100%;"><tr><td>参数</td><td>数据类型</td><td>表示</td><td>补充</td></tr><tr><td>type</td><td>string</td><td>要触发的事件类型</td><td>例如”click”</td></tr><tr><td>bubbles</td><td>boolean</td><td>是否冒泡</td><td>推荐设置为true</td></tr><tr><td>cancelables</td><td>boolean</td><td>事件是否可以取消</td><td>推荐设置为true</td></tr><tr><td>view</td><td>AvbstractView</td><td>与事件关联的视图</td><td>几乎总是要设置为document.defaultView</td></tr><tr><td>detail</td><td wiz_tag_attr_bk_color="rgb(184, 219, 255)" colspan="1" rowspan="5">整数<br><br><br><br></td><td>与事件相关的详细信息</td><td>一般只有事件处理程序使用，通常设置为0</td></tr><tr><td>screenX</td><td>事件相对于屏幕的X坐标</td><td><br></td></tr><tr><td>screenY</td><td>事件相对于屏幕的Y坐标</td><td><br></td></tr><tr><td>clientX</td><td>事件相对于视口的X坐标</td><td><br></td></tr><tr><td>clientyY</td><td>事件相对于视口的Y坐标<br></td><td><br></td></tr><tr><td>ctrlKey</td><td wiz_tag_attr_bk_color="rgb(184, 219, 255)" colspan="1" rowspan="4">boolean<br><br><br></td><td>是否按下ctrl键</td><td wiz_tag_attr_bk_color="rgb(184, 219, 255)" colspan="1" rowspan="4">默认false<br><br><br></td></tr><tr><td>altKey</td><td>是否按下alt键<br></td></tr><tr><td>shiftKey</td><td>是否按下shift键<br></td></tr><tr><td>metaKey</td><td>是否按下Meta键<br></td></tr><tr><td>button</td><td>整数</td><td>是否按下哪一个鼠标键<br></td><td>默认0</td></tr><tr><td>relatedTarget</td><td>object</td><td>与事件相关的对象</td><td>只在模拟mouseover或mouseout 时使用</td></tr></table>

</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">'myBtn'</span>);</span><br><span class="line"><span class="comment">//创建事件对象</span></span><br><span class="line"><span class="keyword">var</span> event = <span class="built_in">document</span>.createEvent(<span class="string">'MouseEvents'</span>);</span><br><span class="line"><span class="comment">//初始化事件对象</span></span><br><span class="line">event.initMouseEvent(<span class="string">'click'</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="built_in">document</span>.defaultView, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="comment">//触发事件</span></span><br><span class="line">btn.dispatchEvent(event);</span><br></pre></td></tr></table></figure>
<h3 id="13-6-2-模拟键盘事件"><a href="#13-6-2-模拟键盘事件" class="headerlink" title="13.6.2    模拟键盘事件"></a>13.6.2    模拟键盘事件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">Document</span>&gt;</span><span class="tag">&lt;/<span class="name">Document</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"test.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"test.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: red;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">	<span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> <span class="selector-class">.active</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(e.keyCode);</span><br><span class="line">	<span class="keyword">if</span> (e.keyCode == <span class="number">40</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> now = <span class="built_in">document</span>.querySelector(<span class="string">'.active'</span>);</span><br><span class="line">		<span class="keyword">var</span> next = now.nextElementSibling;</span><br><span class="line">		<span class="keyword">if</span> (next) &#123;</span><br><span class="line">			now.className = <span class="string">''</span>;</span><br><span class="line">			next.className = <span class="string">'active'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (e.keyCode == <span class="number">38</span>) &#123;</span><br><span class="line">		<span class="keyword">var</span> now = <span class="built_in">document</span>.querySelector(<span class="string">'.active'</span>);</span><br><span class="line">		<span class="keyword">var</span> prev = now.previousElementSibling;</span><br><span class="line">		<span class="keyword">if</span> (prev) &#123;</span><br><span class="line">			now.className = <span class="string">''</span>;</span><br><span class="line">			prev.className = <span class="string">'active'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">troggleNext</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> event = <span class="built_in">document</span>.createEvent(<span class="string">'Events'</span>);</span><br><span class="line">	event.initEvent(<span class="string">'keyup'</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">	event.view = <span class="built_in">document</span>.defaultView;</span><br><span class="line">	event.altKey =  <span class="literal">false</span>;</span><br><span class="line">	event.ctrlKey = <span class="literal">false</span>;</span><br><span class="line">	event.shiftKey = <span class="literal">false</span>;</span><br><span class="line">	event.metaKey = <span class="literal">false</span>;</span><br><span class="line">	event.keyCode = <span class="number">40</span>;</span><br><span class="line">	event.charCode = <span class="number">40</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">document</span>.body.dispatchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</script>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/js/" rel="tag">#js</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/09/04/JSHPD_3rd_07_函数表达式/" rel="next" title="07 函数表达式">
                <i class="fa fa-chevron-left"></i> 07 函数表达式
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/09/18/HTTP权威指南_1_HTTP概述/" rel="prev" title="HTTP概述">
                HTTP概述 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2014/09/10/JSHPD_3rd_13_事件/"
           data-title="13 事件" data-url="http://laputa-er.github.io/2014/09/10/JSHPD_3rd_13_事件/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">191</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#DOM3级出现-：-API变得更加繁琐。"><span class="nav-text">+ DOM3级出现    ：    API变得更加繁琐。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-事件流"><span class="nav-text">13.1    事件流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-1-事件冒泡-：-最具体的元素-gt-…-gt-document"><span class="nav-text">13.1.1    事件冒泡    ：    最具体的元素->…->document</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-2-事件捕获-：-document-gt-html-gt-body-gt-…-gt-最具体的元素"><span class="nav-text">13.1.2    事件捕获    ：      document->html->body->…->最具体的元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-3-DOM事件流"><span class="nav-text">13.1.3    DOM事件流</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-事件处理程序"><span class="nav-text">13.2    事件处理程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-1-HTML事件处理程序"><span class="nav-text">13.2.1    HTML事件处理程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-2-DOM0级事件处理程序-将函数赋值给一个事件处理程序属性"><span class="nav-text">13.2.2    DOM0级事件处理程序    :    将函数赋值给一个事件处理程序属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-3-DOM2级事件处理程序"><span class="nav-text">13.2.3    DOM2级事件处理程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-4-IE事件处理程序"><span class="nav-text">13.2.4    IE事件处理程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-3-事件对象"><span class="nav-text">13.3    事件对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3-2-IE中的事件对象"><span class="nav-text">13.3.2    IE中的事件对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3-3-跨浏览器的事件对象"><span class="nav-text">13.3.3    跨浏览器的事件对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-4-事件类型"><span class="nav-text">13.4    事件类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-4-1-UI事件"><span class="nav-text">13.4.1    UI事件</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
