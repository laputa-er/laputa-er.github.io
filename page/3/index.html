<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/3/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/3/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_3  音频视频处理/" itemprop="url">
                  3 音频视频处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:52+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_3  音频视频处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_3  音频视频处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-iOS-API视频的播放和录制"><a href="#3-1-iOS-API视频的播放和录制" class="headerlink" title="3.1    iOS API视频的播放和录制"></a>3.1    iOS API视频的播放和录制</h2><blockquote>
<p><strong>注意：</strong><code>MPMoviePlayerViewController</code>在<code>iOS9中</code>过时了</p>
</blockquote>
<h3 id="3-1-1-播放视频"><a href="#3-1-1-播放视频" class="headerlink" title="3.1.1    播放视频"></a>3.1.1    播放视频</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_video1.gif" alt="Alt text|200x350"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> pc:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        pc = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSBundle</span>.mainBundle().<span class="type">URLForResource</span>(<span class="string">"video"</span>, withExtension: <span class="string">"mp4"</span>))</span><br><span class="line">        presentViewController(pc, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-录制视频"><a href="#3-1-2-录制视频" class="headerlink" title="3.1.2    录制视频"></a>3.1.2    录制视频</h3><blockquote>
<p><strong>注意：</strong> xcode 的虚拟机不支持使用相机，模拟使用相机只能选择真机！<br><strong>技巧：</strong>调试时可以通过<code>window-&gt;Devices</code>，在设备管理面板选择要管理的设备进行操作（比如截屏）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MobileCoreServices<span class="comment">// 录制视频使用到的库</span></span><br><span class="line"><span class="keyword">import</span> MediaPlayer<span class="comment">// 播放视频用到的库</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UIImagePickerControllerDelegate</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片选择器</span></span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">UIImagePickerController</span>!<span class="comment">// 可以选择从图库或摄像头中选择图片或视频（源为摄像头意味着拍照或视频）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> videoUrl:<span class="type">NSURL</span>?</span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录制</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">recVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        picker = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        picker.mediaTypes = [kUTTypeMovie <span class="keyword">as</span> <span class="type">String</span>]</span><br><span class="line">        picker.sourceType = <span class="type">UIImagePickerControllerSourceType</span>.<span class="type">Camera</span><span class="comment">// 设置源通过摄像头</span></span><br><span class="line">        picker.cameraCaptureMode = <span class="type">UIImagePickerControllerCameraCaptureMode</span>.<span class="type">Video</span><span class="comment">// 设置摄像头为录制视频模式</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = videoUrl &#123;</span><br><span class="line">            player = <span class="type">MPMoviePlayerViewController</span>(contentURL: url)</span><br><span class="line">            presentViewController(player, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选中了视频时（录制完成后）被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(picker: UIImagePickerController, didFinishPickingImage image: UIImage, editingInfo: [String : AnyObject]?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取录制好的视频资源的url地址</span></span><br><span class="line">        videoUrl = editingInfo![<span class="type">UIImagePickerControllerMediaURL</span>] <span class="keyword">as</span>? <span class="type">NSURL</span></span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消录制视频时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerControllerDidCancel</span><span class="params">(picker: UIImagePickerController)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS音频相关-API-的使用"><a href="#3-2-iOS音频相关-API-的使用" class="headerlink" title="3.2    iOS音频相关 API 的使用"></a>3.2    iOS音频相关 API 的使用</h2><h3 id="3-2-1-播放声音"><a href="#3-2-1-播放声音" class="headerlink" title="3.2.1    播放声音"></a>3.2.1    播放声音</h3><blockquote>
<p><strong>说明：</strong>给出两种方式</p>
<ul>
<li>使用<code>AVAudioPlayer</code>播放音乐文件</li>
<li>使用<code>MediaPlayer</code>播放音乐</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> aPlayer:<span class="type">AVAudioPlayer</span>!</span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 暂定</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">pauseBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.pause()<span class="comment">// 暂停后音乐仍然处在准备播放的状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.stop()<span class="comment">// 通知后音乐不会处在准备播放状态，但会记住停止时的位置</span></span><br><span class="line">        aPlayer.currentTime = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另一种方式播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playSongBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 初始化播放控制器</span></span><br><span class="line">        <span class="keyword">let</span> p = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        presentViewController(p, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 初始化 AVAudioPlayer</span></span><br><span class="line">            aPlayer = <span class="keyword">try</span> <span class="type">AVAudioPlayer</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"failed"</span>)</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-播放乐库音乐"><a href="#3-2-2-播放乐库音乐" class="headerlink" title="3.2.2    播放乐库音乐"></a>3.2.2    播放乐库音乐</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>（<code>ViewController</code>）采纳<code>MPMediaPickerControllerDelegate</code>协议</li>
<li>初始化媒体选择控制器（<code>MPMediaPickerController</code>）和音乐播放控制器（<code>MPMusicPlayerController</code>）</li>
<li>实现采纳协议的相关方法</li>
</ol>
<p><strong>注意：</strong>在虚拟机中是不能使用音乐库的</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">MPMediaPickerControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">MPMediaPickerController</span>!<span class="comment">// 选择音乐控制器</span></span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMusicPlayerController</span>!<span class="comment">// 播放音乐控制器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSelectMusicClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐完成后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPicker</span><span class="params">(mediaPicker: MPMediaPickerController, didPickMediaItems mediaItemCollection: MPMediaItemCollection)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭视频选择控制器</span></span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 将选中的音乐加入到播放列表</span></span><br><span class="line">        player.setQueueWithItemCollection(mediaItemCollection)</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        player.play()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取选中的第一首歌的名字</span></span><br><span class="line">        <span class="keyword">let</span> firstName:<span class="type">AnyObject</span> = mediaItemCollection.items[<span class="number">0</span>].valueForProperty(<span class="type">MPMediaItemPropertyTitle</span>)!</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(firstName)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消播放时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPickerDidCancel</span><span class="params">(mediaPicker: MPMediaPickerController)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cancel"</span>)</span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        picker = <span class="type">MPMediaPickerController</span>(mediaTypes: <span class="type">MPMediaType</span>.<span class="type">Music</span>)</span><br><span class="line">        picker.allowsPickingMultipleItems = <span class="literal">true</span><span class="comment">// 可以选择多个</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        </span><br><span class="line">        player = <span class="type">MPMusicPlayerController</span>.systemMusicPlayer()<span class="comment">// 创建全局音乐播放器(程序退出后仍可以播放)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-录制声音"><a href="#3-2-3-录制声音" class="headerlink" title="3.2.3    录制声音"></a>3.2.3    录制声音</h3><blockquote>
<p><strong>疑问：</strong>下面程序找到的<code>Documents</code>文件夹路径不可用，竟然在<code>Library</code>下面，但下面其实没有<code>Documents</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E/Library/Documentation/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cd</span> /Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E</span><br><span class="line"></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── Documents</span><br><span class="line">├── Library</span><br><span class="line">│   ├── Caches</span><br><span class="line">│   │   └── Snapshots</span><br><span class="line">│   │       └── com.earth.L0204-----</span><br><span class="line">│   │           ├── 50998B49-4017-4DAA-A8BB-49F0A32325DD@2x.png</span><br><span class="line">│   │           └── C0EB8483-DCD1-41F9-8F4D-1AADC05666E1@2x.png</span><br><span class="line">│   └── Preferences</span><br><span class="line">└── tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> avRec:<span class="type">AVAudioRecorder</span>!<span class="comment">// 录音器</span></span><br><span class="line">    <span class="keyword">var</span> audioFileUrl:<span class="type">NSURL</span>!<span class="comment">// 保存地址</span></span><br><span class="line">    <span class="keyword">var</span> avPlayer:<span class="type">AVAudioPlayer</span>!<span class="comment">// 播放器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">startRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"start rec"</span>)</span><br><span class="line">        avRec.record()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopRecBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"stop rec"</span>)</span><br><span class="line">        avRec.stop()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"play rec：\(audioFileUrl)"</span>)</span><br><span class="line">        avPlayer = <span class="keyword">try</span>? <span class="type">AVAudioPlayer</span>(contentsOfURL: audioFileUrl)</span><br><span class="line">        avPlayer.prepareToPlay()</span><br><span class="line">        avPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        audioFileUrl = (<span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">NSURL</span>).<span class="type">URLByAppendingPathComponent</span>(<span class="string">"rec"</span>)</span><br><span class="line">        avRec = <span class="keyword">try</span>? <span class="type">AVAudioRecorder</span>(<span class="type">URL</span>: audioFileUrl,</span><br><span class="line">                                        settings: [:])</span><br><span class="line">        avRec.prepareToRecord()</span><br><span class="line"><span class="comment">// 查看文件路径</span></span><br><span class="line">        <span class="keyword">let</span> sp = <span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sp &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(item)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_2  网络通信/" itemprop="url">
                  2 网络通信
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:10+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_2  网络通信/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_2  网络通信/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="2-1-iOS-HTTP通信"><a href="#2-1-iOS-HTTP通信" class="headerlink" title="2.1    iOS-HTTP通信"></a>2.1    iOS-HTTP通信</h2><h3 id="2-1-1-同步加载网络数据"><a href="#2-1-1-同步加载网络数据" class="headerlink" title="2.1.1    同步加载网络数据"></a>2.1.1    同步加载网络数据</h3><blockquote>
<p><strong>说明：</strong>介绍两种方式</p>
<ul>
<li><code>NSString</code>提供的构造器</li>
<li><code>NSURLConnection.sendSynchronousRequest</code>方法（iOS 9中已过时）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPageByNSString()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSString）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSString</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> str = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> data = <span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(str)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSURLConnection）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSURLConnection</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> resp:<span class="type">NSURLResponse</span>?</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">NSURLConnection</span>.sendSynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://hikexueyuan.com"</span>)!), returningResponse: &amp;resp)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(resp)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-异步加载网络数据"><a href="#2-2-2-异步加载网络数据" class="headerlink" title="2.2.2    异步加载网络数据"></a>2.2.2    异步加载网络数据</h3><blockquote>
<p><strong>说明：</strong><code>NSURLConnection.sendAsynchronousRequest</code>（在<code>iOS9 中过时</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPage()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPage</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!), queue: <span class="type">NSOperationQueue</span>()) &#123;(resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> e = error &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"请求失败:\(e)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="type">NSString</span>(data: data!, encoding: <span class="type">NSUTF8StringEncoding</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-搭建J2E集成开发环境"><a href="#2-2-3-搭建J2E集成开发环境" class="headerlink" title="2.2.3 搭建J2E集成开发环境"></a>2.2.3 搭建J2E集成开发环境</h3><h4 id="2-2-3-1-安装-Apache-Tomcat"><a href="#2-2-3-1-安装-Apache-Tomcat" class="headerlink" title="2.2.3.1    安装 Apache Tomcat"></a>2.2.3.1    安装 Apache Tomcat</h4><blockquote>
<p><strong>下载 Apache Tomcat：</strong><a href="http://tomcat.apache.org/download-80.cgi" target="_blank" rel="external">http://tomcat.apache.org/download-80.cgi</a></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.30.32.png" alt="Alt text"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /usr/<span class="built_in">local</span></span><br><span class="line">$ mv ~/Downloads/apache-tomcat-8.0.33 /usr/<span class="built_in">local</span></span><br><span class="line">$ sudo ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/apache-tomcat-8.0.33 /Library/Tomcat8</span><br><span class="line">$ chown -R  tonyearth /Library/Tomcat8</span><br><span class="line">$ sudo chown -R  tonyearth /Library/Tomcat8/bin/*.sh</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-2-安装-Tomcat-Controller"><a href="#2-2-3-2-安装-Tomcat-Controller" class="headerlink" title="2.2.3.2    安装 Tomcat Controller"></a>2.2.3.2    安装 Tomcat Controller</h4><blockquote>
<p><strong>下载 Tomcat Controller：</strong><a href="http://tomcat-controller.en.softonic.com/mac/download#downloading" target="_blank" rel="external">http://tomcat-controller.en.softonic.com/mac/download#downloading</a></p>
</blockquote>
<h4 id="2-2-3-3-安装-eclispe"><a href="#2-2-3-3-安装-eclispe" class="headerlink" title="2.2.3.3    安装 eclispe"></a>2.2.3.3    安装 eclispe</h4><blockquote>
<p><strong>下载eclipse：</strong><a href="http://www.eclipse.org/downloads/" target="_blank" rel="external">http://www.eclipse.org/downloads/</a></p>
</blockquote>
<h5 id="创建Dynamic-Web-Project"><a href="#创建Dynamic-Web-Project" class="headerlink" title="创建Dynamic Web Project"></a>创建Dynamic Web Project</h5><ol>
<li>开始创建新项目<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.45.png" alt="Alt text|300x150"></li>
<li>New Runtime<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.56.png" alt="Alt text|300x200"></li>
<li>选择前面安装好的 Tomecat8 的安装目录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.17.png" alt="Alt text|300x120"></li>
<li>创建 JSP文件 测试<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.39.14.png" alt="Alt text|300x200"></li>
</ol>
<h3 id="2-2-4-通过GET-POST方式与服务器通信"><a href="#2-2-4-通过GET-POST方式与服务器通信" class="headerlink" title="2.2.4    通过GET/POST方式与服务器通信"></a>2.2.4    通过GET/POST方式与服务器通信</h3><h4 id="2-2-4-1-后端"><a href="#2-2-4-1-后端" class="headerlink" title="2.2.4.1    后端"></a>2.2.4.1    后端</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461253557430.png" alt="Alt text|200x200"></p>
<p><em>returnParas.jsp</em></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">if</span> (name != <span class="keyword">null</span>) &#123;</span><br><span class="line">	out.print(<span class="string">"Hello "</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	out.print(<span class="string">"No Args"</span>);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-2-客户端"><a href="#2-2-4-2-客户端" class="headerlink" title="2.2.4.2    客户端"></a>2.2.4.2    客户端</h4><blockquote>
<p><strong>注意：</strong>下面请求使用的<code>API</code>在<code>iOS9</code>中已过时<br><strong>技巧：</strong>网络请求交给子线程而不是主线程处理，不占用主线程的资源，从而不带来界面卡顿的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462710986603_get.gif" alt="Alt text|300x200"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textInput: <span class="type">UITextField</span>!<span class="comment">// 输入请求参数</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textShow: <span class="type">UITextView</span>!<span class="comment">// 展示请求会的结果</span></span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnRequestPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        testGet()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送 get 请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testGet</span><span class="params">()</span></span>-&gt; () &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建一个线程发起请求，不占用主线程的资源</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp?name=\(name)"</span>)!), queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                <span class="comment">// 交给主线程处理</span></span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="comment">// self.textShow 是主线程的控件，因此必须在主线程中处理</span></span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送post请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testPost</span><span class="params">()</span></span>-&gt;() &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建并设置请求</span></span><br><span class="line">        <span class="keyword">let</span> req = <span class="type">NSMutableURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp"</span>)!)</span><br><span class="line">        req.<span class="type">HTTPMethod</span> = <span class="string">"POST"</span></span><br><span class="line">        req.<span class="type">HTTPBody</span> = <span class="type">NSString</span>(string: <span class="string">"name=\(name)"</span>).dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(req, queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_1  数据处理/" itemprop="url">
                  1 数据处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:02:28+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_1  数据处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_1  数据处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-操作plist数据"><a href="#1-1-操作plist数据" class="headerlink" title="1.1    操作plist数据"></a>1.1    操作plist数据</h2><h3 id="1-1-1-plist数据介绍"><a href="#1-1-1-plist数据介绍" class="headerlink" title="1.1.1    plist数据介绍"></a>1.1.1    plist数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解<code>plist</code>数据格式以及如何编辑<code>plist</code>文件。</p>
</blockquote>
<h3 id="1-1-2-plist数组解析"><a href="#1-1-2-plist数组解析" class="headerlink" title="1.1.2    plist数组解析"></a>1.1.2    plist数组解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析plist数组。</p>
</blockquote>
<p><em>TestArr.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-16%20%E4%B8%8B%E5%8D%8811.46.38.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取出plist中的数据（数组）</span></span><br><span class="line"><span class="keyword">let</span> arr = <span class="type">NSArray</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestArr"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Optional((</span><br><span class="line">    human,</span><br><span class="line">    bear,</span><br><span class="line">    elephant,</span><br><span class="line">    wolf,</span><br><span class="line">    monkey,</span><br><span class="line">    tiger</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<h3 id="1-1-3-plist字典解析"><a href="#1-1-3-plist字典解析" class="headerlink" title="1.1.3    plist字典解析"></a>1.1.3    plist字典解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析<code>plist</code>字典。</p>
</blockquote>
<p><em>TestDic.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460822236961.png" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dict = <span class="type">NSDictionary</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestDic"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dict)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Optional(&#123;</span><br><span class="line">    event = film;</span><br><span class="line">    members =     (</span><br><span class="line">        me,</span><br><span class="line">        lili,</span><br><span class="line">        xiaoli</span><br><span class="line">    );</span><br><span class="line">    time = <span class="string">"2016\U5e744\U670816\U65e5\U5468\U516d\U4e0b\U534811:54"</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="1-2-CoreData"><a href="#1-2-CoreData" class="headerlink" title="1.2    CoreData"></a>1.2    CoreData</h2><h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><blockquote>
<p><strong>官网：</strong><a href="http://sqlite.org/" target="_blank" rel="external">http://sqlite.org/</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_coredata.gif" alt="案例| 200x150"></p>
</blockquote>
<h3 id="1-2-1-创建使用CoreData的项目"><a href="#1-2-1-创建使用CoreData的项目" class="headerlink" title="1.2.1    创建使用CoreData的项目"></a>1.2.1    创建使用<code>CoreData</code>的项目</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍<code>SQLite</code>以及如何创建一个使用<code>CoreData</code>的项目。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.32.25.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作sqlite的上下文环境</span></span><br><span class="line"><span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-设计数据结构"><a href="#1-2-2-设计数据结构" class="headerlink" title="1.2.2    设计数据结构"></a>1.2.2    设计数据结构</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用<code>Xcode</code>设计数据库的结构。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.40.34.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-2-3-插入数据"><a href="#1-2-3-插入数据" class="headerlink" title="1.2.3    插入数据"></a>1.2.3    插入数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何插入一条数据。</p>
</blockquote>
<h4 id="1-2-3-1-插入数据"><a href="#1-2-3-1-插入数据" class="headerlink" title="1.2.3.1    插入数据"></a>1.2.3.1    插入数据</h4><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 1. 获取操作sqlite的上下文环境</span></span><br><span class="line">        <span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        <span class="comment">// 2. 为 Users 表插入一行数据</span></span><br><span class="line">        <span class="comment">// 创建一行（字段为默认值）</span></span><br><span class="line">        <span class="keyword">let</span> row:<span class="type">AnyObject</span> = <span class="type">NSEntityDescription</span>.insertNewObjectForEntityForName(<span class="string">"Users"</span>, inManagedObjectContext:context)</span><br><span class="line">        <span class="comment">// 设置 name 字段</span></span><br><span class="line">        row.setValue(<span class="string">"jikexueyuan"</span>, forKey:<span class="string">"name"</span>)</span><br><span class="line">        <span class="comment">// 设置 age 字段</span></span><br><span class="line">        row.setValue(<span class="number">10</span>, forKey: <span class="string">"age"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 持久化</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> context.save()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Error"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-3-2-查看SQLite文件地址"><a href="#1-2-3-2-查看SQLite文件地址" class="headerlink" title="1.2.3.2    查看SQLite文件地址"></a>1.2.3.2    查看<code>SQLite</code>文件地址</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%886.00.14.png" alt="Alt text"><br><em>AppDelegate.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	 <span class="built_in">lazy</span> <span class="keyword">var</span> persistentStoreCoordinator: <span class="type">NSPersistentStoreCoordinator</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> coordinator = <span class="type">NSPersistentStoreCoordinator</span>(managedObjectModel: <span class="keyword">self</span>.managedObjectModel)</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">self</span>.applicationDocumentsDirectory.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"SingleViewCoreData.sqlite"</span>)</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">		...</span><br><span class="line">     &#125;()</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/1041D05D-4C13-45A9-BD8C-B209722B59F2/data/Containers/Data/Application/AA16281E-DE67-4A56-859C-2C96834101CE/Documents/SingleViewCoreData.sqlite</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-读取数据"><a href="#1-2-4-读取数据" class="headerlink" title="1.2.4    读取数据"></a>1.2.4    读取数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取<code>SQLite</code>的数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">let</span> f = <span class="type">NSFetchRequest</span>(entityName: <span class="string">"Users"</span>)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> dataArr = context.executeFetchRequest(f)</span><br><span class="line">    tableView.reloadData()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"数据查询失败"</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="1-2-5-更新数据"><a href="#1-2-5-更新数据" class="headerlink" title="1.2.5    更新数据"></a>1.2.5    更新数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何更新数据。</p>
</blockquote>
<p><em>UserContentViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserContentViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfName: <span class="type">UITextField</span>!<span class="comment">// 姓名</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfAge: <span class="type">UITextField</span>!<span class="comment">// 年龄</span></span><br><span class="line">    <span class="keyword">var</span> data:<span class="type">NSManagedObject</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        tfName.text = data.valueForKey(<span class="string">"name"</span>) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> age:<span class="type">AnyObject</span>! = data.valueForKey(<span class="string">"age"</span>)</span><br><span class="line">        tfAge.text = <span class="string">"\(age)"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击提交按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">submitBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">	    <span class="comment">// 更新数据</span></span><br><span class="line">        data.setValue(tfName.text, forKey: <span class="string">"name"</span>)</span><br><span class="line">        data.setValue(<span class="type">Int</span>(tfAge.text!), forKey: <span class="string">"age"</span>)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> data.managedObjectContext?.save()</span><br><span class="line">            dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"save failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击取消按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">cancelBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-6-删除数据"><a href="#1-2-6-删除数据" class="headerlink" title="1.2.6    删除数据"></a>1.2.6    删除数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何删除数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTableViewController</span>: <span class="title">UITableViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存放数据库信息</span></span><br><span class="line">    <span class="keyword">var</span> dataArr:<span class="type">Array</span>&lt;<span class="type">AnyObject</span>&gt; = []</span><br><span class="line">    <span class="comment">// 数据库上下文</span></span><br><span class="line">    <span class="keyword">var</span> context:<span class="type">NSManagedObjectContext</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        refreshData()</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Override to support editing the table view.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, commitEditingStyle editingStyle: UITableViewCellEditingStyle, forRowAtIndexPath indexPath: NSIndexPath)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 删除 table 中的一个cell</span></span><br><span class="line">        <span class="keyword">if</span> editingStyle == .<span class="type">Delete</span> &#123;</span><br><span class="line">            <span class="comment">// 删除数据</span></span><br><span class="line">            context.deleteObject(dataArr[indexPath.row] <span class="keyword">as</span>! <span class="type">NSManagedObject</span>)</span><br><span class="line">            <span class="comment">// 持久化</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> context.save()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"删除数据失败"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            refreshData()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向 table 中插入一条 cell</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> editingStyle == .<span class="type">Insert</span> &#123;</span><br><span class="line">            <span class="comment">// Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-操作-JSON-数据"><a href="#1-3-操作-JSON-数据" class="headerlink" title="1.3    操作 JSON 数据"></a>1.3    操作 JSON 数据</h2><h3 id="1-3-1-JSON数据介绍"><a href="#1-3-1-JSON数据介绍" class="headerlink" title="1.3.1    JSON数据介绍"></a>1.3.1    JSON数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>JSON</code> 格式数据的语法。</p>
</blockquote>
<h3 id="1-3-2-Swift-解析-JSON-数据"><a href="#1-3-2-Swift-解析-JSON-数据" class="headerlink" title="1.3.2    Swift 解析 JSON 数据"></a>1.3.2    Swift 解析 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言解析 <code>JSON</code> 格式的数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 从json文件中读取 json 格式数据</span></span><br><span class="line">    <span class="keyword">let</span> json:<span class="type">AnyObject</span>? = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(<span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"obj"</span>, ofType: <span class="string">"json"</span>)!))!, options: <span class="type">NSJSONReadingOptions</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 索引 json 内容</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> lang:<span class="type">AnyObject</span> = json?.objectForKey(<span class="string">"language"</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(lang)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"json 文件读取失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-Swift-生成-JSON-数据"><a href="#1-3-3-Swift-生成-JSON-数据" class="headerlink" title="1.3.3    Swift 生成 JSON 数据"></a>1.3.3    Swift 生成 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言生成<code>JSON</code> 格式数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字典</span></span><br><span class="line"><span class="keyword">let</span> dict = [<span class="string">"name"</span>:<span class="string">"lixiangguo"</span>, <span class="string">"age"</span>: <span class="string">"-1"</span>];</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 将字典转化为 json 格式的NSData</span></span><br><span class="line">    <span class="keyword">let</span> jsonData = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.dataWithJSONObject(dict, options: <span class="type">NSJSONWritingOptions</span>())</span><br><span class="line">    <span class="comment">// 将 NSData 转换为 NSString</span></span><br><span class="line">    <span class="keyword">let</span> jsonStr  = <span class="type">NSString</span>(data: jsonData, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(jsonStr)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"字典解析为json格式字符串失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-4-操作XML数据"><a href="#1-4-操作XML数据" class="headerlink" title="1.4    操作XML数据"></a>1.4    操作XML数据</h2><h3 id="1-4-1-XML格式数据介绍"><a href="#1-4-1-XML格式数据介绍" class="headerlink" title="1.4.1    XML格式数据介绍"></a>1.4.1    XML格式数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍XML格式数据的结构以及如何编写XML文件</p>
</blockquote>
<h3 id="1-4-2-Swift解析XML格式的数据"><a href="#1-4-2-Swift解析XML格式的数据" class="headerlink" title="1.4.2    Swift解析XML格式的数据"></a>1.4.2    Swift解析XML格式的数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用Swift语言解析<code>XML</code>格式的数据</p>
<ol>
<li>引入资源：xml 文件</li>
<li>采纳协议：<code>NSXMLParserDelegate</code></li>
<li>获取资源并解析（通过代理）</li>
</ol>
</blockquote>
<p><em>testData.xml</em></p>
<blockquote>
<p><strong>说明：</strong>待解析的 xml 文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>mengqingshen<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>yixiaoli<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"0.3"</span>&gt;</span>mengxiang<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c</span>&gt;</span>Data<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">NSXMLParserDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前解析出的节点</span></span><br><span class="line">    <span class="keyword">var</span> currentNodeName:<span class="type">String</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过 xml 文件获取 NSXMLParser</span></span><br><span class="line">        <span class="keyword">let</span> parser = <span class="type">NSXMLParser</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"testData"</span>, ofType: <span class="string">"xml"</span>)!))</span><br><span class="line">        <span class="comment">// 设置代理</span></span><br><span class="line">        parser?.delegate = <span class="keyword">self</span></span><br><span class="line">        <span class="comment">// 解析数据</span></span><br><span class="line">        parser?.parse()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每解析到一个节点的开标签时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String])</span></span> &#123;</span><br><span class="line">        currentNodeName = elementName</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印 person 节点的 age 属性</span></span><br><span class="line">        <span class="keyword">if</span> elementName == <span class="string">"person"</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> age:<span class="type">AnyObject</span> = attributeDict[<span class="string">"age"</span>] &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"age:\(age)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每发现一个叶子节点包裹的字符串时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, foundCharacters string: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> str = string.stringByTrimmingCharactersInSet(<span class="type">NSCharacterSet</span>.whitespaceAndNewlineCharacterSet())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 过滤掉空白符号(包括换行符)</span></span><br><span class="line">        <span class="keyword">if</span> str != <span class="string">""</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"current node: \(currentNodeName), value:\(str)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-3-选择题实例"><a href="#1-4-3-选择题实例" class="headerlink" title="1.4.3    选择题实例"></a>1.4.3    选择题实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个实例演示如何在程序中使用<code>XML</code>格式的数据</p>
<ol>
<li>（工程）引入 xml 文件</li>
<li>（storyboard）编辑界面</li>
<li>（ViewController.swift）绑定控件和注册事件</li>
</ol>
</blockquote>
<h2 id="1-5-iOS用户首选项数据"><a href="#1-5-iOS用户首选项数据" class="headerlink" title="1.5    iOS用户首选项数据"></a>1.5    iOS用户首选项数据</h2><h3 id="1-5-1-用户首选项数据说明"><a href="#1-5-1-用户首选项数据说明" class="headerlink" title="1.5.1    用户首选项数据说明"></a>1.5.1    用户首选项数据说明</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解iOS首选项数据的概念及用途<br><strong>说明：</strong>用户首选项数据适合以下场景</p>
<ol>
<li>数据量小</li>
<li>键值对形式存储</li>
<li>保存到首选项的数据在app关闭后不会被清空</li>
</ol>
</blockquote>
<h3 id="1-5-2-存储用户首选项数据"><a href="#1-5-2-存储用户首选项数据" class="headerlink" title="1.5.2    存储用户首选项数据"></a>1.5.2    存储用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何存储用户首选项数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_shouxuanxiang.gif" alt="Alt text|200x350"></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!<span class="comment">// 输入框</span></span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSavePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 保存到首选项</span></span><br><span class="line">        ud.setObject(textView.text, forKey: <span class="string">"data"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"saved"</span>)</span><br><span class="line">        <span class="comment">// 创建提示框</span></span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"成功"</span>,</span><br><span class="line">            message: <span class="string">"成功保存到首选项"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">ActionSheet</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: <span class="type">UIAlertActionStyle</span>.<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 弹出提示框</span></span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取首选项数据初始化界面</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> value:<span class="type">AnyObject</span> = ud.objectForKey(<span class="string">"data"</span>) &#123;</span><br><span class="line">            textView.text = value <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            textView.text = <span class="string">"No value"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-读取用户首选项数据"><a href="#1-5-3-读取用户首选项数据" class="headerlink" title="1.5.3    读取用户首选项数据"></a>1.5.3    读取用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取用户首选项数据</p>
</blockquote>
<h3 id="1-5-4-启动时小贴士实例"><a href="#1-5-4-启动时小贴士实例" class="headerlink" title="1.5.4    启动时小贴士实例"></a>1.5.4    启动时小贴士实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个小实例演示用户首选项数据的使用场景<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_tip.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> mySwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchChangedHandler</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        ud.setBool(mySwitch.on, forKey: <span class="string">"showTips"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        mySwitch.on = ud.boolForKey(<span class="string">"showTips"</span>)</span><br><span class="line">        <span class="keyword">if</span> mySwitch.on &#123;</span><br><span class="line">            <span class="type">NSTimer</span>.scheduledTimerWithTimeInterval(<span class="number">2</span>,</span><br><span class="line">                target: <span class="keyword">self</span>,</span><br><span class="line">                selector: <span class="string">"showTip"</span>,</span><br><span class="line">                userInfo: <span class="literal">nil</span>,</span><br><span class="line">                repeats: <span class="literal">false</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 弹出提示窗</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showTip</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>,</span><br><span class="line">            message: <span class="string">"今天要下雨，出门要带雨具哦！"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">Alert</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: .<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-6-iOS文件存取"><a href="#1-6-iOS文件存取" class="headerlink" title="1.6    iOS文件存取"></a>1.6    iOS文件存取</h2><blockquote>
<p><strong>官方文档：</strong><a href="https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1" target="_blank" rel="external">https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1</a></p>
</blockquote>
<h3 id="1-6-1-iOS应用沙盒"><a href="#1-6-1-iOS应用沙盒" class="headerlink" title="1.6.1    iOS应用沙盒"></a>1.6.1    iOS应用沙盒</h3><blockquote>
<p><strong>笔记参考：</strong><a href="http://blog.csdn.net/wzzvictory/article/details/18269713" target="_blank" rel="external">http://blog.csdn.net/wzzvictory/article/details/18269713</a><br><strong>沙盒机制：</strong>出于安全考虑，iOS系统的沙盒机制规定每个应用都只能访问当前沙盒目录下面的文件（也有例外，比如系统通讯录能在用户授权的情况下被第三方应用访问）。</p>
</blockquote>
<h4 id="1-6-1-1-app目录"><a href="#1-6-1-1-app目录" class="headerlink" title="1.6.1.1    app目录"></a>1.6.1.1    app目录</h4><blockquote>
<p><strong>说明：</strong>每个应用的沙盒目录都是相似的，主要包如下所示的4个目录</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── MyApp.app<span class="comment"># 应用程序本身</span></span><br><span class="line">├── Documents<span class="comment"># 应用程序的数据文件</span></span><br><span class="line">│   └── Inbox<span class="comment">#由外部应用请求当前应用程序打开的文件</span></span><br><span class="line">├── Library<span class="comment"># 默认设置或其它状态信息</span></span><br><span class="line">│   ├── Caches<span class="comment">#缓存文件</span></span><br><span class="line">│   └── Preferences<span class="comment">#应用程序的偏好设置文件</span></span><br><span class="line">└── tmp<span class="comment"># 临时文件</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>目录</th>
<th>内容</th>
<th>读写</th>
<th>是否会被iTunes同步</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MyApp.app</code></td>
<td>应用程序本身的数据，包括<code>资源文件</code>和<code>可执行文件</code>等</td>
<td>只读</td>
<td>否</td>
</tr>
<tr>
<td><code>Documents</code></td>
<td>读写</td>
<td>是</td>
<td>应用程序的数据文件保存在该目录下</td>
<td>数据类型仅限于<code>不可再生</code>的数据，<code>可再生</code>的数据文件应该存放在<code>Library/Cache</code>目录下。</td>
</tr>
<tr>
<td><code>Documents/Inbox</code></td>
<td>用来保存由外部应用请求当前应用程序打开的文件</td>
<td>读写</td>
<td>是</td>
<td>比如我们的应用叫<code>A</code>，向系统注册了几种可打开的文件格式，<code>B</code>应用有一个<code>A</code>支持的格式的文件<code>F</code>，并且申请调用<code>A</code>打开<code>F</code>。由于<code>F</code>当前是在<code>B</code>应用的沙盒中，我们知道，沙盒机制是不允许<code>A</code>访问<code>B</code>沙盒中的文件，因此苹果的解决方案是将<code>F</code>拷贝一份到<code>A</code>应用的<code>Documents/Inbox</code>目录下，再让<code>A</code>打开<code>F</code>。</td>
</tr>
<tr>
<td><code>Library</code></td>
<td>苹果建议用来存放默认设置或其它状态信息</td>
<td>读写</td>
<td>是，但是要除了<code>Caches</code>子目录外</td>
<td></td>
</tr>
<tr>
<td><code>Library/Caches</code></td>
<td>主要是缓存文件，用户使用过程中缓存都可以保存在这个目录中</td>
<td>读写</td>
<td>否</td>
<td>Documents目录用于保存不可再生的文件，那么这个目录就用于保存那些可再生的文件，比如网络请求的数据。鉴于此，应用程序通常还需要负责删除这些文件。</td>
</tr>
<tr>
<td><code>Library/Preferences</code></td>
<td>应用程序的偏好设置文件</td>
<td>读写</td>
<td>是</td>
<td>我们使用<code>NSUserDefaults</code>写的设置数据都会保存到该目录下的一个<code>plist</code>文件中，这就是所谓的写到<code>plist</code>中!</td>
</tr>
<tr>
<td><code>tmp</code></td>
<td>各种临时文件，保存应用再次启动时不需要的文件</td>
<td>读写</td>
<td>否</td>
<td>当应用不再需要这些文件时应该主动将其删除，因为该目录下的东西随时有可能被系统清理掉，目前已知的一种可能清理的原因是系统磁盘存储空间不足的时候。</td>
</tr>
</tbody>
</table>
<h4 id="1-6-1-2-获取目录-API"><a href="#1-6-1-2-获取目录-API" class="headerlink" title="1.6.1.2    获取目录 API"></a>1.6.1.2    获取目录 API</h4><h5 id="NSSearchPathForDirectoriesInDomains方法"><a href="#NSSearchPathForDirectoriesInDomains方法" class="headerlink" title="NSSearchPathForDirectoriesInDomains方法"></a>NSSearchPathForDirectoriesInDomains方法</h5><blockquote>
<p><strong>说明：</strong>用于返回指定范围内的指定名称的目录的路径集合<br><strong>注意：</strong>使用<code>沙盒/Documents</code>目录要用该方法获取路径</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* </span><br><span class="line">* @param &#123;enum&#125; directory 表明我们要搜索的目录名称</span><br><span class="line">* @param &#123;enum&#125; domainMask 指定搜索范围。</span><br><span class="line">* @param &#123;Bool&#125; expandTilde 表示是否展开波浪线~</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">NSSearchPathForDirectoriesInDomains</span><span class="params">(directory: NSSearchPathDirectory, <span class="number">_</span> domainMask: NSSearchPathDomainMask, <span class="number">_</span> expandTilde: Bool)</span></span> -&gt; [<span class="type">String</span>]</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-写入文件"><a href="#1-6-2-写入文件" class="headerlink" title="1.6.2    写入文件"></a>1.6.2    写入文件</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*- 获取目录路径 -*/</span></span><br><span class="line"><span class="keyword">let</span> homePath = <span class="type">NSHomeDirectory</span>()<span class="comment">// 沙盒(home)</span></span><br><span class="line"><span class="keyword">let</span> appPath = <span class="type">NSBundle</span>.mainBundle().bundlePath<span class="comment">// MyApp.app</span></span><br><span class="line"><span class="keyword">let</span> tmpPath = <span class="type">NSTemporaryDirectory</span>()<span class="comment">// tmp</span></span><br><span class="line"><span class="keyword">let</span> documentPaths = <span class="type">NSSearchPathForDirectoriesInDomains</span>(.<span class="type">DocumentationDirectory</span>, .<span class="type">AllDomainsMask</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">var</span> documentPath:<span class="type">String</span> = <span class="string">""</span>;<span class="comment">// Documents</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> documentPaths.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">    documentPath = documentPaths[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"home:\(homePath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"app:\(appPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tmp:\(tmpPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Documents\(documentPath)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 在 Documents 下创建文件 -*/</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">NSURL</span>(fileURLWithPath: <span class="string">"\(documentPath)/test.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 向文件中写入文本 -*/</span></span><br><span class="line"><span class="keyword">let</span> textData = <span class="type">NSMutableData</span>()</span><br><span class="line">textData.appendData(<span class="string">"Hello Swift\n"</span>.dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>, allowLossyConversion: <span class="literal">true</span>)!)</span><br><span class="line">textData.writeToFile(url.path!, atomically: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-读取文件"><a href="#1-6-3-读取文件" class="headerlink" title="1.6.3    读取文件"></a>1.6.3    读取文件</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" itemprop="url">
                  4 中级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:01:39+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#4    中级iOS开发工程师面试题</p>
<h2 id="4-1-MVC的理解"><a href="#4-1-MVC的理解" class="headerlink" title="4.1 MVC的理解"></a>4.1 MVC的理解</h2><blockquote>
<p><code>MVC</code>设计模式考虑三种对象：数据模型对象、视图对象、控制器对象。</p>
<ul>
<li>数据模型（<code>M</code>）：负责存储、定义、操作数据</li>
<li>视图（<code>V</code>）：用来战术数据给用户，和用户进行操作交互</li>
<li>控制器（<code>C</code>）：<code>M</code>与<code>V</code>的协调者，控制获取数据，将数据交给视图取展示</li>
</ul>
</blockquote>
<h2 id="4-2-线程和进程"><a href="#4-2-线程和进程" class="headerlink" title="4.2    线程和进程"></a>4.2    线程和进程</h2><blockquote>
<p><strong>进程：</strong>进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统畸形资源分配和调度的一个独立单元。<br><strong>线程：</strong>线程是进程的的一个实体，是cpu调度和分派的基本单位，是比进程更小的能独立运行的基本单位，线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器、一组寄存器和栈），一个线程可以创建和撤销另一个线程。</p>
</blockquote>
<h3 id="4-2-1-线程和进程的关系"><a href="#4-2-1-线程和进程的关系" class="headerlink" title="4.2.1    线程和进程的关系"></a>4.2.1    线程和进程的关系</h3><blockquote>
<ol>
<li>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程。</li>
<li>资源跟配给进程，同一进程的所有线程共享该进程的所有资源。</li>
<li>线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。</li>
<li>真正在处理机上运行的是线程。</li>
<li>线程是指进程內的一个可执行单元，也是进程內的可调度实体。</li>
</ol>
</blockquote>
<h3 id="4-2-2-线程和进程的区别"><a href="#4-2-2-线程和进程的区别" class="headerlink" title="4.2.2    线程和进程的区别"></a>4.2.2    线程和进程的区别</h3><table>
<thead>
<tr>
<th>区别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>调度</td>
<td>线程作为调度和分配的基本单元，进程作为拥有过资源的基本单位</td>
</tr>
<tr>
<td>并发性</td>
<td>不仅进程之间可以并发执行，同一个进程的多个线程之间也可以并发执行</td>
</tr>
<tr>
<td>拥有资源</td>
<td>进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源</td>
</tr>
<tr>
<td>系统开销</td>
<td>创建或者撤销进程的开销比较大</td>
</tr>
</tbody>
</table>
<h3 id="4-2-3-进程的同步机制"><a href="#4-2-3-进程的同步机制" class="headerlink" title="4.2.3    进程的同步机制"></a>4.2.3    进程的同步机制</h3><blockquote>
<p>原子操作：、信号量机制、自旋锁、分布式系统等</p>
</blockquote>
<h3 id="4-2-4-进程死锁"><a href="#4-2-4-进程死锁" class="headerlink" title="4.2.4    进程死锁"></a>4.2.4    进程死锁</h3><blockquote>
<p><strong>原因：</strong>资源竞争以及进程推进顺序非法<br><strong>必要条件：</strong>4个</p>
<ol>
<li>互斥</li>
<li>请求保持</li>
<li>不可剥夺</li>
<li>环路</li>
</ol>
<p><strong>处理：</strong></p>
<ul>
<li>鸵鸟策略</li>
<li>预防策略</li>
<li>监测与接触死锁</li>
</ul>
</blockquote>
<h2 id="4-3-KVC和KVO"><a href="#4-3-KVC和KVO" class="headerlink" title="4.3    KVC和KVO"></a>4.3    KVC和KVO</h2><blockquote>
<ol>
<li><code>KVC</code>（键值编码）：是一种间接访问对象实例变量的机制，该机制可以不通过存取方法就可以访问对象的实例变量。</li>
<li><code>KVO</code> （键值观察）：是一种能使得对象获取到其他对象属性变化的通知机制。</li>
<li>实现<code>KVO简直观察模式</code>，被观察的对象必须使用<code>kvc</code>键值编码来修改它的实例变量，这样才能被观察者观察到。因此，<code>KVC</code>是<code>KVO</code>的基础或者说<code>KVO</code>的实现是建立在<code>KVC</code>的基础之上。</li>
</ol>
</blockquote>
<h2 id="4-4-深复制、浅复制"><a href="#4-4-深复制、浅复制" class="headerlink" title="4.4    深复制、浅复制"></a>4.4    深复制、浅复制</h2><blockquote>
<p><strong>深复制：</strong>不仅复制对象本身，对象持有的属性对象也做复制。<br><strong>浅复制：</strong>只复制对象本身，不对里面的属性复制。</p>
</blockquote>
<h2 id="4-5-定义属性时，什么时候用assign、retain、copy、nonatomic"><a href="#4-5-定义属性时，什么时候用assign、retain、copy、nonatomic" class="headerlink" title="4.5    定义属性时，什么时候用assign、retain、copy、nonatomic?"></a>4.5    定义属性时，什么时候用<code>assign</code>、<code>retain</code>、<code>copy</code>、<code>nonatomic</code>?</h2><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>assign</code></td>
<td>普通赋值</td>
<td>一般用于基本数据类型，常见委托设计模式，以此来防止循环引用</td>
</tr>
<tr>
<td><code>retain</code></td>
<td>保留计数</td>
<td>获得了对象的所有权，引用计数+1</td>
</tr>
<tr>
<td><code>copy</code></td>
<td><code>set</code>是使用副本</td>
<td>一般字符串使用<code>copy</code>，<code>Foundation</code>中的不可变对象使用<code>copy</code>效果相当于<code>retain</code>，只是引用计数+1</td>
</tr>
<tr>
<td><code>nonatomic</code></td>
<td>非原子性访问，不加同步</td>
<td>多线程并发访问会提高性能</td>
</tr>
</tbody>
</table>
<h2 id="4-6-内存管理"><a href="#4-6-内存管理" class="headerlink" title="4.6    内存管理"></a>4.6    内存管理</h2><h3 id="4-6-1-strong与weak，-unsafe-unretained与weak的区别"><a href="#4-6-1-strong与weak，-unsafe-unretained与weak的区别" class="headerlink" title="4.6.1    strong与weak，_unsafe_unretained与weak的区别"></a>4.6.1    strong与weak，_unsafe_unretained与weak的区别</h3><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strong</code></td>
<td>强引用</td>
<td>在<code>ARC</code>中，使用<code>strong</code>告诉编译器自动插入<code>retain</code></td>
</tr>
<tr>
<td><code>weak</code></td>
<td>弱引用</td>
<td>在<code>ARC</code>中，<code>weak</code>相当于手动管理内存的<code>assign</code></td>
</tr>
<tr>
<td><code>_unsafe_unretained</code></td>
<td>安全版<code>weak</code></td>
<td>与<code>weak</code>功能一致,区别在于当指向的对象销毁后，<code>weak</code>会将变量置为<code>nil</code>，防止调用野指针</td>
</tr>
</tbody>
</table>
<h3 id="4-6-2-ARC存在内存泄漏吗？"><a href="#4-6-2-ARC存在内存泄漏吗？" class="headerlink" title="4.6.2    ARC存在内存泄漏吗？"></a>4.6.2    <code>ARC</code>存在内存泄漏吗？</h3><blockquote>
<p>循环引用导致内存泄漏，<code>Objective-C</code>对象与<code>CoreFoundation</code>类之间桥接时，管理不当也会产生内存泄漏。</p>
</blockquote>
<h2 id="4-7-事件响应者链"><a href="#4-7-事件响应者链" class="headerlink" title="4.7    事件响应者链"></a>4.7    事件响应者链</h2><blockquote>
<p>响应者链表示一系列的响应者对象。事件被交由第一响应者对象，如果第一响应者不处理，事件被沿着响应者链向上传递，交给下一个响应者。</p>
</blockquote>
<p>View -&gt; ViewController -&gt; Window -&gt; application -&gt; 丢弃事件</p>
<h2 id="4-8-其它"><a href="#4-8-其它" class="headerlink" title="4.8    其它"></a>4.8    其它</h2><ul>
<li><code>SVN</code>、<code>git</code>使用</li>
<li>打包静态库</li>
<li><code>APP</code>发布的上架流程</li>
<li><code>Storyboard</code>的使用</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="url">
                  3 动画图层部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:59:02+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_3  动画图层部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-设计复杂的iOS动画效果"><a href="#3-1-设计复杂的iOS动画效果" class="headerlink" title="3.1    设计复杂的iOS动画效果"></a>3.1    设计复杂的iOS动画效果</h2><h3 id="3-1-1-制定统一的动画接口"><a href="#3-1-1-制定统一的动画接口" class="headerlink" title="3.1.1    制定统一的动画接口"></a>3.1.1    制定统一的动画接口</h3><blockquote>
<p><strong>说明：</strong>制定统一的动画接口有如下优点</p>
<ul>
<li>便于实现后续复杂的动画组合</li>
<li>对于后续的代码维护极为方便</li>
<li>需要优先考虑里氏代换原则</li>
</ul>
</blockquote>
<h3 id="3-1-2-动画中的高内聚低耦合原理"><a href="#3-1-2-动画中的高内聚低耦合原理" class="headerlink" title="3.1.2    动画中的高内聚低耦合原理"></a>3.1.2    动画中的高内聚低耦合原理</h3><blockquote>
<p><strong>说明：</strong>将视图的动画效果的实现和视图本身封装到另一个<code>UIView</code>中。<br><strong>技巧：</strong></p>
<ul>
<li>不要把实现动画的细节暴露在外</li>
<li>设计动画类尽力那个要符合<code>单一职能原则</code>，以便后续方便组合成复杂的动画效果</li>
</ul>
<p><strong>单一职能原则：</strong>如果一个类承担的只能过多，就等于把这些功能耦合在一起，一个职能的变化可能会削弱或者抑制其他职能的能力，这种耦合会导致脆弱的设计，当发生变化时，设计会遭到意想不到的破坏。如果想要避免这种现象发生，就要尽可能的遵守<code>单一职能原则</code>。</p>
</blockquote>
<p><em>LineView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">@(中级ios开发工程师)interface LineView : <span class="built_in">UIView</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span>  offsetX;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> rect;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.rect = frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>viewcntroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *line<span class="built_in">UIView</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [<span class="keyword">self</span> testLineAnimate];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用封装在LineUIView中的动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testLineAnimate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建封装着动画效果的视图实例</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置初始状态</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView.offsetX = <span class="number">50.</span>f;</span><br><span class="line">    <span class="keyword">self</span>.lineUIView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineUIView];</span><br><span class="line">    <span class="comment">// 展现带有动画的视图（展现带有动画）</span></span><br><span class="line">    [<span class="keyword">self</span>.lineUIView show];</span><br><span class="line">    <span class="comment">// 3秒中后隐藏视图（带消失有动画）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(excuteAfterDelay) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)excuteAfterDelay</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineUIView hide];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-设计动画函数的注意事项"><a href="#3-1-3-设计动画函数的注意事项" class="headerlink" title="3.1.3    设计动画函数的注意事项"></a>3.1.3    设计动画函数的注意事项</h3><ul>
<li>动画方法的命名统一：封装在不同的<code>view</code>的同类动画方法命名要一致</li>
<li>预留非动画情形的设计：避免<code>TableView</code>或者其它存在重用问题的场景下的性能问题</li>
<li>用百分比来表示动画的执行程度</li>
<li>懒加载的使用</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif" alt="Alt text"></p>
<p><em>LineUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> offSetX;<span class="comment">// 对应动画进度的偏移量</span></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建view（懒加载方式）</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画百分比（动画进行程度）</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> startRect;<span class="comment">// 开始区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> midRect;<span class="comment">// 动画进行到中间时的区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> endRect;<span class="comment">// 结束区域</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineUIView</span></span></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;<span class="comment">// 视图创建时是不可见的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  隐藏视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.endRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished)&#123;</span><br><span class="line">            <span class="comment">// 视图隐藏后将视图复原到初始位置</span></span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建view（懒加载方式）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.startRect = <span class="keyword">self</span>.frame;</span><br><span class="line">    <span class="keyword">self</span>.midRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">    <span class="keyword">self</span>.endRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX * <span class="number">2</span>,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  动画百分比（动画进行程度）</span><br><span class="line"> *</span><br><span class="line"> *  @param percent 动画进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (percent &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        tmpOffsetX = percent * <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + tmpOffsetX,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.lineView.offSetX = <span class="keyword">self</span>.view.frame.size.width / <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.lineView buildView];<span class="comment">// 初始化视图成员</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将动画视图添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineView];</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    [<span class="keyword">self</span> delayShow];</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    [<span class="keyword">self</span> delayHide];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayShow</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView showWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayHide</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView hideWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-用里氏代换原则来处理动画类的继承问题"><a href="#3-1-4-用里氏代换原则来处理动画类的继承问题" class="headerlink" title="3.1.4    用里氏代换原则来处理动画类的继承问题"></a>3.1.4    用里氏代换原则来处理动画类的继承问题</h3><blockquote>
<p><strong>说明：</strong>其实就是利用对象的<code>多态性</code>，父类变量动态调用子类对象的方法。<br><strong>要点：</strong></p>
<ul>
<li>里氏代换原则的基本原理</li>
<li>设计中要确保父类可以直接调用子类的方法</li>
<li>将父类设计成虚类（需要时，父类也可以提供实现）</li>
</ul>
</blockquote>
<h4 id="3-1-4-1-父类"><a href="#3-1-4-1-父类" class="headerlink" title="3.1.4.1    父类"></a>3.1.4.1    父类</h4><p><em>SuperUIView.h</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SuperUIView : UIView</span><br><span class="line"></span><br><span class="line">- (void)show;</span><br><span class="line">- (void)hide;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><em>SuperUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SuperUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperUIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-2-子类"><a href="#3-1-4-2-子类" class="headerlink" title="3.1.4.2    子类"></a>3.1.4.2    子类</h4><blockquote>
<p><strong>说明：</strong>在子类中重写集成来的<code>show</code>的<code>hide</code>方法。</p>
</blockquote>
<p><em>SubUIView1.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView1</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>SubUIView2.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView2</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-3-演示"><a href="#3-1-4-3-演示" class="headerlink" title="3.1.4.3    演示"></a>3.1.4.3    演示</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示类的多态性</span></span><br><span class="line">Super<span class="built_in">UIView</span> *tmpView = [[Sub<span class="built_in">UIView1</span> alloc]init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br><span class="line"></span><br><span class="line">tmpView = [[Sub<span class="built_in">UIView2</span> alloc] init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br></pre></td></tr></table></figure>
<h3 id="3-1-5-动画中的模块化设计"><a href="#3-1-5-动画中的模块化设计" class="headerlink" title="3.1.5    动画中的模块化设计"></a>3.1.5    动画中的模块化设计</h3><blockquote>
<p><strong>说明：</strong>模块化设计在开发中非常重要，拆分成小颗粒的模块非常便于代码的维护<br><strong>要点：</strong></p>
<ul>
<li>动画效果实现难度的判断</li>
<li>将看到的动画效果查分成小模块</li>
<li>将写好的小模块组合成你所需要的动画效果</li>
</ul>
</blockquote>
<h4 id="3-1-5-1-子模块"><a href="#3-1-5-1-子模块" class="headerlink" title="3.1.5.1    子模块"></a>3.1.5.1    子模块</h4><p><em>LineUIView.h、CircleUIView.h、RectUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m、CircleUIView.m、RectUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="3-1-5-2-组合使用"><a href="#3-1-5-2-组合使用" class="headerlink" title="3.1.5.2    组合使用"></a>3.1.5.2    组合使用</h4><p><em>BaseAnimationView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BaseAnimationView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BaseAnimationView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RectUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Circle<span class="built_in">UIView</span> *circleView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BaseAnimationView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView show];</span><br><span class="line">    [<span class="keyword">self</span>.lineView show];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView hide];</span><br><span class="line">    [<span class="keyword">self</span>.lineView hide];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;</span><br><span class="line">    <span class="keyword">self</span>.circleView = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.circleView];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.lineView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS模糊效果的使用"><a href="#3-2-iOS模糊效果的使用" class="headerlink" title="3.2    iOS模糊效果的使用"></a>3.2    iOS模糊效果的使用</h2><blockquote>
<p><strong>背景：</strong>在项目开发中，使用模糊效果或许是很多开发者并不愿意接触的东西，因为大部分都是从开源代码里获取到的代码片段，并不一定理解别人的设计思路，此时要最大程度的修改来符合自己的项目需求并不容易。本课程我将会带领大家来定制出自己需要的模糊效果，理解设计的原理，并根据不同的需求设计出符合我们期望的效果。<br><strong>要点：</strong></p>
<ol>
<li>CoreImage 中的模糊滤镜</li>
<li>UIImage+ImageEffects 的 category 模糊效果</li>
<li>iOS8 中 UIVisualEffectView 模糊效果的使用</li>
<li>设计下载图片后自动模糊的控件</li>
</ol>
</blockquote>
<h3 id="3-2-1-CoreImage中的模糊滤镜"><a href="#3-2-1-CoreImage中的模糊滤镜" class="headerlink" title="3.2.1    CoreImage中的模糊滤镜"></a>3.2.1    CoreImage中的模糊滤镜</h3><blockquote>
<p><strong>要点：</strong></p>
<ul>
<li><code>CoreImage</code>是苹果用来简化图片处理的框架</li>
<li><code>CIImage</code>、<code>CIFilter</code>与<code>CIContext</code>三者之间的联系</li>
<li><code>CIGaussianBlur</code>中可以设置的参数<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%881.08.34.png" alt="Alt text|200x400"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1. 原始图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"sourceImage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. coreImage部分</span></span><br><span class="line"><span class="comment">/*------- coreImage 部分 ------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CIImage - 将 UIImage 包装为 CIImage 才可以用于滤镜</span></span><br><span class="line"><span class="built_in">CIImage</span> *ciImage = [[<span class="built_in">CIImage</span> alloc]initWithImage:image];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIFilter － 滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *blurFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看滤镜可以设置的参数以及一些相关的信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [blurFilter attributes]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片输入到滤镜中</span></span><br><span class="line">[blurFilter setValue:ciImage forKey:k<span class="built_in">CIInputImageKey</span>];<span class="comment">//  KVC方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模糊程度(0-100)</span></span><br><span class="line">[blurFilter setValue:@(<span class="number">3</span>) forKey:<span class="string">@"inputRadius"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将处理好的图片输出为 CIImage</span></span><br><span class="line"><span class="built_in">CIImage</span> *outCiImage = [blurFilter valueForKey:k<span class="built_in">CIOutputImageKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIContext</span></span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRef</span> <span class="keyword">out</span><span class="built_in">CGImage</span> = [context create<span class="built_in">CGImage</span>:outCiImage fromRect:[outCiImage extent]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终获取的图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *blurImage = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:<span class="keyword">out</span><span class="built_in">CGImage</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(<span class="keyword">out</span><span class="built_in">CGImage</span>);</span><br><span class="line"><span class="comment">/*-----------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 初始化UIImageView</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">590</span> / <span class="number">2.</span>f, <span class="number">988</span> / <span class="number">2.</span>f)];</span><br><span class="line">imageView.image = blurImage;</span><br><span class="line">imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-UIImage-ImageEffects的category模糊效果"><a href="#3-2-2-UIImage-ImageEffects的category模糊效果" class="headerlink" title="3.2.2    UIImage + ImageEffects的category模糊效果"></a>3.2.2    UIImage + ImageEffects的category模糊效果</h3><blockquote>
<p><strong>说明：</strong>苹果官方提供了一段无论是性能还是效果都更优的实现图片模糊效果的代码。在此基础上封装的库在以下地址可以拿到<br><a href="https://github.com/YouXianMing/UIImageBlur" target="_blank" rel="external">https://github.com/YouXianMing/UIImageBlur</a></p>
<ul>
<li>性能更好</li>
<li>可以局部模糊</li>
<li>更加易用<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%8810.02.55.png" alt="Alt text|200x350"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 原始图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *sourceImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对图片进行模糊</span></span><br><span class="line">    <span class="built_in">UIImage</span> *blurImage = [sourceImage blurImageAtFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, sourceImage.size.width, sourceImage.size.height / <span class="number">2.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:blurImage];</span><br><span class="line">    imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="keyword">self</span>.view.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-iOS8种UIVisualEffectView模糊效果的使用"><a href="#3-2-3-iOS8种UIVisualEffectView模糊效果的使用" class="headerlink" title="3.2.3    iOS8种UIVisualEffectView模糊效果的使用"></a>3.2.3    iOS8种UIVisualEffectView模糊效果的使用</h3><blockquote>
<p><strong>说明：</strong><code>UIVisyalEffectView</code>的模糊效果是即时渲染的，效率非常高<br><strong>注意：</strong>在<code>UIVisualEffectView</code>之上的文本显示需要特殊处理<br><strong>兼容性：</strong><code>iOS8+</code><br><strong>案例：</strong><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_effective.gif" alt="Alt text|100x100"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--- 1. 环境 ----*/</span></span><br><span class="line"><span class="comment">// 1.1 图片</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 展示视图（UIScrollView）：用以显示动态模糊</span></span><br><span class="line"><span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line"><span class="keyword">self</span>.scrollView.contentSize = imageView.image.size;<span class="comment">// 展现视图和图片大小一致</span></span><br><span class="line"><span class="keyword">self</span>.scrollView.bounces = <span class="literal">NO</span>;<span class="comment">// 无边缘反弹效果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 将图片添加到展示视图</span></span><br><span class="line">[<span class="keyword">self</span>.scrollView addSubview:imageView];</span><br><span class="line"><span class="comment">// 1.4 将展示视图添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--- 2. 添加模糊视图 ---*/</span></span><br><span class="line"><span class="comment">// 2.1 创建模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *effecView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>]];</span><br><span class="line"><span class="comment">// 2.2 设置尺寸（动态模糊区域）</span></span><br><span class="line">effecView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>);</span><br><span class="line"><span class="comment">// 2.3 添加到 view</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:effecView];</span><br><span class="line"><span class="comment">/*------ 3. 子模糊视图（文本） ------*/</span></span><br><span class="line"><span class="comment">// 3.1  添加显示文本</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:effecView.bounds];</span><br><span class="line">label.text = <span class="string">@"时代精神"</span>;</span><br><span class="line">label.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">50.</span>f];</span><br><span class="line">label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line"><span class="comment">// 3.2  创建子模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *subEffectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIVibrancyEffect</span> effectForBlurEffect:(<span class="built_in">UIBlurEffect</span> *)effecView.effect]];</span><br><span class="line"><span class="comment">// 3.3  尺寸</span></span><br><span class="line">subEffectView.frame = effecView.bounds;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.4  将子模糊view添加到effectView的contentView才能够生效</span></span><br><span class="line">[effecView.contentView addSubview:subEffectView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.5  添加文本（此时文本会个模糊视图融合得比较好）</span></span><br><span class="line">[subEffectView.contentView addSubview:label];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-设计下载图片后自动模糊的控件"><a href="#3-2-4-设计下载图片后自动模糊的控件" class="headerlink" title="3.2.4    设计下载图片后自动模糊的控件"></a>3.2.4    设计下载图片后自动模糊的控件</h3><blockquote>
<p><strong>说明：</strong>将下载下来的图片自动模糊的控件。<br><strong>要点：</strong></p>
<ul>
<li>KVO监听下载完成后的事件</li>
<li>在子线程中进行渲染，主线程中进行图片的下载 （提升性能）</li>
</ul>
<p><strong>GDC：</strong><a href="https://github.com/YouXianMing/GCD-Program" target="_blank" rel="external">https://github.com/YouXianMing/GCD-Program</a></p>
</blockquote>
<h4 id="3-2-4-1-控件实现"><a href="#3-2-4-1-控件实现" class="headerlink" title="3.2.4.1    控件实现"></a>3.2.4.1    控件实现</h4><blockquote>
<p><strong>依赖:</strong><code>GDC</code>和<code>UIImage+ImageEffects</code></p>
</blockquote>
<p><em>BlurDownloadPicView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *pictureUrlString;<span class="comment">// 图片下载地址</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIViewContentMode</span> contentMode;<span class="comment">// 图片显示的方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始执行</span></span><br><span class="line">- (<span class="keyword">void</span>)startProgress;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BlurDownloadPicView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GCD.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BlurDownloadPicView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化控件</span></span><br><span class="line">        <span class="keyword">self</span>.imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="keyword">self</span>.imageView.alpha = <span class="number">0.</span>f;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startProgress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.pictureUrlString) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在子线程中执行下载图片的过程</span></span><br><span class="line">        [GCDQueue executeInGlobalQueue:^&#123;</span><br><span class="line">            <span class="comment">// 创建请求</span></span><br><span class="line">            <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.pictureUrlString]];</span><br><span class="line">            <span class="comment">// 获取数据(因为是同步请求，会阻塞主线程)</span></span><br><span class="line">            <span class="built_in">NSData</span> *data = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request</span><br><span class="line">                                                 returningResponse:<span class="literal">nil</span></span><br><span class="line">                                                             error:<span class="literal">nil</span>];</span><br><span class="line">            <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">UIImage</span> *blurImage = [image blurImage];</span><br><span class="line">            </span><br><span class="line">            [GCDQueue executeInMainQueue:^&#123;</span><br><span class="line">                <span class="comment">// 在主线程中加载图片</span></span><br><span class="line">                <span class="keyword">self</span>.imageView.image = blurImage;</span><br><span class="line">                <span class="comment">// 动画效果：淡出</span></span><br><span class="line">                [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">                    <span class="keyword">self</span>.imageView.alpha = <span class="number">1.</span>f;</span><br><span class="line">                &#125;];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> contentMode = _contentMode;</span><br><span class="line">- (<span class="keyword">void</span>)setContentMode:(<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    _contentMode = contentMode;</span><br><span class="line">    <span class="keyword">self</span>.imageView.contentMode = contentMode;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    <span class="keyword">return</span> _contentMode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-4-2-使用"><a href="#3-2-4-2-使用" class="headerlink" title="3.2.4.2    使用"></a>3.2.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *picUrlString = <span class="string">@"http://img.zcool.cn/community/0207a4570363fc6ac7257948ec0f00.jpg@800w_1l_2o"</span>;<span class="comment">// 下载地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建模糊视图</span></span><br><span class="line">    BlurDownloadPicView *blurDownloadView = [[BlurDownloadPicView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">400</span>)];</span><br><span class="line">    blurDownloadView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    blurDownloadView.pictureUrlString = picUrlString;</span><br><span class="line">    blurDownloadView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:blurDownloadView];</span><br><span class="line">    <span class="comment">// 下载图片 模糊图片 呈现</span></span><br><span class="line">    [blurDownloadView startProgress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-使用-maskView-设计动画"><a href="#3-3-使用-maskView-设计动画" class="headerlink" title="3.3    使用 maskView 设计动画"></a>3.3    使用 maskView 设计动画</h2><h3 id="3-3-1-maskView-maskLayer-的基本原理"><a href="#3-3-1-maskView-maskLayer-的基本原理" class="headerlink" title="3.3.1    maskView(maskLayer)的基本原理"></a>3.3.1    maskView(maskLayer)的基本原理</h3><blockquote>
<p><strong>说明：</strong>本课时主要讲解 <code>maskView(maskLayer)</code>的基本原理，并用示例演示。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-06%20%E4%B8%8B%E5%8D%883.14.40.png" alt="Alt text|100x200"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> width = <span class="number">120</span>;</span><br><span class="line"><span class="comment">// 情形1. 只有底图的情形</span></span><br><span class="line"><span class="keyword">self</span>.baseImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.baseImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形2. 只有mask（png图片）</span></span><br><span class="line"><span class="keyword">self</span>.maskImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + width + <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.maskImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形3. 底图通过maskView组合mask</span></span><br><span class="line"><span class="comment">// 底图</span></span><br><span class="line"><span class="keyword">self</span>.addImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + (width + <span class="number">20</span>) * <span class="number">2</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.addImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// mask</span></span><br><span class="line"><span class="built_in">UIImageView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, width)];</span><br><span class="line">mask.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"><span class="comment">// 在底图上设置maskView</span></span><br><span class="line"><span class="keyword">self</span>.addImageView.maskView = mask;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.baseImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.maskImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addImageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-maskView配合-CAGradientLayer的使用"><a href="#3-3-2-maskView配合-CAGradientLayer的使用" class="headerlink" title="3.3.2    maskView配合 CAGradientLayer的使用"></a>3.3.2    maskView配合 CAGradientLayer的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解如何在 maskView 中加载 <code>CAGradientLayer</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_ga.gif" alt="Alt text|100x100"></p>
<p><strong>要点：</strong></p>
<ul>
<li>用<code>CAGradientLayer</code>直接产生带透明像素通道的<code>layer</code></li>
<li>用<code>maskView</code>直接加载带<code>CAGradientLayer</code>的<code>View</code></li>
<li>可以通过<code>CAGradientLayer</code>进行动画的操作实现动画效果</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 底图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>)];</span><br><span class="line">imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. mask (使用 CAGradientLayer 替代 png 图片)</span></span><br><span class="line"><span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">gradientLayer.frame = imageView.bounds;</span><br><span class="line">gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIView</span> *containerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:imageView.bounds];</span><br><span class="line">[containerView.layer addSublayer:gradientLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. set maskView</span></span><br><span class="line">imageView.maskView = containerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 maskView 做动画效果</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 新位置</span></span><br><span class="line">    <span class="built_in">CGRect</span> frame = containerView.frame;</span><br><span class="line">    frame.origin.x += <span class="number">400</span>;</span><br><span class="line">    containerView.frame = frame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-maskView-配合带-alpha-通道图片的使用"><a href="#3-3-3-maskView-配合带-alpha-通道图片的使用" class="headerlink" title="3.3.3    maskView 配合带 alpha 通道图片的使用"></a>3.3.3    maskView 配合带 alpha 通道图片的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>maskView</code> 加载 <code>png</code> 图片的原理。</p>
<ul>
<li>直接使用带<code>alpha</code>通道的<code>png</code>图片比用<code>CAGradientLayer</code>的方式更加高效</li>
<li>可以使用技巧在<code>maskView</code>上添加多张图片</li>
<li>在<code>maskView</code>中做简单的动画</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text|100x100"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遮罩图片1</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picOne = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line">picOne.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮罩图片2</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picTwo = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">-200</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line"></span><br><span class="line">picTwo.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *backgroundView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">backgroundView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"background"</span>];</span><br><span class="line">backgroundView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待切换目标背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *baseView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:backgroundView.frame];</span><br><span class="line">baseView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为带切换图 set maskView</span></span><br><span class="line"><span class="built_in">UIView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:baseView.bounds];</span><br><span class="line"><span class="comment">// 两个png图片合成新遮罩</span></span><br><span class="line">[mask addSubview:picOne];</span><br><span class="line">[mask addSubview:picTwo];</span><br><span class="line">baseView.maskView = mask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:backgroundView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:baseView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 偏移左半边的遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> oneFrame = picOne.frame;</span><br><span class="line">    oneFrame.origin.y -= <span class="number">400</span>;</span><br><span class="line">    picOne.frame = oneFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 偏移右半边遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> twoFrame = picTwo.frame;</span><br><span class="line">    twoFrame.origin.y += <span class="number">400</span>;</span><br><span class="line">    picTwo.frame = twoFrame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-设计文本横向渐变消失的控件"><a href="#3-3-4-设计文本横向渐变消失的控件" class="headerlink" title="3.3.4    设计文本横向渐变消失的控件"></a>3.3.4    设计文本横向渐变消失的控件</h3><blockquote>
<p><strong>说明：</strong>本课时将综合前面所学内容设计一个效果不错的文本渐变消失的控件，并做简易的扩展设计。</p>
<ul>
<li>接口的设计</li>
<li>封装<code>CAGradientLayer</code>用以提供<code>mask</code>遮罩</li>
<li>动画样式的分析与设计</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_text.gif" alt="Alt text"></p>
<h4 id="3-3-4-1-文本横向渐变消失的控件"><a href="#3-3-4-1-文本横向渐变消失的控件" class="headerlink" title="3.3.4.1    文本横向渐变消失的控件"></a>3.3.4.1    文本横向渐变消失的控件</h4><p><em>FadeStrinUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示的文本</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从左到右渐变消失</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 动画持续时间</span><br><span class="line"> *  @param animated 是否显示动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeStringUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *mask;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeStringUIView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 创建文本</span></span><br><span class="line">        [<span class="keyword">self</span> createLabel:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="comment">// 创建mask</span></span><br><span class="line">        [<span class="keyword">self</span> createMask:<span class="keyword">self</span>.bounds];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.mask.frame;</span><br><span class="line">    frame.origin.x += frame.size.width;</span><br><span class="line">    <span class="keyword">if</span> (animated) &#123;</span><br><span class="line"></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createLabel:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span>.label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:frame];</span><br><span class="line">    <span class="keyword">self</span>.label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20.</span>f];</span><br><span class="line">    <span class="keyword">self</span>.label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    <span class="keyword">self</span>.label.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.label];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createMask:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="comment">// 创建出渐变的layer</span></span><br><span class="line">    <span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    gradientLayer.frame = frame;</span><br><span class="line">    gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">    gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.1</span>), @(<span class="number">0.9</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">    gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.mask = [[<span class="built_in">UIView</span> alloc] initWithFrame:frame];</span><br><span class="line">    [<span class="keyword">self</span>.mask.layer addSublayer:gradientLayer];</span><br><span class="line">    <span class="keyword">self</span>.maskView = <span class="keyword">self</span>.mask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 重写 text 的set和get， 该值被修改时同时更新到 label</span></span><br><span class="line"><span class="keyword">@synthesize</span> text = _text;</span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    _text = text;</span><br><span class="line">    <span class="keyword">self</span>.label.text = text;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">return</span> _text;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-2-使用该控件"><a href="#3-3-4-2-使用该控件" class="headerlink" title="3.3.4.2    使用该控件"></a>3.3.4.2    使用该控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 创建 FadeStringUIView 实例</span></span><br><span class="line">    FadeString<span class="built_in">UIView</span> *fadeString = [[FadeString<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">100</span>)];</span><br><span class="line">    fadeString.text = <span class="string">@"如果一个人不按照他想的方式活，那么很快就会按照他活的方式想。"</span>;</span><br><span class="line">    fadeString.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:fadeString];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行动画效果</span></span><br><span class="line">    [fadeString fadeRightWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-4-使用-Facebook-开源动画库-POP-实现"><a href="#3-4-使用-Facebook-开源动画库-POP-实现" class="headerlink" title="3.4    使用 Facebook 开源动画库 POP 实现"></a>3.4    使用 Facebook 开源动画库 POP 实现</h2><blockquote>
<p><strong>课程说明：</strong><code>POP</code> 动画库是 <code>Facebook</code> 在 2014 年开源出来的一个高效的动画引擎，它与 <code>CoreAnimation</code> 的实现机制有着巨大区别，但使用方式极为相似，其动画效果逼真而优美，虽无法完全替换 <code>CoreAnimation</code>，但掌握它，将会使你的应用的交互效果惊艳而脱颖而出。<br><strong>Github地址：</strong><a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a></p>
</blockquote>
<h3 id="3-4-1-POP动画引擎简介"><a href="#3-4-1-POP动画引擎简介" class="headerlink" title="3.4.1    POP动画引擎简介"></a>3.4.1    <code>POP</code>动画引擎简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时示例演示 <code>POP</code> 动画的强大之处，讲解 <code>CADisplayLink</code> 的作用，以及 <code>POP</code> 动画引擎与 <code>CoreAnimation</code> 之间的联系。</p>
<ol>
<li>pop动画引擎是Facebook公司开源的</li>
<li>pop动画引擎主要实现了真实物理系的动画效果（弹簧效果与衰减效果）</li>
<li>pop动画引擎的动画效果非常流畅，因为它是用了<code>CADisplayLink</code>来刷新画面（帧）</li>
<li>pop动画引擎自成体系，与系统的<code>CoreAnimation</code>有很大的区别，但使用非常类似</li>
</ol>
</blockquote>
<h4 id="3-4-1-1-POP效果展示"><a href="#3-4-1-1-POP效果展示" class="headerlink" title="3.4.1.1    POP效果展示"></a>3.4.1.1    POP效果展示</h4><h4 id="3-4-1-2-CADisplayLink"><a href="#3-4-1-2-CADisplayLink" class="headerlink" title="3.4.1.2    CADisplayLink"></a>3.4.1.2    CADisplayLink</h4><blockquote>
<p><strong>说明：</strong><code>POP</code>通过<code>CADisplayLink</code>刷新动画的（60帧/秒，同iOS系统本身的刷新频率）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>演示<code>CADisplayLink</code>使用方式，在中端1秒输出60次。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CADisplayLink</span> *displayLink;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> count;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 displayLink</span></span><br><span class="line">    <span class="keyword">self</span>.displayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(displayLinkEvent:)];</span><br><span class="line">    <span class="comment">// 1秒钟后开始刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventOne) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 2秒中后停止刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventTwo) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  每次刷新调用该方法</span><br><span class="line"> *</span><br><span class="line"> *  @param object 对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLinkEvent:(<span class="keyword">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.count ++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"count = %ld"</span>, (<span class="keyword">long</span>)<span class="keyword">self</span>.count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  开始刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventOne</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink addToRunLoop:[<span class="built_in">NSRunLoop</span> currentRunLoop] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  停止刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventTwo</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink invalidate];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-POP动画引擎中Layer与CALayer的联系与区别"><a href="#3-4-2-POP动画引擎中Layer与CALayer的联系与区别" class="headerlink" title="3.4.2    POP动画引擎中Layer与CALayer的联系与区别"></a>3.4.2    <code>POP</code>动画引擎中<code>Layer</code>与<code>CALayer</code>的联系与区别</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>POP</code> 动画中的 Layer 与 <code>CALayer</code> 的一些共性与区别。<br><strong>比较：</strong></p>
<ol>
<li>使用<code>POP</code>动画与使用<code>CALayer</code>动画非常相似</li>
<li><p><code>POP</code>动画的执行没有中间状态：相比POP动画，<code>CALayer</code>动画有中间状态：实际动画角色是立即到达结束时的位置的，中间状态指的是是“虚拟”的动画<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.44.12.png" alt="Alt text"></p>
</li>
<li><p><code>POP</code>动画是对<code>CALayer</code>动画的扩充，但不能实现所有的<code>CALayer</code>的动画效果</p>
</li>
<li><code>POP</code>动画可以作用在任何对象上，不仅仅是<code>CALayer</code></li>
</ol>
<p><strong>其它参考：</strong></p>
<ul>
<li><a href="http://www.cocoachina.com/industry/20140527/8565.html" target="_blank" rel="external">http://www.cocoachina.com/industry/20140527/8565.html</a></li>
</ul>
<p><strong>实例：</strong></p>
<ol>
<li>导入<code>POP</code>框架(<a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a>)<blockquote>
<p><strong>方式1：</strong>使用<a href="http://www.jianshu.com/p/071d30a3af02" target="_blank" rel="external">cocoapods</a>安装<br><strong>方式2：</strong>直接导入源码（可以配合<code>pch</code>文件）<br>教程：<a href="http://www.jianshu.com/p/67ce72c4ad6c" target="_blank" rel="external">http://www.jianshu.com/p/67ce72c4ad6c</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.53.54.png" alt="Alt text"><br><strong>方式3：</strong>二进制文件<code>.framework</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<h4 id="3-4-2-1-导入POP框架"><a href="#3-4-2-1-导入POP框架" class="headerlink" title="3.4.2.1    导入POP框架"></a>3.4.2.1    导入<code>POP</code>框架</h4><blockquote>
<p><strong>说明：</strong>使用<code>CocoaPods</code><br><strong>可能的出错：</strong><a href="http://www.tuicool.com/articles/InIBbaf" target="_blank" rel="external">http://www.tuicool.com/articles/InIBbaf</a><br><strong>注意：</strong>安装好依赖后，需要从<code>项目名.xcworkspace</code>重启项目。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ pod search pop<span class="comment"># 搜索版本号</span></span><br><span class="line">$ <span class="built_in">cd</span> /Users/tonyearth/Documents/My Study/Animation/L04POP动画引擎中Layer与CALayer的联系与区别 <span class="comment">#到项目目录下</span></span><br><span class="line">$ pod init<span class="comment"># 初始化环境</span></span><br><span class="line">$ vim Podfile<span class="comment"># 依赖配置</span></span><br><span class="line">	platform :ios, <span class="string">'7.0'</span></span><br><span class="line">	pod <span class="string">'pop'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line">$ pod install<span class="comment"># 安装依赖</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-1-比较CALayer和POP-CAlayer"><a href="#3-4-2-1-比较CALayer和POP-CAlayer" class="headerlink" title="3.4.2.1    比较CALayer和POP CAlayer"></a>3.4.2.1    比较CALayer和POP CAlayer</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_pop.gif" alt="Alt text|150x200"></p>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *normal<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *pop<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理 normalCALayer</span></span><br><span class="line">    [<span class="keyword">self</span> accessNormal<span class="built_in">CALayer</span>];</span><br><span class="line">    <span class="comment">// 处理 POP 动画</span></span><br><span class="line">    [<span class="keyword">self</span> accessPOP<span class="built_in">CALayer</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - pop CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  pop CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessPOP<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.popCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.popCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 POP 动画</span></span><br><span class="line">    POPBasicAnimation *popAnimation = \</span><br><span class="line">    [POPBasicAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">    popAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">100</span> + <span class="number">50</span>, <span class="number">400</span>)];<span class="comment">// pop 动画不需要 fromValue</span></span><br><span class="line">    popAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    popAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_addAnimation:popAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：在哪儿移除就停在哪儿</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removePopAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1.5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removePopAnimation</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_removeAllAnimations];<span class="comment">// 移除所有 pop 动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessNormal<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.normalCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *baseAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    baseAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.normalCALayer.position];</span><br><span class="line">    baseAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>)];</span><br><span class="line">        baseAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    baseAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置结束位置的值</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.position = <span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>);</span><br><span class="line">    <span class="comment">// 开始动画</span></span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer addAnimation:baseAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：无论在哪儿停止，都会出现在最后设置的位置（非常突兀）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removeNormalAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNormalAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = <span class="keyword">self</span>.normalCALayer.presentationLayer;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(layer.frame));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(<span class="keyword">self</span>.normalCALayer.frame));</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer removeAllAnimations];<span class="comment">// 移除掉所有动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-用POP动画引擎实现衰减动画"><a href="#3-4-3-用POP动画引擎实现衰减动画" class="headerlink" title="3.4.3    用POP动画引擎实现衰减动画"></a>3.4.3    用<code>POP</code>动画引擎实现衰减动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现移动<code>View</code> 并停止时衰减的动画效果。<br><strong>要点：</strong></p>
<ol>
<li>衰减动画由<code>POPDecayAnimation</code>来实现</li>
<li>需要精确计算停止运动瞬间的加速度才能用衰减动画做出真实的效果</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_decay.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *button;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化button</span></span><br><span class="line">    <span class="keyword">self</span>.button = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.button.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.button.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.button];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [<span class="keyword">self</span>.button addTarget:<span class="keyword">self</span></span><br><span class="line">                    action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">          forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 初始化手势</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *panGesture = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePanGesture:)];</span><br><span class="line">    <span class="comment">// 添加手势</span></span><br><span class="line">    [<span class="keyword">self</span>.button addGestureRecognizer:panGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击按钮取消按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param button 按钮控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    [button.layer pop_removeAllAnimations];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  手势操作的响应函数</span><br><span class="line"> *</span><br><span class="line"> *  @param recognizer 事件目标控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)handlePanGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [recognizer translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    recognizer.view.center = <span class="built_in">CGPointMake</span>(recognizer.view.center.x + translation.x,</span><br><span class="line">                                         recognizer.view.center.y + translation.y);</span><br><span class="line">    [recognizer setTranslation:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>) inView:<span class="keyword">self</span>.view];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拖动停止</span></span><br><span class="line">    <span class="keyword">if</span> (recognizer.state == <span class="built_in">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class="line">        <span class="comment">//1. 创建动画</span></span><br><span class="line">        <span class="comment">// 获取加速度</span></span><br><span class="line">        <span class="built_in">CGPoint</span> velocity = [recognizer velocityInView:<span class="keyword">self</span>.view];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化POP的decay(衰减)动画</span></span><br><span class="line">        POPDecayAnimation *decayAnimation = \</span><br><span class="line">            [POPDecayAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">        <span class="comment">// 设置加速度</span></span><br><span class="line">        decayAnimation.velocity = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:velocity];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 执行动画</span></span><br><span class="line">        [recognizer.view.layer pop_addAnimation:decayAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-用POP动画引擎实现弹簧动画"><a href="#3-4-4-用POP动画引擎实现弹簧动画" class="headerlink" title="3.4.4    用POP动画引擎实现弹簧动画"></a>3.4.4    用<code>POP</code>动画引擎实现弹簧动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现 View 的放大缩小等的弹簧效果。<br><strong>扩展：</strong><code>Shimmer</code><br><strong>要点：</strong></p>
<ol>
<li>弹簧动画由<code>POPSpringAnimation</code></li>
<li>弹簧的质量、速度、时间等值都是可以设置的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_spring.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置背景色</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 延时3秒执行动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(startSpringAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例弹簧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)startSpringAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化spring动画</span></span><br><span class="line">    POPSpringAnimation *sizeAnimation = \</span><br><span class="line">    [POPSpringAnimation animationWithPropertyNamed:kPOPLayerBounds];<span class="comment">// 缩放型动画</span></span><br><span class="line">    sizeAnimation.springSpeed = <span class="number">0.</span>f;</span><br><span class="line">    sizeAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.showView pop_addAnimation:sizeAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-5-用缓动函数模拟物理动画"><a href="#3-5-用缓动函数模拟物理动画" class="headerlink" title="3.5    用缓动函数模拟物理动画"></a>3.5    用缓动函数模拟物理动画</h2><h3 id="3-5-1-缓动函数简介"><a href="#3-5-1-缓动函数简介" class="headerlink" title="3.5.1    缓动函数简介"></a>3.5.1    缓动函数简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时将演示缓动函数能做出来的效果，然后讲解它的基本原理。</p>
<ol>
<li>缓动函数的动画效果是建立在<code>CALayer</code>层级的关键帧动画基础之上</li>
<li>缓动函数是一系列模拟物理效果（如抛物线）方程式的统称，用以计算给定亮点之间的插值</li>
<li>两点之间插的值越多，效果越好，但是会耗费更多的性能</li>
<li>只有理解了缓动函数的原理才有可能写出自己想要的效果</li>
</ol>
<p><strong>缓动函数源码：</strong><a href="https://github.com/YouXianMing/EasingAnimation" target="_blank" rel="external">https://github.com/YouXianMing/EasingAnimation</a></p>
</blockquote>
<h4 id="3-5-1-1-缓动函数类型"><a href="#3-5-1-1-缓动函数类型" class="headerlink" title="3.5.1.1    缓动函数类型"></a>3.5.1.1    缓动函数类型</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-09%20%E4%B8%8B%E5%8D%8810.52.45.png" alt="Alt text"></p>
<h4 id="3-5-1-2-缓动效果示例"><a href="#3-5-1-2-缓动效果示例" class="headerlink" title="3.5.1.2    缓动效果示例"></a>3.5.1.2    缓动效果示例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_easing.gif" alt="Alt text"></p>
<h3 id="3-5-2-缓动函数与关键帧动画的联系"><a href="#3-5-2-缓动函数与关键帧动画的联系" class="headerlink" title="3.5.2    缓动函数与关键帧动画的联系"></a>3.5.2    缓动函数与关键帧动画的联系</h3><blockquote>
<p><strong>课程说明：</strong>本课时将讲解关键帧动画的原理，并分析关键帧动画与缓动函数之间的联系。</p>
<ol>
<li>关键帧动画需要提供很多的帧来完善动画效果</li>
<li>关键帧动画的帧可以通过一定的数学计算来提供需要的帧数</li>
<li><code>关键帧动画只需要提供起始点、结束点，就可以通过缓动函数来计算中间“缺失”的帧</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-10%20%E4%B8%8B%E5%8D%8812.00.12.png" alt="Alt text"></li>
<li>缓动函数可以指定计算出多少帧</li>
<li>帧数越多，动画越流畅，但同时耗费更多GPU性能</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>缓动动画只是缓动函数在关键帧动画中的一种应用</li>
<li>当只插值只有起点和终点时，关键帧动画和基本动画效果一致</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化显示用的view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本动画</span></span><br><span class="line">    <span class="comment">// [self baseAnimation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关键帧动画</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  基本动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)baseAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *basicAnimation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    basicAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    basicAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    <span class="comment">// fromValue = A, toValue = B</span></span><br><span class="line">    basicAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.showView.center];</span><br><span class="line">    basicAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:basicAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  关键帧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    <span class="comment">// 插值（通过缓动函数创建一些列插值点）</span></span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromPoint:<span class="keyword">self</span>.showView.center<span class="comment">// 起点</span></span><br><span class="line">                                                         toPoint:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)<span class="comment">//终点</span></span><br><span class="line">                                                            func:BounceEaseIn<span class="comment">// 动画进度</span></span><br><span class="line">                                                      frameCount:<span class="number">60</span> * <span class="number">2</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="comment">// 2. 实际目标位置</span></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加动画到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-用缓动函数模拟弹簧效果"><a href="#3-5-3-用缓动函数模拟弹簧效果" class="headerlink" title="3.5.3    用缓动函数模拟弹簧效果"></a>3.5.3    用缓动函数模拟弹簧效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数结合关键帧动画实现弹簧效果，并模拟秒表摆动效果。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_time.gif" alt="Alt text|100x90"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *secLayer;<span class="comment">// 秒针</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个表盘 UIView</span></span><br><span class="line">    <span class="built_in">UIView</span> *showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    showView.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    showView.layer.cornerRadius = <span class="number">150</span>;</span><br><span class="line">    showView.layer.borderColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建出秒针 CALayer</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.secLayer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">150</span>, <span class="number">150</span>, <span class="number">1</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.backgroundColor = [<span class="built_in">UIColor</span> blackColor].CGColor;</span><br><span class="line">    [showView.layer addSublayer:<span class="keyword">self</span>.secLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f<span class="comment">// 1秒钟调用一次</span></span><br><span class="line">                                                  target:<span class="keyword">self</span><span class="comment">// 目标控制器</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent) <span class="comment">// 目标方法</span></span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  指针变化动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">1</span>;<span class="comment">// 时间点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> oldValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i++);<span class="comment">// 旧弧度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> newValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i);<span class="comment">// 新弧度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"transform.rotation.z"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">0.5</span>;</span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromValue:oldValue<span class="comment">// 起始弧度</span></span><br><span class="line">                                                         toValue:newValue<span class="comment">// 结束弧度</span></span><br><span class="line">                                                            func:ElasticEaseOut <span class="comment">// 动画效果</span></span><br><span class="line">                                                      frameCount:<span class="number">0.5</span> * <span class="number">30</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer.transform = <span class="built_in">CATransform3DMakeRotation</span>(newValue,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">1</span>);</span><br><span class="line">    [<span class="keyword">self</span>.secLayer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-4-用缓动函数模拟碰撞效果"><a href="#3-5-4-用缓动函数模拟碰撞效果" class="headerlink" title="3.5.4    用缓动函数模拟碰撞效果"></a>3.5.4    用缓动函数模拟碰撞效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现碰撞动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutBounce</code>函数来创建碰撞效果</li>
<li>将<code>easeOutBounce</code>创建出来的帧数组添加到关键帧动画中</li>
<li>碰撞效果用途</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_bounce.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 创建图 view</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">100</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    imageView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画（移动距离的动画）</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>)</span><br><span class="line">                                     func:BounceEaseOut<span class="comment">// 碰撞动画</span></span><br><span class="line">                               frameCount:<span class="number">2</span> * <span class="number">30</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation</span><br><span class="line">                           forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-用缓动函数模拟衰减效果"><a href="#3-5-5-用缓动函数模拟衰减效果" class="headerlink" title="3.5.5    用缓动函数模拟衰减效果"></a>3.5.5    用缓动函数模拟衰减效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现衰减动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutCubic</code>函数来创建弹簧效果</li>
<li>将<code>easeOutCubic</code>创建出来的的帧数组添加到关键帧动画中</li>
<li>衰减效果用途</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_cubic.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画1:背景变暗</span></span><br><span class="line">    <span class="built_in">UIView</span>  *backView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    backView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">        backView.alpha = <span class="number">0.3</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:backView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画2:衰减滑出</span></span><br><span class="line">    <span class="comment">// 创建图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">320</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">568</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y)</span><br><span class="line">                                     func:CubicEaseOut</span><br><span class="line">                               frameCount:<span class="number">1</span> * <span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-使用带粒子效果的-CAEmitterLayer"><a href="#3-6-使用带粒子效果的-CAEmitterLayer" class="headerlink" title="3.6    使用带粒子效果的 CAEmitterLayer"></a>3.6    使用带粒子效果的 CAEmitterLayer</h2><h3 id="3-6-1-用-CAEmitterLayer-产生粒子效果"><a href="#3-6-1-用-CAEmitterLayer-产生粒子效果" class="headerlink" title="3.6.1    用 CAEmitterLayer 产生粒子效果"></a>3.6.1    用 CAEmitterLayer 产生粒子效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>CAEmitterLayer</code> 的一些基本属性，以及基本的用法。</p>
<ul>
<li><code>CAEmitterLayer</code>的用途：实现粒子效果</li>
<li><code>CAEmitterLayer</code>参数</li>
<li><code>CAEmitterLayer</code>优点：使用<code>GPU</code>渲染，不占用<code>CPU</code>资源，远优于使用大量的随机<code>View</code>来实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_emitter.gif" alt="Alt text"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. CAEmitterLayer</span></span><br><span class="line"><span class="comment">// 创建出粒子发射图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayer</span> *emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</span><br><span class="line">emitterLayer.borderWidth = <span class="number">2.</span>f;<span class="comment">// 边框宽度（显示边框）</span></span><br><span class="line">emitterLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>);<span class="comment">// 设置尺寸</span></span><br><span class="line">emitterLayer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏溢出的粒子</span></span><br><span class="line">emitterLayer.emitterPosition = <span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">50</span>);<span class="comment">// 发射点</span></span><br><span class="line">emitterLayer.emitterMode = k<span class="built_in">CAEmitterLayerSurface</span>;<span class="comment">// 发射模式</span></span><br><span class="line">emitterLayer.emitterShape = k<span class="built_in">CAEmitterLayerLine</span>;<span class="comment">// 发射形状</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加图层到当前视图图层</span></span><br><span class="line">[<span class="keyword">self</span>.view.layer addSublayer:emitterLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. CAEmitterCell（粒子）</span></span><br><span class="line"><span class="built_in">CAEmitterCell</span> *cell = [<span class="built_in">CAEmitterCell</span> emitterCell];</span><br><span class="line">cell.birthRate = <span class="number">10.</span>f;<span class="comment">// 粒子产生率</span></span><br><span class="line">cell.lifetime = <span class="number">120.</span>f;<span class="comment">// 粒子声明周期</span></span><br><span class="line">cell.velocity = <span class="number">30</span>;<span class="comment">// 加速度</span></span><br><span class="line">cell.velocityRange = <span class="number">10.</span>f;<span class="comment">// 加速度微调</span></span><br><span class="line">cell.yAcceleration = <span class="number">2.</span>f;<span class="comment">// y 轴加速度</span></span><br><span class="line">cell.emissionRange = <span class="number">0.5</span> * M_1_PI;<span class="comment">// 发射角度</span></span><br><span class="line">cell.color = [<span class="built_in">UIColor</span> blackColor].CGColor;<span class="comment">// 设置粒子颜色</span></span><br><span class="line">cell.contents = (__bridge <span class="keyword">id</span>)([<span class="built_in">UIImage</span> imageNamed:<span class="string">@"snow"</span>].CGImage);<span class="comment">// 设置图片</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将 CAEmitterCell(粒子)关联到CAEmitterLayer</span></span><br><span class="line">emitterLayer.emitterCells = @[cell];</span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-封装-CAEmitterLayerUIVIew"><a href="#3-6-2-封装-CAEmitterLayerUIVIew" class="headerlink" title="3.6.2    封装 CAEmitterLayerUIVIew"></a>3.6.2    封装 CAEmitterLayerUIVIew</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解了为了避免繁琐的设置而将 <code>CAEmitterLayer</code> 封装成一个较为通用的父类供子类使用。</p>
<ul>
<li>替换<code>CAEmitterLayer</code>成<code>UIView</code>子类的<code>backedLayer</code></li>
<li>将<code>CAEmitterLayer</code>封装的类作为“抽象“父类</li>
</ul>
<p><strong>说明：</strong>封装一个父类(<code>CAEmitterLayerUIView</code>)，其它类型的粒子图层继承该类，将设置封装到子类的<code>show</code>和<code>hide</code>实现中。</p>
</blockquote>
<p><em>CAEmitterLayerUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示view</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏view</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CAEmitterLayerUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CAEmitterLayerUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">CAEmitterLayer</span> *_emitterLayer;<span class="comment">// 粒子图层</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CAEmitterLayerUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        _emitterLayer = (<span class="built_in">CAEmitterLayer</span> *)<span class="keyword">self</span>.layer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类本身</span></span><br><span class="line">+ (Class)layerClass</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">CAEmitterLayer</span> class];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer</span><br><span class="line">&#123;</span><br><span class="line">    _emitterLayer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _emitterLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-封装下雪、下雨的粒子效果控件"><a href="#3-6-3-封装下雪、下雨的粒子效果控件" class="headerlink" title="3.6.3    封装下雪、下雨的粒子效果控件"></a>3.6.3    封装下雪、下雨的粒子效果控件</h3><blockquote>
<p><strong>课程说明：</strong>本课时在封装 <code>CAEmitterLayer</code> 基础上进一步从“抽象”父类派生出下雪、下雨的子类控件。</p>
<ul>
<li>从封装<code>CAEmitterLayer</code>的“抽象”父类继承的原因</li>
<li>下雪、下雨效果参数的设置</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_rain.gif" alt="Alt text"></p>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用控件</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 初始化粒子效果图层</span></span><br><span class="line"><span class="comment">// 下雪效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *snowView = [[SnowView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line"><span class="comment">// 下雨效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *rainView = [[RainView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">210</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 模糊化粒子视图边界</span></span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView1 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView1.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"></span><br><span class="line">snowView.maskView = alphaView1;</span><br><span class="line">rainView.maskView = alphaView2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加到当前图层</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:rainView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 展现</span></span><br><span class="line">[snowView show];</span><br><span class="line">[rainView show];</span><br></pre></td></tr></table></figure>
<h2 id="3-7-iOS-中-CAGradientLaueyer-的使用"><a href="#3-7-iOS-中-CAGradientLaueyer-的使用" class="headerlink" title="3.7    iOS 中 CAGradientLaueyer 的使用"></a>3.7    iOS 中 CAGradientLaueyer 的使用</h2><h3 id="3-7-1-CAGradientLayer-简介"><a href="#3-7-1-CAGradientLayer-简介" class="headerlink" title="3.7.1    CAGradientLayer 简介"></a>3.7.1    CAGradientLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课演示 <code>CAGradientLayer</code> 能做的一些动画效果，以及 <code>CAGradientLayer</code> 与 <code>CAShapeLayer</code> 配合使用的实例。</p>
<ol>
<li><code>CAGradientLayer</code>是用于处理渐变色的层结构</li>
<li><code>CAGradientLayer</code>的渐变色可以做隐式动画</li>
<li>大部分情况下，<code>CAGradientLayer</code>都是与<code>CAShapeLayer</code>配合使用的</li>
<li><code>CAGradientLayer</code>可以用作<code>png</code>遮罩效果</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam1.gif" alt="Alt text|100x100"> <code>CAShapeLayer</code>作为<code>CAGradientLayer</code>的遮罩实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam2.gif" alt="Alt text|100x100">旋转<code>CAGradientLayer</code>实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam3.gif" alt="Alt text|100x160"> 色差动画效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam4.gif" alt="Alt text|100x160">作为<code>png</code>图片遮罩动画效果</p>
<h3 id="3-7-2-CAGradientLayer-坐标系统"><a href="#3-7-2-CAGradientLayer-坐标系统" class="headerlink" title="3.7.2    CAGradientLayer 坐标系统"></a>3.7.2    CAGradientLayer 坐标系统</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解 CAGradientLayer 的坐标系统，并延伸讲解了坐标系统影响如何颜色分配、动画效果。</p>
<ol>
<li><code>CAGradientLayer</code>的坐标系统是从坐标（0, 0）到（1, 1）绘制的矩形<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.44.12.png" alt="Alt text|200x180"></li>
<li><code>CAGradientLayer</code>的<code>frame</code>值的<code>size</code>不为正方形的话，坐标系统会被拉伸</li>
<li><code>CAGradientLayer</code>的<code>startPoint</code>与<code>endPoint</code>会直接影响颜色的绘制方向</li>
<li><code>CAGradientLayer</code>的颜色分割线是以0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.45.28.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_gra.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 1. 创建并初始化 CAGradientLayer 实例</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.gradientLayer];<span class="comment">// 添加到视图</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 渐变效果相关设置</span></span><br><span class="line">    <span class="comment">// 颜色</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> greenColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor].CGColor];</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 动画:3秒后修改分割点</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(gradientLayerLocationLocationAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  修改分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)gradientLayerLocationLocationAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 颜色分割点效果</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.5</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-3-色差动画的实现"><a href="#3-7-3-色差动画的实现" class="headerlink" title="3.7.3    色差动画的实现"></a>3.7.3    色差动画的实现</h3><blockquote>
<p><strong>课程说明：</strong>本课用 CAGradientLayer 实现色差动画效果。</p>
<ol>
<li>确定渐变色渐变方向</li>
<li>设定两种颜色，其中一种是透明色，另外一种是自定义颜色</li>
<li>设定好<code>location</code>颜色分割点</li>
<li><code>CAGradientLayer</code>的颜色分割点是0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_colors.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建 UIImage 实例（作为背景）</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>]];</span><br><span class="line">    imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 初始化渐变图层</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = imageView.bounds;</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.5</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 组合背景和渐变图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    [imageView.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 初始化定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                                  target:<span class="keyword">self</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent)</span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  刷新颜色组合分割点，从而制造动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取一组随机产生的颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> colorWithRed:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               green:arc4random() % <span class="number">255</span> /  <span class="number">255.</span>f</span><br><span class="line">                                                                blue:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">    <span class="comment">// 获取随机产生的分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(arc4random() % <span class="number">10</span> / <span class="number">10.</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-4-用-CAGradientLayer-封装带色差动画的-View"><a href="#3-7-4-用-CAGradientLayer-封装带色差动画的-View" class="headerlink" title="3.7.4    用 CAGradientLayer 封装带色差动画的 View"></a>3.7.4    用 CAGradientLayer 封装带色差动画的 View</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解将色差动画效果封装到 View 当中。</p>
<ol>
<li>确定几个属性值</li>
<li>去定意义做动画的参数</li>
<li>重写<code>setter</code>做动画</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_last.gif" alt="Alt text"></p>
<h4 id="3-7-4-1-封装好的视图"><a href="#3-7-4-1-封装好的视图" class="headerlink" title="3.7.4.1    封装好的视图"></a>3.7.4.1    封装好的视图</h4><blockquote>
<p><strong>说明：</strong>将对视图的渐变层的设置工作整合到<code>setter</code>中。</p>
</blockquote>
<p><em>ColorUIImageView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 渐变方向</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    UP,<span class="comment">// 从上至下</span></span><br><span class="line">    DOWN,<span class="comment">// 从下往上</span></span><br><span class="line">    RIGHT,<span class="comment">// 从左到右</span></span><br><span class="line">    LEFT<span class="comment">// 从右往左</span></span><br><span class="line">&#125; EColorDirection;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> : <span class="title">UIImageView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) EColorDirection direction;<span class="comment">// 渐变方向(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;<span class="comment">// 颜色(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> percent;<span class="comment">// 百分比(可以做动画)</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ColorUIImageView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ColorUIImageView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化 CAGradientLayer 实例</span></span><br><span class="line">        <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                      (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">1</span>), @(<span class="number">1</span>)];</span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色组 color</span></span><br><span class="line"><span class="keyword">@synthesize</span> color = _color;</span><br><span class="line">- (<span class="keyword">void</span>)setColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    _color = color;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)color.CGColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渐变方向 direction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> direction = _direction;</span><br><span class="line">- (<span class="keyword">void</span>)setDirection:(EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    _direction = direction;</span><br><span class="line">    <span class="keyword">if</span> (direction == UP) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == DOWN) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == RIGHT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == LEFT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _direction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 分割点 percent</span></span><br><span class="line"><span class="keyword">@synthesize</span> percent = _percent;</span><br><span class="line">- (<span class="keyword">void</span>)setPercent:(<span class="built_in">CGFloat</span>)percent &#123;</span><br><span class="line">    _percent = percent;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(percent), @(<span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _percent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-7-4-2-使用"><a href="#3-7-4-2-使用" class="headerlink" title="3.7.4.2    使用"></a>3.7.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Color<span class="built_in">UIImageView</span> *colorView;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 初始化封装了渐变图层的自定义视图</span></span><br><span class="line">    <span class="keyword">self</span>.colorView        = [[Color<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">198</span>, <span class="number">253</span>)];</span><br><span class="line">    <span class="keyword">self</span>.colorView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.colorView.image  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.colorView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 1秒钟后改变视图</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(event)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">1.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变渐变颜色组、渐变方向和分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)event &#123;</span><br><span class="line">    <span class="keyword">self</span>.colorView.direction = DOWN;</span><br><span class="line">    <span class="keyword">self</span>.colorView.color     = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.colorView.percent   = <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-8-iOS中-CAShapeLayer-的使用"><a href="#3-8-iOS中-CAShapeLayer-的使用" class="headerlink" title="3.8    iOS中 CAShapeLayer 的使用"></a>3.8    iOS中 CAShapeLayer 的使用</h2><h3 id="3-8-1-CAShapeLayer-简介"><a href="#3-8-1-CAShapeLayer-简介" class="headerlink" title="3.8.1    CAShapeLayer 简介"></a>3.8.1    CAShapeLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍 <code>CAShapeLayer</code> 与 <code>CALayer</code>、贝塞尔曲线之间的简单联系，并通过一个 demo 演示 <code>CAShapeLayer</code> 实现的路径动画效果。</p>
<ol>
<li><code>CAShapeLayer</code>继承自<code>CALayer</code>，可以使用<code>CALayer</code>的所有属性值</li>
<li><code>CAShapeLayer</code>需要与贝塞尔曲线配合使用才有意义</li>
<li>使用<code>CAShapeLayer</code>与贝塞尔曲线可以实现不在<code>view</code>的<code>drawRect</code>方法中画出一些想要的图形</li>
<li><code>CAShapeLayer</code>属于<code>CoreAnimation</code>框架，其动画渲染直接提交到手机的<code>GPU</code>当中，相较于<code>view</code>的<code>srawRect</code>方法使用<code>CPU</code>渲染而言，其效率极高，能大大优化内存使用情况。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_path.gif" alt="Alt text"></p>
<h3 id="3-8-2-贝塞尔曲线与-CAShapeLayer-的关系"><a href="#3-8-2-贝塞尔曲线与-CAShapeLayer-的关系" class="headerlink" title="3.8.2    贝塞尔曲线与 CAShapeLayer 的关系"></a>3.8.2    贝塞尔曲线与 CAShapeLayer 的关系</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍多阶贝塞尔曲线的用途，并详细讲解贝塞尔曲线与 <code>CAShapeLayer</code> 之间的关系，以及使用贝塞尔曲线的一些注意事项。</p>
<ol>
<li><code>CAShapeLayer</code>中有<code>Shape</code>这个单词，顾名思义，它需要一个形状才能生效</li>
<li>贝赛尔曲线可以创建基于矢量的路径<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_beisaier.gif" alt="Alt text"></li>
<li>贝塞尔曲线给<code>CAShaperLayer</code>提供路径，<code>CAShpaeLayer</code>在提供的路径中进行渲染，路径会闭环，所以路径绘制出了<code>Shape</code></li>
<li>用于<code>CAShapeLayer</code>的贝赛尔曲线作为<code>path</code>，其中<code>path</code>是一个首尾相接的闭环的曲线，即使该贝赛尔曲线不是一个闭环的曲线。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-12%2019.14.35.png" alt="Alt text"></p>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">    <span class="comment">// UIBezierPath *oval = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(0, 0, 200, 100)];// 椭圆形</span></span><br><span class="line">    <span class="comment">// UIBezierPath *rect = [UIBezierPath bezierPathWithRect:CGRectMake(0, 0, 200, 100)];// 矩形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *circle = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];<span class="comment">// 圆形</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">    <span class="built_in">CAShapeLayer</span> *shape = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    shape.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">    shape.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    shape.borderWidth = <span class="number">1.</span>f;<span class="comment">// 显示 CAShapeLayer 的边界</span></span><br><span class="line">    shape.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏益处的贝塞尔曲线围住的区域</span></span><br><span class="line">    shape.fillColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 建立关联</span></span><br><span class="line">    shape.path = circle.CGPath;<span class="comment">// 看下圆形的效果</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:shape];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-3-StrokeStart-与-StrokeEnd-动画"><a href="#3-8-3-StrokeStart-与-StrokeEnd-动画" class="headerlink" title="3.8.3    StrokeStart 与 StrokeEnd 动画"></a>3.8.3    StrokeStart 与 StrokeEnd 动画</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何设置 <code>CAShapeLayer</code> 的属性值来显示出圆环并用 <code>CAShapeLayer</code> 的 <code>StrokeStart</code> 与 <code>StrokeEnd</code> 属性做动画。</p>
<ol>
<li>将<code>ShapeLayer</code>的<code>fillColor</code>设置成透明背景</li>
<li>设置线条的宽度(<code>lineWidth</code>)的值</li>
<li>设置线条的颜色</li>
<li>将<code>strokeStart</code>的值设定成0，然后让<code>strokeEnd</code>的值变化触发隐式动画</li>
</ol>
<p><strong>注意：</strong>同时设置<code>strokeStart</code>和<code>strokeEnd</code>时，前者不能大于后者。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_animeTwo.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 背景设置</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.878</span> green:<span class="number">0.878</span> blue:<span class="number">0.878</span> alpha:<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 贝塞尔曲线</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *oval = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. CAShapeLayer</span></span><br><span class="line">    _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    _shapeLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    _shapeLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">    _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    _shapeLayer.lineWidth = <span class="number">2.</span>f;</span><br><span class="line">    _shapeLayer.strokeStart = <span class="number">0.</span>f;</span><br><span class="line">    _shapeLayer.strokeEnd = <span class="number">0.</span>f;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 建立贝塞尔曲线与CAShapeLayer之间的关联</span></span><br><span class="line">    _shapeLayer.path = oval.CGPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:_shapeLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 定时器</span></span><br><span class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                              target:<span class="keyword">self</span></span><br><span class="line">                                            selector:<span class="keyword">@selector</span>(animationEventTypeTwo)</span><br><span class="line">                                            userInfo:<span class="literal">nil</span></span><br><span class="line">                                             repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  只改变 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeOne</span><br><span class="line">&#123;</span><br><span class="line">    _shapeLayer.strokeEnd = arc4random() % <span class="number">100</span> / <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  同时改变 strokeStart 和 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeTwo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueOne = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueTwo = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    </span><br><span class="line">    _shapeLayer.strokeStart = valueOne &lt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取小的</span></span><br><span class="line">    _shapeLayer.strokeEnd = valueOne &gt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取大的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-4-用-CAShapeLayer-实现圆形进度条效果"><a href="#3-8-4-用-CAShapeLayer-实现圆形进度条效果" class="headerlink" title="3.8.4    用 CAShapeLayer 实现圆形进度条效果"></a>3.8.4    用 CAShapeLayer 实现圆形进度条效果</h3><blockquote>
<p><strong>课程说明：</strong>本课在课时 3 的基础上将动画效果封装到控件当中。</p>
<ol>
<li>确定需要设定的参数</li>
<li>实现细节</li>
<li>进行测试</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_circle.gif" alt="Alt text"></p>
<h4 id="3-8-4-1-圆形进度条控件"><a href="#3-8-4-1-圆形进度条控件" class="headerlink" title="3.8.4.1    圆形进度条控件"></a>3.8.4.1    圆形进度条控件</h4><p><em>CircleUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> startValue;<span class="comment">// 起始值（0～1）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> lineWidth;<span class="comment">// 线宽（&gt;0）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> value;<span class="comment">// 变化的值</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;<span class="comment">// 线条颜色</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CircleUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CircleUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="keyword">self</span>.bounds];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">        _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">        _shapeLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">        _shapeLayer.lineWidth=  <span class="number">1.</span>f;</span><br><span class="line">        _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">        _shapeLayer.strokeEnd = <span class="number">0.</span>f;<span class="comment">// 一开使进度为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 关联</span></span><br><span class="line">        _shapeLayer.path = path.CGPath;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 添加并显示</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:_shapeLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeStart</span></span><br><span class="line"><span class="keyword">@synthesize</span> startValue = _startValue;</span><br><span class="line">- (<span class="keyword">void</span>)setStartValue:(<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    _startValue = startValue;</span><br><span class="line">    _shapeLayer.strokeStart = startValue;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    <span class="keyword">return</span> _startValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeEnd</span></span><br><span class="line"><span class="keyword">@synthesize</span> value = _value;</span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    _value = value;</span><br><span class="line">    _shapeLayer.strokeEnd = value;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    <span class="keyword">return</span> _value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lineWidth</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineWidth = _lineWidth;</span><br><span class="line">- (<span class="keyword">void</span>)setLineWidth:(<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    _lineWidth = lineWidth;</span><br><span class="line">    _shapeLayer.lineWidth = lineWidth;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeColor</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineColor = _lineColor;</span><br><span class="line">- (<span class="keyword">void</span>)setLineColor:(<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    _lineColor = lineColor;</span><br><span class="line">    _shapeLayer.strokeColor = lineColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-8-4-2-使用"><a href="#3-8-4-2-使用" class="headerlink" title="3.8.4.2    使用"></a>3.8.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    Circle<span class="built_in">UIView</span> *circle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建并设置圆型进度条</span></span><br><span class="line">    circle = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    circle.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    circle.startValue = <span class="number">0.</span>f;</span><br><span class="line">    circle.lineWidth = <span class="number">3.</span>f;</span><br><span class="line">    circle.lineColor = [<span class="built_in">UIColor</span> grayColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:circle];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 延迟3秒后动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(delayAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置圆型进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)delayAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使进度达到100%</span></span><br><span class="line">    circle.value = <span class="number">1.</span>f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-9-iOS中-CALayer-的使用"><a href="#3-9-iOS中-CALayer-的使用" class="headerlink" title="3.9    iOS中 CALayer 的使用"></a>3.9    iOS中 CALayer 的使用</h2><h3 id="3-9-1-用-CALayer-定制下载进度条控件"><a href="#3-9-1-用-CALayer-定制下载进度条控件" class="headerlink" title="3.9.1    用 CALayer 定制下载进度条控件"></a>3.9.1    用 CALayer 定制下载进度条控件</h3><blockquote>
<p><strong>课程说明：</strong>本课在通过对 <code>CALayer</code> 的基本原理讲解后用 <code>CALayer</code> 基本知识定制下载进度条控件。</p>
<ol>
<li>单独创建出<code>CALayer</code></li>
<li>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果</li>
<li>用定时器（<code>NSTimer</code>）模拟网络下载时提供的百分比数据</li>
<li>将<code>CALayer</code>封装进<code>UIView</code>子类中定制进度条控件</li>
</ol>
<p><strong>CALayer简介：</strong></p>
<ol>
<li><code>CALayer</code>一般作为<code>UIView</code>的容器使用</li>
<li><code>CALayer</code>是一个管理着图片载体（image-based content）的 层结构</li>
<li>直接修改单独创建出的<code>CALayer</code>的属性可以触发隐式动画（不需要其它设置，修改属性直接触发动画）</li>
<li><code>UIView</code>中的<code>CALayer</code>动画必须显式触发才能生效</li>
</ol>
</blockquote>
<h4 id="3-9-2-1-原理"><a href="#3-9-2-1-原理" class="headerlink" title="3.9.2.1    原理"></a>3.9.2.1    原理</h4><blockquote>
<p><strong>说明：</strong>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建layer并添加layer</span></span><br><span class="line"><span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">5</span>);</span><br><span class="line">[<span class="keyword">self</span>.view.layer addSubLayer:layer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发隐式动画</span></span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>, <span class="number">200</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-13%2010.29.42.png" alt="Alt text|200x120"></p>
<h4 id="3-9-1-2-实战"><a href="#3-9-1-2-实战" class="headerlink" title="3.9.1.2    实战"></a>3.9.1.2    实战</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
<h3 id="3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果"><a href="#3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果" class="headerlink" title="3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果"></a>3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用动画组 <code>CAAnimationGroup</code> 将 <code>bounds</code> 动画与 <code>contents</code> 动画组合起来实现切换图片时的淡入淡出效果。</p>
<ol>
<li>操作<code>UIImageView</code>的<code>CALayer</code>修改其<code>bounds</code>值进行显示动画</li>
<li>修改<code>UIImageView</code>的<code>CALayer</code>中的<code>contents</code>属性实现切换图片的动画</li>
<li>用<code>CAAnimationGroup</code>将<code>bounds</code>动画与<code>contents</code>动画组合起来</li>
<li>将上述效果封装进<code>UIView</code>的子类中生成控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_fade.gif" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="3-9-2-1-封装动画效果"><a href="#3-9-2-1-封装动画效果" class="headerlink" title="3.9.2.1    封装动画效果"></a>3.9.2.1    封装动画效果</h4><p><em>FadeUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *image;<span class="comment">// 当前图片</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 setter, getter</span></span><br><span class="line"><span class="keyword">@synthesize</span> image = _image;</span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    _image = image;</span><br><span class="line">    <span class="comment">// 除了第一次设置图片，都加入淡如淡出的效果</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.layer.contents != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建淡入/淡出的切换动画</span></span><br><span class="line">        <span class="built_in">CABasicAnimation</span> *contentsAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"contents"</span>];</span><br><span class="line">        contentsAnimation.fromValue = <span class="keyword">self</span>.layer.contents;</span><br><span class="line">        contentsAnimation.toValue = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">        contentsAnimation.duration = <span class="number">3.</span>f;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将动画添加到图层</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addAnimation:contentsAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改 contents，触发动画</span></span><br><span class="line">    <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-9-2-2-使用控件"><a href="#3-9-2-2-使用控件" class="headerlink" title="3.9.2.2    使用控件"></a>3.9.2.2    使用控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Fade<span class="built_in">UIView</span> *fadeView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化呈现动画的视图</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView = [[Fade<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.fadeView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置第一张图片</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"起始图片"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2秒钟后设置下一张图片</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(layerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置下一张图片</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"结束图片"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-9-3-用-CALayer-实现复杂遮罩效果"><a href="#3-9-3-用-CALayer-实现复杂遮罩效果" class="headerlink" title="3.9.3    用 CALayer 实现复杂遮罩效果"></a>3.9.3    用 CALayer 实现复杂遮罩效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用 CALayer 的 mask 属性作为遮罩 Layer，通过移动该遮罩 Layer 的 frame 值实现复杂的遮罩效果。</p>
<ol>
<li>遮罩原理分析</li>
<li>用<code>png</code>图片作为<code>CALayer</code>中<code>mask</code>属性的遮罩<code>Layer</code></li>
<li>移动该<code>CALayer</code>的<code>mask</code>的<code>frame</code>值实现遮罩<code>Layer</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8A%E5%8D%8812.01.58.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *imageLayer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *maskLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *imageForContents = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"原始图片"</span>];<span class="comment">// 底图</span></span><br><span class="line">    <span class="built_in">UIImage</span> *imageForMask = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"maskLayerContents"</span>];<span class="comment">// 作为遮罩的图片</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.contents = (__bridge <span class="keyword">id</span>)(imageForContents.CGImage);</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.imageLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遮罩 layer</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.contents = (__bridge <span class="keyword">id</span>)(imageForMask.CGImage);</span><br><span class="line">    <span class="comment">// self.maskLayer.backgroundColor = [UIColor whiteColor].CGColor;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给图片 layer 提供遮罩的 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer.mask = <span class="keyword">self</span>.maskLayer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3秒中中后做 maskLayer 动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(maskLayerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)maskLayerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-10-iOS绘图-API-绘制线条／文字／几何图形"><a href="#3-10-iOS绘图-API-绘制线条／文字／几何图形" class="headerlink" title="3.10    iOS绘图 API 绘制线条／文字／几何图形"></a>3.10    iOS绘图 API 绘制线条／文字／几何图形</h2><h3 id="3-10-1-绘制线条"><a href="#3-10-1-绘制线条" class="headerlink" title="3.10.1    绘制线条"></a>3.10.1    绘制线条</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460642543336.png" alt="Alt text|100x150"><br><em>DrawLines.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawLinesView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 描绘线条</span></span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">300</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">500</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出来</span></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-2-绘制矩形"><a href="#3-10-2-绘制矩形" class="headerlink" title="3.10.2    绘制矩形"></a>3.10.2    绘制矩形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8810.36.09.png" alt="Alt text"><br><em>DrawRectView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawRectView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 矩形</span></span><br><span class="line">        <span class="type">CGContextAddRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置绘图上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出矩形</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-3-绘制圆形"><a href="#3-10-3-绘制圆形" class="headerlink" title="3.10.3    绘制圆形"></a>3.10.3    绘制圆形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460644510040.png" alt="Alt text|100x150"><br><em>DrawCircleView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawCircleView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 画圆</span></span><br><span class="line">        <span class="comment">/*-- 方案一 --*/</span></span><br><span class="line">        <span class="comment">// 内部用来填充的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="comment">// 外部作为边的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">10</span>)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*-- 方案二 --*/</span></span><br><span class="line">        <span class="type">CGContextAddEllipseInRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">400</span>, <span class="number">200</span>, <span class="number">100</span>))</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line"></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-4-绘制图片"><a href="#3-10-4-绘制图片" class="headerlink" title="3.10.4    绘制图片"></a>3.10.4    绘制图片</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8811.43.57.png" alt="Alt text"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawImageView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uiImage:<span class="type">CGImageRef</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">        uiImage = <span class="type">UIImage</span>(named: <span class="string">"walle.jpg"</span>)?.<span class="type">CGImage</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制图片 */</span></span><br><span class="line">        <span class="comment">// 1. 保留之前的上下文信息（设置暂存点）</span></span><br><span class="line">        <span class="type">CGContextSaveGState</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 设置当前上下文</span></span><br><span class="line">        <span class="type">CGContextTranslateCTM</span>(context, <span class="number">10</span>, <span class="number">400</span>)<span class="comment">// 移动</span></span><br><span class="line">        <span class="type">CGContextScaleCTM</span>(context, <span class="number">1</span>, -<span class="number">1</span>)<span class="comment">// 缩放（翻转坐标系）</span></span><br><span class="line">        <span class="comment">// 3. 呈现图片</span></span><br><span class="line">        <span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>), uiImage)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制矩形 */</span></span><br><span class="line">        <span class="type">CGContextRestoreGState</span>(context)<span class="comment">// 恢复暂存点之前的上下文</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">80</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-5-画板实例"><a href="#3-10-5-画板实例" class="headerlink" title="3.10.5    画板实例"></a>3.10.5    画板实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_panel.gif" alt="Alt text"><br><em>DrawBoardView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawBoardView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">CGPathCreateMutable</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathMoveToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">        </span><br><span class="line">        setNeedsDisplay()<span class="comment">// 重绘当前view（触发drawRect）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="type">CGContextAddPath</span>(context, path)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_2  UI部分/" itemprop="url">
                  2 UI部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:56:56+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_2  UI部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_2  UI部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>iOS</code>实战项目</p>
</blockquote>
<h2 id="2-1-汤姆猫小游戏（投诉下线）"><a href="#2-1-汤姆猫小游戏（投诉下线）" class="headerlink" title="2.1    汤姆猫小游戏（投诉下线）"></a>2.1    汤姆猫小游戏（投诉下线）</h2><h2 id="2-2-加法计算器"><a href="#2-2-加法计算器" class="headerlink" title="2.2    加法计算器"></a>2.2    加法计算器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>storyboard</code> 中利用 <code>UITextField</code>、<code>UILabel</code>、<code>UIButton</code> 快速搭建器计算器UI界面，并在 <code>viewController</code> 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。</p>
<ul>
<li>设置<code>Text Field</code>使用数字键盘</li>
<li>点击“计算”后，使<code>Text Field</code>失去焦点</li>
<li>处理<code>Text Field</code>没有输入的情况</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text1: <span class="type">UITextField</span>!<span class="comment">// 操作数1控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text2: <span class="type">UITextField</span>!<span class="comment">// 操作数2控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> result: <span class="type">UILabel</span>!<span class="comment">// 结果控件</span></span><br><span class="line">    <span class="comment">// 计算</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> num1 = <span class="type">Int</span>(<span class="keyword">self</span>.text1.text!) ?? <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> num2 = <span class="type">Int</span>(<span class="keyword">self</span>.text2.text!) ?? <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> resultNum = num1 + num2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> resultString = <span class="string">"\(resultNum)"</span><span class="comment">//String(resultNum)</span></span><br><span class="line">        <span class="keyword">self</span>.result.text = resultString</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使输入框失去焦点</span></span><br><span class="line">        <span class="keyword">self</span>.text1.endEditing(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">self</span>.text2.endEditing(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清零</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.result.text = <span class="string">"0"</span></span><br><span class="line">        <span class="keyword">self</span>.text1.text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.text2.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-制作图片浏览器"><a href="#2-3-制作图片浏览器" class="headerlink" title="2.3    制作图片浏览器"></a>2.3    制作图片浏览器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>UILable</code>、<code>UIButton</code>、<code>UIImageView</code> 搭建一个图片浏览器的结构，并通过字典数组完成它的业务逻辑，实现浏览趣味图片的功能。</p>
<ul>
<li>切换按钮的不同<code>State Config</code>要分别进行设置</li>
<li>通过设置按钮控件的<code>enabled</code>属性设置按钮是否可点击</li>
<li>图片资源通过<code>plist</code>存储</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%888.59.20.png" alt="Alt text"><br><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *leftBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *rightBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> index;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSArray</span> *imageDicts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)leftBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index--;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)rightBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取存储图片的数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 存储图片的数组（字典数组）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)imageDicts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_imageDicts.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"imageData"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        _imageDicts = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"still"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _imageDicts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  切换图片</span><br><span class="line"> *</span><br><span class="line"> *  @param isAdd 是否向后(右)翻</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) btnClickChange: (<span class="built_in">BOOL</span>) isAdd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), <span class="keyword">self</span>.imageDicts.count]);</span><br><span class="line">    <span class="keyword">self</span>.topLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%lu"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), (<span class="keyword">unsigned</span> <span class="keyword">long</span>)<span class="keyword">self</span>.imageDicts.count];</span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = <span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"description"</span>];</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"name"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.leftBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">0</span>);<span class="comment">// 左边按钮的状态</span></span><br><span class="line">    <span class="keyword">self</span>.rightBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">4</span>);<span class="comment">// 右边按钮的状态</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-LOL英雄展示"><a href="#2-4-LOL英雄展示" class="headerlink" title="2.4    LOL英雄展示"></a>2.4    LOL英雄展示</h2><blockquote>
<p><strong>说明：</strong>通过<code>UITableView</code>和<code>plist</code>数据文件，搭建一个LOL英雄展示界面。</p>
<ul>
<li><code>UITableView</code>需要通过右键菜单设置<code>dataSource</code>和<code>delegate</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%889.29.01.png" alt="Alt text"></li>
<li><code>ViewController</code>要采纳相应的协议（<code>UITableViewDataSource</code>,<code>UITableViewDelegate</code>）：通过采纳相应的协议实现对<code>TableView</code>的中的<code>cell</code>的创建工作</li>
<li>通过使用<code>JKHero</code>类封装<code>plist</code>数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%8810.43.32.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="2-4-1-数据模版"><a href="#2-4-1-数据模版" class="headerlink" title="2.4.1    数据模版"></a>2.4.1    数据模版</h3><p><em>JKHero.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKHero</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 成员属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKHero.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKHero</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="comment">//        self.icon = [dict[@"icon"] copy];</span></span><br><span class="line"><span class="comment">//        self.name = [dict[@"name"] copy];</span></span><br><span class="line"><span class="comment">//        self.intro = [dict[@"intro"] copy];</span></span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];<span class="comment">// 利用 kvc</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-采纳协议"><a href="#2-4-2-采纳协议" class="headerlink" title="2.4.2    采纳协议"></a>2.4.2    采纳协议</h3><blockquote>
<p><strong>说明：</strong>通过扩展采纳协议。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *heros;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取英雄列表数据(懒加载)</span><br><span class="line"> *</span><br><span class="line"> *  @return JKHero类型的可变数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *) heros</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_heros) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"heros"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKHero *hero = [JKHero heroWithDict:dict];</span><br><span class="line">            [arrayM addObject:hero];</span><br><span class="line">        &#125;</span><br><span class="line">        _heros = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _heros;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - UITableViewDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少行</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.heros.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组默认有多少行(可以不实现，默认就是1)</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView sectionForSectionIndexTitle:(<span class="built_in">NSString</span> *)title atIndex:(<span class="built_in">NSInteger</span>)index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cell的高度</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建tableView中的所有cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"heroCell"</span>;</span><br><span class="line">    <span class="comment">// 创建cell</span></span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置cell的样式风格</span></span><br><span class="line">    cell.accessoryType = <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>;</span><br><span class="line">    <span class="comment">// 设置cell内容</span></span><br><span class="line">    JKHero *hero = <span class="keyword">self</span>.heros[indexPath.row];</span><br><span class="line">    cell.textLabel.text = hero.name;</span><br><span class="line">    cell.detailTextLabel.text = hero.intro;</span><br><span class="line">    cell.detailTextLabel.textColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:hero.icon];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏状态栏</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersStatusBarHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-5-Face-人脸识别技术入门"><a href="#2-5-Face-人脸识别技术入门" class="headerlink" title="2.5    Face++人脸识别技术入门"></a>2.5    Face++人脸识别技术入门</h2><blockquote>
<p><strong>注意：</strong>课程中的演示程项目是<code>Android</code>项目！</p>
</blockquote>
<h3 id="2-5-1-本课概要"><a href="#2-5-1-本课概要" class="headerlink" title="2.5.1    本课概要"></a>2.5.1    本课概要</h3><h4 id="2-5-1-1-Face-公司简介"><a href="#2-5-1-1-Face-公司简介" class="headerlink" title="2.5.1.1    Face++公司简介"></a>2.5.1.1    Face++公司简介</h4><blockquote>
<p><strong>网址：</strong><a href="http://www.faceplusplus.com.cn/" target="_blank" rel="external">http://www.faceplusplus.com.cn/</a></p>
</blockquote>
<ul>
<li>北京旷视科技有限公司（Face++）创立于2011年，是一家专注于机器视觉和深度学习的科技创业公司。</li>
<li>北京旷视科技旗下的Face++人脸识别云平台，是世界最大的人脸识别技术云平台。服务超过2万的开发者，日调用超过2百万次，积累人脸数据超过10亿张。</li>
<li>北京旷世科技先后获得联想创投的天使投资，和创新工场李开复博士的A轮投资。并获得2012年黑马创业大赛全国总冠军。</li>
</ul>
<h4 id="2-5-1-2-Face-核心技术简介"><a href="#2-5-1-2-Face-核心技术简介" class="headerlink" title="2.5.1.2 Face++核心技术简介"></a>2.5.1.2 Face++核心技术简介</h4><ul>
<li>旷视科技旗下Face++平台是世界最大的人脸识别技术云平台，提供包括人脸检测、人脸分析、人脸识别、人脸搜索等全套核心技术。</li>
<li>Face++的人脸技术居世界领先地位。其中，人脸检测技术获<code>FDDB</code>评测世界第一，人脸关键点技术获300-W评测世界第一，人脸识别技术获LFW评测世界第一。</li>
<li>Face++已搭建起世界领先的大数据深度学习（deep learning）技术引擎，可以提供人脸技术以外先进的视觉技术。其深度学习引擎可以和<code>Google</code>、<code>Facebook</code>形成强有力竞争。</li>
<li>旷视科技拥有自己独立的知识产权，有多项国内国外专利在申。</li>
</ul>
<h5 id="人脸检测和追踪"><a href="#人脸检测和追踪" class="headerlink" title="人脸检测和追踪"></a>人脸检测和追踪</h5><ul>
<li>Face++人脸检测技术在世界权威<code>FDDB</code>测试集上排名世界第一</li>
<li>Face++人脸检测技术针对移动和嵌入式设备做过多项性能优化，检测率高、内存消耗小、模型小，最小可稳定检测16x16大小的人脸<h5 id="Face-人脸关键点定位"><a href="#Face-人脸关键点定位" class="headerlink" title="Face++人脸关键点定位"></a>Face++人脸关键点定位</h5></li>
<li>Face++人脸关键点定位技术在世界权威300-W测试集上排名世界第一</li>
<li>Face++人脸关键点定位提供5点，23点，83点等多个版本，对移动和嵌入式设备做过多项性能优化<h5 id="Face-人脸属性分析"><a href="#Face-人脸属性分析" class="headerlink" title="Face++人脸属性分析"></a>Face++人脸属性分析</h5></li>
<li>Face++ 人脸属性分析可以分析出性别、年龄、种族、情绪，是否佩戴眼镜</li>
<li>Face++性别、种族、情绪、眼镜分析精确度均在95%以上，年龄准确度平均误差在5岁范围内<h5 id="Face-人脸1-1识别技术"><a href="#Face-人脸1-1识别技术" class="headerlink" title="Face++人脸1:1识别技术"></a>Face++人脸1:1识别技术</h5></li>
<li>Face++人脸1:1验证技术已被广泛应用于帐号登录、身份验证等服务中，被联想、神州智联等大客户使用。在千分之一的误检率情况下，通过率超过70%<h5 id="Face-人脸1-N识别技术"><a href="#Face-人脸1-N识别技术" class="headerlink" title="Face++人脸1:N识别技术"></a>Face++人脸1:N识别技术</h5></li>
<li>Face++人脸识别技术在世界最著名<code>LFW</code>评测中排名世界第一，取到97.72%的准确度，力压<code>Facebook</code><h5 id="Face-人脸大规模搜索"><a href="#Face-人脸大规模搜索" class="headerlink" title="Face++人脸大规模搜索"></a>Face++人脸大规模搜索</h5></li>
<li>Face++人脸大规模搜索技术被奇虎360、世纪佳缘等大客户使用，可以用不超过4字节表示一张人脸，千万级别图片搜索可达0.1ms响应速度</li>
</ul>
<h4 id="2-5-1-3-Face-技术使用场景介绍"><a href="#2-5-1-3-Face-技术使用场景介绍" class="headerlink" title="2.5.1.3    Face++技术使用场景介绍"></a>2.5.1.3    Face++技术使用场景介绍</h4><ul>
<li>相机和相册类应用</li>
<li>电子商务和广告营销类</li>
<li>游戏类应用</li>
<li>人脸搜索</li>
</ul>
<h5 id="相机和广告"><a href="#相机和广告" class="headerlink" title="相机和广告"></a>相机和广告</h5><ul>
<li>Face++ 已经为美图秀秀、相机360等移动应用广告厂商提供了人脸检测、人脸追踪以及人脸关键点定位技术，通过这些技术移动应用可以在相机和相册中快速得定为人脸的位置以及五官的位置，为下一步的美化做提前准备。</li>
<li>通过Face++所能提供的人脸属性分析，包括年龄、性别、种族以及微笑程度的判断，可以更好地评估电子商务、广告营销类的用户群体和这些群体所带有的属性。</li>
</ul>
<h5 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h5><ul>
<li>现有的移动设备大多都带有前置摄像头，那我们可以通过这些前置摄像头以及Face++ 所能提供的人脸检测和追踪技术，快速定位人脸以及人脸位置的变化。通过具体实际人脸的位置变化来操控游戏中的人物的位置变化。</li>
</ul>
<h5 id="人脸搜索和人脸登录"><a href="#人脸搜索和人脸登录" class="headerlink" title="人脸搜索和人脸登录"></a>人脸搜索和人脸登录</h5><ul>
<li>Face++已经为360搜索和世纪佳缘提供了此项技术，可以在千万级的会员库中快速准确地定位到具体的某个人以及与他相似的人</li>
<li>Face++已经为联想视频通话软件－－友约和神州智联提供了此项技术，可以瞬间验证使用者的身份是否属实。</li>
</ul>
<h3 id="2-5-2-Face-介绍"><a href="#2-5-2-Face-介绍" class="headerlink" title="2.5.2    Face++介绍"></a>2.5.2    Face++介绍</h3><h3 id="2-5-3-线上API分析"><a href="#2-5-3-线上API分析" class="headerlink" title="2.5.3    线上API分析"></a>2.5.3    线上API分析</h3><blockquote>
<p><strong>说明：</strong><a href="http://www.faceplusplus.com.cn/api-overview/" target="_blank" rel="external">http://www.faceplusplus.com.cn/api-overview/</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>用途</th>
<th>依赖的数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>face</td>
<td>基本属性</td>
<td></td>
<td></td>
</tr>
<tr>
<td>faceset</td>
<td>face集合</td>
<td>搜索集合中的face</td>
<td><code>faceid</code>、<code>faceset_name</code>、<code>face</code>、<code>set_id</code></td>
</tr>
<tr>
<td>person</td>
<td>人</td>
<td>验证</td>
<td><code>faceid</code>、 <code>person_name(person_id)</code></td>
</tr>
<tr>
<td>group</td>
<td>人群</td>
<td>匹配</td>
<td><code>identity</code>、 <code>url(ing)</code>、 <code>group_name(group_id)</code></td>
</tr>
</tbody>
</table>
<h3 id="2-5-4-离线API的下载和配置"><a href="#2-5-4-离线API的下载和配置" class="headerlink" title="2.5.4    离线API的下载和配置"></a>2.5.4    离线API的下载和配置</h3><blockquote>
<p><strong>说明：</strong>离线API主要用于在客户端提取图片的信息，从而与线上服务器配合完成一些处理。<br><strong>注意：</strong>在<code>Face++</code>官网创建自己的应用后才能下载到相应的离线<code>SDK</code></p>
<blockquote>
<p><strong>我的学习应用：</strong><a href="http://www.faceplusplus.com.cn/uc/app/home?app_id=42841" target="_blank" rel="external">http://www.faceplusplus.com.cn/uc/app/home?app_id=42841</a></p>
</blockquote>
</blockquote>
<h3 id="2-5-5-Face-实例编写"><a href="#2-5-5-Face-实例编写" class="headerlink" title="2.5.5    Face++实例编写"></a>2.5.5    Face++实例编写</h3><h3 id="2-5-6-Face-人脸识别总结语"><a href="#2-5-6-Face-人脸识别总结语" class="headerlink" title="2.5.6    Face++人脸识别总结语"></a>2.5.6    Face++人脸识别总结语</h3><h2 id="2-6-应用管理"><a href="#2-6-应用管理" class="headerlink" title="2.6    应用管理"></a>2.6    应用管理</h2><h3 id="2-6-1-项目讲解和模型搭建"><a href="#2-6-1-项目讲解和模型搭建" class="headerlink" title="2.6.1    项目讲解和模型搭建"></a>2.6.1    项目讲解和模型搭建</h3><ol>
<li>创建项目</li>
<li>设置<code>Storyboard</code>(设置<code>Size</code>为<code>iPhone 3.5-inch</code>，取消<code>Use Auto Layout</code>和<code>Use Size Classes</code>)</li>
<li>导入素材（图片和<code>plist</code>文件）</li>
<li>为<code>plist</code>文件创建<code>数据模型</code><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><em>JKAppInfo.h</em></li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKAppInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;<span class="comment">// 通过定义为私有属性使其可在 image 方法中被访问</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 image 的set(因为 通过 @property 创建的 image 是只读的，因此不会自动生成 get)</span></span><br><span class="line"><span class="comment">// 注意：将访问 image 自定义为访问 _image</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-Xib自定义视图"><a href="#2-6-2-Xib自定义视图" class="headerlink" title="2.6.2    Xib自定义视图"></a>2.6.2    Xib自定义视图</h3><ol>
<li>创建<code>JKAppView</code>（继承<code>UIView</code>）</li>
<li>创建<code>xib</code>文件（<code>iOS</code>-&gt;<code>User Interface</code>-&gt;<code>Empty</code>）</li>
</ol>
<ul>
<li><code>Size</code>：Freeform(然后宽和高就可以设置了)</li>
</ul>
<ol>
<li>在<code>xib</code>中创建需要的展现单个<code>app</code>信息的控件</li>
<li>在<code>xib</code>文件和<code>JKAppView</code>类之间创建关联</li>
<li>完善<code>JKAppView</code>类</li>
</ol>
<h4 id="2-6-2-1-xib视图文件"><a href="#2-6-2-1-xib视图文件" class="headerlink" title="2.6.2.1    xib视图文件"></a>2.6.2.1    xib视图文件</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-02%20%E4%B8%8A%E5%8D%8812.11.15.png" alt="Alt text"></p>
<h4 id="2-6-2-2-绑定的类-UIView"><a href="#2-6-2-2-绑定的类-UIView" class="headerlink" title="2.6.2.2    绑定的类(UIView)"></a>2.6.2.2    绑定的类(<code>UIView</code>)</h4><p><em>JKView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKAppInfo</span>;</span></span><br><span class="line"><span class="comment">//-------协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">JKAppViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">// 下载按钮被点击的响应函数</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性：一项app信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKAppInfo *appInfo;</span><br><span class="line"><span class="comment">// 属性：代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;JKAppViewDelegate&gt; delegate;<span class="comment">// 要求代理对象采纳JKAppViewDelegate协议</span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)appView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="comment">//------ 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *iconView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *nameLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppView</span></span></span><br><span class="line">- (<span class="keyword">IBAction</span>)downloadBtnOnClick:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 调用代理对象的”点击下载按钮“的响应函数</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(downloadClickWithBtn:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate downloadClickWithBtn:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂构造</span></span><br><span class="line">+ (instancetype)appView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从指定nib文件中获取目标View控件（是唯一的，所以可以用lastObject）</span></span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle]loadNibNamed:<span class="string">@"JKAppView"</span> owner:<span class="literal">nil</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为View控件初始化内部信息</span></span><br><span class="line">- (<span class="keyword">void</span>)setAppInfo:(JKAppInfo *)appInfo</span><br><span class="line">&#123;</span><br><span class="line">    _appInfo = appInfo;</span><br><span class="line">    <span class="keyword">self</span>.iconView.image = appInfo.image;</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.text = appInfo.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-3-创建自定义视图数组"><a href="#2-6-3-创建自定义视图数组" class="headerlink" title="2.6.3    创建自定义视图数组"></a>2.6.3    创建自定义视图数组</h3><blockquote>
<p><strong>说明：</strong>在<code>ViewController</code>中初始化<code>JKAppView</code>数组</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据plist初始化所有的小view（懒加载）</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)appViews</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_appViews) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"app"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKAppInfo *appInfo = [JKAppInfo appInfoWithDict:dict];</span><br><span class="line">            JKAppView *appView = [JKAppView appView];</span><br><span class="line">            appView.appInfo = appInfo;</span><br><span class="line">            appView.delegate = <span class="keyword">self</span>;</span><br><span class="line">            </span><br><span class="line">            [arrayM addObject:appView];</span><br><span class="line">        &#125;</span><br><span class="line">        _appViews = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _appViews;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-4-九宫格布局展示"><a href="#2-6-4-九宫格布局展示" class="headerlink" title="2.6.4    九宫格布局展示"></a>2.6.4    九宫格布局展示</h3><blockquote>
<p><strong>说明：</strong>九宫格布局开发</p>
<ol>
<li>宏定义界面布局的相关参数</li>
<li>确定间距</li>
<li>为确定每个下载项的位置（通过设置中心点坐标）</li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenH [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="comment">// 每个下载项的高度</span></span><br><span class="line"><span class="meta">#define kAppViewH [JKAppView appView].bounds.size.height</span></span><br><span class="line"><span class="comment">// 每个下载项的宽度</span></span><br><span class="line"><span class="meta">#define kAppViewW [JKAppView appView].bounds.size.width</span></span><br><span class="line"><span class="comment">// 分3列</span></span><br><span class="line"><span class="meta">#define kTotaoCol 3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 间距</span></span><br><span class="line">    <span class="built_in">CGFloat</span> margin = (kScreenW - kTotaoCol * kAppViewW) / (kTotaoCol + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 确定每个自定义视图在父视图中的位置并添加到父视图中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.appViews.count; i++) &#123;</span><br><span class="line">        JKAppView *appView = <span class="keyword">self</span>.appViews[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> col = i % kTotaoCol;</span><br><span class="line">        <span class="keyword">int</span> row = i / kTotaoCol;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGFloat</span> centerX = (margin + kAppViewW * <span class="number">0.5</span>) + (margin + kAppViewW) * col;</span><br><span class="line">        <span class="built_in">CGFloat</span> centerY = (margin + kAppViewH * <span class="number">0.5</span>) + (margin + kAppViewH) * row;</span><br><span class="line">        <span class="comment">// 设置中心点</span></span><br><span class="line">        appView.center = <span class="built_in">CGPointMake</span>(centerX, centerY);</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:appView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-5-点击效果分析与bug排除"><a href="#2-6-5-点击效果分析与bug排除" class="headerlink" title="2.6.5    点击效果分析与bug排除"></a>2.6.5    点击效果分析与bug排除</h3><blockquote>
<p><strong>说明：</strong>点击<code>下载</code>时弹出等待画面</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 获取要下载的应用的名字</span></span><br><span class="line">    JKAppView *appView = (JKAppView *)btn.superview;</span><br><span class="line">    <span class="built_in">NSString</span> *appName = appView.appInfo.name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建加载提示窗</span></span><br><span class="line">    <span class="built_in">UIActivityIndicatorView</span> *juhua = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleGray</span>];<span class="comment">// 样式</span></span><br><span class="line">    juhua.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 尺寸</span></span><br><span class="line">    [juhua startAnimating];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:juhua];<span class="comment">// 将提示窗添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 创建下载中文案</span></span><br><span class="line">    <span class="built_in">UILabel</span> *downloadLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">    downloadLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">10</span>, kScreenW, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    downloadLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    downloadLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    downloadLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@正在下载..."</span>, appName];</span><br><span class="line">    downloadLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">15.0</span>];</span><br><span class="line">    </span><br><span class="line">    downloadLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    downloadLabel.alpha = <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    [juhua addSubview:downloadLabel];<span class="comment">// 将文案添加到加载窗上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-延时操作与块动画"><a href="#2-6-6-延时操作与块动画" class="headerlink" title="2.6.6    延时操作与块动画"></a>2.6.6    延时操作与块动画</h3><blockquote>
<p><strong>说明：</strong>过一段时间以多线程的方式延时处理。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 4. 设置两秒钟后完成下载</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 加载窗停止转动，并且自动隐藏</span></span><br><span class="line">        [juhua stopAnimating];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 下载完成的提示</span></span><br><span class="line">        <span class="built_in">UILabel</span> *noteLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        noteLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">20</span>, kScreenW, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        noteLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        noteLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        noteLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@下载完成"</span>, appName];</span><br><span class="line">        </span><br><span class="line">        noteLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:noteLabel];</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 执行动画</span></span><br><span class="line">            noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            <span class="comment">// 动画完成后需要做的事情</span></span><br><span class="line">            btn.enabled = <span class="literal">NO</span>;</span><br><span class="line">            [btn setTitle:<span class="string">@"已下载"</span> forState: <span class="built_in">UIControlStateDisabled</span>];</span><br><span class="line">            [noteLabel removeFromSuperview];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-超级猜图"><a href="#2-7-超级猜图" class="headerlink" title="2.7    超级猜图"></a>2.7    超级猜图</h2><h3 id="2-7-1-效果展示与业务逻辑分析"><a href="#2-7-1-效果展示与业务逻辑分析" class="headerlink" title="2.7.1    效果展示与业务逻辑分析"></a>2.7.1    效果展示与业务逻辑分析</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-04%2012.15.01.png" alt="Alt text"></p>
<h3 id="2-7-2-模型搭建"><a href="#2-7-2-模型搭建" class="headerlink" title="2.7.2    模型搭建"></a>2.7.2    模型搭建</h3><blockquote>
<p><strong>说明：</strong>创建对应<code>plist</code>文件的数据模型。</p>
<ol>
<li>视图控制器基本设置</li>
<li>导入相关素材（图片和<code>plist</code>）</li>
<li>创建对应<code>plist</code>文件的数据模型</li>
</ol>
</blockquote>
<p><em>JKQuestionInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKQuestionInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">// 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *answer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *options;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)doct;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKQuestionInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKQuestionInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为_image手动定义 get</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"questions"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">        [arrayM addObject:[<span class="keyword">self</span> questionWithDict:dict]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 保证每次调用该方法获取的都是全新的数组</span></span><br><span class="line">    <span class="keyword">return</span> [arrayM <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-3-Storyboard-布局-UI"><a href="#2-7-3-Storyboard-布局-UI" class="headerlink" title="2.7.3    Storyboard 布局 UI"></a>2.7.3    Storyboard 布局 UI</h3><blockquote>
<p><strong>技巧：</strong></p>
<ul>
<li>可以在<code>Storyboard</code>中为控件设置内边距</li>
<li>有时候用<code>Button</code>替代<code>ImageView</code>会更方便</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-05%20%E4%B8%8B%E5%8D%883.20.24.png" alt="Alt text"></p>
<h3 id="2-7-4-拖线与注释"><a href="#2-7-4-拖线与注释" class="headerlink" title="2.7.4    拖线与注释"></a>2.7.4    拖线与注释</h3><blockquote>
<p><strong>技巧：</strong>多个控件可以绑定同一个<code>action</code>。方式是<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_more.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">// 顶部索引情况 label</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topindexLabel;</span><br><span class="line"><span class="comment">// 图片描述</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 金币</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *coinBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *imgInsideBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *answerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备选的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *optionsView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录索引</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：帮助</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)helpBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：大图</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-5-创建模型数组与遮罩"><a href="#2-7-5-创建模型数组与遮罩" class="headerlink" title="2.7.5    创建模型数组与遮罩"></a>2.7.5    创建模型数组与遮罩</h3><blockquote>
<p><strong>说明：</strong>遮罩用来监听点<code>击屏幕任何地方</code>的事件。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取数据模型数组（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @return 模型数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _questions) &#123;</span><br><span class="line">        _questions = [JKQuestionInfo questions];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _questions;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取遮罩（懒加载），用来监听用户的点击行为</span><br><span class="line"> *</span><br><span class="line"> *  @return 遮罩</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">UIButton</span> *)cover</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _cover) &#123;</span><br><span class="line">        _cover = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 和最外层视图一样大</span></span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;</span><br><span class="line">        _cover.alpha = <span class="number">0.0</span>;<span class="comment">// 一开始隐藏遮罩：当透明度为0时，该遮罩不会存在于任何位置</span></span><br><span class="line">        _cover.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        <span class="comment">// 为遮罩注册点击事件</span></span><br><span class="line">        [_cover addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(imgBtnChangeOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:_cover];<span class="comment">// 把遮罩添加到视图中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-6-实现图片缩放"><a href="#2-7-6-实现图片缩放" class="headerlink" title="2.7.6    实现图片缩放"></a>2.7.6    实现图片缩放</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 1. 按钮：大图(拖线) 2. 遮罩（代码调用） 3. 图片本身（拖线）</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">    <span class="comment">// 放大图片</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="keyword">self</span>.cover.alpha) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> scaleX = kScreenW / imgW;<span class="comment">// 水平方向放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> scaleY = scaleX;<span class="comment">// 垂直方向上放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> translateY = <span class="keyword">self</span>.imgInsideBtn.frame.origin.y / scaleX;<span class="comment">// 垂直方向上的偏移（倍数）</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用块动画</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 显示遮罩</span></span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scaleX, scaleY);<span class="comment">// 放大</span></span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformTranslate</span>(<span class="keyword">self</span>.imgInsideBtn.transform, <span class="number">0</span>, translateY);<span class="comment">// 在现有的基础上向上移动</span></span><br><span class="line">        &#125;];</span><br><span class="line">        <span class="comment">// 将中间图片所在图层置顶</span></span><br><span class="line">        [<span class="keyword">self</span>.view bringSubviewToFront:<span class="keyword">self</span>.imgInsideBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 还原图片</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 图片还原事件</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.0</span>;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-7-下一题方法实现"><a href="#2-7-7-下一题方法实现" class="headerlink" title="2.7.7    下一题方法实现"></a>2.7.7    下一题方法实现</h3><blockquote>
<p><strong>说明：</strong>用户点击下一题按钮时界面做出相应的改变</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 索引自增（判断是否越界）</span></span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"INDEX == %D"</span>, <span class="keyword">self</span>.index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.index &gt;= <span class="keyword">self</span>.questions.count) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"恭喜过关！"</span>);</span><br><span class="line">        <span class="meta">#warning noCode</span></span><br><span class="line">        <span class="keyword">self</span>.index--;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出数据模型</span></span><br><span class="line">    JKQuestionInfo *question = <span class="keyword">self</span>.questions[<span class="keyword">self</span>.index];</span><br><span class="line">    <span class="comment">// 3. 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setupBaseInfo:question];</span><br><span class="line">    <span class="comment">// 4. 创建答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createAnswerBtns:question];</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - 私有方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置基本信息</span><br><span class="line"> *</span><br><span class="line"> *  @param question 问题的数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupBaseInfo: (JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 恢复（enable）optionView 的用户交互</span></span><br><span class="line">    <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// 改变顶部图片索引信息</span></span><br><span class="line">    <span class="keyword">self</span>.topindexLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, <span class="keyword">self</span>.index + <span class="number">1</span>, <span class="keyword">self</span>.questions.count];</span><br><span class="line">    <span class="comment">// 改变图片描述</span></span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = question.title;</span><br><span class="line">    <span class="comment">// 更换图片</span></span><br><span class="line">    [<span class="keyword">self</span>.imgInsideBtn setImage:question.image forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下一题按钮状态判断改变</span></span><br><span class="line">    <span class="keyword">self</span>.nextBtn.enabled = (<span class="keyword">self</span>.index != <span class="keyword">self</span>.questions.count - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-8-创建答案按钮"><a href="#2-7-8-创建答案按钮" class="headerlink" title="2.7.8    创建答案按钮"></a>2.7.8    创建答案按钮</h3><blockquote>
<p><strong>说明：</strong>设置基本信息时创建放置答案的一排按钮集合。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要计算的常量</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"><span class="meta">#define kAnswerBtnTitleColor [UIColor blackColor]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要计算的常量</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnW = <span class="number">35</span>;<span class="comment">// 按钮宽</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnH = <span class="number">35</span>;<span class="comment">// 按钮高</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kMarginBetweenBtns = <span class="number">10</span>;<span class="comment">// 按钮间距</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kOptionViewTotalCol = <span class="number">7</span>;<span class="comment">// 备选答案总列数</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTrueAddScore = <span class="number">200</span>;<span class="comment">// 猜对加分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kFalseDecreaseScore = <span class="number">-200</span>;<span class="comment">// 猜错减分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTipDecreaseScore = <span class="number">-200</span>;<span class="comment">// 亲求提示减分</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建放置答案的按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createAnswerBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 清空放置答案的按钮</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [btn removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 获取答案按钮的数量</span></span><br><span class="line">    <span class="built_in">NSInteger</span> answerBtnCount = question.answer.length;</span><br><span class="line">    <span class="comment">// 3. 创建放置答案的按钮</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerW = <span class="keyword">self</span>.answerView.bounds.size.width;<span class="comment">// 放答案的父容器宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerEdgeInset = (answerW - answerBtnCount * kBtnW - (answerBtnCount - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 放答案的父容器两侧内边距</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; answerBtnCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        <span class="built_in">CGFloat</span> btnX = answerEdgeInset + i * i * (kBtnW + kMarginBetweenBtns);<span class="comment">// 起点水平坐标</span></span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnX, <span class="number">0</span>, kBtnW, kBtnH);<span class="comment">// 设置frame</span></span><br><span class="line">        <span class="comment">// 设置背景图片</span></span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        <span class="comment">// 设置字体颜色</span></span><br><span class="line">        [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册点击事件</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick:) forControlEvents:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 添加到视图中</span></span><br><span class="line">        [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-9-创建备选答案按钮"><a href="#2-7-9-创建备选答案按钮" class="headerlink" title="2.7.9    创建备选答案按钮"></a>2.7.9    创建备选答案按钮</h3><blockquote>
<p><strong>说明：</strong>当<code>点击下一题</code>或<code>程序刚启动</code>时，需要设置备选答案按钮。<br><strong>技巧：</strong>以懒加载的方式创建备选按钮，这样就不用每次都重新创建备选按钮。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">self</span>.index = <span class="number">-1</span>;</span><br><span class="line">    [<span class="keyword">self</span> nextBtnOnClick];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置备选字按钮（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createOptionBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 备选字总个数</span></span><br><span class="line">    <span class="keyword">int</span> optionsCount = question.options.count;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 没有备选字按钮就创建</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.optionsView.subviews.count != optionsCount) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> optionW = <span class="keyword">self</span>.optionsView.bounds.size.width;<span class="comment">// 备选字按钮父控件宽度</span></span><br><span class="line">        <span class="built_in">CGFloat</span> optionEdgeInset = (optionW - kOptionViewTotalCol * kBtnW - (kOptionViewTotalCol - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 父控件左右内边距</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">            <span class="keyword">int</span> col = i % kOptionViewTotalCol;<span class="comment">// 所在列</span></span><br><span class="line">            <span class="keyword">int</span> row = i / kOptionViewTotalCol;<span class="comment">// 所在行</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CGFloat</span> btnX = optionEdgeInset + (kBtnW + kMarginBetweenBtns) * col;<span class="comment">// 水平坐标</span></span><br><span class="line">            <span class="built_in">CGFloat</span> btnY = kMarginBetweenBtns + (kBtnH + kMarginBetweenBtns) * row;<span class="comment">// 垂直坐标</span></span><br><span class="line">            <span class="comment">// 设置frame</span></span><br><span class="line">            btn.frame = <span class="built_in">CGRectMake</span>(btnX, btnY, kBtnW, kBtnH);</span><br><span class="line">            <span class="comment">// 设置背景图</span></span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">            <span class="comment">// 设置字颜色</span></span><br><span class="line">            [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            <span class="comment">// 注册点击事件</span></span><br><span class="line">            [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">            <span class="comment">// 添加到视图</span></span><br><span class="line">            [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新备选字</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *optionBtn = <span class="keyword">self</span>.optionsView.subviews[i];</span><br><span class="line">            [optionBtn setTitle:question.options[i] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-10-答案按钮点击"><a href="#2-7-10-答案按钮点击" class="headerlink" title="2.7.10    答案按钮点击"></a>2.7.10    答案按钮点击</h3><blockquote>
<p><strong>说明：</strong> 点击组成答案的按钮，该按钮清除其文字，而相应的备选答案按钮会重新出现该文字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-11-备选按钮点击"><a href="#2-7-11-备选按钮点击" class="headerlink" title="2.7.11    备选按钮点击"></a>2.7.11    备选按钮点击</h3><blockquote>
<p><strong>说明：</strong>被点击的备选按钮会清除其文字，并将该文字写到答案按钮中。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-12-提示点击方法的实现"><a href="#2-7-12-提示点击方法的实现" class="headerlink" title="2.7.12    提示点击方法的实现"></a>2.7.12    提示点击方法的实现</h3><blockquote>
<p><strong>说明：</strong>提示按钮每被点击一次，答案按钮就回为答案生成一个字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 清空答案按钮的文字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [<span class="keyword">self</span> answerBtnOnClick:answerBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出实际答案中的第一个字</span></span><br><span class="line">    <span class="built_in">NSString</span> *answer = [<span class="keyword">self</span>.questions[<span class="keyword">self</span>.index] answer];</span><br><span class="line">    <span class="built_in">NSString</span> *firstWord = [answer substringToIndex:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 3. 模拟点击optionView中第一个正确的按钮，扣分</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([optionBtn.currentTitle isEqualToString:firstWord]) &#123;</span><br><span class="line">            [<span class="keyword">self</span> optionBtnOnClick:optionBtn];</span><br><span class="line">            [<span class="keyword">self</span> coinChange:kTipDecreaseScore];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-国家选择"><a href="#2-8-国家选择" class="headerlink" title="2.8    国家选择"></a>2.8    国家选择</h2><h3 id="2-8-1-UIPickerView与数据模型的创建"><a href="#2-8-1-UIPickerView与数据模型的创建" class="headerlink" title="2.8.1    UIPickerView与数据模型的创建"></a>2.8.1    <code>UIPickerView</code>与<code>数据模型</code>的创建</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>导入素材（<code>jpg</code>格式的图片不能放在<code>Assets.xcassets</code>中管理）</li>
<li>创建自定义<code>UIView</code>类:<code>JKCountryInfo</code></li>
<li><code>ViewController</code>采纳<code>UIPickerView</code></li>
</ol>
<p><strong>注意：</strong><code>gif</code>格式的图片不能放在<code>Assets.xcassets</code>。</p>
</blockquote>
<h4 id="2-8-1-1-UIPickerView"><a href="#2-8-1-1-UIPickerView" class="headerlink" title="2.8.1.1    UIPickerView"></a>2.8.1.1    <code>UIPickerView</code></h4><blockquote>
<p><strong>说明：</strong>类似<code>TableView</code>，可以通过让普通<code>ViewControll</code>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code>实现</p>
<ol>
<li>通过拖动建立<code>PickerView</code>控件和<code>ViewController</code>类之间的关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.29.09.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-1-2-数据模型的创建"><a href="#2-8-1-2-数据模型的创建" class="headerlink" title="2.8.1.2     数据模型的创建"></a>2.8.1.2     数据模型的创建</h4><p><em>JKContryInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;<span class="comment">// 国家名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *icon;<span class="comment">// 国旗（图片名）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 工厂方法</span></span><br><span class="line">+ (instancetype) CountryWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContryInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryInfo</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)CountryWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-2-自定义视图完善实例"><a href="#2-8-2-自定义视图完善实例" class="headerlink" title="2.8.2    自定义视图完善实例"></a>2.8.2    自定义视图完善实例</h3><blockquote>
<p><strong>说明：</strong>自定义<code>PickerView</code>中的每一行采用的视图。</p>
</blockquote>
<h4 id="2-8-2-1-创建xib文件"><a href="#2-8-2-1-创建xib文件" class="headerlink" title="2.8.2.1    创建xib文件"></a>2.8.2.1    创建<code>xib</code>文件</h4><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>创建的<code>xib</code>文件和要绑定的<code>UIVIew</code>的文件名要一致。</li>
</ol>
<p><strong>注意：</strong>待对应的<code>UIView</code>子类创建完毕后，手动绑定之。</p>
</blockquote>
<p><em>JKCountryFlagView.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.24.35.png" alt="Alt text"></p>
<h4 id="2-8-2-2-创建JKCountryFlagView类"><a href="#2-8-2-2-创建JKCountryFlagView类" class="headerlink" title="2.8.2.2    创建JKCountryFlagView类"></a>2.8.2.2    创建<code>JKCountryFlagView</code>类</h4><blockquote>
<p><strong>说明：</strong>该类用来绑定上面创建的<code>xib</code>文件。</p>
</blockquote>
<p><em>JKCountryFlagView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKCountryInfo</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryFlagView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IBOutlet 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKCountryInfo *countryModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器(工厂方法)</span></span><br><span class="line">+ (instancetype)countryView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKCountryFlagView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryFlagView</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)countryView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="string">@"JKCountryFlagView"</span> owner:<span class="keyword">self</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setCountryModel:(JKCountryInfo *)countryModel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_countryModel != countryModel) &#123;</span><br><span class="line">        _countryModel = countryModel;</span><br><span class="line">        <span class="keyword">self</span>.name.text = _countryModel.name;</span><br><span class="line">        <span class="keyword">self</span>.flag.image = [<span class="built_in">UIImage</span> imageNamed:_countryModel.icon];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">54</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-2-3-完善ViewController"><a href="#2-8-2-3-完善ViewController" class="headerlink" title="2.8.2.3    完善ViewController"></a>2.8.2.3    完善<code>ViewController</code></h4><blockquote>
<p><strong>说明：</strong>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"path:%@"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"array:%@"</span>, _dataArray);</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDelegate</span></span><br><span class="line"><span class="comment">// 定义详情视图的创建过程</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView viewForRow:(<span class="built_in">NSInteger</span>)row forComponent:(<span class="built_in">NSInteger</span>)component reusingView:(<span class="built_in">UIView</span> *)view</span><br><span class="line">&#123;</span><br><span class="line">    JKCountryFlagView *countryView = (JKCountryFlagView *)view;</span><br><span class="line">    <span class="keyword">if</span> (!countryView) &#123;</span><br><span class="line">        countryView = [JKCountryFlagView countryView];</span><br><span class="line">    &#125;</span><br><span class="line">    countryView.countryModel = <span class="keyword">self</span>.dataArray[row];</span><br><span class="line">    <span class="keyword">return</span> countryView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义行高</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView rowHeightForComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [JKCountryFlagView rowHeight];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-图片自动播放"><a href="#2-9-图片自动播放" class="headerlink" title="2.9    图片自动播放"></a>2.9    图片自动播放</h2><h3 id="2-9-1-创建UIScrollView和UIPageControl"><a href="#2-9-1-创建UIScrollView和UIPageControl" class="headerlink" title="2.9.1    创建UIScrollView和UIPageControl"></a>2.9.1    创建<code>UIScrollView</code>和<code>UIPageControl</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><code>ViewController</code>采纳<code>UIScrollViewDelegate</code></li>
<li>创建<code>UIScrollView</code></li>
<li>创建<code>UIScrollPageControl</code></li>
</ol>
</blockquote>
<h3 id="2-9-2-定时器与代理方法调用"><a href="#2-9-2-定时器与代理方法调用" class="headerlink" title="2.9.2    定时器与代理方法调用"></a>2.9.2    定时器与代理方法调用</h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><strong>封装一些相关的方法：</strong>清除<code>timer</code>、添加<code>timer</code>等</li>
<li><strong>遵守协议<code>UIScrollViewDelegate</code>：</strong>定义滑动前、中、后需要的操作</li>
</ol>
</blockquote>
<h3 id="2-9-3-代码摘要"><a href="#2-9-3-代码摘要" class="headerlink" title="2.9.3    代码摘要"></a>2.9.3    代码摘要</h3><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width// 屏幕高度</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> kImgCount = <span class="number">10</span>;<span class="comment">// 图片总数</span></span><br><span class="line"><span class="built_in">CGFloat</span> scrollY = <span class="number">20</span>;<span class="comment">// 上边距</span></span><br><span class="line"><span class="built_in">CGFloat</span> pageCtrlWidth = <span class="number">200</span>;<span class="comment">// 滚动指示器宽度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//--------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIPageControl</span> *pageCtrl;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initScrollView];</span><br><span class="line">    [<span class="keyword">self</span> initPageControl];</span><br><span class="line">    [<span class="keyword">self</span> addTimer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIScrollView</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initScrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">    <span class="comment">// 设置代理对象</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 初始化所有滚动的屏的内容</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kImgCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span> *imgview = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(kScreenWidth * i, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">        imgview.image = [<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"huoying%d"</span>, i + <span class="number">1</span>]];</span><br><span class="line">        [<span class="keyword">self</span>.scrollView addSubview:imgview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(kScreenWidth * kImgCount, kScreenHeight - scrollY);</span><br><span class="line">    <span class="keyword">self</span>.scrollView.pagingEnabled = <span class="literal">YES</span>;<span class="comment">// 使滚动操作停止在恰当的位置</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIPageControl</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPageControl</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl = [[<span class="built_in">UIPageControl</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>((kScreenWidth - pageCtrlWidth) / <span class="number">2</span>, kScreenHeight - scrollY, pageCtrlWidth, scrollY)];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.numberOfPages = kImgCount;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.pageIndicatorTintColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPageIndicatorTintColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span>.view insertSubview:<span class="keyword">self</span>.pageCtrl aboveSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  自动滚动到下一屏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)nextPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = <span class="keyword">self</span>.pageCtrl.currentPage;</span><br><span class="line">    page++;</span><br><span class="line">    <span class="keyword">if</span> (page == kImgCount) &#123;</span><br><span class="line">        page = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGPoint</span> point = <span class="built_in">CGPointMake</span>(kScreenWidth * page, <span class="number">0</span>);</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:point animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addTimer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 timer (interval)</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(nextPage) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  清除延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeTimer</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma  mark -UIScrollViewDelegae</span></span><br><span class="line"><span class="comment">// 滑动前：清除计时器</span></span><br><span class="line">- (<span class="keyword">void</span>) scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> removeTimer];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"BeginDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动中：更改指示器</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = scrollView.contentOffset.x / kScreenWidth + <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPage = page;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动后：开始下一次互动倒计时</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 2秒钟后重新开始自动滚屏</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> addTimer];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"EndDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-QQ列表展示"><a href="#2-10-QQ列表展示" class="headerlink" title="2.10    QQ列表展示"></a>2.10    QQ列表展示</h2><blockquote>
<p><strong>说明：</strong>该项目使用<code>MVC</code>模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_qq.gif" alt="Alt text|200x400"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-16%20%E4%B8%8A%E5%8D%889.34.22.png" alt="Alt text|400x300"></p>
<p><strong>注意：</strong><code>Xcode</code>工程中的文件夹有两种：<code>黄色</code>的为辅助进行代码管理的“伪文件夹”，<code>蓝色</code>的为真正的文件夹。</p>
</blockquote>
<h3 id="2-10-1-模型搭建"><a href="#2-10-1-模型搭建" class="headerlink" title="2.10.1    模型搭建"></a>2.10.1    模型搭建</h3><blockquote>
<p><strong>说明：</strong>需要两个数据模型，<code>JKGroupModel</code>（好友所在分组）和<code>JKFriendsModel</code>（好友）</p>
<ol>
<li>导入<code>plist</code></li>
<li>创建数据模型</li>
</ol>
</blockquote>
<h4 id="2-10-1-1-JKGroupModel"><a href="#2-10-1-1-JKGroupModel" class="headerlink" title="2.10.1.1    JKGroupModel"></a>2.10.1.1    <code>JKGroupModel</code></h4><blockquote>
<p><strong>说明：</strong>好友分组的数据模型</p>
</blockquote>
<p><em>JKGroupModel</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKGroupModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKGroupModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> <span class="keyword">self</span>.friends) &#123;</span><br><span class="line">            JKFriendsModel *model = [JKFriendsModel friendWithDict:dict];</span><br><span class="line">            [muArray addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.friends = muArray;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)GroupWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-1-2-JKFriendsModel"><a href="#2-10-1-2-JKFriendsModel" class="headerlink" title="2.10.1.2    JKFriendsModel"></a>2.10.1.2    <code>JKFriendsModel</code></h4><blockquote>
<p><strong>说明：</strong>好友的数据模型。</p>
</blockquote>
<p><em>JKFriendsModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKFriendsModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKFriendsModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-创建UITableView"><a href="#2-10-2-创建UITableView" class="headerlink" title="2.10.2    创建UITableView"></a>2.10.2    创建<code>UITableView</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li>在<code>AppDelegate</code>中创建二级导航（通过<code>UINavigationController</code>）</li>
<li>在<code>ListTableViewController</code>完善<code>TableView</code></li>
</ol>
</blockquote>
<p><em>Model/AppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    <span class="comment">// 创建 window</span></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建 TableViewController</span></span><br><span class="line">    ListTableViewController *listVC = [[ListTableViewController alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 UINavigationController(需要指定导航控制器控制的是那个控制器)</span></span><br><span class="line">    <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc] initWithRootViewController:listVC];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将导航控制器设置为 window 的 rootViewController（这就是所谓的二级视图）</span></span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = navCtrl;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];<span class="comment">// 将该window置顶并显示出来</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-自定义头视图"><a href="#2-10-3-自定义头视图" class="headerlink" title="2.10.3    自定义头视图"></a>2.10.3    自定义头视图</h3><blockquote>
<p><strong>说明：</strong><code>MVC</code>的<code>View</code>部分</p>
<ul>
<li>不创建<code>xib</code>文件</li>
<li>完全通过代码创建视图</li>
<li>继承<code>UITableViewHeaderFooterView</code></li>
</ul>
<p><strong>注意：</strong>如果头视图被自定义了，则需要在<code>viewDidLoad</code>中重新设置其高度。</p>
</blockquote>
<h4 id="2-10-3-1-View部分"><a href="#2-10-3-1-View部分" class="headerlink" title="2.10.3.1    View部分"></a>2.10.3.1    <code>View</code>部分</h4><p><em>View/HeaderView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 协议（为代理对象定义协议）</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">HeaderViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeaderView</span> : <span class="title">UITableViewHeaderFooterView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;HeaderViewDelegate&gt;delegate;<span class="comment">// 代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKGroupModel *groupModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>View/HeadView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *_arrowBtn;<span class="comment">// 三角按钮（展开和关闭）</span></span><br><span class="line">    <span class="built_in">UILabel</span> *_label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"header"</span>;</span><br><span class="line">    <span class="comment">// 尝试获取该 UITableViewHeaderFooterView</span></span><br><span class="line">    HeaderView *header = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!header) &#123;</span><br><span class="line">        header = [[HeaderView alloc] initWithReuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        <span class="comment">// 初始化_arrowBtn(带三角的按钮)</span></span><br><span class="line">        <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg"</span>] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 北京图片</span></span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        [button setImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"arrow"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [button setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 标题</span></span><br><span class="line">        button.contentEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 整体内边距</span></span><br><span class="line">        button.contentHorizontalAlignment = <span class="built_in">UIControlContentHorizontalAlignmentLeft</span>;<span class="comment">// 左对齐</span></span><br><span class="line">        button.titleEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 文字部分的内边距</span></span><br><span class="line">        button.imageView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        button.imageView.clipsToBounds = <span class="literal">NO</span>;</span><br><span class="line">        _arrowBtn = button;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_arrowBtn];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化_label</span></span><br><span class="line">        <span class="built_in">UILabel</span> *labelRight = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        labelRight.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        _label = labelRight;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_label];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写布局方法:为_arrowBtn和_label设置布局</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    _arrowBtn.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.frame.size.width - <span class="number">70</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setGroupModel:(JKGroupModel *)groupModel</span><br><span class="line">&#123;</span><br><span class="line">    _groupModel = groupModel;</span><br><span class="line">    [_arrowBtn setTitle:_groupModel.name forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    _label.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/%lu"</span>, _groupModel.online, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)_groupModel.friends.count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - buttonAction</span></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-3-2-Controller部分"><a href="#2-10-3-2-Controller部分" class="headerlink" title="2.10.3.2    Controller部分"></a>2.10.3.2    <code>Controller</code>部分</h4><blockquote>
<p><strong>说明：</strong>整个qq列表实际上是一个<code>UITableView</code></p>
</blockquote>
<p><em>Controller/ListTableViewController</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()&lt;<span class="title">HeaderViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 自定义的透视图需要重新定义高度</span></span><br><span class="line">    <span class="keyword">self</span>.tableView.sectionHeaderHeight = <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:friendModel.icon];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableView delagate</span></span><br><span class="line"><span class="comment">// 添加自定义的头视图：初始化TableView中每个section中的header部分</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    HeaderView *header = [HeaderView headerView:tableView];</span><br><span class="line">    header.delegate = <span class="keyword">self</span>;<span class="comment">// 将自身作为代理对象</span></span><br><span class="line">    header.groupModel = <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-4-点击效果的实现"><a href="#2-10-4-点击效果的实现" class="headerlink" title="2.10.4    点击效果的实现"></a>2.10.4    点击效果的实现</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>点击群组栏（<code>HeaderView</code>，继承自<code>UITableViewHeaderFooterView</code>）中的按钮</li>
</ol>
<ul>
<li>展开群组</li>
<li>三角按钮变化</li>
</ul>
<ol>
<li>点击好友（<code>cell</code>），push到一个空界面</li>
</ol>
</blockquote>
<p><em>View/HeaderView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        ...</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父视图发生变化时被调用（不知为什么并没有被调用）</span></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToSuperview</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 三角符号旋转180度</span></span><br><span class="line">    _arrowBtn.imageView.transform = <span class="keyword">self</span>.groupModel.isOpen ? <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_2) : <span class="built_in">CGAffineTransformMakeRotation</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Controller/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">self</span> clipExtraCellLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cell被点击（选中进入）时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过导航控制器进入一个新的 ViewController</span></span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - HeadViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的cell的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clipExtraCellLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-三级控制器"><a href="#2-11-三级控制器" class="headerlink" title="2.11    三级控制器"></a>2.11    三级控制器</h2><blockquote>
<p><strong>说明：</strong>项目截图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.09.10.png" alt="Alt text|200x350"></p>
<p><strong>API：</strong><code>三级控制器</code>的实现使用到的<code>UIKit</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UITabViewController</code>相关成员</th>
<th>原型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>viewControllers</td>
<td><code>@property(nonatomic, copy) NSArray&lt;__kindof UIViewController *&gt; *viewControllers</code></td>
<td>存储着tab视图管理的所有二级控制器实例</td>
</tr>
<tr>
<td>selectedIndex</td>
<td><code>@property(nonatomic) NSUInteger selectedIndex</code></td>
<td>当前被选中的tab item的下标，修改该值会导致视图的切换</td>
</tr>
</tbody>
</table>
<h3 id="2-11-1-初始化视图控制器"><a href="#2-11-1-初始化视图控制器" class="headerlink" title="2.11.1    初始化视图控制器"></a>2.11.1    初始化视图控制器</h3><blockquote>
<p><strong>说明：</strong>本课时讲解<code>三级控制器</code>的结构，自定义视图控制器并初始化学习用新语法创建数组并赋值。用<code>导航控制器</code>构建<code>二级控制器</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.06.44.png" alt="Alt text|450x250"></p>
</blockquote>
<p><em>AppDelegate.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用新的<code>window</code>替换掉项目创建时默认的<code>window</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">    RootViewController *rootVC = [[RootViewController alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = rootVC;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"><span class="comment">// 初始化所有第二级控制器</span></span><br><span class="line">- (<span class="keyword">void</span>)initViewController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化视图控制器</span></span><br><span class="line">    ProfileViewController *profileVC = [[ProfileViewController alloc]init];</span><br><span class="line">    MessageViewController *messageVC = [[MessageViewController alloc]init];</span><br><span class="line">    ColaViewController *colaVC = [[ColaViewController alloc]init];</span><br><span class="line">    UserViewController *userVC = [[UserViewController alloc]init];</span><br><span class="line">    MoreViewController *moreVC = [[MoreViewController alloc]init];</span><br><span class="line">    <span class="comment">// 封装到数组中</span></span><br><span class="line">    <span class="built_in">NSArray</span> *vcArr = @[profileVC, messageVC, colaVC, userVC, moreVC];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *tabArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:vcArr.count];</span><br><span class="line">    <span class="comment">// 为每个视图控制器创建对应的导航控制器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vcArr.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc]initWithRootViewController:vcArr[i]];<span class="comment">// 创建导航视图器时为其绑定对应的视图控制器</span></span><br><span class="line">        [tabArray addObject:navCtrl];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将初始化好的存储导航控制器的数组作为一个属性赋值给第一级控制器</span></span><br><span class="line">    <span class="keyword">self</span>.viewControllers = tabArray;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-自定义标签工具栏"><a href="#2-11-2-自定义标签工具栏" class="headerlink" title="2.11.2    自定义标签工具栏"></a>2.11.2    自定义标签工具栏</h3><blockquote>
<p><strong>说明：</strong>本课时讲解隐藏系统自带<code>标签工具栏</code>样式，并自定义按钮和视图，根据系统的<code>标签工具栏</code>的属性实现切换。</p>
</blockquote>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> btnHeight = <span class="number">45</span>;<span class="comment">// 标签工具栏中按钮的高度</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 初始化标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)initTabBarView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图</span></span><br><span class="line">    _tabBarView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenHeight - tabViewHeight, kScreenWidth, tabViewHeight)];</span><br><span class="line">    _tabBarView.backgroundColor = [<span class="built_in">UIColor</span> colorWithPatternImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask_navbar"</span>]];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tabBarView];</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图 中的按钮</span></span><br><span class="line">    <span class="built_in">NSArray</span> *imgArray = @[<span class="string">@"home_tab_icon_1"</span>, <span class="string">@"home_tab_icon_2"</span>, <span class="string">@"home_tab_icon_3"</span>, <span class="string">@"home_tab_icon_4"</span>, <span class="string">@"home_tab_icon_5"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i; i &lt; imgArray.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:imgArray[i]] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnWidth * i, (tabViewHeight - btnHeight) / <span class="number">2</span>, btnWidth, btnHeight);</span><br><span class="line">        btn.tag = <span class="number">100</span> + i;<span class="comment">// 用来识别点击哪些按钮进行的tab切换（100以内的tag有特殊用途）</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btnAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.tabBarView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化当前被选中的tab按钮上展现的视图（倒三角）</span></span><br><span class="line">    _selectView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, btnWidth, btnHeight)];</span><br><span class="line">    _selectView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"home_bottom_tab_arrow"</span>];</span><br><span class="line">    [_tabBarView addSubview:_selectView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - tab按钮被点击时的处理函数</span></span><br><span class="line">- (<span class="keyword">void</span>)btnAction:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 切换视图（根据tag值获取当前索引）</span></span><br><span class="line">    <span class="keyword">self</span>.selectedIndex = button.tag - <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// 将倒三角移动到被选中的tab按钮上，移动动画持续时间为0.2秒</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        _selectView.center = button.center;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">self</span>.tabBar.hidden = <span class="literal">YES</span>;<span class="comment">// 隐藏 UITabViewController 自带的tab bar</span></span><br><span class="line">    [<span class="keyword">self</span> initTabBarView];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-页面跳转的两种方式"><a href="#2-11-3-页面跳转的两种方式" class="headerlink" title="2.11.3    页面跳转的两种方式"></a>2.11.3    页面跳转的两种方式</h3><blockquote>
<p><strong>说明：</strong>本课时讲解页面两种跳转方式。通过<code>导航控制器</code>实现 <code>push</code> 和通过<code>视图控制器</code>实现模态视图。并讲解 <code>iOS8</code> 中新的方法。</p>
<ul>
<li>从<code>三级控制器</code> <code>push</code>出其它页面需要隐藏<code>标签工具栏</code>，<code>pop</code>回来后需要展现<code>标签工具栏</code></li>
</ul>
</blockquote>
<h4 id="2-11-3-1-RootViewController"><a href="#2-11-3-1-RootViewController" class="headerlink" title="2.11.3.1    RootViewController"></a>2.11.3.1    RootViewController</h4><blockquote>
<p><strong>说明：</strong>在<code>标签控制器</code>中定义<code>标签工具栏</code>的显示／隐藏方法</p>
</blockquote>
<p><em>RootViewController.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> : <span class="title">UITabBarController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *tabBarView;<span class="comment">// 标签工具栏</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示或隐藏标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *selectView;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示／隐藏tab工具栏</span><br><span class="line"> *</span><br><span class="line"> *  @param show YES: 显示, NO: 隐藏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.tabBarView.frame;</span><br><span class="line">    <span class="comment">// 更新frame</span></span><br><span class="line">    <span class="keyword">if</span> (show) &#123;</span><br><span class="line">        frame.origin.x = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        frame.origin.x = -kScreenWidth;<span class="comment">// 隐藏tab bar：将tab bar移除屏幕</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重新赋值tabBarView的frame</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.tabBarView.frame = frame;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-2-ProfileViewController"><a href="#2-11-3-2-ProfileViewController" class="headerlink" title="2.11.3.2    ProfileViewController"></a>2.11.3.2    ProfileViewController</h4><blockquote>
<p><strong>说明：</strong><code>首页</code>中通过两种方式跳转。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonWidth = <span class="number">33</span>;<span class="comment">// 导航栏按钮宽度</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonHeight = <span class="number">32</span>;<span class="comment">// 导航栏按钮高度</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProfileViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ProfileViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.title = <span class="string">@"首页"</span>;</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span> initNavButton];</span><br><span class="line">    [<span class="keyword">self</span> initPushButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义导航栏按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)initNavButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIButton</span></span><br><span class="line">    <span class="built_in">UIButton</span> *writeBtn =  [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">    writeBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, writeButtonWidth, writeButtonHeight);</span><br><span class="line">    [writeBtn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"write"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [writeBtn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(presentAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 封装为 UIBarButtonItem</span></span><br><span class="line">    <span class="built_in">UIBarButtonItem</span> *item = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithCustomView:writeBtn];</span><br><span class="line">    <span class="comment">// 添加到导航栏</span></span><br><span class="line">    <span class="keyword">self</span>.navigationItem.rightBarButtonItem = item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化 push 页面的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPushButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *pushButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    pushButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [pushButton setTitle:<span class="string">@"Push"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [pushButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pushAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:pushButton];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用push的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pushAction</span><br><span class="line">&#123;</span><br><span class="line">    PushViewController *pushVC = [[PushViewController alloc] init];</span><br><span class="line">    <span class="comment">// 通过和当前的视图控制器绑定的导航控制器完成页面的 push</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:pushVC animated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 隐藏首页的tab bar</span></span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用模态的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)presentAction</span><br><span class="line">&#123;</span><br><span class="line">    ModalViewController *modalVC = [[ModalViewController alloc] init];</span><br><span class="line">    <span class="comment">// 使用模态视图</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:modalVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// 展现首页前显示tab bar</span></span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-3-PushViewController"><a href="#2-11-3-3-PushViewController" class="headerlink" title="2.11.3.3    PushViewController"></a>2.11.3.3    PushViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>push</code>跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PushViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PushViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建回退（pop）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *popButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    popButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="comment">// 设置文本（使用了setTitle就不能setImage了）</span></span><br><span class="line">    [popButton setTitle:<span class="string">@"Pop"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [popButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(popAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:popButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  回退(pop)到堆栈中的上一个视图(首页)</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)popAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-4-ModalViewController"><a href="#2-11-3-4-ModalViewController" class="headerlink" title="2.11.3.4    ModalViewController"></a>2.11.3.4    ModalViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>dismiss</code>方式跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ModalViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ModalViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="comment">// 创建回退（dismisss）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *dismissButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    dismissButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [dismissButton setTitle:<span class="string">@"Dismiss"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册点击事件</span></span><br><span class="line">    [dismissButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(dismissAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:dismissButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回退页面</span></span><br><span class="line">- (<span class="keyword">void</span>)dismissAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-12-通讯录"><a href="#2-12-通讯录" class="headerlink" title="2.12    通讯录"></a>2.12    通讯录</h2><blockquote>
<p><strong>说明：</strong>本课实现模拟通讯录的登陆、添加、删除、修改的功能，涉及到第三方类库的使用，数据存储并加深理解代理和 <code>UITableView</code>。</p>
<ol>
<li><code>Storyboard</code>中设置页面跳转</li>
<li>第三方类库<code>MBProgressHUD</code></li>
<li>数据存储</li>
<li><code>UITableView</code>的深入理解</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_contact.gif" alt="Alt text|200x350"></p>
</blockquote>
<h3 id="2-12-1-Storyboard实现布局和跳转"><a href="#2-12-1-Storyboard实现布局和跳转" class="headerlink" title="2.12.1    Storyboard实现布局和跳转"></a>2.12.1    <code>Storyboard</code>实现布局和跳转</h3><blockquote>
<p><strong>说明：</strong>本课时讲解创建自定义视图控制器并通过 <code>storyboard</code> 来布局页面，学习手动跳转的方法。</p>
</blockquote>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><hr>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>becomeFirstResponder</code></td>
<td>实例方法</td>
<td>使文本输入框自动获取焦点，呼出键盘，类似<code>html</code>中的<code>autofocus</code></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>``</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="2-12-1-1-布局"><a href="#2-12-1-1-布局" class="headerlink" title="2.12.1.1    布局"></a>2.12.1.1    布局</h4><p><strong>1. 建立<code>Navigaton Controller</code>和<code>LoginViewController</code>之间的关联</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%8810.17.31.png" alt="Alt text"><br><strong>2. <code>LoginViewController</code>跳转到<code>ContactTableViewController</code></strong></p>
<blockquote>
<p>采用<code>iOS8</code>后的新的<code>show</code>替代<code>push</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_show.gif" alt="Alt text"><br><strong>3. 自定义<code>ContactTableViewController</code>的导航栏</strong></p>
<ul>
<li>自定义导航栏需要添加<code>Navigation Item</code>控件</li>
<li><code>Navigation Item</code>内的按钮要使用<code>Button Item</code>控件</li>
<li>按钮中使用系统图标(<code>System Icon</code>)<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8A%E5%8D%8812.23.35.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="2-12-1-2-跳转"><a href="#2-12-1-2-跳转" class="headerlink" title="2.12.1.2    跳转"></a>2.12.1.2    跳转</h4><blockquote>
<ul>
<li>使用<code>NSNotificationCenter</code>监控文本的变化</li>
<li>使用在<code>Storyboard</code>中为视图之间建立的<code>连接</code>的<code>identifier</code>访问<code>连接</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LoginViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LoginViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *pwdField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UISwitch</span> *rembField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *loginBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.pwdField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// In a storyboard-based application, you will often want to do a little preparation before navigation</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  跳转之前之行</span><br><span class="line"> *</span><br><span class="line"> *  @param segue 跳转的信息</span><br><span class="line"> *  @param sender 和performSegueWithIdentifier方法传入的sender是同一个</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// Get the new view controller using [segue destinationViewController].</span></span><br><span class="line">    <span class="comment">// Pass the selected object to the new view controller.</span></span><br><span class="line">    <span class="comment">// 1. 获取跳转目的地视图的控制器</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *contactVC = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 2. 设置标题（传值）</span></span><br><span class="line">    contactVC.title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@的联系人列表"</span>, <span class="keyword">self</span>.nameField.text];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.loginBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.pwdField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-2-UIAlertController与添加页面布局"><a href="#2-12-2-UIAlertController与添加页面布局" class="headerlink" title="2.12.2    UIAlertController与添加页面布局"></a>2.12.2    <code>UIAlertController</code>与添加页面布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>iOS8</code> 中新控制器 <code>UIAlertController</code> 的使用，并通过 <code>storyboard</code> 布局添加联系人页面，用第三方类库 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> 实现网络加载进程的效果。</p>
</blockquote>
<p><strong>1. 登录过程中使用<code>MBProgressHUD</code>实现提示窗</strong><br><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"账号不存在"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"密码错误"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [MBProgressHUD showMessage:<span class="string">@"努力加载中"</span>];</span><br><span class="line">    <span class="comment">// 2秒后（模拟网络请求）跳转</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 移除蒙板弹窗</span></span><br><span class="line">        [MBProgressHUD hideHUD];</span><br><span class="line">        [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 在<code>联系人列表界面</code>中点击<code>添加按钮</code>跳转到<code>添加页面</code></strong><br><img src="./show2.gif" alt="Alt text|200x200"></p>
<p><strong>3. 在<code>联系人列表界面</code>中点击注销按钮，注销登陆</strong></p>
<blockquote>
<p><code>UIAlertController</code>：<code>iOS8</code>之后出现的，用来弹出提示窗，取代了<code>UIAcionSheet</code>和<code>UIAlertView</code>。</p>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 初始化 UIAlertController,使用 actionSheet 样式</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"是否注销?"</span> message:<span class="string">@"真的要注销吗？"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">    <span class="comment">// 添加取消按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:<span class="literal">nil</span>]];</span><br><span class="line">    <span class="comment">// 添加确定按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleDestructive</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</span><br><span class="line">        <span class="comment">// pop掉适当前的视图控制器</span></span><br><span class="line">        [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;]];</span><br><span class="line">    <span class="comment">// 弹出这个控制器</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 为<code>登陆界面</code>的输入框增加清空按钮</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.43.58.png" alt="Alt text"></p>
<p><strong>5. 为<code>登陆界面</code>的密码输入框设置安全输入</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.44.32.png" alt="Alt text"></p>
<p><strong>6. 初始化<code>联系人列表界面</code>中的联系人</strong></p>
<blockquote>
<ul>
<li>添加属性<code>contactArr</code></li>
<li>在<code>Storyboard</code>中为<code>联系人cell</code>设置<code>identifier</code>，并设置其<code>Style</code>为<code>Right Style</code></li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.contactArr.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"contactPeopleCell"</span> forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Configure the cell...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-3-添加功能与传值"><a href="#2-12-3-添加功能与传值" class="headerlink" title="2.12.3    添加功能与传值"></a>2.12.3    添加功能与传值</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现添加功能，添加联系人信息后通过代理传递数据到上一层视图控制器。用 <code>storyboard</code> 布局编辑页面。</p>
</blockquote>
<p><strong>1. 创建<code>JKContactModel</code>数据模型</strong></p>
<blockquote>
<p>该数据模型能够<code>序列化</code>和<code>反序列化</code></p>
</blockquote>
<p><em>JKContactModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKContactModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *phone;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContactModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKContactModel</span></span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)encoder &#123;</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.name forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.phone forKey:<span class="string">@"phone"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)decoder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"phone"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 定义具备添加功能（传值）的代理协议，并使用代理对象实现添加功能</strong></p>
<blockquote>
<ul>
<li>让姓名文本框自动获取光标，弹出虚拟键盘</li>
</ul>
</blockquote>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">AddViewController</span>, <span class="title">JKContactModel</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义处理添加工作的代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AddViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;AddViewControllerDelegate&gt; delegate;<span class="comment">// 代理对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *addBtn;</span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction;</span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AddViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="comment">// 让性命文本框 autofocus</span></span><br><span class="line">    [<span class="keyword">self</span>.nameField becomeFirstResponder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通过代理对象传值</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(addContact:didAddContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 创建数据模型</span></span><br><span class="line">        JKContactModel *contactModel = [[JKContactModel alloc] init];</span><br><span class="line">        contactModel.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        contactModel.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理对象将数据添加到 联系人列表视图的数组中</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate addContact:<span class="keyword">self</span> didAddContact:contactModel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.addBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>联系人列表视图</code>中接受数据并增加一条联系人信息<blockquote>
<ul>
<li>去掉多余的 table 中多余的线</li>
<li>在cell右侧添加箭头</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> clearExtraLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clearExtraLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc]init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    AddViewController *addVc = vc;</span><br><span class="line">    addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 设置键盘类型</strong><br><img src="./屏幕快照 2016-03-23 10.14.46.png" alt="Alt text"></p>
<h3 id="2-12-4-编辑页面功能完善"><a href="#2-12-4-编辑页面功能完善" class="headerlink" title="2.12.4    编辑页面功能完善"></a>2.12.4    编辑页面功能完善</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现编辑页面的功能，点击编辑修改响应的按钮和文本框状态，并通过代理方法传值。</p>
</blockquote>
<p><strong>1. 在<code>Storyboard</code>中创建并初始化编辑页面的布局</strong></p>
<blockquote>
<ul>
<li>为cell建立<code>selection segue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_section.gif" alt="Alt text|200x200"></li>
<li>设置按钮默认隐藏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-23%2010.35.09.png" alt="Alt text|350x200"></li>
<li>设置<code>编辑界面</code>的输入框默认不可点击</li>
</ul>
</blockquote>
<p><strong>2. 完善<code>EditViewController</code></strong></p>
<blockquote>
<ul>
<li>初始化界面数据</li>
<li>定义编辑界面的代理协议</li>
<li>实现编辑action</li>
<li>实现保存action</li>
</ul>
</blockquote>
<p>“<em>Controller/EditViewController.h”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKContactModel</span>, <span class="title">EditViewController</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">EditViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc ddidSavaContact: (JKContactModel *)model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;EditViewControllerDelegate&gt;delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKContactModel *contactMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>“<em>Controller/EditViewController.m”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *saveBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIBarButtonItem</span> *edit;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender;</span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EditViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 通过数据模型初始化页面数据</span></span><br><span class="line">    <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">    <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前页面</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通知代理</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(editViewController:didSavaContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 更新编辑界面的显示</span></span><br><span class="line">        <span class="keyword">self</span>.contactMode.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        <span class="keyword">self</span>.contactMode.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理更新联系人列表界面的显示</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate editViewController:<span class="keyword">self</span> didSavaContact:<span class="keyword">self</span>.contactMode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 进入不可编辑状态</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.nameField.enabled) &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">YES</span>;</span><br><span class="line">        sender.title = <span class="string">@"编辑"</span>;</span><br><span class="line">        <span class="comment">// 使用原来的数据还原输入框显示</span></span><br><span class="line">        <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 进入可编辑状态</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">NO</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        sender.title = <span class="string">@"取消"</span>;<span class="comment">// 更新编辑按钮文案</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.edit.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p><code>联系人列表界面</code>采纳代理协议，接收编辑页面的数据</p>
<blockquote>
<ul>
<li>跳转到编辑页面前为<code>编辑界面</code>赋值代理对象</li>
<li>实现滑动删除功能</li>
</ul>
</blockquote>
<hr>
<p><em>ContactTableViewConrtroller.m</em></p>
</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>, <span class="title">EditViewControllerDelegate</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）和数据模型</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">/* 设置代理 */</span></span><br><span class="line">    <span class="comment">// 跳转到添加联系人视图控制器</span></span><br><span class="line">    <span class="keyword">if</span> ([vc isKindOfClass:[AddViewController class]]) &#123;</span><br><span class="line">        AddViewController *addVc = vc;</span><br><span class="line">        addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跳转到编辑联系人视图控制器</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([vc isKindOfClass:[EditViewController class]]) &#123;</span><br><span class="line">        <span class="comment">// 获取点击的联系人所在cell(选中的那一行)的 NSIndexPath</span></span><br><span class="line">        EditViewController *editVc = vc;</span><br><span class="line">        <span class="comment">// 获取选中的那一行</span></span><br><span class="line">        <span class="built_in">NSIndexPath</span> *path = [<span class="keyword">self</span>.tableView indexPathForSelectedRow];</span><br><span class="line">        <span class="comment">// 赋值数据模型</span></span><br><span class="line">        editVc.contactMode = <span class="keyword">self</span>.contactArr[path.row];</span><br><span class="line">        <span class="comment">// 赋值代理对象</span></span><br><span class="line">        editVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-5-数据存储"><a href="#2-12-5-数据存储" class="headerlink" title="2.12.5    数据存储"></a>2.12.5    数据存储</h3><blockquote>
<p><strong>说明：</strong>本课时讲解数据存储的四种方式的区别，学习<code>偏好设置</code>和<code>归档</code>的方式存储数据，并解决添加页面不能传值的问题。</p>
</blockquote>
<table>
<thead>
<tr>
<th>数据存储方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>plist</td>
<td>需要知道文件名，只适合<code>NSArray</code>、<code>NSString</code>等基本数据类型</td>
</tr>
<tr>
<td>偏好设置</td>
<td>不需要知道文件名，小型数据<code>NSUserDefaults</code></td>
</tr>
<tr>
<td>对象归档</td>
<td><code>NSKeyedArchiver</code>，必须采纳<code>NSCoding</code>协议</td>
</tr>
<tr>
<td>core Data</td>
<td>大型数据</td>
</tr>
<tr>
<td>sqpite3</td>
<td>数据库</td>
</tr>
</tbody>
</table>
<h4 id="2-12-5-1-便好设置"><a href="#2-12-5-1-便好设置" class="headerlink" title="2.12.5.1    便好设置"></a>2.12.5.1    便好设置</h4><blockquote>
<p><strong>实战：</strong>登录界面载入后采用<code>便好设置</code>方式读取配置</p>
<ul>
<li>页面载入时读取<code>便好设置</code></li>
<li>点击登录时存储<code>便好设置</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MBProgressHUD+MJ.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define UserNameKey @<span class="meta-string">"name"</span></span></span><br><span class="line"><span class="meta">#define PwdKey @<span class="meta-string">"pwd"</span></span></span><br><span class="line"><span class="meta">#define RmbPwdKey @<span class="meta-string">"rmd_pwd"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.nameField forKey:UserNameKey];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.pwdField.text forKey:PwdKey];</span><br><span class="line">    [defaults setBool:<span class="keyword">self</span>.rembField.isOn forKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 设置同步</span></span><br><span class="line">    [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 读取上次配置</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    <span class="keyword">self</span>.nameField.text = [defaults valueForKey:UserNameKey];</span><br><span class="line">    <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">    <span class="keyword">self</span>.rembField.on = [defaults boolForKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 如果上次登录时选择了记住密码，则自动填写密码字段，并激活登录按钮</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.rembField.isOn) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">        <span class="keyword">self</span>.loginBtn.enabled = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-12-5-2-对象归档"><a href="#2-12-5-2-对象归档" class="headerlink" title="2.12.5.2    对象归档"></a>2.12.5.2    对象归档</h4><blockquote>
<p><strong>实战：</strong>联系人列表界面使用<code>对象归档方式</code>存储数据。</p>
<ul>
<li><code>JKContactModel</code>采纳<code>NSCoding</code>协议</li>
<li>对<code>联系人列表界面</code>中添加、删除和读取数据模型的操作进行归档</li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取归档的文件路径</span></span><br><span class="line"><span class="meta">#define ContactFilePath [[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:@<span class="meta-string">"contacts.data"</span>]</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">        <span class="comment">// 3. 归档</span></span><br><span class="line">        [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 3. 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-13-绘制小黄人"><a href="#2-13-绘制小黄人" class="headerlink" title="2.13    绘制小黄人"></a>2.13    绘制小黄人</h2><h3 id="Quartz-2D"><a href="#Quartz-2D" class="headerlink" title="Quartz 2D"></a>Quartz 2D</h3><blockquote>
<p><strong>说明：</strong>是一个二维绘图引擎。<code>Quartz 2D</code>的<code>API</code>是<code>C</code>语言，来自于<code>CoreGraphics</code>框架。该框架可以用来</p>
<ul>
<li>绘制图形：线条／三角形／矩形／圆／弧等</li>
<li>绘制文字</li>
<li>绘制、生成图片（图像)）</li>
<li>读取／生成pdf</li>
<li>截图、裁剪图片</li>
<li>自定义UI控件</li>
</ul>
<p><strong>技巧：</strong><code>UIView</code>就是通过该引擎实现的控件绘制，因此可以通过继承<code>UIView</code>定义自己的控件。<br><strong>图形上下文（Graphics Context）：</strong>是一个<code>CGContextRef</code>类型的数据，用来</p>
<ul>
<li>保存绘图信息、绘图状态</li>
<li>决定绘制的输出目标（绘制到什么地方去，输出目标可以是PDF文件、Bitmap或者显示器的窗口上）</li>
</ul>
</blockquote>
<h3 id="2-13-1-Quartz-2D基本图形"><a href="#2-13-1-Quartz-2D基本图形" class="headerlink" title="2.13.1    Quartz 2D基本图形"></a>2.13.1    <code>Quartz 2D</code>基本图形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>Quartz 2D</code> 的概念，<code>drawRect</code> 方法的调用、图形上下文、以及线段、三角形、四边形的绘制方法。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%889.51.15.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawLine.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DrawLine</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>DrawLine.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawLine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawLine</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  系统自动调用，视图显示在屏幕上的时候调用切只调用一次</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drwaLine();</span><br><span class="line">    drawRect();</span><br><span class="line">    drawTriangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制直线</span><br><span class="line"> *  绘制两条样式不同的线，因此在两个图形上下文中分别绘制</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drwaLine() &#123;</span><br><span class="line">    <span class="comment">// 第1条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 将上下文复制一份到栈中(作为为第二条线的图形上下文)</span></span><br><span class="line">    <span class="built_in">CGContextSaveGState</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">20</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(context, k<span class="built_in">CGLineCapRound</span>);<span class="comment">// 设置线条头尾部的样式</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);<span class="comment">//设置起点</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第二条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRestoreGState</span>(context);<span class="comment">// 将图形上下文出栈， 替换当前的上下文</span></span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(context, k<span class="built_in">CGLineJoinRound</span>);<span class="comment">// 设置线断转折点的样式</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">120</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制四边形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawRect() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制四边形</span></span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">180</span>));<span class="comment">// 四边形</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> purpleColor] setFill];<span class="comment">// 设置填充色</span></span><br><span class="line">    <span class="comment">// 3. 显示在 View 上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制三角形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawTriangle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制三角形</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);<span class="comment">// 第一个边</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">100</span>);<span class="comment">// 第二个边</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);<span class="comment">// 第三个边（闭合路径，连接起点和最后一个点）</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    <span class="comment">// 3. 显示在view</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-2-绘制圆、图片与文字"><a href="#2-13-2-绘制圆、图片与文字" class="headerlink" title="2.13.2    绘制圆、图片与文字"></a>2.13.2    绘制圆、图片与文字</h3><blockquote>
<p><strong>说明：</strong>本课时讲解绘制圆弧、圆形、图片与文字的方法，所用函数及函数参数的含义，并介绍多种不同的函数绘制图形，最后介绍了<code>Quartz 2D</code>中的贝塞尔曲线。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%8810.25.47.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawCircle.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawCircle.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  角度转换为弧度</span><br><span class="line"> *</span><br><span class="line"> *  @param angle 角度</span><br><span class="line"> *</span><br><span class="line"> *  @return 弧度</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">CGFloat</span> arc(<span class="built_in">CGFloat</span> angle) &#123;</span><br><span class="line">    <span class="keyword">return</span> angle * (M_PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawCircle</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drawArc();</span><br><span class="line">    drawCircle();</span><br><span class="line">    drawImg();</span><br><span class="line">    drawText();</span><br><span class="line">    drawBezier();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  画圆</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawCircle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">130</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  弧形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawArc() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="comment">// 参数：上下文, 圆心横坐标，圆心纵坐标，半径，开始的角度，结束的角度，0顺时针/1逆时针</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, arc(<span class="number">90</span>), arc(<span class="number">200</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *   绘制字体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawText() &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;<span class="comment">// 字串</span></span><br><span class="line">    <span class="comment">// 设置（字体样式信息保存在字典中）</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    attributes[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];<span class="comment">// 字体大小</span></span><br><span class="line">    attributes[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> purpleColor];<span class="comment">// 字体颜色</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:attributes];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图片</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawImg()&#123;</span><br><span class="line">    <span class="comment">// 1. 取得图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">    <span class="comment">// 2. 画</span></span><br><span class="line">    <span class="comment">// img drawAtPoint</span></span><br><span class="line">    <span class="comment">// img drawInRect</span></span><br><span class="line">    [img drawAsPatternInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  贝塞尔曲线</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBezier()&#123;</span><br><span class="line">    <span class="comment">// 1.取得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 起点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextAddCurveToPoint(context, 120, 100, 180, 50, 190, 190);// 2个控制点</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>);<span class="comment">// 1个控制点</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-3-绘制小黄人雏形"><a href="#2-13-3-绘制小黄人雏形" class="headerlink" title="2.13.3    绘制小黄人雏形"></a>2.13.3    绘制小黄人雏形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解根据所学习的 <code>Quartz 2D</code> 的绘制图形的知识绘制小黄人雏形，以此加深对绘图的理解。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-25%20%E4%B8%8A%E5%8D%8812.28.25.png" alt="Alt text|200x150"></p>
</blockquote>
<p><em>DrawHuman.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawHuman.h"</span></span></span><br><span class="line"><span class="meta">#define JKRadius 70// 半径</span></span><br><span class="line"><span class="meta">#define JKTopY 100// 即是身体高度，也是身体顶部纵坐标</span></span><br><span class="line"><span class="meta">#define JKColor(r, g, b) [UIColor colorWithRed:(r)/255.0 green:(g)/255.0 blue :(b)/255.0 alpha:1.0]// 身体颜色</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawHuman</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// 1. 图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    drawBody(context, rect);</span><br><span class="line">    drawMouse(context, rect);</span><br><span class="line">    drawEyes(context, rect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  身体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBody(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 上半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topX = rect.size.width * <span class="number">0.5</span>;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topY = JKTopY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topRadius = JKRadius;<span class="comment">// 圆形半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, topX, topY, topRadius, <span class="number">0</span>, M_PI, <span class="number">1</span>);<span class="comment">// 绘制半圆（从右侧沿逆时针向左绘制）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 身体左侧竖线</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleX = topX - topRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleH = JKTopY;<span class="comment">// 身体部分高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleY =  topY + middleH;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, middleX, middleY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomX = topX;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomY = middleY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomRedius = topRadius;<span class="comment">// 半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, bottomX, bottomY, bottomRedius, M_PI, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭合</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [JKColor(<span class="number">252</span>, <span class="number">218</span>, <span class="number">0</span>) set];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  嘴</span><br><span class="line"> *  采用赛贝尔曲线，1个控制点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawMouse(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 控制点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> controlX = rect.size.width * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> controlY = rect.size.height * <span class="number">0.3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移动到起点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> marginX = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> marginY = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentX = controlX - marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentY = controlY - marginY;</span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, currentX, currentY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 结束点坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endX = controlX + marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> endY = currentY;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, controlX, controlY, endX, endY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  眼睛</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawEyes(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">//黑色绑带（一条很粗的线）</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startX = rect.size.width * <span class="number">0.5</span> - JKRadius;<span class="comment">// 起点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startY = JKTopY;<span class="comment">// 起点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startX, startY);</span><br><span class="line">    <span class="built_in">CGFloat</span> endX = startX + <span class="number">2</span> * JKRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endY = startY;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endX, endY);<span class="comment">// 划线</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">15</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];<span class="comment">// 设置线的颜色</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 显示</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//灰色镜框</span></span><br><span class="line">    [JKColor(<span class="number">61</span>, <span class="number">62</span>, <span class="number">66</span>) set];</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangRadius = JKRadius * <span class="number">0.4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangY = startY;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangX = rect.size.width * <span class="number">0.5</span> - kuangRadius;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, kuangX + <span class="number">25</span>, kuangY, kuangRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//里面的白色框</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> whiteColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteRadius = kuangRadius * <span class="number">0.7</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteX = kuangX;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteY = kuangY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, whiteX + <span class="number">25</span>, whiteY, whiteRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//眼睛</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> blackRadius = whiteRadius * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackX = whiteX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackY = whiteY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, blackX + <span class="number">25</span>, blackY, blackRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-14-手势密码锁"><a href="#2-14-手势密码锁" class="headerlink" title="2.14    手势密码锁"></a>2.14    手势密码锁</h2><h3 id="UIGestureRecognizer"><a href="#UIGestureRecognizer" class="headerlink" title="UIGestureRecognizer"></a>UIGestureRecognizer</h3><blockquote>
<p><strong>说明：</strong>所有手势操作相关的操作的类的<code>基类</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UIGestureRecognizer</code>的子类</th>
<th>对应的手势操作</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UITapGestureRecoginizer</code></td>
<td>点击</td>
</tr>
<tr>
<td><code>UIPinchGestureRecognizer</code></td>
<td>捏合</td>
</tr>
<tr>
<td><code>UIRotationGestureRecognizer</code></td>
<td>旋转</td>
</tr>
<tr>
<td><code>UISwipwGestureRecognizer</code></td>
<td>轻扫、快速移动，是用于监测欢动方向的</td>
</tr>
<tr>
<td><code>UIPanGestureRecognizer</code></td>
<td>拖移、慢速移动，是用于监测便宜的量的</td>
</tr>
<tr>
<td><code>UILongPressGestureRecognizer</code></td>
<td>长按</td>
</tr>
</tbody>
</table>
<h3 id="2-14-1-点击、捏合、轻扫"><a href="#2-14-1-点击、捏合、轻扫" class="headerlink" title="2.14.1    点击、捏合、轻扫"></a>2.14.1    点击、捏合、轻扫</h3><blockquote>
<p><strong>说明：</strong>本课时讲解点击手势，单击和双击，手势互斥原则的概念和解决方法，捏合手势缩放视图以及轻扫手势的使用。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Tap 点击和手势</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  1. 点击示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)tapGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 类型一：一个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTap:)];</span><br><span class="line">    tap.numberOfTapsRequired = <span class="number">1</span>;<span class="comment">// 点击次数(默认1)</span></span><br><span class="line">    tap.numberOfTouchesRequired = <span class="number">1</span>;<span class="comment">// 几个手指点击（默认1）</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap];<span class="comment">// 注册事件到顶层view</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二：一个手指双击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap2 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(doubleTap:)];</span><br><span class="line">    tap2.numberOfTapsRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap2];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型一和类型二冲突策略</span></span><br><span class="line">    [tap requireGestureRecognizerToFail:tap2];<span class="comment">// 同时发生时，只触发tap2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型三：两个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap3 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTwoFingerTap:)];</span><br><span class="line">    tap3.numberOfTouchesRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap3];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二和类型三冲突策略</span></span><br><span class="line">    [tap2 requireGestureRecognizerToFail:tap3];<span class="comment">// 同时发生时，只触发tap3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  2. 轻扫手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UISwipeGestureRecognizer</span> *swipe = [[<span class="built_in">UISwipeGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(swipeAction:)];</span><br><span class="line">    swipe.direction = <span class="built_in">UISwipeGestureRecognizerDirectionLeft</span>;<span class="comment">// 默认右扫</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:swipe];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  3. 捏合手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPinchGestureRecognizer</span> *pinch = [[<span class="built_in">UIPinchGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pinchAction:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:pinch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 响应方法</span></span><br><span class="line"><span class="comment">// 单击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)doubleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指双击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单击（两个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTwoFingerTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"两个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滑动</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeAction:(<span class="built_in">UISwipeGestureRecognizer</span> *)swipe</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"向左轻扫"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捏合</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchAction:(<span class="built_in">UIPinchGestureRecognizer</span> *)pinch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> scale = pinch.scale;</span><br><span class="line">    pinch.view.transform = <span class="built_in">CGAffineTransformScale</span>(pinch.view.transform, scale, scale);</span><br><span class="line">    <span class="keyword">if</span> (scale &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合放大"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (scale &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合缩小"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-14-2-拖移、旋转、长按"><a href="#2-14-2-拖移、旋转、长按" class="headerlink" title="2.14.2    拖移、旋转、长按"></a>2.14.2    拖移、旋转、长按</h3><blockquote>
<p><strong>说明：</strong>本课时讲解拖移、旋转和长按手势的声明以及响应方法，根据其属性和方法来深入理解手势。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  4. 拖移手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)panGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:pan];<span class="comment">// 注册事件到_genstureLabel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  5. 旋转手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIRotationGestureRecognizer</span> *rotation = [[<span class="built_in">UIRotationGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rotationAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:rotation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  6. 长按手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UILongPressGestureRecognizer</span> *longPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(longPressAction:)];</span><br><span class="line">    longPress.minimumPressDuration = <span class="number">2</span>;<span class="comment">// 设置有效触发长按事件时间</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:longPress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长按</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressAction:(<span class="built_in">UILongPressGestureRecognizer</span> *)longPress</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"已经长按2秒"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationAction:(<span class="built_in">UIRotationGestureRecognizer</span> *)rotationGes</span><br><span class="line">&#123;</span><br><span class="line">    rotationGes.view.transform = <span class="built_in">CGAffineTransformRotate</span>(rotationGes.view.transform, rotationGes.rotation);</span><br><span class="line">    rotationGes.rotation = M_PI;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"旋转"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拖动</span></span><br><span class="line">- (<span class="keyword">void</span>)panAction:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移动的量（向量）</span></span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [pan translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    <span class="comment">// 计算移动后的位置坐标</span></span><br><span class="line">    pan.view.center = <span class="built_in">CGPointMake</span>(pan.view.center.x + translation.x, pan.view.center.y + translation.y);</span><br><span class="line">    <span class="comment">// 设置坐标和速度</span></span><br><span class="line">    [pan setTranslation:<span class="built_in">CGPointZero</span> inView:<span class="keyword">self</span>.view];</span><br><span class="line">    _genstureLabel.text = <span class="string">@"把我放哪儿啊？"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-14-3-九宫格布局按钮"><a href="#2-14-3-九宫格布局按钮" class="headerlink" title="2.14.3    九宫格布局按钮"></a>2.14.3    九宫格布局按钮</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>storyboard</code> 添加背景视图，并通过代码布局按钮，运用到了九宫格布局算法，对触摸事件和按钮的功能进行代码封装。</p>
<ol>
<li>引入图片资源</li>
<li>创建<code>JKLockView</code>（<code>UIView</code>）</li>
<li>重写<code>initWithFrame</code>和<code>initWithCoder</code></li>
<li>布局<code>JKLockView</code>并添加按钮<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_gesture.gif" alt="Alt text|100x180"></li>
</ol>
</blockquote>
<h3 id="2-14-4-手势连线与代理"><a href="#2-14-4-手势连线与代理" class="headerlink" title="2.14.4    手势连线与代理"></a>2.14.4    手势连线与代理</h3><blockquote>
<p><strong>说明：</strong>本课时讲解将按钮根据手势触摸连线，修改按钮选中状态、手势结束后取消连线、最后设置代理方法来判断密码是否正确。</p>
<ol>
<li>完成连线逻辑</li>
<li>在<code>JKLockView</code>中定义代理协议</li>
<li><code>ViewController</code>采纳代理协议</li>
<li>在<code>JKLockView</code>中调用代理对象</li>
<li>在<code>ViewController</code>中使用<code>UIAlertController</code></li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>数组或字典中添加的对象不能为<code>nil</code>，否则程序会崩溃</li>
<li>当视图发生变化时，调用<code>setNeedDisplay</code>更新视图</li>
</ul>
<p><strong>技巧：</strong>通过 <code>makeObjectsPerformSelector</code> 向数组中的每一个对象发送信息</p>
</blockquote>
<h2 id="2-15-抽奖转盘动画"><a href="#2-15-抽奖转盘动画" class="headerlink" title="2.15    抽奖转盘动画"></a>2.15    抽奖转盘动画</h2><blockquote>
<p><strong>说明：</strong><code>QuartzCore</code> 框架是常用的框架，除了绘图还有动画效果，通过这个课程理解常用的 <code>CAAnimation</code> 类，并且了解图层与视图的关系，包括 <code>CALayer</code> 的自定义方法和属性。</p>
<ul>
<li>CALayer</li>
<li>CAAnimation</li>
<li>转场动画与组动画</li>
<li>隐性动画</li>
<li>CGImageCreateWithImageInRect</li>
<li>CADisplayLink</li>
</ul>
<p><strong>兼容性：</strong><code>QuartzCore</code>与<code>CoreGraphics</code>是可以跨平台使用的，<code>UIKit</code>只能在<code>iOS</code>中使用</p>
</blockquote>
<h3 id="2-15-1-CALayer图层介绍"><a href="#2-15-1-CALayer图层介绍" class="headerlink" title="2.15.1    CALayer图层介绍"></a>2.15.1    CALayer图层介绍</h3><p><strong>*课程介绍：</strong>本课时讲解<code>CALayer</code> 图层的概念，介绍图层的属性和自定义图层的方法。*</p>
<h4 id="CALayer"><a href="#CALayer" class="headerlink" title="CALayer"></a>CALayer</h4><blockquote>
<p><strong>依赖：</strong>使用层之前，需要在项目中引入<code>QuartzCore.framework</code>框架<br><strong>用途：</strong><code>CALayer</code>(层)是屏幕上的一个矩形区域，在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。</p>
<ul>
<li>层的大小尺寸</li>
<li>背景色</li>
<li>内容（可以填充图片或者使用<code>Core Graphics</code>绘制的内容）</li>
<li>矩形是否使用圆角</li>
<li>矩形是否有阴影</li>
</ul>
<p><strong>感性认知：</strong><code>CALayer</code>本质上是一块包含一幅位图的缓冲区，由视图创建的层为<code>隐式层</code>，而手动创建的层称为<code>显示层</code>。<br><strong>种类：</strong><code>Layer</code>有很多种，最常用也是最基本的是<code>CALayer</code>，当然还包括其他的子类</p>
<ul>
<li><code>CAScrollerLayer</code> 简化显示层的一部分</li>
<li><code>CATextLayer</code> 文本层</li>
<li><code>CAGradientLayer</code>、<code>CAShapeLayer</code>等等</li>
</ul>
</blockquote>
<h4 id="2-15-1-1-原生控件使用CALayer"><a href="#2-15-1-1-原生控件使用CALayer" class="headerlink" title="2.15.1.1    原生控件使用CALayer"></a>2.15.1.1    原生控件使用<code>CALayer</code></h4><blockquote>
<p><strong>说明：</strong>在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.11.53.png" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initImageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置原生控件的CALayer（以 UIImageView 为例）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initImageView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>]];</span><br><span class="line">    imgView.frame = <span class="built_in">CGRectMake</span>((kScreenWidth - <span class="number">200</span>) / <span class="number">2</span>, (kScreenHeight - <span class="number">200</span>) / <span class="number">2</span>, <span class="number">200</span>, <span class="number">200</span>);<span class="comment">// 设置frame</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imgView];<span class="comment">// 将 UIImageView 添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 UIImageView 的根 CGLayer</span></span><br><span class="line">    <span class="comment">// 1. 设置阴影</span></span><br><span class="line">    imgView.layer.shadowColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;<span class="comment">// 设置阴影颜色</span></span><br><span class="line">    imgView.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);<span class="comment">// 设置阴影的偏移</span></span><br><span class="line">    imgView.layer.shadowOpacity = <span class="number">0.5</span>;<span class="comment">// 设置阴影的不透明</span></span><br><span class="line">    <span class="comment">// 2. 设置圆角</span></span><br><span class="line">    imgView.layer.cornerRadius = <span class="number">10</span>;<span class="comment">// 设置圆角半径</span></span><br><span class="line">    imgView.layer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 强制内部的所有子层支持圆角效果，少了这个设置，UIImageView是不会有圆角效果的。设置之后，没有阴影效果。</span></span><br><span class="line">    <span class="comment">// 3. 设置边框</span></span><br><span class="line">    imgView.layer.borderWidth = <span class="number">5</span>;</span><br><span class="line">    imgView.layer.borderColor = [<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">    <span class="comment">// 4. 设置旋转：利用 transform 属性可以设置旋转、缩放等效果</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 顺时针旋转45度</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 缩小0.5倍</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [imgView.layer setValue:@(2) forKey:@"transform.scale.x"];// 使用KVC方式</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-15-1-2-自定义CALayer"><a href="#2-15-1-2-自定义CALayer" class="headerlink" title="2.15.1.2    自定义CALayer"></a>2.15.1.2    自定义CALayer</h4><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>建子类继承<code>CALayer</code>，实现 <code>drawInContext：</code>方法</li>
<li>在控制器中设置代理，实现代理方法来画图层</li>
</ul>
</blockquote>
<h5 id="方式一：继承CALayer"><a href="#方式一：继承CALayer" class="headerlink" title="方式一：继承CALayer"></a>方式一：继承CALayer</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.26.12.png" alt="Alt text"></p>
<p><em>MyCALayer.h</em></p>
<blockquote>
<p><strong>说明：</strong>继承<code>CALayer</code><br><strong>注意：</strong>需要在项目的<code>info.plist</code>中导入<code>QuartzCore</code>库</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyCALyer</span> : <span class="title">CALayer</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>MyCALayer.m</em></p>
<blockquote>
<p><strong>说明：</strong>需要重写<code>drawInContext</code>方法，该方法在视图变动时通过<code>setNeededDisplay</code>被自动调用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyCALyer</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  该方法中完成对图层的绘制</span><br><span class="line"> *</span><br><span class="line"> *  @param ctx 图形上下文</span><br><span class="line"> */</span></span><br><span class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));<span class="comment">// 椭圆</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 实心绘制</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>在控制器中使用这个自定义的<code>MyLayer</code>，将图层实例添加到视图中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> myLayerExample];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例自定义 CALayer 的使用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)myLayerExample</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建自定义 layer 实例</span></span><br><span class="line">    My<span class="built_in">CALyer</span> *layer = [My<span class="built_in">CALyer</span> layer];</span><br><span class="line">    <span class="comment">// 设置该 layer 实例</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 绘制该layer</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 调用该方法，layer 的 drawInContext 方法才会被调用</span></span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：实现代理当法"><a href="#方式二：实现代理当法" class="headerlink" title="方式二：实现代理当法"></a>方式二：实现代理当法</h5><blockquote>
<p><strong>说明：</strong>和方式一一样要创建<code>CALayer</code>的子类，但不用实现<code>drawInContext</code>方法，而是设置代理对象（可以是任何类的实例），绘制的过程由代理对象重写<code>drawInContext</code>方法来实现。<br><em>JKLayer.h</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKLayer</span> : <span class="title">CALayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKLayer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKLayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    JKLayer *layer = [JKLayer layer];</span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;<span class="comment">// 不用采纳额外协议，任何对象可以作为代理对象</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 必须调用这个方法，代理对象的 drawLayer方法 才会显被调用</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到父图层</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 代理方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  修改当前ViewController的根Layer</span><br><span class="line"> *  @param layer 图层</span><br><span class="line"> *  @param ctx   绘制上下文</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-2-CAAnimation-动画"><a href="#2-15-2-CAAnimation-动画" class="headerlink" title="2.15.2    CAAnimation 动画"></a>2.15.2    CAAnimation 动画</h3><blockquote>
<p><strong>说明：</strong>基本动画、关键帧动画、组动画</p>
</blockquote>
<table>
<thead>
<tr>
<th>基本动画类型</th>
<th>说明</th>
<th>父类</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CABasicAnimation</code></td>
<td>基础动画</td>
<td>属性动画</td>
<td>平移、旋转、缩放</td>
</tr>
<tr>
<td><code>CAKeyframeAnimation</code></td>
<td>关键帧动画</td>
<td>属性动画</td>
<td>按照某种自定义路径移动</td>
</tr>
<tr>
<td><code>CATransition</code></td>
<td>转场动画</td>
<td><code>CAAnimation</code></td>
<td>不同layer之间的切换</td>
</tr>
<tr>
<td><code>CAAnimationGroup</code></td>
<td>组动画</td>
<td><code>CAAnimation</code></td>
<td>将几个不同的动画放在同一个组里</td>
</tr>
</tbody>
</table>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *layer;<span class="comment">// 用于演示动画的图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 创建图层</span></span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.position = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.backgroundColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;</span><br><span class="line">    <span class="comment">// 添加图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">    <span class="keyword">self</span>.layer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">// [self animationScale];</span></span><br><span class="line">    <span class="comment">// [self animationTranslate];</span></span><br><span class="line">    <span class="comment">// [self animationRotation];</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 基本动画(CABasicAnimation)</span></span><br><span class="line"><span class="comment">// 缩放</span></span><br><span class="line">- (<span class="keyword">void</span>)animationScale</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置 动画</span></span><br><span class="line">    <span class="comment">// keyPath ：决定了基本动画的类型</span></span><br><span class="line">    animation.keyPath = <span class="string">@"bounds"</span>;</span><br><span class="line">    <span class="comment">// toValue 到达哪个点，byValue 增加多少值, fromValue 从哪个点开始移动</span></span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];<span class="comment">// toValue ：到达哪个点</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;<span class="comment">// 动画持续时间</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;<span class="comment">// 动画完毕之后不删除动画（即，可以再次触发）</span></span><br><span class="line">    animation.fillMode = <span class="string">@"forwords"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画到图层</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平移</span></span><br><span class="line">- (<span class="keyword">void</span>)animationTranslate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forwards"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)animationRotation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"transform"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forward"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 关键帧动画</span></span><br><span class="line"><span class="comment">// 让图层做一个圆形移动</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *animation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = k<span class="built_in">CAFillModeForwards</span>;<span class="comment">// 保持最新的状态</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();<span class="comment">// 创建一个可变路径</span></span><br><span class="line">    <span class="built_in">CGPathAddEllipseInRect</span>(path, <span class="literal">NULL</span>, <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>));<span class="comment">// 画一个圆</span></span><br><span class="line">    animation.path = path;<span class="comment">// 设置动画路径</span></span><br><span class="line">    <span class="comment">// CGPathRelease(path);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置动画的执行节奏</span></span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.delegate = <span class="keyword">self</span>;<span class="comment">// 也可以将动画设置工作交给代理对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 组动画</span></span><br><span class="line"><span class="comment">// 组动画</span></span><br><span class="line">- (<span class="keyword">void</span>)animationGroup</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建组动画对象</span></span><br><span class="line">    <span class="comment">// CAAnimationGroup *animationGroup = [CAAnimationGroup animation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建多个动画，添加到组动画（数组）中</span></span><br><span class="line">    <span class="comment">// animationGroup.animations = @[];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    <span class="comment">// [self.layer addAnimation:animationGroup forKey:nil];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-3-转场动画"><a href="#2-15-3-转场动画" class="headerlink" title="2.15.3    转场动画"></a>2.15.3    转场动画</h3><blockquote>
<p><strong>说明：</strong>本课时讲解核心动画的两个子类即<code>转场动画</code>和<code>组动画</code>，并介绍了转场动画的私有 API ，全面理解 <code>CAAnimation</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_animation.gif" alt="Alt text|200x200"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 转场动画</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)exchangeView &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"pageCurl"</span>;<span class="comment">// 翻页效果：私有API的动画类型</span></span><br><span class="line">    animation.subtype = k<span class="built_in">CATransitionFromRight</span>;<span class="comment">// 翻页方向</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 实施动画</span></span><br><span class="line">    [_animView exchangeSubviewAtIndex:<span class="number">0</span> withSubviewAtIndex:<span class="number">1</span>];</span><br><span class="line">    [_animView.layer addAnimation:animation forKey:<span class="string">@"myAnimation"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)pushAction &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"cube"</span>;<span class="comment">// 立体翻转</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 将动画添加到导航控制器视图图层</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController.view.layer addAnimation:animation forKey:<span class="string">@"navAnimation"</span>];</span><br><span class="line">    <span class="comment">// 4. 实施动画</span></span><br><span class="line">    DetailViewController *detailVC = [[DetailViewController alloc] init];<span class="comment">// 创建要导航到的视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController showViewController:detailVC sender:<span class="literal">nil</span>];<span class="comment">// 导航到目标视图控制器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-15-4-实例动画按钮布局"><a href="#2-15-4-实例动画按钮布局" class="headerlink" title="2.15.4    实例动画按钮布局"></a>2.15.4    实例动画按钮布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解转盘动画实例，进行效果展示并完成 <code>UI</code> 布局，介绍了裁剪图片的新方法。</p>
<ol>
<li>导入资源</li>
<li>创建轮盘类（<code>WheelView</code>，继承<code>UIView</code>）</li>
<li>创建轮盘类对应的<code>xib</code>文件</li>
</ol>
<p><strong>要点：</strong> 使用<code>CGImageCreateWithImageInRect</code>裁剪图片</p>
</blockquote>
<h3 id="2-15-5-CADisplayLink实现动画效果"><a href="#2-15-5-CADisplayLink实现动画效果" class="headerlink" title="2.15.5    CADisplayLink实现动画效果"></a>2.15.5    CADisplayLink实现动画效果</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>CADisplayLink</code> 实现动画效果，完善实例动画功能，复习了 <code>CABasicAnimation</code> 的属性和方法。</p>
<p><strong>要点：</strong>使用<code>CADisplayLink</code>通过刷新实现动画，<br><strong>注意：</strong>这里没有使用核心动画，因为它们在动画过程中响应点击的位置并没有真的发生变化。<code>CADisplayLink</code>就可以做到。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_wheel.gif" alt="Alt text"></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/" itemprop="url">
                  1 了解ios项目开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:54:40+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_1  了解ios项目开发/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-ios开发前准备"><a href="#1-1-ios开发前准备" class="headerlink" title="1.1    ios开发前准备"></a>1.1    ios开发前准备</h2><h3 id="1-1​-苹果公司介绍"><a href="#1-1​-苹果公司介绍" class="headerlink" title="1.1​    苹果公司介绍"></a>1.1​    苹果公司介绍</h3><blockquote>
<p><strong>重要事件</strong><br>1976年创立<br>1976年推出Apple 1<br>1977年推出Apple 2<br>1980年推出Apple 3<br>1983年推出Apple Lisa<br>1984年推出Macintosh<br>1991年推出PowerBook，2006年被MacBook系列取代<br>1993年推出Apple Newton掌上电脑（已死）</p>
<p><strong>苹果电脑</strong><br>1998年推出iMac<br>2005年推出Mac mini<br>2006年推出Mac Pro<br>2006年推出MacBook（已死）<br>2008年推出MacBook air</p>
<p><strong>苹果音乐播放器</strong><br>2001年推出ipod<br>2004年推出iPod Mini<br>2005年推出iPod nano、iPod Shuffle<br>2007年推出iPod Classic、iPod Touch</p>
<p><strong>苹果手机产品</strong><br>2007年推出iPhone<br>2008年推出iPhone 3G<br>2009年推出iPhone 3GS<br>2010年推出iPhone 4<br>2011年推出iPhone 4s<br>2012年推出iPhone 5<br>2013年推出iPhone 5s、iPhone 5c</p>
<p><strong>苹果公司平板电脑</strong><br>2010年推出iPad<br>2011年推出iPad2<br>2012年推出iPad Mini</p>
<p><strong>苹果电视</strong><br>2006年发布Apple TV</p>
</blockquote>
<h3 id="1-1-2-苹果Mac-OX-操作系统介绍"><a href="#1-1-2-苹果Mac-OX-操作系统介绍" class="headerlink" title="1.1.2  苹果Mac OX 操作系统介绍"></a>1.1.2  苹果Mac OX 操作系统介绍</h3><blockquote>
<p><strong>历史版本</strong><br>2001年从Macintosh电脑上分离出来成为OS X10.0<br>2001年推出OS X 10.1<br>2002年推出OS X 10.2、10.3<br>2005年推出OS X 10.4<br>2006年推出OS X 10.5<br>2008年推出OS X 10.6<br>2010年推出OS X 10.7(App Store)<br>2012年推出OS X 10.8<br>2013年推出OS X 10.9(后台程序省电优化、内存压缩技术)<br>2014年推出OS X 10.10</p>
<p><strong>OS X系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260954919.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-3-苹果ios操作系统"><a href="#1-1-3-苹果ios操作系统" class="headerlink" title="1.1.3    苹果ios操作系统"></a>1.1.3    苹果ios操作系统</h3><blockquote>
<p><strong>历史版本</strong><br>2007年发布iPhone Runs OS X<br>2008年改名为iPhone OS<br>2010年改名为ios，发布ios4（多任务）<br>2011年发布ios5<br>2012年发布ios6<br>2013年发布ios7(扁平化)<br>2014年发布ios8</p>
<p><strong>ios系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260989517.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-4-软硬件开发环境要求"><a href="#1-1-4-软硬件开发环境要求" class="headerlink" title="1.1.4    软硬件开发环境要求"></a>1.1.4    软硬件开发环境要求</h3><blockquote>
<p><strong>硬件环境</strong><br>CPU双核<br>内存8G<br>最好选择Macbook Pro,也可以使用Macbook Air<br>测试手机iPhone 5+(发布)</p>
<p><strong>环境要求</strong><br>OS X 10.9.3+<br>Xcode 6.0+</p>
</blockquote>
<h2 id="1-2-Xcode继承开发环境的安装使用与项目建立流程"><a href="#1-2-Xcode继承开发环境的安装使用与项目建立流程" class="headerlink" title="1.2    Xcode继承开发环境的安装使用与项目建立流程"></a>1.2    Xcode继承开发环境的安装使用与项目建立流程</h2><h3 id="1-2-1-xcode的下载和安装"><a href="#1-2-1-xcode的下载和安装" class="headerlink" title="1.2.1    xcode的下载和安装"></a>1.2.1    xcode的下载和安装</h3><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>AppStore</li>
<li>开发者中心下载链接：<a href="https://developer.apple.com/xcode/downloads" target="_blank" rel="external">https://developer.apple.com/xcode/downloads</a></li>
</ul>
</blockquote>
<h3 id="1-2-2-xcode创建ios-single-view项目"><a href="#1-2-2-xcode创建ios-single-view项目" class="headerlink" title="1.2.2    xcode创建ios single view项目"></a>1.2.2    xcode创建ios single view项目</h3><h3 id="1-2-3-工作空间创建和使用"><a href="#1-2-3-工作空间创建和使用" class="headerlink" title="1.2.3    工作空间创建和使用"></a>1.2.3    工作空间创建和使用</h3><h3 id="1-2-4-xcode快捷键及常用功能"><a href="#1-2-4-xcode快捷键及常用功能" class="headerlink" title="1.2.4    xcode快捷键及常用功能"></a>1.2.4    xcode快捷键及常用功能</h3><blockquote>
<p><strong>常用</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>option + cmd + 向上箭头</td>
<td>m/h文件切换</td>
</tr>
<tr>
<td>ctrl + a</td>
<td>光标移动到行头</td>
</tr>
<tr>
<td>ctrl + e</td>
<td>光标移动到行末</td>
</tr>
<tr>
<td>command + G</td>
<td>查找下一个</td>
</tr>
<tr>
<td>command + w</td>
<td>关闭一个文件</td>
</tr>
<tr>
<td>option + command + m</td>
<td>窗口最小化</td>
</tr>
<tr>
<td>command + /</td>
<td>注释</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>调试</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>alt + command + y</td>
<td>degug 调试</td>
</tr>
<tr>
<td>alt + command + R</td>
<td>Run运行</td>
</tr>
<tr>
<td>alt + command + p</td>
<td>到下一个断点</td>
</tr>
<tr>
<td>shift + cmd + o</td>
<td>执行下一步(step over)</td>
</tr>
<tr>
<td>shift + cmd + i</td>
<td>执行进入函数(step into)</td>
</tr>
<tr>
<td>shift + cmd + t</td>
<td>step out</td>
</tr>
<tr>
<td>command + /</td>
<td>取消断点</td>
</tr>
<tr>
<td>command + shift + F</td>
<td>查找</td>
</tr>
<tr>
<td>command + enter</td>
<td>等于bulid and debug</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>移动</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>control＋F</td>
<td>在同一行上将光标向右移动</td>
</tr>
<tr>
<td>control＋B</td>
<td>在同一行上将光标向左移动</td>
</tr>
<tr>
<td>control＋P</td>
<td>将光标移动到前一行</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到后一行</td>
</tr>
<tr>
<td>control＋A</td>
<td>将光标移动到本行的行首</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到本行的行尾</td>
</tr>
<tr>
<td>control＋T</td>
<td>将光标两边的字符对调</td>
</tr>
<tr>
<td>control＋D</td>
<td>删除光标右边的字符</td>
</tr>
<tr>
<td>control＋k 删除光标所在行 光标后面的代码，便于你重写行尾代码</td>
</tr>
<tr>
<td>control + L</td>
<td>将光标插点置于窗口正中</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>缩进</strong></p>
<ul>
<li>第一种方法：选中需要缩进的代码，按住control键后单击光标，出现pop菜单，然后选择Re-indent selection。</li>
<li>第二种方法：选择需要调整的代码，同时按下<code>command＋［ （左移动代码）</code>或 <code>command＋］（右移动代码）</code>。</li>
</ul>
</blockquote>
<h3 id="1-2-5-xcode中创建os-x命令行控制台项目"><a href="#1-2-5-xcode中创建os-x命令行控制台项目" class="headerlink" title="1.2.5    xcode中创建os x命令行控制台项目"></a>1.2.5    xcode中创建os x命令行控制台项目</h3><h3 id="1-2-6-xcode中创建os-x窗体程序项目"><a href="#1-2-6-xcode中创建os-x窗体程序项目" class="headerlink" title="1.2.6    xcode中创建os x窗体程序项目"></a>1.2.6    xcode中创建os x窗体程序项目</h3><h3 id="1-2-7-xcode中创建os-x游戏项目"><a href="#1-2-7-xcode中创建os-x游戏项目" class="headerlink" title="1.2.7    xcode中创建os x游戏项目"></a>1.2.7    xcode中创建os x游戏项目</h3><h3 id="1-2-8-xcode中创建ios游戏项目"><a href="#1-2-8-xcode中创建ios游戏项目" class="headerlink" title="1.2.8    xcode中创建ios游戏项目"></a>1.2.8    xcode中创建ios游戏项目</h3><h2 id="1-3-Xcode常用项目模版"><a href="#1-3-Xcode常用项目模版" class="headerlink" title="1.3    Xcode常用项目模版"></a>1.3    Xcode常用项目模版</h2><blockquote>
<p><strong>说明：</strong><code>5</code>种</p>
<ul>
<li>Master-Detail Application：<code>列表页-详情页</code>类型</li>
<li>Page-Based Application：<code>电子书</code>类型</li>
<li>Single View Application：</li>
<li>Tabbed Application</li>
<li>Game</li>
</ul>
</blockquote>
<h3 id="1-3-1-Master-Detail-Application"><a href="#1-3-1-Master-Detail-Application" class="headerlink" title="1.3.1    Master-Detail Application"></a>1.3.1    Master-Detail Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.26.53.png" alt="Alt text"></p>
<h3 id="1-3-2-Page-Based-Application"><a href="#1-3-2-Page-Based-Application" class="headerlink" title="1.3.2    Page-Based Application"></a>1.3.2    Page-Based Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.38.45.png" alt="Alt text"></p>
<h3 id="1-3-3-Tabbed-Application"><a href="#1-3-3-Tabbed-Application" class="headerlink" title="1.3.3    Tabbed Application"></a>1.3.3    Tabbed Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.56.30.png" alt="Alt text"></p>
<h2 id="1-4-ios用户界面开发基本流程"><a href="#1-4-ios用户界面开发基本流程" class="headerlink" title="1.4    ios用户界面开发基本流程"></a>1.4    ios用户界面开发基本流程</h2><h3 id="1-4-1-StoryBoard的基本使用方法"><a href="#1-4-1-StoryBoard的基本使用方法" class="headerlink" title="1.4.1    StoryBoard的基本使用方法"></a>1.4.1    StoryBoard的基本使用方法</h3><blockquote>
<p><strong>说明：</strong><code>Storybiard(故事版)</code>是<code>Xcode4.2</code>才开始支持的，为了使设计<code>View</code>更加容易。</p>
</blockquote>
<ul>
<li>可以在<code>Info.plist</code>文件中设置应用启动时首次加载的<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%885.08.53.png" alt="Alt text"></li>
<li>一个应用中可以有多个<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8810.48.12.png" alt="Alt text"></li>
<li><code>storyboard</code>中指出了首先会被加载的<code>view</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.42.10.png" alt="Alt text"></li>
<li>查看视图控制器绑定的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.48.33.png" alt="Alt text"></li>
<li>在多个视图之间建立动作关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-storyboard-1.gif" alt="Alt text"></li>
</ul>
<h3 id="1-4-2-图片控件"><a href="#1-4-2-图片控件" class="headerlink" title="1.4.2    图片控件"></a>1.4.2    图片控件</h3><blockquote>
<p><strong>说明：</strong>在<code>xcode</code>中图片控件的创建和使用</p>
</blockquote>
<ol>
<li>将本地的图片拖入到项目中<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img.gif" alt="Alt text"></li>
<li>创建<code>Image View</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img-02.gif" alt="Alt text"></li>
</ol>
<h3 id="1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码"><a href="#1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码" class="headerlink" title="1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码"></a>1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码</h3><blockquote>
<p><strong>说明：</strong><code>程序</code>和<code>控件</code>的绑定，有两种方式</p>
</blockquote>
<h4 id="方式1：ios-UI界面设计中传统方法"><a href="#方式1：ios-UI界面设计中传统方法" class="headerlink" title="方式1：ios UI界面设计中传统方法"></a>方式1：ios UI界面设计中传统方法</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>在<code>Controller</code>中定义<code>@IBOutlet</code>修饰的引用控件的属性</li>
<li>通过拖动建立<code>@IBOutlet</code>引用的控件和属性所在类文件之间的关联</li>
<li>在<code>Controller</code>中通过<code>@IBOutlet</code>属性使用控件</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bind.gif" alt="Alt text"></p>
</blockquote>
<h4 id="方式2：借助Assistant-editor绑定代码"><a href="#方式2：借助Assistant-editor绑定代码" class="headerlink" title="方式2：借助Assistant editor绑定代码"></a>方式2：借助<code>Assistant editor</code>绑定代码</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>打开辅助窗口</li>
<li>拖线</li>
<li>设置关联</li>
<li>connect</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bond2.gif" alt="Alt text"></p>
</blockquote>
<h3 id="1-4-4-ios-Story-Board控制事件绑定"><a href="#1-4-4-ios-Story-Board控制事件绑定" class="headerlink" title="1.4.4    ios Story Board控制事件绑定"></a>1.4.4    ios Story Board控制事件绑定</h3><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>编写<code>@IBAction</code></li>
<li>在<code>storyboard</code>中通过拖动在控件与<code>controller</code>中相应的<code>IBAction</code>之间建立关联</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-event.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 和按钮建立关联的点击事件响应函数</span></span><br><span class="line">    @IBAction func btnClicked(sender:AnyObject) &#123;</span><br><span class="line">        print(<span class="string">"clicked"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-5-iOS-Storyboard控件与Swift类绑定"><a href="#1-4-5-iOS-Storyboard控件与Swift类绑定" class="headerlink" title="1.4.5    iOS Storyboard控件与Swift类绑定"></a>1.4.5    iOS Storyboard控件与Swift类绑定</h3><blockquote>
<p><strong>说明：</strong>新添加的<code>Storyboard</code>控件默认并没有和自定义的类绑定，和自定义的类绑定就可以通过代码自定义该控件</p>
<ol>
<li>设置绑定的类的类名<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-09%20%E4%B8%8B%E5%8D%8811.53.07.png" alt="Alt text"></li>
<li>对应的自定义类中要实现父类的必要构造器（如果有的话）</li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 必须重写该 必要构造器</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-6-ios源代码添加控件"><a href="#1-4-6-ios源代码添加控件" class="headerlink" title="1.4.6    ios源代码添加控件"></a>1.4.6    ios源代码添加控件</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	...</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个控件</span></span><br><span class="line">        var label = <span class="built_in">UILabel</span>(frame: <span class="built_in">CGRect</span>(x: <span class="number">50</span>, y: <span class="number">50</span>, width: <span class="number">200</span>, height: <span class="number">100</span>))</span><br><span class="line">        <span class="comment">// 设置控件</span></span><br><span class="line">        label.text = <span class="string">"Hello jikexueyuan"</span></span><br><span class="line">        <span class="comment">// 将控件添加到视图</span></span><br><span class="line">        view.addSubview(label)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<h3 id="1-4-7-ios浏览器开发制作"><a href="#1-4-7-ios浏览器开发制作" class="headerlink" title="1.4.7    ios浏览器开发制作"></a>1.4.7    ios浏览器开发制作</h3><blockquote>
<p><strong>说明：</strong>需要解决<code>http</code>请求受限的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.55.08.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.54.48.png" alt="Alt text"><br><img src="./屏幕快照 2016-02-10 上午1.59.15.png" alt="Alt text"></p>
<h2 id="1-5-ios自定义控件实例"><a href="#1-5-ios自定义控件实例" class="headerlink" title="1.5    ios自定义控件实例"></a>1.5    ios自定义控件实例</h2><h3 id="1-5-1-配置iOS自定义控件属性"><a href="#1-5-1-配置iOS自定义控件属性" class="headerlink" title="1.5.1    配置iOS自定义控件属性"></a>1.5.1    配置iOS自定义控件属性</h3><blockquote>
<p><strong>说明：</strong><code>Xcode</code>提供的所有控件都可以在<code>Storyboard</code>中进行一系列的配置。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%886.02.15.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-button.gif" alt="Alt text"></p>
<h3 id="1-5-2-自定义原型进度指示控件实例"><a href="#1-5-2-自定义原型进度指示控件实例" class="headerlink" title="1.5.2    自定义原型进度指示控件实例"></a>1.5.2    自定义原型进度指示控件实例</h3><blockquote>
<p><strong>说明：</strong>使用绘图<code>API</code>编写自定义一个进度条控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%8811.38.03.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
</blockquote>
<p><code>ProgressBar.swift</code></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ProgressBar: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">        <span class="comment">// 设置背景透明</span></span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = <span class="built_in">UIColor</span>(white: <span class="number">1</span>, alpha: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进度值</span></span><br><span class="line">    private var _progressValue: <span class="built_in">CGFloat</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意：不可以在某个实体中定义访问级别更高的实体</span></span><br><span class="line">    internal func getProgressValue() -&gt; <span class="built_in">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> _progressValue</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    internal func setProgressValue (value: <span class="built_in">CGFloat</span>) &#123;</span><br><span class="line">        _progressValue = value</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 改变值后需要重绘</span></span><br><span class="line">        setNeedsDisplay()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 控件绘制函数</span></span><br><span class="line">    <span class="comment">// Only override drawRect: if you perform custom drawing.</span></span><br><span class="line">    <span class="comment">// An empty implementation adversely affects performance during animation.</span></span><br><span class="line">    override func drawRect(rect: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="comment">// Drawing code</span></span><br><span class="line">        <span class="comment">// 获得当前图形绘制的上下文</span></span><br><span class="line">        let ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="comment">// 半径</span></span><br><span class="line">        let r = rect.width / <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 绘制圆</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 设置圆的填充色：灰色、不透明</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加一段弧形弧形</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span> * _progressValue , <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 添加一条线</span></span><br><span class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, r, r)</span><br><span class="line">        <span class="comment">// 设置扇形的填充色</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 绘制</span></span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var pc: ProgressBar!</span><br><span class="line">    <span class="comment">// 响应AddProgress点击</span></span><br><span class="line">    @IBAction func addProgressBtnPressed(sender: AnyObject) &#123;</span><br><span class="line">        pc.setProgressValue(pc.getProgressValue() + <span class="number">0.1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="comment">// 创建进度条</span></span><br><span class="line">        pc = ProgressBar(frame: <span class="built_in">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">100</span>, height: <span class="number">100</span>))</span><br><span class="line">        pc.setProgressValue(<span class="number">0.2</span>)</span><br><span class="line">        <span class="comment">// 将该进度条添加到所在控制器绑定的视图中</span></span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(pc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override func didReceiveMemoryWarning() &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-实时预览自定义控件效果"><a href="#1-5-3-实时预览自定义控件效果" class="headerlink" title="1.5.3    实时预览自定义控件效果"></a>1.5.3    实时预览自定义控件效果</h3><blockquote>
<p><strong>说明：</strong><code>自定义控件</code>也可以使用<code>Storyboard</code>设置。步骤如下<br><strong>意义：</strong>开发人员通过代码开发的<code>自定义控件</code>，也可以交给设计人员通过<code>Storyboard</code>进行设计了<br><strong>相关指令：</strong>用来和<code>Storyboard</code>建立关联</p>
</blockquote>
<table>
<thead>
<tr>
<th>指令</th>
<th>修饰目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@IBDesignable</code></td>
<td><code>class</code></td>
<td>使被修饰的类可以通过<code>Storyboard</code>设置</td>
</tr>
<tr>
<td><code>@IBInspectable</code></td>
<td>属性</td>
<td>使被修饰的属性可以在<code>Storyboard</code>中设置</td>
</tr>
</tbody>
</table>
<ol>
<li>在<code>Project</code>中创建新<code>target</code>（自定义需要在单独的<code>target</code>中才能被<code>Storyboard</code>管理）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-custom.gif" alt="Alt text"></li>
<li>在新创建的<code>target</code>中创建自定义控件的类（<code>@IBDesignable</code>），类中可以设置一些可在<code>Storyboard</code>设置的属性（<code>@IBInspectable</code>）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.13.21.png" alt="Alt text"></li>
</ol>
<p><em>MyView.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">@IBDesignable class MyView: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写必要构造器（否则不会被Storyboard初始化）</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义一些可以在Storyboard中设置的项</span></span><br><span class="line">    @IBInspectable var str: String = <span class="string">"Hello"</span><span class="comment">// 字符串</span></span><br><span class="line">    @IBInspectable var borderWidth: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框宽度</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderWidth = borderWidth</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var borderColor: <span class="built_in">UIColor</span> = <span class="built_in">UIColor</span>.clearColor() &#123;<span class="comment">// 边框颜色</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderColor = borderColor.CGColor</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var cornerRadius: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框圆角</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.cornerRadius = cornerRadius</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>Storyboard</code>中添加一个<code>View</code>（控件），并设置关联的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.04.07.png" alt="Alt text"></li>
</ol>
<h2 id="1-6-使用StoryBoard做ios-UI界面跳转"><a href="#1-6-使用StoryBoard做ios-UI界面跳转" class="headerlink" title="1.6    使用StoryBoard做ios UI界面跳转"></a>1.6    使用StoryBoard做ios UI界面跳转</h2><h3 id="1-6-1-用iOS-Storyboard做界面跳转"><a href="#1-6-1-用iOS-Storyboard做界面跳转" class="headerlink" title="1.6.1    用iOS Storyboard做界面跳转"></a>1.6.1    用iOS Storyboard做界面跳转</h3><blockquote>
<p><strong>说明：</strong>跳转到下一个<code>view</code>并且能够返回<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_switch.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-6-1-2-跳转到下一页"><a href="#1-6-1-2-跳转到下一页" class="headerlink" title="1.6.1.2    跳转到下一页"></a>1.6.1.2    跳转到下一页</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_next.gif" alt="Alt text"></p>
<h4 id="1-6-1-3-返回"><a href="#1-6-1-3-返回" class="headerlink" title="1.6.1.3    返回"></a>1.6.1.3    返回</h4><blockquote>
<p><strong>说明：</strong>使用<code>IBAction</code>结合<code>dismissViewControllerAnimated</code>方法，步骤如下</p>
<ol>
<li>新建一个和第二个<code>view</code>关联的类（<code>UIViewController</code>子类）</li>
<li>结合<code>辅助窗口</code>在第二个<code>view controller</code>做<code>IBAction</code>并在响应方法中调用<code>dismissViewControllerAnimated</code><br><em>ImgViewController.swift</em></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ImgViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func backBtnClicked(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;() -&gt; Void <span class="keyword">in</span></span><br><span class="line">            print(<span class="string">"return"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// storyboard载入时调用的初始化方法</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-使用nib文件做iOS界面设计"><a href="#1-6-2-使用nib文件做iOS界面设计" class="headerlink" title="1.6.2    使用nib文件做iOS界面设计"></a>1.6.2    使用nib文件做iOS界面设计</h3><blockquote>
<p><strong>说明：</strong><code>Xcode4</code>之后<code>IB(Interface Builder)</code>和<code>Xcode</code>才集成在一起。使用方式如下</p>
<ol>
<li><p>创建<code>Cocoa class</code>时勾选<code>Alse create XIB File</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8B%E5%8D%885.22.14.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.47.13.png" alt="Alt text"></p>
</li>
<li><p>使用<code>presentModalViewController方法</code>从<code>Storyboard</code>管理的<code>view</code>跳转到<code>nib</code>管理的<code>view</code></p>
</li>
</ol>
<p><strong>注意：</strong>传统使用的是<code>nib</code>（而不是<code>Storyboard</code>）进行界面设计的。<code>nib</code>的操作方式和<code>Storyboard</code>中单个<code>view</code>类似。</p>
</blockquote>
<hr>
<p><em>ViewControllew.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.58.26.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 下一个view</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>MyViewController.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.59.55.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-在iOS界面间传递数据"><a href="#1-6-3-在iOS界面间传递数据" class="headerlink" title="1.6.3    在iOS界面间传递数据"></a>1.6.3    在iOS界面间传递数据</h3><blockquote>
<p><strong>说明：</strong>本质上只是为和下一个<code>view</code>绑定的<code>controller</code>设置一个属性。<br><strong>扩展：</strong>也可以在后一个<code>view</code>通过<code>parentViewController</code>访问前一个<code>view</code></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.16.29.png" alt="Alt text"></p>
<p><em>ViewControllew.swift：设置信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输入框</span></span><br><span class="line">    @IBOutlet var input: <span class="built_in">UITextField</span>!</span><br><span class="line">    <span class="comment">// 下一页</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 设置信息</span></span><br><span class="line">        vc.labelContent = input.text!</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>MyViewControllew.swift：展示信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    var labelContent: String = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var myLabel: <span class="built_in">UILabel</span>!</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        myLabel.text = labelContent<span class="comment">// 展示信息</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-7-屏幕适配"><a href="#1-7-屏幕适配" class="headerlink" title="1.7    屏幕适配"></a>1.7    屏幕适配</h2><blockquote>
<p><strong>变动：</strong>在<code>Xcode 7</code>中，<code>Editor(menu)-&gt;Pin</code>消失了，该菜单项中原本有一些样式设计功能。</p>
</blockquote>
<h3 id="1-7-1-匹配父级容器"><a href="#1-7-1-匹配父级容器" class="headerlink" title="1.7.1    匹配父级容器"></a>1.7.1    匹配父级容器</h3><blockquote>
<p><strong>说明：</strong>就是让<code>目标容器</code>以他的<code>父级容器</code>为参照系进行设置<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.56.36.png" alt="Alt text"><br><strong>扩展：</strong>控件<code>UIImageVIew</code>可以设置其中图片的铺排模式<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-14%20%E4%B8%8A%E5%8D%8812.00.37.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-7-2-分割父级容器"><a href="#1-7-2-分割父级容器" class="headerlink" title="1.7.2    分割父级容器"></a>1.7.2    分割父级容器</h3><blockquote>
<p><strong>说明：</strong>指的是多个兄弟<code>view</code>使用父级<code>view</code>的方式。<br><strong>扩展：</strong><code>Xcode 7</code>推出了一种新的方式<code>stack view</code>，来进行布局管理，可以将多个<code>view</code>作为一个组合进行操作。<br><strong>技巧：</strong><code>stack view</code>可以取代之前需要<code>Horizontal Space</code>（连个<code>view</code>之间的水平间距）的场景</p>
</blockquote>
<h4 id="1-7-2-1-左边固定，右边自适应"><a href="#1-7-2-1-左边固定，右边自适应" class="headerlink" title="1.7.2.1    左边固定，右边自适应"></a>1.7.2.1    左边固定，右边自适应</h4><blockquote>
<p><strong>约束：</strong>设置以下约束</p>
<ul>
<li>两个<code>View</code>之间：<code>Horizontal Spacing</code></li>
<li>左边<code>View</code>：<code>leading</code>、<code>top</code></li>
<li>右边<code>View</code>：<code>tailing</code>、<code>top</code></li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.12.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%888.00.01.png" alt="Alt text"></p>
<h4 id="1-7-2-2-多个View按比例"><a href="#1-7-2-2-多个View按比例" class="headerlink" title="1.7.2.2    多个View按比例"></a>1.7.2.2    多个<code>View</code>按比例</h4><blockquote>
<p><strong>说明：</strong>2个或更多个<code>View</code>的宽度（或高度）按一定比例分割父级容器的剩余空间<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8A%E5%8D%889.51.01.png" alt="Alt text"></p>
</blockquote>
<p><img src="./http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.27.png" alt="Alt text"></p>
<h3 id="1-7-3-复杂布局适配"><a href="#1-7-3-复杂布局适配" class="headerlink" title="1.7.3    复杂布局适配"></a>1.7.3    复杂布局适配</h3><blockquote>
<p><strong>说明：</strong>上部左右均分，下部占用剩余部分<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.53.19.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%886.05.43.png" alt="Alt text"> </p>
</blockquote>
<p><em>底层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.58.22.png" alt="Alt text"></p>
<p><em>顶层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%889.41.32.png" alt="Alt text"></p>
<h2 id="1-8-iOS平台常用传感器"><a href="#1-8-iOS平台常用传感器" class="headerlink" title="1.8    iOS平台常用传感器"></a>1.8    iOS平台常用传感器</h2><h4 id="CMMotionManager类"><a href="#CMMotionManager类" class="headerlink" title="CMMotionManager类"></a>CMMotionManager类</h4><blockquote>
<p><strong>说明：</strong>管理传感器的类。<br><strong>库：</strong><code>CoreMotion</code></p>
</blockquote>
<h3 id="1-8-1-iOS平台加速度传感器的使用方式"><a href="#1-8-1-iOS平台加速度传感器的使用方式" class="headerlink" title="1.8.1    iOS平台加速度传感器的使用方式"></a>1.8.1    iOS平台加速度传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>可以获得三个方向上的加速度。</p>
</blockquote>
<table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>accelerometerAvailable</td>
<td>Bool</td>
<td>加速器是否可用</td>
</tr>
<tr>
<td>accelerometerUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startAccelerometerUpdatesToQueue</td>
<td>func</td>
<td>启动加速器</td>
</tr>
<tr>
<td>stopAccelerometerUpdates</td>
<td>func</td>
<td>停止加速器</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>加速度传感器<code>启动</code>后，应当在适当的时候<code>停掉</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取减速器数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 加速度 */</span></span><br><span class="line">        cmm.accelerometerUpdateInterval = <span class="number">1</span><span class="comment">// 每秒获取的次数</span></span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerAvailable &amp;&amp; !cmm.accelerometerActive &#123;</span><br><span class="line">            <span class="comment">// start后一定要stop</span></span><br><span class="line">            cmm.startAccelerometerUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMAccelerometerData</span>?, err:<span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"AccesslateData: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"加速器传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦测加速度</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerActive &amp;&amp; cmm.accelerometerActive &#123;</span><br><span class="line">            cmm.stopAccelerometerUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-2-iOS平台陀螺仪的使用方式"><a href="#1-8-2-iOS平台陀螺仪的使用方式" class="headerlink" title="1.8.2    iOS平台陀螺仪的使用方式"></a>1.8.2    iOS平台陀螺仪的使用方式</h3><table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>gyroAvailable</td>
<td>Bool</td>
<td>陀螺仪是否可用</td>
</tr>
<tr>
<td>gyroUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startGyroUpdatesToQueue</td>
<td>func</td>
<td>开始读区陀螺仪数据</td>
</tr>
<tr>
<td>stopGyroUpdates</td>
<td>func</td>
<td>停止读取陀螺仪数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取陀螺仪数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        cmm.gyroUpdateInterval = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroAvailable &amp;&amp; !cmm.gyroActive &#123;</span><br><span class="line">            cmm.startGyroUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMGyroData</span>?, err: <span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Gyno data: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"陀螺仪传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测陀螺仪</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroActive &amp;&amp; cmm.gyroActive &#123;</span><br><span class="line">            cmm.stopGyroUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-3-iOS平台距离传感器的使用方式"><a href="#1-8-3-iOS平台距离传感器的使用方式" class="headerlink" title="1.8.3    iOS平台距离传感器的使用方式"></a>1.8.3    iOS平台距离传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">     <span class="comment">/**</span><br><span class="line">     * 开始侦听距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().proximityMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听距离传感器</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="type">Selector</span>(<span class="string">"proximityChanged"</span>), name: <span class="type">UIDeviceProximityStateDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到proximityChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 距离变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">proximityChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().proximityState)"</span>)<span class="comment">// 距离传感器前是否有障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-4-iOS平台电源传感器的使用方式"><a href="#1-8-4-iOS平台电源传感器的使用方式" class="headerlink" title="1.8.4    iOS平台电源传感器的使用方式"></a>1.8.4    iOS平台电源传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().batteryMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听电量</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="string">"levelChanged"</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到levelChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 电量变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">levelChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().batteryLevel)"</span>)<span class="comment">// 0～1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 移除当前view中的所有电量侦听任务</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">	    stopListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-5-iOS平台磁场传感器的使用方式"><a href="#1-8-5-iOS平台磁场传感器的使用方式" class="headerlink" title="1.8.5    iOS平台磁场传感器的使用方式"></a>1.8.5    iOS平台磁场传感器的使用方式</h3><h4 id="CLLocationManager类"><a href="#CLLocationManager类" class="headerlink" title="CLLocationManager类"></a>CLLocationManager类</h4><table>
<thead>
<tr>
<th>相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>delegate</td>
<td>Class(采纳CLLocationManagerDelegate协议)</td>
<td>委托对象</td>
</tr>
<tr>
<td>startUpdatingHeading</td>
<td>func</td>
<td>开始侦测方位数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">CLLocationManagerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* 1. 声明方位管理器 */</span></span><br><span class="line">    <span class="keyword">var</span> lm:<span class="type">CLLocationManager</span>!</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="comment">/* 2. 初始化方位管理器 */</span></span><br><span class="line">        lm = <span class="type">CLLocationManager</span>()</span><br><span class="line">        lm.delegate = <span class="keyword">self</span><span class="comment">// 指定 delegate（需要采纳CLLocationManagerDelegate协议）</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 3. view渲染时启动侦测 */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 启动任务：不断获取指南针数据</span></span><br><span class="line">        lm.startUpdatingHeading()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 采纳协议（CLLocationManagerDelegate）</span><br><span class="line">    * 当方位发生变化时调用该方法</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">locationManager</span><span class="params">(manager: CLLocationManager, didUpdateHeading newHeading: CLHeading)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(newHeading)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-6-使用磁场传感器制作指南针实例"><a href="#1-8-6-使用磁场传感器制作指南针实例" class="headerlink" title="1.8.6    使用磁场传感器制作指南针实例"></a>1.8.6    使用磁场传感器制作指南针实例</h3><h2 id="1-9-多点触控"><a href="#1-9-多点触控" class="headerlink" title="1.9    多点触控"></a>1.9    多点触控</h2><h3 id="1-9-1-触摸事件处理"><a href="#1-9-1-触摸事件处理" class="headerlink" title="1.9.1    触摸事件处理"></a>1.9.1    触摸事件处理</h3><blockquote>
<p><strong>说明：</strong>触摸事件分4种，分别对应四种方法（<code>ViewController</code>的成员方法）</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>touchesBegin</td>
<td>手指接触屏幕</td>
</tr>
<tr>
<td>touchesCancel</td>
<td>系统事件打断了触摸事件时</td>
</tr>
<tr>
<td>touchesEnded</td>
<td>手指离开屏幕</td>
</tr>
<tr>
<td>touchesMoved</td>
<td>手指在屏幕上滑动</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesBegin"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        <span class="comment">// 获得在滑动屏幕时手指所在的区域的坐标（只获得了其中一个手指的）</span></span><br><span class="line">        touches.first?.locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesEnded</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesEnded"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesCancelled</span><span class="params">(touches: Set&lt;UITouch&gt;?, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesCancelled"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-2-处理多个触摸点"><a href="#1-9-2-处理多个触摸点" class="headerlink" title="1.9.2    处理多个触摸点"></a>1.9.2    处理多个触摸点</h3><blockquote>
<p><strong>技巧：</strong>可以在模拟器中模拟多点触控，方式是鼠标在模拟器上滑动式按住<code>alt(option)</code>键。<br><strong>注意：</strong>程序默认不启动对多点触控的支持，需要在代码中设置开启多点触控。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得触摸点数量</span></span><br><span class="line">        <span class="built_in">print</span>(touches.<span class="built_in">count</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得每个触摸点在滑动屏幕时所在的区域的坐标</span></span><br><span class="line">        <span class="keyword">for</span> touch <span class="keyword">in</span> touches &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(touch.locationInView(self.view))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-3-缩放图片实例"><a href="#1-9-3-缩放图片实例" class="headerlink" title="1.9.3    缩放图片实例"></a>1.9.3    缩放图片实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_touch.gif" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var lastDistance: Float = <span class="number">0.0</span><span class="comment">// 两个触摸点之间的距离</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var iv: <span class="built_in">UIImageView</span>!<span class="comment">// 图片控件</span></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesBegan(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        lastDistance = <span class="number">0.0</span><span class="comment">// 用户开始触摸屏幕时设置初始值</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesMoved(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        <span class="comment">// 判断是不是两点触控</span></span><br><span class="line">        <span class="keyword">if</span> touches.count == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="comment">// 对 Set 排序，才能通过下标进行索引</span></span><br><span class="line">            var touchesSorted = touches.sort(&#123;s1, s2 <span class="keyword">in</span> s1.tapCount.bigEndian &gt; s1.tapCount.bigEndian&#125;)</span><br><span class="line">            <span class="comment">// 通过勾股定理计算两点之间的距离</span></span><br><span class="line">            let p1 = touchesSorted[<span class="number">0</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let p2 = touchesSorted[<span class="number">1</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let xx = p1.x - p2.x</span><br><span class="line">            let yy = p1.y - p2.y</span><br><span class="line">            </span><br><span class="line">            let curDistance = Float(sqrt(xx * xx + yy * yy))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 首次缩放触摸操作</span></span><br><span class="line">            <span class="keyword">if</span> lastDistance == <span class="number">0.0</span> &#123;</span><br><span class="line">                lastDistance = curDistance</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 缩小</span></span><br><span class="line">                <span class="keyword">if</span> lastDistance - curDistance &gt; <span class="number">5</span> &#123;</span><br><span class="line">                    print(<span class="string">"缩小"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">0.9</span>, <span class="number">0.9</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 放大</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> lastDistance - curDistance &lt; <span class="number">-5</span>&#123;</span><br><span class="line">                    print(<span class="string">"放大"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">1.1</span>, <span class="number">1.1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-10-常用其它功能"><a href="#1-10-常用其它功能" class="headerlink" title="1.10    常用其它功能"></a>1.10    常用其它功能</h2><h3 id="1-10-1-打开网页"><a href="#1-10-1-打开网页" class="headerlink" title="1.10.1    打开网页"></a>1.10.1    打开网页</h3><blockquote>
<p><strong>说明：</strong>在<code>Safari</code>中打开指定连接<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S_call.gif" alt="Alt text"><br><strong>相关类：</strong><code>UIApplication</code></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">openJikexueyuanPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-2-常用打开操作（发邮件、打电话、发短信）"><a href="#1-10-2-常用打开操作（发邮件、打电话、发短信）" class="headerlink" title="1.10.2    常用打开操作（发邮件、打电话、发短信）"></a>1.10.2    常用打开操作（发邮件、打电话、发短信）</h3><blockquote>
<p><strong>说明：</strong>和打开网页类似，只是使用的<code>URL</code>协议不同</p>
</blockquote>
<p><em>ViewController.swift</em> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 发短信</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendSMSBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"sms://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 打电话</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCallBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"tel://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发邮件</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendMailBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"mailto://xx@jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-3-自定义打开协议"><a href="#1-10-3-自定义打开协议" class="headerlink" title="1.10.3    自定义打开协议"></a>1.10.3    自定义打开协议</h3><blockquote>
<p><strong>说明：</strong>可以通过自定一些<code>URL</code>协议<br><strong>案例：</strong>通过自定义的<code>URL</code>协议<code>ime</code>打开另一个<code>App</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_handler.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-10-3-1-注册协议的app"><a href="#1-10-3-1-注册协议的app" class="headerlink" title="1.10.3.1    注册协议的app"></a>1.10.3.1    注册协议的app</h4><ol>
<li><p>在<code>Info.list</code>中设置一个<code>URL Schemes</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-25%20%E4%B8%8B%E5%8D%889.42.43.png" alt="Alt text"></p>
</li>
<li><p>创建要被协议打开的<code>View</code>（带有<code>xib</code>）<br><em>LabelViewController.swift</em></p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> myLabel: <span class="type">UILabel</span>!</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>LabelViewController.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.55.25.png" alt="Alt text"></p>
<ol>
<li><code>AppDelegate.swift</code>：实现通过URL打开该<code>App</code>的构造函数</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// 为自定义的URL协议注册实现</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, handleOpenURL url: NSURL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// 从应用的LabelViewController.xib指定的view启动</span></span><br><span class="line">        <span class="keyword">let</span> vc = <span class="type">LabelViewController</span>(nibName: <span class="string">"LabelViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        window?.addSubview(vc.view)</span><br><span class="line">        <span class="comment">// 设置view</span></span><br><span class="line">        vc.myLabel.text = <span class="string">"\(url)"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-10-3-2-通过协议打开app"><a href="#1-10-3-2-通过协议打开app" class="headerlink" title="1.10.3.2    通过协议打开app"></a>1.10.3.2    通过协议打开app</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.58.00.png" alt="Alt text"></p>
<p><em>viewcontroller.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ime</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">callImePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"ime://i.loce.you?h=Hello&amp;b=world"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-4-获取photo"><a href="#1-10-4-获取photo" class="headerlink" title="1.10.4    获取photo"></a>1.10.4    获取photo</h3><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/" itemprop="url">
                  4 初级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:38:36+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-c语言"><a href="#4-1-c语言" class="headerlink" title="4.1    c语言"></a>4.1    c语言</h2><h3 id="4-1-1-指针"><a href="#4-1-1-指针" class="headerlink" title="4.1.1    指针"></a>4.1.1    指针</h3><blockquote>
<p><strong>说明：</strong><code>a</code>和<code>&amp;a</code>包含的地址相同，但含义不同</p>
<ul>
<li>a：数组的首地址，也就是 a[0]的地址</li>
<li>&amp;a：对象的首地址，也就是数组的地址</li>
</ul>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">main &#123;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">	<span class="comment">// a:相当于a[0]</span></span><br><span class="line">	<span class="comment">// &amp;a：数组的地址</span></span><br><span class="line">	<span class="comment">// (&amp;a + 1)：指针加1根据指针的类型增加的量不同，a是指向数组的指针，数组的大小为5个Int，因此(&amp;a + 1)指向a[5]（溢出）</span></span><br><span class="line">	<span class="comment">// *(ptr - 1)：因为ptr指向的是元素，因此*(ptr - 1)为a[4]</span></span><br><span class="line">	<span class="keyword">int</span> *ptr = (int *)(&amp;a + <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d, %d"</span>, *(a + <span class="number">1</span>), *(ptr - <span class="number">1</span>));<span class="comment">// 2, 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-Object-C笔试"><a href="#4-2-Object-C笔试" class="headerlink" title="4.2    Object-C笔试"></a>4.2    Object-C笔试</h2><h3 id="4-2-1-写一个NSString类的实现"><a href="#4-2-1-写一个NSString类的实现" class="headerlink" title="4.2.1     写一个NSString类的实现"></a>4.2.1     写一个NSString类的实现</h3><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法：初始化</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法（工厂方法）</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">* @return &#123;&#125; 实例</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *obj;</span><br><span class="line">	<span class="comment">// 分配内存</span></span><br><span class="line">	obj = [slef allocWithZero: <span class="built_in">NSDefaultMallocZone</span>()];</span><br><span class="line">	<span class="comment">// 初始化</span></span><br><span class="line">	obj = [obj initWithCString: nullTerminatedCString encodign: encoding];</span><br><span class="line">	<span class="keyword">return</span> AUTORELEASE(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？"><a href="#4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？" class="headerlink" title="4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？"></a>4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？</h3><blockquote>
<p><strong>答：</strong><code>cocoa</code>中所有的类都是<code>NSObject</code>的子类，多继承在这里是用<code>protocol</code>委托代理来实现的。</p>
</blockquote>
<h3 id="4-2-3-Object-C有私有方法吗？私有变量呢？"><a href="#4-2-3-Object-C有私有方法吗？私有变量呢？" class="headerlink" title="4.2.3    Object-C有私有方法吗？私有变量呢？"></a>4.2.3    Object-C有私有方法吗？私有变量呢？</h3><blockquote>
<p><strong>答：</strong><code>Object-C</code>类里面的方法只有两种，<code>静态方法</code>和<code>实例方法</code>。</p>
<ul>
<li>实例变量：默认都是私有的</li>
<li>实例方法：默认都是共有的</li>
</ul>
</blockquote>
<h3 id="4-2-4-const以为这只读，下面的声明都是什么意思？"><a href="#4-2-4-const以为这只读，下面的声明都是什么意思？" class="headerlink" title="4.2.4    const以为这只读，下面的声明都是什么意思？"></a>4.2.4    const以为这只读，下面的声明都是什么意思？</h3><blockquote>
<p><strong>const作用：</strong></p>
<ol>
<li>声明变量：阻止一个变量被修改 </li>
<li>声明指针：可以指定指针本身为<code>const</code>，也可以指定指针所指的数据为<code>const</code></li>
<li>声明函数：可以修饰形参，表明它是一个输入参数，在函数内部不能改变值</li>
<li>类的成员函数：若指定为<code>const</code>类型，则表明其是一个常函数，不能修改类的成员变量</li>
</ol>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> *a;<span class="comment">// 指向int型常量的指针（整型数不可修改，指针可修改）</span></span><br><span class="line"><span class="keyword">int</span> * <span class="keyword">const</span> a;<span class="comment">//  指向int型变量的只读指针（整型数可修改，指针不可修改）</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> * a <span class="keyword">const</span>;<span class="comment">// 指向int型常量的只读指针(整型不可修改，指针不可修改)</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-static的作用"><a href="#4-2-5-static的作用" class="headerlink" title="4.2.5    static的作用"></a>4.2.5    static的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>函数体内：函数体内<code>static</code>变量的作用范围为改函数体，不同于<code>auto</code>变量，该变量的内存只被分配一次，因此其值在下次调用时仍维持上次的值</li>
<li>全局变量：在模块内的<code>static</code>全局变量可以被模块内所有函数访问，但不能被模块外其它函数访问</li>
<li>全局函数：模块内的<code>static</code>函数只可被这一模块内的其它函数调用，这个函数的使用范围被限制在声明它的模块内</li>
<li>类中的成员变量：在类中的<code>static</code>成员变量属于整个类所有，对类的所有对象只有一份拷贝。</li>
<li>类中的成员函数：在类中的<code>static</code>成员函数属于整个类所有，这个函数不接收<code>this</code>指针，因而只能访问类的<code>static</code>成员变量。</li>
</ol>
</blockquote>
<h3 id="4-2-6-extern-“C”的作用"><a href="#4-2-6-extern-“C”的作用" class="headerlink" title="4.2.6    extern “C”的作用"></a>4.2.6    extern “C”的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>被<code>extern &quot;C&quot;</code>限定的函数或变量是<code>extern</code>类型的</li>
<li>被<code>extern &quot;C&quot;</code>限定的变量和函数是按照<code>C</code>语言方式编译和链接的</li>
</ol>
</blockquote>
<h3 id="4-2-7-import跟-include区别，-class呢？"><a href="#4-2-7-import跟-include区别，-class呢？" class="headerlink" title="4.2.7 #import跟#include区别，@class呢？"></a>4.2.7 #import跟#include区别，@class呢？</h3><blockquote>
<p><strong>答：</strong><code>@class</code>一般用于头文件中需要声明该类的某个实例变量的时候用到，在<code>.m</code><br>文件中还是需要使用<code>#import</code>；而<code>#import</code>比起<code>#include</code>的好处就是好不会引起交叉编译。</p>
</blockquote>
<h3 id="4-2-8-Object-C的优缺点"><a href="#4-2-8-Object-C的优缺点" class="headerlink" title="4.2.8    Object-C的优缺点"></a>4.2.8    Object-C的优缺点</h3><blockquote>
<p><strong>优点：</strong></p>
<ol>
<li><code>Cateogies</code></li>
<li><code>Posing</code></li>
<li>动态识别</li>
<li>指标计算</li>
<li>弹性信息传递</li>
<li>不是一个过度复杂的<code>C</code>衍生语言</li>
<li><code>Object-C</code>与<code>C++</code>可以混合编程</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>不支持命名空间</li>
<li>不支持运算符重载</li>
<li>不支持多重继承</li>
<li>使用动态运行时类型，所有的方法都是函数调用，所以很多编译时优化方法都用不到。</li>
</ol>
</blockquote>
<h3 id="4-2-9-Object-C的内存管理"><a href="#4-2-9-Object-C的内存管理" class="headerlink" title="4.2.9    Object-C的内存管理"></a>4.2.9    Object-C的内存管理</h3><blockquote>
<p><strong>说明：</strong>通过分配和初始化（比如<code>[[MyClass alloc] init]</code>）的方式来创建对象，那就拥有这个对象，需要负责该对象的释放。这个规则在使用<code>NSObject</code>的便利方法<code>new</code>时也同样适用。</p>
<ul>
<li><code>拷贝(copy)对象</code>：也会拥有拷贝得到的对象，需要负责该对象的释放</li>
<li><code>保持(retain)对象</code>：部分拥有这个对象，需要在不再适用时释放该对象。</li>
</ul>
<p><strong>注意：</strong>反过来如果从其它对象那里接收到一个对象，则不拥有该对象，也不应该释放它。</p>
</blockquote>
<h3 id="4-2-10-自动释放池是什么，如何工作？"><a href="#4-2-10-自动释放池是什么，如何工作？" class="headerlink" title="4.2.10    自动释放池是什么，如何工作？"></a>4.2.10    自动释放池是什么，如何工作？</h3><blockquote>
<p><strong>答：</strong>当向一个对象发送一个<code>autorelease</code>消息时，<code>Cocoa</code>就会将改对象的一个引用放入到最新的<code>自动释放池</code>。它仍然是个正当的对象，因此<code>自动释放池</code>定义的作用域内的其它对象可以向它发送消息。当程序执行到作用域结束的位置时，自动释放池就会被释放，池中的对象也就被释放。</p>
</blockquote>
<h3 id="4-2-11-堆和栈的区别"><a href="#4-2-11-堆和栈的区别" class="headerlink" title="4.2.11    堆和栈的区别"></a>4.2.11    堆和栈的区别</h3><table>
<thead>
<tr>
<th><em>**</em></th>
<th>堆</th>
<th>栈</th>
</tr>
</thead>
<tbody>
<tr>
<td>管理方式</td>
<td>由编译器自动管理，无序手工控制</td>
<td>释放工作由程序控制，容易产生内存泄漏</td>
</tr>
<tr>
<td>申请大小</td>
<td>是向高地址扩展的数据结构，是不连续的内存区域。堆获得空间比较<code>灵活</code>，也比较<code>大</code>。</td>
<td>在<code>Windows</code>下，栈时向低地址扩展的数据结构，是一块连续的内存区域。能从栈获得的空间较<code>小</code></td>
</tr>
<tr>
<td>碎片问题</td>
<td>频繁的<code>new/delete</code>势必会造成内存空间的不连续，从而造成大量的碎片，使程序效率降低</td>
<td>栈是先进先出的队列，不会产生碎片</td>
</tr>
<tr>
<td>分配方式</td>
<td>动态分配</td>
<td>静态分配和动态分配</td>
</tr>
<tr>
<td>分配效率</td>
<td>堆是<code>c/c++</code>函数库提供的，机制比较复杂</td>
<td>栈是及其系统提供的数据结构，计算机在底层对栈提供支持</td>
</tr>
</tbody>
</table>
<h2 id="4-3-Swift特性"><a href="#4-3-Swift特性" class="headerlink" title="4.3    Swift特性"></a>4.3    Swift特性</h2><blockquote>
<p><strong>答：</strong></p>
<ol>
<li>支持所有<code>C</code>和<code>Object-C</code>的基本类型</li>
<li>提供了两种功能强劲的集合类型<code>Array</code>和<code>Dictionary</code></li>
<li>支持一种新的高级类型<code>元组</code></li>
<li>可选类型</li>
<li>闭包特性</li>
<li>支持脚本语言的特性，但能高效地编译运行</li>
<li>类型安全</li>
</ol>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_25 高级运算符/" itemprop="url">
                  25 高级运算符
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:24+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_25 高级运算符/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_25 高级运算符/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="25-1-位运算符"><a href="#25-1-位运算符" class="headerlink" title="25.1    位运算符"></a>25.1    位运算符</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 支持 <code>C</code> 语言中的全部位运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th>名称</th>
<th>返回值</th>
<th>复合运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>~</code></td>
<td>按位取反</td>
<td>将每一个0替换成1，每一个1替换成0</td>
<td><code>~=</code></td>
</tr>
<tr>
<td><code>&amp;</code></td>
<td>按位与</td>
<td>对两个操作数相应的位执行逻辑与运算</td>
<td><code>&amp;=</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>按位亦或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生0</td>
<td><code>^=</code></td>
</tr>
<tr>
<td><code>\</code></td>
<td>按位或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生1</td>
<td><code>\=</code></td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td>按位左移</td>
<td>左移n位的结果（左端溢出，右端补0）</td>
<td><code>&lt;&lt;=</code></td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td>按位右移</td>
<td>右移n位的结果（右端溢出，左端补0或保存符号位而补1</td>
<td><code>&gt;&gt;=</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>用途：</strong>通常被用在底层开发中</p>
<ul>
<li>图形编程</li>
<li>设备驱动</li>
<li>处理外部资源的原始数据（比如对自定义通信协议传输的数据进行编码和解码）</li>
</ul>
</blockquote>
<h3 id="25-1-1-按位取反运算符"><a href="#25-1-1-按位取反运算符" class="headerlink" title="25.1.1    按位取反运算符"></a>25.1.1    按位取反运算符</h3><blockquote>
<p><strong>按位取反操作符：</strong><code>~</code><br><strong>说明：</strong><code>按位取反运算符</code>可以对一个数值的全部比特位进行<code>取反</code><br><strong>语法：</strong>按位取反运算符是一个<code>前缀运算符</code>，需要直接放在<code>运算的数</code>之前，并且它们之间不能添加任何<code>空格</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 00001111</span></span><br><span class="line"><span class="keyword">let</span> initialBits: <span class="type">UInt8</span> = <span class="number">0b00001111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0b11110000</span></span><br><span class="line"><span class="keyword">let</span> invertedBits = ~initialBits</span><br></pre></td></tr></table></figure>
<h3 id="25-2-2-按位与运算符"><a href="#25-2-2-按位与运算符" class="headerlink" title="25.2.2    按位与运算符"></a>25.2.2    按位与运算符</h3><blockquote>
<p><strong>按位与操作符：</strong><code>&amp;</code><br><strong>说明：</strong><code>按位与运算符</code>可以对两个数的比特位进行合并。它返回一个新的数，只有当两个数的对应位都为 <code>1</code> 的时候，新数的对应位才为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11111100</span></span><br><span class="line"><span class="keyword">let</span> firstSixBits: <span class="type">UInt8</span> = <span class="number">0b11111100</span></span><br><span class="line"><span class="comment">// 00111111</span></span><br><span class="line"><span class="keyword">let</span> lastSixBits: <span class="type">UInt8</span>  = <span class="number">0b00111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00111100</span></span><br><span class="line"><span class="keyword">let</span> middleFourBits = firstSixBits &amp; lastSixBits<span class="comment">// 按位与运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-3-按位或运算符"><a href="#25-2-3-按位或运算符" class="headerlink" title="25.2.3    按位或运算符"></a>25.2.3    按位或运算符</h3><blockquote>
<p><strong>按位或运算符：</strong><code>|</code><br><strong>说明：</strong><code>按位或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，只要两个数的对应位中有任意一个为 <code>1</code> 时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10110010</span></span><br><span class="line"><span class="keyword">let</span> someBits: <span class="type">UInt8</span> = <span class="number">0b10110010</span></span><br><span class="line"><span class="comment">// 01011110</span></span><br><span class="line"><span class="keyword">let</span> moreBits: <span class="type">UInt8</span> = <span class="number">0b01011110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11111110</span></span><br><span class="line"><span class="keyword">let</span> combinedbits = someBits | moreBits <span class="comment">// 按位或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-4-按位亦或运算符"><a href="#25-2-4-按位亦或运算符" class="headerlink" title="25.2.4    按位亦或运算符"></a>25.2.4    按位亦或运算符</h3><blockquote>
<p><strong>按位亦或运算符：</strong><code>^</code><br><strong>说明：</strong><code>按位异或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，当两个数的<code>对应位不相同</code>时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 00010100</span></span><br><span class="line"><span class="keyword">let</span> firstBits: <span class="type">UInt8</span> = <span class="number">0b00010100</span></span><br><span class="line"><span class="comment">// 00000101</span></span><br><span class="line"><span class="keyword">let</span> otherBits: <span class="type">UInt8</span> = <span class="number">0b00000101</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00010001</span></span><br><span class="line"><span class="keyword">let</span> outputBits = firstBits ^ otherBits <span class="comment">// 按位亦或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-5-按位左移、右移运算符"><a href="#25-2-5-按位左移、右移运算符" class="headerlink" title="25.2.5    按位左移、右移运算符"></a>25.2.5    按位左移、右移运算符</h3><blockquote>
<p><strong>说明：</strong><code>有符号整数</code>和<code>无符号整数</code>的情况有所不同。值得注意的是</p>
</blockquote>
<table>
<thead>
<tr>
<th>位移操作</th>
<th>无符号整数</th>
<th>有符号整数</th>
</tr>
</thead>
<tbody>
<tr>
<td>左移<code>&lt;&lt;</code></td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
</tr>
<tr>
<td>右移<code>&gt;&gt;</code></td>
<td>丢弃溢出，高位用<code>0</code>填充</td>
<td>丢弃溢出，高位用<code>符号位</code>填充</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>有符号整数</code>中的<code>负数</code>和其它整数不同，使用的是<code>二进制补码</code>的表示形式。</p>
<ul>
<li><code>减法</code>在底层可以用<code>加法</code>实现</li>
<li>可以使负数的按位左移和右移运算得到跟正数同样的<code>效果</code></li>
</ul>
<p><strong>技巧：</strong>移位运算（无论<code>有符号整数</code>还是<code>无符号整数</code>）遵守下面定义的规则</p>
<ul>
<li>将一个整数<code>左移</code>一位，等价于将这个数<code>乘以 2</code></li>
<li>将一个整数<code>右移</code>一位，等价于将这个数<code>除以 2</code></li>
</ul>
</blockquote>
<h2 id="25-2-溢出运算符"><a href="#25-2-溢出运算符" class="headerlink" title="25.2    溢出运算符"></a>25.2    溢出运算符</h2><blockquote>
<p><strong>溢出：</strong>默认情况下，当向一个整数赋超过它容量的值时，<code>Swift</code>默认会报错。这一意味着，不会真的发生溢出－除非使用<code>溢出运算符</code>。<br><strong>说明：</strong><code>Swift</code>提供了<code>3</code>个溢出操作符，会让系统在数值溢出的时候采取<code>阶段操作</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>溢出运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;+</code></td>
<td>溢出加法</td>
</tr>
<tr>
<td><code>&amp;-</code></td>
<td>溢出减法</td>
</tr>
<tr>
<td><code>&amp;*</code></td>
<td>溢出乘法</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***** &amp;+ ****/</span></span><br><span class="line"><span class="comment">//  11111111</span></span><br><span class="line"><span class="keyword">var</span> unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">max</span><span class="comment">// 255</span></span><br><span class="line"><span class="comment">// 100000000 -&gt; 00000000</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;+ <span class="number">1</span><span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**** &amp;- ****/</span></span><br><span class="line"><span class="comment">// 00000000</span></span><br><span class="line">unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">min</span><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 111111111 -&gt; 11111111</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;- <span class="number">1</span><span class="comment">// 255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10000000</span></span><br><span class="line"><span class="keyword">var</span> signedOverflow = <span class="type">Int8</span>.<span class="built_in">min</span><span class="comment">// -128</span></span><br><span class="line"><span class="comment">// 01111111</span></span><br><span class="line">signedOverflow = signedOverflow &amp;- <span class="number">1</span><span class="comment">// 127</span></span><br></pre></td></tr></table></figure>
<h3 id="数值溢出"><a href="#数值溢出" class="headerlink" title="数值溢出"></a>数值溢出</h3><blockquote>
<p><strong>说明：</strong>数值溢出分为<code>上溢</code>和<code>下溢</code><br><strong>技巧：</strong>对于整数型数值（无论是<code>有符号</code>还是<code>无符号</code>）</p>
<ul>
<li>最大数：上溢1变成最小的数</li>
<li>最小数：下溢1变成最大的数</li>
</ul>
</blockquote>
<h2 id="25-3-优先级和结合性"><a href="#25-3-优先级和结合性" class="headerlink" title="25.3    优先级和结合性"></a>25.3    优先级和结合性</h2><blockquote>
<p><strong>说明：</strong>相比<code>C语言</code>和<code>Object-C</code>，<code>Swift</code>的运算符优先级和结合型规则更加简洁和可预测。</p>
</blockquote>
<h2 id="25-4-运算符函数"><a href="#25-4-运算符函数" class="headerlink" title="25.4    运算符函数"></a>25.4    运算符函数</h2><blockquote>
<p><strong>运算符重载：</strong><code>类</code>或<code>结构</code>可以为现有的操作符提供自定义的实现。</p>
</blockquote>
<h3 id="25-4-1-中缀运算符"><a href="#25-4-1-中缀运算符" class="headerlink" title="25.4.1    中缀运算符"></a>25.4.1    中缀运算符</h3><blockquote>
<p><strong>说明：</strong>也叫做<code>双目运算符</code>出现在两个<code>目标</code>之间，比如<code>+</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载“加号”，定义 Vector2D 类型实例之间的“加法”</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 向量之和</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数1</span></span><br><span class="line"><span class="keyword">let</span> vector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line"><span class="comment">// 操作数2</span></span><br><span class="line"><span class="keyword">let</span> anotherVector = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="comment">// 相加</span></span><br><span class="line"><span class="keyword">let</span> combinedVector = vector + anotherVector</span><br></pre></td></tr></table></figure>
<h3 id="25-4-2-前缀和后缀运算符"><a href="#25-4-2-前缀和后缀运算符" class="headerlink" title="25.4.2    前缀和后缀运算符"></a>25.4.2    前缀和后缀运算符</h3><blockquote>
<p><strong>说明：</strong><code>单目运算符</code>有<code>前缀</code>和<code>后缀</code>之分。</p>
</blockquote>
<table>
<thead>
<tr>
<th>单目运算符</th>
<th>说明</th>
<th>重载使用的关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>前缀</code></td>
<td>运算符出现在值之前</td>
<td><code>prefix</code></td>
</tr>
<tr>
<td><code>后缀</code></td>
<td>运算符出现在值之后</td>
<td><code>postfix</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获取相反向量</span><br><span class="line">* @param &#123;Vector2D&#125; vector 向量实例</span><br><span class="line">* @return &#123;Vector2D&#125; 相反向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> - <span class="params">(vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: -vector.x, y: -vector.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3.0, 4.0)</span></span><br><span class="line"><span class="keyword">let</span> positive = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-3.0, -4.0)</span></span><br><span class="line"><span class="keyword">let</span> negative = -positive</span><br></pre></td></tr></table></figure>
<h3 id="25-4-3-复合赋值运算符"><a href="#25-4-3-复合赋值运算符" class="headerlink" title="25.4.3    复合赋值运算符"></a>25.4.3    复合赋值运算符</h3><blockquote>
<p><strong>说明：</strong>重载<code>复合赋值运算符</code>（比如<code>+=</code>、<code>++</code>、<code>--</code>）</p>
<ul>
<li>第一个参数必需声明为<code>inout</code>类型，因为这个参数的值会在运算符函数内直接被修改</li>
</ul>
<p><strong>注意：</strong>不能对默认的<code>赋值运算符</code>和<code>三目条件运算符</code>进行重载。只有组合赋值运算符可以被重载。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载 "+="</span><br><span class="line">* @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line">* @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载前缀 "++"</span><br><span class="line">* @param &#123;Vector2D&#125; inout vector 要自增的向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> ++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toIncrement = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterIncrement = ++toIncrement</span><br></pre></td></tr></table></figure>
<h3 id="25-4-4-等价操作符"><a href="#25-4-4-等价操作符" class="headerlink" title="25.4.4    等价操作符"></a>25.4.4    等价操作符</h3><blockquote>
<p><strong>说明：</strong>属于<code>中缀运算符</code>（或<code>双目运算符</code>），包括<code>==</code>和<code>!=</code><br><strong>扩展：</strong>自定义的<code>类</code>和<code>结构体</code>没有对<code>等价运算符</code>进行默认实现，为了使用<code>等价运算符</code>能对自定义的类型进行<code>判等运算</code>，需要为其提供自定义实现</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"＝＝"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> == <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">left</span>.x == <span class="keyword">right</span>.x) &amp;&amp; (<span class="keyword">left</span>.y == <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"!="</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"不相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> != <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !(<span class="keyword">left</span> == <span class="keyword">right</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> twoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherTwoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">if</span> twoThree == anotherTwoThree &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"These two vectors are equivalent."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="25-5-自定义运算符"><a href="#25-5-自定义运算符" class="headerlink" title="25.5    自定义运算符"></a>25.5    自定义运算符</h2><blockquote>
<p><strong>说明：</strong>除了实现标准运算符，在 <code>Swift</code> 中还可以声明和实现自定义运算符。<br><strong>参考：</strong>可以用来自定义运算符的字符列表请参考<a href="">运算符</a>。<br><strong>语法：</strong>新的运算符要使用 <code>operator</code> 关键字在全局作用域内进行定义，同时还要指定 <code>prefix</code>、<code>infix</code> 或者 <code>postfix</code> 修饰符。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载 "+="</span><br><span class="line"> * @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line"> * @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">prefix</span> <span class="keyword">operator</span> +++ &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 自定义"+++"：前缀双自增</span><br><span class="line"> * @param &#123;Vector2D&#125; vector 向量</span><br><span class="line"> * @return &#123;Bool&#125; 计算结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> +++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += vector</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> toBeDoubled = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterDoubling = +++toBeDoubled</span><br></pre></td></tr></table></figure>
<h3 id="自定义中缀运算符的优先级和结合性"><a href="#自定义中缀运算符的优先级和结合性" class="headerlink" title="自定义中缀运算符的优先级和结合性"></a>自定义中缀运算符的优先级和结合性</h3><blockquote>
<p><strong>说明：</strong>自定义的<code>中缀运算符</code>也可以指定<code>优先级</code>(默认为<code>100</code>)和<code>结合性</code>(默认为<code>none</code>)</p>
</blockquote>
<table>
<thead>
<tr>
<th>优先级</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>left</code></td>
<td>左结合</td>
<td>跟左边的值进行结合</td>
</tr>
<tr>
<td><code>right</code></td>
<td>右结合</td>
<td>会跟右边的值进行结合</td>
</tr>
<tr>
<td><code>none</code></td>
<td>非结合</td>
<td>不能跟其他相同优先级的运算符写在一起</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>在定义前缀与后缀运算符的时候，如果没有指定优先级，则对同一个值同时使用前缀与后缀运算符，后缀运算符会先参与运算。<br><strong>参考：</strong> <a href="https://developer.apple.com/library/ios/documentation/Swift/Reference/Swift_StandardLibrary_Operators/index.html#//apple_ref/doc/uid/TP40016054" target="_blank" rel="external">Swift 标准库提供的运算符的结合性与优先级</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 自定义中缀运算符"+-"</span><br><span class="line">* 结合性：left</span><br><span class="line">* 优先级：140</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> +- &#123; <span class="keyword">associativity</span> <span class="keyword">left</span> <span class="keyword">precedence</span> <span class="number">140</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重写"+-"</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 计算结果</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> +- <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y - <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstVector = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">2.0</span>)</span><br><span class="line"><span class="keyword">let</span> secondVector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> plusMinusVector = firstVector +- secondVector</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_24 访问控制/" itemprop="url">
                  24 访问控制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:04+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_24 访问控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_24 访问控制/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>访问控制可以限定其他源文件或模块中的代码对你的代码的访问级别。<br><strong>用途：</strong>这个特性可以让我们<code>隐藏代码的一些实现细节</code>，并且可以为其他人可以访问和使用的代码<code>提供接口</code>。<br><strong>约定：</strong>为了简单起见，对于代码中可以设置访问级别的特性（属性、基本类型、函数等），在下面的章节中我们会称之为<code>实体</code>。</p>
</blockquote>
<h2 id="24-1-模块和源代码"><a href="#24-1-模块和源代码" class="headerlink" title="24.1    模块和源代码"></a>24.1    模块和源代码</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 中的访问控制模型基于<code>模块</code>和<code>源文件</code>这两个概念。<br><strong>模块：</strong>模块指的是独立的<code>代码单元</code>，<code>框架</code>或<code>应用程序</code></p>
<ul>
<li>作为一个独立的模块来构建和发布</li>
<li>一个模块可以使用 <code>import</code> 关键字导入另外一个模块</li>
<li><code>Xcode</code> 的每个 <code>target</code>（例如框架或应用程序）都被当作独立的模块处理</li>
</ul>
<p><strong>源文件：</strong>源文件就是 <code>Swift</code> 中的源代码文件</p>
<ul>
<li>通常属于一个模块，即一个应用程序或者框架</li>
<li>同一个源文件也可以包含多个类型、函数之类的定义(一般会将不同的类型分别定义在不同的源文件中)</li>
</ul>
</blockquote>
<h2 id="24-2-访问级别"><a href="#24-2-访问级别" class="headerlink" title="24.2    访问级别"></a>24.2    访问级别</h2><blockquote>
<p><strong>说明：</strong><code>3</code>种</p>
</blockquote>
<table>
<thead>
<tr>
<th>访问级别</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td>可以访问同一模块源文件中的任何实体，在模块外也可以通过导入该模块来访问源文件里的所有实体</td>
<td>框架中的某个接口可以被任何人使用时</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>可以访问同一模块源文件中的任何实体，但是不能从模块外访问该模块源文件中的实体</td>
<td>某个接口只在应用程序或框架内部使用时</td>
</tr>
<tr>
<td><code>private</code></td>
<td>限制实体只能在所在的源文件内部使用</td>
<td>需要隐藏某些功能的实现细节时</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>Swift</code> 中的 <code>private</code> 访问级别不同于其他语言，它的范围限于源文件，而不是声明范围内。这就意味着，一个类型可以访问其所在源文件中的所有 <code>private</code> 实体，但是如果它的扩展定义在其他源文件中，那么它的扩展就不能访问它在这个源文件中定义的 <code>private</code> 实体。</p>
</blockquote>
<h3 id="24-2-1-访问级别基本原则"><a href="#24-2-1-访问级别基本原则" class="headerlink" title="24.2.1    访问级别基本原则"></a>24.2.1    访问级别基本原则</h3><blockquote>
<p><strong>说明：</strong>不可以在某个实体中定义访问级别更高的实体。</p>
<ul>
<li>一个 <code>public</code> 访问级别的变量，其类型的访问级别不能是 <code>internal</code> 或 <code>private</code>。</li>
<li><code>函数</code>的访问级别不能高于它的<code>参数类型</code>和<code>返回类型</code>的访问级别</li>
</ul>
</blockquote>
<h3 id="24-2-2-默认访问级别"><a href="#24-2-2-默认访问级别" class="headerlink" title="24.2.2    默认访问级别"></a>24.2.2    默认访问级别</h3><blockquote>
<p><strong>说明：</strong>代码默认的访问级别为<code>internal</code></p>
</blockquote>
<h3 id="24-2-3-单target应用程序的访问级别"><a href="#24-2-3-单target应用程序的访问级别" class="headerlink" title="24.2.3    单target应用程序的访问级别"></a>24.2.3    单target应用程序的访问级别</h3><blockquote>
<p><strong>单target应用程序：</strong>应用的所有功能都是为该应用服务，而<code>不需要提供给其他应用或者模块使用</code>，所以我们不需要明确设置访问级别<br><strong>说明：</strong>建议访问级别设置</p>
<ul>
<li>通常使用默认的访问级别 <code>internal</code> 即可</li>
<li>也可以使用 <code>private</code> 级别，用于隐藏一些功能的实现细节</li>
</ul>
</blockquote>
<h3 id="24-2-4-框架的访问级别"><a href="#24-2-4-框架的访问级别" class="headerlink" title="24.2.4    框架的访问级别"></a>24.2.4    框架的访问级别</h3><blockquote>
<p><strong>框架：</strong>主要是被其它模块导入使用<br><strong>说明：</strong>把一些对外的接口定义为 <code>public</code> 级别</p>
<ul>
<li>框架依然会使用默认的 <code>internal</code> 级别，也可以指定为 <code>private</code> 级别</li>
<li>当你想把某个实体作为框架的 <code>API</code> 的时候，需显式为其指定 <code>public</code> 级别</li>
</ul>
</blockquote>
<h3 id="24-2-5-单元测试target的访问级别"><a href="#24-2-5-单元测试target的访问级别" class="headerlink" title="24.2.5    单元测试target的访问级别"></a>24.2.5    单元测试target的访问级别</h3><blockquote>
<p><strong>单元测试target：</strong>当你的应用程序包含<code>单元测试 target</code> 时，为了测试，测试模块需要访问应用程序模块中的代码。<br><strong>说明：</strong>默认情况下只有 <code>public</code> 级别的实体才可以被其他模块访问。然而，如果在<code>导入应用程序模块的语句</code>前使用 <code>@testable</code> 特性，然后在允许测试的编译设置<code>（Build Options -&gt; Enable Testability）</code>下编译这个应用程序模块，<code>单元测试 target</code> 就可以访问应用程序模块中<code>所有 internal 级别</code>的实体。</p>
</blockquote>
<h2 id="24-3-访问控制语法"><a href="#24-3-访问控制语法" class="headerlink" title="24.3    访问控制语法"></a>24.3    访问控制语法</h2><blockquote>
<p><strong>说明：</strong>通过修饰符 <code>public</code>、<code>internal</code>、<code>private</code> 来声明实体的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**** 声明类 ****/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// internal(默认的，可省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 声明变量 ******/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> somePublicVariable = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明常量 ******/</span></span><br><span class="line"><span class="comment">// internal(可以省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">let</span> someInternalConstant = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明方法 *********/</span></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateFunction</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-4-自定义类型"><a href="#24-4-自定义类型" class="headerlink" title="24.4    自定义类型"></a>24.4    自定义类型</h2><blockquote>
<p><strong>说明：</strong>一个类型的访问级别也会影响到类型成员（<code>属性</code>、<code>方法</code>、<code>构造器</code>、<code>下标</code>）的默认访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型的访问级别</th>
<th>类型成员的默认访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>internal</code>（或不指定）</td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>为什么：</strong>一个 <code>public</code> 类型的所有成员的访问级别默认为 <code>internal</code> 级别，而不是 <code>public</code> 级别？</p>
<blockquote>
<p>好处是，在你定义公共接口的时候，可以明确地选择哪些接口是需要公开的，哪些是内部使用的，避免不小心将内部使用的接口公开。</p>
</blockquote>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// public</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> somePublicProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-1-元组类型"><a href="#24-4-1-元组类型" class="headerlink" title="24.4.1    元组类型"></a>24.4.1    元组类型</h3><blockquote>
<p><strong>说明：</strong>元组不同于类、结构体、枚举、函数那样有单独的定义。元组的访问级别是在它被使用时<code>自动推断</code>出的，而无法明确指定。<br><strong>访问级别：</strong>元组的访问级别将由元组中<code>访问级别最严格的类型</code>来决定。</p>
</blockquote>
<h3 id="24-4-2-函数类型"><a href="#24-4-2-函数类型" class="headerlink" title="24.4.2    函数类型"></a>24.4.2    函数类型</h3><blockquote>
<p><strong>访问级别：</strong>函数的访问级别根据访问级别最严格的<code>参数</code>类型或<code>返回</code>类型的访问级别来决定<br><strong>说明：</strong>如果这种访问级别不符合函数定义所在环境的默认访问级别，那么就需要<code>明确地指定该函数的访问级别</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为该函数返回类型的访问级别是 private，所以你必须使用 private 修饰符</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>) &#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-3-枚举类型"><a href="#24-4-3-枚举类型" class="headerlink" title="24.4.3    枚举类型"></a>24.4.3    枚举类型</h3><blockquote>
<p><strong>访问级别：</strong><code>枚举成员</code>的访问级别和该<code>枚举类型</code>相同<br><strong>说明：</strong>你不能为<code>枚举成员</code>单独指定不同的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CompassPoint</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">North</span><span class="comment">// public</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">South</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">East</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">West</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原始值和关联值"><a href="#原始值和关联值" class="headerlink" title="原始值和关联值"></a>原始值和关联值</h4><blockquote>
<p><strong>说明：</strong><code>枚举定义</code>中的任何<code>原始值</code>或<code>关联值</code>的类型的访问级别至少不能低于<code>枚举类型</code>的访问级别</p>
</blockquote>
<h3 id="24-4-4-嵌套类型"><a href="#24-4-4-嵌套类型" class="headerlink" title="24.4.4    嵌套类型"></a>24.4.4    嵌套类型</h3><table>
<thead>
<tr>
<th>环境类型</th>
<th>嵌套类型默认</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
<tr>
<td><code>internal</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
<td>如果想让嵌套类型拥有 <code>public</code> 访问级别，那么需要明确指定该嵌套类型的访问级别</td>
</tr>
</tbody>
</table>
<h2 id="24-5-子类"><a href="#24-5-子类" class="headerlink" title="24.5    子类"></a>24.5    子类</h2><blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>子类的访问级别<code>不得高于</code>父类的访问级别</li>
<li>可以通过<code>重写</code>为继承来的<code>类成员</code>提供<code>更高的访问级别</code></li>
<li>用<code>子类成员</code>去访问访问级别更低的<code>父类成员</code>，只要这一操作在相应访问级别的限制范围内</li>
</ul>
<ol>
<li><strong>同一源文件：</strong>可以访问访问父类 <code>private</code> 级别的成员</li>
<li><strong>同一模块：</strong>访问父类 <code>internal</code> 级别的成员</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类（访问级别不能高于父类）</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写父类方法，提高访问级别</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 调用父类 private 方法（同一源文件）</span></span><br><span class="line">        <span class="keyword">super</span>.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-6-常量、变量、属性、下标"><a href="#24-6-常量、变量、属性、下标" class="headerlink" title="24.6    常量、变量、属性、下标"></a>24.6    常量、变量、属性、下标</h2><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性</code>不能拥有比它们<code>所在的类型</code>更高的访问级别；<code>下标</code>也不能拥有比<code>索引类型</code>或<code>返回类型</code>更高的访问级别。</p>
</blockquote>
<h3 id="24-6-1-Getter-和-Setter"><a href="#24-6-1-Getter-和-Setter" class="headerlink" title="24.6.1    Getter 和 Setter"></a>24.6.1    Getter 和 Setter</h3><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性（包括计算属性 和 存储型属性）</code>、<code>下标</code>的 <code>Getters</code> 和 <code>Setters</code> 的访问级别和它们<code>所在类型</code>的访问级别相同。<br><strong>改变访问级别：</strong>只能改变<code>Setter</code><br> |改变<code>Setter</code>访问权限的关键字|访问级别|<br> |-|-|<br> |<code>private(set)</code> |<code>private</code>|<br> |<code>internal(set)</code>|<code>internal</code>|<br><strong>注意：</strong>存储属性也有<code>Getter</code>和<code>Setter</code>，<code>Swift</code>会隐式地为其创建 <code>Getter</code> 和 <code>Setter</code>，用于访问该属性的<code>后备存储</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体(internal)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrackedString</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储属性：setter 为 private（该属性只有在当前的源文件中是可读写的，而在当前源文件所属的模块中只是一个可读的属性）</span></span><br><span class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> numberOfEdits = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 计算属性: internal</span></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结构体实例</span></span><br><span class="line"><span class="keyword">var</span> stringToEdit = <span class="type">TrackedString</span>()</span><br><span class="line"><span class="comment">// 写（在同一源文件中）</span></span><br><span class="line">stringToEdit.value = <span class="string">"This string will be tracked."</span></span><br><span class="line">stringToEdit.value += <span class="string">" This edit will increment numberOfEdits."</span></span><br><span class="line">stringToEdit.value += <span class="string">" So will this one."</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The number of edits is \(stringToEdit.numberOfEdits)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="24-7-构造器"><a href="#24-7-构造器" class="headerlink" title="24.7    构造器"></a>24.7    构造器</h2><blockquote>
<p><strong>说明：</strong>构造器的访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>构造器</th>
<th>访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>自定义构造器</td>
<td>可以<code>低于或等于</code>其<code>所属类型</code>的访问级别</td>
</tr>
<tr>
<td>必要构造器</td>
<td>必须和所属类型的访问级别<code>相同</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>构造器参数的访问级别：</strong>如同函数或方法的参数，<code>构造器参数</code>的访问级别也不能低于<code>构造器本身</code>的访问级别。</p>
</blockquote>
<h3 id="24-7-1-默认构造器"><a href="#24-7-1-默认构造器" class="headerlink" title="24.7.1    默认构造器"></a>24.7.1    默认构造器</h3><blockquote>
<p><strong>默认构造器存在条件：</strong>为所有存储型属性设置了默认初始值，并且未提供自定义的构造器。<br><strong>说明：</strong>默认构造器的访问级别<code>与所属类型的访问级别相同</code>，除非类型的访问级别是 <code>public</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>所在类型访问级别</th>
<th>默认构造器访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code>或<code>internal</code></td>
<td>和所在类型相同</td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果你希望一个 <code>public</code> 级别的类型也能在其他模块中使用这种<code>无参数的默认构造器</code>，你只能<code>自己提供一个 public 访问级别的无参数构造器</code>。</p>
</blockquote>
<h3 id="24-7-2-结构体默认的成员逐一构造器"><a href="#24-7-2-结构体默认的成员逐一构造器" class="headerlink" title="24.7.2    结构体默认的成员逐一构造器"></a>24.7.2    <code>结构体</code>默认的成员逐一构造器</h3><blockquote>
<p><strong>说明：</strong>和结构体中的<code>存储属性成员</code>的访问级别有关。</p>
</blockquote>
<table>
<thead>
<tr>
<th>所有存储型属性的访问级别都为<code>private</code></th>
<th>逐一成员构造器的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td><code>private</code></td>
</tr>
<tr>
<td>否</td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果希望一个 <code>public</code> 级别的结构体也能在其他模块中使用<code>其默认的成员逐一构造器</code>，依然只能<code>自己提供一个 public 访问级别的成员逐一构造器</code>。</p>
</blockquote>
<h2 id="24-8-协议"><a href="#24-8-协议" class="headerlink" title="24.8    协议"></a>24.8    协议</h2><blockquote>
<p><strong>说明：</strong>可以在<code>定义协议</code>时明确指定协议的访问级别。</p>
<ul>
<li>协议中的每一个<code>要求</code>都具有和<code>该协议</code>相同的访问级别</li>
</ul>
</blockquote>
<h3 id="24-8-1-协议继承"><a href="#24-8-1-协议继承" class="headerlink" title="24.8.1    协议继承"></a>24.8.1    协议继承</h3><blockquote>
<p><strong>说明：</strong>如果定义了一个继承自其他协议的新协议，那么<code>新协议</code>拥有的访问级别最高也只能和<code>被继承协议</code>的访问级别相同</p>
</blockquote>
<h3 id="24-8-2-协议一致性"><a href="#24-8-2-协议一致性" class="headerlink" title="24.8.2    协议一致性"></a>24.8.2    协议一致性</h3><blockquote>
<p><strong>说明：</strong>一个<code>类型</code>可以采纳比自身访问级别低的<code>协议</code><br><strong>采纳协议的类型的访问级别：</strong>采纳了协议的类型的访问级别取它本身和所采纳协议<code>两者间最低的访问级别</code></p>
</blockquote>
<h2 id="24-9-扩展"><a href="#24-9-扩展" class="headerlink" title="24.9    扩展"></a>24.9    扩展</h2><blockquote>
<p><strong>说明：</strong>你可以在访问级别允许的情况下对<code>类</code>、<code>结构体</code>、<code>枚举</code>进行扩展。</p>
</blockquote>
<table>
<thead>
<tr>
<th>是否给扩展指定访问级别</th>
<th>扩展的成员的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td>扩展的访问级别下成员获得的默认访问级别（规则同<code>自定义类型</code>）</td>
</tr>
<tr>
<td>否</td>
<td>和原始类型成员一致</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>用于采纳协议的扩展不能指定扩展的访问级别。</p>
</blockquote>
<h3 id="24-9-1-通过扩展添加协议一致性"><a href="#24-9-1-通过扩展添加协议一致性" class="headerlink" title="24.9.1    通过扩展添加协议一致性"></a>24.9.1    通过扩展添加协议一致性</h3><blockquote>
<p><strong>说明：</strong>如果你通过扩展来采纳协议，那么你就<code>不能显式指定</code>该扩展的访问级别了<br>扩展的访问级别<br><strong>扩展中提供的实现协议要求的成员的访问级别：</strong>协议拥有相应的访问级别，并会为该扩展中所有协议要求的实现提供默认的访问级别。</p>
</blockquote>
<h2 id="24-10-泛型"><a href="#24-10-泛型" class="headerlink" title="24.10    泛型"></a>24.10    泛型</h2><blockquote>
<p><strong>说明：</strong>泛型函数和泛型类型放在一起讨论。<br><strong>访问级别：</strong>取<code>自身</code>访问级别和<code>类型参数</code>访问级别中最低的访问级别</p>
</blockquote>
<h2 id="24-11-类型别名"><a href="#24-11-类型别名" class="headerlink" title="24.11    类型别名"></a>24.11    类型别名</h2><blockquote>
<p><strong>说明：</strong>你定义的任何<code>类型别名</code>都会被当作不同的类型，以便于进行访问控制。<br><strong>访问级别限制：</strong><code>类型别名</code>的访问级别不可高于<code>其表示的类型</code>的访问级别。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">100</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
