<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/3/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/3/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/" itemprop="url">
                  1 了解ios项目开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:54:40+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_1  了解ios项目开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_1  了解ios项目开发/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-ios开发前准备"><a href="#1-1-ios开发前准备" class="headerlink" title="1.1    ios开发前准备"></a>1.1    ios开发前准备</h2><h3 id="1-1​-苹果公司介绍"><a href="#1-1​-苹果公司介绍" class="headerlink" title="1.1​    苹果公司介绍"></a>1.1​    苹果公司介绍</h3><blockquote>
<p><strong>重要事件</strong><br>1976年创立<br>1976年推出Apple 1<br>1977年推出Apple 2<br>1980年推出Apple 3<br>1983年推出Apple Lisa<br>1984年推出Macintosh<br>1991年推出PowerBook，2006年被MacBook系列取代<br>1993年推出Apple Newton掌上电脑（已死）</p>
<p><strong>苹果电脑</strong><br>1998年推出iMac<br>2005年推出Mac mini<br>2006年推出Mac Pro<br>2006年推出MacBook（已死）<br>2008年推出MacBook air</p>
<p><strong>苹果音乐播放器</strong><br>2001年推出ipod<br>2004年推出iPod Mini<br>2005年推出iPod nano、iPod Shuffle<br>2007年推出iPod Classic、iPod Touch</p>
<p><strong>苹果手机产品</strong><br>2007年推出iPhone<br>2008年推出iPhone 3G<br>2009年推出iPhone 3GS<br>2010年推出iPhone 4<br>2011年推出iPhone 4s<br>2012年推出iPhone 5<br>2013年推出iPhone 5s、iPhone 5c</p>
<p><strong>苹果公司平板电脑</strong><br>2010年推出iPad<br>2011年推出iPad2<br>2012年推出iPad Mini</p>
<p><strong>苹果电视</strong><br>2006年发布Apple TV</p>
</blockquote>
<h3 id="1-1-2-苹果Mac-OX-操作系统介绍"><a href="#1-1-2-苹果Mac-OX-操作系统介绍" class="headerlink" title="1.1.2  苹果Mac OX 操作系统介绍"></a>1.1.2  苹果Mac OX 操作系统介绍</h3><blockquote>
<p><strong>历史版本</strong><br>2001年从Macintosh电脑上分离出来成为OS X10.0<br>2001年推出OS X 10.1<br>2002年推出OS X 10.2、10.3<br>2005年推出OS X 10.4<br>2006年推出OS X 10.5<br>2008年推出OS X 10.6<br>2010年推出OS X 10.7(App Store)<br>2012年推出OS X 10.8<br>2013年推出OS X 10.9(后台程序省电优化、内存压缩技术)<br>2014年推出OS X 10.10</p>
<p><strong>OS X系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260954919.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-3-苹果ios操作系统"><a href="#1-1-3-苹果ios操作系统" class="headerlink" title="1.1.3    苹果ios操作系统"></a>1.1.3    苹果ios操作系统</h3><blockquote>
<p><strong>历史版本</strong><br>2007年发布iPhone Runs OS X<br>2008年改名为iPhone OS<br>2010年改名为ios，发布ios4（多任务）<br>2011年发布ios5<br>2012年发布ios6<br>2013年发布ios7(扁平化)<br>2014年发布ios8</p>
<p><strong>ios系统结构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1451260989517.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-1-4-软硬件开发环境要求"><a href="#1-1-4-软硬件开发环境要求" class="headerlink" title="1.1.4    软硬件开发环境要求"></a>1.1.4    软硬件开发环境要求</h3><blockquote>
<p><strong>硬件环境</strong><br>CPU双核<br>内存8G<br>最好选择Macbook Pro,也可以使用Macbook Air<br>测试手机iPhone 5+(发布)</p>
<p><strong>环境要求</strong><br>OS X 10.9.3+<br>Xcode 6.0+</p>
</blockquote>
<h2 id="1-2-Xcode继承开发环境的安装使用与项目建立流程"><a href="#1-2-Xcode继承开发环境的安装使用与项目建立流程" class="headerlink" title="1.2    Xcode继承开发环境的安装使用与项目建立流程"></a>1.2    Xcode继承开发环境的安装使用与项目建立流程</h2><h3 id="1-2-1-xcode的下载和安装"><a href="#1-2-1-xcode的下载和安装" class="headerlink" title="1.2.1    xcode的下载和安装"></a>1.2.1    xcode的下载和安装</h3><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>AppStore</li>
<li>开发者中心下载链接：<a href="https://developer.apple.com/xcode/downloads" target="_blank" rel="external">https://developer.apple.com/xcode/downloads</a></li>
</ul>
</blockquote>
<h3 id="1-2-2-xcode创建ios-single-view项目"><a href="#1-2-2-xcode创建ios-single-view项目" class="headerlink" title="1.2.2    xcode创建ios single view项目"></a>1.2.2    xcode创建ios single view项目</h3><h3 id="1-2-3-工作空间创建和使用"><a href="#1-2-3-工作空间创建和使用" class="headerlink" title="1.2.3    工作空间创建和使用"></a>1.2.3    工作空间创建和使用</h3><h3 id="1-2-4-xcode快捷键及常用功能"><a href="#1-2-4-xcode快捷键及常用功能" class="headerlink" title="1.2.4    xcode快捷键及常用功能"></a>1.2.4    xcode快捷键及常用功能</h3><blockquote>
<p><strong>常用</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>option + cmd + 向上箭头</td>
<td>m/h文件切换</td>
</tr>
<tr>
<td>ctrl + a</td>
<td>光标移动到行头</td>
</tr>
<tr>
<td>ctrl + e</td>
<td>光标移动到行末</td>
</tr>
<tr>
<td>command + G</td>
<td>查找下一个</td>
</tr>
<tr>
<td>command + w</td>
<td>关闭一个文件</td>
</tr>
<tr>
<td>option + command + m</td>
<td>窗口最小化</td>
</tr>
<tr>
<td>command + /</td>
<td>注释</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>调试</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>alt + command + y</td>
<td>degug 调试</td>
</tr>
<tr>
<td>alt + command + R</td>
<td>Run运行</td>
</tr>
<tr>
<td>alt + command + p</td>
<td>到下一个断点</td>
</tr>
<tr>
<td>shift + cmd + o</td>
<td>执行下一步(step over)</td>
</tr>
<tr>
<td>shift + cmd + i</td>
<td>执行进入函数(step into)</td>
</tr>
<tr>
<td>shift + cmd + t</td>
<td>step out</td>
</tr>
<tr>
<td>command + /</td>
<td>取消断点</td>
</tr>
<tr>
<td>command + shift + F</td>
<td>查找</td>
</tr>
<tr>
<td>command + enter</td>
<td>等于bulid and debug</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>移动</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>control＋F</td>
<td>在同一行上将光标向右移动</td>
</tr>
<tr>
<td>control＋B</td>
<td>在同一行上将光标向左移动</td>
</tr>
<tr>
<td>control＋P</td>
<td>将光标移动到前一行</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到后一行</td>
</tr>
<tr>
<td>control＋A</td>
<td>将光标移动到本行的行首</td>
</tr>
<tr>
<td>control＋N</td>
<td>将光标移动到本行的行尾</td>
</tr>
<tr>
<td>control＋T</td>
<td>将光标两边的字符对调</td>
</tr>
<tr>
<td>control＋D</td>
<td>删除光标右边的字符</td>
</tr>
<tr>
<td>control＋k 删除光标所在行 光标后面的代码，便于你重写行尾代码</td>
</tr>
<tr>
<td>control + L</td>
<td>将光标插点置于窗口正中</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>缩进</strong></p>
<ul>
<li>第一种方法：选中需要缩进的代码，按住control键后单击光标，出现pop菜单，然后选择Re-indent selection。</li>
<li>第二种方法：选择需要调整的代码，同时按下<code>command＋［ （左移动代码）</code>或 <code>command＋］（右移动代码）</code>。</li>
</ul>
</blockquote>
<h3 id="1-2-5-xcode中创建os-x命令行控制台项目"><a href="#1-2-5-xcode中创建os-x命令行控制台项目" class="headerlink" title="1.2.5    xcode中创建os x命令行控制台项目"></a>1.2.5    xcode中创建os x命令行控制台项目</h3><h3 id="1-2-6-xcode中创建os-x窗体程序项目"><a href="#1-2-6-xcode中创建os-x窗体程序项目" class="headerlink" title="1.2.6    xcode中创建os x窗体程序项目"></a>1.2.6    xcode中创建os x窗体程序项目</h3><h3 id="1-2-7-xcode中创建os-x游戏项目"><a href="#1-2-7-xcode中创建os-x游戏项目" class="headerlink" title="1.2.7    xcode中创建os x游戏项目"></a>1.2.7    xcode中创建os x游戏项目</h3><h3 id="1-2-8-xcode中创建ios游戏项目"><a href="#1-2-8-xcode中创建ios游戏项目" class="headerlink" title="1.2.8    xcode中创建ios游戏项目"></a>1.2.8    xcode中创建ios游戏项目</h3><h2 id="1-3-Xcode常用项目模版"><a href="#1-3-Xcode常用项目模版" class="headerlink" title="1.3    Xcode常用项目模版"></a>1.3    Xcode常用项目模版</h2><blockquote>
<p><strong>说明：</strong><code>5</code>种</p>
<ul>
<li>Master-Detail Application：<code>列表页-详情页</code>类型</li>
<li>Page-Based Application：<code>电子书</code>类型</li>
<li>Single View Application：</li>
<li>Tabbed Application</li>
<li>Game</li>
</ul>
</blockquote>
<h3 id="1-3-1-Master-Detail-Application"><a href="#1-3-1-Master-Detail-Application" class="headerlink" title="1.3.1    Master-Detail Application"></a>1.3.1    Master-Detail Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.26.53.png" alt="Alt text"></p>
<h3 id="1-3-2-Page-Based-Application"><a href="#1-3-2-Page-Based-Application" class="headerlink" title="1.3.2    Page-Based Application"></a>1.3.2    Page-Based Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.38.45.png" alt="Alt text"></p>
<h3 id="1-3-3-Tabbed-Application"><a href="#1-3-3-Tabbed-Application" class="headerlink" title="1.3.3    Tabbed Application"></a>1.3.3    Tabbed Application</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-28%20%E4%B8%8A%E5%8D%888.56.30.png" alt="Alt text"></p>
<h2 id="1-4-ios用户界面开发基本流程"><a href="#1-4-ios用户界面开发基本流程" class="headerlink" title="1.4    ios用户界面开发基本流程"></a>1.4    ios用户界面开发基本流程</h2><h3 id="1-4-1-StoryBoard的基本使用方法"><a href="#1-4-1-StoryBoard的基本使用方法" class="headerlink" title="1.4.1    StoryBoard的基本使用方法"></a>1.4.1    StoryBoard的基本使用方法</h3><blockquote>
<p><strong>说明：</strong><code>Storybiard(故事版)</code>是<code>Xcode4.2</code>才开始支持的，为了使设计<code>View</code>更加容易。</p>
</blockquote>
<ul>
<li>可以在<code>Info.plist</code>文件中设置应用启动时首次加载的<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%885.08.53.png" alt="Alt text"></li>
<li>一个应用中可以有多个<code>storyboard</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8810.48.12.png" alt="Alt text"></li>
<li><code>storyboard</code>中指出了首先会被加载的<code>view</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.42.10.png" alt="Alt text"></li>
<li>查看视图控制器绑定的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-06%20%E4%B8%8B%E5%8D%8811.48.33.png" alt="Alt text"></li>
<li>在多个视图之间建立动作关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-storyboard-1.gif" alt="Alt text"></li>
</ul>
<h3 id="1-4-2-图片控件"><a href="#1-4-2-图片控件" class="headerlink" title="1.4.2    图片控件"></a>1.4.2    图片控件</h3><blockquote>
<p><strong>说明：</strong>在<code>xcode</code>中图片控件的创建和使用</p>
</blockquote>
<ol>
<li>将本地的图片拖入到项目中<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img.gif" alt="Alt text"></li>
<li>创建<code>Image View</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-img-02.gif" alt="Alt text"></li>
</ol>
<h3 id="1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码"><a href="#1-4-3-ios-UI界面设计中传统方法和Assistant-editor绑定代码" class="headerlink" title="1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码"></a>1.4.3    ios UI界面设计中传统方法和Assistant editor绑定代码</h3><blockquote>
<p><strong>说明：</strong><code>程序</code>和<code>控件</code>的绑定，有两种方式</p>
</blockquote>
<h4 id="方式1：ios-UI界面设计中传统方法"><a href="#方式1：ios-UI界面设计中传统方法" class="headerlink" title="方式1：ios UI界面设计中传统方法"></a>方式1：ios UI界面设计中传统方法</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>在<code>Controller</code>中定义<code>@IBOutlet</code>修饰的引用控件的属性</li>
<li>通过拖动建立<code>@IBOutlet</code>引用的控件和属性所在类文件之间的关联</li>
<li>在<code>Controller</code>中通过<code>@IBOutlet</code>属性使用控件</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bind.gif" alt="Alt text"></p>
</blockquote>
<h4 id="方式2：借助Assistant-editor绑定代码"><a href="#方式2：借助Assistant-editor绑定代码" class="headerlink" title="方式2：借助Assistant editor绑定代码"></a>方式2：借助<code>Assistant editor</code>绑定代码</h4><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>打开辅助窗口</li>
<li>拖线</li>
<li>设置关联</li>
<li>connect</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-bond2.gif" alt="Alt text"></p>
</blockquote>
<h3 id="1-4-4-ios-Story-Board控制事件绑定"><a href="#1-4-4-ios-Story-Board控制事件绑定" class="headerlink" title="1.4.4    ios Story Board控制事件绑定"></a>1.4.4    ios Story Board控制事件绑定</h3><blockquote>
<p><strong>说明：</strong>步骤如下</p>
<ol>
<li>编写<code>@IBAction</code></li>
<li>在<code>storyboard</code>中通过拖动在控件与<code>controller</code>中相应的<code>IBAction</code>之间建立关联</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-event.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 和按钮建立关联的点击事件响应函数</span></span><br><span class="line">    @IBAction func btnClicked(sender:AnyObject) &#123;</span><br><span class="line">        print(<span class="string">"clicked"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-5-iOS-Storyboard控件与Swift类绑定"><a href="#1-4-5-iOS-Storyboard控件与Swift类绑定" class="headerlink" title="1.4.5    iOS Storyboard控件与Swift类绑定"></a>1.4.5    iOS Storyboard控件与Swift类绑定</h3><blockquote>
<p><strong>说明：</strong>新添加的<code>Storyboard</code>控件默认并没有和自定义的类绑定，和自定义的类绑定就可以通过代码自定义该控件</p>
<ol>
<li>设置绑定的类的类名<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-09%20%E4%B8%8B%E5%8D%8811.53.07.png" alt="Alt text"></li>
<li>对应的自定义类中要实现父类的必要构造器（如果有的话）</li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 必须重写该 必要构造器</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-6-ios源代码添加控件"><a href="#1-4-6-ios源代码添加控件" class="headerlink" title="1.4.6    ios源代码添加控件"></a>1.4.6    ios源代码添加控件</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	...</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个控件</span></span><br><span class="line">        var label = <span class="built_in">UILabel</span>(frame: <span class="built_in">CGRect</span>(x: <span class="number">50</span>, y: <span class="number">50</span>, width: <span class="number">200</span>, height: <span class="number">100</span>))</span><br><span class="line">        <span class="comment">// 设置控件</span></span><br><span class="line">        label.text = <span class="string">"Hello jikexueyuan"</span></span><br><span class="line">        <span class="comment">// 将控件添加到视图</span></span><br><span class="line">        view.addSubview(label)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<h3 id="1-4-7-ios浏览器开发制作"><a href="#1-4-7-ios浏览器开发制作" class="headerlink" title="1.4.7    ios浏览器开发制作"></a>1.4.7    ios浏览器开发制作</h3><blockquote>
<p><strong>说明：</strong>需要解决<code>http</code>请求受限的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.55.08.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8A%E5%8D%881.54.48.png" alt="Alt text"><br><img src="./屏幕快照 2016-02-10 上午1.59.15.png" alt="Alt text"></p>
<h2 id="1-5-ios自定义控件实例"><a href="#1-5-ios自定义控件实例" class="headerlink" title="1.5    ios自定义控件实例"></a>1.5    ios自定义控件实例</h2><h3 id="1-5-1-配置iOS自定义控件属性"><a href="#1-5-1-配置iOS自定义控件属性" class="headerlink" title="1.5.1    配置iOS自定义控件属性"></a>1.5.1    配置iOS自定义控件属性</h3><blockquote>
<p><strong>说明：</strong><code>Xcode</code>提供的所有控件都可以在<code>Storyboard</code>中进行一系列的配置。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%886.02.15.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-button.gif" alt="Alt text"></p>
<h3 id="1-5-2-自定义原型进度指示控件实例"><a href="#1-5-2-自定义原型进度指示控件实例" class="headerlink" title="1.5.2    自定义原型进度指示控件实例"></a>1.5.2    自定义原型进度指示控件实例</h3><blockquote>
<p><strong>说明：</strong>使用绘图<code>API</code>编写自定义一个进度条控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-10%20%E4%B8%8B%E5%8D%8811.38.03.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
</blockquote>
<p><code>ProgressBar.swift</code></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ProgressBar: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">        <span class="comment">// 设置背景透明</span></span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = <span class="built_in">UIColor</span>(white: <span class="number">1</span>, alpha: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进度值</span></span><br><span class="line">    private var _progressValue: <span class="built_in">CGFloat</span> = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注意：不可以在某个实体中定义访问级别更高的实体</span></span><br><span class="line">    internal func getProgressValue() -&gt; <span class="built_in">CGFloat</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> _progressValue</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    internal func setProgressValue (value: <span class="built_in">CGFloat</span>) &#123;</span><br><span class="line">        _progressValue = value</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 改变值后需要重绘</span></span><br><span class="line">        setNeedsDisplay()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 控件绘制函数</span></span><br><span class="line">    <span class="comment">// Only override drawRect: if you perform custom drawing.</span></span><br><span class="line">    <span class="comment">// An empty implementation adversely affects performance during animation.</span></span><br><span class="line">    override func drawRect(rect: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="comment">// Drawing code</span></span><br><span class="line">        <span class="comment">// 获得当前图形绘制的上下文</span></span><br><span class="line">        let ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="comment">// 半径</span></span><br><span class="line">        let r = rect.width / <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 绘制圆</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 设置圆的填充色：灰色、不透明</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">0.7</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加一段弧形弧形</span></span><br><span class="line">        <span class="built_in">CGContextAddArc</span>(ctx, r, r, r, <span class="number">0</span>, <span class="number">3.141592654</span> * <span class="number">2</span> * _progressValue , <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 添加一条线</span></span><br><span class="line">        <span class="built_in">CGContextAddLineToPoint</span>(ctx, r, r)</span><br><span class="line">        <span class="comment">// 设置扇形的填充色</span></span><br><span class="line">        <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 绘制</span></span><br><span class="line">        <span class="built_in">CGContextFillPath</span>(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var pc: ProgressBar!</span><br><span class="line">    <span class="comment">// 响应AddProgress点击</span></span><br><span class="line">    @IBAction func addProgressBtnPressed(sender: AnyObject) &#123;</span><br><span class="line">        pc.setProgressValue(pc.getProgressValue() + <span class="number">0.1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="comment">// 创建进度条</span></span><br><span class="line">        pc = ProgressBar(frame: <span class="built_in">CGRect</span>(x: <span class="number">100</span>, y: <span class="number">100</span>, width: <span class="number">100</span>, height: <span class="number">100</span>))</span><br><span class="line">        pc.setProgressValue(<span class="number">0.2</span>)</span><br><span class="line">        <span class="comment">// 将该进度条添加到所在控制器绑定的视图中</span></span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(pc)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override func didReceiveMemoryWarning() &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-实时预览自定义控件效果"><a href="#1-5-3-实时预览自定义控件效果" class="headerlink" title="1.5.3    实时预览自定义控件效果"></a>1.5.3    实时预览自定义控件效果</h3><blockquote>
<p><strong>说明：</strong><code>自定义控件</code>也可以使用<code>Storyboard</code>设置。步骤如下<br><strong>意义：</strong>开发人员通过代码开发的<code>自定义控件</code>，也可以交给设计人员通过<code>Storyboard</code>进行设计了<br><strong>相关指令：</strong>用来和<code>Storyboard</code>建立关联</p>
</blockquote>
<table>
<thead>
<tr>
<th>指令</th>
<th>修饰目标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@IBDesignable</code></td>
<td><code>class</code></td>
<td>使被修饰的类可以通过<code>Storyboard</code>设置</td>
</tr>
<tr>
<td><code>@IBInspectable</code></td>
<td>属性</td>
<td>使被修饰的属性可以在<code>Storyboard</code>中设置</td>
</tr>
</tbody>
</table>
<ol>
<li>在<code>Project</code>中创建新<code>target</code>（自定义需要在单独的<code>target</code>中才能被<code>Storyboard</code>管理）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-custom.gif" alt="Alt text"></li>
<li>在新创建的<code>target</code>中创建自定义控件的类（<code>@IBDesignable</code>），类中可以设置一些可在<code>Storyboard</code>设置的属性（<code>@IBInspectable</code>）<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.13.21.png" alt="Alt text"></li>
</ol>
<p><em>MyView.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">@IBDesignable class MyView: <span class="built_in">UIView</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重写必要构造器（否则不会被Storyboard初始化）</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override init(frame: <span class="built_in">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自定义一些可以在Storyboard中设置的项</span></span><br><span class="line">    @IBInspectable var str: String = <span class="string">"Hello"</span><span class="comment">// 字符串</span></span><br><span class="line">    @IBInspectable var borderWidth: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框宽度</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderWidth = borderWidth</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var borderColor: <span class="built_in">UIColor</span> = <span class="built_in">UIColor</span>.clearColor() &#123;<span class="comment">// 边框颜色</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.borderColor = borderColor.CGColor</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @IBInspectable var cornerRadius: <span class="built_in">CGFloat</span> = <span class="number">0</span> &#123;<span class="comment">// 边框圆角</span></span><br><span class="line">        didSet &#123;</span><br><span class="line">            layer.cornerRadius = cornerRadius</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>Storyboard</code>中添加一个<code>View</code>（控件），并设置关联的类<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8A%E5%8D%8812.04.07.png" alt="Alt text"></li>
</ol>
<h2 id="1-6-使用StoryBoard做ios-UI界面跳转"><a href="#1-6-使用StoryBoard做ios-UI界面跳转" class="headerlink" title="1.6    使用StoryBoard做ios UI界面跳转"></a>1.6    使用StoryBoard做ios UI界面跳转</h2><h3 id="1-6-1-用iOS-Storyboard做界面跳转"><a href="#1-6-1-用iOS-Storyboard做界面跳转" class="headerlink" title="1.6.1    用iOS Storyboard做界面跳转"></a>1.6.1    用iOS Storyboard做界面跳转</h3><blockquote>
<p><strong>说明：</strong>跳转到下一个<code>view</code>并且能够返回<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_switch.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-6-1-2-跳转到下一页"><a href="#1-6-1-2-跳转到下一页" class="headerlink" title="1.6.1.2    跳转到下一页"></a>1.6.1.2    跳转到下一页</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_next.gif" alt="Alt text"></p>
<h4 id="1-6-1-3-返回"><a href="#1-6-1-3-返回" class="headerlink" title="1.6.1.3    返回"></a>1.6.1.3    返回</h4><blockquote>
<p><strong>说明：</strong>使用<code>IBAction</code>结合<code>dismissViewControllerAnimated</code>方法，步骤如下</p>
<ol>
<li>新建一个和第二个<code>view</code>关联的类（<code>UIViewController</code>子类）</li>
<li>结合<code>辅助窗口</code>在第二个<code>view controller</code>做<code>IBAction</code>并在响应方法中调用<code>dismissViewControllerAnimated</code><br><em>ImgViewController.swift</em></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ImgViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func backBtnClicked(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;() -&gt; Void <span class="keyword">in</span></span><br><span class="line">            print(<span class="string">"return"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// storyboard载入时调用的初始化方法</span></span><br><span class="line">    required init?(coder aDecoder: <span class="built_in">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.init(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-使用nib文件做iOS界面设计"><a href="#1-6-2-使用nib文件做iOS界面设计" class="headerlink" title="1.6.2    使用nib文件做iOS界面设计"></a>1.6.2    使用nib文件做iOS界面设计</h3><blockquote>
<p><strong>说明：</strong><code>Xcode4</code>之后<code>IB(Interface Builder)</code>和<code>Xcode</code>才集成在一起。使用方式如下</p>
<ol>
<li><p>创建<code>Cocoa class</code>时勾选<code>Alse create XIB File</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-12%20%E4%B8%8B%E5%8D%885.22.14.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.47.13.png" alt="Alt text"></p>
</li>
<li><p>使用<code>presentModalViewController方法</code>从<code>Storyboard</code>管理的<code>view</code>跳转到<code>nib</code>管理的<code>view</code></p>
</li>
</ol>
<p><strong>注意：</strong>传统使用的是<code>nib</code>（而不是<code>Storyboard</code>）进行界面设计的。<code>nib</code>的操作方式和<code>Storyboard</code>中单个<code>view</code>类似。</p>
</blockquote>
<hr>
<p><em>ViewControllew.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.58.26.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">	<span class="comment">// 下一个view</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>MyViewController.swift</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8810.59.55.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-在iOS界面间传递数据"><a href="#1-6-3-在iOS界面间传递数据" class="headerlink" title="1.6.3    在iOS界面间传递数据"></a>1.6.3    在iOS界面间传递数据</h3><blockquote>
<p><strong>说明：</strong>本质上只是为和下一个<code>view</code>绑定的<code>controller</code>设置一个属性。<br><strong>扩展：</strong>也可以在后一个<code>view</code>通过<code>parentViewController</code>访问前一个<code>view</code></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.16.29.png" alt="Alt text"></p>
<p><em>ViewControllew.swift：设置信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输入框</span></span><br><span class="line">    @IBOutlet var input: <span class="built_in">UITextField</span>!</span><br><span class="line">    <span class="comment">// 下一页</span></span><br><span class="line">    @IBAction func goToNextPage(sender: AnyObject) &#123;</span><br><span class="line">        let vc = MyViewController(nibName: <span class="string">"MyViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 设置信息</span></span><br><span class="line">        vc.labelContent = input.text!</span><br><span class="line">        <span class="keyword">self</span>.presentViewController(vc, animated: <span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>MyViewControllew.swift：展示信息</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class MyViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">    var labelContent: String = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var myLabel: <span class="built_in">UILabel</span>!</span><br><span class="line">    <span class="comment">// 返回上一个view</span></span><br><span class="line">    @IBAction func returnPrevPage(sender: AnyObject) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dismissViewControllerAnimated(<span class="literal">true</span>, completion: &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        myLabel.text = labelContent<span class="comment">// 展示信息</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-7-屏幕适配"><a href="#1-7-屏幕适配" class="headerlink" title="1.7    屏幕适配"></a>1.7    屏幕适配</h2><blockquote>
<p><strong>变动：</strong>在<code>Xcode 7</code>中，<code>Editor(menu)-&gt;Pin</code>消失了，该菜单项中原本有一些样式设计功能。</p>
</blockquote>
<h3 id="1-7-1-匹配父级容器"><a href="#1-7-1-匹配父级容器" class="headerlink" title="1.7.1    匹配父级容器"></a>1.7.1    匹配父级容器</h3><blockquote>
<p><strong>说明：</strong>就是让<code>目标容器</code>以他的<code>父级容器</code>为参照系进行设置<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-13%20%E4%B8%8B%E5%8D%8811.56.36.png" alt="Alt text"><br><strong>扩展：</strong>控件<code>UIImageVIew</code>可以设置其中图片的铺排模式<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-14%20%E4%B8%8A%E5%8D%8812.00.37.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-7-2-分割父级容器"><a href="#1-7-2-分割父级容器" class="headerlink" title="1.7.2    分割父级容器"></a>1.7.2    分割父级容器</h3><blockquote>
<p><strong>说明：</strong>指的是多个兄弟<code>view</code>使用父级<code>view</code>的方式。<br><strong>扩展：</strong><code>Xcode 7</code>推出了一种新的方式<code>stack view</code>，来进行布局管理，可以将多个<code>view</code>作为一个组合进行操作。<br><strong>技巧：</strong><code>stack view</code>可以取代之前需要<code>Horizontal Space</code>（连个<code>view</code>之间的水平间距）的场景</p>
</blockquote>
<h4 id="1-7-2-1-左边固定，右边自适应"><a href="#1-7-2-1-左边固定，右边自适应" class="headerlink" title="1.7.2.1    左边固定，右边自适应"></a>1.7.2.1    左边固定，右边自适应</h4><blockquote>
<p><strong>约束：</strong>设置以下约束</p>
<ul>
<li>两个<code>View</code>之间：<code>Horizontal Spacing</code></li>
<li>左边<code>View</code>：<code>leading</code>、<code>top</code></li>
<li>右边<code>View</code>：<code>tailing</code>、<code>top</code></li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.12.png" alt="Alt text"></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%888.00.01.png" alt="Alt text"></p>
<h4 id="1-7-2-2-多个View按比例"><a href="#1-7-2-2-多个View按比例" class="headerlink" title="1.7.2.2    多个View按比例"></a>1.7.2.2    多个<code>View</code>按比例</h4><blockquote>
<p><strong>说明：</strong>2个或更多个<code>View</code>的宽度（或高度）按一定比例分割父级容器的剩余空间<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8A%E5%8D%889.51.01.png" alt="Alt text"></p>
</blockquote>
<p><img src="./http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-20%20%E4%B8%8B%E5%8D%887.47.27.png" alt="Alt text"></p>
<h3 id="1-7-3-复杂布局适配"><a href="#1-7-3-复杂布局适配" class="headerlink" title="1.7.3    复杂布局适配"></a>1.7.3    复杂布局适配</h3><blockquote>
<p><strong>说明：</strong>上部左右均分，下部占用剩余部分<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.53.19.png" alt="Alt text"> <img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%886.05.43.png" alt="Alt text"> </p>
</blockquote>
<p><em>底层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%888.58.22.png" alt="Alt text"></p>
<p><em>顶层</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-22%20%E4%B8%8B%E5%8D%889.41.32.png" alt="Alt text"></p>
<h2 id="1-8-iOS平台常用传感器"><a href="#1-8-iOS平台常用传感器" class="headerlink" title="1.8    iOS平台常用传感器"></a>1.8    iOS平台常用传感器</h2><h4 id="CMMotionManager类"><a href="#CMMotionManager类" class="headerlink" title="CMMotionManager类"></a>CMMotionManager类</h4><blockquote>
<p><strong>说明：</strong>管理传感器的类。<br><strong>库：</strong><code>CoreMotion</code></p>
</blockquote>
<h3 id="1-8-1-iOS平台加速度传感器的使用方式"><a href="#1-8-1-iOS平台加速度传感器的使用方式" class="headerlink" title="1.8.1    iOS平台加速度传感器的使用方式"></a>1.8.1    iOS平台加速度传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>可以获得三个方向上的加速度。</p>
</blockquote>
<table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>accelerometerAvailable</td>
<td>Bool</td>
<td>加速器是否可用</td>
</tr>
<tr>
<td>accelerometerUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startAccelerometerUpdatesToQueue</td>
<td>func</td>
<td>启动加速器</td>
</tr>
<tr>
<td>stopAccelerometerUpdates</td>
<td>func</td>
<td>停止加速器</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>加速度传感器<code>启动</code>后，应当在适当的时候<code>停掉</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取减速器数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 加速度 */</span></span><br><span class="line">        cmm.accelerometerUpdateInterval = <span class="number">1</span><span class="comment">// 每秒获取的次数</span></span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerAvailable &amp;&amp; !cmm.accelerometerActive &#123;</span><br><span class="line">            <span class="comment">// start后一定要stop</span></span><br><span class="line">            cmm.startAccelerometerUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMAccelerometerData</span>?, err:<span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"AccesslateData: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"加速器传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦测加速度</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopAccelerateremoterUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cmm.accelerometerActive &amp;&amp; cmm.accelerometerActive &#123;</span><br><span class="line">            cmm.stopAccelerometerUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-2-iOS平台陀螺仪的使用方式"><a href="#1-8-2-iOS平台陀螺仪的使用方式" class="headerlink" title="1.8.2    iOS平台陀螺仪的使用方式"></a>1.8.2    iOS平台陀螺仪的使用方式</h3><table>
<thead>
<tr>
<th>CMMotionManager相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>gyroAvailable</td>
<td>Bool</td>
<td>陀螺仪是否可用</td>
</tr>
<tr>
<td>gyroUpdateInterval</td>
<td>NSTimeInterval</td>
<td>每秒获取数据数（获取频率）</td>
</tr>
<tr>
<td>startGyroUpdatesToQueue</td>
<td>func</td>
<td>开始读区陀螺仪数据</td>
</tr>
<tr>
<td>stopGyroUpdates</td>
<td>func</td>
<td>停止读取陀螺仪数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreMotion</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 声明传感器控制器</span></span><br><span class="line">    <span class="keyword">var</span> cmm: <span class="type">CMMotionManager</span>!</span><br><span class="line">    <span class="keyword">var</span> q: <span class="type">NSOperationQueue</span>!</span><br><span class="line">    <span class="comment">// 2. 载入视图时初始化加速度传感器</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        cmm = <span class="type">CMMotionManager</span>()</span><br><span class="line">        q = <span class="type">NSOperationQueue</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始获取陀螺仪数据的任务</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        cmm.gyroUpdateInterval = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroAvailable &amp;&amp; !cmm.gyroActive &#123;</span><br><span class="line">            cmm.startGyroUpdatesToQueue(q, withHandler: &#123;</span><br><span class="line">                (data:<span class="type">CMGyroData</span>?, err: <span class="type">NSError</span>?) <span class="keyword">in</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Gyno data: \(data)"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"陀螺仪传感器不可用！"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测陀螺仪</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopGyroUpdate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">/* 陀螺仪 */</span></span><br><span class="line">        <span class="keyword">if</span> cmm.gyroActive &amp;&amp; cmm.gyroActive &#123;</span><br><span class="line">            cmm.stopGyroUpdates()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-3-iOS平台距离传感器的使用方式"><a href="#1-8-3-iOS平台距离传感器的使用方式" class="headerlink" title="1.8.3    iOS平台距离传感器的使用方式"></a>1.8.3    iOS平台距离传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">     <span class="comment">/**</span><br><span class="line">     * 开始侦听距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().proximityMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听距离传感器</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="type">Selector</span>(<span class="string">"proximityChanged"</span>), name: <span class="type">UIDeviceProximityStateDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到proximityChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 距离变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">proximityChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().proximityState)"</span>)<span class="comment">// 距离传感器前是否有障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 停止侦测距离传感器</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenProximity</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startAccelerateremoterUpdate()</span><br><span class="line">        startGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        stopAccelerateremoterUpdate()</span><br><span class="line">        stopGyroUpdate()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-4-iOS平台电源传感器的使用方式"><a href="#1-8-4-iOS平台电源传感器的使用方式" class="headerlink" title="1.8.4    iOS平台电源传感器的使用方式"></a>1.8.4    iOS平台电源传感器的使用方式</h3><blockquote>
<p><strong>说明：</strong>相关类</p>
<ul>
<li><code>UIDevice</code></li>
<li><code>NSNotificationCenter</code></li>
<li><code>UIDeviceProximityStateDidChangeNotification</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 开始侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">startListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">UIDevice</span>.currentDevice().batteryMonitoringEnabled = <span class="literal">true</span><span class="comment">// 是否侦听电量</span></span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="string">"levelChanged"</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 将距离传感器侦测到的变化通知到levelChanged方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 电量变化被侦测到时调用的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">levelChanged</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(UIDevice.currentDevice().batteryLevel)"</span>)<span class="comment">// 0～1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 停止侦听电量</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">stopListenLevel</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>, name: <span class="type">UIDeviceBatteryLevelDidChangeNotification</span>, object: <span class="literal">nil</span>)<span class="comment">// 移除当前view中的所有电量侦听任务</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 3. 页面展现时开始侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        startListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 页面退出时停止侦测</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">	    stopListenLevel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-5-iOS平台磁场传感器的使用方式"><a href="#1-8-5-iOS平台磁场传感器的使用方式" class="headerlink" title="1.8.5    iOS平台磁场传感器的使用方式"></a>1.8.5    iOS平台磁场传感器的使用方式</h3><h4 id="CLLocationManager类"><a href="#CLLocationManager类" class="headerlink" title="CLLocationManager类"></a>CLLocationManager类</h4><table>
<thead>
<tr>
<th>相关实例成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>delegate</td>
<td>Class(采纳CLLocationManagerDelegate协议)</td>
<td>委托对象</td>
</tr>
<tr>
<td>startUpdatingHeading</td>
<td>func</td>
<td>开始侦测方位数据</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">CLLocationManagerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* 1. 声明方位管理器 */</span></span><br><span class="line">    <span class="keyword">var</span> lm:<span class="type">CLLocationManager</span>!</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="comment">/* 2. 初始化方位管理器 */</span></span><br><span class="line">        lm = <span class="type">CLLocationManager</span>()</span><br><span class="line">        lm.delegate = <span class="keyword">self</span><span class="comment">// 指定 delegate（需要采纳CLLocationManagerDelegate协议）</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 3. view渲染时启动侦测 */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 启动任务：不断获取指南针数据</span></span><br><span class="line">        lm.startUpdatingHeading()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 采纳协议（CLLocationManagerDelegate）</span><br><span class="line">    * 当方位发生变化时调用该方法</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">locationManager</span><span class="params">(manager: CLLocationManager, didUpdateHeading newHeading: CLHeading)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(newHeading)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-8-6-使用磁场传感器制作指南针实例"><a href="#1-8-6-使用磁场传感器制作指南针实例" class="headerlink" title="1.8.6    使用磁场传感器制作指南针实例"></a>1.8.6    使用磁场传感器制作指南针实例</h3><h2 id="1-9-多点触控"><a href="#1-9-多点触控" class="headerlink" title="1.9    多点触控"></a>1.9    多点触控</h2><h3 id="1-9-1-触摸事件处理"><a href="#1-9-1-触摸事件处理" class="headerlink" title="1.9.1    触摸事件处理"></a>1.9.1    触摸事件处理</h3><blockquote>
<p><strong>说明：</strong>触摸事件分4种，分别对应四种方法（<code>ViewController</code>的成员方法）</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>touchesBegin</td>
<td>手指接触屏幕</td>
</tr>
<tr>
<td>touchesCancel</td>
<td>系统事件打断了触摸事件时</td>
</tr>
<tr>
<td>touchesEnded</td>
<td>手指离开屏幕</td>
</tr>
<tr>
<td>touchesMoved</td>
<td>手指在屏幕上滑动</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesBegin"</span>)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        <span class="comment">// 获得在滑动屏幕时手指所在的区域的坐标（只获得了其中一个手指的）</span></span><br><span class="line">        touches.first?.locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesEnded</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesEnded"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesCancelled</span><span class="params">(touches: Set&lt;UITouch&gt;?, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesCancelled"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-2-处理多个触摸点"><a href="#1-9-2-处理多个触摸点" class="headerlink" title="1.9.2    处理多个触摸点"></a>1.9.2    处理多个触摸点</h3><blockquote>
<p><strong>技巧：</strong>可以在模拟器中模拟多点触控，方式是鼠标在模拟器上滑动式按住<code>alt(option)</code>键。<br><strong>注意：</strong>程序默认不启动对多点触控的支持，需要在代码中设置开启多点触控。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">		...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"touchesMoved"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得触摸点数量</span></span><br><span class="line">        <span class="built_in">print</span>(touches.<span class="built_in">count</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得每个触摸点在滑动屏幕时所在的区域的坐标</span></span><br><span class="line">        <span class="keyword">for</span> touch <span class="keyword">in</span> touches &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(touch.locationInView(self.view))"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-9-3-缩放图片实例"><a href="#1-9-3-缩放图片实例" class="headerlink" title="1.9.3    缩放图片实例"></a>1.9.3    缩放图片实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_touch.gif" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">UIKit</span></span><br><span class="line"></span><br><span class="line">class ViewController: <span class="built_in">UIViewController</span> &#123;</span><br><span class="line">    private var lastDistance: Float = <span class="number">0.0</span><span class="comment">// 两个触摸点之间的距离</span></span><br><span class="line">    </span><br><span class="line">    @IBOutlet var iv: <span class="built_in">UIImageView</span>!<span class="comment">// 图片控件</span></span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">self</span>.view.multipleTouchEnabled = <span class="literal">true</span><span class="comment">// 启动多点触摸</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesBegan(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        lastDistance = <span class="number">0.0</span><span class="comment">// 用户开始触摸屏幕时设置初始值</span></span><br><span class="line">    &#125;</span><br><span class="line">    override func touchesMoved(touches: Set&lt;<span class="built_in">UITouch</span>&gt;, withEvent event: <span class="built_in">UIEvent</span>?) &#123;</span><br><span class="line">        <span class="comment">// 判断是不是两点触控</span></span><br><span class="line">        <span class="keyword">if</span> touches.count == <span class="number">2</span> &#123;</span><br><span class="line">            <span class="comment">// 对 Set 排序，才能通过下标进行索引</span></span><br><span class="line">            var touchesSorted = touches.sort(&#123;s1, s2 <span class="keyword">in</span> s1.tapCount.bigEndian &gt; s1.tapCount.bigEndian&#125;)</span><br><span class="line">            <span class="comment">// 通过勾股定理计算两点之间的距离</span></span><br><span class="line">            let p1 = touchesSorted[<span class="number">0</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let p2 = touchesSorted[<span class="number">1</span>].locationInView(<span class="keyword">self</span>.view)</span><br><span class="line">            let xx = p1.x - p2.x</span><br><span class="line">            let yy = p1.y - p2.y</span><br><span class="line">            </span><br><span class="line">            let curDistance = Float(sqrt(xx * xx + yy * yy))</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 首次缩放触摸操作</span></span><br><span class="line">            <span class="keyword">if</span> lastDistance == <span class="number">0.0</span> &#123;</span><br><span class="line">                lastDistance = curDistance</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 缩小</span></span><br><span class="line">                <span class="keyword">if</span> lastDistance - curDistance &gt; <span class="number">5</span> &#123;</span><br><span class="line">                    print(<span class="string">"缩小"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">0.9</span>, <span class="number">0.9</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 放大</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> lastDistance - curDistance &lt; <span class="number">-5</span>&#123;</span><br><span class="line">                    print(<span class="string">"放大"</span>)</span><br><span class="line">                    lastDistance = curDistance</span><br><span class="line">                    iv.transform = <span class="built_in">CGAffineTransformScale</span>(iv.transform, <span class="number">1.1</span>, <span class="number">1.1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-10-常用其它功能"><a href="#1-10-常用其它功能" class="headerlink" title="1.10    常用其它功能"></a>1.10    常用其它功能</h2><h3 id="1-10-1-打开网页"><a href="#1-10-1-打开网页" class="headerlink" title="1.10.1    打开网页"></a>1.10.1    打开网页</h3><blockquote>
<p><strong>说明：</strong>在<code>Safari</code>中打开指定连接<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S_call.gif" alt="Alt text"><br><strong>相关类：</strong><code>UIApplication</code></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">openJikexueyuanPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-2-常用打开操作（发邮件、打电话、发短信）"><a href="#1-10-2-常用打开操作（发邮件、打电话、发短信）" class="headerlink" title="1.10.2    常用打开操作（发邮件、打电话、发短信）"></a>1.10.2    常用打开操作（发邮件、打电话、发短信）</h3><blockquote>
<p><strong>说明：</strong>和打开网页类似，只是使用的<code>URL</code>协议不同</p>
</blockquote>
<p><em>ViewController.swift</em> </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 发短信</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendSMSBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"sms://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 打电话</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">makeCallBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"tel://10086"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发邮件</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">sendMailBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"mailto://xx@jikexueyuan.com"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-3-自定义打开协议"><a href="#1-10-3-自定义打开协议" class="headerlink" title="1.10.3    自定义打开协议"></a>1.10.3    自定义打开协议</h3><blockquote>
<p><strong>说明：</strong>可以通过自定一些<code>URL</code>协议<br><strong>案例：</strong>通过自定义的<code>URL</code>协议<code>ime</code>打开另一个<code>App</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_handler.gif" alt="Alt text"></p>
</blockquote>
<h4 id="1-10-3-1-注册协议的app"><a href="#1-10-3-1-注册协议的app" class="headerlink" title="1.10.3.1    注册协议的app"></a>1.10.3.1    注册协议的app</h4><ol>
<li><p>在<code>Info.list</code>中设置一个<code>URL Schemes</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-25%20%E4%B8%8B%E5%8D%889.42.43.png" alt="Alt text"></p>
</li>
<li><p>创建要被协议打开的<code>View</code>（带有<code>xib</code>）<br><em>LabelViewController.swift</em></p>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LabelViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> myLabel: <span class="type">UILabel</span>!</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>LabelViewController.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.55.25.png" alt="Alt text"></p>
<ol>
<li><code>AppDelegate.swift</code>：实现通过URL打开该<code>App</code>的构造函数</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// 为自定义的URL协议注册实现</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, handleOpenURL url: NSURL)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// 从应用的LabelViewController.xib指定的view启动</span></span><br><span class="line">        <span class="keyword">let</span> vc = <span class="type">LabelViewController</span>(nibName: <span class="string">"LabelViewController"</span>, bundle: <span class="literal">nil</span>)</span><br><span class="line">        window?.addSubview(vc.view)</span><br><span class="line">        <span class="comment">// 设置view</span></span><br><span class="line">        vc.myLabel.text = <span class="string">"\(url)"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-10-3-2-通过协议打开app"><a href="#1-10-3-2-通过协议打开app" class="headerlink" title="1.10.3.2    通过协议打开app"></a>1.10.3.2    通过协议打开app</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-26%20%E4%B8%8A%E5%8D%889.58.00.png" alt="Alt text"></p>
<p><em>viewcontroller.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ime</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">callImePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="type">UIApplication</span>.sharedApplication().openURL(<span class="type">NSURL</span>(string: <span class="string">"ime://i.loce.you?h=Hello&amp;b=world"</span>)!)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-10-4-获取photo"><a href="#1-10-4-获取photo" class="headerlink" title="1.10.4    获取photo"></a>1.10.4    获取photo</h3><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/" itemprop="url">
                  4 初级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:38:36+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS初级_4  初级ios开发工程师面试题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-c语言"><a href="#4-1-c语言" class="headerlink" title="4.1    c语言"></a>4.1    c语言</h2><h3 id="4-1-1-指针"><a href="#4-1-1-指针" class="headerlink" title="4.1.1    指针"></a>4.1.1    指针</h3><blockquote>
<p><strong>说明：</strong><code>a</code>和<code>&amp;a</code>包含的地址相同，但含义不同</p>
<ul>
<li>a：数组的首地址，也就是 a[0]的地址</li>
<li>&amp;a：对象的首地址，也就是数组的地址</li>
</ul>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">main &#123;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">	<span class="comment">// a:相当于a[0]</span></span><br><span class="line">	<span class="comment">// &amp;a：数组的地址</span></span><br><span class="line">	<span class="comment">// (&amp;a + 1)：指针加1根据指针的类型增加的量不同，a是指向数组的指针，数组的大小为5个Int，因此(&amp;a + 1)指向a[5]（溢出）</span></span><br><span class="line">	<span class="comment">// *(ptr - 1)：因为ptr指向的是元素，因此*(ptr - 1)为a[4]</span></span><br><span class="line">	<span class="keyword">int</span> *ptr = (int *)(&amp;a + <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d, %d"</span>, *(a + <span class="number">1</span>), *(ptr - <span class="number">1</span>));<span class="comment">// 2, 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-Object-C笔试"><a href="#4-2-Object-C笔试" class="headerlink" title="4.2    Object-C笔试"></a>4.2    Object-C笔试</h2><h3 id="4-2-1-写一个NSString类的实现"><a href="#4-2-1-写一个NSString类的实现" class="headerlink" title="4.2.1     写一个NSString类的实现"></a>4.2.1     写一个NSString类的实现</h3><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法：初始化</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 类方法（工厂方法）</span><br><span class="line">* @param &#123;char *&#125; const nullTerminatedCString 字符串（不带\0结尾）</span><br><span class="line">* @param &#123;NSStringEncoding&#125; encoding 编码方式</span><br><span class="line">* @return &#123;&#125; 实例</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>)initWithCString:(<span class="keyword">const</span> <span class="keyword">char</span> *)nullTerminatedCString encoding:(<span class="built_in">NSStringEncoding</span>)encoding &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *obj;</span><br><span class="line">	<span class="comment">// 分配内存</span></span><br><span class="line">	obj = [slef allocWithZero: <span class="built_in">NSDefaultMallocZone</span>()];</span><br><span class="line">	<span class="comment">// 初始化</span></span><br><span class="line">	obj = [obj initWithCString: nullTerminatedCString encodign: encoding];</span><br><span class="line">	<span class="keyword">return</span> AUTORELEASE(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？"><a href="#4-2-2-Object-C-有多重继承吗？不是的话有什么替代方法？" class="headerlink" title="4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？"></a>4.2.2    Object-C 有多重继承吗？不是的话有什么替代方法？</h3><blockquote>
<p><strong>答：</strong><code>cocoa</code>中所有的类都是<code>NSObject</code>的子类，多继承在这里是用<code>protocol</code>委托代理来实现的。</p>
</blockquote>
<h3 id="4-2-3-Object-C有私有方法吗？私有变量呢？"><a href="#4-2-3-Object-C有私有方法吗？私有变量呢？" class="headerlink" title="4.2.3    Object-C有私有方法吗？私有变量呢？"></a>4.2.3    Object-C有私有方法吗？私有变量呢？</h3><blockquote>
<p><strong>答：</strong><code>Object-C</code>类里面的方法只有两种，<code>静态方法</code>和<code>实例方法</code>。</p>
<ul>
<li>实例变量：默认都是私有的</li>
<li>实例方法：默认都是共有的</li>
</ul>
</blockquote>
<h3 id="4-2-4-const以为这只读，下面的声明都是什么意思？"><a href="#4-2-4-const以为这只读，下面的声明都是什么意思？" class="headerlink" title="4.2.4    const以为这只读，下面的声明都是什么意思？"></a>4.2.4    const以为这只读，下面的声明都是什么意思？</h3><blockquote>
<p><strong>const作用：</strong></p>
<ol>
<li>声明变量：阻止一个变量被修改 </li>
<li>声明指针：可以指定指针本身为<code>const</code>，也可以指定指针所指的数据为<code>const</code></li>
<li>声明函数：可以修饰形参，表明它是一个输入参数，在函数内部不能改变值</li>
<li>类的成员函数：若指定为<code>const</code>类型，则表明其是一个常函数，不能修改类的成员变量</li>
</ol>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> a;<span class="comment">// 只读整形变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> *a;<span class="comment">// 指向int型常量的指针（整型数不可修改，指针可修改）</span></span><br><span class="line"><span class="keyword">int</span> * <span class="keyword">const</span> a;<span class="comment">//  指向int型变量的只读指针（整型数可修改，指针不可修改）</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> * a <span class="keyword">const</span>;<span class="comment">// 指向int型常量的只读指针(整型不可修改，指针不可修改)</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-5-static的作用"><a href="#4-2-5-static的作用" class="headerlink" title="4.2.5    static的作用"></a>4.2.5    static的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>函数体内：函数体内<code>static</code>变量的作用范围为改函数体，不同于<code>auto</code>变量，该变量的内存只被分配一次，因此其值在下次调用时仍维持上次的值</li>
<li>全局变量：在模块内的<code>static</code>全局变量可以被模块内所有函数访问，但不能被模块外其它函数访问</li>
<li>全局函数：模块内的<code>static</code>函数只可被这一模块内的其它函数调用，这个函数的使用范围被限制在声明它的模块内</li>
<li>类中的成员变量：在类中的<code>static</code>成员变量属于整个类所有，对类的所有对象只有一份拷贝。</li>
<li>类中的成员函数：在类中的<code>static</code>成员函数属于整个类所有，这个函数不接收<code>this</code>指针，因而只能访问类的<code>static</code>成员变量。</li>
</ol>
</blockquote>
<h3 id="4-2-6-extern-“C”的作用"><a href="#4-2-6-extern-“C”的作用" class="headerlink" title="4.2.6    extern “C”的作用"></a>4.2.6    extern “C”的作用</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>被<code>extern &quot;C&quot;</code>限定的函数或变量是<code>extern</code>类型的</li>
<li>被<code>extern &quot;C&quot;</code>限定的变量和函数是按照<code>C</code>语言方式编译和链接的</li>
</ol>
</blockquote>
<h3 id="4-2-7-import跟-include区别，-class呢？"><a href="#4-2-7-import跟-include区别，-class呢？" class="headerlink" title="4.2.7 #import跟#include区别，@class呢？"></a>4.2.7 #import跟#include区别，@class呢？</h3><blockquote>
<p><strong>答：</strong><code>@class</code>一般用于头文件中需要声明该类的某个实例变量的时候用到，在<code>.m</code><br>文件中还是需要使用<code>#import</code>；而<code>#import</code>比起<code>#include</code>的好处就是好不会引起交叉编译。</p>
</blockquote>
<h3 id="4-2-8-Object-C的优缺点"><a href="#4-2-8-Object-C的优缺点" class="headerlink" title="4.2.8    Object-C的优缺点"></a>4.2.8    Object-C的优缺点</h3><blockquote>
<p><strong>优点：</strong></p>
<ol>
<li><code>Cateogies</code></li>
<li><code>Posing</code></li>
<li>动态识别</li>
<li>指标计算</li>
<li>弹性信息传递</li>
<li>不是一个过度复杂的<code>C</code>衍生语言</li>
<li><code>Object-C</code>与<code>C++</code>可以混合编程</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>不支持命名空间</li>
<li>不支持运算符重载</li>
<li>不支持多重继承</li>
<li>使用动态运行时类型，所有的方法都是函数调用，所以很多编译时优化方法都用不到。</li>
</ol>
</blockquote>
<h3 id="4-2-9-Object-C的内存管理"><a href="#4-2-9-Object-C的内存管理" class="headerlink" title="4.2.9    Object-C的内存管理"></a>4.2.9    Object-C的内存管理</h3><blockquote>
<p><strong>说明：</strong>通过分配和初始化（比如<code>[[MyClass alloc] init]</code>）的方式来创建对象，那就拥有这个对象，需要负责该对象的释放。这个规则在使用<code>NSObject</code>的便利方法<code>new</code>时也同样适用。</p>
<ul>
<li><code>拷贝(copy)对象</code>：也会拥有拷贝得到的对象，需要负责该对象的释放</li>
<li><code>保持(retain)对象</code>：部分拥有这个对象，需要在不再适用时释放该对象。</li>
</ul>
<p><strong>注意：</strong>反过来如果从其它对象那里接收到一个对象，则不拥有该对象，也不应该释放它。</p>
</blockquote>
<h3 id="4-2-10-自动释放池是什么，如何工作？"><a href="#4-2-10-自动释放池是什么，如何工作？" class="headerlink" title="4.2.10    自动释放池是什么，如何工作？"></a>4.2.10    自动释放池是什么，如何工作？</h3><blockquote>
<p><strong>答：</strong>当向一个对象发送一个<code>autorelease</code>消息时，<code>Cocoa</code>就会将改对象的一个引用放入到最新的<code>自动释放池</code>。它仍然是个正当的对象，因此<code>自动释放池</code>定义的作用域内的其它对象可以向它发送消息。当程序执行到作用域结束的位置时，自动释放池就会被释放，池中的对象也就被释放。</p>
</blockquote>
<h3 id="4-2-11-堆和栈的区别"><a href="#4-2-11-堆和栈的区别" class="headerlink" title="4.2.11    堆和栈的区别"></a>4.2.11    堆和栈的区别</h3><table>
<thead>
<tr>
<th><em>**</em></th>
<th>堆</th>
<th>栈</th>
</tr>
</thead>
<tbody>
<tr>
<td>管理方式</td>
<td>由编译器自动管理，无序手工控制</td>
<td>释放工作由程序控制，容易产生内存泄漏</td>
</tr>
<tr>
<td>申请大小</td>
<td>是向高地址扩展的数据结构，是不连续的内存区域。堆获得空间比较<code>灵活</code>，也比较<code>大</code>。</td>
<td>在<code>Windows</code>下，栈时向低地址扩展的数据结构，是一块连续的内存区域。能从栈获得的空间较<code>小</code></td>
</tr>
<tr>
<td>碎片问题</td>
<td>频繁的<code>new/delete</code>势必会造成内存空间的不连续，从而造成大量的碎片，使程序效率降低</td>
<td>栈是先进先出的队列，不会产生碎片</td>
</tr>
<tr>
<td>分配方式</td>
<td>动态分配</td>
<td>静态分配和动态分配</td>
</tr>
<tr>
<td>分配效率</td>
<td>堆是<code>c/c++</code>函数库提供的，机制比较复杂</td>
<td>栈是及其系统提供的数据结构，计算机在底层对栈提供支持</td>
</tr>
</tbody>
</table>
<h2 id="4-3-Swift特性"><a href="#4-3-Swift特性" class="headerlink" title="4.3    Swift特性"></a>4.3    Swift特性</h2><blockquote>
<p><strong>答：</strong></p>
<ol>
<li>支持所有<code>C</code>和<code>Object-C</code>的基本类型</li>
<li>提供了两种功能强劲的集合类型<code>Array</code>和<code>Dictionary</code></li>
<li>支持一种新的高级类型<code>元组</code></li>
<li>可选类型</li>
<li>闭包特性</li>
<li>支持脚本语言的特性，但能高效地编译运行</li>
<li>类型安全</li>
</ol>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_25 高级运算符/" itemprop="url">
                  25 高级运算符
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:24+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_25 高级运算符/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_25 高级运算符/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="25-1-位运算符"><a href="#25-1-位运算符" class="headerlink" title="25.1    位运算符"></a>25.1    位运算符</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 支持 <code>C</code> 语言中的全部位运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>符号</th>
<th>名称</th>
<th>返回值</th>
<th>复合运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>~</code></td>
<td>按位取反</td>
<td>将每一个0替换成1，每一个1替换成0</td>
<td><code>~=</code></td>
</tr>
<tr>
<td><code>&amp;</code></td>
<td>按位与</td>
<td>对两个操作数相应的位执行逻辑与运算</td>
<td><code>&amp;=</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>按位亦或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生0</td>
<td><code>^=</code></td>
</tr>
<tr>
<td><code>\</code></td>
<td>按位或</td>
<td>对两个操作数相应的位执行逻辑或操作，都是1时产生1</td>
<td><code>\=</code></td>
</tr>
<tr>
<td><code>&lt;&lt;</code></td>
<td>按位左移</td>
<td>左移n位的结果（左端溢出，右端补0）</td>
<td><code>&lt;&lt;=</code></td>
</tr>
<tr>
<td><code>&gt;&gt;</code></td>
<td>按位右移</td>
<td>右移n位的结果（右端溢出，左端补0或保存符号位而补1</td>
<td><code>&gt;&gt;=</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>用途：</strong>通常被用在底层开发中</p>
<ul>
<li>图形编程</li>
<li>设备驱动</li>
<li>处理外部资源的原始数据（比如对自定义通信协议传输的数据进行编码和解码）</li>
</ul>
</blockquote>
<h3 id="25-1-1-按位取反运算符"><a href="#25-1-1-按位取反运算符" class="headerlink" title="25.1.1    按位取反运算符"></a>25.1.1    按位取反运算符</h3><blockquote>
<p><strong>按位取反操作符：</strong><code>~</code><br><strong>说明：</strong><code>按位取反运算符</code>可以对一个数值的全部比特位进行<code>取反</code><br><strong>语法：</strong>按位取反运算符是一个<code>前缀运算符</code>，需要直接放在<code>运算的数</code>之前，并且它们之间不能添加任何<code>空格</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 00001111</span></span><br><span class="line"><span class="keyword">let</span> initialBits: <span class="type">UInt8</span> = <span class="number">0b00001111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 0b11110000</span></span><br><span class="line"><span class="keyword">let</span> invertedBits = ~initialBits</span><br></pre></td></tr></table></figure>
<h3 id="25-2-2-按位与运算符"><a href="#25-2-2-按位与运算符" class="headerlink" title="25.2.2    按位与运算符"></a>25.2.2    按位与运算符</h3><blockquote>
<p><strong>按位与操作符：</strong><code>&amp;</code><br><strong>说明：</strong><code>按位与运算符</code>可以对两个数的比特位进行合并。它返回一个新的数，只有当两个数的对应位都为 <code>1</code> 的时候，新数的对应位才为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 11111100</span></span><br><span class="line"><span class="keyword">let</span> firstSixBits: <span class="type">UInt8</span> = <span class="number">0b11111100</span></span><br><span class="line"><span class="comment">// 00111111</span></span><br><span class="line"><span class="keyword">let</span> lastSixBits: <span class="type">UInt8</span>  = <span class="number">0b00111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00111100</span></span><br><span class="line"><span class="keyword">let</span> middleFourBits = firstSixBits &amp; lastSixBits<span class="comment">// 按位与运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-3-按位或运算符"><a href="#25-2-3-按位或运算符" class="headerlink" title="25.2.3    按位或运算符"></a>25.2.3    按位或运算符</h3><blockquote>
<p><strong>按位或运算符：</strong><code>|</code><br><strong>说明：</strong><code>按位或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，只要两个数的对应位中有任意一个为 <code>1</code> 时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10110010</span></span><br><span class="line"><span class="keyword">let</span> someBits: <span class="type">UInt8</span> = <span class="number">0b10110010</span></span><br><span class="line"><span class="comment">// 01011110</span></span><br><span class="line"><span class="keyword">let</span> moreBits: <span class="type">UInt8</span> = <span class="number">0b01011110</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 11111110</span></span><br><span class="line"><span class="keyword">let</span> combinedbits = someBits | moreBits <span class="comment">// 按位或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-4-按位亦或运算符"><a href="#25-2-4-按位亦或运算符" class="headerlink" title="25.2.4    按位亦或运算符"></a>25.2.4    按位亦或运算符</h3><blockquote>
<p><strong>按位亦或运算符：</strong><code>^</code><br><strong>说明：</strong><code>按位异或运算符</code>可以对两个数的比特位进行比较。它返回一个新的数，当两个数的<code>对应位不相同</code>时，新数的对应位就为 <code>1</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 00010100</span></span><br><span class="line"><span class="keyword">let</span> firstBits: <span class="type">UInt8</span> = <span class="number">0b00010100</span></span><br><span class="line"><span class="comment">// 00000101</span></span><br><span class="line"><span class="keyword">let</span> otherBits: <span class="type">UInt8</span> = <span class="number">0b00000101</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 00010001</span></span><br><span class="line"><span class="keyword">let</span> outputBits = firstBits ^ otherBits <span class="comment">// 按位亦或运算</span></span><br></pre></td></tr></table></figure>
<h3 id="25-2-5-按位左移、右移运算符"><a href="#25-2-5-按位左移、右移运算符" class="headerlink" title="25.2.5    按位左移、右移运算符"></a>25.2.5    按位左移、右移运算符</h3><blockquote>
<p><strong>说明：</strong><code>有符号整数</code>和<code>无符号整数</code>的情况有所不同。值得注意的是</p>
</blockquote>
<table>
<thead>
<tr>
<th>位移操作</th>
<th>无符号整数</th>
<th>有符号整数</th>
</tr>
</thead>
<tbody>
<tr>
<td>左移<code>&lt;&lt;</code></td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
<td>丢弃溢出，低位用<code>0</code>填充</td>
</tr>
<tr>
<td>右移<code>&gt;&gt;</code></td>
<td>丢弃溢出，高位用<code>0</code>填充</td>
<td>丢弃溢出，高位用<code>符号位</code>填充</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>有符号整数</code>中的<code>负数</code>和其它整数不同，使用的是<code>二进制补码</code>的表示形式。</p>
<ul>
<li><code>减法</code>在底层可以用<code>加法</code>实现</li>
<li>可以使负数的按位左移和右移运算得到跟正数同样的<code>效果</code></li>
</ul>
<p><strong>技巧：</strong>移位运算（无论<code>有符号整数</code>还是<code>无符号整数</code>）遵守下面定义的规则</p>
<ul>
<li>将一个整数<code>左移</code>一位，等价于将这个数<code>乘以 2</code></li>
<li>将一个整数<code>右移</code>一位，等价于将这个数<code>除以 2</code></li>
</ul>
</blockquote>
<h2 id="25-2-溢出运算符"><a href="#25-2-溢出运算符" class="headerlink" title="25.2    溢出运算符"></a>25.2    溢出运算符</h2><blockquote>
<p><strong>溢出：</strong>默认情况下，当向一个整数赋超过它容量的值时，<code>Swift</code>默认会报错。这一意味着，不会真的发生溢出－除非使用<code>溢出运算符</code>。<br><strong>说明：</strong><code>Swift</code>提供了<code>3</code>个溢出操作符，会让系统在数值溢出的时候采取<code>阶段操作</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>溢出运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&amp;+</code></td>
<td>溢出加法</td>
</tr>
<tr>
<td><code>&amp;-</code></td>
<td>溢出减法</td>
</tr>
<tr>
<td><code>&amp;*</code></td>
<td>溢出乘法</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***** &amp;+ ****/</span></span><br><span class="line"><span class="comment">//  11111111</span></span><br><span class="line"><span class="keyword">var</span> unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">max</span><span class="comment">// 255</span></span><br><span class="line"><span class="comment">// 100000000 -&gt; 00000000</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;+ <span class="number">1</span><span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**** &amp;- ****/</span></span><br><span class="line"><span class="comment">// 00000000</span></span><br><span class="line">unsignedOverflow = <span class="type">UInt8</span>.<span class="built_in">min</span><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 111111111 -&gt; 11111111</span></span><br><span class="line">unsignedOverflow = unsignedOverflow &amp;- <span class="number">1</span><span class="comment">// 255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10000000</span></span><br><span class="line"><span class="keyword">var</span> signedOverflow = <span class="type">Int8</span>.<span class="built_in">min</span><span class="comment">// -128</span></span><br><span class="line"><span class="comment">// 01111111</span></span><br><span class="line">signedOverflow = signedOverflow &amp;- <span class="number">1</span><span class="comment">// 127</span></span><br></pre></td></tr></table></figure>
<h3 id="数值溢出"><a href="#数值溢出" class="headerlink" title="数值溢出"></a>数值溢出</h3><blockquote>
<p><strong>说明：</strong>数值溢出分为<code>上溢</code>和<code>下溢</code><br><strong>技巧：</strong>对于整数型数值（无论是<code>有符号</code>还是<code>无符号</code>）</p>
<ul>
<li>最大数：上溢1变成最小的数</li>
<li>最小数：下溢1变成最大的数</li>
</ul>
</blockquote>
<h2 id="25-3-优先级和结合性"><a href="#25-3-优先级和结合性" class="headerlink" title="25.3    优先级和结合性"></a>25.3    优先级和结合性</h2><blockquote>
<p><strong>说明：</strong>相比<code>C语言</code>和<code>Object-C</code>，<code>Swift</code>的运算符优先级和结合型规则更加简洁和可预测。</p>
</blockquote>
<h2 id="25-4-运算符函数"><a href="#25-4-运算符函数" class="headerlink" title="25.4    运算符函数"></a>25.4    运算符函数</h2><blockquote>
<p><strong>运算符重载：</strong><code>类</code>或<code>结构</code>可以为现有的操作符提供自定义的实现。</p>
</blockquote>
<h3 id="25-4-1-中缀运算符"><a href="#25-4-1-中缀运算符" class="headerlink" title="25.4.1    中缀运算符"></a>25.4.1    中缀运算符</h3><blockquote>
<p><strong>说明：</strong>也叫做<code>双目运算符</code>出现在两个<code>目标</code>之间，比如<code>+</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载“加号”，定义 Vector2D 类型实例之间的“加法”</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 向量之和</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数1</span></span><br><span class="line"><span class="keyword">let</span> vector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line"><span class="comment">// 操作数2</span></span><br><span class="line"><span class="keyword">let</span> anotherVector = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="comment">// 相加</span></span><br><span class="line"><span class="keyword">let</span> combinedVector = vector + anotherVector</span><br></pre></td></tr></table></figure>
<h3 id="25-4-2-前缀和后缀运算符"><a href="#25-4-2-前缀和后缀运算符" class="headerlink" title="25.4.2    前缀和后缀运算符"></a>25.4.2    前缀和后缀运算符</h3><blockquote>
<p><strong>说明：</strong><code>单目运算符</code>有<code>前缀</code>和<code>后缀</code>之分。</p>
</blockquote>
<table>
<thead>
<tr>
<th>单目运算符</th>
<th>说明</th>
<th>重载使用的关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>前缀</code></td>
<td>运算符出现在值之前</td>
<td><code>prefix</code></td>
</tr>
<tr>
<td><code>后缀</code></td>
<td>运算符出现在值之后</td>
<td><code>postfix</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获取相反向量</span><br><span class="line">* @param &#123;Vector2D&#125; vector 向量实例</span><br><span class="line">* @return &#123;Vector2D&#125; 相反向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> - <span class="params">(vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: -vector.x, y: -vector.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3.0, 4.0)</span></span><br><span class="line"><span class="keyword">let</span> positive = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (-3.0, -4.0)</span></span><br><span class="line"><span class="keyword">let</span> negative = -positive</span><br></pre></td></tr></table></figure>
<h3 id="25-4-3-复合赋值运算符"><a href="#25-4-3-复合赋值运算符" class="headerlink" title="25.4.3    复合赋值运算符"></a>25.4.3    复合赋值运算符</h3><blockquote>
<p><strong>说明：</strong>重载<code>复合赋值运算符</code>（比如<code>+=</code>、<code>++</code>、<code>--</code>）</p>
<ul>
<li>第一个参数必需声明为<code>inout</code>类型，因为这个参数的值会在运算符函数内直接被修改</li>
</ul>
<p><strong>注意：</strong>不能对默认的<code>赋值运算符</code>和<code>三目条件运算符</code>进行重载。只有组合赋值运算符可以被重载。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载 "+="</span><br><span class="line">* @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line">* @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重载前缀 "++"</span><br><span class="line">* @param &#123;Vector2D&#125; inout vector 要自增的向量</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> ++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">1.0</span>)</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> toIncrement = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterIncrement = ++toIncrement</span><br></pre></td></tr></table></figure>
<h3 id="25-4-4-等价操作符"><a href="#25-4-4-等价操作符" class="headerlink" title="25.4.4    等价操作符"></a>25.4.4    等价操作符</h3><blockquote>
<p><strong>说明：</strong>属于<code>中缀运算符</code>（或<code>双目运算符</code>），包括<code>==</code>和<code>!=</code><br><strong>扩展：</strong>自定义的<code>类</code>和<code>结构体</code>没有对<code>等价运算符</code>进行默认实现，为了使用<code>等价运算符</code>能对自定义的类型进行<code>判等运算</code>，需要为其提供自定义实现</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"＝＝"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> == <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">left</span>.x == <span class="keyword">right</span>.x) &amp;&amp; (<span class="keyword">left</span>.y == <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"!="</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Bool&#125; 是否"不相等"的结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> != <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !(<span class="keyword">left</span> == <span class="keyword">right</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> twoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">let</span> anotherTwoThree = <span class="type">Vector2D</span>(x: <span class="number">2.0</span>, y: <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">if</span> twoThree == anotherTwoThree &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"These two vectors are equivalent."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="25-5-自定义运算符"><a href="#25-5-自定义运算符" class="headerlink" title="25.5    自定义运算符"></a>25.5    自定义运算符</h2><blockquote>
<p><strong>说明：</strong>除了实现标准运算符，在 <code>Swift</code> 中还可以声明和实现自定义运算符。<br><strong>参考：</strong>可以用来自定义运算符的字符列表请参考<a href="">运算符</a>。<br><strong>语法：</strong>新的运算符要使用 <code>operator</code> 关键字在全局作用域内进行定义，同时还要指定 <code>prefix</code>、<code>infix</code> 或者 <code>postfix</code> 修饰符。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载"+"</span><br><span class="line"> * @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line"> * @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line"> * @return &#123;Vector2D&#125; 向量之和</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> + <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y + <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 重载 "+="</span><br><span class="line"> * @param &#123;Vector2D&#125; inout left 原始向量</span><br><span class="line"> * @param &#123;Vector2D&#125; left 增量部分</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> += <span class="params">(<span class="keyword">inout</span> <span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> &#123;</span><br><span class="line">    <span class="keyword">left</span> = <span class="keyword">left</span> + <span class="keyword">right</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">prefix</span> <span class="keyword">operator</span> +++ &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 自定义"+++"：前缀双自增</span><br><span class="line"> * @param &#123;Vector2D&#125; vector 向量</span><br><span class="line"> * @return &#123;Bool&#125; 计算结果</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">prefix</span> <span class="function"><span class="keyword">func</span> +++ <span class="params">(<span class="keyword">inout</span> vector: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    vector += vector</span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> toBeDoubled = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> afterDoubling = +++toBeDoubled</span><br></pre></td></tr></table></figure>
<h3 id="自定义中缀运算符的优先级和结合性"><a href="#自定义中缀运算符的优先级和结合性" class="headerlink" title="自定义中缀运算符的优先级和结合性"></a>自定义中缀运算符的优先级和结合性</h3><blockquote>
<p><strong>说明：</strong>自定义的<code>中缀运算符</code>也可以指定<code>优先级</code>(默认为<code>100</code>)和<code>结合性</code>(默认为<code>none</code>)</p>
</blockquote>
<table>
<thead>
<tr>
<th>优先级</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>left</code></td>
<td>左结合</td>
<td>跟左边的值进行结合</td>
</tr>
<tr>
<td><code>right</code></td>
<td>右结合</td>
<td>会跟右边的值进行结合</td>
</tr>
<tr>
<td><code>none</code></td>
<td>非结合</td>
<td>不能跟其他相同优先级的运算符写在一起</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>在定义前缀与后缀运算符的时候，如果没有指定优先级，则对同一个值同时使用前缀与后缀运算符，后缀运算符会先参与运算。<br><strong>参考：</strong> <a href="https://developer.apple.com/library/ios/documentation/Swift/Reference/Swift_StandardLibrary_Operators/index.html#//apple_ref/doc/uid/TP40016054" target="_blank" rel="external">Swift 标准库提供的运算符的结合性与优先级</a></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体（平面向量）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Vector2D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 自定义中缀运算符"+-"</span><br><span class="line">* 结合性：left</span><br><span class="line">* 优先级：140</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> +- &#123; <span class="keyword">associativity</span> <span class="keyword">left</span> <span class="keyword">precedence</span> <span class="number">140</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 重写"+-"</span><br><span class="line">* @param &#123;Vector2D&#125; left 左边的操作数</span><br><span class="line">* @param &#123;Vector2D&#125; right 右边的操作数</span><br><span class="line">* @return &#123;Vector2D&#125; 计算结果</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> +- <span class="params">(<span class="keyword">left</span>: Vector2D, <span class="keyword">right</span>: Vector2D)</span></span> -&gt; <span class="type">Vector2D</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Vector2D</span>(x: <span class="keyword">left</span>.x + <span class="keyword">right</span>.x, y: <span class="keyword">left</span>.y - <span class="keyword">right</span>.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> firstVector = <span class="type">Vector2D</span>(x: <span class="number">1.0</span>, y: <span class="number">2.0</span>)</span><br><span class="line"><span class="keyword">let</span> secondVector = <span class="type">Vector2D</span>(x: <span class="number">3.0</span>, y: <span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">let</span> plusMinusVector = firstVector +- secondVector</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_24 访问控制/" itemprop="url">
                  24 访问控制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:06:04+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_24 访问控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_24 访问控制/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>访问控制可以限定其他源文件或模块中的代码对你的代码的访问级别。<br><strong>用途：</strong>这个特性可以让我们<code>隐藏代码的一些实现细节</code>，并且可以为其他人可以访问和使用的代码<code>提供接口</code>。<br><strong>约定：</strong>为了简单起见，对于代码中可以设置访问级别的特性（属性、基本类型、函数等），在下面的章节中我们会称之为<code>实体</code>。</p>
</blockquote>
<h2 id="24-1-模块和源代码"><a href="#24-1-模块和源代码" class="headerlink" title="24.1    模块和源代码"></a>24.1    模块和源代码</h2><blockquote>
<p><strong>说明：</strong><code>Swift</code> 中的访问控制模型基于<code>模块</code>和<code>源文件</code>这两个概念。<br><strong>模块：</strong>模块指的是独立的<code>代码单元</code>，<code>框架</code>或<code>应用程序</code></p>
<ul>
<li>作为一个独立的模块来构建和发布</li>
<li>一个模块可以使用 <code>import</code> 关键字导入另外一个模块</li>
<li><code>Xcode</code> 的每个 <code>target</code>（例如框架或应用程序）都被当作独立的模块处理</li>
</ul>
<p><strong>源文件：</strong>源文件就是 <code>Swift</code> 中的源代码文件</p>
<ul>
<li>通常属于一个模块，即一个应用程序或者框架</li>
<li>同一个源文件也可以包含多个类型、函数之类的定义(一般会将不同的类型分别定义在不同的源文件中)</li>
</ul>
</blockquote>
<h2 id="24-2-访问级别"><a href="#24-2-访问级别" class="headerlink" title="24.2    访问级别"></a>24.2    访问级别</h2><blockquote>
<p><strong>说明：</strong><code>3</code>种</p>
</blockquote>
<table>
<thead>
<tr>
<th>访问级别</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td>可以访问同一模块源文件中的任何实体，在模块外也可以通过导入该模块来访问源文件里的所有实体</td>
<td>框架中的某个接口可以被任何人使用时</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>可以访问同一模块源文件中的任何实体，但是不能从模块外访问该模块源文件中的实体</td>
<td>某个接口只在应用程序或框架内部使用时</td>
</tr>
<tr>
<td><code>private</code></td>
<td>限制实体只能在所在的源文件内部使用</td>
<td>需要隐藏某些功能的实现细节时</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>Swift</code> 中的 <code>private</code> 访问级别不同于其他语言，它的范围限于源文件，而不是声明范围内。这就意味着，一个类型可以访问其所在源文件中的所有 <code>private</code> 实体，但是如果它的扩展定义在其他源文件中，那么它的扩展就不能访问它在这个源文件中定义的 <code>private</code> 实体。</p>
</blockquote>
<h3 id="24-2-1-访问级别基本原则"><a href="#24-2-1-访问级别基本原则" class="headerlink" title="24.2.1    访问级别基本原则"></a>24.2.1    访问级别基本原则</h3><blockquote>
<p><strong>说明：</strong>不可以在某个实体中定义访问级别更高的实体。</p>
<ul>
<li>一个 <code>public</code> 访问级别的变量，其类型的访问级别不能是 <code>internal</code> 或 <code>private</code>。</li>
<li><code>函数</code>的访问级别不能高于它的<code>参数类型</code>和<code>返回类型</code>的访问级别</li>
</ul>
</blockquote>
<h3 id="24-2-2-默认访问级别"><a href="#24-2-2-默认访问级别" class="headerlink" title="24.2.2    默认访问级别"></a>24.2.2    默认访问级别</h3><blockquote>
<p><strong>说明：</strong>代码默认的访问级别为<code>internal</code></p>
</blockquote>
<h3 id="24-2-3-单target应用程序的访问级别"><a href="#24-2-3-单target应用程序的访问级别" class="headerlink" title="24.2.3    单target应用程序的访问级别"></a>24.2.3    单target应用程序的访问级别</h3><blockquote>
<p><strong>单target应用程序：</strong>应用的所有功能都是为该应用服务，而<code>不需要提供给其他应用或者模块使用</code>，所以我们不需要明确设置访问级别<br><strong>说明：</strong>建议访问级别设置</p>
<ul>
<li>通常使用默认的访问级别 <code>internal</code> 即可</li>
<li>也可以使用 <code>private</code> 级别，用于隐藏一些功能的实现细节</li>
</ul>
</blockquote>
<h3 id="24-2-4-框架的访问级别"><a href="#24-2-4-框架的访问级别" class="headerlink" title="24.2.4    框架的访问级别"></a>24.2.4    框架的访问级别</h3><blockquote>
<p><strong>框架：</strong>主要是被其它模块导入使用<br><strong>说明：</strong>把一些对外的接口定义为 <code>public</code> 级别</p>
<ul>
<li>框架依然会使用默认的 <code>internal</code> 级别，也可以指定为 <code>private</code> 级别</li>
<li>当你想把某个实体作为框架的 <code>API</code> 的时候，需显式为其指定 <code>public</code> 级别</li>
</ul>
</blockquote>
<h3 id="24-2-5-单元测试target的访问级别"><a href="#24-2-5-单元测试target的访问级别" class="headerlink" title="24.2.5    单元测试target的访问级别"></a>24.2.5    单元测试target的访问级别</h3><blockquote>
<p><strong>单元测试target：</strong>当你的应用程序包含<code>单元测试 target</code> 时，为了测试，测试模块需要访问应用程序模块中的代码。<br><strong>说明：</strong>默认情况下只有 <code>public</code> 级别的实体才可以被其他模块访问。然而，如果在<code>导入应用程序模块的语句</code>前使用 <code>@testable</code> 特性，然后在允许测试的编译设置<code>（Build Options -&gt; Enable Testability）</code>下编译这个应用程序模块，<code>单元测试 target</code> 就可以访问应用程序模块中<code>所有 internal 级别</code>的实体。</p>
</blockquote>
<h2 id="24-3-访问控制语法"><a href="#24-3-访问控制语法" class="headerlink" title="24.3    访问控制语法"></a>24.3    访问控制语法</h2><blockquote>
<p><strong>说明：</strong>通过修饰符 <code>public</code>、<code>internal</code>、<code>private</code> 来声明实体的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**** 声明类 ****/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// internal(默认的，可省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 声明变量 ******/</span></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> somePublicVariable = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明常量 ******/</span></span><br><span class="line"><span class="comment">// internal(可以省略)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">let</span> someInternalConstant = <span class="number">0</span></span><br><span class="line"><span class="comment">/****** 声明方法 *********/</span></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateFunction</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-4-自定义类型"><a href="#24-4-自定义类型" class="headerlink" title="24.4    自定义类型"></a>24.4    自定义类型</h2><blockquote>
<p><strong>说明：</strong>一个类型的访问级别也会影响到类型成员（<code>属性</code>、<code>方法</code>、<code>构造器</code>、<code>下标</code>）的默认访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>类型的访问级别</th>
<th>类型成员的默认访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>internal</code>（或不指定）</td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>为什么：</strong>一个 <code>public</code> 类型的所有成员的访问级别默认为 <code>internal</code> 级别，而不是 <code>public</code> 级别？</p>
<blockquote>
<p>好处是，在你定义公共接口的时候，可以明确地选择哪些接口是需要公开的，哪些是内部使用的，避免不小心将内部使用的接口公开。</p>
</blockquote>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePublicClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// public</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> somePublicProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-1-元组类型"><a href="#24-4-1-元组类型" class="headerlink" title="24.4.1    元组类型"></a>24.4.1    元组类型</h3><blockquote>
<p><strong>说明：</strong>元组不同于类、结构体、枚举、函数那样有单独的定义。元组的访问级别是在它被使用时<code>自动推断</code>出的，而无法明确指定。<br><strong>访问级别：</strong>元组的访问级别将由元组中<code>访问级别最严格的类型</code>来决定。</p>
</blockquote>
<h3 id="24-4-2-函数类型"><a href="#24-4-2-函数类型" class="headerlink" title="24.4.2    函数类型"></a>24.4.2    函数类型</h3><blockquote>
<p><strong>访问级别：</strong>函数的访问级别根据访问级别最严格的<code>参数</code>类型或<code>返回</code>类型的访问级别来决定<br><strong>说明：</strong>如果这种访问级别不符合函数定义所在环境的默认访问级别，那么就需要<code>明确地指定该函数的访问级别</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// internal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeInternalClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// internal</span></span><br><span class="line">    <span class="keyword">var</span> someInternalProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// private</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomePrivateClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">var</span> somePrivateProperty = <span class="number">0</span></span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">somePrivateMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为该函数返回类型的访问级别是 private，所以你必须使用 private 修饰符</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> -&gt; (<span class="type">SomeInternalClass</span>, <span class="type">SomePrivateClass</span>) &#123;</span><br><span class="line">    <span class="comment">// 此处是函数实现部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24-4-3-枚举类型"><a href="#24-4-3-枚举类型" class="headerlink" title="24.4.3    枚举类型"></a>24.4.3    枚举类型</h3><blockquote>
<p><strong>访问级别：</strong><code>枚举成员</code>的访问级别和该<code>枚举类型</code>相同<br><strong>说明：</strong>你不能为<code>枚举成员</code>单独指定不同的访问级别</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CompassPoint</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">North</span><span class="comment">// public</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">South</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">East</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">West</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原始值和关联值"><a href="#原始值和关联值" class="headerlink" title="原始值和关联值"></a>原始值和关联值</h4><blockquote>
<p><strong>说明：</strong><code>枚举定义</code>中的任何<code>原始值</code>或<code>关联值</code>的类型的访问级别至少不能低于<code>枚举类型</code>的访问级别</p>
</blockquote>
<h3 id="24-4-4-嵌套类型"><a href="#24-4-4-嵌套类型" class="headerlink" title="24.4.4    嵌套类型"></a>24.4.4    嵌套类型</h3><table>
<thead>
<tr>
<th>环境类型</th>
<th>嵌套类型默认</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code></td>
<td><code>private</code></td>
</tr>
<tr>
<td><code>internal</code></td>
<td><code>internal</code></td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
<td>如果想让嵌套类型拥有 <code>public</code> 访问级别，那么需要明确指定该嵌套类型的访问级别</td>
</tr>
</tbody>
</table>
<h2 id="24-5-子类"><a href="#24-5-子类" class="headerlink" title="24.5    子类"></a>24.5    子类</h2><blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>子类的访问级别<code>不得高于</code>父类的访问级别</li>
<li>可以通过<code>重写</code>为继承来的<code>类成员</code>提供<code>更高的访问级别</code></li>
<li>用<code>子类成员</code>去访问访问级别更低的<code>父类成员</code>，只要这一操作在相应访问级别的限制范围内</li>
</ul>
<ol>
<li><strong>同一源文件：</strong>可以访问访问父类 <code>private</code> 级别的成员</li>
<li><strong>同一模块：</strong>访问父类 <code>internal</code> 级别的成员</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// private</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类（访问级别不能高于父类）</span></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span>: <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 重写父类方法，提高访问级别</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">func</span> <span class="title">someMethod</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 调用父类 private 方法（同一源文件）</span></span><br><span class="line">        <span class="keyword">super</span>.someMethod()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="24-6-常量、变量、属性、下标"><a href="#24-6-常量、变量、属性、下标" class="headerlink" title="24.6    常量、变量、属性、下标"></a>24.6    常量、变量、属性、下标</h2><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性</code>不能拥有比它们<code>所在的类型</code>更高的访问级别；<code>下标</code>也不能拥有比<code>索引类型</code>或<code>返回类型</code>更高的访问级别。</p>
</blockquote>
<h3 id="24-6-1-Getter-和-Setter"><a href="#24-6-1-Getter-和-Setter" class="headerlink" title="24.6.1    Getter 和 Setter"></a>24.6.1    Getter 和 Setter</h3><blockquote>
<p><strong>说明：</strong><code>常量</code>、<code>变量</code>、<code>属性（包括计算属性 和 存储型属性）</code>、<code>下标</code>的 <code>Getters</code> 和 <code>Setters</code> 的访问级别和它们<code>所在类型</code>的访问级别相同。<br><strong>改变访问级别：</strong>只能改变<code>Setter</code><br> |改变<code>Setter</code>访问权限的关键字|访问级别|<br> |-|-|<br> |<code>private(set)</code> |<code>private</code>|<br> |<code>internal(set)</code>|<code>internal</code>|<br><strong>注意：</strong>存储属性也有<code>Getter</code>和<code>Setter</code>，<code>Swift</code>会隐式地为其创建 <code>Getter</code> 和 <code>Setter</code>，用于访问该属性的<code>后备存储</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体(internal)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrackedString</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储属性：setter 为 private（该属性只有在当前的源文件中是可读写的，而在当前源文件所属的模块中只是一个可读的属性）</span></span><br><span class="line">    <span class="keyword">private</span>(<span class="keyword">set</span>) <span class="keyword">var</span> numberOfEdits = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 计算属性: internal</span></span><br><span class="line">    <span class="keyword">var</span> value: <span class="type">String</span> = <span class="string">""</span> &#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            numberOfEdits++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结构体实例</span></span><br><span class="line"><span class="keyword">var</span> stringToEdit = <span class="type">TrackedString</span>()</span><br><span class="line"><span class="comment">// 写（在同一源文件中）</span></span><br><span class="line">stringToEdit.value = <span class="string">"This string will be tracked."</span></span><br><span class="line">stringToEdit.value += <span class="string">" This edit will increment numberOfEdits."</span></span><br><span class="line">stringToEdit.value += <span class="string">" So will this one."</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The number of edits is \(stringToEdit.numberOfEdits)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="24-7-构造器"><a href="#24-7-构造器" class="headerlink" title="24.7    构造器"></a>24.7    构造器</h2><blockquote>
<p><strong>说明：</strong>构造器的访问级别</p>
</blockquote>
<table>
<thead>
<tr>
<th>构造器</th>
<th>访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>自定义构造器</td>
<td>可以<code>低于或等于</code>其<code>所属类型</code>的访问级别</td>
</tr>
<tr>
<td>必要构造器</td>
<td>必须和所属类型的访问级别<code>相同</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>构造器参数的访问级别：</strong>如同函数或方法的参数，<code>构造器参数</code>的访问级别也不能低于<code>构造器本身</code>的访问级别。</p>
</blockquote>
<h3 id="24-7-1-默认构造器"><a href="#24-7-1-默认构造器" class="headerlink" title="24.7.1    默认构造器"></a>24.7.1    默认构造器</h3><blockquote>
<p><strong>默认构造器存在条件：</strong>为所有存储型属性设置了默认初始值，并且未提供自定义的构造器。<br><strong>说明：</strong>默认构造器的访问级别<code>与所属类型的访问级别相同</code>，除非类型的访问级别是 <code>public</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>所在类型访问级别</th>
<th>默认构造器访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>private</code>或<code>internal</code></td>
<td>和所在类型相同</td>
</tr>
<tr>
<td><code>public</code></td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果你希望一个 <code>public</code> 级别的类型也能在其他模块中使用这种<code>无参数的默认构造器</code>，你只能<code>自己提供一个 public 访问级别的无参数构造器</code>。</p>
</blockquote>
<h3 id="24-7-2-结构体默认的成员逐一构造器"><a href="#24-7-2-结构体默认的成员逐一构造器" class="headerlink" title="24.7.2    结构体默认的成员逐一构造器"></a>24.7.2    <code>结构体</code>默认的成员逐一构造器</h3><blockquote>
<p><strong>说明：</strong>和结构体中的<code>存储属性成员</code>的访问级别有关。</p>
</blockquote>
<table>
<thead>
<tr>
<th>所有存储型属性的访问级别都为<code>private</code></th>
<th>逐一成员构造器的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td><code>private</code></td>
</tr>
<tr>
<td>否</td>
<td><code>internal</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong>如果希望一个 <code>public</code> 级别的结构体也能在其他模块中使用<code>其默认的成员逐一构造器</code>，依然只能<code>自己提供一个 public 访问级别的成员逐一构造器</code>。</p>
</blockquote>
<h2 id="24-8-协议"><a href="#24-8-协议" class="headerlink" title="24.8    协议"></a>24.8    协议</h2><blockquote>
<p><strong>说明：</strong>可以在<code>定义协议</code>时明确指定协议的访问级别。</p>
<ul>
<li>协议中的每一个<code>要求</code>都具有和<code>该协议</code>相同的访问级别</li>
</ul>
</blockquote>
<h3 id="24-8-1-协议继承"><a href="#24-8-1-协议继承" class="headerlink" title="24.8.1    协议继承"></a>24.8.1    协议继承</h3><blockquote>
<p><strong>说明：</strong>如果定义了一个继承自其他协议的新协议，那么<code>新协议</code>拥有的访问级别最高也只能和<code>被继承协议</code>的访问级别相同</p>
</blockquote>
<h3 id="24-8-2-协议一致性"><a href="#24-8-2-协议一致性" class="headerlink" title="24.8.2    协议一致性"></a>24.8.2    协议一致性</h3><blockquote>
<p><strong>说明：</strong>一个<code>类型</code>可以采纳比自身访问级别低的<code>协议</code><br><strong>采纳协议的类型的访问级别：</strong>采纳了协议的类型的访问级别取它本身和所采纳协议<code>两者间最低的访问级别</code></p>
</blockquote>
<h2 id="24-9-扩展"><a href="#24-9-扩展" class="headerlink" title="24.9    扩展"></a>24.9    扩展</h2><blockquote>
<p><strong>说明：</strong>你可以在访问级别允许的情况下对<code>类</code>、<code>结构体</code>、<code>枚举</code>进行扩展。</p>
</blockquote>
<table>
<thead>
<tr>
<th>是否给扩展指定访问级别</th>
<th>扩展的成员的访问级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td>扩展的访问级别下成员获得的默认访问级别（规则同<code>自定义类型</code>）</td>
</tr>
<tr>
<td>否</td>
<td>和原始类型成员一致</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>用于采纳协议的扩展不能指定扩展的访问级别。</p>
</blockquote>
<h3 id="24-9-1-通过扩展添加协议一致性"><a href="#24-9-1-通过扩展添加协议一致性" class="headerlink" title="24.9.1    通过扩展添加协议一致性"></a>24.9.1    通过扩展添加协议一致性</h3><blockquote>
<p><strong>说明：</strong>如果你通过扩展来采纳协议，那么你就<code>不能显式指定</code>该扩展的访问级别了<br>扩展的访问级别<br><strong>扩展中提供的实现协议要求的成员的访问级别：</strong>协议拥有相应的访问级别，并会为该扩展中所有协议要求的实现提供默认的访问级别。</p>
</blockquote>
<h2 id="24-10-泛型"><a href="#24-10-泛型" class="headerlink" title="24.10    泛型"></a>24.10    泛型</h2><blockquote>
<p><strong>说明：</strong>泛型函数和泛型类型放在一起讨论。<br><strong>访问级别：</strong>取<code>自身</code>访问级别和<code>类型参数</code>访问级别中最低的访问级别</p>
</blockquote>
<h2 id="24-11-类型别名"><a href="#24-11-类型别名" class="headerlink" title="24.11    类型别名"></a>24.11    类型别名</h2><blockquote>
<p><strong>说明：</strong>你定义的任何<code>类型别名</code>都会被当作不同的类型，以便于进行访问控制。<br><strong>访问级别限制：</strong><code>类型别名</code>的访问级别不可高于<code>其表示的类型</code>的访问级别。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_23 范型/" itemprop="url">
                  23 范型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:05:48+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_23 范型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_23 范型/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>泛型代码可以让你编写<code>适用自定义需求以及任意类型</code>的<code>灵活可重用</code>的<code>函数</code>和<code>类型</code>。<br><strong>意义：</strong>它的可以让你<code>避免重复的代码</code>，用一种清晰和抽象的方式来表达代码的意图。</p>
</blockquote>
<h2 id="23-1-泛型所解决的问题"><a href="#23-1-泛型所解决的问题" class="headerlink" title="23.1    泛型所解决的问题"></a>23.1    泛型所解决的问题</h2><blockquote>
<p><strong>说明：</strong>有了泛型，就不必为各种不同类型重复创建类似的<code>函数</code>或<code>类型</code>。</p>
</blockquote>
<h2 id="23-2-泛型函数"><a href="#23-2-泛型函数" class="headerlink" title="23.2    泛型函数"></a>23.2    泛型函数</h2><blockquote>
<p><strong>说明：</strong><code>泛型函数</code>可以适用于<code>任何类型</code><br><strong>语法：</strong><code>func 函数名&lt;T&gt;(){...}</code></p>
<ul>
<li>函数名后面跟着<code>&lt;占位类型名&gt;</code>（比如字母 <code>T</code>）来代替实际类型名</li>
<li>函数被调用时，<code>T</code> 所代表的类型都会<code>由传入的值的类型推断出来</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************** 不使用泛型的方法 ****************/</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 交换两个值</span><br><span class="line">* @param &#123;String&#125; inout a 第一个值</span><br><span class="line">* @param &#123;String&#125; inout b 第二个值</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwStrings</span><span class="params">(<span class="keyword">inout</span> a: String, <span class="keyword">inout</span> <span class="number">_</span> b: String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 交换两个值</span><br><span class="line"> * @param &#123;Double&#125; inout a 第一个值</span><br><span class="line"> * @param &#123;Double&#125; inout b 第二个值</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoDoubles</span><span class="params">(<span class="keyword">inout</span> a: Double, <span class="keyword">inout</span> <span class="number">_</span> b: Double)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** 使用泛型的方法 ******************/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swapTwoValues</span>&lt;T&gt;<span class="params">(<span class="keyword">inout</span> a: T, <span class="keyword">inout</span> <span class="number">_</span> b: T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temporaryA = a</span><br><span class="line">    a = b</span><br><span class="line">    b = temporaryA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用泛型（自动推断 T 占位符的类型）</span></span><br><span class="line"><span class="keyword">var</span> someInt = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> anotherInt = <span class="number">107</span></span><br><span class="line">swapTwoValues(&amp;someInt, &amp;anotherInt)</span><br></pre></td></tr></table></figure>
<h2 id="23-3-类型参数"><a href="#23-3-类型参数" class="headerlink" title="23.3    类型参数"></a>23.3    类型参数</h2><blockquote>
<p><strong>说明：</strong>类型参数指定并命名一个<code>占位类型</code>，并且紧随在函数名后面，使用一对尖括号括起来（例如 <code>&lt;T&gt;</code>）。<code>类型参数</code>会在函数调用时被实际类型所替换。在<code>泛型函数体</code>中可以用来</p>
<ul>
<li>定义一个函数的<code>参数类型</code></li>
<li>作为函数的<code>返回类型</code></li>
<li>用作函数主体中的<code>注释类型</code></li>
</ul>
</blockquote>
<h2 id="23-4-命名类型参数"><a href="#23-4-命名类型参数" class="headerlink" title="23.4    命名类型参数"></a>23.4    命名类型参数</h2><blockquote>
<p><strong>说明：</strong>下面是一些指导性的意见。</p>
<ul>
<li>在大多数情况下，类型参数具有一个<code>描述性名字</code></li>
<li>当它们之间的关系没有意义时，通常使用<code>单一的字母</code>来命名</li>
</ul>
<p><strong>注意：</strong>始终使用<code>大写字母开头的驼峰式命名法</code>来为类型参数命名，以表明它们是占位类型，而不是一个值。</p>
</blockquote>
<h2 id="23-5-泛型类型"><a href="#23-5-泛型类型" class="headerlink" title="23.5    泛型类型"></a>23.5    泛型类型</h2><blockquote>
<p><strong>说明：</strong>除了泛型函数，<code>Swift</code> 还允许你定义泛型类型。这些自定义<code>类</code>、<code>结构体</code>和<code>枚举</code>可以适用于<code>任何类型</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************** 不使用泛型的结构体 ******************/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IntStack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Int</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****************** 使用泛型的机构体 ******************/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串栈实例</span></span><br><span class="line"><span class="keyword">var</span> stackOfStrings = <span class="type">Stack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stackOfStrings.push(<span class="string">"uno"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"dos"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"tres"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"cuatro"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈</span></span><br><span class="line"><span class="keyword">let</span> fromTheTop = stackOfStrings.pop()</span><br></pre></td></tr></table></figure>
<h2 id="23-6-扩展一个泛型类型"><a href="#23-6-扩展一个泛型类型" class="headerlink" title="23.6    扩展一个泛型类型"></a>23.6    扩展一个泛型类型</h2><blockquote>
<p><strong>说明：</strong>扩展泛型类型和扩展普通类型类似，特别的地方在于</p>
<ul>
<li><code>不需要</code>在扩展的定义中提供<code>类型参数列表</code></li>
<li>原始类型定义中声明的类型参数列表在扩展中可以直接使用</li>
<li>这些来自原始类型中的参数名称会被用作<code>原始定义中类型参数的引用</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型结构体：栈</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="comment">// 入栈：变异方法,需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 出栈：变异方法，需要修改自身的属性</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展泛型类型(原始类型定义中声明的类型参数列表在扩展中可以直接使用)</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Stack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> topItem: <span class="type">Element</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> items.isEmpty ? <span class="literal">nil</span> : items[items.<span class="built_in">count</span> - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 字符串栈实例</span></span><br><span class="line"><span class="keyword">var</span> stackOfStrings = <span class="type">Stack</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stackOfStrings.push(<span class="string">"uno"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"dos"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"tres"</span>)</span><br><span class="line">stackOfStrings.push(<span class="string">"cuatro"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出栈</span></span><br><span class="line"><span class="keyword">let</span> fromTheTop = stackOfStrings.pop()</span><br></pre></td></tr></table></figure>
<h2 id="23-6-类型约束"><a href="#23-6-类型约束" class="headerlink" title="23.6    类型约束"></a>23.6    类型约束</h2><blockquote>
<p><strong>说明：</strong>类型约束可以指定一个<code>类型参数</code>必须继承自指定类，或者符合一个特定的协议或协议组合。</p>
</blockquote>
<h3 id="23-6-1-类型约束语法"><a href="#23-6-1-类型约束语法" class="headerlink" title="23.6.1    类型约束语法"></a>23.6.1    类型约束语法</h3><blockquote>
<p><strong>说明：</strong>在一个<code>类型参数名</code>后面放置一个<code>类名</code>或者<code>协议名</code>，通过<code>:</code>分隔，从而定义类型约束，它们将作为类型参数列表的一部分。<br><strong>语法：</strong>以<code>泛型函数</code>为例（<code>泛型类型</code>与此类似）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someFunction</span>&lt;T: SomeClass, U: SomeProtocol&gt;<span class="params">(someT: T, someU: U)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里是泛型函数的函数体部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-6-2-类型约束实践"><a href="#23-6-2-类型约束实践" class="headerlink" title="23.6.2    类型约束实践"></a>23.6.2    类型约束实践</h3><blockquote>
<p><strong>注意：</strong>不是所有的 <code>Swift</code> 类型都可以用等式符<code>==</code>进行比较。Swift 标准库中定义了一个 <code>Equatable</code> 协议，该协议要求任何符合该协议的类型必须实现等式符<code>==</code>。<br><strong>扩展：</strong>所有的 <code>Swift 标准类型</code>自动支持 <code>Equatable</code> 协议</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************  非泛型   ************/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findStringIndex</span><span class="params">(array: [String], <span class="number">_</span> valueToFind: String)</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">for</span> (index, value) <span class="keyword">in</span> array.<span class="built_in">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> value == valueToFind &#123;</span><br><span class="line">            <span class="keyword">return</span> index</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">let</span> strings = [<span class="string">"cat"</span>, <span class="string">"dog"</span>, <span class="string">"llama"</span>, <span class="string">"parakeet"</span>, <span class="string">"terrapin"</span>]</span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> foundIndex = findStringIndex(strings, <span class="string">"llama"</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The index of llama is \(foundIndex)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********  泛型（带有约束）  *********/</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获得相应值在数组中的位置</span><br><span class="line">* @desc 为了保证证支持等式操作符，T 必需实现 Equatable 协议</span><br><span class="line">* @param &#123;[T]&#125; 目标数组</span><br><span class="line">* @param &#123;T&#125; 目标值</span><br><span class="line">* @reutrn &#123;Int?&#125; 下标</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findIndex</span>&lt;T: Equatable&gt;<span class="params">(array: [T], <span class="number">_</span> valueToFind: T)</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">for</span> (index, value) <span class="keyword">in</span> array.<span class="built_in">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> value == valueToFind &#123;</span><br><span class="line">            <span class="keyword">return</span> index</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="23-7-关联类型"><a href="#23-7-关联类型" class="headerlink" title="23.7    关联类型"></a>23.7    关联类型</h2><blockquote>
<p><strong>用途：</strong><code>定义一个协议时</code>，有的时候声明<code>一个或多个</code>关联类型作为协议定义的一部分将会，作为一种用来<code>占位</code>的类型，实现协议是会推断出<code>实际类型</code>。<br><strong>说明：</strong>关联类型作为协议的一部分，为某个类型提供了一个<code>占位名</code>（或者说别名），其代表的<code>实际类型在协议被采纳时才会被指定</code>。<br><strong>语法：</strong>你可以通过 <code>typealias</code> 关键字来指定关联类型。</p>
</blockquote>
<h3 id="23-7-1-关联类型实践"><a href="#23-7-1-关联类型实践" class="headerlink" title="23.7.1    关联类型实践"></a>23.7.1    关联类型实践</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议（非泛型）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IntStack</span>: <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自身部分</span></span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Int</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Container 协议的实现部分</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span> = <span class="type">Int</span><span class="comment">// 可以省略（因为类型推断）</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: Int)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议（泛型）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stack</span>&lt;<span class="title">Element</span>&gt;: <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Stack&lt;Element&gt; 的原始实现部分</span></span><br><span class="line">    <span class="keyword">var</span> items = [<span class="type">Element</span>]()</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">push</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        items.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">pop</span><span class="params">()</span></span> -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.removeLast()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Container 协议的实现部分</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: Element)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-7-2-通过扩展一个存在的类型来指定关联类型"><a href="#23-7-2-通过扩展一个存在的类型来指定关联类型" class="headerlink" title="23.7.2    通过扩展一个存在的类型来指定关联类型"></a>23.7.2    通过扩展一个存在的类型来指定关联类型</h3><blockquote>
<p><strong>说明：</strong>扩展让一个已存在的类型符合一个协议，其中就包括使用了关联类型的协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议：容器</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array 本身就具备 Container 指定的实现</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span>: <span class="title">Container</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="23-8-where字句"><a href="#23-8-where字句" class="headerlink" title="23.8    where字句"></a>23.8    where字句</h2><blockquote>
<p><strong>说明：</strong>可以在<code>参数列表</code>中通过 <code>where</code> 子句为<code>关联类型</code>定义约束</p>
<ul>
<li>使一个<code>关联类型</code>符合某个特定的协议</li>
<li>使某个特定的类型参数和<code>关联类型</code>必须类型相同</li>
</ul>
<p><strong>语法：</strong>将 <code>where</code> 关键字紧跟在类型参数列表后面来定义 <code>where</code> 子句</p>
<ul>
<li><code>where</code> 子句后跟<code>一个或者多个</code>针对关联类型的约束</li>
<li>以及<code>一个或多个</code>类型参数和关联类型间的相等关系</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议：容器</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义关联类型</span></span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">ItemType</span></span><br><span class="line">    <span class="comment">// 必须可以通过 append(_:) 方法添加一个新元素到容器里</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(item: ItemType)</span></span></span><br><span class="line">    <span class="comment">// 必须可以通过 count 属性获取容器中元素的数量，并返回一个 Int 值</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 必须可以通过接受 Int 索引值的下标检索到每一个元素。</span></span><br><span class="line">    <span class="keyword">subscript</span>(i: <span class="type">Int</span>) -&gt; <span class="type">ItemType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 检查两个 Container 实例是否包含相同顺序的相同元素</span><br><span class="line">* @param &#123;C1&#125; someContainer</span><br><span class="line">* @param &#123;C2&#125; anotherContainer</span><br><span class="line">* @return &#123;Bool&#125; true 匹配，false 不匹配</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">allItemsMatch</span>&lt;</span><br><span class="line">    C1: Container, C2: Container</span><br><span class="line">    where C1.ItemType == C2.ItemType, C1.ItemType: Equatable&gt;</span><br><span class="line">    <span class="params">(someContainer: C1, <span class="number">_</span> anotherContainer: C2)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查两个容器含有相同数量的元素</span></span><br><span class="line">        <span class="keyword">if</span> someContainer.<span class="built_in">count</span> != anotherContainer.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查每一对元素是否相等</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;someContainer.<span class="built_in">count</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> someContainer[i] != anotherContainer[i] &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;       </span><br><span class="line">        <span class="comment">// 所有元素都匹配，返回 true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_22 协议/" itemprop="url">
                  22 协议
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T20:05:28+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_22 协议/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_22 协议/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="22-1-协议的语法"><a href="#22-1-协议的语法" class="headerlink" title="22.1    协议的语法"></a>22.1    协议的语法</h2><blockquote>
<p><strong>说明：</strong>协议的定义方式与<code>类</code>,<code>结构体</code>,<code>枚举</code>的定义非常相似。</p>
<ul>
<li>要使类遵循某个协议,需要在<code>类型名称后</code>加上<code>协议名称</code>,中间以<code>:</code> 分隔,作为类型定义的一部分</li>
<li>遵循多个 协议时,各协议之间用逗号<code>,</code> 分隔</li>
<li>如果类在遵循协议的同时拥有父类,应该将<code>父类名</code>放在<code>协议名之前</code>,以<code>,</code>分隔</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 协议内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SomeStructure</span>: <span class="title">FirstProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 结构体内容</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承类并实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span>: <span class="title">SomeSuperClass</span>, <span class="title">FirstProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 类的内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-2-对属性的规定"><a href="#22-2-对属性的规定" class="headerlink" title="22.2    对属性的规定"></a>22.2    对属性的规定</h2><blockquote>
<p><strong>说明：</strong>表现在<code>4</code>个方面</p>
<ul>
<li>名称</li>
<li>类型</li>
<li>可读还是可写</li>
<li>实例属性还是类属性</li>
</ul>
<p><strong>注意：</strong>不指定是<code>存储型属性</code>还是<code>计算型属性</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">FullyNamed</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 只读属性</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Starship</span>: <span class="title">FullyNamed</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">prefix</span>: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, <span class="keyword">prefix</span>: <span class="type">String</span>? = <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">prefix</span> = <span class="keyword">prefix</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 只读计算属性</span></span><br><span class="line">    <span class="keyword">var</span> fullName: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">prefix</span> != <span class="literal">nil</span> ? <span class="keyword">prefix</span>! + <span class="string">" "</span> : <span class="string">""</span>) + name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> ncc1701 = <span class="type">Starship</span>(name: <span class="string">"Enterprise"</span>, <span class="keyword">prefix</span>: <span class="string">"USS"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="22-2-1-可读-amp-可写"><a href="#22-2-1-可读-amp-可写" class="headerlink" title="22.2.1    可读&amp;可写"></a>22.2.1    可读&amp;可写</h3><blockquote>
<p><strong>说明：</strong>在协议中指定属性规则是都使用<code>var</code>（不使用<code>let</code>）</p>
</blockquote>
<table>
<thead>
<tr>
<th>可读&amp;可写</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>可读</td>
<td><code>{get}</code></td>
<td>可以只读，可以可读可写</td>
</tr>
<tr>
<td>可写</td>
<td><code>{get set}</code></td>
<td>不能是<code>常量</code>或<code>只读计算属性</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 可读可写</span></span><br><span class="line">    <span class="keyword">var</span> mustBeSettable : <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">    <span class="comment">// 只读</span></span><br><span class="line">    <span class="keyword">var</span> doesNotNeedToBeSettable: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-2-2-实例属性-amp-类属性"><a href="#22-2-2-实例属性-amp-类属性" class="headerlink" title="22.2.2    实例属性&amp;类属性"></a>22.2.2    实例属性&amp;类属性</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>实例属性&amp;类属性</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>实例属性</td>
<td>默认</td>
<td>默认</td>
</tr>
<tr>
<td>类属性</td>
<td><code>static</code></td>
<td><code>static</code>或<code>class</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 类属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> someTypeProperty: <span class="type">Int</span> &#123; <span class="keyword">get</span> <span class="keyword">set</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-3-对方法的规定"><a href="#22-3-对方法的规定" class="headerlink" title="22.3    对方法的规定"></a>22.3    对方法的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以要求采纳协议的类型实现某些指定的<code>实例方法</code>或<code>类方法</code>。<br><strong>语法：</strong>像普通方法一样放在协议的定义中，但是不需要<code>{}</code>和方法体</p>
<ul>
<li>可以在协议中定义具有<code>可变参数</code>的方法，和普通方法的定义方式相同</li>
<li><code>不支持</code>为协议中的方法的参数提供默认值</li>
<li>在协议中定义类方法的时候，总是使用 <code>static</code> 关键字作为前缀；当类类型采纳协议时，除了 <code>static</code> 关键字，还可以使用 <code>class</code> 关键字作为前缀</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 类方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">someTypeMethod</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线性同余随机数生成器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> generator = <span class="type">LinearCongruentialGenerator</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Here's a random number: \(generator.random())"</span>)<span class="comment">// 0.37464991998171”</span></span><br></pre></td></tr></table></figure>
<h2 id="22-4-对Mutating方法的规定"><a href="#22-4-对Mutating方法的规定" class="headerlink" title="22.4    对Mutating方法的规定"></a>22.4    对Mutating方法的规定</h2><blockquote>
<p><strong>说明：</strong>如果你在<code>协议中</code>定义了一个<code>实例方法</code>，该方法会改变采纳该协议的类型的<code>实例</code>，那么在定义协议时需要在方法前加 <code>mutating</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>实现者</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>类类型</td>
<td><code>mutating</code></td>
<td>不用写 <code>mutating</code> 关键字</td>
</tr>
<tr>
<td>值类型</td>
<td><code>mutating</code></td>
<td>必须写<code>mutating</code> 关键字</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Togglable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当它被调用时，将改变实例属性，从而切换采纳该协议类型的实例的状态</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现协议：开关</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">OnOffSwitch</span>: <span class="title">Togglable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Off</span>, <span class="type">On</span></span><br><span class="line">    <span class="comment">// 实现协议定义的 mutating 方法</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">toggle</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Off</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">On</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">On</span>:</span><br><span class="line">            <span class="keyword">self</span> = <span class="type">Off</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> lightSwitch = <span class="type">OnOffSwitch</span>.<span class="type">Off</span></span><br><span class="line"><span class="comment">// 调用 mutating 方法</span></span><br><span class="line">lightSwitch.toggle()</span><br></pre></td></tr></table></figure>
<h2 id="22-5-对构造器的规定"><a href="#22-5-对构造器的规定" class="headerlink" title="22.5    对构造器的规定"></a>22.5    对构造器的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以要求采纳协议的类型实现指定的构造器<br><strong>语法：</strong>你可以像编写普通构造器那样，在协议的定义里<code>写下构造器的声明</code>，但<code>不需要写{}和构造器的实体</code></p>
</blockquote>
<h3 id="22-5-1-构造器要求在类中的实现"><a href="#22-5-1-构造器要求在类中的实现" class="headerlink" title="22.5.1    构造器要求在类中的实现"></a>22.5.1    构造器要求在类中的实现</h3><blockquote>
<p><strong>说明：</strong>使用<code>required</code> 修饰符（除非在<code>final</code>类中），可以是<code>指定构造器</code>或<code>便利构造器</code></p>
<ul>
<li>如果一个子类<code>重写</code>了父类的指定构造器，并且该构造器<code>满足了某个协议</code>的要求，那么该构造器的实现需要同时标注 <code>required</code> 和 <code>override</code> 修饰符</li>
<li>如果类已经被标记为 <code>final</code>，那么不需要在协议构造器的实现中使用 <code>required</code> 修饰符，因为<code>final</code> 类不能有子类</li>
</ul>
<p><strong>注意：</strong>使用 <code>required</code> 修饰符可以确保所有子类也必须提供此构造器实现，从而也能符合协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 构造器要求</span></span><br><span class="line">    <span class="keyword">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类：没有实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSuperClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 这里是构造器的实现部分</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类：既继承了父类，也实现了协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeSubClass</span>: <span class="title">SomeSuperClass</span>, <span class="title">SomeProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 因为继承自父类，需要加上 override</span></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="comment">// 这里是构造器的实现部分</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-5-2-可失败构造器要求"><a href="#22-5-2-可失败构造器要求" class="headerlink" title="22.5.2    可失败构造器要求"></a>22.5.2    可失败构造器要求</h3><blockquote>
<p><strong>说明：</strong>协议还可以为采纳协议的类型定义<code>可失败构造器要求</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>构造器</th>
<th>协议</th>
<th>实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>可失败构造器</td>
<td><code>init?</code></td>
<td><code>init?</code>或<code>init</code></td>
</tr>
<tr>
<td>非可失败构造器</td>
<td><code>init</code></td>
<td><code>init</code>或<code>init!</code></td>
</tr>
</tbody>
</table>
<h2 id="22-6-协议作为类型"><a href="#22-6-协议作为类型" class="headerlink" title="22.6    协议作为类型"></a>22.6    协议作为类型</h2><blockquote>
<p><strong>说明：</strong>尽管协议本身并未实现任何功能，但是协议可以被当做一个成熟的类型来使用。</p>
<ul>
<li>作为函数、方法或构造器中的<code>参数类型</code>或<code>返回值类型</code></li>
<li>作为<code>常量</code>、<code>变量</code>或<code>属性</code>的类型</li>
<li>作为数组、字典或其他<code>容器中的元素类型</code></li>
</ul>
<p><strong>注意：</strong>作为一种类型，协议类型的名称应与其他类型的写法相同（<code>大写字母开头的驼峰式写法</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 使用协议类型声明常量</span></span><br><span class="line">    <span class="keyword">let</span> generator: <span class="type">RandomNumberGenerator</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用协议类型作为参数（需要传递一个实现了该协议枚举、结构体或类的实例）</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>, generator: <span class="type">RandomNumberGenerator</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">        <span class="keyword">self</span>.generator = generator</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 掷骰子</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">roll</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(generator.random() * <span class="type">Double</span>(sides)) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建骰子实例</span></span><br><span class="line"><span class="keyword">var</span> d6 = <span class="type">Dice</span>(sides: <span class="number">6</span>, generator: <span class="type">LinearCongruentialGenerator</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 掷骰子5次</span></span><br><span class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">1</span>...<span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Random dice roll is \(d6.roll())"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-7-委托（代理）模式"><a href="#22-7-委托（代理）模式" class="headerlink" title="22.7    委托（代理）模式"></a>22.7    委托（代理）模式</h2><blockquote>
<p><strong>描述：</strong>委托是一种<code>设计模式</code>，它允许<code>类或结构体</code>将一些需要它们负责的功能委托给其他类型的实例。<br><strong>说明：</strong>委托模式的实现很简单</p>
<ul>
<li>定义协议来封装那些需要被委托的功能，这样就能确保采纳协议的类型能提供这些功能</li>
<li>委托模式可以用来响应特定的动作，或者接收外部数据源提供的数据，而无需关心外部数据源的类型。</li>
</ul>
<p><strong>案例：</strong><code>游戏</code>将监控这一功能委托给<code>游戏监控器</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 使用协议类型声明常量</span></span><br><span class="line">    <span class="keyword">let</span> generator: <span class="type">RandomNumberGenerator</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用协议类型作为参数（需要传递一个实现了该协议枚举、结构体或类的实例）</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>, generator: <span class="type">RandomNumberGenerator</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">        <span class="keyword">self</span>.generator = generator</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 掷骰子</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">roll</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Int</span>(generator.random() * <span class="type">Double</span>(sides)) + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议：掷骰子游戏</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DiceGame</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子</span></span><br><span class="line">    <span class="keyword">var</span> dice: <span class="type">Dice</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 进行游戏</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">play</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议：追踪 DiceGame</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">DiceGameDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 游戏开始</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidStart</span><span class="params">(game: DiceGame)</span></span></span><br><span class="line">    <span class="comment">// 游戏进行</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">game</span><span class="params">(game: DiceGame, didStartNewTurnWithDiceRoll diceRoll:Int)</span></span></span><br><span class="line">    <span class="comment">// 游戏结束</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidEnd</span><span class="params">(game: DiceGame)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现：蛇梯棋游戏</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SnakesAndLadders</span>: <span class="title">DiceGame</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> finalSquare = <span class="number">25</span></span><br><span class="line">    <span class="comment">// 实现属性（要求只读，可以声明为 let ）</span></span><br><span class="line">    <span class="keyword">let</span> dice = <span class="type">Dice</span>(sides: <span class="number">6</span>, generator: <span class="type">LinearCongruentialGenerator</span>())</span><br><span class="line">    <span class="keyword">var</span> square = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> board: [<span class="type">Int</span>]</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        board = [<span class="type">Int</span>](<span class="built_in">count</span>: finalSquare + <span class="number">1</span>, repeatedValue: <span class="number">0</span>)</span><br><span class="line">        board[<span class="number">03</span>] = +<span class="number">08</span>; board[<span class="number">06</span>] = +<span class="number">11</span>; board[<span class="number">09</span>] = +<span class="number">09</span>; board[<span class="number">10</span>] = +<span class="number">02</span></span><br><span class="line">        board[<span class="number">14</span>] = -<span class="number">10</span>; board[<span class="number">19</span>] = -<span class="number">11</span>; board[<span class="number">22</span>] = -<span class="number">02</span>; board[<span class="number">24</span>] = -<span class="number">08</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏监控器</span></span><br><span class="line">    <span class="keyword">var</span> delegate: <span class="type">DiceGameDelegate</span>?</span><br><span class="line">    <span class="comment">// 实现方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">play</span><span class="params">()</span></span> &#123;</span><br><span class="line">        square = <span class="number">0</span></span><br><span class="line">        <span class="comment">// 开始游戏</span></span><br><span class="line">        delegate?.gameDidStart(<span class="keyword">self</span>)</span><br><span class="line">        gameLoop: <span class="keyword">while</span> square != finalSquare &#123;</span><br><span class="line">            <span class="keyword">let</span> diceRoll = dice.roll()</span><br><span class="line">            delegate?.game(<span class="keyword">self</span>, didStartNewTurnWithDiceRoll: diceRoll)</span><br><span class="line">            <span class="keyword">switch</span> square + diceRoll &#123;</span><br><span class="line">            <span class="keyword">case</span> finalSquare:</span><br><span class="line">                <span class="keyword">break</span> gameLoop</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> newSquare <span class="keyword">where</span> newSquare &gt; finalSquare:</span><br><span class="line">                <span class="keyword">continue</span> gameLoop</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                square += diceRoll</span><br><span class="line">                square += board[square]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 结束游戏</span></span><br><span class="line">        delegate?.gameDidEnd(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现：游戏监控器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DiceGameTracker</span>: <span class="title">DiceGameDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfTurns = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 游戏开始时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidStart</span><span class="params">(game: DiceGame)</span></span> &#123;</span><br><span class="line">        numberOfTurns = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> game <span class="keyword">is</span> <span class="type">SnakesAndLadders</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Started a new game of Snakes and Ladders"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"The game is using a \(game.dice.sides)-sided dice"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏进行时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">game</span><span class="params">(game: DiceGame, didStartNewTurnWithDiceRoll diceRoll: Int)</span></span> &#123;</span><br><span class="line">        ++numberOfTurns</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Rolled a \(diceRoll)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 游戏结束时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">gameDidEnd</span><span class="params">(game: DiceGame)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"The game lasted for \(numberOfTurns) turns"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监控器实例</span></span><br><span class="line"><span class="keyword">let</span> tracker = <span class="type">DiceGameTracker</span>()</span><br><span class="line"><span class="comment">// 游戏实例</span></span><br><span class="line"><span class="keyword">let</span> game = <span class="type">SnakesAndLadders</span>()</span><br><span class="line"><span class="comment">// 将监控器实例提供给游戏实例(不是必需的)</span></span><br><span class="line">game.delegate = tracker</span><br><span class="line"><span class="comment">// 游戏开始</span></span><br><span class="line">game.play()</span><br></pre></td></tr></table></figure>
<h2 id="22-8-在扩展中添加协议成员"><a href="#22-8-在扩展中添加协议成员" class="headerlink" title="22.8    在扩展中添加协议成员"></a>22.8    在扩展中添加协议成员</h2><blockquote>
<p><strong>说明：</strong>即便无法修改源代码，依然可以通过扩展令已有类型采纳并符合协议。<br><strong>原理：</strong>通过扩展令已有类型采纳并符合协议时，该类型的所有实例也会随之获得协议中定义的各项功能。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 骰子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 骰子的面</span></span><br><span class="line">    <span class="keyword">let</span> sides: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(sides: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sides = sides</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  通过extension使骰子实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Dice</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A \(sides)-sided dice"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> d12 = <span class="type">Dice</span>(sides: <span class="number">12</span>)</span><br><span class="line"><span class="built_in">print</span>(d12.textualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-9-通过扩展补充协议声明"><a href="#22-9-通过扩展补充协议声明" class="headerlink" title="22.9    通过扩展补充协议声明"></a>22.9    通过扩展补充协议声明</h2><blockquote>
<p><strong>说明：</strong>可以通过扩展<code>空的扩展体</code>补充协议声明。需要两个前提</p>
<ul>
<li><code>已经实现了</code>协议中所有要求</li>
<li><code>没有声明</code>为遵循该协议</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体（没有声明实现的协议）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hamster</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A hamster named \(name)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展补充协议声明</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Hamster</span>: <span class="title">TextRepresentable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> simonTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Simon"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为 TextRepresentable 类型使用</span></span><br><span class="line"><span class="keyword">let</span> somethingTextRepresentable: <span class="type">TextRepresentable</span> = simonTheHamster</span><br><span class="line"><span class="built_in">print</span>(somethingTextRepresentable.textualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-10-集合中的协议类型"><a href="#22-10-集合中的协议类型" class="headerlink" title="22.10    集合中的协议类型"></a>22.10    集合中的协议类型</h2><blockquote>
<p><strong>说明：</strong>协议类型可以在集合使用,表示<code>集合中的元素均为协议类型</code><br><strong>注意：</strong>被当作协议类型使用后，只能使用和访问协议指定的功能（丢失具体类型的特色能力）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议类型数组</span></span><br><span class="line"><span class="keyword">let</span> things: [<span class="type">TextRepresentable</span>] = [game, d12, simonTheHamster]</span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> things &#123;</span><br><span class="line">    <span class="built_in">print</span>(thing.textualDescription)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-11-协议的继承"><a href="#22-11-协议的继承" class="headerlink" title="22.11    协议的继承"></a>22.11    协议的继承</h2><blockquote>
<p><strong>说明：</strong>协议能够继承一个或多个其他协议，可以在继承的协议的基础上增加新的要求。和类的继承类似<br><strong>语法：</strong>多个被继承的协议间用<code>,</code>分隔</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">InheritingProtocol</span>: <span class="title">SomeProtocol</span>, <span class="title">AnotherProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里是协议的定义部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">PrettyTextRepresentable</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 额外要求采纳协议的类型提供一个返回值为 String 类型的 prettyTextualDescription 属性</span></span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展让已有类实现子类协议（要同时实现父类协议）</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SnakesAndLadders</span>: <span class="title">PrettyTextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> output = textualDescription + <span class="string">":\n"</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...finalSquare &#123;</span><br><span class="line">            <span class="keyword">switch</span> board[index] &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> ladder <span class="keyword">where</span> ladder &gt; <span class="number">0</span>:</span><br><span class="line">                output += <span class="string">"▲ "</span></span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> snake <span class="keyword">where</span> snake &lt; <span class="number">0</span>:</span><br><span class="line">                output += <span class="string">"▼ "</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                output += <span class="string">"○ "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 已有的实例也会获取到这种实现</span></span><br><span class="line"><span class="built_in">print</span>(game.prettyTextualDescription)</span><br></pre></td></tr></table></figure>
<h2 id="22-12-类类型专属协议"><a href="#22-12-类类型专属协议" class="headerlink" title="22.12    类类型专属协议"></a>22.12    类类型专属协议</h2><blockquote>
<p><strong>说明：</strong>以在<code>协议的继承列表</code>中，通过添加 <code>class</code> 关键字来限制协议只能被<code>类</code>类型采纳，而<code>结构体</code>或<code>枚举</code>不能采纳该协议<br><strong>语法：</strong><code>class</code> 关键字必须<code>第一个出现在协议的继承列表中</code>(在其他继承的协议之前)<br><strong>应用：</strong>当协议定义的要求需要采纳协议的类型必须是<code>引用</code>语义而非<code>值</code>语义时，应该采用类类型专属协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">SomeClassOnlyProtocol</span>: <span class="title">class</span>, <span class="title">SomeInheritedProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里是类类型专属协议的定义部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-13-协议合成"><a href="#22-13-协议合成" class="headerlink" title="22.13    协议合成"></a>22.13    协议合成</h2><blockquote>
<p><strong>说明：</strong>有时候需要同时采纳多个协议，你可以将多个协议采用 <code>protocol&lt;SomeProtocol, AnotherProtocol&gt;</code> 这样的格式进行组合，作为一种<code>临时协议</code>存在，这个过程称为 <code>协议合成</code>。<br><strong>语法：</strong>可以在 <code>protocol&lt;&gt;</code> 中罗列任意多个你想要采纳的协议，以<code>,</code>分隔。<br><strong>注意：</strong>协议合成并不会生成新的、永久的协议类型，而是将多个协议中的要求合成到一个<code>只在局部作用域有效</code>的<code>临时协议</code>中。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议1</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Named</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 协议2</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Aged</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现两个协议</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span>: <span class="title">Named</span>, <span class="title">Aged</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 协议合成</span><br><span class="line">* @param &#123;protocol&lt;Named, Aged&gt;&#125; celebrator 实现了两种协议的类型的实例</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wishHappyBirthday</span><span class="params">(celebrator: <span class="keyword">protocol</span>&lt;Named, Aged&gt;)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Happy birthday \(celebrator.name) - you're \(celebrator.age)!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">let</span> birthdayPerson = <span class="type">Person</span>(name: <span class="string">"Malcolm"</span>, age: <span class="number">21</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传递符合两种协议的实例给函数</span></span><br><span class="line">wishHappyBirthday(birthdayPerson)</span><br></pre></td></tr></table></figure>
<h2 id="22-14-检验协议的一致性"><a href="#22-14-检验协议的一致性" class="headerlink" title="22.14    检验协议的一致性"></a>22.14    检验协议的一致性</h2><blockquote>
<p><strong>说明：</strong>其实就是检验<code>是否符合某协议</code>，或者转换到指定的协议类型。检查和转换到某个协议类型在语法上和<code>类型的检查和转换</code>完全相同</p>
</blockquote>
<table>
<thead>
<tr>
<th>操作符</th>
<th>用途</th>
<th>返回值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>is</code></td>
<td>用来检查实例是否符合某个协议</td>
<td>符合则返回 <code>true</code>，否则返回 <code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>as?</code></td>
<td>返回指定协议的可选值</td>
<td>，当实例符合某个协议时，返回类型为协议类型的可选值，否则返回 <code>nil</code></td>
<td></td>
</tr>
<tr>
<td><code>as!</code></td>
<td>将实例强制向下转换到某个协议类型</td>
<td>指定的协议类型</td>
<td>如果强转失败，会引发运行时错误</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>: <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> pi = <span class="number">3.1415927</span></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span> &#123; <span class="keyword">return</span> pi * radius * radius &#125;</span><br><span class="line">    <span class="keyword">init</span>(radius: <span class="type">Double</span>) &#123; <span class="keyword">self</span>.radius = radius &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span>: <span class="title">HasArea</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> area: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>(area: <span class="type">Double</span>) &#123; <span class="keyword">self</span>.area = area &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> legs: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(legs: <span class="type">Int</span>) &#123; <span class="keyword">self</span>.legs = legs &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应实例</span></span><br><span class="line"><span class="keyword">let</span> objects: [<span class="type">AnyObject</span>] = [</span><br><span class="line">    <span class="type">Circle</span>(radius: <span class="number">2.0</span>),</span><br><span class="line">    <span class="type">Country</span>(area: <span class="number">243_610</span>),</span><br><span class="line">    <span class="type">Animal</span>(legs: <span class="number">4</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历，使用 as?</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> objects &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> objectWithArea = object <span class="keyword">as</span>? <span class="type">HasArea</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Area is \(objectWithArea.area)"</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Something that doesn't have an area"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-15-对可选协议的规定"><a href="#22-15-对可选协议的规定" class="headerlink" title="22.15    对可选协议的规定"></a>22.15    对可选协议的规定</h2><blockquote>
<p><strong>说明：</strong>协议可以定义可选要求，采纳协议的类型可以选择是否实现这些要求。<br><strong>语法：</strong>在协议中使用 <code>optional</code>关键字作为前缀来定义可选要求。</p>
<ul>
<li>使用可选要求时，它们的类型会自动变成可选的</li>
<li>需要<code>import Foundation</code></li>
</ul>
<p><strong>限制：</strong></p>
<ul>
<li><strong>定义协议：</strong>可选的协议要求只能用在标记 <code>@objc</code> 特性的协议中</li>
<li><strong>采纳协议：</strong>标记 <code>@objc</code> 特性的协议只能被<code>继承自 Objective-C 类的类</code>或者<code>@objc 类</code>采纳</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* @objc</span><br><span class="line">* 协议：只能被 [继承自 Objective-C 类的类] 或者 [@objc 类]采纳</span><br><span class="line">*/</span></span><br><span class="line">objc <span class="class"><span class="keyword">protocol</span> <span class="title">CounterDataSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">incrementForCount</span><span class="params">(<span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">Int</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="keyword">var</span> fixedIncrement: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> dataSource: <span class="type">CounterDataSource</span>?</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> amount = dataSource?.incrementForCount?(<span class="built_in">count</span>) &#123;</span><br><span class="line">            <span class="built_in">count</span> += amount</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> amount = dataSource?.fixedIncrement &#123;</span><br><span class="line">            <span class="built_in">count</span> += amount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 采纳协议</span><br><span class="line">* 继承了 NSObject，所以可以采纳 CounterDataSource</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreeSource</span>: <span class="title">NSObject</span>, <span class="title">CounterDataSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fixedIncrement = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = <span class="type">Counter</span>()</span><br><span class="line">counter.dataSource = <span class="type">ThreeSource</span>()</span><br><span class="line"><span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">1</span>...<span class="number">4</span> &#123;</span><br><span class="line">    counter.increment()</span><br><span class="line">    <span class="built_in">print</span>(counter.<span class="built_in">count</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="22-16-协议扩展"><a href="#22-16-协议扩展" class="headerlink" title="22.16    协议扩展"></a>22.16    协议扩展</h2><blockquote>
<p><strong>说明：</strong>协议可以通过<code>扩展</code>来为<code>采纳协议的类型</code>提供属性、方法以及下标脚本的实现。<br><strong>优点：</strong>扩展协议不但扩展了要求，同时提供了实现。因而<code>无需</code>在每个采纳协议的类型中都重复同样的实现，也<code>无需</code>使用全局函数。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议：线性同余随机数生成器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCongruentialGenerator</span>: <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存储上一次生成的随机数</span></span><br><span class="line">    <span class="keyword">var</span> lastRandom = <span class="number">42.0</span></span><br><span class="line">    <span class="keyword">let</span> m = <span class="number">139968.0</span></span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">3877.0</span></span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="number">29573.0</span></span><br><span class="line">    <span class="comment">// 获取随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">random</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        lastRandom = ((lastRandom * a + <span class="built_in">c</span>) % m)</span><br><span class="line">        <span class="keyword">return</span> lastRandom / m</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展协议（同时提供了实现）</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">RandomNumberGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">randomBool</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> random() &gt; <span class="number">0.5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳了协议的类型的实例</span></span><br><span class="line"><span class="keyword">let</span> generator = <span class="type">LinearCongruentialGenerator</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Here's a random number: \(generator.random())"</span>)</span><br><span class="line"><span class="comment">// 打印 “Here's a random number: 0.37464991998171”</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"And here's a random Boolean: \(generator.randomBool())"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="22-16-1-提供默认实现"><a href="#22-16-1-提供默认实现" class="headerlink" title="22.16.1    提供默认实现"></a>22.16.1    提供默认实现</h3><blockquote>
<p><strong>说明：</strong>可以通过<code>协议扩展</code>来为协议要求的属性、方法以及下标脚本提供<code>默认的实现</code>。<br><strong>注意：</strong>如果采纳协议的类型为这些要求提供了自己的实现，那么这些<code>自定义实现将会替代扩展中的默认实现</code>被使用。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PrettyTextRepresentable</span>  </span>&#123;</span><br><span class="line">	<span class="comment">// 为协议提供一个默认的属性</span></span><br><span class="line">    <span class="keyword">var</span> prettyTextualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> textualDescription</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-16-2-为协议扩展添加限制条件"><a href="#22-16-2-为协议扩展添加限制条件" class="headerlink" title="22.16.2    为协议扩展添加限制条件"></a>22.16.2    为协议扩展添加限制条件</h3><blockquote>
<p><strong>说明：</strong>在<code>扩展协议</code>的时候，可以<code>指定一些限制条件</code>，只有采纳协议的类型满足这些限制条件时，才能获得协议扩展提供的<code>默认实现</code>。<br><strong>语法：</strong>这些限制条件写在<code>协议名之后</code>，使用 <code>where</code> 子句来描述.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 协议：要求提供一个能描述自身的计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体（没有声明实现的协议）</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hamster</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A hamster named \(name)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展补充协议声明</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Hamster</span>: <span class="title">TextRepresentable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过扩展采纳协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CollectionType</span> <span class="title">where</span> <span class="title">Generator</span>.<span class="title">Element</span>: <span class="title">TextRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> textualDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> itemsAsText = <span class="keyword">self</span>.<span class="built_in">map</span> &#123; $<span class="number">0</span>.textualDescription &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"["</span> + itemsAsText.joinWithSeparator(<span class="string">", "</span>) + <span class="string">"]"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> murrayTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Murray"</span>)</span><br><span class="line"><span class="keyword">let</span> morganTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Morgan"</span>)</span><br><span class="line"><span class="keyword">let</span> mauriceTheHamster = <span class="type">Hamster</span>(name: <span class="string">"Maurice"</span>)</span><br><span class="line"><span class="keyword">let</span> hamsters = [murrayTheHamster, morganTheHamster, mauriceTheHamster]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hamsters.textualDescription)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_21 扩展/" itemprop="url">
                  21 扩展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:57:35+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_21 扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_21 扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>扩展</code>就是为一个已有的<code>类</code>、<code>结构体</code>、<code>枚举类型</code>或者<code>协议类型</code>添加新功能(包括没有权限获取原始源代码的情况)。</p>
<ul>
<li>添加<code>计算型属性</code>和<code>计算类型属性</code></li>
<li>定义<code>实例方法</code>和<code>类型方法</code></li>
<li>提供新的<code>构造器</code></li>
<li>定义<code>下标</code></li>
<li>定义和使用新的<code>嵌套类型</code></li>
<li>是一个有类型符合某个<code>协议</code></li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>扩展可以为一个类型添加新的功能，但是<code>不能重写已有的功能</code>。</li>
<li>如果你通过扩展为一个已有类型添加新功能，那么新功能对该类型的所有已有实例都是可用的，<code>即使它们是在这个扩展定义之前创建的</code>。</li>
</ul>
</blockquote>
<h2 id="21-1-扩展语法"><a href="#21-1-扩展语法" class="headerlink" title="21.1    扩展语法"></a>21.1    扩展语法</h2><blockquote>
<p><strong>说明：</strong>使用<code>extension</code>声明扩展</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 形式一：为SomeType添加功能</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SomeType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 为 SomeType 添加的新功能写到这里</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 形式二：使SomeType实现协议</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">SomeType</span>: <span class="title">SomeProtocol</span>, <span class="title">AnotherProctocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 协议实现写到这里</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="21-2-计算型属性"><a href="#21-2-计算型属性" class="headerlink" title="21.2    计算型属性"></a>21.2    计算型属性</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加<code>计算型实例属性</code>和<code>计算型类型属性</code>。<br><strong>注意：</strong>不可以添加<code>存储型属性</code>，也不可以为已有属性<code>添加属性观察器</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为Double添加一些只读计算属性</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Double</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 千米</span></span><br><span class="line">    <span class="keyword">var</span> km: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> * <span class="number">1_000.0</span> &#125;</span><br><span class="line">    <span class="comment">// 米</span></span><br><span class="line">    <span class="keyword">var</span> m : <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> &#125;</span><br><span class="line">    <span class="comment">// 厘米</span></span><br><span class="line">    <span class="keyword">var</span> cm: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">100.0</span> &#125;</span><br><span class="line">    <span class="comment">// 毫米</span></span><br><span class="line">    <span class="keyword">var</span> mm: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">1_000.0</span> &#125;</span><br><span class="line">    <span class="comment">// 尺</span></span><br><span class="line">    <span class="keyword">var</span> ft: <span class="type">Double</span> &#123; <span class="keyword">return</span> <span class="keyword">self</span> / <span class="number">3.28084</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问计算属性</span></span><br><span class="line"><span class="keyword">let</span> oneInch = <span class="number">25.4</span>.mm<span class="comment">// 0.0254</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> threeFeet = <span class="number">3</span>.ft<span class="comment">// 0.914399970739201</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> aMarathon = <span class="number">42</span>.km + <span class="number">195</span>.m<span class="comment">// 42195.0</span></span><br></pre></td></tr></table></figure>
<h2 id="21-3-构造器"><a href="#21-3-构造器" class="headerlink" title="21.3    构造器"></a>21.3    构造器</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加<code>新的构造器</code>(便利构造器)</p>
<ul>
<li>在为值类型扩展的构造器中调用<code>逐一构造器</code>：值类型的原始实现中未定义任何定制的构造器时</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大小</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Size</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span>, height = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 坐标</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正方形</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 原点</span></span><br><span class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</span><br><span class="line">    <span class="comment">// 大小</span></span><br><span class="line">    <span class="keyword">var</span> size = <span class="type">Size</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例：默认构造器</span></span><br><span class="line"><span class="keyword">let</span> defaultRect = <span class="type">Rect</span>()</span><br><span class="line"><span class="comment">// 创建实例：逐一成员构造器</span></span><br><span class="line"><span class="keyword">let</span> memberwiseRect = <span class="type">Rect</span>(origin: <span class="type">Point</span>(x: <span class="number">2.0</span>, y: <span class="number">2.0</span>),</span><br><span class="line">    size: <span class="type">Size</span>(width: <span class="number">5.0</span>, height: <span class="number">5.0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展 Rect</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Rect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加一个新的构造器</span></span><br><span class="line">    <span class="keyword">init</span>(center: <span class="type">Point</span>, size: <span class="type">Size</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> originX = center.x - (size.width / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">let</span> originY = center.y - (size.height / <span class="number">2</span>)</span><br><span class="line">        <span class="comment">// 调用逐一成员构造器</span></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(origin: <span class="type">Point</span>(x: originX, y: originY), size: size)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用扩展的构造器创建 Rect 的实例</span></span><br><span class="line"><span class="keyword">let</span> centerRect = <span class="type">Rect</span>(center: <span class="type">Point</span>(x: <span class="number">4.0</span>, y: <span class="number">4.0</span>),</span><br><span class="line">    size: <span class="type">Size</span>(width: <span class="number">3.0</span>, height: <span class="number">3.0</span>))</span><br></pre></td></tr></table></figure>
<h2 id="21-4-方法"><a href="#21-4-方法" class="headerlink" title="21.4    方法"></a>21.4    方法</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加新的<code>实例方法</code>和<code>类型方法</code>。<br><strong>注意：</strong><code>结构体</code>和<code>枚举</code>类型中修改 <code>self</code> 或<code>其属性</code>的方法必须将该实例方法标注为 <code>mutating</code>，正如来自原始实现的<code>变异方法</code>一样。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 添加一个实例方法</span><br><span class="line">    * 按照自身数目重复执行一个任务</span><br><span class="line">    * @param &#123;() -&gt; Void&#125; task 函数</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">repetitions</span><span class="params">(task: <span class="params">()</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="keyword">self</span> &#123;</span><br><span class="line">            task()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用扩展的实例方法</span></span><br><span class="line"><span class="number">3</span>.repetitions(&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello!"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更简洁的方式（使用尾随闭包）</span></span><br><span class="line"><span class="number">3</span>.repetitions &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Goodbye!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>添加变异方法</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 结构体和枚举类型中修改 self 或其属性的方法必须将该实例方法标注为 mutating</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">square</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span> = <span class="keyword">self</span> * <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> someInt = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用扩展的实例方法</span></span><br><span class="line">someInt.square()</span><br></pre></td></tr></table></figure>
<h2 id="21-5-下标"><a href="#21-5-下标" class="headerlink" title="21.5    下标"></a>21.5    下标</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有类型添加新<code>下标</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* 添加一个下标</span><br><span class="line">     * 从右往左数</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">subscript</span>(<span class="keyword">var</span> digitIndex: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> decimalBase = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> digitIndex &gt; <span class="number">0</span> &#123;</span><br><span class="line">            decimalBase *= <span class="number">10</span></span><br><span class="line">            --digitIndex</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">self</span> / decimalBase) % <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">746381295</span>[<span class="number">0</span>]<span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">1</span>]<span class="comment">// 9</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">2</span>]<span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="number">746381295</span>[<span class="number">8</span>]<span class="comment">// 7</span></span><br></pre></td></tr></table></figure>
<h2 id="21-6-嵌套类型"><a href="#21-6-嵌套类型" class="headerlink" title="21.6    嵌套类型"></a>21.6    嵌套类型</h2><blockquote>
<p><strong>说明：</strong>扩展可以为已有的<code>类</code>、<code>结构体</code>和<code>枚举</code>添加新的<code>嵌套类型</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展 Int 类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 数字类型（正、0、负）</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Kind</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Negative</span>, <span class="type">Zero</span>, <span class="type">Positive</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算属性：获取数字类型</span></span><br><span class="line">    <span class="keyword">var</span> kind: <span class="type">Kind</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Zero</span></span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Positive</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> .<span class="type">Negative</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 判断数组中 Int 的类型</span><br><span class="line">* @param &#123;[Int]&#125; numbers Int数组</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printIntegerKinds</span><span class="params">(numbers: [Int])</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">switch</span> number.kind &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Negative</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"- "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Zero</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"0 "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Positive</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"+ "</span>, terminator: <span class="string">""</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">printIntegerKinds([<span class="number">3</span>, <span class="number">19</span>, -<span class="number">27</span>, <span class="number">0</span>, -<span class="number">6</span>, <span class="number">0</span>, <span class="number">7</span>])<span class="comment">// + + - 0 - 0 +swift</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_20 类型嵌套/" itemprop="url">
                  20 类型嵌套
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:57:17+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_20 类型嵌套/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_20 类型嵌套/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Swift</code> 允许你定义嵌套类型，可以在支持的类型中定义嵌套的<code>枚举</code>、<code>类</code>和<code>结构体</code>。可以根据需要定义<code>多级嵌套</code>。<br><strong>用途：</strong>方便地定义工具类或结构体来使用。</p>
</blockquote>
<h2 id="20-1-嵌套类型实践"><a href="#20-1-嵌套类型实践" class="headerlink" title="20.1    嵌套类型实践"></a>20.1    嵌套类型实践</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">* 扑克牌</span><br><span class="line">* 没有自定义构造器的结构体：因此有默认的成员构造器</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlackjackCard</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 嵌套的 Suit 枚举</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Suit</span>: <span class="title">Character</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Spades</span> = <span class="string">"♠"</span>, <span class="type">Hearts</span> = <span class="string">"♡"</span>, <span class="type">Diamonds</span> = <span class="string">"♢"</span>, <span class="type">Clubs</span> = <span class="string">"♣"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 嵌套的 Rank 枚举</span></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Rank</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Two</span> = <span class="number">2</span>, <span class="type">Three</span>, <span class="type">Four</span>, <span class="type">Five</span>, <span class="type">Six</span>, <span class="type">Seven</span>, <span class="type">Eight</span>, <span class="type">Nine</span>, <span class="type">Ten</span></span><br><span class="line">        <span class="keyword">case</span> <span class="type">Jack</span>, <span class="type">Queen</span>, <span class="type">King</span>, <span class="type">Ace</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Values</span> </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> first: <span class="type">Int</span>, second: <span class="type">Int</span>?</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> values: <span class="type">Values</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Ace</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="number">1</span>, second: <span class="number">11</span>)</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Jack</span>, .<span class="type">Queen</span>, .<span class="type">King</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="number">10</span>, second: <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Values</span>(first: <span class="keyword">self</span>.rawValue, second: <span class="literal">nil</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用嵌套在结构体内部的类型声明属性</span></span><br><span class="line">    <span class="keyword">let</span> rank: <span class="type">Rank</span>, suit: <span class="type">Suit</span></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> output = <span class="string">"suit is \(suit.rawValue),"</span></span><br><span class="line">        output += <span class="string">" value is \(rank.values.first)"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> second = rank.values.second &#123;</span><br><span class="line">            output += <span class="string">" or \(second)"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例（嵌套类型也能用于类型推断）</span></span><br><span class="line"><span class="keyword">let</span> theAceOfSpades = <span class="type">BlackjackCard</span>(rank: .<span class="type">Ace</span>, suit: .<span class="type">Spades</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"theAceOfSpades:\(theAceOfSpades.description)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="20-2-嵌套类型的引用"><a href="#20-2-嵌套类型的引用" class="headerlink" title="20.2    嵌套类型的引用"></a>20.2    嵌套类型的引用</h2><blockquote>
<p><strong>说明：</strong>在外部引用嵌套类型时，在<code>嵌套类型的类型名</code>前加上<code>其外部类型的类型名</code>作为前缀。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用嵌套类型</span></span><br><span class="line"><span class="keyword">let</span> heartsSymbol = <span class="type">BlackjackCard</span>.<span class="type">Suit</span>.<span class="type">Hearts</span>.rawValue</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_19 类型转换（Type Casting）/" itemprop="url">
                  19 类型转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:56:57+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_19 类型转换（Type Casting）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_19 类型转换（Type Casting）/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>类型转换</code>可以判断实例的类型，也可以将实例看做是其父类或者子类的实例。<br><strong>操作符：</strong><code>is</code>和<code>as</code></p>
<ul>
<li>检查值的类型：<code>is</code></li>
<li>转换类型：<code>as</code></li>
</ul>
</blockquote>
<h2 id="19-1-定义一个类层次作为例子"><a href="#19-1-定义一个类层次作为例子" class="headerlink" title="19.1    定义一个类层次作为例子"></a>19.1    定义一个类层次作为例子</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多媒体文件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaItem</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//电影</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span>:<span class="title">MediaItem</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> director:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name:<span class="type">String</span>, director:<span class="type">String</span>)&#123;</span><br><span class="line">        <span class="keyword">self</span>.director = director</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//歌曲</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Song</span>:<span class="title">MediaItem</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> artist:<span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>,artist:<span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.artist = artist</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//存储多媒体文件的数组（迭代该数组取出的每一项类型都会是MediaItem）</span></span><br><span class="line"><span class="keyword">let</span> library = [</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Casablance"</span>, director: <span class="string">"Michael Curtiz"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"Blue Suede Shoes"</span>, artist: <span class="string">"Elvis Presley"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Citizen Kane"</span>, director: <span class="string">"Orson Welles"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"The One And The Only"</span>, artist: <span class="string">"Chesney Jawkes"</span>),</span><br><span class="line">    <span class="type">Song</span>(name: <span class="string">"Never Gonna Give You up"</span>, artist: <span class="string">"Rick Astley"</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="19-2-检查类型"><a href="#19-2-检查类型" class="headerlink" title="19.2    检查类型"></a>19.2    检查类型</h2><blockquote>
<p><strong>说明：</strong><code>类型检查操作符(is)</code>，用来检查一个实例是否属于<code>特定子类型</code>。若实例属于那个子类型，类型检查操作符返回 <code>true</code>，否则返回 <code>false</code>。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算电影和歌曲类型分别的有多少个</span></span><br><span class="line"><span class="keyword">var</span> movieCount = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> songCount = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> library&#123;</span><br><span class="line">    <span class="comment">//通过is判断一个实例具体是某种类型的哪种子类型</span></span><br><span class="line">    <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">Movie</span>&#123;</span><br><span class="line">        ++movieCount</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> item <span class="keyword">is</span> <span class="type">Song</span>&#123;</span><br><span class="line">        ++songCount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println</span>(<span class="string">"Media library contains \(movieCount) movies and \(songCount) songs"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="19-3-向下转型"><a href="#19-3-向下转型" class="headerlink" title="19.3    向下转型"></a>19.3    向下转型</h2><blockquote>
<p><strong>两种方式：</strong>可选形式和强制形式<br><strong>注意：</strong>类型转换不影响原本被转换的实例</p>
</blockquote>
<table>
<thead>
<tr>
<th><em>**</em></th>
<th>可选形式</th>
<th>强制形式</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型转换操作符</td>
<td><code>as?</code></td>
<td><code>as</code></td>
</tr>
<tr>
<td>适用场景</td>
<td>试图向下转型为一个不确定的类型</td>
<td>向下转成一个确定的类型</td>
</tr>
<tr>
<td>返回值</td>
<td>返回试图向下转成的的类型的可选值</td>
<td>返回目标类型</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//向下转型(不改变原本实例，指示获得转变后的实例来使用)</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> library&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> movie = item <span class="keyword">as</span>? <span class="type">Movie</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.\(movie.director)"</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> song = item <span class="keyword">as</span>? <span class="type">Song</span>&#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"Song:'\(song.name)',by \(song.artist)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="19-4-Any和AnyObject的类型转换"><a href="#19-4-Any和AnyObject的类型转换" class="headerlink" title="19.4    Any和AnyObject的类型转换"></a>19.4    <code>Any</code>和<code>AnyObject</code>的类型转换</h2><blockquote>
<p><strong>Swift为不确定类型提供了两种特殊类型别名：</strong></p>
<ul>
<li><code>AnyObject</code>：可以代表任何<code>class</code>类型的实例</li>
<li><code>Any</code>：可以表示任何类型，除了方法类型</li>
</ul>
<p><strong>注意：</strong>只有当你明确的需要它的行为和功能时才使用<code>Any</code>和<code>AnyObject</code></p>
</blockquote>
<h3 id="19-4-1-AnyObject类型"><a href="#19-4-1-AnyObject类型" class="headerlink" title="19.4.1    AnyObject类型"></a>19.4.1    <code>AnyObject</code>类型</h3><blockquote>
<p><strong>用途：</strong>在工作中使用 <code>Cocoa APIs</code> 时，我们经常会接收到一个 <code>[AnyObject]</code> 类型的数组，或者说“一个任意类型对象的数组”。这是因为 <code>Objective-C</code> 没有明确的类型化数组。<br><strong>说明：</strong>从 <code>Xcode 7</code> 和 <code>Swift 2.0</code> 开始，由于 <code>Objective-C</code> 引入了轻量泛型，集合类型已经可以类型化了，在 <code>Swift</code> 中使用 <code>Cocoa API</code> 也越来越少遇到 <code>AnyObjec</code> 类型了。<br><strong>技巧：</strong>可以使用强制形式的类型转换<code>as</code>来下转数组中的每一项到比 <code>AnyObject</code> 更明确的类型</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AnyObject:可以代表任何class类型的实例</span></span><br><span class="line"><span class="keyword">let</span> someObjects:[<span class="type">AnyObject</span>] = [</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"2001:A Space Obyssey"</span>, director: <span class="string">"Stanley Kubrick"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Moon"</span>, director: <span class="string">"Duncan Jones"</span>),</span><br><span class="line">    <span class="type">Movie</span>(name: <span class="string">"Alien"</span>, director: <span class="string">"Ridley Scott"</span>)</span><br><span class="line">]</span><br><span class="line"><span class="comment">//方式一</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> someObjects&#123;</span><br><span class="line">    <span class="keyword">let</span> movie = object <span class="keyword">as</span> <span class="type">Movie</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.Stanley Kubrick"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//方式二（更简洁）</span></span><br><span class="line"><span class="keyword">for</span> movie <span class="keyword">in</span> someObjects <span class="keyword">as</span> [<span class="type">Movie</span>]&#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">"Movie:'\(movie.name)',dir.\(movie.director)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-4-2-Any类型"><a href="#19-4-2-Any类型" class="headerlink" title="19.4.2    Any类型"></a>19.4.2    <code>Any</code>类型</h3><p><strong>注意：</strong>在<code>switch</code>语句的<code>case</code>中使用<code>as</code>而不是<code>as?</code>是安全的，不会导致运行时错误</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Any类型</span></span><br><span class="line"><span class="keyword">var</span> things = [<span class="type">Any</span>]()</span><br><span class="line">things.append(<span class="number">0</span>)</span><br><span class="line">things.append(<span class="number">0.0</span>)</span><br><span class="line">things.append(<span class="number">42</span>)</span><br><span class="line">things.append(<span class="number">3.141592654</span>)</span><br><span class="line">things.append(<span class="string">"hello"</span>)</span><br><span class="line">things.append(<span class="type">Movie</span>(name: <span class="string">"Ghostbusters"</span>, director: <span class="string">"Ivan Reitman"</span>))</span><br><span class="line">things.append(&#123;(name:<span class="type">String</span>) -&gt; <span class="type">String</span> <span class="keyword">in</span> <span class="string">"Hello,\(name)"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> thing <span class="keyword">in</span> things &#123;</span><br><span class="line">    <span class="keyword">switch</span> thing &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"zero as an Int"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> <span class="keyword">as</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"zero as a Double"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someInt <span class="keyword">as</span> <span class="type">Int</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"an integer value of \(someInt)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someDouble <span class="keyword">as</span> <span class="type">Double</span> <span class="keyword">where</span> someDouble &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a positive double value of \(someDouble)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">is</span> <span class="type">Double</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"some other double value that I don't want to print"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> someString <span class="keyword">as</span> <span class="type">String</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a string value of \"\(someString)\""</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> (x, y) <span class="keyword">as</span> (<span class="type">Double</span>, <span class="type">Double</span>):</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"an (x, y) point at \(x), \(y)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> movie <span class="keyword">as</span> <span class="type">Movie</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"a movie called '\(movie.name)', dir. \(movie.director)"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> stringConverter <span class="keyword">as</span> <span class="type">String</span> -&gt; <span class="type">String</span>:</span><br><span class="line">        <span class="built_in">println</span>(stringConverter(<span class="string">"Michael"</span>))</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"something else"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_18 错误处理/" itemprop="url">
                  18 错误处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:56:39+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_18 错误处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_18 错误处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>错误处理</code>是响应错误以及从错误中恢复的过程。<code>可选类型</code>可用来表示值缺失，但是当某个操作失败时，最好能得知失败的原因，从而可以作出相应的应对。<br><strong>扩展：</strong><code>Swift</code> 中的错误处理涉及到错误处理模式，这会用到 <code>Cocoa</code> 和 <code>Objective-C</code> 中的<code>NSError</code></p>
</blockquote>
<h2 id="18-1-表示并抛出错误"><a href="#18-1-表示并抛出错误" class="headerlink" title="18.1    表示并抛出错误"></a>18.1    表示并抛出错误</h2><blockquote>
<p><strong>说明：</strong>错误用符合<code>ErrorType</code>协议的类型的值来表示。这个空协议表明该类型可以用于错误处理。<br><strong>技巧：</strong>Swift 的<code>枚举</code>类型尤为适合构建一组相关的错误状态，枚举的关联值还可以提供错误状态的额外信息。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动贩卖机错误</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">VendingMachineError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">InvalidSelection</span><span class="comment">// 选择无效</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">InsufficientFunds</span>(coinsNeeded: <span class="type">Int</span>)<span class="comment">// 金额不足</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">OutOfStock</span><span class="comment">// 缺货</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抛出“金额不足”的错误</span></span><br><span class="line"><span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(coinsNeeded: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<h2 id="18-2-处理错误"><a href="#18-2-处理错误" class="headerlink" title="18.2    处理错误"></a>18.2    处理错误</h2><blockquote>
<p><strong>说明：</strong>某个错误被抛出时，附近的某部分代码必须负责处理这个错误。有<code>4</code>中给处理错误的方式</p>
<ul>
<li>把函数<code>抛出</code>的错误传递给调用此函数的代码</li>
<li>用<code>do-catch</code>语句处理错误</li>
<li>将错误作为<code>可选类型</code>处理</li>
<li><code>断言</code>此错误根本不会发生</li>
</ul>
<p><strong>标识可能出错的地方：</strong>在调用一个能抛出错误的<code>函数</code>、<code>方法</code>或者<code>构造器</code>之前，加上<code>try</code>关键字，或者<code>try?</code>或<code>try!</code>这种变体</p>
<p><strong>引伸：</strong>和其他语言中的异常处理不同的是，Swift 中的错误处理并不涉及解除调用栈，就此而言，<code>throw语句</code>的性能特性是可以和<code>return语句</code>相媲美的。</p>
</blockquote>
<h3 id="18-2-1-用throwing函数传递错误"><a href="#18-2-1-用throwing函数传递错误" class="headerlink" title="18.2.1    用throwing函数传递错误"></a>18.2.1    用throwing函数传递错误</h3><blockquote>
<p><strong>说明：</strong>一个标有<code>throws</code>关键字的函数被称作<code>throwing 函数</code>。</p>
<ul>
<li>调用<code>throwing函数</code>必须使用<code>try</code></li>
<li>调用<code>throwing函数</code>必须要么直接处理这些错误（使用<code>do-catch</code>语句，<code>try?</code>或<code>try!</code>）；要么继续将这些错误传递下去</li>
</ul>
<p><strong>用途：</strong>可以在其内部抛出错误，并将错误传递到函数<code>被调用时的作用域</code>。<br><strong>语法：</strong>在函数声明的<code>参数列表</code>和<code>-&gt;</code>之间加上<code>throws</code>关键字。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canThrowErrors</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>只有 <code>throwing函数</code>可以传递错误。任何在某个<code>非 throwing 函数</code>内部抛出的错误只能在函数内部处理。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动贩卖机错误</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">VendingMachineError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">InvalidSelection</span><span class="comment">// 选择无效</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">InsufficientFunds</span>(coinsNeeded: <span class="type">Int</span>)<span class="comment">// 金额不足</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">OutOfStock</span><span class="comment">// 缺货</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 商品</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动贩卖机</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VendingMachine</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 食品清单</span></span><br><span class="line">    <span class="keyword">var</span> inventory = [</span><br><span class="line">        <span class="string">"Candy Bar"</span>: <span class="type">Item</span>(price: <span class="number">12</span>, <span class="built_in">count</span>: <span class="number">7</span>),</span><br><span class="line">        <span class="string">"Chips"</span>: <span class="type">Item</span>(price: <span class="number">10</span>, <span class="built_in">count</span>: <span class="number">4</span>),</span><br><span class="line">        <span class="string">"Pretzels"</span>: <span class="type">Item</span>(price: <span class="number">7</span>, <span class="built_in">count</span>: <span class="number">11</span>)</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// 投币数量</span></span><br><span class="line">    <span class="keyword">var</span> coinsDeposited = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 发放食品</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dispenseSnack</span><span class="params">(snack: String)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Dispensing \(snack)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    * 出售</span><br><span class="line">    * throwing方法：会抛出相应错误（如果有的话）</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">vend</span><span class="params">(itemNamed name: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="comment">// 是否有对应商品</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">var</span> item = inventory[name] <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InvalidSelection</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 是否还有剩余</span></span><br><span class="line">        <span class="keyword">guard</span> item.<span class="built_in">count</span> &gt; <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">OutOfStock</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 投币是否足够</span></span><br><span class="line">        <span class="keyword">guard</span> item.price &lt;= coinsDeposited <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(coinsNeeded: item.price - coinsDeposited)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 没问题，进行交易</span></span><br><span class="line">        coinsDeposited -= item.price</span><br><span class="line">        --item.<span class="built_in">count</span></span><br><span class="line">        inventory[name] = item</span><br><span class="line">        dispenseSnack(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> favoriteSnacks = [</span><br><span class="line">    <span class="string">"Alice"</span>: <span class="string">"Chips"</span>,</span><br><span class="line">    <span class="string">"Bob"</span>: <span class="string">"Licorice"</span>,</span><br><span class="line">    <span class="string">"Eve"</span>: <span class="string">"Pretzels"</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">* 买小吃</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buyFavoriteSnack</span><span class="params">(person: String, vendingMachine: VendingMachine)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> snackName = favoriteSnacks[person] ?? <span class="string">"Candy Bar"</span></span><br><span class="line">    <span class="comment">// 调用throwing方法必须使用try关键字</span></span><br><span class="line">    <span class="keyword">try</span> vendingMachine.vend(itemNamed: snackName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-2-用Do-Catch处理错误"><a href="#18-2-2-用Do-Catch处理错误" class="headerlink" title="18.2.2    用Do-Catch处理错误"></a>18.2.2    用Do-Catch处理错误</h3><blockquote>
<p><strong>说明：</strong>可以使用一个<code>do-catch</code>语句运行一段闭包代码来处理错误。如果在<code>do</code>子句中的代码抛出了一个错误，这个错误会与<code>catch</code>子句做匹配，从而决定哪条子句能处理它。</p>
<ul>
<li>在<code>catch</code>后面写一个匹配模式来表明这个子句能处理什么样的错误</li>
<li>如果一条<code>catch</code>子句没有指定匹配模式，那么这条子句可以匹配任何错误，并且把错误绑定到一个名字为<code>error</code>的局部常量</li>
<li><code>catch</code>子句不必将<code>do</code>子句中的代码所抛出的每一个可能的错误都作处理</li>
<li>如果所有<code>catch</code>子句都未处理错误，错误就会传递到周围的作用域（要么是一个外围的<code>do-catch</code>错误处理语句，要么是一个<code>throwing</code> 函数的内部）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个售卖机实例</span></span><br><span class="line"><span class="keyword">var</span> vendingMachine = <span class="type">VendingMachine</span>()</span><br><span class="line"><span class="comment">// 投币</span></span><br><span class="line">vendingMachine.coinsDeposited = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 买最喜欢的零食</span></span><br><span class="line">    <span class="keyword">try</span> buyFavoriteSnack(<span class="string">"Alice"</span>, vendingMachine: vendingMachine)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 没有该商品</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">InvalidSelection</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Invalid Selection"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 卖完了</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">OutOfStock</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Out of Stock."</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 投币不足</span></span><br><span class="line"><span class="keyword">catch</span> <span class="type">VendingMachineError</span>.<span class="type">InsufficientFunds</span>(<span class="keyword">let</span> coinsNeeded) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Insufficent funds. Please insert an additional \(coinsNeeded)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-3-将错误转换成可选值"><a href="#18-2-3-将错误转换成可选值" class="headerlink" title="18.2.3    将错误转换成可选值"></a>18.2.3    将错误转换成可选值</h3><blockquote>
<p><strong>语法：</strong><code>try?</code><br><strong>说明：</strong>使用<code>try?</code>调用表达式，返回相应表达式返回值的<code>可选类型</code>（如果表达式抛出错误，则表达式<code>nil</code>）<br><strong>技巧：</strong>如果你想对所有的错误都采用同样的方式来处理，用<code>try?</code>就可以让你写出简洁的错误处理代码</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// throwing 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someThrowingFunction</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调用 throwing 函数 */</span></span><br><span class="line"><span class="comment">// 方式一：使用 try? 调用</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="keyword">try</span>? someThrowingFunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二：方式一的等价形式</span></span><br><span class="line"><span class="keyword">let</span> y: <span class="type">Int</span>?</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    y = <span class="keyword">try</span> someThrowingFunction()</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    y = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从磁盘获取</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchDataFromDisk</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从服务器获取</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchDataFromServer</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 获取数据</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fetchData</span><span class="params">()</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? fetchDataFromDisk() &#123;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> data = <span class="keyword">try</span>? fetchDataFromServer() &#123;</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-2-4-禁用错误传递"><a href="#18-2-4-禁用错误传递" class="headerlink" title="18.2.4        禁用错误传递"></a>18.2.4        禁用错误传递</h3><blockquote>
<p><strong>语法：</strong><code>try!</code><br><strong>说明：</strong>其实就是把<code>抛出错误</code>转变为<code>运行时断言</code><br><strong>应用：</strong>确定<code>throwing</code> 函数实际上在运行时<code>不会抛出错误</code>的才能使用。<br><strong>注意：</strong>如果实际上抛出了错误，你会得到一个运行时错误（而不会传递错误）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 确定图片资源是存在的</span></span><br><span class="line"><span class="keyword">let</span> photo = <span class="keyword">try</span>! loadImage(<span class="string">"./Resources/John Appleseed.jpg"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="18-3-指定清理操作"><a href="#18-3-指定清理操作" class="headerlink" title="18.3    指定清理操作"></a>18.3    指定清理操作</h2><blockquote>
<p><strong>说明：</strong>使用<code>defer</code>语句指定在即将离开<code>当前代码块</code>时执行一系列语句。<br><strong>支持情景：</strong>不管是以何种方式离开当前代码块的</p>
<ul>
<li>由于抛出错误而离开</li>
<li>诸如<code>return</code>或者<code>break</code>的语句</li>
</ul>
<p><strong>语法：</strong>由<code>defer</code>关键字和要被延迟执行的语句组成</p>
<ul>
<li>延迟执行的语句不能包含任何<code>控制转移语句</code>（<code>break</code>或是<code>return</code>语句，或是抛出一个错误）</li>
<li>延迟执行的操作会按照它们被指定时的顺序的<code>相反顺序</code>执行</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理文件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processFile</span><span class="params">(filename: String)</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// 如果文件存在</span></span><br><span class="line">    <span class="keyword">if</span> exists(filename) &#123;</span><br><span class="line">        <span class="comment">// 打开文件</span></span><br><span class="line">        <span class="keyword">let</span> file = open(filename)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当前代码块结束时执行</span></span><br><span class="line">        <span class="keyword">defer</span> &#123;</span><br><span class="line">            close(file)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理打开的文件</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> line = <span class="keyword">try</span> file.readline() &#123;</span><br><span class="line">            <span class="comment">// 处理文件。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据 defer 语句的指定，close(file) 会在这里被隐式调用，即作用域的最后。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">94</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
