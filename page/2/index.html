<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/2/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/2/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/es6_4 字符串的扩展/" itemprop="url">
                  4 字符串的扩展(ECMAScript6入门)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-30T22:01:44+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/30/es6_4 字符串的扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/30/es6_4 字符串的扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-字符的unicode表示法"><a href="#4-1-字符的unicode表示法" class="headerlink" title="4.1 字符的unicode表示法"></a>4.1 字符的unicode表示法</h2><table>
<thead>
<tr>
<th>unicode表示法</th>
<th>码点</th>
<th>兼容性</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\uxxxx</code></td>
<td>一个两个字节长度的16进制数字</td>
<td>all</td>
</tr>
<tr>
<td><code>\uxxxx\uxxxx</code></td>
<td>两个两个字节长度的16进制数字</td>
<td>all</td>
</tr>
<tr>
<td><code>\u{xx...}</code></td>
<td>码点为任意unicode编码</td>
<td>es6+</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"\u&#123;20BB7&#125;"</span></span><br><span class="line"><span class="comment">// "𠮷"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"\u&#123;41&#125;\u&#123;42&#125;\u&#123;43&#125;"</span></span><br><span class="line"><span class="comment">// "ABC"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = <span class="number">123</span>;</span><br><span class="line">hell\u&#123;<span class="number">6</span>F&#125; <span class="comment">// 123</span></span><br><span class="line"></span><br><span class="line"><span class="string">'\u&#123;1F680&#125;'</span> === <span class="string">'\uD83D\uDE80'</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="4-2-codePointAt"><a href="#4-2-codePointAt" class="headerlink" title="4.2 codePointAt()"></a>4.2 codePointAt()</h2><p><strong>背景：</strong><code>javascript</code>使用<code>utf-16</code>（两个字节）存储字符，使用<code>charCodeAt</code>无法正确处理四字节字符</p>
<p>类似<code>charCodeAt</code>，区别是<code>codePointAt</code>能够正确识别四字节字符（比如<code>吉祥</code>）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'吉a'</span>;</span><br><span class="line"></span><br><span class="line">s.codePointAt(<span class="number">0</span>) <span class="comment">// 134071(吉,0xD842 0xDFB7)</span></span><br><span class="line">s.codePointAt(<span class="number">1</span>) <span class="comment">// 57271（0xDFB7）</span></span><br><span class="line"></span><br><span class="line">s.charCodeAt(<span class="number">2</span>) <span class="comment">// 97</span></span><br><span class="line">s.codePointAt(<span class="number">2</span>) <span class="comment">// 97</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong><code>codePointAt</code>仍会按照两个字节一个字符的方式计算字符串中字符数量，因此传递给<code>codePointAt</code>的参数和<code>charCodeAt</code>是一样的。<br><strong>扩展：</strong>使用<code>for-of</code>可以正确识别32位（4字节）UTF-16字符。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'吉a'</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> ch <span class="keyword">of</span> s) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ch.codePointAt(<span class="number">0</span>).toString(<span class="number">16</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 20bb7</span></span><br><span class="line"><span class="comment">// 61</span></span><br></pre></td></tr></table></figure></p>
<p><strong>技巧：</strong>使用<code>codePointAt</code>获取字符的<code>UTF-16</code>完整编码，并判断其大小，就可以识别4字节字符。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is32Bit</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> c.codePointAt(<span class="number">0</span>) <span class="number">0xFFFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">is32Bit(<span class="string">"𠮷"</span>) <span class="comment">// true</span></span><br><span class="line">is32Bit(<span class="string">"a"</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-3-String-fromCodePoint"><a href="#4-3-String-fromCodePoint" class="headerlink" title="4.3 String.fromCodePoint()"></a>4.3 String.fromCodePoint()</h2><p><strong>背景：</strong><code>String.fromCharCode</code>用于从码点返回对应的字符，但对32位的<code>UTF-16</code>字符进行转换会发生溢出。</p>
<p><code>String.fromCodePoint</code>对应<code>codePointAt</code>，可以正确返回32为<code>UTF-16</code>字符对应的字符；当传递多个参数给<code>String.fromCodePoint</code>时，会返回每个参数（码点）对应的字符拼接成的字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.fromCodePoint(<span class="number">0x20BB7</span>)</span><br><span class="line"><span class="comment">// "𠮷"</span></span><br><span class="line"><span class="built_in">String</span>.fromCodePoint(<span class="number">0x78</span>, <span class="number">0x1f680</span>, <span class="number">0x79</span>) === <span class="string">'x\uD83D\uDE80y'</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="4-4-字符串的遍历器接口"><a href="#4-4-字符串的遍历器接口" class="headerlink" title="4.4 字符串的遍历器接口"></a>4.4 字符串的遍历器接口</h2><p><strong>说明：</strong>es6为字符串添加了便利器接口，因而可以通过<code>for-of</code>遍历字符串。<br><strong>特点：</strong>能够正确识别码点大于<code>\uffff</code>的字符<br><strong>技巧：</strong>利用<code>for-of</code>计算字符串正确的字符个数（传统的<code>for</code>和<code>for-in</code>无法做到）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="built_in">String</span>.fromCodePoint(<span class="number">0x20BB7</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> text) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "吉"</span></span><br></pre></td></tr></table></figure>
<h2 id="4-5-at"><a href="#4-5-at" class="headerlink" title="4.5 at()"></a>4.5 at()</h2><p><strong>说明：</strong>字符串的方法（提案状态？），能够识别码点大于<code>\uffff</code>的字符<br><strong>ES5：</strong>字符串的<code>charAt</code>方法用于返回字符串给定位置的字符，但不能正确识别码点大于<code>\uffff</code>的字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'吉'</span>.at(<span class="number">0</span>) <span class="comment">// "吉"</span></span><br></pre></td></tr></table></figure>
<h2 id="4-6-normalize"><a href="#4-6-normalize" class="headerlink" title="4.6 normalize()"></a>4.6 normalize()</h2><p><strong>说明：</strong>es6提供字符串实例的<code>normalize</code>方法，用来将字符的不同表示方法统一为同样的形式，称为<code>unicode正规化</code>。</p>
<h2 id="4-7-includes-startsWith-endsWith"><a href="#4-7-includes-startsWith-endsWith" class="headerlink" title="4.7 includes(), startsWith(), endsWith()"></a>4.7 includes(), startsWith(), endsWith()</h2><table>
<thead>
<tr>
<th>方法</th>
<th>返回值</th>
<th>第二个参数(可选)</th>
</tr>
</thead>
<tbody>
<tr>
<td>includes</td>
<td>布尔值，表示是否找到了参数字符串</td>
<td>开始搜索的位置</td>
</tr>
<tr>
<td>startsWith</td>
<td>布尔值，表示参数字符串是否在源字符串的头部</td>
<td>开始搜索的位置</td>
</tr>
<tr>
<td>endsWith</td>
<td>布尔值，表示参数字符串是否在源字符串的尾部</td>
<td>停止搜索的位置</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">'Hello world!'</span>;</span><br><span class="line"></span><br><span class="line">s.startsWith(<span class="string">'world'</span>, <span class="number">6</span>) <span class="comment">// true</span></span><br><span class="line">s.endsWith(<span class="string">'Hello'</span>, <span class="number">5</span>) <span class="comment">// true</span></span><br><span class="line">s.includes(<span class="string">'Hello'</span>, <span class="number">6</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="4-8-repeat"><a href="#4-8-repeat" class="headerlink" title="4.8 repeat()"></a>4.8 repeat()</h2><p><strong>用途：</strong>返回一个将源字符串重复n次的新字符串<br><strong>注意：</strong>如果参数不是整数，将会按照一定规则取整<br>非整数参数|转换后<br>-|-<br>小数|向下取整<br>负数或<code>Infinity</code>|报错<br>0~-1|0<br><code>NaN</code>|0<br>字符串|相应的数字</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'x'</span>.repeat(<span class="number">3</span>) <span class="comment">// "xxx"</span></span><br><span class="line"><span class="string">'hello'</span>.repeat(<span class="number">2</span>) <span class="comment">// "hellohello"</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="number">0</span>) <span class="comment">// ""</span></span><br><span class="line"></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="number">-0.9</span>) <span class="comment">// ""</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="string">'na'</span>) <span class="comment">// ""</span></span><br><span class="line"><span class="string">'na'</span>.repeat(<span class="string">'3'</span>) <span class="comment">// "nanana"</span></span><br></pre></td></tr></table></figure>
<p>##4.9 padStart(), padEnd()</p>
<p><strong>ES7：</strong>补全字符串的长度<br>函数|用途<br>-|-<br>padStart|用于头部补全<br>padEnd|用于尾部补全</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一个参数</td>
<td>指定字符串的最小长度</td>
</tr>
<tr>
<td>第二个参数（可选）</td>
<td>用来补全的字符串，默认为空格。如果用来补全的字符串与原字符串，两者的长度之和超过了指定的最小长度，则会截去超出位数的补全字符串</td>
</tr>
</tbody>
</table>
<p><strong>注意：</strong>如果原字符串的长度，等于或大于指定的最小长度，则返回原字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为数值补全指定位数</span></span><br><span class="line"><span class="string">'1'</span>.padStart(<span class="number">10</span>, <span class="string">'0'</span>) <span class="comment">// "0000000001"</span></span><br><span class="line"><span class="string">'12'</span>.padStart(<span class="number">10</span>, <span class="string">'0'</span>) <span class="comment">// "0000000012"</span></span><br><span class="line"><span class="string">'123456'</span>.padStart(<span class="number">10</span>, <span class="string">'0'</span>) <span class="comment">// "0000123456"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提示字符串格式</span></span><br><span class="line"><span class="string">'12'</span>.padStart(<span class="number">10</span>, <span class="string">'YYYY-MM-DD'</span>) <span class="comment">// "YYYY-MM-12"</span></span><br><span class="line"><span class="string">'09-12'</span>.padStart(<span class="number">10</span>, <span class="string">'YYYY-MM-DD'</span>) <span class="comment">// "YYYY-09-12"</span></span><br></pre></td></tr></table></figure>
<p>##4.10 模版字符串</p>
<p><strong>语法：</strong>使用反引号括起来</p>
<ul>
<li>可以当作普通字符串来使用，也可以用来定义多行字符串</li>
<li>可以在字符串中<code>嵌入变量</code></li>
<li>如果模版字符串中使用反引号，则前面要用<code>反斜杠转义</code></li>
<li>所有的<code>空格和缩进</code>都会被保留在输出之中，不需要的话可以使用<code>trim</code>方法消除</li>
<li>模板字符串中嵌入变量，需要将变量名写在<code>${}</code>之中</li>
</ul>
<h3 id="4-10-1-嵌入JS表达式"><a href="#4-10-1-嵌入JS表达式" class="headerlink" title="4.10.1 嵌入JS表达式"></a>4.10.1 嵌入<code>JS表达式</code></h3><p>大括号内部可以放入任意的JavaScript表达式，可以</p>
<ul>
<li>进行运算</li>
<li>引用对象属性</li>
<li>调用函数</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>如果<code>${}</code>中的值不是字符串，将按照一般的规则转为字符串</li>
<li>如果<code>${}</code>内部是一个字符串，将会原样输出</li>
<li>如果模板字符串中的变量没有声明，将报错</li>
<li>通过<code>${}</code>，模板字符串甚至还能嵌套</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 定义返回模版字符串的函数</span><br><span class="line">const tmpl = addrs =`</span><br><span class="line">  &lt;table&gt;</span><br><span class="line">  $&#123;addrs.map(addr =`</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;$&#123;addr.first&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;$&#123;addr.last&#125;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">  `).join('')&#125;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">// 定义填充模版字符串的数据</span><br><span class="line">const data = [</span><br><span class="line">    &#123; first: '&lt;Jane&gt;', last: 'Bond' &#125;,</span><br><span class="line">    &#123; first: 'Lars', last: '&lt;Croft&gt;' &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">console.log(tmpl(data));</span><br><span class="line">// &lt;table&gt;</span><br><span class="line">//</span><br><span class="line">//   &lt;tr&gt;&lt;td&gt;&lt;Jane&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">//   &lt;tr&gt;&lt;td&gt;Bond&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">//</span><br><span class="line">//   &lt;tr&gt;&lt;td&gt;Lars&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">//   &lt;tr&gt;&lt;td&gt;&lt;Croft&gt;&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">//</span><br><span class="line">// &lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p>##4.11 实例：模版编译</p>
<p><em>l04_template.vue</em><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data () &#123;</span><br><span class="line">			return &#123;</span><br><span class="line">				template: '',</span><br><span class="line">				templateCompiled: '',</span><br><span class="line">				templateOutput: ''</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods: &#123;</span><br><span class="line">			/**</span><br><span class="line">			* 模版编译函数</span><br><span class="line">			* @param &#123;string&#125; template 模版字符串</span><br><span class="line">			* @return &#123;string&#125; 可执行的js代码</span><br><span class="line">			*/</span><br><span class="line">			compile: function (template)&#123;</span><br><span class="line">			  var evalExpr = /&lt;%=(.+?)%&gt;/g;</span><br><span class="line">			  var expr = /&lt;%([\s\S]+?)%&gt;/g;</span><br><span class="line"></span><br><span class="line">			  template = template</span><br><span class="line">			    .replace(evalExpr, '`); \n  echo( $1 ); \n  echo(`')</span><br><span class="line">			    .replace(expr, '`); \n $1 \n  echo(`');</span><br><span class="line"></span><br><span class="line">			  template = 'echo(`' + template + '`);';</span><br><span class="line"></span><br><span class="line">			  var script =</span><br><span class="line">			  `(function parse(data)&#123;</span><br><span class="line">			    var output = "";</span><br><span class="line"></span><br><span class="line">			    function echo(html)&#123;</span><br><span class="line">			      output += html;</span><br><span class="line">			    &#125;</span><br><span class="line"></span><br><span class="line">			    $&#123; template &#125;</span><br><span class="line"></span><br><span class="line">			    return output;</span><br><span class="line">			  &#125;)`;</span><br><span class="line"></span><br><span class="line">			  return script;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		ready: function () &#123;</span><br><span class="line">			// 定义原始模版</span><br><span class="line">			this.template = `</span><br><span class="line">			&lt;ul&gt;</span><br><span class="line">			  &lt;% for(var i=0; i &lt; data.supplies.length; i++) &#123; %&gt;</span><br><span class="line">			    &lt;li&gt;&lt;%= data.supplies[i] %&gt;&lt;/li&gt;</span><br><span class="line">			  &lt;% &#125; %&gt;</span><br><span class="line">			&lt;/ul&gt;</span><br><span class="line">			`;</span><br><span class="line">			this.templateCompiled = this.compile(this.template);</span><br><span class="line"></span><br><span class="line">			// eval 中的代码会定义一个函数，并返回这个函数的引用</span><br><span class="line">			var parse = eval(this.templateCompiled);</span><br><span class="line"></span><br><span class="line">			// 调用函数完成拼接</span><br><span class="line">			this.templateOutput = parse(&#123; supplies: [ "broom", "mop", "cleaner" ] &#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;h3&gt;模版&lt;/h3&gt;</span><br><span class="line">	&lt;code&gt;&#123;&#123;template&#125;&#125;&lt;/code&gt;</span><br><span class="line">	&lt;h3&gt;编译后的模版&lt;/h3&gt;</span><br><span class="line">	&lt;code&gt;&#123;&#123;templateCompiled&#125;&#125;&lt;/code&gt;</span><br><span class="line">	&lt;h3&gt;灌入数据的模版&lt;/h3&gt;</span><br><span class="line">	&lt;code&gt;&#123;&#123;templateOutput&#125;&#125;&lt;/code&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://localhost:8080/#!/l04</span></span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1469070909258.png" alt="Alt text"></p>
<p>##4.12 标签模版</p>
<p><strong>说明：</strong>一种针对模版字符串的特殊函数调用。<br><strong>语法：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">函数名<span class="string">`模<span class="subst">$&#123;表达式1&#125;</span>版字<span class="subst">$&#123;表达式2&#125;</span>串`</span>;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;array like&#125; 第一个参数</span><br><span class="line">* @param &#123;...string&#125; 不定参数</span><br><span class="line">*/</span></span><br><span class="line">函数名([<span class="string">'模'</span>,<span class="string">'版'</span>,<span class="string">'字'</span>,<span class="string">'符'</span>,<span class="string">'串'</span>], 表达式<span class="number">1</span>返回值, 表达式<span class="number">2</span>返回值);</span><br></pre></td></tr></table></figure></p>
<p><strong>参数：</strong>调用函数传入的第一个参数有一个<code>row</code>属性，是一个和第一个参数本身内容相同的数组，不过元素中的所有<code>\</code>都被转义了，从而可以获得字符串的原始版本。<br><strong>用途：</strong>通过实现相应的处理模版字符串的函数，<code>标签模版</code>常用于</p>
<ul>
<li>处理<code>HTML</code>字符串过滤</li>
<li>多语言转换（国际化处理）</li>
<li>为模版增加条件判断和循环处理等模版基础能力</li>
<li>嵌入其它语言</li>
</ul>
<p><em>l04_taggedTemplate.vue</em><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	export default &#123;</span><br><span class="line">		data () &#123;</span><br><span class="line">			return &#123;</span><br><span class="line">				template: "Hello $&#123; a + b &#125; world $&#123; a * b&#125;",</span><br><span class="line">				templateOutput: ''</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods: &#123;</span><br><span class="line">			/**</span><br><span class="line">			 * 将各个参数按照原来的位置拼合回去(写法1)</span><br><span class="line">			 * @param  &#123;array&#125; literals 被插入的表达式隔开的字符串组成的数组</span><br><span class="line">			 * @return &#123;string&#125;     各个参数按照原来的位置拼合的字符串     </span><br><span class="line">			 */</span><br><span class="line">			passthru1: function (literals) &#123;</span><br><span class="line">				var result = ''</span><br><span class="line">				var i = 0</span><br><span class="line">				while (i &lt; literals.length) &#123;</span><br><span class="line">					// 拼接单纯的字符串</span><br><span class="line">					result += literals[i++]</span><br><span class="line"></span><br><span class="line">					// 拼接插入的表达式运算结果</span><br><span class="line">					if (i &lt; arguments.length) &#123;</span><br><span class="line">						result += arguments[i]</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				return result;</span><br><span class="line">			&#125;,</span><br><span class="line">			/**</span><br><span class="line">			 * 将各个参数按照原来的位置拼合回去(写法2)</span><br><span class="line">			 * @param  &#123;array&#125;    literals 被插入的表达式隔开的字符串组成的数组</span><br><span class="line">			 * @param  &#123;...array&#125; values   插入的所有表达式结果（从左到右摘出来）</span><br><span class="line">			 * @return &#123;string&#125;     各个参数按照原来的位置拼合的字符串 </span><br><span class="line">			 */</span><br><span class="line">			passthru2: function (literals, ...values) &#123;</span><br><span class="line">				var output = ''</span><br><span class="line">				for (var index = 0; index &lt; values.length; index++) &#123;</span><br><span class="line">					output +=literals[index] + values[index]</span><br><span class="line">				&#125;</span><br><span class="line">				// 被插入的表达式隔开的字符串组成的数组 比 插入的所有表达式结果长度大1</span><br><span class="line">				output += literals[index]</span><br><span class="line"></span><br><span class="line">				return output</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		ready: function () &#123;</span><br><span class="line">			let a = 2</span><br><span class="line">			let b = 4</span><br><span class="line">			this.templateOutput = this.passthru2`Hello $&#123; a + b &#125; world $&#123; a * b&#125;`</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;p&gt;运行&lt;/p&gt;</span><br><span class="line">	&lt;code&gt;passthru`&#123;&#123;template&#125;&#125;`&lt;/code&gt;</span><br><span class="line">	&lt;p&gt;输出&lt;/p&gt;</span><br><span class="line">	&lt;code&gt;&#123;&#123;templateOutput&#125;&#125;&lt;/code&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></p>
<p>##4.13 String.raw()</p>
<p><strong>用途：</strong>两种使用方式</p>
<ul>
<li>作为模版标签使用</li>
<li>作为普通函数调用<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">		data () &#123;</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">				hiHuanhang: <span class="string">''</span>,</span><br><span class="line">				hiUtf16: <span class="string">''</span>,</span><br><span class="line">				test1: <span class="string">''</span>,</span><br><span class="line">				test2: <span class="string">''</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		methods: &#123;</span><br><span class="line">			<span class="comment">/**</span><br><span class="line">			 * 自己视线一个 String.raw</span><br><span class="line">			 * @param  &#123;array&#125;    strings 被插入的表达式隔开的字符串组成的类数组,需要有raw属性</span><br><span class="line">			 * @param  &#123;...string&#125; value   插入的表达式返回值</span><br><span class="line">			 * @return &#123;string&#125;            转义后的字符串</span><br><span class="line">			 */</span></span><br><span class="line">			myRaw: <span class="function"><span class="keyword">function</span> (<span class="params">strings, ...value</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> output = <span class="string">''</span>;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">0</span>; index &lt; values.length; index++) &#123;</span><br><span class="line">					output += strings.raw[index] + values[index];</span><br><span class="line">				&#125;</span><br><span class="line">				output += strings.raw[index];</span><br><span class="line">				<span class="keyword">return</span> output;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		ready: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 用法1:当作模版标签使用 */</span></span><br><span class="line">			<span class="keyword">this</span>.hiHuanhang = <span class="built_in">String</span>.raw<span class="string">`Hi\n<span class="subst">$&#123;2+3&#125;</span>!`</span>;</span><br><span class="line">			<span class="comment">// "Hi\\n5!"</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.hiUtf16 = <span class="built_in">String</span>.raw<span class="string">`Hi\u000A!`</span>;</span><br><span class="line">			<span class="comment">// 'Hi\\u000A!'</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">/* 用法2:当作普通函数调用 */</span></span><br><span class="line">			<span class="keyword">this</span>.test1 = <span class="built_in">String</span>.raw(&#123; raw: <span class="string">'test'</span> &#125;, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">			<span class="comment">// 't0e1s2t'</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// 等同于</span></span><br><span class="line">			<span class="keyword">this</span>.test2 = <span class="built_in">String</span>.raw(&#123; raw: [<span class="string">'t'</span>,<span class="string">'e'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>] &#125;, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>转换换行符<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;hiHuanhang&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>转换utf-16表示方式<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;hiUtf16&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>当做普通函数调用<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;test2&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/es6_5 正则的扩展/" itemprop="url">
                  5 正则的扩展(ECMAScript6入门)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-30T22:01:35+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/30/es6_5 正则的扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/30/es6_5 正则的扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="5-1-RegExp构造函数"><a href="#5-1-RegExp构造函数" class="headerlink" title="5.1 RegExp构造函数"></a>5.1 RegExp构造函数</h2><p>与es5相比，es6<code>RegExp</code>函数支持第一个参数为正则表达式的同时，还能设置第二个参数，第二个参数设置的正则修饰符将会覆盖第一个参数中的正则修饰符<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 构造器方式 */</span></span><br><span class="line"><span class="keyword">let</span> r1 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'xzy'</span>, <span class="string">'i'</span>)<span class="comment">// 方式1(es5/es6): 第一个参数为字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r2 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/xyz/i</span>)<span class="comment">// 方式2(es5/es6): 第一个参数为正则表达式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r3 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="regexp">/xyz/ig</span>, <span class="string">'i'</span>)<span class="comment">//  方式3(es5/es6):第一个参数为正则表达式，且支持第二个参数设置正则表达式修饰符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 正则对象(es5/es6) */</span></span><br><span class="line"><span class="keyword">let</span> r4 = <span class="regexp">/xyz/i</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-2-字符串的正则方法"><a href="#5-2-字符串的正则方法" class="headerlink" title="5.2 字符串的正则方法"></a>5.2 字符串的正则方法</h2><p>在<code>es6</code>中，字符串的四个与正则相关的方法全部会调用<code>RegExp</code>对象定义的相应方法</p>
<table>
<thead>
<tr>
<th>字符串实例方法</th>
<th>被调用的<code>RegExp</code>的方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>String.prototype.<code>match</code></td>
<td>RegExp.prototype[Symbol.<code>match</code>]</td>
</tr>
<tr>
<td>String.prototype.<code>replace</code></td>
<td>RegExp.prototype[Symbol.<code>replace</code>]</td>
</tr>
<tr>
<td>String.prototype.<code>search</code></td>
<td>RegExp.prototype[Symbol.<code>search</code>]</td>
</tr>
<tr>
<td>String.prototype.<code>split</code></td>
<td>RegExp.prototype[Symbol.<code>split</code>]</td>
</tr>
</tbody>
</table>
<h2 id="5-3-u修饰符"><a href="#5-3-u修饰符" class="headerlink" title="5.3 u修饰符"></a>5.3 u修饰符</h2><table>
<thead>
<tr>
<th>比较点</th>
<th>场景</th>
<th>不带u修饰符</th>
<th>带u修饰符</th>
</tr>
</thead>
<tbody>
<tr>
<td>点字符(<code>.</code>)</td>
<td>(字符串中)当匹配目标码点 0xFFFF</td>
<td>无法匹配</td>
<td>正确匹配</td>
</tr>
<tr>
<td>Unicode字符表示法（<code>\u{}</code>）</td>
<td></td>
<td>当做正则量词</td>
<td>正确识别</td>
</tr>
<tr>
<td>量词（<code>{}</code>）</td>
<td>(正则表达式中)跟在码点大于<code>0xFFFF</code>的字符后面</td>
<td>无法识别</td>
<td>正确识别为量词</td>
</tr>
<tr>
<td>预定义模式</td>
<td>(字符串中)当匹配目标码点 0xFFFF</td>
<td>无法匹配</td>
<td>正确匹配</td>
</tr>
<tr>
<td><code>i</code>修饰符</td>
<td>(字符串中)当匹配目标为非规范的字符</td>
<td>无法匹配</td>
<td>正确匹配</td>
</tr>
</tbody>
</table>
<h2 id="5-4-y修饰符"><a href="#5-4-y修饰符" class="headerlink" title="5.4 y修饰符"></a>5.4 y修饰符</h2><p><strong>粘连（sticky）修饰符：</strong>类似<code>g</code>修饰符，会进行全文匹配，区别在于</p>
<ul>
<li><code>g</code>修饰符每次都从<code>lastIndex</code>属性开始，从这个位置开始往后搜索，发现匹配为止</li>
<li><code>y</code>修饰符每次也从<code>lastIndex</code>属性开始，从这个位置开始往后搜索，但要求在<code>lastIndex</code>指定的位置就发现匹配，否则返回 <code>null</code></li>
</ul>
<h3 id="5-4-1-和-g-修饰符的区别"><a href="#5-4-1-和-g-修饰符的区别" class="headerlink" title="5.4.1 和 g 修饰符的区别"></a>5.4.1 和 g 修饰符的区别</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">'aaa_aa_a'</span></span><br><span class="line"><span class="keyword">const</span> rg = <span class="regexp">/a+/g</span></span><br><span class="line"><span class="keyword">const</span> ry = <span class="regexp">/a+/y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result</span><br><span class="line"><span class="comment">/* g 修饰符 */</span></span><br><span class="line"><span class="built_in">console</span>.log(rg.exec(s))<span class="comment">// ["aaa", index: 0, input: "aaa_aa_a"]</span></span><br><span class="line"><span class="built_in">console</span>.log(rg.exec(s))<span class="comment">// ["aa", index: 4, input: "aaa_aa_a"]</span></span><br><span class="line"><span class="built_in">console</span>.log(rg.exec(s))<span class="comment">// ["a", index: 7, input: "aaa_aa_a"]</span></span><br><span class="line"><span class="built_in">console</span>.log(rg.exec(s))<span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* y 修饰符 */</span></span><br><span class="line"><span class="built_in">console</span>.log(ry.exec(s))<span class="comment">// ["aaa", index: 0, input: "aaa_aa_a"]</span></span><br><span class="line"><span class="built_in">console</span>.log(ry.exec(s))</span><br></pre></td></tr></table></figure>
<h3 id="5-4-2-从字符串提取-tokeb-词元"><a href="#5-4-2-从字符串提取-tokeb-词元" class="headerlink" title="5.4.2 从字符串提取 tokeb (词元)"></a>5.4.2 从字符串提取 tokeb (词元)</h3><p><strong>说明：</strong>根据<code>y</code>修饰符<code>粘连</code>的特性，可以利用这一点敏感地识别到提取词元过程中是否有异常字符出现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	methods: &#123;</span><br><span class="line">		<span class="comment">/**</span><br><span class="line">		 * 逐个取出字符串中的词元</span><br><span class="line">		 * @param  &#123;RegExp&#125; TOKEN_REGEX 正则实例</span><br><span class="line">		 * @param  &#123;String&#125; str 目标字符串</span><br><span class="line">		 * @return &#123;Array&#125; 词元数组  </span><br><span class="line">		 */</span></span><br><span class="line">		tokenize (TOKEN_REGEX, str) &#123;</span><br><span class="line">			<span class="keyword">let</span> result = []</span><br><span class="line">			<span class="keyword">let</span> match</span><br><span class="line">			<span class="keyword">while</span> (match = TOKEN_REGEX.exec(str)) &#123;</span><br><span class="line">				result.push(match[<span class="number">1</span>])</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> result</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	ready: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">/** 从字符串提取 tokeb (词元)  */</span></span><br><span class="line">		<span class="comment">/* g 修饰符 */</span></span><br><span class="line">		<span class="keyword">const</span> TOKEN_G = <span class="regexp">/\s*(\+|[0-9]+)\s*/g</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.tokenize(TOKEN_G, <span class="string">'3 + 4'</span>))<span class="comment">// ["3", "+", "4"]</span></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.tokenize(TOKEN_G, <span class="string">'3x + 4'</span>))<span class="comment">// ["3", "+", "4"]</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* y 修饰符 */</span></span><br><span class="line">		<span class="keyword">const</span> TOKEN_Y = <span class="regexp">/\s*(\+|[0-9]+)\s*/y</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.tokenize(TOKEN_Y, <span class="string">'3 + 4'</span>))<span class="comment">// ["3", "+", "4"]</span></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.tokenize(TOKEN_Y, <span class="string">'3x + 4'</span>))<span class="comment">// ["3"]</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-5-sticky属性"><a href="#5-5-sticky属性" class="headerlink" title="5.5 sticky属性"></a>5.5 sticky属性</h2><p><code>RegExp.prototype.sticky</code>：是否设置了<code>y</code>修饰符<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> r = <span class="regexp">/hello\d/y</span></span><br><span class="line">r.sticky <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-6-flags属性"><a href="#5-6-flags属性" class="headerlink" title="5.6 flags属性"></a>5.6 flags属性</h2><p><code>RegExp.prototype.flags</code>：返回正则表达式的修饰符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5的source属性</span></span><br><span class="line"><span class="comment">// 返回正则表达式的正文</span></span><br><span class="line">/abc/ig.source</span><br><span class="line"><span class="comment">// "abc"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的flags属性</span></span><br><span class="line"><span class="comment">// 返回正则表达式的修饰符</span></span><br><span class="line">/abc/ig.flags</span><br><span class="line"><span class="comment">// 'gi'</span></span><br></pre></td></tr></table></figure>
<h2 id="5-7-RegExp-escape"><a href="#5-7-RegExp-escape" class="headerlink" title="5.7 RegExp.escape()"></a>5.7 RegExp.escape()</h2><p><strong>功能：</strong>将字符串中有特殊正则含义的字符转义掉<br><strong>注意：</strong>曾被建议加入<code>ES7</code>，由于安全风险没被采纳</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始字符串</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">'hello. how are you?'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// escape 处理后的字符串</span></span><br><span class="line"><span class="keyword">const</span> regStr = <span class="keyword">this</span>.escapeRegExp(str)<span class="comment">// hello\. how are you\?</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 escape 处理后的字符串构建正则实例</span></span><br><span class="line"><span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(regStr, <span class="string">'g'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="5-8-后行断言"><a href="#5-8-后行断言" class="headerlink" title="5.8 后行断言"></a>5.8 后行断言</h2><p>提案阶段，在<code>ES7</code>中加入。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/es6_7 数组的扩展/" itemprop="url">
                  7 数组的扩展(ECMAScript6入门)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-30T21:59:22+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/30/es6_7 数组的扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/30/es6_7 数组的扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="7-1-Array-from"><a href="#7-1-Array-from" class="headerlink" title="7.1 Array.from()"></a>7.1 Array.from()</h2><p><strong>功能：</strong>可以将两类对象转为真正的数组，从而使用数组丰富的方法</p>
<ul>
<li><code>类似数组的对象（array-like object）</code>：即存在 length 属性的对象</li>
<li><code>可遍历（iterable）的对象</code>，包括 ES6 新增的数据结构 Set 和 Map</li>
</ul>
<p><strong>注意：</strong> 类数组对象也可以通过 <code>call</code>或<code>apply</code>的方式强行调用<code>Array</code> 数组的方法</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>参数1</td>
<td>可以被转为数组的对象</td>
<td></td>
</tr>
<tr>
<td>参数2</td>
<td>类似数组的 map 方法</td>
</tr>
<tr>
<td>参数3</td>
<td>要绑定的上下文</td>
</tr>
</tbody>
</table>
<h3 id="7-1-1-转换类数组对象中为数组"><a href="#7-1-1-转换类数组对象中为数组" class="headerlink" title="7.1.1 转换类数组对象中为数组"></a>7.1.1 转换类数组对象中为数组</h3><ul>
<li>DOM 操作返回的 NodeList 集合</li>
<li>函数内部的 arguments 对象</li>
<li>自定义的类数组对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1. 自定义的类数组对象 */</span></span><br><span class="line"><span class="keyword">let</span> arrayLike = &#123;</span><br><span class="line">    <span class="string">'0'</span>: <span class="string">'a'</span>,</span><br><span class="line">    <span class="string">'1'</span>: <span class="string">'b'</span>,</span><br><span class="line">    <span class="string">'2'</span>: <span class="string">'c'</span>,</span><br><span class="line">    length: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [].slice.call(arrayLike); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="keyword">let</span> arr2 = <span class="built_in">Array</span>.from(arrayLike); <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. DOM 操作返回的 NodeList 集合 */</span></span><br><span class="line"><span class="comment">// NodeList对象</span></span><br><span class="line"><span class="keyword">let</span> ps = <span class="built_in">document</span>.querySelectorAll(<span class="string">'p'</span>);</span><br><span class="line"><span class="built_in">Array</span>.from(ps).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">p</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(p);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*3. 函数内部的 Arguments 对象*/</span></span><br><span class="line"><span class="comment">// arguments对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-1-2-es5环境下的-polyfill"><a href="#7-1-2-es5环境下的-polyfill" class="headerlink" title="7.1.2 es5环境下的 polyfill"></a>7.1.2 es5环境下的 polyfill</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toArray = (() =&gt;</span><br><span class="line">	<span class="built_in">Array</span>.from ? <span class="built_in">Array</span>.from : obj =&gt; [].slice.call(obj)</span><br><span class="line">)()</span><br></pre></td></tr></table></figure>
<h3 id="7-1-3-第二个参数"><a href="#7-1-3-第二个参数" class="headerlink" title="7.1.3 第二个参数"></a>7.1.3 第二个参数</h3><p><strong>说明：</strong>租用类似于数组的 <code>map</code>方法，用来对每个元素进行处理，将处理后的值放在返回的数组中</p>
<h4 id="7-1-3-1-基础"><a href="#7-1-3-1-基础" class="headerlink" title="7.1.3.1 基础"></a>7.1.3.1 基础</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(arrayLike, x =&gt; x * x);</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="built_in">Array</span>.from(arrayLike).map(x =&gt; x * x);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], (x) =&gt; x * x)</span><br><span class="line"><span class="comment">// [1, 4, 9]</span></span><br></pre></td></tr></table></figure>
<h4 id="7-1-3-2-几个例子"><a href="#7-1-3-2-几个例子" class="headerlink" title="7.1.3.2 几个例子"></a>7.1.3.2 几个例子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1. 取出一组DOM节点的文本内容 */</span></span><br><span class="line"><span class="keyword">let</span> spans = <span class="built_in">document</span>.querySelectorAll(<span class="string">'span.name'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// es5的方式：map()</span></span><br><span class="line"><span class="keyword">let</span> names1 = <span class="built_in">Array</span>.prototype.map.call(spans, s =&gt; s.textContent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6的方式：Array.from()</span></span><br><span class="line"><span class="keyword">let</span> names2 = <span class="built_in">Array</span>.from(spans, s =&gt; s.textContent)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 将数组中不饿日志为 false 的成员转为 0 */</span></span><br><span class="line"><span class="built_in">Array</span>.from([<span class="number">1</span>, ,<span class="number">2</span>, ,<span class="number">3</span>], (n) =&gt; n || <span class="number">0</span>)</span><br><span class="line"><span class="comment">// [1, 0, 2, 0, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. 返回各种数据的类型 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">typeof</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>, value =&gt; <span class="keyword">typeof</span> value)</span><br><span class="line">&#125;</span><br><span class="line">typedsOf(<span class="literal">null</span>, [], <span class="literal">NaN</span>)</span><br><span class="line"><span class="comment">// ['object', 'object', 'number']</span></span><br></pre></td></tr></table></figure>
<h4 id="7-1-3-3-扩展运算符"><a href="#7-1-3-3-扩展运算符" class="headerlink" title="7.1.3.3 扩展运算符"></a>7.1.3.3 扩展运算符</h4><p><strong>说明：</strong>扩展运算符也可以将可遍历对象（即部署了便利器接口<code>Symbol.iterator</code>）转换为数组，但不支持类数组对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arguments对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = [...arguments];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NodeList对象</span></span><br><span class="line">[...document.querySelectorAll(<span class="string">'div'</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="7-1-3-4-奇技淫巧"><a href="#7-1-3-4-奇技淫巧" class="headerlink" title="7.1.3.4 奇技淫巧"></a>7.1.3.4 奇技淫巧</h4><ul>
<li><p>利用第一个参数的 length 属性和第二个参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(&#123; length: <span class="number">2</span> &#125;, () =&gt; <span class="string">'jack'</span>)</span><br><span class="line"><span class="comment">// ['jack', 'jack']</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>返回字符串的长度（能正确处理各种<code>Unicode</code>字符， 避免 JS 将大于<code>\uFFFF</code>的Unicode的字符算作两个字符的 bug）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countSymbols</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(string).length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-2-Array-of"><a href="#7-2-Array-of" class="headerlink" title="7.2 Array.of()"></a>7.2 Array.of()</h2><p><strong>功能：</strong>将一组值转换为数组<br><strong>说明：</strong><code>Array.of</code>基本可以用来替代<code>Array()</code>或<code>new Array()</code>，并且不存在由于参数不同而导致的重载</p>
<h3 id="7-2-1-Array-of-vs-Array"><a href="#7-2-1-Array-of-vs-Array" class="headerlink" title="7.2.1 Array.of() vs. Array()"></a>7.2.1 Array.of() vs. Array()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>() <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">3</span>) <span class="comment">// [, , ,]</span></span><br><span class="line"><span class="built_in">Array</span>(<span class="number">3</span>, <span class="number">11</span>, <span class="number">8</span>) <span class="comment">// [3, 11, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.of() <span class="comment">// []</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="literal">undefined</span>) <span class="comment">// [undefined]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>) <span class="comment">// [1]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure>
<h3 id="7-2-2-polyfill"><a href="#7-2-2-polyfill" class="headerlink" title="7.2.2 polyfill"></a>7.2.2 polyfill</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ArrayOf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-3-数组实例的-copyWithin"><a href="#7-3-数组实例的-copyWithin" class="headerlink" title="7.3 数组实例的 copyWithin()"></a>7.3 数组实例的 copyWithin()</h2><p><code>Array 实例方法 copyWithin()</code><br><strong>功能：</strong>将指定位置的成员复制到其他位置（会覆盖原有成员），然后返回当前数组<br><strong>注意：</strong>参数都为数值，如果不是，会自动转为数值</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471704903931.png" alt="Alt text"></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>是否必需</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>target</td>
<td>目的地 起点下标</td>
<td>是</td>
</tr>
<tr>
<td>start</td>
<td>源 起点下标</td>
<td>否</td>
<td>默认为0,如果为负值，表示倒数</td>
</tr>
<tr>
<td>end</td>
<td>源 终点下标 + 1</td>
<td>否</td>
<td>默认为0，如果为负数，表示倒数</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将3号位复制到0号位</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">// [4, 2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// -2相当于3号位，-1相当于4号位</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].copyWithin(<span class="number">0</span>, <span class="number">-2</span>, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">// [4, 2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将3号位复制到0号位</span></span><br><span class="line">[].copyWithin.call(&#123;length: <span class="number">5</span>, <span class="number">3</span>: <span class="number">1</span>&#125;, <span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// &#123;0: 1, 3: 1, length: 5&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将2号位到数组结束，复制到0号位</span></span><br><span class="line"><span class="keyword">var</span> i32a = <span class="keyword">new</span> <span class="built_in">Int32Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">i32a.copyWithin(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// Int32Array [3, 4, 5, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于没有部署TypedArray的copyWithin方法的平台</span></span><br><span class="line"><span class="comment">// 需要采用下面的写法</span></span><br><span class="line">[].copyWithin.call(<span class="keyword">new</span> <span class="built_in">Int32Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]), <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// Int32Array [4, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>
<h2 id="7-4-数组实例的-find-和-findIndex"><a href="#7-4-数组实例的-find-和-findIndex" class="headerlink" title="7.4 数组实例的 find() 和 findIndex()"></a>7.4 数组实例的 find() 和 findIndex()</h2><p><strong>注意：</strong>这两个方法都能够发现<code>NaN</code>，ni</p>
<h3 id="7-4-1-find"><a href="#7-4-1-find" class="headerlink" title="7.4.1 find()"></a>7.4.1 find()</h3><p><strong>功能：</strong>找到第一个符合条件的数组成员<br><strong>返回值：</strong>第一个返回值为<code>true</code>的成员 ，没有则返回 <code>undefined</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>参数1（必需）</td>
<td>一个回调函数，所有数组成员会依次执行该回调</td>
</tr>
<tr>
<td>参数2（可选）</td>
<td>回调函数执行的上下文</td>
</tr>
</tbody>
</table>
<h4 id="回调函数（第一个参数）"><a href="#回调函数（第一个参数）" class="headerlink" title="回调函数（第一个参数）"></a>回调函数（第一个参数）</h4><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>当前成员值</td>
</tr>
<tr>
<td>index</td>
<td>当前成员下标</td>
</tr>
<tr>
<td>arr</td>
<td>原数组</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">-5</span>].find((n) =&gt; n &lt; <span class="number">0</span>)<span class="comment">//-5</span></span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>].find(fcuntion (value, index, arr) &#123;</span><br><span class="line">	<span class="keyword">return</span> value &gt; <span class="number">9</span></span><br><span class="line">&#125;)<span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h3 id="7-4-1-findIndex"><a href="#7-4-1-findIndex" class="headerlink" title="7.4.1 findIndex()"></a>7.4.1 findIndex()</h3><p><strong>功能：</strong>找到第一个符合条件的数组成员的位置<br><strong>返回值：</strong>找到则返回成员位置，否则返回 -1<br><strong>注意：</strong>除了返回值是成员的位置而不是成员本身外，其它方面和 <code>find()</code>完全一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">NaN</span>].indexOf(<span class="literal">NaN</span>)</span><br><span class="line"><span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">[<span class="literal">NaN</span>].findIndex(y =&gt; <span class="built_in">Object</span>.is(<span class="literal">NaN</span>, y))</span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h2 id="7-5-数组实例的-fill"><a href="#7-5-数组实例的-fill" class="headerlink" title="7.5 数组实例的 fill()"></a>7.5 数组实例的 fill()</h2><p><strong>功能：</strong>使用给定值填充数组，数组中已有的元素会被全部抹去<br><strong>是否有副作用：</strong>是<br><strong>返回值：</strong>新数组</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>参数1（必需）</td>
<td>填充数组的元素</td>
</tr>
<tr>
<td>参数2（可选）</td>
<td>填充的开始位置</td>
</tr>
<tr>
<td>参数3（可选）</td>
<td>填充的结束位置</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>].fill(<span class="number">7</span>)<span class="comment">// [7, 7, 7]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>).fill(<span class="number">7</span>)<span class="comment">// [7, 7, 7 ]</span></span><br><span class="line"></span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>].fill(<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>)<span class="comment">// ['a', 7, 'c']</span></span><br></pre></td></tr></table></figure>
<h2 id="7-6-数组实例的-entries-keys-和values"><a href="#7-6-数组实例的-entries-keys-和values" class="headerlink" title="7.6 数组实例的 entries(), keys()和values()"></a>7.6 数组实例的 entries(), keys()和values()</h2><p><strong>用途：</strong>都针对特定方面遍历数组<br><strong>返回值：</strong>便利器对象，可以通过<code>for-of</code>循环便利器对象的 <code>next</code> 方法进行遍历<br>方法|说明<br>-|-<br>keys()|返回数组中<code>key</code>的遍历器对象<br>values()|返回数组中<code>value</code>的遍历器对象<br>entries()|返回数组中<code>key-value</code>的遍历器对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>].keys()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> elem <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>].values()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 'a'</span></span><br><span class="line"><span class="comment">// 'b'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [index, elem] <span class="keyword">of</span> [<span class="string">'a'</span>, <span class="string">'b'</span>].entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(index, elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 "a"</span></span><br><span class="line"><span class="comment">// 1 "b"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> letter = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">let</span> entries = letter.entries();</span><br><span class="line">entries.next().value; <span class="comment">// [0, 'a']</span></span><br><span class="line">entries.next().value; <span class="comment">// [1, 'b']</span></span><br><span class="line">entries.next().value; <span class="comment">// [2, 'c']</span></span><br></pre></td></tr></table></figure>
<h2 id="7-7-数组实例的-includes"><a href="#7-7-数组实例的-includes" class="headerlink" title="7.7 数组实例的 includes()"></a>7.7 数组实例的 includes()</h2><p><strong>功能：</strong>判断数组中是否包含给定的值<br><strong>返回值：</strong><code>true</code> 存在， <code>false</code> 不存在<br><strong>支持：</strong>该方法属于<code>ES7</code>，但 <code>Babel</code>转码器已经支持<br>参数|说明<br>-|-<br>参数1（必需）|要搜索的 <code>value</code><br>参数2（可选）|搜索的开始位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">2</span>);     <span class="comment">// true</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].includes(<span class="number">4</span>);     <span class="comment">// false</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="literal">NaN</span>].includes(<span class="literal">NaN</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-7-1-includes-vs-indexOf"><a href="#7-7-1-includes-vs-indexOf" class="headerlink" title="7.7.1 includes() vs. indexOf()"></a>7.7.1 includes() vs. indexOf()</h3><p>如果用<code>indexOf()</code>替代<code>includes()</code>来确定数组中是否包含给定的值，存在两个问题</p>
<ol>
<li>不够语意化，而且还要比较下标是否不等于-1</li>
<li><code>indexOf()</code>内部使用<code>===</code>进行判断，会导致对<code>NaN</code>的误判</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="literal">NaN</span>].indexOf(<span class="literal">NaN</span>)</span><br><span class="line"><span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">[<span class="literal">NaN</span>].includes(<span class="literal">NaN</span>)</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-7-2-polyfill"><a href="#7-7-2-polyfill" class="headerlink" title="7.7.2 polyfill"></a>7.7.2 polyfill</h3><p>使用<code>Array.prototype.some</code>实现<code>includes</code>功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contains = (() =&gt;</span><br><span class="line">	<span class="built_in">Array</span>.prototype.includes</span><br><span class="line">		? (arr, vaue) =&gt; arr.includes(value)</span><br><span class="line">		: (arr, value) =&gt; arr.some(el =&gt; el === value)</span><br><span class="line">)()</span><br><span class="line"></span><br><span class="line">contrains([<span class="string">'foo'</span>, <span class="string">'bar'</span>], <span class="string">'baz'</span>)<span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<h3 id="7-7-3-Map-和-Set"><a href="#7-7-3-Map-和-Set" class="headerlink" title="7.7.3 Map 和 Set"></a>7.7.3 Map 和 Set</h3><p><strong>说明：</strong><code>Map</code> 和 <code>Set</code>数据结构有一个<code>has</code>方法，需要注意和<code>includes</code>区分 </p>
<p><strong>Map 结构的<code>has</code>方法</strong>：用来查找<code>key</code></p>
<ul>
<li>Map.prototype.has(key)</li>
<li>WeakMap.prototype.has(key)</li>
<li>Reflect.has(target, propertyKey)</li>
</ul>
<p><strong>Set 结构的<code>has</code>方法</strong>：用来查找值</p>
<ul>
<li>Set.prototype.has(value)</li>
<li>WeakSet.prototype.has(value)</li>
</ul>
<h2 id="7-8-数组的空位"><a href="#7-8-数组的空位" class="headerlink" title="7.8 数组的空位"></a>7.8 数组的空位</h2><p><strong>说明：</strong>数组中没有任何值的元素就是一个数组的空位<br><strong>注意：</strong>空位不是<code>undefined</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>(<span class="number">3</span>) <span class="comment">// [, , ,]</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> [<span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>] <span class="comment">// true</span></span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> [, , ,] <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="7-8-1-ES5对空位的处理"><a href="#7-8-1-ES5对空位的处理" class="headerlink" title="7.8.1 ES5对空位的处理"></a>7.8.1 ES5对空位的处理</h3><table>
<thead>
<tr>
<th>数组方法</th>
<th>空位的处理</th>
</tr>
</thead>
<tbody>
<tr>
<td>forEach()</td>
<td>跳过空位</td>
</tr>
<tr>
<td>filter()</td>
<td>跳过空位</td>
</tr>
<tr>
<td>every()</td>
<td>跳过空位</td>
</tr>
<tr>
<td>some()</td>
<td>跳过空位</td>
</tr>
<tr>
<td>map()</td>
<td>跳过空位,但返回的数组中仍保留着这个空位</td>
</tr>
<tr>
<td>join()</td>
<td>将空位是为<code>undefined</code>（<code>undefined、null</code>会被处理成空字符串）</td>
</tr>
<tr>
<td>toString()</td>
<td>将空位是为<code>undefined</code>（<code>undefined、null</code>会被处理成空字符串）</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// forEach方法</span></span><br><span class="line">[,<span class="string">'a'</span>].forEach((x,i) =&gt; <span class="built_in">console</span>.log(i)); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// filter方法</span></span><br><span class="line">[<span class="string">'a'</span>,,<span class="string">'b'</span>].filter(x =&gt; <span class="literal">true</span>) <span class="comment">// ['a','b']</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// every方法</span></span><br><span class="line">[,<span class="string">'a'</span>].every(x =&gt; x===<span class="string">'a'</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// some方法</span></span><br><span class="line">[,<span class="string">'a'</span>].some(x =&gt; x !== <span class="string">'a'</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// map方法</span></span><br><span class="line">[,<span class="string">'a'</span>].map(x =&gt; <span class="number">1</span>) <span class="comment">// [,1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// join方法</span></span><br><span class="line">[,<span class="string">'a'</span>,<span class="literal">undefined</span>,<span class="literal">null</span>].join(<span class="string">'#'</span>) <span class="comment">// "#a##"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// toString方法</span></span><br><span class="line">[,<span class="string">'a'</span>,<span class="literal">undefined</span>,<span class="literal">null</span>].toString() <span class="comment">// ",a,,"</span></span><br></pre></td></tr></table></figure>
<h3 id="7-8-2-ES6对空位的处理"><a href="#7-8-2-ES6对空位的处理" class="headerlink" title="7.8.2 ES6对空位的处理"></a>7.8.2 ES6对空位的处理</h3><p><strong>注意：</strong>由于空位处理规则非常不统一，所以建议避免出现空位<br>运算|说明<br>-|-<br>Array.from()|不会忽略空位，而是将空位转为<code>undefined</code><br>扩展运算符|不会忽略空位，而是将空位转为<code>undefined</code><br>copyWithin()|连空位一起拷贝<br>fill()|将空位视为正常的数组位置<br>for-of|会遍历空位<br>entries()、keys()、values()、find()、findIndex()|会将空位处理成<code>undefined</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from([<span class="string">'a'</span>,,<span class="string">'b'</span>])</span><br><span class="line"><span class="comment">// [ "a", undefined, "b" ]</span></span><br><span class="line"></span><br><span class="line">[...[<span class="string">'a'</span>,,<span class="string">'b'</span>]]</span><br><span class="line"><span class="comment">// [ "a", undefined, "b" ]</span></span><br><span class="line"></span><br><span class="line">[,<span class="string">'a'</span>,<span class="string">'b'</span>,,].copyWithin(<span class="number">2</span>,<span class="number">0</span>) <span class="comment">// [,"a",,"a"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">3</span>).fill(<span class="string">'a'</span>) <span class="comment">// ["a","a","a"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [, ,];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// entries()</span></span><br><span class="line">[...[,<span class="string">'a'</span>].entries()] <span class="comment">// [[0,undefined], [1,"a"]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// keys()</span></span><br><span class="line">[...[,<span class="string">'a'</span>].keys()] <span class="comment">// [0,1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// values()</span></span><br><span class="line">[...[,<span class="string">'a'</span>].values()] <span class="comment">// [undefined,"a"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// find()</span></span><br><span class="line">[,<span class="string">'a'</span>].find(x =&gt; <span class="literal">true</span>) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// findIndex()</span></span><br><span class="line">[,<span class="string">'a'</span>].findIndex(x =&gt; <span class="literal">true</span>) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/es6_8 函数的扩展/" itemprop="url">
                  8 函数的扩展(ECMAScript6入门)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-30T21:58:52+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/30/es6_8 函数的扩展/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/30/es6_8 函数的扩展/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="8-1-函数参数的默认值"><a href="#8-1-函数参数的默认值" class="headerlink" title="8.1 函数参数的默认值"></a>8.1 函数参数的默认值</h2><h3 id="8-1-1-ES6之前"><a href="#8-1-1-ES6之前" class="headerlink" title="8.1.1 ES6之前"></a>8.1.1 ES6之前</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> y === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">		y = <span class="string">'World'</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(x, y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-1-2-基本用法"><a href="#8-1-2-基本用法" class="headerlink" title="8.1.2 基本用法"></a>8.1.2 基本用法</h3><p><strong>说明：</strong>ES6允许为函数的参数设置默认值，即直接写在参数定义的后面。</p>
<ul>
<li>阅读代码的人，可以立刻意识到哪些参数是可以省略的，不用查看函数或文档</li>
<li>有理由将来的代码优化，即使未来的版本在对外接口中，彻底拿掉这个参数，也不回导致以前的代码无法运行</li>
</ul>
<p><strong>注意：</strong>参数变量是默认声明的，不能用<code>let</code>或<code>const</code>再次声明，否则会报错<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span> (<span class="params">x, y = 'World'</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(x, y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log (<span class="string">'Hello'</span>)<span class="comment">// Hello World</span></span><br><span class="line">log (<span class="string">'Hello'</span>, China)<span class="comment">// Hello China</span></span><br><span class="line">log (<span class="string">'Hello'</span>, <span class="string">''</span>)<span class="comment">// Hello</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-1-3-与解构赋值默认值结合使用"><a href="#8-1-3-与解构赋值默认值结合使用" class="headerlink" title="8.1.3 与解构赋值默认值结合使用"></a>8.1.3 与解构赋值默认值结合使用</h3><p><strong>案例1</strong>：只使用解构赋值默认值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">&#123;x, y = 5&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(&#123;&#125;) <span class="comment">// undefined, 5</span></span><br><span class="line">foo(&#123;x: <span class="number">1</span>&#125;) <span class="comment">// 1, 5</span></span><br><span class="line">foo(&#123;x: <span class="number">1</span>, y: <span class="number">2</span>&#125;) <span class="comment">// 1, 2</span></span><br><span class="line">foo() <span class="comment">// TypeError: Cannot read property 'x' of undefined</span></span><br></pre></td></tr></table></figure></p>
<p><strong>案例二</strong>：只使用解构赋值默认值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params">url, &#123; body = '', method = 'GET', headers = &#123;&#125; &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">'http://example.com'</span>, &#123;&#125;)</span><br><span class="line"><span class="comment">// "GET"</span></span><br><span class="line"></span><br><span class="line">fetch(<span class="string">'http://example.com'</span>)</span><br><span class="line"><span class="comment">// 报错</span></span><br></pre></td></tr></table></figure></p>
<p><strong>案例三</strong>：双重默认值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">cond1=&gt;condition: 判断第二个参数是不是 undefined</span><br><span class="line">op1=&gt;operation: 参数默认值生效 </span><br><span class="line">cond2=&gt;condition: 参数默认值中 method 是否是 undefined</span><br><span class="line">op2=&gt;operation: 解构赋值中 method 默认值生效</span><br><span class="line">op3=&gt;operation: 参数默认值不生效</span><br><span class="line">op4=&gt;operation: method 通过结构赋值获取值</span><br><span class="line">op5=&gt;operation: 使用传入的 method 值</span><br><span class="line">cond4=&gt;condition: 判断是不是能够解构</span><br><span class="line">op7=&gt;operation: 解构失败（报错）</span><br><span class="line">op8=&gt;operation: method最终为 undefined</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line"></span><br><span class="line">st-&gt;cond1</span><br><span class="line">cond1(yes)-&gt;op1</span><br><span class="line">cond1(no)-&gt;cond4</span><br><span class="line">cond4(yes)-&gt;op4-&gt;e</span><br><span class="line">cond4(no)-&gt;op7-&gt;e</span><br><span class="line">cond2(yes)-&gt;op7-&gt;e</span><br><span class="line">cond2(no)-&gt;op</span><br><span class="line">op1-&gt;cond2</span><br><span class="line">cond2(yes)-&gt;op2</span><br><span class="line">op2-&gt;e</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params">url, &#123; method = 'GET' &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">'http://example.com'</span>)</span><br><span class="line"><span class="comment">// "GET"</span></span><br></pre></td></tr></table></figure>
<p><strong>案例四</strong>：通过对比深入理解<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法一:解构中提供默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">m1</span>(<span class="params">&#123;x = 0, y = 0&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x, y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法二：默认参数中提供默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">m2</span>(<span class="params">&#123;x, y&#125; = &#123; x: 0, y: 0 &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x, y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数没有参数的情况</span></span><br><span class="line">m1() <span class="comment">// [0, 0]</span></span><br><span class="line">m2() <span class="comment">// [0, 0]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// x和y都有值的情况</span></span><br><span class="line">m1(&#123;x: <span class="number">3</span>, y: <span class="number">8</span>&#125;) <span class="comment">// [3, 8]</span></span><br><span class="line">m2(&#123;x: <span class="number">3</span>, y: <span class="number">8</span>&#125;) <span class="comment">// [3, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// x有值，y无值的情况</span></span><br><span class="line">m1(&#123;x: <span class="number">3</span>&#125;) <span class="comment">// [3, 0]</span></span><br><span class="line">m2(&#123;x: <span class="number">3</span>&#125;) <span class="comment">// [3, undefined]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// x和y都无值的情况</span></span><br><span class="line">m1(&#123;&#125;) <span class="comment">// [0, 0];</span></span><br><span class="line">m2(&#123;&#125;) <span class="comment">// [undefined, undefined]</span></span><br><span class="line"></span><br><span class="line">m1(&#123;z: <span class="number">3</span>&#125;) <span class="comment">// [0, 0]</span></span><br><span class="line">m2(&#123;z: <span class="number">3</span>&#125;) <span class="comment">// [undefined, undefined]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-1-4-参数默认值的位置"><a href="#8-1-4-参数默认值的位置" class="headerlink" title="8.1.4 参数默认值的位置"></a>8.1.4 参数默认值的位置</h3><p> <strong>说明：</strong>给函数传递参数时，可以通过<code>空位</code>省略某个参数。但如果函数定义时某个参数有默认值，传递<code>空位</code>给它会报错。<br> <strong>技巧：</strong>因为设置了默认值的参数后面有没设置默认值的参数时，前者将不能通过<code>空位</code>省略。因此应该将设置了默认值的参数都排在后面。<br> <strong>注意：</strong>传入<code>undefined</code>将触发该参数等于默认值，<code>null</code>则没有这个效果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例一</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x = 1, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x, y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f() <span class="comment">// [1, undefined]</span></span><br><span class="line">f(<span class="number">2</span>) <span class="comment">// [2, undefined])</span></span><br><span class="line">f(, <span class="number">1</span>) <span class="comment">// 报错</span></span><br><span class="line">f(<span class="literal">undefined</span>, <span class="number">1</span>) <span class="comment">// [1, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例二</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y = 5, z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [x, y, z];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f() <span class="comment">// [undefined, 5, undefined]</span></span><br><span class="line">f(<span class="number">1</span>) <span class="comment">// [1, 5, undefined]</span></span><br><span class="line">f(<span class="number">1</span>, ,<span class="number">2</span>) <span class="comment">// 报错</span></span><br><span class="line">f(<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">2</span>) <span class="comment">// [1, 5, 2]</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-1-5-函数的-length-属性"><a href="#8-1-5-函数的-length-属性" class="headerlink" title="8.1.5 函数的 length 属性"></a>8.1.5 函数的 length 属性</h3><p><code>length属性：</code>函数预期传入的参数个数</p>
<ul>
<li>某个参数指定默认值以后，<code>length</code>就不计入这个参数了</li>
<li>rest 参数也不会计入 <code>length</code> </li>
<li>设置了默认值的参数后面的参数，无论是否设置了默认值，都不再计入 <code>length</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 参数指定默认值 */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;&#125;).length <span class="comment">// 1</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a = 5</span>) </span>&#123;&#125;).length <span class="comment">// 0</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, b, c = 5</span>) </span>&#123;&#125;).length <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* rest 参数 */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;&#125;).length <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置了默认值的参数后面的参数 */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a = 0, b, c</span>) </span>&#123;&#125;).length <span class="comment">// 0</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">a, b = 1, c</span>) </span>&#123;&#125;).length <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h3 id="8-1-5-作用域"><a href="#8-1-5-作用域" class="headerlink" title="8.1.5 作用域"></a>8.1.5 作用域</h3><p> <strong>说明：</strong>参数和其默认值引起的一些作用域问题分析。<br> <strong>参数的作用域：</strong>参数声明的过程也是变量声明的过程，参数的作用域和函数内部是一致的<br> <code>函数局部作用域 -&gt; 全局作用域</code></p>
<ol>
<li>参数默认值为其它声明在前面的参数</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局变量 x</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于前面的参数又声明了一个 x， 因此 y = x 中的 x 是局部声明的这个 x。全局的 x 被屏蔽</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x, y = x</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f(<span class="number">2</span>)<span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<ol>
<li>参数默认值为其它全局变量</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数赋值默认值这个运算的上线文在函数定义时就形成了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">y = x</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 内部定义的这个局部变量 x 能屏蔽全局的 x，但无法屏蔽参数默认值对全局 x 的引用，事实上，默认值赋值的过程远在内部声明 x 之前就完成了</span></span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f() <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<ol>
<li>默认参数的变量在函数作用域和全局作用域都没有找到变量</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">y = x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f() <span class="comment">// ReferenceError: x is not defined</span></span><br></pre></td></tr></table></figure>
<ol>
<li>暂时性死区</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// x = x 右值部分寻找 x 时发现函数作用域内存在 x ，但此时 x 还未声明，处于暂时性死区，因而报错</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x = x</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() <span class="comment">// ReferenceError: x is not defined</span></span><br></pre></td></tr></table></figure>
<ol>
<li>参数的默认值是一个函数<br>作为默认值的匿名函数在函数<code>bar</code>定义时被定义，JS<code>静态作用域</code>的特点决定了此时其作用域已经被确定，只能是全局作用域(因为函数定义阶段作用域链中只有全局对象，活动对象在函数调用阶段才会被创建)<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, y = function(</span>) </span>&#123;<span class="comment">/* 根据静态作用域的特点，这个 x 的作用域在一开始就确定了，x 始终指向全局的那个 x */</span>x = <span class="number">2</span>; &#125;) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">3</span>;</span><br><span class="line">  y();</span><br><span class="line">  <span class="comment">// 这个时候访问的 x 是函数作用域中声明的那个 x ，全局的 x 被屏蔽了</span></span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="8-1-6-应用"><a href="#8-1-6-应用" class="headerlink" title="8.1.6 应用"></a>8.1.6 应用</h3><p>可以指定某一个参数不得省略，如果省略就抛出一个错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throwIfMissing</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Missing parameter'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数的默认值不是在定义时执行，而是在运行时执行（即如果参数已经赋值，默认值中的函数就不会运行）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">mustBeProvided = throwIfMissing(</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> mustBeProvided;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo 函数执行时默认值 throwIfMissing() 才执行，mustBeProcided取得的 是 throwIfMissing() 的返回值</span></span><br><span class="line">foo()</span><br><span class="line"><span class="comment">// Error: Missing parameter</span></span><br></pre></td></tr></table></figure>
<h2 id="8-2-rest-参数"><a href="#8-2-rest-参数" class="headerlink" title="8.2 rest 参数"></a>8.2 rest 参数</h2><p><strong>说明：</strong>S6引入rest参数，形式为<code>...变量名</code>，用于获取函数的多余参数</p>
<ul>
<li>相比 arugments ，rest参数的写法更自然也更简洁</li>
<li>rest参数中的变量代表一个数组，所以数组特有的方法都可以用于这个变量</li>
<li>函数的<code>length</code>属性，不计入rest参数</li>
</ul>
<p><strong>用途：</strong>这样就不需要使用<code>arguments</code>对象了<br><strong>注意：</strong>rest参数之后不能再有其他参数（即只能是最后一个参数），否则会报错<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arguments变量的写法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortNumbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>).sort();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rest参数的写法</span></span><br><span class="line"><span class="keyword">const</span> sortNumbers = (...numbers) =&gt; numbers.sort();</span><br></pre></td></tr></table></figure></p>
<h2 id="8-3-扩展运算符"><a href="#8-3-扩展运算符" class="headerlink" title="8.3 扩展运算符"></a>8.3 扩展运算符</h2><h3 id="8-3-1-含义"><a href="#8-3-1-含义" class="headerlink" title="8.3.1 含义"></a>8.3.1 含义</h3><p> <strong>扩展运算符：</strong>用于将数组变为参数序列<br> <strong>说明：</strong>相当于<code>rest</code>参数的逆运算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">array, ...items</span>) </span>&#123;</span><br><span class="line">  array.push(...items);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">4</span>, <span class="number">38</span>];</span><br><span class="line">add(...numbers) <span class="comment">// 42</span></span><br></pre></td></tr></table></figure>
<h3 id="8-3-2-替代数组的-apply-方法"><a href="#8-3-2-替代数组的-apply-方法" class="headerlink" title="8.3.2 替代数组的 apply 方法"></a>8.3.2 替代数组的 apply 方法</h3><p> <strong>说明：</strong>使用<code>apply</code>方法的一种用途就是让数组中的每个元素分别作为实参传递到方法中，但这个需求使用扩展运算符实现更加直观简洁。<br> <strong>举个栗子：</strong>下面说三个例子</p>
<ul>
<li><code>Math.max()</code></li>
<li><code>Array.prototype.push()</code></li>
<li><code>new Date()</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 案例一：Math.max() */</span></span><br><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="built_in">Math</span>.max(...[<span class="number">14</span>, <span class="number">3</span>, <span class="number">77</span>])<span class="comment">// Math.max(14, 3, 77);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 案例二：Array.prototype.push() */</span></span><br><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.apply(arr1, arr2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr1.push(...arr2);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 案例三：new Date() */</span></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">new</span> (<span class="built_in">Date</span>.bind.apply(<span class="built_in">Date</span>, [<span class="literal">null</span>, <span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]))</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(...[<span class="number">2015</span>, <span class="number">1</span>, <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="8-3-3-扩展运算符的应用"><a href="#8-3-3-扩展运算符的应用" class="headerlink" title="8.3.3 扩展运算符的应用"></a>8.3.3 扩展运算符的应用</h3><h4 id="8-3-3-1-合并数组"><a href="#8-3-3-1-合并数组" class="headerlink" title="8.3.3.1 合并数组"></a>8.3.3.1 合并数组</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>].concat(more)</span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, ...more]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="string">'a'</span>, <span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="string">'c'</span>];</span><br><span class="line"><span class="keyword">var</span> arr3 = [<span class="string">'d'</span>, <span class="string">'e'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5的合并数组</span></span><br><span class="line">arr1.concat(arr2, arr3);</span><br><span class="line"><span class="comment">// [ 'a', 'b', 'c', 'd', 'e' ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的合并数组</span></span><br><span class="line">[...arr1, ...arr2, ...arr3]</span><br><span class="line"><span class="comment">// [ 'a', 'b', 'c', 'd', 'e' ]</span></span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-2-与解构赋值结合"><a href="#8-3-3-2-与解构赋值结合" class="headerlink" title="8.3.3.2 与解构赋值结合"></a>8.3.3.2 与解构赋值结合</h4><p> <strong>说明：</strong>可以达从数组中到获取子数组的目的<br> <strong>注意：</strong>如果将扩展运算符用于数组赋值，只能放在参数的最后一位，否则会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line">a = list[<span class="number">0</span>]<span class="comment">// 获取 list 数组第一个值</span></span><br><span class="line">rest = list.slice(<span class="number">1</span>)<span class="comment">// 获取 list 数组其余的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">[a, ...rest] = list</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">first <span class="comment">// 1</span></span><br><span class="line">rest  <span class="comment">// [2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [];</span><br><span class="line">first <span class="comment">// undefined</span></span><br><span class="line">rest  <span class="comment">// []:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...rest] = [<span class="string">"foo"</span>];</span><br><span class="line">first  <span class="comment">// "foo"</span></span><br><span class="line">rest   <span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [...butLast, last] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [first, ...middle, last] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">// 报错</span></span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-3-函数的返回值"><a href="#8-3-3-3-函数的返回值" class="headerlink" title="8.3.3.3 函数的返回值"></a>8.3.3.3 函数的返回值</h4><p> <strong>说明：</strong><code>JS</code>函数如果想返回多个值，只能以数组或对象的方式返回。其中数组形式的返回值用扩展运算符处理非常合适。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dateFields = readDateFields(database);</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(...dateFields);</span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-4-字符串"><a href="#8-3-3-4-字符串" class="headerlink" title="8.3.3.4 字符串"></a>8.3.3.4 字符串</h4><p> <strong>说明：</strong>扩展运算符可以将字符串转为真正的数组<br> <strong>注意：</strong>能够正确处理<code>32</code>位的 <code>Unicode</code>字符</p>
<ul>
<li><p><strong>正确获取字符串的 length</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[...<span class="string">'hello'</span>]</span><br><span class="line"><span class="comment">// [ "h", "e", "l", "l", "o" ]</span></span><br><span class="line"></span><br><span class="line"><span class="string">'x\uD83D\uDE80y'</span>.length <span class="comment">// 4，这种方式，JavaScript会将32位Unicode字符，识别为2个字符</span></span><br><span class="line">[...<span class="string">'x\uD83D\uDE80y'</span>].length <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>正确 split 字符串</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">'x\uD83D\uDE80y'</span>;</span><br><span class="line"></span><br><span class="line">str.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line"><span class="comment">// 'y\uDE80\uD83Dx'</span></span><br><span class="line"></span><br><span class="line">[...str].reverse().join(<span class="string">''</span>)</span><br><span class="line"><span class="comment">// 'y\uD83D\uDE80x'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="8-3-3-5-实现-Iterator-接口的对象"><a href="#8-3-3-5-实现-Iterator-接口的对象" class="headerlink" title="8.3.3.5 实现 Iterator 接口的对象"></a>8.3.3.5 实现 Iterator 接口的对象</h4><p> <strong>说明：</strong>任何<code>Iterator</code>接口的对象，都可以用扩展运算符转为真正的数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nodeList = <span class="built_in">document</span>.querySelectorAll(<span class="string">'div'</span>);</span><br><span class="line"><span class="keyword">var</span> array = [...nodeList];</span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-6-Map和Set结构，Generator-函数"><a href="#8-3-3-6-Map和Set结构，Generator-函数" class="headerlink" title="8.3.3.6 Map和Set结构，Generator 函数"></a>8.3.3.6 Map和Set结构，Generator 函数</h4><p> <strong>说明：</strong>扩展运算符内部调用的是数据结构的Iterator接口，因此只要具有Iterator接口的对象，都可以使用扩展运算符，比如</p>
<ul>
<li>Map 结构</li>
<li>Set 结构</li>
<li>Generator 函数返回值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Map 结构 */</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="number">1</span>, <span class="string">'one'</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="string">'two'</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="string">'three'</span>],</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// map.keys() 返回一个便利器对象</span></span><br><span class="line"><span class="keyword">let</span> arr = [...map.keys()]; <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Set 结构 */</span></span><br><span class="line"><span class="keyword">var</span> go = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// go() 返回一个遍历器对象</span></span><br><span class="line">[...go()] <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="8-4-name属性"><a href="#8-4-name属性" class="headerlink" title="8.4 name属性"></a>8.4 name属性</h2><p> <strong>说明：</strong>函数的<code>name</code>属性，返回该函数的函数名</p>
<table>
<thead>
<tr>
<th>es5和es6的对比</th>
<th>es5</th>
<th>es6</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否加入到标准</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>匿名函数赋值给一个变量， name 属性值</td>
<td>空字符串</td>
<td>变量名</td>
</tr>
<tr>
<td>具名函数赋值给一个变量，name 属性值</td>
<td>函数本来的名字</td>
<td>函数本来的名字</td>
</tr>
<tr>
<td>(new Function).name</td>
<td><code>anonymous</code></td>
<td><code>anonymous</code></td>
</tr>
<tr>
<td>bind返回的函数，name属性值</td>
<td>“bound 函数名”</td>
<td>“bound 函数名”</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 匿名函数赋值给一个变量 */</span></span><br><span class="line"><span class="keyword">var</span> func1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line">func1.name <span class="comment">// ""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">func1.name <span class="comment">// "func1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Function构造函数返回的函数实例 */</span></span><br><span class="line">(<span class="keyword">new</span> <span class="built_in">Function</span>).name <span class="comment">// "anonymous"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* bind返回的函数 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">foo.bind(&#123;&#125;).name <span class="comment">// "bound foo"</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;).bind(&#123;&#125;).name <span class="comment">// "bound "</span></span><br></pre></td></tr></table></figure>
<h2 id="8-5-箭头函数"><a href="#8-5-箭头函数" class="headerlink" title="8.5 箭头函数"></a>8.5 箭头函数</h2><p> <strong>说明：</strong>是一种特殊的函数，相比传统的函数</p>
<ul>
<li>表达更加简洁</li>
<li><p>绑定<code>this</code>，没有传统函数<code>this</code>指向变化带来的困扰</p>
<p><strong>常见用途：</strong>简化回调函数</p>
</li>
</ul>
<h3 id="8-5-1-基本用法"><a href="#8-5-1-基本用法" class="headerlink" title="8.5.1 基本用法"></a>8.5.1 基本用法</h3><p><code>参数 =&gt; 表达式</code><br>参数部分|说明<br>-|-<br>没有参数|<code>()</code><br>1个参数|<code>(参数)</code>或<code>参数</code><br>>1个参数|<code>(参数1, 参数2, ...)</code></p>
<table>
<thead>
<tr>
<th>表达式部分</th>
<th>结构</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>单个语句</td>
<td><code>语句</code></td>
<td>表达式本身的运算结果</td>
</tr>
<tr>
<td>多个语句</td>
<td><code>{语句1; 语句2; return 语句3}</code></td>
<td><code>return</code>的部分</td>
</tr>
<tr>
<td>直接返回对象</td>
<td><code>(对象字面量)</code></td>
<td>对象字面量</td>
</tr>
</tbody>
</table>
<ul>
<li><p>如果箭头函数不需要参数或需要多个参数，就使用一个圆括号代表参数部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 没有参数 */</span></span><br><span class="line"><span class="keyword">var</span> f = () =&gt; <span class="number">5</span>;<span class="comment">// var f = function () &#123; return 5 &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 单个参数 */</span></span><br><span class="line"><span class="keyword">var</span> f = v =&gt; v;</span><br><span class="line"><span class="comment">// var f = function (v) &#123;</span></span><br><span class="line"><span class="comment">//	return v;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 多个参数 */</span></span><br><span class="line"><span class="keyword">var</span> sum = (num1, num2) =&gt; num1 + num2;</span><br><span class="line"><span class="comment">// var sum = function(num1, num2) &#123;</span></span><br><span class="line"><span class="comment">//  return num1 + num2;</span></span><br><span class="line"><span class="comment">//&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果箭头函数的代码块部分多于一条语句，就要使用<code>{}</code>将它们括起来，并且使用<code>return</code>语句返回</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = (num1, num2) =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> pi = <span class="number">3.14</span>;</span><br><span class="line">	<span class="keyword">return</span> (num1 + num2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于<code>{}</code>被解释为<code>代码块</code>，所以如果箭头函数直接返回一个对象，必须在对象外面加上<code>()</code></p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getTempItem = id =&gt; (&#123;id: id, name: <span class="string">"Temp"</span>&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>与<code>变量解构</code>结合使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> full = (&#123;first, last&#125;) =&gt; first + <span class="string">' '</span> + last;</span><br><span class="line"><span class="comment">// function full(person) &#123;</span></span><br><span class="line"><span class="comment">//  return person.first + ' ' + person.last;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>与 rest 参数结合使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 将参数转换为数组</span><br><span class="line">* @param &#123;可变参数&#125; </span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">const</span> numbers = (...nums) =&gt; nums;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="8-5-2-使用注意点"><a href="#8-5-2-使用注意点" class="headerlink" title="8.5.2 使用注意点"></a>8.5.2 使用注意点</h3><ol>
<li>函数体内的<code>this</code>对象，就是定义时所在的对象，而不是使用时所在的对象</li>
<li>不可以当作构造函数，也就是说，不可以使用<code>new</code>命令，否则会抛出一个错误</li>
<li>不可以使用<code>arguments</code>对象，该对象在函数体内不存在。如果要用，可以用<code>Rest</code>参数代替</li>
<li>不可以使用<code>yield</code>命令，因此箭头函数不能用作<code>Generator</code>函数</li>
</ol>
<h4 id="箭头函数的this"><a href="#箭头函数的this" class="headerlink" title="箭头函数的this"></a>箭头函数的<code>this</code></h4><p> <strong>说明：</strong><code>this</code>指向的固定化，并不是因为箭头函数内部有绑定<code>this</code>的机制，实际原因是箭头函数根本没有自己的<code>this</code>，导致内部的this就是外层代码块的<code>this</code>。正是因为它没有<code>this</code>，所以也就不能用作构造函数。<br> <strong>用途：</strong>箭头函数可以让<code>this</code>指向固定化，这种特性很有利于封装回调函数<br> <strong>注意：</strong>由于箭头函数没有自己的<code>this</code>，所以当然也就不能用<code>call()、apply()、bind()</code>这些方法去改变<code>this</code>的指向</p>
<p><em>原理说明</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">	<span class="comment">// 箭头函数里面根本没有自己的this，而是引用外层的this</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'id:'</span>, <span class="keyword">this</span>.id);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'id:'</span>, _this.id);</span><br><span class="line">  &#125;, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>改变 this 无效</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">	<span class="comment">// 箭头函数没有自己的this，所以bind方法无效，内部的this指向外部的this</span></span><br><span class="line">    (() =&gt; <span class="keyword">this</span>.x).bind(&#123; x: <span class="string">'inner'</span> &#125;)()</span><br><span class="line">  ];</span><br><span class="line">&#125;).call(&#123; x: <span class="string">'outer'</span> &#125;);</span><br><span class="line"><span class="comment">// ['outer']</span></span><br></pre></td></tr></table></figure></p>
<h3 id="8-5-3-嵌套的箭头函数"><a href="#8-5-3-嵌套的箭头函数" class="headerlink" title="8.5.3 嵌套的箭头函数"></a>8.5.3 嵌套的箭头函数</h3><p><em>管道函数</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 管道机制：前一个函数的输出是后一个函数的输入 */</span></span><br><span class="line"><span class="keyword">const</span> pipeline = (...funcs) =&gt;</span><br><span class="line">	val =&gt; funcs.reduce((a, b) =&gt; b(a), val);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;...Function&#125; funcs 需要进行管道运算的一个一个函数</span><br><span class="line">*/</span></span><br><span class="line"><span class="comment">//var pipeline = function (...funcs) &#123;</span></span><br><span class="line"><span class="comment">//  /**</span></span><br><span class="line"><span class="comment">//  * @val &#123;Number&#125; 初始值</span></span><br><span class="line"><span class="comment">//  */</span></span><br><span class="line"><span class="comment">//	return function (val) &#123;</span></span><br><span class="line"><span class="comment">//		return funcs.reduce(function (a, b) &#123;</span></span><br><span class="line"><span class="comment">//			return b(a)</span></span><br><span class="line"><span class="comment">//		&#125;, val)</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> plus1 = a =&gt; a + <span class="number">1</span>;<span class="comment">// 返回增加1后的值</span></span><br><span class="line"><span class="keyword">const</span> mult2 = a =&gt; a + <span class="number">2</span>;<span class="comment">// 返回增加2后的值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addThenMult = pipeline(plus1, mult2);</span><br><span class="line">addThenMult(<span class="number">5</span>)<span class="comment">// 12</span></span><br></pre></td></tr></table></figure></p>
<p><em>ℷ演算</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// λ演算的写法</span></span><br><span class="line">fix = λf.(λx.f(λv.x(x)(v)))(λx.f(λv.x(x)(v)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="keyword">var</span> fix = f =&gt; (x =&gt; f(v =&gt; x(x)(v)))</span><br><span class="line">               (x =&gt; f(v =&gt; x(x)(v)));</span><br></pre></td></tr></table></figure></p>
<h2 id="8-6-函数绑定"><a href="#8-6-函数绑定" class="headerlink" title="8.6 函数绑定"></a>8.6 函数绑定</h2><p> <strong>函数绑定运算符：</strong><code>对象::函数名</code><br> <strong>功能：</strong>该运算符会自动将左边的对象，作为上下文环境（即 this 对象），绑定到右边的函数上面，然后返回</p>
<ul>
<li>如果左边（对象）为空，右边是一个<code>对象的方法</code>，则等于将该方法绑定到该对象上面</li>
<li><p>某些情况下可以采用链式写法</p>
<p><strong>用途：</strong>用来取代<code>call、apply、bind</code>调用<br><strong>兼容性：</strong>只是一个<code>ES7</code>的提案，但<code>Babel</code>转码器已经支持</p>
</li>
</ul>
<p><em>取代 bind、 apply</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 取代 bind */</span></span><br><span class="line">contextObj::bar</span><br><span class="line"><span class="comment">// bar.bind(contextObj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 取代 apply */</span></span><br><span class="line">contextObj::bar(...arguments)</span><br><span class="line"><span class="comment">// bar.apply(contextObj, arguments)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasOwnProperty = <span class="built_in">Object</span>.prototype.hasOwnProperty;</span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 判断对象中是否存在某个值</span><br><span class="line">* @param &#123;obj&#125; 对象</span><br><span class="line">* @param &#123;key&#125; 属性名</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasOwn</span>(<span class="params">obj, key</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> obj::hasOwnProperty(key);</span><br><span class="line">	<span class="comment">// return hasOwnProperty.call(obj);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>简写的情形</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> method = obj::obj.foo;</span><br><span class="line"><span class="comment">// var method = ::obj.foo;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> log = ::<span class="built_in">console</span>.log;</span><br><span class="line"><span class="comment">// var log = console.log.bind(console.log)</span></span><br></pre></td></tr></table></figure></p>
<p><em>链式写法</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 例子1 */</span></span><br><span class="line"><span class="keyword">import</span> &#123; map, takeWhile, forEach &#125; <span class="keyword">from</span> <span class="string">"iterlib"</span></span><br><span class="line"></span><br><span class="line">getPlayers()</span><br><span class="line">::map(x =&gt; x.character())</span><br><span class="line">::takeWhile(x =&gt; x.strength &gt; <span class="number">100</span>)</span><br><span class="line">::forEach(x =&gt; <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure></p>
<h2 id="8-7-尾调用优化"><a href="#8-7-尾调用优化" class="headerlink" title="8.7 尾调用优化"></a>8.7 尾调用优化</h2><h3 id="8-7-1-什么是尾调用？"><a href="#8-7-1-什么是尾调用？" class="headerlink" title="8.7.1 什么是尾调用？"></a>8.7.1 什么是尾调用？</h3><p> <strong>答：</strong>指函数的最后一步是调用另一个函数<br> <strong>注意：</strong>尾调用不一定出现在函数尾部，只要是最后一步操作即可<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 正确的尾调用 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> g(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> m(x)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 容易被误解为尾调用的情形 */</span></span><br><span class="line"><span class="comment">// 情况一：调用函数g之后，还有赋值操作</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = g(x);</span><br><span class="line">  <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情况二：调用后还有加运算</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> g(x) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情况三：最后还有一个隐含的 return undefined 的操作</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">  g(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="8-7-2-尾调用优化"><a href="#8-7-2-尾调用优化" class="headerlink" title="8.7.2 尾调用优化"></a>8.7.2 尾调用优化</h3><p> <strong>说明：</strong><code>JS</code> 引擎在处理<code>尾调用函数</code>的时候会比<code>普通函数</code>有更好的内存性能<br> <strong>调用帧：</strong>函数调用在内存中形成的一个调用记录，保存调用位置和内部变量等信息<br> <strong>调用栈：</strong>如果A调用了B，非尾调用会在A的调用帧上方形成一个B的调用帧，一次类推，形成一个<code>调用栈</code>;尾调用由于是函数的最后一步操作，所以不需要保留外层函数的调用帧，只要直接用内层函数的调用帧，取代外层函数的饿调用帧<br> <strong>注意：</strong>只有不再用到外层函数的内部变量，内层函数的调用帧才会取代外层函数的调用帧，否则就无法进行“尾调用优化”。</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1472366383179.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不会进行尾调用优化，因为内层函数inner用到了外层函数addOne的内部变量one</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOne</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> one = <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b + one;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> inner(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-7-3-尾递归"><a href="#8-7-3-尾递归" class="headerlink" title="8.7.3 尾递归"></a>8.7.3 尾递归</h3><p> <strong>尾递归：</strong>尾递归调用自身<br> <strong>说明：</strong>因为同时保存成千上百给调用帧，递归容易造成<code>栈溢出</code>，但尾递归不回，因为只存在一个调用帧<br> <strong>注意：</strong>ES6第一次明确规定，所有<code>ECMAScript</code>的实现，都必需部署<code>尾调用优化</code>。</p>
<h4 id="8-7-3-1-计算-n-的阶乘"><a href="#8-7-3-1-计算-n-的阶乘" class="headerlink" title="8.7.3.1 计算 n 的阶乘"></a>8.7.3.1 计算 n 的阶乘</h4><p><em>尾调用</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 递归计算阶乘</span><br><span class="line">* @param &#123;Number&#125; n 几的阶乘</span><br><span class="line">* @param &#123;Number&#125; total 当前一次乘积值</span><br><span class="line">* @return &#123;Number&#125; 返回的值并不使用，也没有意义，只是为了构成尾递归</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span> (<span class="params">n, total</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">	<span class="keyword">return</span> factorial(n - <span class="number">1</span>, n * total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorial(<span class="number">5</span>, <span class="number">1</span>)<span class="comment">// 120</span></span><br></pre></td></tr></table></figure></p>
<p><em>非尾调用</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">functon factorial (n) &#123;</span><br><span class="line">	<span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> n * factional(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="8-7-3-2-fibonacci递归算法"><a href="#8-7-3-2-fibonacci递归算法" class="headerlink" title="8.7.3.2 fibonacci递归算法"></a>8.7.3.2 fibonacci递归算法</h4><p><em>尾调用</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 递归计算 fibonacii 数列的和</span><br><span class="line">* @param &#123;Number&#125; 在几以下的 fibonacci 数列</span><br><span class="line">* @param &#123;Number&#125; ac1 fibonacii 的第一个值</span><br><span class="line">* @param &#123;Number&#125; ac2 fibonacii 的第二个值</span><br><span class="line">* @return &#123;Number&#125; fibonacii 数列的和</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span> (<span class="params">n, ac1 = 1, ac2 = 1</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n &lt;=<span class="number">1</span>) <span class="keyword">return</span> ac2;</span><br><span class="line">	<span class="keyword">return</span> fibonacci(n <span class="number">-1</span>, ac2, ac1 + ac2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>非尾调用</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacii</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + gibonacci(n - <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="8-7-4-递归函数的改写"><a href="#8-7-4-递归函数的改写" class="headerlink" title="8.7.4 递归函数的改写"></a>8.7.4 递归函数的改写</h3><p> <strong>说明：</strong>把所有用到的内部变量改写成函数的参数，确保最后一步只调用自身<br> <strong>技巧：</strong>解决<code>尾递归</code>参数不太易读的问题</p>
<ol>
<li>在尾递归函数之外，再提供一个正常形式的函数</li>
<li>将函数柯里化（currying），意思是将多参数的函数转换成单参数的形式 </li>
<li>采用ES6的函数默认值</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 尾递归函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tailFactorial</span>(<span class="params">n, total</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">  <span class="keyword">return</span> tailFactorial(n - <span class="number">1</span>, n * total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 在尾递归函数之外，再提供一个正常形式的函数 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial1</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> tailFactorial(n, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">factorial1(<span class="number">5</span>) <span class="comment">// 120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 将函数柯里化（currying），意思是将多参数的函数转换成单参数的形式 */</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">currying</span>(<span class="params">fn, n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn.call(<span class="keyword">this</span>, m, n);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> factorial2 = currying(tailFactorial, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">factorial2(<span class="number">5</span>) <span class="comment">// 120</span></span><br><span class="line"><span class="comment">/* 3. 采用ES6的函数默认值 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial3</span>(<span class="params">n, total = 1</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n === <span class="number">1</span>) <span class="keyword">return</span> total;</span><br><span class="line">  <span class="keyword">return</span> factorial(n - <span class="number">1</span>, n * total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorial3(<span class="number">5</span>) <span class="comment">// 120</span></span><br></pre></td></tr></table></figure>
<h3 id="8-7-5-严格模式"><a href="#8-7-5-严格模式" class="headerlink" title="8.7.5 严格模式"></a>8.7.5 严格模式</h3><p> <strong>说明：</strong><code>ES6</code>的尾递归优化值在严格模式下开启，正常模式是无效的<br> <strong>原理：</strong>因为在正常模式下，函数内部有两个变量，可以跟踪函数的调用栈。严格模式下，尾调用优化发生，函数的调用栈会改写，因此上面两个变量就会失真</p>
<ul>
<li>func.arguments：返回调用时函数的参数</li>
<li>func.caller：返回调用当前函数的那个函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">restricted</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  restricted.caller;    <span class="comment">// 报错</span></span><br><span class="line">  restricted.arguments; <span class="comment">// 报错</span></span><br><span class="line">&#125;</span><br><span class="line">restricted();</span><br></pre></td></tr></table></figure>
<h3 id="8-7-6-尾递归优化的实现"><a href="#8-7-6-尾递归优化的实现" class="headerlink" title="8.7.6 尾递归优化的实现"></a>8.7.6 尾递归优化的实现</h3><p> <strong>说明：</strong>正常模式下，或者那些不支持该功能的环境中，可以自己实现尾递归优化。这里提供两种方式</p>
<ol>
<li>利用蹦床函数，将递归执行转为循环执行（需要改写尾递归函数本身）</li>
<li>真正的自己实现的尾递归优化（不需要改写递归函数本身）</li>
</ol>
<h4 id="8-7-6-1-利用蹦床函数"><a href="#8-7-6-1-利用蹦床函数" class="headerlink" title="8.7.6.1 利用蹦床函数"></a>8.7.6.1 利用蹦床函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 递归函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> sum.bind(<span class="literal">null</span>, x + <span class="number">1</span>, y - <span class="number">1</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// function sum(x, y) &#123;</span></span><br><span class="line"><span class="comment">//  if (y &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">//    return sum(x + 1, y - 1);</span></span><br><span class="line"><span class="comment">//  &#125; else &#123;</span></span><br><span class="line"><span class="comment">//    return x;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 蹦床函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trampoline</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (f &amp;&amp; f <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;</span><br><span class="line">    f = f();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">trampoline(sum(<span class="number">1</span>, <span class="number">100000</span>))</span><br><span class="line"><span class="comment">// 100001</span></span><br></pre></td></tr></table></figure>
<h4 id="8-7-6-2-真正实现"><a href="#8-7-6-2-真正实现" class="headerlink" title="8.7.6.2 真正实现"></a>8.7.6.2 真正实现</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tco</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value;</span><br><span class="line">  <span class="keyword">var</span> active = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> accumulated = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">accumulator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    accumulated.push(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">if</span> (!active) &#123;</span><br><span class="line">      active = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">while</span> (accumulated.length) &#123;</span><br><span class="line">        value = f.apply(<span class="keyword">this</span>, accumulated.shift());</span><br><span class="line">      &#125;</span><br><span class="line">      active = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = tco(<span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> sum(x + <span class="number">1</span>, y - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">sum(<span class="number">1</span>, <span class="number">100000</span>)</span><br><span class="line"><span class="comment">// 100001</span></span><br></pre></td></tr></table></figure>
<h2 id="8-8-函数参数的尾逗号"><a href="#8-8-函数参数的尾逗号" class="headerlink" title="8.8 函数参数的尾逗号"></a>8.8 函数参数的尾逗号</h2><p> <strong>说明：</strong>允许函数的最后一个参数有尾逗号<br> <strong>注意：</strong>目前数定义和调用时，都不允许有参数的尾逗号<br> <strong>支持：</strong><code>ES7</code>的一个提案<br> <strong>用途：</strong>在定义函数时，如果参数单独占一行，增加参数时，之前最后一个参数后面要加一个逗号，版本管理系统就会显示，添加逗号的那一行也发生了变动。如果之前最后一个参数后面就有<code>,</code>，就没有这个问题了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clownsEverywhere</span>(<span class="params"></span><br><span class="line">  param1,</span><br><span class="line">  param2,</span><br><span class="line"></span>) </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line">clownsEverywhere(</span><br><span class="line">  <span class="string">'foo'</span>,</span><br><span class="line">  <span class="string">'bar'</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/30/imooc_JavaScript 正则表达式/" itemprop="url">
                  JavaScript 正则表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-30T21:39:18+08:00" content="2016-08-30">
              2016-08-30
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/30/imooc_JavaScript 正则表达式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/30/imooc_JavaScript 正则表达式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>视频地址：</strong><a href="http://www.imooc.com/learn/706" target="_blank" rel="external">http://www.imooc.com/learn/706</a><br><strong>推荐在线练习工具：</strong><a href="http://jsbin.com/xakojudara/edit?js,console" target="_blank" rel="external">http://jsbin.com/xakojudara/edit?js,console</a></p>
<h1 id="1-课程简介"><a href="#1-课程简介" class="headerlink" title="1 课程简介"></a>1 课程简介</h1><p>课程目标</p>
<ul>
<li>了解正则表达式语法</li>
<li>在IDE中使用正则表达式处理规则复杂的字符串查找、替换需求</li>
<li>在 JavaScript 程序设计中使用正则表达式处理字符串</li>
</ul>
<h2 id="1-1-正则表达式简介及工具使用"><a href="#1-1-正则表达式简介及工具使用" class="headerlink" title="1.1 正则表达式简介及工具使用"></a>1.1 正则表达式简介及工具使用</h2><h3 id="1-1-1-什么是正则表达式"><a href="#1-1-1-什么是正则表达式" class="headerlink" title="1.1.1 什么是正则表达式"></a>1.1.1 什么是正则表达式</h3><p><code>Regular Expression</code> 使用单个字符串来描述、匹配一系列符合某个句法规则的字符串。就是按照某种规则去匹配符合条件的字符串。</p>
<h3 id="1-1-2-正则表达式工具－REGEXPER"><a href="#1-1-2-正则表达式工具－REGEXPER" class="headerlink" title="1.1.2 正则表达式工具－REGEXPER"></a>1.1.2 正则表达式工具－REGEXPER</h3><p> <strong>REGEXPER：</strong><a href="https://regexper.com" target="_blank" rel="external">正则表达式在线工具</a>，可以以非常形象的方式展现具体正则表达式的含义。</p>
<p>＃举例：匹配邮箱<br><code>^(a-zA-Z0-9_-)+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$</code></p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471072343598.png" alt="Alt text"></p>
<h1 id="2-认识正则表达式"><a href="#2-认识正则表达式" class="headerlink" title="2 认识正则表达式"></a>2 认识正则表达式</h1><h2 id="2-1-RegExp对象"><a href="#2-1-RegExp对象" class="headerlink" title="2.1 RegExp对象"></a>2.1 RegExp对象</h2><h3 id="2-1-1-基本用法"><a href="#2-1-1-基本用法" class="headerlink" title="2.1.1 基本用法"></a>2.1.1 基本用法</h3><p><code>JavaScript</code>通过内置对象 <code>RegExp</code>支持正则表达式。有两种方法实例化<code>RegExp</code>对象</p>
<ul>
<li><p>字面量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\bis\b/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "He IS a boy.This IS a dog. Where IS she?"</span></span><br><span class="line"><span class="string">'He is a boy.This is a dog. Where is she?'</span>.replace(reg, <span class="string">'IS'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造函数<br>注意：字符串本身能识别类似<code>\b</code>形式的转义字符，为了避免字符串误解，传递给<code>RegExp</code>构造函数的第一个参数中的<code>\</code>都需要转义为<code>\\</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\bis\\b'</span>, <span class="string">'g'</span>);</span><br><span class="line"><span class="comment">// "He IS a boy.This IS a dog. Where IS she?"</span></span><br><span class="line"><span class="string">'He is a boy.This is a dog. Where is she?'</span>.replace(reg, <span class="string">'IS'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-1-2-修饰符"><a href="#2-1-2-修饰符" class="headerlink" title="2.1.2 修饰符"></a>2.1.2 修饰符</h3><table>
<thead>
<tr>
<th>修饰符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>g</td>
<td>global。 全文搜索。默认搜索到第一个匹配停止</td>
</tr>
<tr>
<td>i</td>
<td>ignore case。忽略大小写。默认大小写敏感</td>
</tr>
<tr>
<td>m</td>
<td>multiple lines。 多行搜索，在存在<code>\n</code>的字符串中会影响表达式中<code>^</code>和<code>$</code>的行为。</td>
</tr>
</tbody>
</table>
<h2 id="2-2-元字符"><a href="#2-2-元字符" class="headerlink" title="2.2 元字符"></a>2.2 元字符</h2><p> 说明：正则表达式由两种基本字符类型组成<br>字符类型|说明|举例<br>-|-|-<br>原意文本字符|按照字符本身匹配|abc|<br>元字符|在正则表达式中有特殊含义的非字母字符|<code>. * + ? $ ^ \| \ () {} []</code></p>
<table>
<thead>
<tr>
<th>元字符中的转义字符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>\t</td>
<td>水平制表符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075632133.png" alt="Alt text"></td>
</tr>
<tr>
<td>\v</td>
<td>垂直制表符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075663582.png" alt="Alt text"></td>
</tr>
<tr>
<td>\n</td>
<td>换行符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075688304.png" alt="Alt text"></td>
</tr>
<tr>
<td>\r</td>
<td>回车符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075717069.png" alt="Alt text"></td>
</tr>
<tr>
<td>\0</td>
<td>空字符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075742302.png" alt="Alt text"></td>
</tr>
<tr>
<td>\f</td>
<td>换页符<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075759837.png" alt="Alt text"></td>
</tr>
<tr>
<td>\cX</td>
<td>与X对应的控制字符（ctrl + X）<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471075779742.png" alt="Alt text"></td>
</tr>
</tbody>
</table>
<h2 id="2-3-字符类"><a href="#2-3-字符类" class="headerlink" title="2.3 字符类"></a>2.3 字符类</h2><h3 id="2-3-1-基础"><a href="#2-3-1-基础" class="headerlink" title="2.3.1 基础"></a>2.3.1 基础</h3><p><code>[]</code><br> <strong>说明：</strong>我们可以使用元字符<code>[]</code>来构建一个简单的类。所谓类是指符合某些特性的对象，一个泛指，而不是特指某个字符。</p>
<p><strong>举例</strong><br><code>[abc]</code>，把字符<code>a</code>或<code>b</code>或<code>c</code>归为一类，表达式可以匹配这类的字符。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471076119291.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "X1X2X3d4"</span></span><br><span class="line"><span class="string">'a1b2c3d4'</span>.replace(<span class="regexp">/[abc]/g</span>, <span class="string">'X'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-2-字符类取反"><a href="#2-3-2-字符类取反" class="headerlink" title="2.3.2 字符类取反"></a>2.3.2 字符类取反</h3><p> <strong>说明：</strong>在<code>[]</code>中使用元字符<code>^</code>创建<code>反向类／负向类</code>,意思是不属于某类的内容。</p>
<p><strong>举例</strong><br>表达式<code>[^abc]</code>，表示<em>不是字符a或b或c</em>的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// "aXbXcXXX"</span></span><br><span class="line"><span class="string">'a1b2c3d4'</span>.replace(<span class="regexp">/[^abc]/g</span>, <span class="string">'X'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="2-4-范围类"><a href="#2-4-范围类" class="headerlink" title="2.4 范围类"></a>2.4 范围类</h2><p>正则表达式还提供了<code>范围类</code>。例如，可以使用<code>[a-z]</code>来连接两个字符表示<em>从 a 到 z 的任意字符</em>，这是个闭区间，也就是包涵 a 和 z 本身。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471076736409.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a1b2c3d4Hello'</span>.replace(<span class="regexp">/[a-z]/g</span>, <span class="string">'X'</span>)</span><br><span class="line"><span class="string">"X1X2X3X4HXXXX"</span></span><br></pre></td></tr></table></figure>
<p> 注意：形式为<code>[字符1-字符1]</code>的正则中的<code>-</code>都会被识别为<code>范围类</code>，若真的想使用<code>-</code>本身，要么在<code>[]</code>外部使用，要么类似<code>[字符1-字符2-]</code>，其中最后一个<code>-</code>会本当做原意文本字符。</p>
<h2 id="2-5-预定义类及边界"><a href="#2-5-预定义类及边界" class="headerlink" title="2.5 预定义类及边界"></a>2.5 预定义类及边界</h2><h3 id="2-5-1-预定义类"><a href="#2-5-1-预定义类" class="headerlink" title="2.5.1 预定义类"></a>2.5.1 预定义类</h3><p>正则表达式提供<code>预定义类</code>来匹配常见的字符类<br>字符|等价类|含义<br>-|-|-<br>.|[^\r\n]|除回车符和换行符之外的所有字符<br>\d|[0-9]|数字字符<br>\D|[^0-9]|非数字字符<br>\s|[\t\n\x0B\f\r]|空白符<br>\S|[^\t\n\x\0B\f\r]|非空白符<br>\w|[a-zA-Z_0-9]|单词字符（字母、数字、下划线）<br>\W|[^a-zA-Z_0-9]|非单词字符</p>
<h3 id="2-5-2-边界"><a href="#2-5-2-边界" class="headerlink" title="2.5.2 边界"></a>2.5.2 边界</h3><p>正则表达式还提供了几个常用的边界匹配字符<br>字符|含义<br>-|-<br>^|一行的开始<br>$|一行的结尾<br>\b|单词边界<br>\B|非单词边界</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'@123@abc'</span>.replace(<span class="regexp">/^@./g</span>, <span class="string">'X'</span>)</span><br><span class="line"><span class="string">"X23@abc"</span></span><br></pre></td></tr></table></figure>
<p>注意：m 修饰符将会影响 $ 和 ^ 的行为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var mulStr = '@123\n@456\n@789'</span><br><span class="line">// 使用 m 修饰符：\n 被当做多行的分隔</span><br><span class="line">mulStr.replace(/^@\d/gm, 'X')</span><br><span class="line">"X23</span><br><span class="line">X56</span><br><span class="line">X89"</span><br><span class="line"></span><br><span class="line">// 不使用 m 修饰符：\n 不会被当做多行的分隔</span><br><span class="line">mulStr.replace(/^@\d/g, 'X')</span><br><span class="line">"X23</span><br><span class="line">@456</span><br><span class="line">@789"</span><br></pre></td></tr></table></figure>
<h2 id="2-6-量词"><a href="#2-6-量词" class="headerlink" title="2.6 量词"></a>2.6 量词</h2><table>
<thead>
<tr>
<th>量词</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>?</td>
<td>最多出现一次（0次或1次）</td>
</tr>
<tr>
<td>+</td>
<td>至少出现一次（1次或多次）</td>
</tr>
<tr>
<td>*</td>
<td>出现0次或多次（任意次）</td>
</tr>
<tr>
<td>{n}</td>
<td>出现 n 次</td>
</tr>
<tr>
<td>{n,m}</td>
<td>出现 n 到 m 次</td>
</tr>
<tr>
<td>{n,}</td>
<td>至少出现 n 次</td>
</tr>
</tbody>
</table>
<p><strong>举例</strong><br><code>\d{20}\w\d?\w+\d*\d{3}\w{3,5}\d{3,}</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471090337589.png" alt="Alt text"></p>
<p> 技巧：最多出现 n 次可以这样表示<code>{0, n}</code></p>
<h2 id="2-7-贪婪模式与非贪婪模式"><a href="#2-7-贪婪模式与非贪婪模式" class="headerlink" title="2.7 贪婪模式与非贪婪模式"></a>2.7 贪婪模式与非贪婪模式</h2><table>
<thead>
<tr>
<th>模式</th>
<th>说明</th>
<th>方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>贪婪模式｜尽可能多地匹配字符</td>
<td>默认</td>
</tr>
<tr>
<td>非贪婪模式</td>
<td>尽可能少地匹配字符，也就是说一旦成功匹配就不再继续尝试</td>
<td>在量词后使用<code>?</code>即可</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 贪婪模式</span></span><br><span class="line"><span class="string">'123456789'</span>.match(<span class="regexp">/\d&#123;3,5&#125;/g</span>)</span><br><span class="line"><span class="comment">// ["12345", "6789"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 非贪婪模式</span></span><br><span class="line"><span class="string">'123456789'</span>.match(<span class="regexp">/\d&#123;3,5&#125;?/g</span>)</span><br><span class="line"><span class="comment">// ["123", "456", "789"]</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-分组"><a href="#2-8-分组" class="headerlink" title="2.8 分组"></a>2.8 分组</h2><h3 id="2-8-1-基础"><a href="#2-8-1-基础" class="headerlink" title="2.8.1 基础"></a>2.8.1 基础</h3><p>使用<code>()</code>可以达到分组的功能，使量词作用于分组</p>
<p><strong>例子</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471097284500.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a1b2c3d4'</span>.match(<span class="regexp">/([a-z]\d)&#123;3&#125;/g</span>)</span><br><span class="line"><span class="comment">// ["a1b2c3"]</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-2-或"><a href="#2-8-2-或" class="headerlink" title="2.8.2 或"></a>2.8.2 或</h3><p>使用<code>|</code>可以达到或的效果</p>
<p><strong>例子</strong><br><code>/Byr(on|Ca)sper/g</code>：<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471097817285.png" alt="Alt text"></p>
<p><code>/Byron|Casper/g</code>：<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471097772183.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有分组</span></span><br><span class="line"><span class="string">'ByronsperByrCasper'</span>.match(<span class="regexp">/Byr(on|Ca)sper/g</span>)</span><br><span class="line"><span class="comment">// ["Byronsper", "ByrCasper"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无分组</span></span><br><span class="line"><span class="string">'ByronsperByrCasper'</span>.match(<span class="regexp">/Byron|Casper/g</span>)</span><br><span class="line"><span class="comment">// ["Byron", "Casper"]</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-3-反向引用"><a href="#2-8-3-反向引用" class="headerlink" title="2.8.3 反向引用"></a>2.8.3 反向引用</h3><p><strong>例子</strong><br>2016-8-13 =&gt; 8/13/2016</p>
<p><code>/(\d+)-(\d+)-(\d+)/g</code>：<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471098062069.png" alt="Alt text"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'2016-8-13'</span>.replace(<span class="regexp">/(\d+)-(\d+)-(\d+)/g</span>, <span class="string">'$2/$3/$1'</span>)</span><br><span class="line"><span class="comment">// "8/13/2016"</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-4-忽略分组"><a href="#2-8-4-忽略分组" class="headerlink" title="2.8.4 忽略分组"></a>2.8.4 忽略分组</h3><p>不希望捕获某些分组，只需要在分组內加上<code>?:</code>就可以<br><code>(?:Byron).(ok)</code>：<img src="http://o6ul1xz4z.bkt.clouddn.com/img/1471098192119.png" alt="Alt text"></p>
<h2 id="2-9-前瞻"><a href="#2-9-前瞻" class="headerlink" title="2.9 前瞻"></a>2.9 前瞻</h2><p> <strong>说明：</strong>正则表达式从文本头部向尾部解析，文本尾部方向，称为<code>前</code>。<code>前瞻</code>就是在正则表达式匹配到规则的时候，向前检查是否符合断言，<code>后顾/后瞻</code>方向和<code>前瞻</code>相反。符合和不符合特定断言称为<code>肯定/正向</code>匹配和<code>否定/负向</code>匹配。<br> <strong>注意</strong></p>
<ul>
<li><code>JS</code>不支持<code>后瞻/后顾</code></li>
<li><code>断言</code>部分的正则表达式只是用来断言，匹配的结果不会包括<code>断言</code>匹配到的部分</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>正则</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>正向前瞻</td>
<td>exp(?=assert)</td>
<td>字符串匹配到<code>exp</code>部分还不够，后面的部分必需同时配<code>assert</code></td>
</tr>
<tr>
<td>负向前瞻</td>
<td>exp(?!assert)</td>
<td>字符串匹配到<code>exp</code>部分还不够，后面的部分必需同时不能匹配配<code>assert</code></td>
</tr>
<tr>
<td>正向后顾（JS不支持）</td>
<td>exp(?=assert)</td>
<td></td>
</tr>
<tr>
<td>负向后顾（JS不支持）</td>
<td>exp(?!assert)</td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a2*34v8'</span>.match(<span class="regexp">/\w(?=\d)/g</span>)</span><br><span class="line"><span class="comment">// ["a", "3", "v"]</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-对象属性"><a href="#2-10-对象属性" class="headerlink" title="2.10 对象属性"></a>2.10 对象属性</h2><p><code>RegExp</code>对象常用属性<br>属性|说明<br>-|-<br>global|是否全文搜索，默认<code>false</code><br>ignoreCase|是否大小写敏感，默认使<code>false</code><br>multiline|多行搜索，默认值是<code>false</code><br>laseIndex|是当前表达式匹配内容的最后一个字符的下一个位置，也就是下一次搜索开始的位置，在没有使用<code>g</code>修饰符时，该值始终为0<br>source|正则表达式的文本字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\bis\b/gi</span></span><br><span class="line"><span class="string">'I do because I love.This is fun. IS NOT IT?'</span>.match(reg)</span><br><span class="line"><span class="comment">// ["is", "IS"]</span></span><br><span class="line"></span><br><span class="line">reg.global</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">reg.ignoreCase</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">reg.multiline</span><br><span class="line"><span class="comment">// false</span></span><br><span class="line">reg.lastIndex</span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line">reg.source</span><br><span class="line"><span class="comment">// "\bis\b"</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-test-和-exec方法"><a href="#2-11-test-和-exec方法" class="headerlink" title="2.11 test 和 exec方法"></a>2.11 test 和 exec方法</h2><h3 id="2-11-1-RegExp-prototype-test-str"><a href="#2-11-1-RegExp-prototype-test-str" class="headerlink" title="2.11.1 RegExp.prototype.test(str)"></a>2.11.1 RegExp.prototype.test(str)</h3><p> <strong>功能：</strong>用于测试字符串参数中是否存在匹配正则表达式模式的字符串<br> <strong>返回值：</strong>存在返回 true, 不存在返回 false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg1 = <span class="regexp">/\w/</span></span><br><span class="line"><span class="keyword">const</span> reg2 = <span class="regexp">/\w/g</span></span><br><span class="line"></span><br><span class="line">reg1.test(<span class="string">'abc'</span>)</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加 g 修饰符会干扰 test 函数，因为每次匹配的起点（lastIndex）会不断向后移动，最后一次匹配返回的结果一定是是false</span></span><br><span class="line"><span class="keyword">while</span>(reg2.test(<span class="string">'abc'</span>)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(reg2.lastIndex)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-RegExp-prototype-exec-str"><a href="#2-11-2-RegExp-prototype-exec-str" class="headerlink" title="2.11.2 RegExp.prototype.exec(str)"></a>2.11.2 RegExp.prototype.exec(str)</h3><p><strong>非全局调用（不使用<code>g</code>修饰符）</strong><br> <strong>返回值：</strong>调用非全局的 <code>RegExp</code>对象的 <code>exec</code>时，返回数组</p>
<ul>
<li>第1个元素：与正则表达式相匹配的文本</li>
<li>第2个元素：与<code>RegExpObject</code>的第1个子表达式相匹配的文本（如果有的话）</li>
<li>第3个元素：与<code>RegExpObject</code>的第2个子表达式相匹配的文本（如果有的话）<br>…</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d(\w)(\w)\d/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = reg.exec(<span class="string">'1az2bb3cv4d5eee'</span>)</span><br><span class="line"></span><br><span class="line">result<span class="comment">// ["1az2", "a", "z"]</span></span><br></pre></td></tr></table></figure>
<p><strong>全局调用（使用<code>g</code>修饰符）</strong><br> <strong>功能：</strong>使用正则表达式模式对字符串执行搜索，并将更新全局 (使用g)<code>RegExp</code>对象的属性以反应匹配结果<br> <strong>返回值：</strong>如果没有匹配的文本则返回<code>null</code>，否则返回一个结果数组：</p>
<ul>
<li>index：声明匹配文本的第一个字符的位置</li>
<li>input：存放被检索的字符串</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/\d(\w)(\w)\d/g</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result, str = <span class="string">'1az2bb3cv4d5eee'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(result = reg.exec(str)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(reg.lastIndex)</span><br><span class="line">  <span class="built_in">console</span>.log(result.index)</span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6</span></span><br><span class="line"><span class="comment">// ["3cv4", "c", "v"]</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ["1az2", "a", "z"]</span></span><br><span class="line"><span class="comment">// 10</span></span><br><span class="line"><span class="comment">// 6</span></span><br><span class="line"><span class="comment">// ["3cv4", "c", "v"]</span></span><br></pre></td></tr></table></figure>
<h2 id="2-12-字符串对象方法"><a href="#2-12-字符串对象方法" class="headerlink" title="2.12 字符串对象方法"></a>2.12 字符串对象方法</h2><h3 id="2-12-1-String-prototype-search"><a href="#2-12-1-String-prototype-search" class="headerlink" title="2.12.1 String.prototype.search"></a>2.12.1 String.prototype.search</h3><p><strong>功能：</strong>用于检索字符串中指定的子字符串，或检索与正则表达式相匹配的子字符串<br><strong>参数（1）：</strong><code>Regexp</code>对象（如果是其它类型，将会被当做正则表达式字符串处理）<br><strong>返回值：</strong>返回第一个匹配到的结果的 index， 查找不到返回 -1<br><strong>注意：</strong>该方法将忽略修饰符<code>g</code>，不执行全文匹配，并且总是从字符串的开始进行检索</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result, str = <span class="string">'1az2bb3cv4d51eee'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正则表达式</span></span><br><span class="line">str.search(<span class="regexp">/v4/</span>)<span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串</span></span><br><span class="line">str.search(<span class="string">'1'</span>)<span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字，会被转为字符串</span></span><br><span class="line">str.search(<span class="number">1</span>)<span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-2-String-prototype-match"><a href="#2-12-2-String-prototype-match" class="headerlink" title="2.12.2 String.prototype.match"></a>2.12.2 String.prototype.match</h3><p> <strong>功能：</strong>将检索字符串，以找到一个或多个与 regexp 匹配的文本<br> <strong>参数（1）：</strong><code>RegExp</code>对象（如果是其它类型，将会被当做正则表达式字符串处理，内部仍旧会处理为一个 <code>RegExp</code>对象）<br> <strong>返回值：</strong>如果没有找到任何匹配的文本，将返回 <code>null</code>；否则将返回一个数组，其中存放了与它找到的匹配文本有关的信息</p>
<p>＃非全局调用<br>返回数组的元素下标|说明<br>-|-<br>0|匹配的文本<br>其它|与正则表达式的子表达式匹配的文本</p>
<table>
<thead>
<tr>
<th>返回数组的对象属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>index</td>
<td>声明匹配文本的起始字符在字符串的位置</td>
</tr>
<tr>
<td>input</td>
<td>声明对 stringObject 的引用</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'1az2bb3cv4d51eee6f7'</span>.match(<span class="regexp">/\d(\w)\d/</span>)<span class="comment">// ["4d5", "d"]</span></span><br></pre></td></tr></table></figure>
<p>＃全局调用<br>如果 <code>RegExp</code>具有标志<code>g</code>则 <code>match</code>方法将执行全文搜索，找到字符串中的所有匹配子字符串。返回的数组没有 <code>index</code> 属性或<code>input</code>属性<br>返回数组的元素下标|说明<br>-|-<br>all|所有匹配的子串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'1az2bb3cv4d51eee6f7'</span>.match(<span class="regexp">/\d(\w)\d/g</span>)<span class="comment">// ["4d5", "6f7"]</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 如果<code>RegExp</code>没有标志<code>g</code>，那么<code>match</code>方法只能在字符串中执行一次匹配</p>
<h3 id="2-12-3-String-prototype-split"><a href="#2-12-3-String-prototype-split" class="headerlink" title="2.12.3 String.prototype.split"></a>2.12.3 String.prototype.split</h3><p> <strong>功能：</strong>我们经常使用<code>split</code>方法把字符串分割为字符数组，在一些复杂的分割情况下我们可以使用正则表达式解决<br> <strong>参数（1）：</strong><code>RegExp</code>对象（如果是其它类型，将会被当做正则表达式字符串处理，内部仍旧会处理为一个 <code>RegExp</code>对象）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'a,b,c,d'</span>.split(<span class="string">','</span>)<span class="comment">// ["a", "b", "c", "d"]</span></span><br><span class="line"><span class="string">'a1b2c3d'</span>.split(<span class="regexp">/\d/</span>)<span class="comment">// ["a", "b", "c", "d"]</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-4-String-prototype-replace"><a href="#2-12-4-String-prototype-replace" class="headerlink" title="2.12.4 String.prototype.replace"></a>2.12.4 String.prototype.replace</h3><p> <strong>功能：</strong>将匹配到的字符串中的字串替换为指定字符串并返回<br> <strong>参数（2）：</strong></p>
<ul>
<li>String.prototype.replace(str, replaceStr)</li>
<li>String.prototype.replace(reg, replaceStr)</li>
<li>String.prototype.replace(reg, <code>function</code>)</li>
</ul>
<p><code>function</code>会在每次匹配替换的时候调用，有4个参数<br>参数|说明<br>-|-<br>1|匹配字符串<br>2|正则表达式分组内容，没有分组则没有该参数<br>3|匹配项在字符串中的 index<br>4|原字符串<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* str, replaceStr */</span></span><br><span class="line"><span class="string">'a1b1c1d'</span>.replace(<span class="string">'1'</span>, <span class="string">'2'</span>)<span class="comment">// "a2b1c1d"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* reg, replaceStr */</span></span><br><span class="line"><span class="string">'a1b1c1d'</span>.replace(<span class="regexp">/1/g</span>, <span class="string">'2'</span>)<span class="comment">// "a2b2c2d"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* reg, function */</span></span><br><span class="line"><span class="comment">// 不带分组</span></span><br><span class="line"><span class="string">'a1b1c1d'</span>.replace(<span class="regexp">/\d/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match, index, origin</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">parseInt</span>(match) + <span class="number">1</span></span><br><span class="line">&#125;)<span class="comment">// "a2b2c2d"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带分组</span></span><br><span class="line"><span class="string">'a1b2c3d4e5'</span>.replace(<span class="regexp">/(\d)(\w)(\d)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match, group1, group2, group3, index, origin</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> group1 + group3</span><br><span class="line">&#125;)<span class="comment">// "a12c34e5"</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/24/Blog_webpack入坑之旅/" itemprop="url">
                  webpack入坑之旅
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-24T11:29:16+08:00" content="2016-08-24">
              2016-08-24
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/24/Blog_webpack入坑之旅/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/24/Blog_webpack入坑之旅/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>博客链接：</strong><a href="http://guowenfh.github.io/2016/03/24/vue-webpack-01-base/" target="_blank" rel="external">http://guowenfh.github.io/2016/03/24/vue-webpack-01-base/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm i webpack -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目初始化</span></span><br><span class="line">$ mkdir vue_by_webpack_blog &amp;&amp; <span class="built_in">cd</span> vue_by_webpack_blog</span><br><span class="line">$ npm init</span><br><span class="line">$ npm i webpack -D <span class="comment"># --save-dev</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><em>目录</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure></p>
<h1 id="1-最简单的开始"><a href="#1-最简单的开始" class="headerlink" title="1 最简单的开始"></a>1 最简单的开始</h1><p>不使用 <code>webpack</code> 配置文件</p>
<p><em>目录</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment">#1</span></span><br><span class="line">├── first.js <span class="comment">#2</span></span><br><span class="line">├── index.html <span class="comment">#3</span></span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** entry.js **/</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'app'</span>).innerHTML = <span class="string">"第一个成功打包的程序"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./first.js'</span>);</span><br></pre></td></tr></table></figure></p>
<p><em># 2 first.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h2 = <span class="built_in">document</span>.createElement(<span class="string">'h2'</span>);</span><br><span class="line">h2.innerHTML = <span class="string">'不是吧，那么快就第二个打包程序了'</span>;</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(h2);</span><br></pre></td></tr></table></figure></p>
<p><em>#3 index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入 webpack 生成的文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ webpack entry.js bundle.js <span class="comment"># 打包</span></span><br><span class="line"></span><br><span class="line">Hash: bd78725bb04725a3c1f9</span><br><span class="line">Version: webpack 1.13.1</span><br><span class="line">Time: 88ms</span><br><span class="line">    Asset     Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  1.67 kB       0  [emitted]  main</span><br><span class="line">   [0] ./entry.js 97 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./first.js 104 bytes &#123;0&#125; [built]</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1468494421937.png" alt="Alt text"></p>
<h1 id="2-loader"><a href="#2-loader" class="headerlink" title="2 loader"></a>2 loader</h1><h2 id="2-1-处理css"><a href="#2-1-处理css" class="headerlink" title="2.1 处理css"></a>2.1 处理css</h2><p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment"># 1</span></span><br><span class="line">├── first.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">└── style.css <span class="comment"># 2</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i css-loader -D <span class="comment"># 读取 css 的 loader</span></span><br><span class="line">$ npm i style-loader -D <span class="comment"># 将 css 插入页面的 loader</span></span><br></pre></td></tr></table></figure>
<hr>
<p><em># 1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">require(<span class="string">'!style!css!./style.css'</span>);<span class="comment">// 需要 !style!css! 前缀</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 style.css</em><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">bady</span> &#123;</span><br><span class="line">	<span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack entry.js bundle.js</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1468494451555.png" alt="Alt text"></p>
<h2 id="2-2-根据扩展名自动绑定-loader"><a href="#2-2-根据扩展名自动绑定-loader" class="headerlink" title="2.2 根据扩展名自动绑定 loader"></a>2.2 根据扩展名自动绑定 loader</h2><p><code>entry.js</code>中的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'!style!css!./style.css'</span>)</span><br></pre></td></tr></table></figure></p>
<p>可以省略前缀<code>!style!css!</code>，改为:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./style.css'</span>)</span><br></pre></td></tr></table></figure></p>
<p>但相应的打包命令就变为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack ./entry.js bundle.js --module-bind <span class="string">"css=style\!css"</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-webpack-config"><a href="#3-webpack-config" class="headerlink" title="3 webpack.config"></a>3 webpack.config</h1><p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── first.js</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── style.css</span><br><span class="line">└── webpack.config.js <span class="comment"># 1</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);<span class="comment">// 必须引入</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 指入口文件的配置项，它是一个数组的原因是webpack允许多个入口点。 当然如果你只有一个入口的话，也可以直接使用双引号"./entry.js"</span><br><span class="line">	 * @type &#123;Array&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	entry: [</span><br><span class="line">		<span class="string">"./entry.js"</span></span><br><span class="line">	],</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 置打包结果，path定义了输出的文件夹，filename则定义了打包结果文件的名称</span><br><span class="line">	 * @type &#123;Object&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	output: &#123;</span><br><span class="line">		path: __dirname,</span><br><span class="line">		filename: <span class="string">'bundle.js'</span></span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 定义了对模块的处理逻辑，这里可以用loaders定义了一系列的加载器，以及一些正则。当需要加载的文件匹配test的正则时，就会调用后面的loader对文件进行处理</span><br><span class="line">	 * @type &#123;Object&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	<span class="built_in">module</span>: &#123;</span><br><span class="line">		loaders: [</span><br><span class="line">			<span class="comment">/* 针对所有的 css 后缀的文件，使用 css-loader 读取，并使用 style-loader 插入到页面 */</span></span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">				loader: <span class="string">'style!css'</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 * 插件可以完成更多loader不能完成的功能</span><br><span class="line">	 * @type &#123;Array&#125;</span><br><span class="line">	 */</span></span><br><span class="line">	plugins: [</span><br><span class="line">		<span class="keyword">new</span> Webpack.BannerPlugin(<span class="string">"这里是打包文件头部注释！"</span>)</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ webpack <span class="comment"># 会自动在当前目录中查找webpack.config.js的配置文件</span></span><br><span class="line">Hash: 4bd595f27c8112d7d21f</span><br><span class="line">Version: webpack 1.13.1</span><br><span class="line">Time: 2059ms</span><br><span class="line">    Asset   Size  Chunks             Chunk Names</span><br><span class="line">bundle.js  12 kB       0  [emitted]  main</span><br><span class="line">   [0] multi main 28 bytes &#123;0&#125; [built]</span><br><span class="line">   [1] ./entry.js 133 bytes &#123;0&#125; [built]</span><br><span class="line">   [2] ./first.js 104 bytes &#123;0&#125; [built]</span><br><span class="line">    + 4 hidden modules</span><br></pre></td></tr></table></figure>
<h1 id="4-高级"><a href="#4-高级" class="headerlink" title="4 高级"></a>4 高级</h1><h2 id="4-1-图片"><a href="#4-1-图片" class="headerlink" title="4.1 图片"></a>4.1 图片</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install file-loader -D</span><br><span class="line">$ npm install url-loader -D <span class="comment"># 用来处理图片</span></span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bundle.js</span><br><span class="line">├── entry.js</span><br><span class="line">├── first.js</span><br><span class="line">├── img</span><br><span class="line">│   ├── big.png</span><br><span class="line">│   └── small.png</span><br><span class="line">├── index.html <span class="comment"># 1</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── selectarea.mov</span><br><span class="line">├── style.css <span class="comment"># 2</span></span><br><span class="line">└── webpack.config.js <span class="comment"># 3</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 index.html</em><br><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">...</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"img/small.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"big"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"small"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">...</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 style.css</em><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="selector-id">#big</span> &#123;</span><br><span class="line">	<span class="attribute">background-image</span>: <span class="built_in">url</span>(img/big.png);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#small</span> &#123;</span><br><span class="line">	<span class="attribute">background-image</span>: <span class="built_in">url</span>(img/small.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>#3 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);<span class="comment">// 必须引入</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	module: &#123;</span><br><span class="line">		loaders: [</span><br><span class="line">			...</span><br><span class="line">			<span class="comment">/* 图片处理 */</span></span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">				loader: <span class="string">'url-loader?limit=8192'</span><span class="comment">// 设置limit，小于8K的图片图片转化成了base64的编码，而大于8k的图片则不会转化</span></span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack</span><br></pre></td></tr></table></figure>
<h2 id="4-2-webpack命令选项"><a href="#4-2-webpack命令选项" class="headerlink" title="4.2 webpack命令选项"></a>4.2 webpack命令选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">webpack <span class="comment">#最基本的启动webpack命令</span></span><br><span class="line">webpack -w <span class="comment">#提供watch方法，实时进行打包更新</span></span><br><span class="line">webpack -p <span class="comment">#对打包后的文件进行压缩</span></span><br><span class="line">webpack <span class="_">-d</span> <span class="comment">#提供SourceMaps，方便调试</span></span><br><span class="line">webpack --colors <span class="comment">#输出结果带彩色，比如：会用红色显示耗时较长的步骤</span></span><br><span class="line">webpack --profile <span class="comment">#输出性能数据，可以看到每一步的耗时</span></span><br><span class="line">webpack --display-modules <span class="comment">#默认情况下 node_modules 下的模块会被隐藏，加上这个参数可以显示这些被隐藏的模块</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-1-watch-热加载"><a href="#4-2-1-watch-热加载" class="headerlink" title="4..2.1 watch(热加载)"></a>4..2.1 watch(热加载)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack --watch <span class="comment"># webpack -w</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-2-liveload-自动刷新-vue"><a href="#4-2-2-liveload-自动刷新-vue" class="headerlink" title="4.2.2 liveload(自动刷新) + vue"></a>4.2.2 liveload(自动刷新) + vue</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># liveload</span></span><br><span class="line">$ npm i webpack-dev-server -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># vue</span></span><br><span class="line">$ npm i vue -S</span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── bundle.js</span><br><span class="line">├── entry.js <span class="comment"># 1</span></span><br><span class="line">├── first.js</span><br><span class="line">├── img</span><br><span class="line">├── index.html <span class="comment"># 2</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── selectarea.mov</span><br><span class="line">├── style.css</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em># 1 entry.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'./first.js'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'!style!css!./style.css'</span>);</span><br><span class="line"><span class="keyword">var</span> Vue = <span class="built_in">require</span>(<span class="string">'vue'</span>);</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	el: <span class="string">'body'</span>,</span><br><span class="line">	data: &#123;</span><br><span class="line">		message: <span class="string">'Hello Vue.js'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em># 2 index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">	&#123;&#123; message &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack-dev-server <span class="comment"># 实时预览：http://localhost:8080/webpack-dev-server/</span></span><br></pre></td></tr></table></figure>
<h1 id="5-加载vue单文件组织"><a href="#5-加载vue单文件组织" class="headerlink" title="5 加载vue单文件组织"></a>5 加载vue单文件组织</h1><p><strong>初始目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── index.html</span><br><span class="line">├── src</span><br><span class="line">│   ├── components <span class="comment"># 组件</span></span><br><span class="line">│   └── main.js <span class="comment"># 入口</span></span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>初始化依赖</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># package.json</span></span><br><span class="line">$ npm init</span><br><span class="line"></span><br><span class="line"><span class="comment"># vue</span></span><br><span class="line">$ npm i vue -S</span><br><span class="line"></span><br><span class="line"><span class="comment"># webpack</span></span><br><span class="line">$ npm i webpack -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># babel</span></span><br><span class="line">$ npm i babel -D <span class="comment"># es6</span></span><br><span class="line">$ npm i babel-core -D</span><br><span class="line">$ npm i babel-plugin-transform-runtime -D</span><br><span class="line">$ npm i babel-preset-es2015 -D <span class="comment"># babel</span></span><br><span class="line">$ npm i babel-runtime -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># webpack loader</span></span><br><span class="line">$ npm i autoprefixer-loader -D <span class="comment"># css 浏览器前缀</span></span><br><span class="line">$ npm i babel-loader -D</span><br><span class="line">$ npm i css-loader -D</span><br><span class="line">$ npm i file-loader -D</span><br><span class="line">$ npm i html-loader -D</span><br><span class="line">$ npm i node-sass -D</span><br><span class="line">$ npm i sass-loader -D</span><br><span class="line">$ npm i style-loader -D</span><br><span class="line">$ npm i url-loader -D</span><br><span class="line">$ npm i vue-html-loader -D</span><br><span class="line">$ npm i vue-loader -D</span><br><span class="line">$ npm i vue-style-loader -D</span><br><span class="line">$ npm i vue-hot-reload-api -D</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>完成后目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├── index.html <span class="comment"># 1</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── npm-debug.log</span><br><span class="line">├── package.json <span class="comment"># 2</span></span><br><span class="line">├── src</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   └── app.vue <span class="comment"># 3</span></span><br><span class="line">│   └── main.js <span class="comment"># 4</span></span><br><span class="line">└── webpack.config.js <span class="comment"># 5</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p><em>#1 index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="selector-id">#app</span> &#123;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">800px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 package.json</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"vue_by_webpack_blog_spa"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"study vue"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"webpack.config.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"webpack-dev-server --inline"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"mengqingshen"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"vue"</span>: <span class="string">"^1.0.26"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"autoprefixer-loader"</span>: <span class="string">"^3.2.0"</span>,</span><br><span class="line">    <span class="string">"babel"</span>: <span class="string">"^6.5.2"</span>,</span><br><span class="line">    <span class="string">"babel-core"</span>: <span class="string">"^6.10.4"</span>,</span><br><span class="line">    <span class="string">"babel-loader"</span>: <span class="string">"^6.2.4"</span>,</span><br><span class="line">    <span class="string">"babel-plugin-transform-runtime"</span>: <span class="string">"^6.9.0"</span>,</span><br><span class="line">    <span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.9.0"</span>,</span><br><span class="line">    <span class="string">"babel-runtime"</span>: <span class="string">"^6.9.2"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>: <span class="string">"^0.23.1"</span>,</span><br><span class="line">    <span class="string">"file-loader"</span>: <span class="string">"^0.9.0"</span>,</span><br><span class="line">    <span class="string">"html-loader"</span>: <span class="string">"^0.4.3"</span>,</span><br><span class="line">    <span class="string">"node-sass"</span>: <span class="string">"^3.8.0"</span>,</span><br><span class="line">    <span class="string">"sass-loader"</span>: <span class="string">"^4.0.0"</span>,</span><br><span class="line">    <span class="string">"style-loader"</span>: <span class="string">"^0.13.1"</span>,</span><br><span class="line">    <span class="string">"url-loader"</span>: <span class="string">"^0.5.7"</span>,</span><br><span class="line">    <span class="string">"vue-hot-reload-api"</span>: <span class="string">"^2.0.5"</span>,</span><br><span class="line">    <span class="string">"vue-html-loader"</span>: <span class="string">"^1.2.3"</span>,</span><br><span class="line">    <span class="string">"vue-loader"</span>: <span class="string">"^8.5.3"</span>,</span><br><span class="line">    <span class="string">"vue-style-loader"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^1.13.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>#3 app.vue</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="comment">/* es6 */</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        el:<span class="string">"#app"</span>,</span><br><span class="line">         <span class="comment">/* data:function()&#123;&#125;，下面是es6写法 */</span></span><br><span class="line">         data () &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                name:<span class="string">"laputa"</span>,</span><br><span class="line">                age:<span class="string">"2q1"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"sass"</span>&gt;</span><span class="undefined"></span><br><span class="line">    /* 一定要加 lang 不然无法编译 */</span><br><span class="line">    /*测试一下对sass的编译*/</span><br><span class="line">    $qwe:#098;</span><br><span class="line">    body&#123;</span><br><span class="line">        background-color: $qwe;</span><br><span class="line">        h1&#123;</span><br><span class="line">            background-color: #eee;</span><br><span class="line">            color: red;</span><br><span class="line">            transform: translate(10%, 10%);/*测试自动添加前缀*/</span><br><span class="line">        &#125;</span><br><span class="line">        h1:hover&#123;</span><br><span class="line">            height:100px;</span><br><span class="line">        &#125;</span><br><span class="line">        h2&#123;</span><br><span class="line">            background-color: #999;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#4 main.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//es6语法，其实不用写完，会自动查找。可以直接写import Vue from "vue";</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"../node_modules/vue/dist/vue.min.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//引入我们编写的测试用vue文件。</span></span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">'./components/app'</span>;</span><br><span class="line">Vue.config.debug = <span class="literal">true</span>;<span class="comment">//开启错误提示</span></span><br><span class="line"><span class="keyword">new</span> Vue(app);</span><br></pre></td></tr></table></figure></p>
<p><em>#5 webpack.config.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * NodeJS中的Path对象，用于处理目录的对象，提高开发效率。</span><br><span class="line"> * @type &#123;Object&#125;</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 模块导入 */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 入口文件地址，不需要写完，会自动查找</span><br><span class="line">     * @type &#123;String|Array&#125;</span><br><span class="line">     */</span></span><br><span class="line">    entry: <span class="string">'./src/main'</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 输出</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),<span class="comment">// 文件地址，使用绝对路径形式</span></span><br><span class="line">        filename: <span class="string">'[name].js'</span>,<span class="comment">// [name]这里是 webpack 提供的根据入口文件自动生成的名字</span></span><br><span class="line">        publicPath: <span class="string">'/dist/'</span><span class="comment">// 公共文件生成的地址</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 服务器配置相关，自动刷新!</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">        hot: <span class="literal">false</span>,<span class="comment">// 全局刷新</span></span><br><span class="line">        inline: <span class="literal">true</span>,</span><br><span class="line">        progress: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 加载器</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">            <span class="comment">/* 解析.vue文件 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.vue$/</span>, loader: <span class="string">'vue'</span> &#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 转化ES6的语法 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.js$/</span>, loader: <span class="string">'babel'</span>, exclude: <span class="regexp">/node_modules/</span> &#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* 编译css并自动添加css前缀 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.css$/</span>, loader: <span class="string">'style!css!autoprefixer'</span>&#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* .scss 文件想要编译，scss就需要这些东西！来编译处理 </span><br><span class="line">            install css-loader style-loader sass-loader node-sass --save-dev */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.scss$/</span>, loader: <span class="string">'style!css!sass?sourceMap'</span>&#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 图片转化，小于8K自动转化为base64的编码 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.(png|jpg|gif)$/</span>, loader: <span class="string">'url-loader?limit=8192'</span>&#125;,</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/* html模板编译 */</span></span><br><span class="line">            &#123; test: <span class="regexp">/\.(html|tpl)$/</span>, loader: <span class="string">'html-loader'</span> &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * .vue的配置。需要单独出来配置，其实没什么必要--因为我删了也没保错，不过这里就留这把，因为官网文档里是可以有单独的配置的。</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    vue: &#123;</span><br><span class="line">        loaders: &#123;</span><br><span class="line">            css: <span class="string">'style!css!autoprefixer'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 转化成es5的语法</span><br><span class="line">     * @type &#123;Object&#125;</span><br><span class="line">     */</span></span><br><span class="line">    babel: &#123;</span><br><span class="line">        presets: [<span class="string">'es2015'</span>],</span><br><span class="line">        plugins: [<span class="string">'transform-runtime'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">/* require时省略的扩展名，如：require('module') 不需要module.js */</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.vue'</span>],</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 别名，可以直接使用别名来代表设定的路径以及其他 */</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">            filter: path.join(__dirname, <span class="string">'./src/filters'</span>),</span><br><span class="line">            components: path.join(__dirname, <span class="string">'./src/components'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 开启source-map，webpack有多种source-map，在官网文档可以查到 */</span></span><br><span class="line">    devtool: <span class="string">'eval-source-map'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://localhost:8080/</span></span><br><span class="line">$ npm start</span><br></pre></td></tr></table></figure>
<h1 id="6-vue组件"><a href="#6-vue组件" class="headerlink" title="6 vue组件"></a>6 vue组件</h1><h1 id="7-vue-router"><a href="#7-vue-router" class="headerlink" title="7 vue-router"></a>7 vue-router</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i vue-loader -D</span><br></pre></td></tr></table></figure>
<p><strong>目录</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   └── main.js</span><br><span class="line">├── index.html<span class="comment"># 1 页面入口</span></span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── components</span><br><span class="line">│   │   ├── app.vue <span class="comment"># 2 组件1，嵌套了组件2</span></span><br><span class="line">│   │   ├── hello.vue <span class="comment"># 3 组件2</span></span><br><span class="line">│   │   └── list.vue <span class="comment"># 4 组件3</span></span><br><span class="line">│   └── main.js <span class="comment"># 5 实例化 vue 组件；初始化路由</span></span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure></p>
<hr>
<p><em># 1 index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">        *, *<span class="selector-pseudo">:beofre</span>, *<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">            <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">body</span>, <span class="selector-tag">html</span> &#123;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">overflow</span>: hidden;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-id">#app</span> &#123;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">800px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 路由视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dist/main.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#2 app.vue</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">'./hello.vue'</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        data () &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                name: <span class="string">'laputa'</span>,</span><br><span class="line">                age: <span class="string">'26'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            golist () &#123;</span><br><span class="line">                <span class="keyword">this</span>.$route.router.go(&#123;name: <span class="string">'list'</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        components: &#123;</span><br><span class="line">            hello</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>姓名：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>年龄：&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"overflow: hidden;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"golist"</span>&gt;</span>$toute.router.go查看<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'list'&#125;"</span>&gt;</span>v-link查看列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'index'&#125;"</span>&gt;</span>回去主页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-link</span>=<span class="string">"&#123;name: 'hello'&#125;"</span>&gt;</span>嵌套的路由<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 嵌套其它 vue 组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hello</span>&gt;</span><span class="tag">&lt;/<span class="name">hello</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 嵌套路由显示视图 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"sass"</span>&gt;</span><span class="undefined"></span><br><span class="line">    $qwe:pink;</span><br><span class="line">    body &#123;</span><br><span class="line">        background-color: $qwe;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    h1 &#123;</span><br><span class="line">        background-color: blue;</span><br><span class="line">        color: red;</span><br><span class="line">    &#125;</span><br><span class="line">    h2 &#123;</span><br><span class="line">        background-color: purple;</span><br><span class="line">    &#125;</span><br><span class="line">    a &#123;</span><br><span class="line">        display: block;</span><br><span class="line">        font-size: 16px;</span><br><span class="line">    &#125;</span><br><span class="line">    button &#123;</span><br><span class="line">        float: left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em># 3 组件2</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">        data () &#123;</span><br><span class="line">           <span class="keyword">return</span> &#123;</span><br><span class="line">                hello:<span class="string">"这里是嵌套路由！！！1"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;hello&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="css"></span><br><span class="line">    <span class="selector-tag">div</span>&#123;</span><br><span class="line">        <span class="attribute">text-shadow</span>: <span class="number">1px</span> <span class="number">1px</span> <span class="number">10px</span> <span class="number">#000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#4 组件3</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">	<span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">		data () &#123;</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">				peoples: [&#123;</span><br><span class="line">					name: <span class="string">'小红'</span>,</span><br><span class="line">					age: <span class="number">20</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'张三'</span>,</span><br><span class="line">					age: <span class="number">12</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'三五'</span>,</span><br><span class="line">					age: <span class="number">78</span></span><br><span class="line">				&#125;, &#123;</span><br><span class="line">					name: <span class="string">'阿文'</span>,</span><br><span class="line">					age: <span class="number">22</span></span><br><span class="line">				&#125;,</span><br><span class="line">				&#123;</span><br><span class="line">					name: <span class="string">'李六'</span>,</span><br><span class="line">					age: <span class="number">87</span></span><br><span class="line">				&#125;]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"person in peoples"</span>&gt;</span></span><br><span class="line">			&#123;&#123;person.name&#125;&#125;: &#123;&#123;person.age&#125;&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">	<span class="selector-tag">li</span> &#123;</span><br><span class="line">		<span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">		<span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">		<span class="attribute">list-style</span>: none;</span><br><span class="line">	&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>#5 main.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//es6语法，其实不用写完，会自动查找。可以直接写import Vue from "vue";</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引入第三方库 */</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'../node_modules/vue/dist/vue.min.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 引入自定义的 vue 组件 */</span></span><br><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">'./components/app.vue'</span>;</span><br><span class="line"><span class="keyword">import</span> list <span class="keyword">from</span> <span class="string">'./components/list'</span>;</span><br><span class="line"><span class="keyword">import</span> hello <span class="keyword">from</span> <span class="string">'./components/hello'</span>;</span><br><span class="line"></span><br><span class="line">Vue.config.debug = <span class="literal">true</span>;<span class="comment">//开启错误提示</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建根组件 */</span></span><br><span class="line"><span class="keyword">var</span> App = Vue.extend(&#123;&#125;);<span class="comment">// 路由器需要一个根组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建一个路由器实例 */</span></span><br><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> VueRouter();<span class="comment">// 创建实例时可以传入配置参数进行定制，为保持简单，这里使用默认配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义路由规则 */</span></span><br><span class="line"><span class="comment">// 每条路由规则应该映射到一个组件。这里的“组件”可以是一个使用 Vue.extend</span></span><br><span class="line"><span class="comment">// 创建的组件构造函数，也可以是一个组件选项对象。</span></span><br><span class="line">router.map(&#123;</span><br><span class="line">	<span class="string">'index'</span>: &#123;</span><br><span class="line">		name: <span class="string">'index'</span>,</span><br><span class="line">		component: index,</span><br><span class="line">		<span class="comment">// 在/index下设置一个子路由</span></span><br><span class="line">		<span class="comment">// 当匹配到/index/hello时，会在index的&lt;router-view&gt;内渲染</span></span><br><span class="line">		subRoutes: &#123;</span><br><span class="line">			<span class="string">'hello'</span>: &#123;</span><br><span class="line">				name: <span class="string">'hello'</span>,</span><br><span class="line">				component: hello</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">'/list'</span>: &#123;</span><br><span class="line">		name: <span class="string">'list'</span>,</span><br><span class="line">		component: list</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.redirect(&#123;</span><br><span class="line">	<span class="string">'*'</span>: <span class="string">'index'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 启动应用 */</span></span><br><span class="line">router.start(App, <span class="string">'#app'</span>);<span class="comment">// 路由器会创建一个 App 实例，并且挂载到选择符 #app 匹配的元素上。</span></span><br></pre></td></tr></table></figure></p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/16/imooc_iOS_iOS9新特性之UIStackView/" itemprop="url">
                  iOS9新特性之UIStackView
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-16T10:20:24+08:00" content="2016-06-16">
              2016-06-16
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/16/imooc_iOS_iOS9新特性之UIStackView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/16/imooc_iOS_iOS9新特性之UIStackView/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>视频：</strong><a href="http://www.imooc.com/learn/568" target="_blank" rel="external">http://www.imooc.com/learn/568</a><br><strong>源码：</strong><a href="https://git.coding.net/eli01/imooc_UIStackView.git" target="_blank" rel="external">https://git.coding.net/eli01/imooc_UIStackView.git</a></p>
</blockquote>
<h1 id="1-学习指南"><a href="#1-学习指南" class="headerlink" title="1    学习指南"></a>1    学习指南</h1><blockquote>
<p><strong>说明：</strong><code>iOS</code>设备屏幕尺寸日益多样化，随之而来的是屏幕适配日益复杂。为了解决这个问题，<code>iOS9</code>推出了<code>Stack View</code>。</p>
</blockquote>
<h1 id="2-UIStackView效果实现"><a href="#2-UIStackView效果实现" class="headerlink" title="2    UIStackView效果实现"></a>2    UIStackView效果实现</h1><h2 id="2-1-UIStackView属性介绍"><a href="#2-1-UIStackView属性介绍" class="headerlink" title="2.1    UIStackView属性介绍"></a>2.1    UIStackView属性介绍</h2><blockquote>
<p><strong>说明：</strong>一些常用的属性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8810.47.51.png" alt="Alt text"></p>
</blockquote>
<h2 id="2-2-美团效果实现"><a href="#2-2-美团效果实现" class="headerlink" title="2.2    美团效果实现"></a>2.2    美团效果实现</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.07.12.png" alt="Alt text"></p>
<h2 id="2-3-大众点评子控件代码实现"><a href="#2-3-大众点评子控件代码实现" class="headerlink" title="2.3    大众点评子控件代码实现"></a>2.3    大众点评子控件代码实现</h2><blockquote>
<p><strong>说明：</strong>通过代码（而不是<code>Storyboard</code>）创建并添加该组件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.47.24.png" alt="Alt text"><br><strong>注意：</strong>向<code>UIStackView</code>中添加子控件的时候要使用<code>addArrangedSubview</code>而不是<code>addSubview</code>，因为前者会保留控件作为<code>Stack View</code>子控件的特性</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">/* 1. 最外部UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackView = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">50</span>)];<span class="comment">// 创建Stack View</span></span><br><span class="line">    stackView.axis = <span class="built_in">UILayoutConstraintAxisHorizontal</span>;<span class="comment">// 设置为水平排列</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 2. 左边图片 */</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    imgView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img1.png"</span>];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/* 3. 右边子UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackViewSub = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">50</span>)];</span><br><span class="line">    stackViewSub.axis = <span class="built_in">UILayoutConstraintAxisVertical</span>;</span><br><span class="line">    <span class="comment">// 内部3个控件</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    imgView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img2.png"</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label1 = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    label1.text = <span class="string">@"人均¥18"</span>;</span><br><span class="line">    label1.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">12.0</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label2 =[[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">10</span>)];</span><br><span class="line">    label2.text = <span class="string">@"口味21环境21价格18"</span>;</span><br><span class="line">    label2.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">10.0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 4. 组合 */</span></span><br><span class="line">    <span class="comment">// 3个控件添加到内部Stack View</span></span><br><span class="line">    [stackViewSub addArrangedSubview:imgView2];</span><br><span class="line">    [stackViewSub addArrangedSubview:label1];</span><br><span class="line">    [stackViewSub addArrangedSubview:label2];</span><br><span class="line">    <span class="comment">// 添加左边的图片到外部的Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:imgView];</span><br><span class="line">    <span class="comment">// 添加内部的 Stack View到外部的 Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:stackViewSub];</span><br><span class="line">    <span class="comment">// 将最外层的stackView添加到View Controller</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:stackView]; </span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-UIStackView使用要点"><a href="#2-4-UIStackView使用要点" class="headerlink" title="2.4    UIStackView使用要点"></a>2.4    UIStackView使用要点</h2><p>无干货</p>
<h1 id="3-总结与预告"><a href="#3-总结与预告" class="headerlink" title="3    总结与预告"></a>3    总结与预告</h1><p>无干货</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_WEB_带你学习pug模版引擎/" itemprop="url">
                  带你学习pug模版引擎
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T22:23:30+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/15/imooc_WEB_带你学习pug模版引擎/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/15/imooc_WEB_带你学习pug模版引擎/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-课程简介"><a href="#1-课程简介" class="headerlink" title="1    课程简介"></a>1    课程简介</h1><blockquote>
<p><strong>模版引擎：</strong>将动态的数据和静态的页面糅合在一起的实现机制或技术<br><strong>流行的模版：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>实现语言</th>
<th>模版引擎例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP</td>
<td><code>Smarty</code>、<code>SimpleTemplate</code>、 <code>Xtemplate</code>、 <code>Savant</code></td>
</tr>
<tr>
<td>Java</td>
<td><code>Velocity</code>、 <code>FreeMarker</code>、 <code>Jbyte</code></td>
</tr>
<tr>
<td>C#</td>
<td><code>Dotliquid</code>、 <code>SharpDom</code>、 <code>Razor</code></td>
</tr>
<tr>
<td>JavaScript</td>
<td><code>Mustache</code>、 <code>Handlebars</code>、 <code>Juicer</code>、 <code>Xtemplate</code>、 <code>EJS</code>、 <code>pug</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>官网：</strong><a href="http://pug-lang.com/" target="_blank" rel="external">http://pug-lang.com/</a><br><strong>提示：</strong><code>jade</code>改名为<code>pug</code>了</p>
</blockquote>
<h2 id="1-1-pug环境配置"><a href="#1-1-pug环境配置" class="headerlink" title="1.1    pug环境配置"></a>1.1    pug环境配置</h2><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><ul>
<li>升级 mac 系统到最新</li>
<li>升级 xcode 及 xcode command line tools 到最新</li>
<li>安装 homebrew</li>
<li>通过 homebrew 安装 git 和 <a href="https://github.com/tj/n" target="_blank" rel="external">node</a></li>
<li>通过 npm 安装 pug<br><code>npm i -g pug</code></li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul>
<li>安装 node 可执行文件</li>
<li>通过 cygwin, 及可能的 openssl、g++-gcc、python、git等</li>
<li>通过 npm 安装 pug<br><code>npm install -g pug</code></li>
</ul>
<h2 id="1-2-pug特点"><a href="#1-2-pug特点" class="headerlink" title="1.2    pug特点"></a>1.2    pug特点</h2><ol>
<li>超强的可读性</li>
<li>灵活易用的缩进</li>
<li>块扩展</li>
<li>代码默认经过编码处理，以增强安全性</li>
<li>编译及运行时的上下文错误报告</li>
<li>命令行编译支持</li>
<li>HTML5模式（使用!!!5文档类型）</li>
<li>可选的内存缓存</li>
<li>联合动态的静态标记类</li>
<li>利用过滤器解析树的处理</li>
</ol>
<h2 id="1-3-pug的诞生"><a href="#1-3-pug的诞生" class="headerlink" title="1.3    pug的诞生"></a>1.3    pug的诞生</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-18%20%E4%B8%8B%E5%8D%8810.40.40.png" alt="pug环境|150x150"></p>
<h3 id="1-4-命令行中的-pug"><a href="#1-4-命令行中的-pug" class="headerlink" title="1.4    命令行中的 pug"></a>1.4    命令行中的 pug</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install pug -g --client</span><br><span class="line">$ pug --help</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Usage: pug [options] [dir|file ...]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  -h, --help             output usage information</span><br><span class="line">  -V, --version          output the version number</span><br><span class="line">  -O, --obj &lt;str|path&gt;   JavaScript options object or JSON file containing it</span><br><span class="line">  -o, --out &lt;dir&gt;        output the compiled html to &lt;dir&gt;</span><br><span class="line">  -p, --path &lt;path&gt;      filename used to resolve includes</span><br><span class="line">  -P, --pretty           compile pretty html output</span><br><span class="line">  -c, --client           compile <span class="keyword">function</span> <span class="keyword">for</span> client-side runtime.js</span><br><span class="line">  -n, --name &lt;str&gt;       The name of the compiled template (requires --client)</span><br><span class="line">  -D, --no-debug         compile without debugging (smaller <span class="built_in">functions</span>)</span><br><span class="line">  -w, --watch            watch files <span class="keyword">for</span> changes and automatically re-render</span><br><span class="line">  -E, --extension &lt;ext&gt;  specify the output file extension</span><br><span class="line">  -H, --hierarchy        keep directory hierarchy when a directory is specified</span><br><span class="line">  --name-after-file      Name the template after the last section of the file path (requires --client and overriden by --name)</span><br><span class="line">  --doctype &lt;str&gt;        Specify the doctype on the <span class="built_in">command</span> line (useful <span class="keyword">if</span> it is not specified by the template)</span><br></pre></td></tr></table></figure>
<h1 id="2-pug基础语法知识"><a href="#2-pug基础语法知识" class="headerlink" title="2    pug基础语法知识"></a>2    pug基础语法知识</h1><h2 id="2-1-文档声明和头尾标签"><a href="#2-1-文档声明和头尾标签" class="headerlink" title="2.1    文档声明和头尾标签"></a>2.1    文档声明和头尾标签</h2><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 imooc hade study</span><br></pre></td></tr></table></figure>
<h2 id="2-2-实现命令行实时编译"><a href="#2-2-实现命令行实时编译" class="headerlink" title="2.2    实现命令行实时编译"></a>2.2    实现命令行实时编译</h2><p><code>-P</code>:     不压缩生成的html文件<br><code>-w</code>：实时监控</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">└── index.pug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ pug -P index.pug <span class="comment"># 编译到当前目录下</span></span><br><span class="line"></span><br><span class="line">$ tree  </span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line"></span><br><span class="line">├── index.html<span class="comment"># 编译生成的文件</span></span><br><span class="line">└── index.pug</span><br></pre></td></tr></table></figure>
<h2 id="2-3-标签语法"><a href="#2-3-标签语法" class="headerlink" title="2.3    标签语法"></a>2.3    标签语法</h2><ul>
<li>不需要尖括号</li>
<li>不需要闭合</li>
<li>通过缩进实现嵌套</li>
</ul>
<h2 id="2-4-属性文本和值"><a href="#2-4-属性文本和值" class="headerlink" title="2.4    属性文本和值"></a>2.4    属性文本和值</h2><table>
<thead>
<tr>
<th>属性类型</th>
<th>书写方式</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>|id|<code>[标签]# [id]</code>或<code>[标签] (id=[id])</code>|<br>|class|<code>[标签].[className1].[classeName2]</code>或<code>[标签] (class=&quot;[className1] [className2]&quot;)</code><br>|其它|<code>[标签] ([属性]=&quot;[属性值]&quot; [省略值的属性])</code>|</p>
<p><strong>注意：</strong>对于id和class属性，编写div标签且采用<code>#</code>、<code>.</code>的方式时可以省略<code>div</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		</span><br><span class="line">		h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">		</span><br><span class="line">		# id.classname</span><br><span class="line">			a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">			input(value='course',type="text",name="course")</span><br><span class="line">			input(name='type',type='checkbox',checked)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://imooc.com"</span> <span class="attr">title</span>=<span class="string">"imooc pug"</span> <span class="attr">data-uid</span>=<span class="string">"1000"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"course"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"course"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="2-5-混合的成段文本和标签"><a href="#2-5-混合的成段文本和标签" class="headerlink" title="2.5        混合的成段文本和标签"></a>2.5        混合的成段文本和标签</h1><p><strong>说明：</strong>两种方式</p>
<ul>
<li>每一行文本前加 <code>|</code></li>
<li>为标签添加后缀<code>.</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p </span><br><span class="line">	|	a </span><br><span class="line">	|	b </span><br><span class="line">	|	c </span><br><span class="line">	|	d</span><br><span class="line">p.</span><br><span class="line">	a</span><br><span class="line">	<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">	b</span><br><span class="line">	c</span><br><span class="line">	d</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  a </span><br><span class="line">  b </span><br><span class="line">  c </span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--接下来的东西是个完整代码块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  a</span><br><span class="line">  <span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-6-注释和条件注释"><a href="#2-6-注释和条件注释" class="headerlink" title="2.6    注释和条件注释"></a>2.6    注释和条件注释</h2><h3 id="2-6-1-注释"><a href="#2-6-1-注释" class="headerlink" title="2.6.1    注释"></a>2.6.1    注释</h3><p><strong>分类：</strong></p>
<ul>
<li>缓冲注释<code>//</code>：会输出到html</li>
<li>非缓冲注释<code>//-</code>：不会输出到html</li>
</ul>
<p><strong>注意：</strong>当注释放在标签下部时，表示块注释</p>
<h3 id="2-6-2-条件注释"><a href="#2-6-2-条件注释" class="headerlink" title="2.6.2    条件注释"></a>2.6.2    条件注释</h3><p><strong>注意：</strong>当使用条件注释时，html需要使用标签，且需要闭合。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">//- html</span><br><span class="line"><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	meta(charset='utf-8')</span><br><span class="line">	title imooc pug study</span><br><span class="line">body</span><br><span class="line">	style.</span><br><span class="line">		</span><br><span class="line">		body&#123;color:# ff6600&#125;</span><br><span class="line">	script.</span><br><span class="line">		var imoocCourse = 'pug'</span><br><span class="line">	</span><br><span class="line">	h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">	h2 注释</span><br><span class="line">	//h3 单行注释</span><br><span class="line">	//-h4 非缓冲注释</span><br><span class="line">	</span><br><span class="line">	# id.classname</span><br><span class="line">	//-块注释</span><br><span class="line">		a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">		input(value='course',type="text",name="course")</span><br><span class="line">		input(name='type',type='checkbox',checked)</span><br><span class="line">		p </span><br><span class="line">			|	a </span><br><span class="line">			|	b </span><br><span class="line">			|	c </span><br><span class="line">			|	d</span><br><span class="line">		//接下来的东西是个完整代码块</span><br><span class="line">		p.</span><br><span class="line">			a</span><br><span class="line">			<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">			b</span><br><span class="line">			c</span><br><span class="line">			d</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="selector-tag">body</span>&#123;<span class="attribute">color</span>:# ff6600&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> imoocCourse = <span class="string">'pug'</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>注释<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--h3 单行注释--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-变量声明与数据传递"><a href="#2-7-变量声明与数据传递" class="headerlink" title="2.7    变量声明与数据传递"></a>2.7    变量声明与数据传递</h2><h3 id="2-7-1-变量声明与使用"><a href="#2-7-1-变量声明与使用" class="headerlink" title="2.7.1        变量声明与使用"></a>2.7.1        变量声明与使用</h3><ul>
<li><p>声明：<code>- var variableName</code></p>
</li>
<li><p>调用<code># {variableName}</code></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		- var course = 'pug'</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-2-数据传递"><a href="#2-7-2-数据传递" class="headerlink" title="2.7.2    数据传递"></a>2.7.2    数据传递</h3><blockquote>
<p><strong>说明：</strong>通过命令行指令传递数据</p>
<ol>
<li><code>--obj {jsonString}</code>：直接传递对象字符串</li>
<li><code>-O file.json</code>：载入json文件</li>
</ol>
</blockquote>
<p><strong>注意</strong>：如果在pug文件中声明了同样的变量，则被pug文件中的覆盖。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pug</span> index.pug -P -w --obj <span class="string">'&#123;"course":"pug"&#125;'</span></span><br><span class="line">或</span><br><span class="line">$ vim imooc.json </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"course"</span>:<span class="string">"pug"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pug</span> index.pug -P -w －O imooc.json</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-安全转义与非转义"><a href="#2-8-安全转义与非转义" class="headerlink" title="2.8    安全转义与非转义"></a>2.8    安全转义与非转义</h2><blockquote>
<p><strong>说明：</strong>解析并输出变量的内容时，默认会对变量进行<code>安全转义</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 转义</span><br><span class="line">		- var htmlData = '<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>'</span><br><span class="line">		// 默认(会转义)</span><br><span class="line">		</span><br><span class="line">		p # &#123;htmlData&#125;</span><br><span class="line">		// 安全转义</span><br><span class="line">		p= htmlData</span><br><span class="line"></span><br><span class="line">		// 非安全转义（形式1）</span><br><span class="line">		p !&#123;htmlData&#125;</span><br><span class="line">		// 非安全转义（形式2）</span><br><span class="line">		p!= htmlData</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		// 特殊符号转义（! #  &#123; &#125;）</span><br><span class="line">		</span><br><span class="line">		p \# &#123;htmlData&#125;</span><br><span class="line">		p \!&#123;htmlData&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>转义<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认(会转义)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 安全转义--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式1）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式2）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 特殊符号转义（! #  &#123; &#125;）--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span># &#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>!&#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-流程代码for-in-each-in-while"><a href="#2-9-流程代码for-in-each-in-while" class="headerlink" title="2.9    流程代码for-in /each-in / while"></a>2.9    流程代码for-in /each-in / while</h2><h3 id="2-9-1-for-in"><a href="#2-9-1-for-in" class="headerlink" title="2.9.1    for-in"></a>2.9.1    for-in</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 for</span><br><span class="line">- var imooc = &#123;course: 'pug', level: 'high'&#125;</span><br><span class="line">- for (var k in imooc)</span><br><span class="line">	p= imooc[k]</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-2-each-in"><a href="#2-9-2-each-in" class="headerlink" title="2.9.2    each-in"></a>2.9.2    each-in</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">h3 each</span><br><span class="line">each value, key in imooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;key&#125;:# &#123;value&#125;</span><br><span class="line"></span><br><span class="line">h3 遍历数组</span><br><span class="line">- var courses = ['node', 'pug', 'express']</span><br><span class="line">each item in courses</span><br><span class="line">	p= item</span><br><span class="line"></span><br><span class="line">h3 嵌套循环</span><br><span class="line">- var sections = [&#123;id: 1, items: ['a', 'b']&#125;,&#123;id: 2, items: ['c', 'd']&#125;]</span><br><span class="line">dl</span><br><span class="line">	each section in sections</span><br><span class="line">		dt= section.id</span><br><span class="line">		each item in section.items</span><br><span class="line">			dd= item</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历数组<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>express<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>嵌套循环<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>a<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>b<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>c<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>d<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-3-while"><a href="#2-9-3-while" class="headerlink" title="2.9.3    while"></a>2.9.3    while</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h3 while</span><br><span class="line">- var n = 0</span><br><span class="line">ul</span><br><span class="line">	while n <span class="tag">&lt; <span class="attr">4</span></span><br><span class="line">		<span class="attr">li</span>= <span class="string">n++</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>while<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-流程代码-if-else-unless"><a href="#2-10-流程代码-if-else-unless" class="headerlink" title="2.10    流程代码 if - else/unless"></a>2.10    流程代码 if - else/unless</h2><h3 id="2-10-1-if-else"><a href="#2-10-1-if-else" class="headerlink" title="2.10.1    if-else"></a>2.10.1    if-else</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">h3 if else</span><br><span class="line">- var isImooc = true</span><br><span class="line">- var lessons = ['pug', 'node']</span><br><span class="line">if lessons</span><br><span class="line">	if lessons.length &gt; 2</span><br><span class="line">		</span><br><span class="line">		p more than 2: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else if lessons.length &gt; 1</span><br><span class="line">		</span><br><span class="line">		p more than 1: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else</span><br><span class="line">		p no lesson</span><br><span class="line">else</span><br><span class="line">	p no lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>if else<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>more than 1: pug, node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-unless"><a href="#2-10-2-unless" class="headerlink" title="2.10.2    unless"></a>2.10.2    unless</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- var isImooc = true</span><br><span class="line">unless isImooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;lessons.length&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>unless<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-case-when"><a href="#2-10-3-case-when" class="headerlink" title="2.10.3    case-when"></a>2.10.3    case-when</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 case</span><br><span class="line">- var name = 'pug'</span><br><span class="line">case name</span><br><span class="line">	when 'java'</span><br><span class="line">	when 'node'</span><br><span class="line">		p Hi node!</span><br><span class="line">	when 'pug': p Hi exress!</span><br><span class="line">	when 'express': p Hi express</span><br><span class="line">	default</span><br><span class="line">		</span><br><span class="line">		p Hi # &#123;name&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>case<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi exress!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-神奇的mixins"><a href="#2-11-神奇的mixins" class="headerlink" title="2.11    神奇的mixins"></a>2.11    神奇的mixins</h2><h3 id="2-11-1-参数"><a href="#2-11-1-参数" class="headerlink" title="2.11.1    参数"></a>2.11.1    参数</h3><h4 id="2-11-1-1-无参数"><a href="#2-11-1-1-无参数" class="headerlink" title="2.11.1.1    无参数"></a>2.11.1.1    无参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 无参数</span><br><span class="line">mixin lesson</span><br><span class="line">	p imooc pug study</span><br><span class="line">+lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>无参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-2-有参数"><a href="#2-22-1-2-有参数" class="headerlink" title="2.22.1.2    有参数"></a>2.22.1.2    有参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">h3 带参数</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">+study('tom', ['pug', 'node'])</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>带参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>tom study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"courses"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-3-可变参数"><a href="#2-22-1-3-可变参数" class="headerlink" title="2.22.1.3    可变参数"></a>2.22.1.3    可变参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">h3 可变参数</span><br><span class="line">mixin magic(name, ...items)</span><br><span class="line">	</span><br><span class="line">	ul(class='# name')</span><br><span class="line">		each item in items</span><br><span class="line">			li= item</span><br><span class="line">+magic('magic', 'node', 'pug')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>可变参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"# name"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-嵌套"><a href="#2-11-2-嵌套" class="headerlink" title="2.11.2    嵌套"></a>2.11.2    嵌套</h3><blockquote>
<p><strong>说明：</strong>在一个<code>mixin</code>的定义中调用另一个<code>mixin</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">h3 mixin中调用另一个mixin</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">mixin group(student)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;student.name&#125;</span><br><span class="line">	+study(student.name, student.courses)</span><br><span class="line">+group(&#123;name:'tom', courses:['pug', 'node']&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-块包含"><a href="#2-11-3-块包含" class="headerlink" title="2.11.3    块包含"></a>2.11.3    块包含</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 块包含</span><br><span class="line">mixin team(slogon)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;slogon&#125;</span><br><span class="line">	if block</span><br><span class="line">		block</span><br><span class="line">	else</span><br><span class="line">		p no team</span><br><span class="line">//- 调用时后面跟一个块</span><br><span class="line">+team('slogon')</span><br><span class="line">	p Good job!</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>块包含<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>slogon<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Good job!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-4-传递属性"><a href="#2-11-4-传递属性" class="headerlink" title="2.11.4    传递属性"></a>2.11.4    传递属性</h3><blockquote>
<p><strong>说明：</strong>设置标签的属性有两种方式</p>
<ol>
<li>单个设置：<code>标签(属性名=attributes.属性名)</code></li>
<li>批量设置：<code>标签&amp;attributes(attributes)</code></li>
</ol>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 传递属性</span><br><span class="line">//- 索引某个属性</span><br><span class="line">mixin attr(name)</span><br><span class="line">	</span><br><span class="line">	p(class!=attributes.class) # &#123;name&#125;</span><br><span class="line">+attr('attr')(class='magic')</span><br><span class="line">//- 索引所有属性</span><br><span class="line">mixin attrs(name)</span><br><span class="line">	</span><br><span class="line">	p&amp;attributes(attributes) # &#123;name&#125;</span><br><span class="line">+attrs('attrs')(class='magic2', id='attrid')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>传递属性<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"magic"</span>&gt;</span>attr<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"attrid"</span> <span class="attr">class</span>=<span class="string">"magic2"</span>&gt;</span>attrs<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="3-pug进级"><a href="#3-pug进级" class="headerlink" title="3    pug进级"></a>3    pug进级</h1><h2 id="3-1-模版的继承"><a href="#3-1-模版的继承" class="headerlink" title="3.1    模版的继承"></a>3.1    模版的继承</h2><table>
<thead>
<tr>
<th>关键字</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extents [pug文件]</code></td>
<td>继承</td>
<td></td>
</tr>
<tr>
<td><code>block</code></td>
<td>定义(或引用，可追加)被继承的内容</td>
</tr>
</tbody>
</table>
<h3 id="3-1-1-案例源码"><a href="#3-1-1-案例源码" class="headerlink" title="3.1.1    案例源码"></a>3.1.1    案例源码</h3><p><em>head.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meta(charset='utf-8')</span><br><span class="line">title  study</span><br></pre></td></tr></table></figure>
<p><em>layout.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	include head</span><br><span class="line">body</span><br><span class="line">	block desc</span><br><span class="line">	  p desc from layout</span><br><span class="line">	block content</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line"><span class="keyword">block</span> content</span><br><span class="line">	p <span class="keyword">desc</span> <span class="keyword">from</span> <span class="keyword">index</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-编译后"><a href="#3-1-2-编译后" class="headerlink" title="3.1.2    编译后"></a>3.1.2    编译后</h3><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span> study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from layout<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from index<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-模版的包含"><a href="#3-2-模版的包含" class="headerlink" title="3.2    模版的包含"></a>3.2    模版的包含</h2><h3 id="3-2-1-包含其它-pug-文件"><a href="#3-2-1-包含其它-pug-文件" class="headerlink" title="3.2.1    包含其它 pug 文件"></a>3.2.1    包含其它 pug 文件</h3><p><em>style.pug</em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">style</span>.</span><br><span class="line">	<span class="selector-tag">body</span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">h1 模版包含</span><br><span class="line">//- 引入（还可以并追加内容）</span><br><span class="line">include style</span><br><span class="line">	style.</span><br><span class="line">		h2 &#123;</span><br><span class="line">			</span><br><span class="line">			color: # 000;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模版包含<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">h2</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">000</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-包含-html-文件"><a href="#3-2-2-包含-html-文件" class="headerlink" title="3.2.2    包含 html 文件"></a>3.2.2    包含 html 文件</h3><h4 id="原文件"><a href="#原文件" class="headerlink" title="原文件"></a>原文件</h4><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//- 引入静态文件，添加后缀名（.html），就不会被当做pug模版文件处理</span><br><span class="line">include title.html</span><br></pre></td></tr></table></figure>
<p><em>title.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编译后"><a href="#编译后" class="headerlink" title="编译后"></a>编译后</h4><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-render及renderFile方法"><a href="#3-3-render及renderFile方法" class="headerlink" title="3.3    render及renderFile方法"></a>3.3    render及renderFile方法</h2><h3 id="3-3-1-pug-API"><a href="#3-3-1-pug-API" class="headerlink" title="3.3.1    pug API"></a>3.3.1    pug API</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461486682614.png" alt="Alt text|400x150"></p>
<h3 id="3-3-2-compile、render、renderFile"><a href="#3-3-2-compile、render、renderFile" class="headerlink" title="3.3.2    compile、render、renderFile"></a>3.3.2    compile、render、renderFile</h3><blockquote>
<p><strong>说明：</strong><code>pug</code>提供写一些方法，帮助开发着在服务端灵活地处理编译工作。</p>
<ul>
<li>compile：返回一个编译特定模版片段的方法</li>
<li>render：直接编译定模版片段</li>
<li>renderFile：直接编译特定pug模版文件</li>
</ul>
</blockquote>
<p><em>server.js</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">		<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. pug.compile</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> fn = pug.compile(<span class="string">'div test # &#123;type&#125;'</span>, &#123;&#125;)</span><br><span class="line">	<span class="comment">// var html = fn(&#123;type: 'compile'&#125;)</span></span><br><span class="line">	<span class="comment">// 2. pug.render</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// var html = pug.render('div test # &#123;type&#125;', &#123;type: 'render'&#125;)</span></span><br><span class="line">	<span class="comment">// 3. pug.renderFile</span></span><br><span class="line">	<span class="keyword">var</span> html = pug.renderFile(<span class="string">'index.pug'</span>, &#123;course: <span class="string">'pug renderFile'</span>, pretty: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line">	res.end(html);</span><br><span class="line">&#125;).listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server running at 1337'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#  安装需要的node包</span></span><br><span class="line">➜  imooc_pug git:(master) ✗ npm i pug coffee-script less markdown --save</span><br></pre></td></tr></table></figure>
<h2 id="3-4-过滤器-filters"><a href="#3-4-过滤器-filters" class="headerlink" title="3.4    过滤器 filters"></a>3.4    过滤器 filters</h2><h3 id="3-4-1-markdown"><a href="#3-4-1-markdown" class="headerlink" title="3.4.1    markdown"></a>3.4.1    markdown</h3><blockquote>
<p><strong>注意：</strong><code>markdown</code>中不能使用<code>pug</code>变量</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i jstransformer-markdown -g</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h1 过滤器filters</span><br><span class="line">h3 markdown</span><br><span class="line">:markdown</span><br><span class="line">	Hi, this is **TZM** [link](http://tzmcn.org/)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>过滤器filters<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>markdown<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, this is<span class="tag">&lt;<span class="name">strong</span>&gt;</span>TZM<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"# &#123;url&#125;"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-less"><a href="#3-4-2-less" class="headerlink" title="3.4.2    less"></a>3.4.2    less</h3><blockquote>
<p><strong>官网：</strong><a href="http://lesscss.org/" target="_blank" rel="external">http://lesscss.org/</a></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g jstransformer-less</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">h3 less</span><br><span class="line">	style</span><br><span class="line">		:less</span><br><span class="line">			body &#123;</span><br><span class="line">				p &#123;</span><br><span class="line">					</span><br><span class="line">					color: # ccc;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">h3&gt;less<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line"><span class="selector-tag">body</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">color</span>: # ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-coffee-script"><a href="#3-4-3-coffee-script" class="headerlink" title="3.4.3    coffee-script"></a>3.4.3    coffee-script</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g jstransformer-coffee-script</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 coffee</span><br><span class="line">	script</span><br><span class="line">		:coffee-script</span><br><span class="line">			console.log 'This is coffee!'</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;coffee&lt;/h3&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(function() &#123;</span><br><span class="line">	console.log(&apos;This is coffee!&apos;);</span><br><span class="line">&#125;).call(this);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-runtime环境下使用pug"><a href="#3-5-runtime环境下使用pug" class="headerlink" title="3.5    runtime环境下使用pug"></a>3.5    runtime环境下使用pug</h2><blockquote>
<p><strong>说明：</strong><code>runtime</code>环境这里特指浏览器</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h1 浏览器端和服务器端能使用pug</span><br><span class="line"></span><br><span class="line"># runtime</span><br><span class="line">//- 服务器端使用</span><br><span class="line">script(src='node_modules/pug/runtime.js')</span><br><span class="line">//- 客户端使用</span><br><span class="line">script(src='runtime.js')</span><br><span class="line">script.</span><br><span class="line">	var runtimeNode = document.getElementById('runtime');</span><br><span class="line">	var runtimeHtml = template(&#123;isRuntime: true&#125;);</span><br><span class="line">	runtimeNode.innerHTML = runtimeHtml;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>浏览器端和服务器端能使用pug<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"runtime"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/pug/runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="keyword">var</span> runtimeNode = <span class="built_in">document</span>.getElementById(<span class="string">'runtime'</span>);</span><br><span class="line">  <span class="keyword">var</span> runtimeHtml = template(&#123;isRuntime: <span class="literal">true</span>&#125;);</span><br><span class="line">  runtimeNode.innerHTML = runtimeHtml;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-利用html2pug反编译"><a href="#3-6-利用html2pug反编译" class="headerlink" title="3.6    利用html2pug反编译"></a>3.6    利用html2pug反编译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i html2jade -g</span><br></pre></td></tr></table></figure>
<h3 id="命令行中使用"><a href="#命令行中使用" class="headerlink" title="命令行中使用"></a>命令行中使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="node端使用"><a href="#node端使用" class="headerlink" title="node端使用"></a>node端使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html2pug = <span class="built_in">require</span>(<span class="string">'html2jade'</span>)</span><br><span class="line">html2pug.convertDocument(html, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, pug</span>) </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="4-pug缺点及如何取舍"><a href="#4-pug缺点及如何取舍" class="headerlink" title="4    pug缺点及如何取舍"></a>4    pug缺点及如何取舍</h1><h2 id="4-1-Pug-的缺点"><a href="#4-1-Pug-的缺点" class="headerlink" title="4.1    Pug 的缺点"></a>4.1    Pug 的缺点</h2><ol>
<li>可移植差</li>
<li>调试困难</li>
<li>性能不是非常出色（对性能有需求考虑 <a href="">doT</a>）</li>
</ol>
<h2 id="4-2-选择的因素"><a href="#4-2-选择的因素" class="headerlink" title="4.2    选择的因素"></a>4.2    选择的因素</h2><ol>
<li>初始阶段（开发效率）</li>
<li>稳定阶段（性能和协作成本）</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_iOS_When iOS loves JS/" itemprop="url">
                  When iOS loves JS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T21:33:42+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/15/imooc_iOS_When iOS loves JS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/15/imooc_iOS_When iOS loves JS/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-JSBinding概述"><a href="#1-JSBinding概述" class="headerlink" title="1    JSBinding概述"></a>1    JSBinding概述</h1><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>是<code>JS</code>和<code>native</code>之间的一个桥梁，通过这个桥梁，<code>JS</code>可以调用<code>Native</code>，<code>Native</code>可以调用<code>JS</code>。</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.35.27.png" alt="Alt text"></p>
<p><strong>注意：</strong><code>JSBinding</code>不是什么</p>
<ul>
<li>not Hybrid</li>
<li>not a new technology</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.38.56.png" alt="Alt text"></p>
<p><strong>历史：</strong><code>cocos2D-X</code>使用<code>zynga</code>提出的一个方案(<a href="https://github.com/zynga/jsbindings)，`JS" target="_blank" rel="external">https://github.com/zynga/jsbindings)，`JS</a> Engine<code>使用的是</code>SpiderMonkey`。</p>
<h2 id="1-1-JS和Native"><a href="#1-1-JS和Native" class="headerlink" title="1.1    JS和Native"></a>1.1    JS和Native</h2><p><strong>说明：</strong>两者结合初衷如下</p>
</blockquote>
<table>
<thead>
<tr>
<th>原生静态语言</th>
<th>动态脚本语言</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>简单易用</td>
</tr>
<tr>
<td>更底层，更强大</td>
<td>免编译</td>
</tr>
<tr>
<td>平台特性</td>
<td>热部署</td>
</tr>
</tbody>
</table>
<h2 id="1-2-iOS-7-and-JavaScriptCore"><a href="#1-2-iOS-7-and-JavaScriptCore" class="headerlink" title="1.2    iOS 7 and JavaScriptCore"></a>1.2    iOS 7 and JavaScriptCore</h2><blockquote>
<p><strong>说明：</strong>在<code>iOS 7</code>之后，苹果公布了<code>JavaScriptCore</code>的<code>API</code>，在这之前一直是<code>iOS</code>系统私有的。<br><strong>扩展：</strong><code>Mac</code>的<code>JavaScriptCore</code>一直是开放的。<br><strong>要点：</strong>包括以下部分</p>
<ul>
<li><code>JavaScriptCore.h</code>头文件</li>
<li><code>JSContext</code>类：<code>JS</code>的运行环境</li>
<li><code>JSValue</code>类：</li>
<li><code>JSExport</code>类</li>
</ul>
</blockquote>
<h3 id="1-2-1-Eval-JavaScript-Code"><a href="#1-2-1-Eval-JavaScript-Code" class="headerlink" title="1.2.1    Eval JavaScript Code"></a>1.2.1    Eval JavaScript Code</h3><blockquote>
<p><strong>说明：</strong>利用引擎执行<code>JS</code>代码</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 使用 JS 上下文执行 JS 语句 "1 + 2"，并返回计算结果</span></span><br><span class="line">    JSValue *result = [context evaluateScript: <span class="string">@"1 + 2"</span>];</span><br><span class="line">    <span class="comment">// 打印计算结果</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"1 + 2 = %f"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-Call-JavaScript-Function"><a href="#1-2-2-Call-JavaScript-Function" class="headerlink" title="1.2.2    Call JavaScript Function"></a>1.2.2    Call JavaScript Function</h3><blockquote>
<p><strong>说明：</strong>假设一个叫做<code>sum</code>的<code>JS</code>方法已经被加载</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a "sum" function was loaded in context</span></span><br><span class="line"><span class="comment">// 使用上下文获取函数 sum</span></span><br><span class="line">J<span class="built_in">AValue</span> *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line"><span class="comment">// 调用sum JS 方法,并传递两个参数</span></span><br><span class="line">JSValue *result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line"><span class="comment">// 打印计算结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h3 id="1-2-3-Create-JavaScript-Value"><a href="#1-2-3-Create-JavaScript-Value" class="headerlink" title="1.2.3    Create JavaScript Value"></a>1.2.3    Create JavaScript Value</h3><blockquote>
<p><strong>说明：</strong>可以先创建<code>JS</code>的值，再赋值给相应变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在指定上下文中创建值 231</span></span><br><span class="line">JSValue *intVar = [JSValue valueWithInt32: <span class="number">231</span> inContext: context];</span><br><span class="line"><span class="comment">// 将值赋给变量 bar</span></span><br><span class="line">context[<span class="string">@"bar"</span>] = intVar;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line">[context evaluateScript: <span class="string">@"bar++];</span></span><br></pre></td></tr></table></figure>
<p><em>another way</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[context evaluateScript: <span class="string">@"var bar = 231;bar++;"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-Type-Conversion"><a href="#1-2-4-Type-Conversion" class="headerlink" title="1.2.4    Type Conversion"></a>1.2.4    Type Conversion</h3><blockquote>
<p><strong>说明：</strong><code>JS</code>和<code>O-C</code>之间对应类型的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th>Objective-C type</th>
<th>JavaScript type</th>
</tr>
</thead>
<tbody>
<tr>
<td>nil</td>
<td>undefined</td>
</tr>
<tr>
<td>NSNull</td>
<td>null</td>
</tr>
<tr>
<td>NSString</td>
<td>string</td>
</tr>
<tr>
<td>NSNumber</td>
<td>number, boolean</td>
</tr>
<tr>
<td>NSDictionary</td>
<td>Object object</td>
</tr>
<tr>
<td>NSArray</td>
<td>Array object</td>
</tr>
<tr>
<td>NSDate</td>
<td>Date object</td>
</tr>
<tr>
<td>NSBlock</td>
<td>Function object</td>
</tr>
<tr>
<td>id</td>
<td>Wrapper object</td>
</tr>
<tr>
<td>Class</td>
<td>Constructor object</td>
</tr>
</tbody>
</table>
<h2 id="1-3-完整实例"><a href="#1-3-完整实例" class="headerlink" title="1.3    完整实例"></a>1.3    完整实例</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 为上下文指定JS异常处理代码块</span></span><br><span class="line">    context.exceptionHandler = ^(JSContext *ctx, JSValue *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, exception);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">NSString</span> *script;</span><br><span class="line">    JSValue *result;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 表达式</span></span><br><span class="line">    script = <span class="string">@"1 + 2 + 3"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" %@ = %f"</span>, script, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 语句(创建一个全局变量)</span></span><br><span class="line">    script = <span class="string">@"var globalVal = 2 * 3;"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" globalVar = %@"</span>, context[<span class="string">@"globalVar"</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 函数</span></span><br><span class="line">    script = <span class="string">@"function sum(a, b)&#123;return a + b;&#125;"</span>;</span><br><span class="line">    [context evaluateScript:script];</span><br><span class="line">    JSValue *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line">    result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, <span class="string">@"sum(1,2)"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建值</span></span><br><span class="line">    JSValue *foo = [JSValue valueWithDouble:<span class="number">123.45</span> inContext:context];</span><br><span class="line">    context[<span class="string">@"foo"</span>] = foo;</span><br><span class="line">    [context evaluateScript:<span class="string">@"foo++"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"foo = %f"</span>, [context[<span class="string">@"foo"</span>] toDouble]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-初始iOS7-JavaScriptCore-API"><a href="#2-初始iOS7-JavaScriptCore-API" class="headerlink" title="2    初始iOS7 JavaScriptCore API"></a>2    初始iOS7 JavaScriptCore API</h1><h2 id="2-1-Call-Native-Code-via-Block"><a href="#2-1-Call-Native-Code-via-Block" class="headerlink" title="2.1    Call Native Code via Block"></a>2.1    Call Native Code via Block</h2><blockquote>
<p><strong>说明：</strong><code>JS</code>调用<code>Native</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------ JS 调用 Native</span></span><br><span class="line"><span class="comment">// 为 JS 的上下文注入可以调用的本地 BLOCK</span></span><br><span class="line">context[<span class="string">@"sum"</span>] = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 在 JS 中调用 Native block</span></span><br><span class="line">result = [context evaluateScript:<span class="string">@"sum(1, 2)"</span>];</span><br><span class="line"><span class="comment">// 观察运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Call-Native-Code-via-JSExport"><a href="#2-2-Call-Native-Code-via-JSExport" class="headerlink" title="2.2    Call Native Code via JSExport"></a>2.2    Call Native Code via JSExport</h2><blockquote>
<p><strong>说明：</strong>通过<code>jsExport</code>调用<code>Native</code></p>
<ul>
<li>Create a js export Class in Objective-C（创建<code>jsExport</code>类）</li>
<li>the instance of this class can be accessed in js context（该类的实例可以在<code>js</code>的上下文中访问到）</li>
<li>No Constructor in JS（无法在<code>JS</code>中访问到<code>JSExport</code>对象的构造函数）</li>
</ul>
</blockquote>
<p>###实例</p>
<blockquote>
<p><strong>说明：</strong>需要做以下工作</p>
<ol>
<li>定义一个<code>JSExport</code>的子协议：协议指定的成员才能够暴露给<code>JS</code>上下文</li>
<li>创建一个<code>O-C</code>类，并采纳协议</li>
</ol>
</blockquote>
<p><em>Point3D.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">// 协议：继承 JSExport</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">Point3DExport</span> &lt;<span class="title">JSExport</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> x;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> y;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>) length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Point3D</span> : <span class="title">NSObject</span> &lt;<span class="title">Point3DExport</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    JSContext *context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Point3D.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Point3D.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Point3D</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> x;</span><br><span class="line"><span class="keyword">@synthesize</span> y;</span><br><span class="line"><span class="keyword">@synthesize</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        context = ctx;</span><br><span class="line">        context[<span class="string">@"Point3D"</span>] = [Point3D class];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>)length &#123;</span><br><span class="line">    <span class="keyword">return</span> sqrt(<span class="keyword">self</span>.x * <span class="keyword">self</span>.x + <span class="keyword">self</span>.y * <span class="keyword">self</span>.y + <span class="keyword">self</span>.z * <span class="keyword">self</span>.z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *script;</span><br><span class="line">JSValue *result;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line">Point3D *point3D = [[Point3D alloc] initWithContext:context];</span><br><span class="line">point3D.x = <span class="number">1</span>;</span><br><span class="line">point3D.y = <span class="number">2</span>;</span><br><span class="line">point3D.z = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 将实例注入到 JS 上下文</span></span><br><span class="line">context[<span class="string">@"point3D"</span>] = point3D;</span><br><span class="line"><span class="comment">// 待执行的 JS 脚本</span></span><br><span class="line">script = <span class="string">@"point3D.x = 2; point3D.y = 2; point3D.length();"</span>;</span><br><span class="line"><span class="comment">// 在 JS 上下文中调用该实例</span></span><br><span class="line">result = [context evaluateScript:script];</span><br><span class="line"><span class="comment">// 观察 JS 运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, script, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-3-载入js文件来执行"><a href="#2-3-载入js文件来执行" class="headerlink" title="2.3    载入js文件来执行"></a>2.3    载入js文件来执行</h2><blockquote>
<p><strong>说明：</strong>加入<code>js</code>文件比起在<code>Native</code>代码中创建<code>js</code>脚本子串要通用、易用的多。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建文件路径</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [<span class="built_in">NSString</span> stringWithFormat:</span><br><span class="line">                       <span class="string">@"%@/%@"</span>,</span><br><span class="line">                       [[<span class="built_in">NSBundle</span> mainBundle] resourcePath],</span><br><span class="line">                       fileName];</span><br><span class="line"><span class="comment">// 载入 js 文件</span></span><br><span class="line"><span class="built_in">NSString</span> *script = [<span class="built_in">NSString</span> stringWithContentsOfFile:filePath encoding:<span class="built_in">NSUTF8StringEncoding</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 执行 js</span></span><br><span class="line">[context evaluateScript:script];</span><br></pre></td></tr></table></figure>
<h1 id="3-JavaScriptCore-API-进阶"><a href="#3-JavaScriptCore-API-进阶" class="headerlink" title="3    JavaScriptCore API 进阶"></a>3    JavaScriptCore API 进阶</h1><h2 id="3-1-Memory-Leak"><a href="#3-1-Memory-Leak" class="headerlink" title="3.1    Memory Leak"></a>3.1    Memory Leak</h2><blockquote>
<p><strong>说明：</strong><code>js</code>中对象的<code>循环引用</code>和<code>o-c</code>中对象的<code>循环引用</code>都不会导致内存泄漏。但<code>js</code>对象和<code>Native</code>对象之间的循环引用会导致内存泄漏。</p>
<ul>
<li><code>js</code>对象之间循环引用：不会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454685937810.png" alt="Alt text"></li>
<li><code>o-c</code>对象和<code>js</code>对象之间循环引用：会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686063492.png" alt="Alt text"></li>
</ul>
<p><strong>解决：</strong><code>o-c</code>对象引用<code>js</code>对象时将后者包装为<code>JSManageredValue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686201162.png" alt="Alt text"><br><em>JS Code</em></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> girl = <span class="keyword">new</span> Girl();</span><br><span class="line">girl.boyFriend = boy;</span><br><span class="line">boy.girlFriend = girl;</span><br></pre></td></tr></table></figure>
<p><em>Objective-C Code</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Boy</span></span></span><br><span class="line">- (<span class="keyword">void</span>)setGirlFriend: (JSValue *)girl</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 使用 JSManageredValue 进行包装</span></span><br><span class="line">	<span class="keyword">self</span>.girlFriend = [JSManageredValue manageredValueWithValue: girl];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-Threding-and-parallelism"><a href="#3-2-Threding-and-parallelism" class="headerlink" title="3.2    Threding and parallelism"></a>3.2    Threding and parallelism</h2><blockquote>
<p><strong>说明：</strong>要点</p>
<ul>
<li>API is thread safe（API是线程安全的）</li>
<li>Locking granularity is JSVirtualMachine（锁的最小粒度为是<code>JS</code>虚拟机）</li>
<li>Use separate JSVirtualMachines for parallelism（并发时要使用不同的<code>JS</code>虚拟机）<br>###实例<br><strong>说明：</strong>创建了2个虚拟机实例</li>
<li>jsvmA：运行了两个<code>js</code>上下文(<code>ctxA1</code>和<code>ctxA2</code>)</li>
<li>jsvmB：运行了一个<code>js</code>上下文(<code>ctxB</code>)</li>
</ul>
<p><code>ctxA1</code>和<code>ctxA2</code>能够在并发情形下正常通信，但他们<code>ctxB</code>在并发环境下不能通信。因为前两者在同一个虚拟机中运行，也就意味着运行在同一个线程中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 js 虚拟机实例 jsvmA</span></span><br><span class="line">JSVirtualMachine *jsvmA = [[JSVirtualMachine alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 jsvmA 虚拟机中创建两个js上下文</span></span><br><span class="line">JSContext *ctxA1 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line">JSContext *ctxA2 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建另一个 js 虚拟机实例 javmB</span></span><br><span class="line">JSVirtualMachine *jsvmB = [[JSVirtualMachine alloc] init];</span><br><span class="line"><span class="comment">// // 在 jsvmB 虚拟机中创建一个js上下文</span></span><br><span class="line">JSContext *ctxB = [[JSContext alloc] initWithVirtualMachine: jsvmB];</span><br></pre></td></tr></table></figure>
<h2 id="3-3-JSBinding-in-the-Real-World"><a href="#3-3-JSBinding-in-the-Real-World" class="headerlink" title="3.3    JSBinding in the Real World"></a>3.3    JSBinding in the Real World</h2><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>的一些实际应用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744485627.png" alt="Alt text"></p>
<ul>
<li>Cocos2D</li>
<li>Ejecta</li>
<li>CocoonJS<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744686882.png" alt="Alt text"></li>
<li>node.app<h3 id="3-3-1-JS-Engines"><a href="#3-3-1-JS-Engines" class="headerlink" title="3.3.1    JS Engines"></a>3.3.1    JS Engines</h3></li>
</ul>
<p><strong>说明：</strong>2种<code>JS</code>引擎比较，<code>JavaScriptCore</code>和<code>SpiderMonkey</code></p>
<ul>
<li>JavaScriptCore</li>
<li>SpiderMonkey(Cocos2D-iPhone-2.1-bate3)</li>
<li>SpiderMonkey(Cocos2D-x-2.1-bate3)</li>
<li>SpiderMonkey(iMonkey)</li>
</ul>
<p><strong>注意：</strong><code>v8</code>引擎不受支持，因为其依赖于<code>JIT</code>，被苹果禁用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454745052574.png" alt="Alt text"></p>
<h3 id="3-3-2-JSBind-VS-LuaBinding"><a href="#3-3-2-JSBind-VS-LuaBinding" class="headerlink" title="3.3.2    JSBind VS LuaBinding"></a>3.3.2    JSBind VS LuaBinding</h3><p><strong>说明：</strong><code>JSBinding</code>和<code>LuaBinding</code>比较</p>
<ul>
<li><code>LUA</code>为什么在游戏编程领域被广泛运用<br><a href="https://www.zhihu.com/question/21717567" target="_blank" rel="external">https://www.zhihu.com/question/21717567</a></li>
<li><code>Cocos2dx+LUA</code>合适还是<code>Cocos2dx+JS</code>合适<br><a href="https://www.zhihu.com/question/21130385" target="_blank" rel="external">https://www.zhihu.com/question/21130385</a><h2 id="3-3-3-Which-to-Choose"><a href="#3-3-3-Which-to-Choose" class="headerlink" title="3.3.3    Which to Choose"></a>3.3.3    Which to Choose</h2></li>
</ul>
</blockquote>
<ul>
<li>Native</li>
<li>Web</li>
<li>Hybrid</li>
<li>ScriptBinding</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/03/JK_IOS高级_4 设计模式/" itemprop="url">
                  4 设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-03T14:11:18+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/03/JK_IOS高级_4 设计模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/03/JK_IOS高级_4 设计模式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-iOS设计模式简介"><a href="#4-1-iOS设计模式简介" class="headerlink" title="4.1    iOS设计模式简介"></a>4.1    iOS设计模式简介</h2><h3 id="4-1-1-编码是门艺术"><a href="#4-1-1-编码是门艺术" class="headerlink" title="4.1.1    编码是门艺术"></a>4.1.1    编码是门艺术</h3><h3 id="4-1-2-设计模式的基本原则"><a href="#4-1-2-设计模式的基本原则" class="headerlink" title="4.1.2    设计模式的基本原则"></a>4.1.2    设计模式的基本原则</h3><ul>
<li><strong>开闭原则</strong>：一个模块的修改应该对扩展开发，对修改关闭</li>
<li><strong>里氏代换原则</strong>：子类、父类可以替换使用</li>
<li><strong>依赖倒转原则</strong>：抽象比依赖细节，细节依赖抽象</li>
<li><strong>接口隔离原则</strong>：只做和接口相关的必要的事情，不做和接口不相关的事情</li>
<li><strong>合成／聚合复用</strong>：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为一个组件调用</li>
</ul>
<h3 id="4-1-3-设计模式的类型"><a href="#4-1-3-设计模式的类型" class="headerlink" title="4.1.3    设计模式的类型"></a>4.1.3    设计模式的类型</h3><h2 id="4-2-适配器"><a href="#4-2-适配器" class="headerlink" title="4.2    适配器"></a>4.2    适配器</h2><h3 id="4-2-1-何为适配器模式"><a href="#4-2-1-何为适配器模式" class="headerlink" title="4.2.1    何为适配器模式"></a>4.2.1    何为适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过现实生活中遇到的电源适配问题，来讲解何为适配器模式。<br><strong>说明：</strong>苹果的电源适配器，可以将各种输入电压频率转为一致的电压频率为设备供电，从而解决国家电压频率不一致问题</p>
<ul>
<li><strong>类适配器：</strong>比之于一般的电源适配器，在不同国家要购买相应的电源适配器</li>
<li><strong>对象适配器：</strong>比之于苹果的电源适配器，能自动适应各个国家的情况</li>
</ul>
</blockquote>
<h3 id="4-2-2-数据直接适配带来的困境"><a href="#4-2-2-数据直接适配带来的困境" class="headerlink" title="4.2.2    数据直接适配带来的困境"></a>4.2.2    数据直接适配带来的困境</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解开发过程中遇到的最常见的几种数据适配问题的弊端，并配以代码示例，来引申出为何要用适配器模式。</p>
<ul>
<li>直接赋值的弊端</li>
<li>用对象赋值的灵活性问题</li>
<li>如何降低数据层与视图层的耦合度</li>
</ul>
</blockquote>
<h3 id="4-2-3-使用适配器模式"><a href="#4-2-3-使用适配器模式" class="headerlink" title="4.2.3    使用适配器模式"></a>4.2.3    使用适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解用适配器模式来优化名片视图加载数据的问题。</p>
<ul>
<li>创建抽象适配器模式</li>
<li>适配器与视图层建立输出联系</li>
<li>类适配器与对象适配器<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462074739914.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="4-2-3-1-类适配器"><a href="#4-2-3-1-类适配器" class="headerlink" title="4.2.3.1    类适配器"></a>4.2.3.1    类适配器</h4><blockquote>
<p><strong>说明：</strong>为每种数据模型都创建相应的适配器，用到哪种数据就使用相应的适配器。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.30.25.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462073700393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">// 3. 将数据连接到适配器</span><br><span class="line">BusinessCardAdapter *modelAdapter = [[NewCardModelAdapter alloc] initWithData:newCardModel];</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[ModelAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-2-对象适配器"><a href="#4-2-3-2-对象适配器" class="headerlink" title="4.2.3.2        对象适配器"></a>4.2.3.2        对象适配器</h4><blockquote>
<p><strong>说明：</strong>每种数据模型都使用同一个适配器，适配器中承担为每种数据模型都提供适配的任务。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.31.00.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.38.40.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[CardAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-适配器模式的优缺点"><a href="#4-2-4-适配器模式的优缺点" class="headerlink" title="4.2.4    适配器模式的优缺点"></a>4.2.4    适配器模式的优缺点</h3><p><strong>优点：</strong>降低数据层和视图层之间的耦合度<br><strong>缺点：</strong>对不理解适配器模式的人可读性不好</p>
<h2 id="4-3-策略"><a href="#4-3-策略" class="headerlink" title="4.3    策略"></a>4.3    策略</h2><h3 id="4-3-1-if-else-的问题"><a href="#4-3-1-if-else-的问题" class="headerlink" title="4.3.1    if - else 的问题"></a>4.3.1    if - else 的问题</h3><blockquote>
<p><strong>课程说明：</strong>程序中出现了大量 if - else 之后，出现的阅读障碍以及维护的困境。</p>
</blockquote>
<h3 id="4-3-2-策略模式的原理"><a href="#4-3-2-策略模式的原理" class="headerlink" title="4.3.2    策略模式的原理"></a>4.3.2    策略模式的原理</h3><blockquote>
<p><strong>课程说明：</strong>策略模式的基本原理以及定义的条件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462093482279.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-3-3-策略模式的使用"><a href="#4-3-3-策略模式的使用" class="headerlink" title="4.3.3    策略模式的使用"></a>4.3.3    策略模式的使用</h3><blockquote>
<p><strong>课程说明：</strong>怎样将策略模式用到 <code>UITextField</code> 的验证逻辑上。</p>
<ul>
<li>如何抽象出策略</li>
<li>制定协议来维护输出信息<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%889.41.29.png" alt="Alt text|200x100"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462113251890.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIButton+inits.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIView+SetRect.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIInfomationView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CustomUITextField.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EmailValidator.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PhoneNumberValidator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITextFieldDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *emailField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *phoneNumberField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButton];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化输入框</span></span><br><span class="line">    [<span class="keyword">self</span> initCustonFields];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳 UITextFieldDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)textFieldDidEndEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    Custom<span class="built_in">UITextField</span> *customField = (Custom<span class="built_in">UITextField</span> *)textField;</span><br><span class="line">    <span class="keyword">if</span> ([customField validate] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="comment">// 弹出错误提示窗</span></span><br><span class="line">        [<span class="built_in">UIInfomationView</span> showAlertViewWithTitle:<span class="literal">nil</span></span><br><span class="line">                                         message:customField</span><br><span class="line">                                                .validator</span><br><span class="line">                                                .errorMessage</span><br><span class="line">                               cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                               otherButtonTitles:@[<span class="string">@"确定"</span>]</span><br><span class="line">                                    clickAtIndex:^(<span class="built_in">NSInteger</span> buttonIndex) &#123;</span><br><span class="line">                                        </span><br><span class="line">                                    &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化输入框</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initCustonFields &#123;</span><br><span class="line">    <span class="comment">// 邮箱输入框</span></span><br><span class="line">    <span class="keyword">self</span>.emailField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.emailField.placeholder = <span class="string">@"请输入邮箱"</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.delegate =  <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.validator = [EmailValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.emailField];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手机号输入框</span></span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span> + <span class="number">40</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.placeholder = <span class="string">@"请输入电话号码"</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.validator = [PhoneNumberValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneNumberField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化返回按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButton &#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> createButtonWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">30</span>)</span><br><span class="line">                                            buttonType:<span class="number">0</span></span><br><span class="line">                                                 title:<span class="string">@"Back"</span></span><br><span class="line">                                                   tag:<span class="number">0</span></span><br><span class="line">                                                target:<span class="keyword">self</span></span><br><span class="line">                                                action:<span class="keyword">@selector</span>(buttonEvent:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  结束编辑</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4-策略模式的优缺点"><a href="#4-3-4-策略模式的优缺点" class="headerlink" title="4.3.4    策略模式的优缺点"></a>4.3.4    策略模式的优缺点</h3><p><strong>优点：</strong>避免大量<code>if-else</code>的使用，精简逻辑，可维护性高<br><strong>缺点：</strong>使用场景受限，使用之前就需要确定对应的策略。</p>
<h2 id="4-4-观察者"><a href="#4-4-观察者" class="headerlink" title="4.4    观察者"></a>4.4    观察者</h2><h3 id="4-4-1-如何订阅一本杂志"><a href="#4-4-1-如何订阅一本杂志" class="headerlink" title="4.4.1    如何订阅一本杂志"></a>4.4.1    如何订阅一本杂志</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过讲解如何订阅杂志的生活实例，来讲解何为观察者模式。</p>
</blockquote>
<h4 id="4-4-1-1-如何订阅一本杂志"><a href="#4-4-1-1-如何订阅一本杂志" class="headerlink" title="4.4.1.1    如何订阅一本杂志"></a>4.4.1.1    如何订阅一本杂志</h4><blockquote>
<ol>
<li>通过邮局或网络查询刊物的编号</li>
<li>找到后，提供个人住址等相关信息</li>
<li>发行商在一般每月的固定时间发送刊物</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%8811.30.22.png" alt="Alt text"></p>
<h3 id="4-4-2-通知中心的抽象设计"><a href="#4-4-2-通知中心的抽象设计" class="headerlink" title="4.4.2    通知中心的抽象设计"></a>4.4.2    通知中心的抽象设计</h3><blockquote>
<p><strong>课程说明：</strong>本课时根据订阅杂志的实例，讲解如何将抽象的模型转换成代码。</p>
<ul>
<li>如何抽象接口</li>
<li>对订阅对象的约束：订阅对象必须采纳相应的协议</li>
<li>针对接口编程：先根据目标功能定好接口，然后再具体实现</li>
</ul>
</blockquote>
<p><em>SubscriptionServiceCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenterProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubscriptionServiceCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护订阅信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护客户信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加客户到具体的订阅号当中</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           客户</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从具体的订阅号中移除客户</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           &lt;#customer description#&gt;</span><br><span class="line"> *  @param subscriptionNumber &lt;#subscriptionNumber description#&gt;</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 发送消息</span></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-3-实现通知中心"><a href="#4-4-3-实现通知中心" class="headerlink" title="4.4.3    实现通知中心"></a>4.4.3    实现通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时将实现通知中心，并讲解<code>NSHashTable</code> 与<code>NSParameterAssert</code> 的使用。<br><strong>注意：</strong><code>NSHashTable</code>和<code>NSSet</code>类似，但前者可以不会强引用集合中的元素。</p>
</blockquote>
<ul>
<li>对象持有的问题<br><em>描述</em>：书刊和用户之间的联系导致用户实例无法被释放<br><em>解决</em>：用<code>NSHashTable</code>实现<code>weak</code>引用</li>
<li>参数的严格验证<br><em>描述</em>：比如参数值不允许值为<code>nil</code></li>
</ul>
<p><img src="./屏幕快照 2016-05-02 下午2.57.40.png" alt="Alt text"></p>
<h4 id="4-4-3-1-实现通知中心类"><a href="#4-4-3-1-实现通知中心类" class="headerlink" title="4.4.3.1    实现通知中心类"></a>4.4.3.1    实现通知中心类</h4><p><em>SubscriptionServiceCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"><span class="comment">// 存储订阅号的字典</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *_subscriptionDictionary = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubscriptionServiceCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化存储订阅号的字典</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == [SubscriptionServiceCenter class]) &#123;</span><br><span class="line">        _subscriptionDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取具体的订阅号</span></span><br><span class="line">+ (<span class="built_in">NSHashTable</span> *)existSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="keyword">return</span> [_subscriptionDictionary objectForKey:subscriptionNumber];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable == <span class="literal">nil</span>) &#123;</span><br><span class="line">        hashTable = [<span class="built_in">NSHashTable</span> weakObjectsHashTable];</span><br><span class="line">        [_subscriptionDictionary setObject:hashTable forKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        [_subscriptionDictionary removeObjectForKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(customer);</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable addObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable removeObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];<span class="comment">// 存储订阅号的字典</span></span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        <span class="comment">// 遍历订阅号</span></span><br><span class="line">        <span class="built_in">NSEnumerator</span> *enumerator = [hashTable objectEnumerator];</span><br><span class="line">        <span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;object = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">while</span> (object = [enumerator nextObject]) &#123;</span><br><span class="line">            <span class="comment">// 向每个订阅用户发送订阅订阅内容</span></span><br><span class="line">            <span class="keyword">if</span> ([object respondsToSelector:<span class="keyword">@selector</span>(subscriptionMessage:subscriptionNumber:)]) &#123;</span><br><span class="line">                [object subscriptionMessage:message subscriptionNumber:subscriptionNumber];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-3-2-使用通知中心"><a href="#4-4-3-2-使用通知中心" class="headerlink" title="4.4.3.2    使用通知中心"></a>4.4.3.2    使用通知中心</h4><p><em>SubscriptionServiceCenterProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SubscriptionServiceCenterProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *S<span class="built_in">CIENCE</span> = <span class="string">@"SCIENCE"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">SubscriptionServiceCenterProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅号</span></span><br><span class="line">    [SubscriptionServiceCenter createSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加订阅的用户到指定的刊物</span></span><br><span class="line">    [SubscriptionServiceCenter addCustomer:<span class="keyword">self</span></span><br><span class="line">                    withSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发型机构发送刊物</span></span><br><span class="line">    [SubscriptionServiceCenter sendMessage:<span class="string">@"V1.0"</span></span><br><span class="line">                      toSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳协议 SubscriptionServiceCenterProtocol</span></span><br><span class="line"><span class="comment">// 发行机构发送刊物时触发该方法的调用</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, message, subscriptionNumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-4-KVO与通知中心"><a href="#4-4-4-KVO与通知中心" class="headerlink" title="4.4.4    KVO与通知中心"></a>4.4.4    KVO与通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时简单介绍下 Cocoa 框架中的 KVO 与通知中心的使用。</p>
</blockquote>
<h4 id="4-4-4-1-Cocoa框架的通知中心"><a href="#4-4-4-1-Cocoa框架的通知中心" class="headerlink" title="4.4.4.1    Cocoa框架的通知中心"></a>4.4.4.1    Cocoa框架的通知中心</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>框架提供了自己的通知中心<code>API</code>，该通知中心就是通过观察者模式实现的。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加客户到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(notificationCenterEvent:)</span><br><span class="line">                                                 name:S<span class="built_in">CIENCE</span></span><br><span class="line">                                               object:<span class="string">@"v1.0"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:S<span class="built_in">CIENCE</span></span><br><span class="line">                                                        object:<span class="string">@"V1.0"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当客户收到消息时被调用的方法</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)notificationCenterEvent:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, sender);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// 从通知中心移除</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span></span><br><span class="line">                                              forKeyPath:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-4-2-KVO机制的观察者模式"><a href="#4-4-4-2-KVO机制的观察者模式" class="headerlink" title="4.4.4.2    KVO机制的观察者模式"></a>4.4.4.2    KVO机制的观察者模式</h4><blockquote>
<p><strong>说明：</strong><code>KVO</code>机制本身就是一种观察者模式。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<h5 id="通知中心"><a href="#通知中心" class="headerlink" title="通知中心"></a>通知中心</h5><p><em>Model.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h5><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Model *model;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅中心</span></span><br><span class="line">    <span class="keyword">self</span>.model = [Model new];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户添加订阅中心的"name"服务：当name属性被修改时会发送消息给观察者</span></span><br><span class="line">    [<span class="keyword">self</span>.model addObserver:<span class="keyword">self</span></span><br><span class="line">                 forKeyPath:<span class="string">@"name"</span></span><br><span class="line">                    options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">                    context:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 订阅中心发送消息（通过修改 name 属性值）</span></span><br><span class="line">    <span class="keyword">self</span>.model.name = <span class="string">@"V1.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 通过KVO该表属性时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">	<span class="comment">// 移除 KVO</span></span><br><span class="line">    [<span class="keyword">self</span>.model removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-5-原型模式和外观模式"><a href="#4-5-原型模式和外观模式" class="headerlink" title="4.5    原型模式和外观模式"></a>4.5    原型模式和外观模式</h2><h3 id="4-5-1-原型模式"><a href="#4-5-1-原型模式" class="headerlink" title="4.5.1    原型模式"></a>4.5.1    原型模式</h3><h4 id="4-5-1-1-模版的用处"><a href="#4-5-1-1-模版的用处" class="headerlink" title="4.5.1.1    模版的用处"></a>4.5.1.1    模版的用处</h4><blockquote>
<p><strong>用途：</strong>当要创建的对象有很多相似的细节的时候，就可以通过制作模版简化工作。</p>
</blockquote>
<h4 id="4-5-1-2-原型模式的原理"><a href="#4-5-1-2-原型模式的原理" class="headerlink" title="4.5.1.2    原型模式的原理"></a>4.5.1.2    原型模式的原理</h4><blockquote>
<p><strong>说明：</strong>定义一个协议，采纳该协议个类要实现<code>clone</code>方法，也就是具备拷贝自身的能力。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462191691369.png" alt="Alt text"></p>
</blockquote>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462192387967.png" alt="Alt text"></p>
<p><em>PrototypeCopyProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">PrototypeCopyProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  复制自己</span><br><span class="line"> *</span><br><span class="line"> *  @return 返回一个拷贝</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>)clone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">```	</span><br><span class="line">*StudentModel.h*</span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PrototypeCopyProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StudentModel</span> : <span class="title">NSObject</span> &lt;<span class="title">PrototypeCopyProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *address;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *totalScore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>StudentModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">StudentModel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)clone &#123;</span><br><span class="line">    <span class="comment">// 创建一个新的实例</span></span><br><span class="line">    StudentModel *student = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    <span class="comment">// 按照当前实例初始化新的实例</span></span><br><span class="line">    student.name = <span class="keyword">self</span>.name;</span><br><span class="line">    student.age = <span class="keyword">self</span>.age;</span><br><span class="line">    student.address = <span class="keyword">self</span>.address;</span><br><span class="line">    student.totalScore = <span class="keyword">self</span>.totalScore;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生1</span></span><br><span class="line">    StudentModel *stu1 = [[StudentModel alloc] init];</span><br><span class="line">    stu1.name = <span class="string">@"mengxiang"</span>;</span><br><span class="line">    stu1.age = @(<span class="number">1</span>);</span><br><span class="line">    stu1.address = <span class="string">@"海淀区"</span>;</span><br><span class="line">    stu1.totalScore = @(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生2</span></span><br><span class="line">    StudentModel *stu2 = [stu1 clone];<span class="comment">// 应用原型模式</span></span><br><span class="line">    stu2.name = <span class="string">@"Viking"</span>;</span><br><span class="line">    stu2.address = <span class="string">@"Northern Europe"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5-1-3-NSCoping协议的使用细节"><a href="#4-5-1-3-NSCoping协议的使用细节" class="headerlink" title="4.5.1.3    NSCoping协议的使用细节"></a>4.5.1.3    NSCoping协议的使用细节</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>通过<code>NSCoping</code>协议为原型模式提供了支持。<br><strong>注意：</strong></p>
<ul>
<li>深拷贝与浅拷贝</li>
<li>不支持<code>NSCopying</code>协议的对象<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462199219485.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-5-2-外观模式"><a href="#4-5-2-外观模式" class="headerlink" title="4.5.2    外观模式"></a>4.5.2    外观模式</h3><h4 id="4-5-2-1-如何去一个指定的地方"><a href="#4-5-2-1-如何去一个指定的地方" class="headerlink" title="4.5.2.1    如何去一个指定的地方"></a>4.5.2.1    如何去一个指定的地方</h4><blockquote>
<p><strong>说明：</strong>用来说明外观模式的一个显示场景</p>
<ul>
<li>自驾：自己负责路线相关的各种事务</li>
<li>坐火车：将细节交给黑盒</li>
</ul>
</blockquote>
<h4 id="4-5-2-2-外观模式的原理"><a href="#4-5-2-2-外观模式的原理" class="headerlink" title="4.5.2.2    外观模式的原理"></a>4.5.2.2    外观模式的原理</h4><blockquote>
<p><strong>说明：</strong>就是将细节封装了起来，使用时不需要了解细节<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462186013642.png" alt="Alt text"></p>
</blockquote>
<h4 id="4-5-2-3-如何绘制复杂的图形"><a href="#4-5-2-3-如何绘制复杂的图形" class="headerlink" title="4.5.2.3    如何绘制复杂的图形"></a>4.5.2.3    如何绘制复杂的图形</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462201625961.png" alt="Alt text"></p>
<h2 id="4-6-装饰"><a href="#4-6-装饰" class="headerlink" title="4.6    装饰"></a>4.6    装饰</h2><p><code>不改变原类，动态地扩展原类的功能</code></p>
<h3 id="4-6-1-照片与相框"><a href="#4-6-1-照片与相框" class="headerlink" title="4.6.1    照片与相框"></a>4.6.1    照片与相框</h3><blockquote>
<p><strong>课程说明：</strong>通过照片与相框之间的联系，来讲解何为装饰模式。</p>
</blockquote>
<h3 id="4-6-2-装饰模式的原理"><a href="#4-6-2-装饰模式的原理" class="headerlink" title="4.6.2    装饰模式的原理"></a>4.6.2    装饰模式的原理</h3><blockquote>
<p>基本原理<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410189425.png" alt="Alt text"></p>
<p>装饰起模式的优点<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410420677.png" alt="Alt text"></p>
<p> 装饰模式的使用场景</p>
</blockquote>
<p>不知道一个类的实现细节，只知道相关的接口，又需要扩展这个类的功能。</p>
<h3 id="4-6-3-实现装饰模式"><a href="#4-6-3-实现装饰模式" class="headerlink" title="4.6.3    实现装饰模式"></a>4.6.3    实现装饰模式</h3><blockquote>
<p><strong>课程说明：</strong>通过一个扩展游戏机手柄行为的事例，来实现装饰模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463490224877.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463495040772.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-6-4-category的使用"><a href="#4-6-4-category的使用" class="headerlink" title="4.6.4    category的使用"></a>4.6.4    category的使用</h3><blockquote>
<p><strong>课程说明：</strong>讲解 <code>Cocoa</code> 框架已经实现的装饰模式，并延伸讲解下如何给 <code>category</code> 添加属性。<br><strong>说明：</strong>利用<code>Objective-C</code>的动态运行时分配机制，你可以为现有的类添加方法或计算属性，这种机制称为类别(<code>category</code>)。<br><strong>注意：</strong>和装饰模式不同，这种扩展方式会导致原类型的改变。</p>
</blockquote>
<ol>
<li>原类型</li>
</ol>
<p><em>GamePad.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  上下左右的操作</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)up;</span><br><span class="line">- (<span class="keyword">void</span>)down;</span><br><span class="line">- (<span class="keyword">void</span>)left;</span><br><span class="line">- (<span class="keyword">void</span>)right;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  选择与开始的操作</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)select;</span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  按钮 A + B + X + Y</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)commandA;</span><br><span class="line">- (<span class="keyword">void</span>)commandB;</span><br><span class="line">- (<span class="keyword">void</span>)commandX;</span><br><span class="line">- (<span class="keyword">void</span>)commandY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePod.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span></span></span><br><span class="line">- (<span class="keyword">void</span>)up &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"up"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)down &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"down"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)left &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"left"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)right &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"right"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)select &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"select"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"start"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandA &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandA"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandB &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandB"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandX &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandX"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandY &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandY"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>扩展</li>
</ol>
<p><em>GamePad+Coin.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  游戏币</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span>  coin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePad+Coin.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为类和属性之间的关联key</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *_coinStr = <span class="string">@"_coinStr"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setCoin:(<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 将当前类（GamePad）和 coin 属性关联在一起</span></span><br><span class="line">    <span class="comment">// 也就是额外添加了一个属性</span></span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr, @(coin), OBJC_ASSO<span class="built_in">CIATION_ASSIGN</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 通过key扩区绑定到当前类的属性的值</span></span><br><span class="line">    <span class="built_in">NSNumber</span> *number = objc_getAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> number.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>使用扩展后的GamePod</li>
</ol>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">    GamePad *gamePad = [[GamePad alloc] init];</span><br><span class="line">    [gamePad up];</span><br><span class="line">    </span><br><span class="line">    gamePad.coin = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"coin %ld"</span>, (<span class="keyword">long</span>)gamePad.coin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-7-工厂"><a href="#4-7-工厂" class="headerlink" title="4.7    工厂"></a>4.7    工厂</h2><h3 id="4-7-1-制造手机与使用手机"><a href="#4-7-1-制造手机与使用手机" class="headerlink" title="4.7.1    制造手机与使用手机"></a>4.7.1    制造手机与使用手机</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463587653123.png" alt="Alt text"></p>
<h3 id="4-7-2-简单工厂"><a href="#4-7-2-简单工厂" class="headerlink" title="4.7.2    简单工厂"></a>4.7.2    简单工厂</h3><blockquote>
<p><strong>说明：</strong>将“产品”的生产任务封装在“工厂中”</p>
<ol>
<li>简化生产流程</li>
<li>隔离生产产品的细节</li>
<li>不同类型产品之间有着一些共同的功能</li>
<li>一个具体的工厂<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463799288205.png" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="案例：通过简单工厂获取手机实例"><a href="#案例：通过简单工厂获取手机实例" class="headerlink" title="案例：通过简单工厂获取手机实例"></a>案例：通过简单工厂获取手机实例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463798863229.png" alt="Alt text"></p>
<blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463743818102.png" alt="Alt text"></p>
<p>类图：通过</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463715567130.png" alt="Alt text|500x500"></p>
<blockquote>
<p>使用</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DeviceFactory.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过工厂创建手机</span></span><br><span class="line">    iPhoneDevice *iPhone = (iPhoneDevice *)[DeviceFactory deviceFactoryWithDeviceType:kiPhone];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用手机功能</span></span><br><span class="line">    [iPhone fingerprintIndentification];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-7-3-抽象工厂"><a href="#4-7-3-抽象工厂" class="headerlink" title="4.7.3    抽象工厂"></a>4.7.3    抽象工厂</h3><blockquote>
<p><strong>说明：</strong><code>客户端</code>通过<code>抽象工厂</code>创建具体的<code>工厂</code>，然后通过具体的<code>工厂</code>获取产品。相比简单工厂，抽象工厂多了一层抽象，在很多场景中可以比简单工厂更好地解耦。</p>
<ul>
<li>抽象工厂原理</li>
<li>抽象工厂抽象在哪里</li>
<li>抽象工厂使用场景</li>
</ul>
</blockquote>
<h4 id="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"><a href="#案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品" class="headerlink" title="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"></a>案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品</h4><blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816866737.png" alt="Alt text"></p>
<p>类图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816799001.png" alt="Alt text"></p>
<p>使用</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取工厂</span></span><br><span class="line">BaseFactory *factory = [FactoryManager factoryWithBrand:kGoogle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建商品</span></span><br><span class="line">BasePhone *phone = [factory createPhone];</span><br><span class="line">BaseWatch *watch = [factory createWatch];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, phone, watch);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-4-Cocoa-框架中的-NSNumber"><a href="#4-7-4-Cocoa-框架中的-NSNumber" class="headerlink" title="4.7.4    Cocoa 框架中的 NSNumber"></a>4.7.4    Cocoa 框架中的 NSNumber</h3><blockquote>
<p><strong>说明：</strong><code>NSNumber</code>本身是一个抽象工厂类，直接通过该类<code>init</code>一个实例会获得一个<code>nil</code>。<code>NSNumber</code>提供了一系列工厂方法来获取针对具体数值类型的工厂。<br><strong>注意：</strong><code>NSNumber</code>是针对<code>数值</code>的抽象工厂，产品是各种<code>数值</code>类型，而且这些<code>数值</code>之间可以进行类型转换。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于NSNumber是一个抽象工厂，这里只会返回一个 nil</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[<span class="built_in">NSNumber</span> alloc] init]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建具体的工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *number = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">100</span>];<span class="comment">// 通过Int类型的100获取一个工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *floatValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">100.</span>f];<span class="comment">// 通过浮点数100.f获取一个工厂实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用工厂实例生产具体的产品（具体类型的数字）</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [number charValue]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [floatValue charValue]);</span><br></pre></td></tr></table></figure>
<h2 id="4-8-桥接"><a href="#4-8-桥接" class="headerlink" title="4.8    桥接"></a>4.8    桥接</h2><blockquote>
<p><strong>说明：</strong>两类存在通信的实体，其实例实现各自的协议，两类实体的实例就可以正确通信。这种设计方式解耦了通信协议的定义和具体实例的实现。</p>
</blockquote>
<h3 id="4-8-1-遥控器与电视机"><a href="#4-8-1-遥控器与电视机" class="headerlink" title="4.8.1 遥控器与电视机"></a>4.8.1 遥控器与电视机</h3><blockquote>
<p><strong>例子：</strong>为遥控器和电视机分别定义了协议，采纳了协议的具体的遥控器和电视机之间只需完成各自的实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463818469080.png" alt="Alt text|400x250"></p>
</blockquote>
<h3 id="4-8-2-桥接模式原理"><a href="#4-8-2-桥接模式原理" class="headerlink" title="4.8.2 桥接模式原理"></a>4.8.2 桥接模式原理</h3><blockquote>
<p><strong>目的：</strong> 把抽象层次结构从具体的实现分离出来，使其能够独立变更。<br><strong>抽象层：</strong>定义了共客户端使用的上层抽象接口。<br><strong>实现层：</strong>定义了供抽象层使用的底层接口。<br><strong>桥接：</strong>实现类的引用被封装到抽象层的实例中，桥接就形成了。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839147515.png" alt="Alt text"></p>
<h3 id="4-8-3-设计游戏机模拟器"><a href="#4-8-3-设计游戏机模拟器" class="headerlink" title="4.8.3 设计游戏机模拟器"></a>4.8.3 设计游戏机模拟器</h3><ul>
<li>游戏机模拟器的功能定义</li>
<li>按钮协议的制定</li>
<li>游戏机模拟器的实现<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839248044.png" alt="Alt text"></li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463845234221.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GBA系统 ＋ GBA执行器 */</span></span><br><span class="line"><span class="comment">// 创建GBA系统</span></span><br><span class="line">AbstractSystem *gbaSystem = [[GBASystem alloc] init];</span><br><span class="line"><span class="comment">// 设置GBA执行器</span></span><br><span class="line">gbaSystem.implementor = [[GBAImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[gbaSystem loadSystem];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* PSP系统 ＋ PSP执行器 */</span></span><br><span class="line"><span class="comment">// 创建PSP系统</span></span><br><span class="line">AbstractSystem *pspSystem = [[PSPSystem alloc] init];</span><br><span class="line"><span class="comment">// 设置PSP执行器</span></span><br><span class="line">pspSystem.implementor = [[PSPImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[pspSystem loadSystem];</span><br></pre></td></tr></table></figure>
<h2 id="4-9-代理"><a href="#4-9-代理" class="headerlink" title="4.9    代理"></a>4.9    代理</h2><h3 id="4-9-1-代理模式"><a href="#4-9-1-代理模式" class="headerlink" title="4.9.1 代理模式"></a>4.9.1 代理模式</h3><blockquote>
<p><strong>说明：</strong>当一个对象和另一个对象必然耦合的时候，为了降低这种耦合，可以选择和代理对象耦和。代理对象可以是实现了代理协议的任意对象，由于采纳代理协议的对象相比具体对象更灵活且可配置，从而降低了耦和度。<br><strong>注意：</strong>代理对象建议修饰为<code>weak</code>，从而有助于减低消耗。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464019108656.png" alt="Alt text"></p>
<h4 id="案例：顾客和经销商"><a href="#案例：顾客和经销商" class="headerlink" title="案例：顾客和经销商"></a>案例：顾客和经销商</h4><blockquote>
<p>顾客的购买行为代理给经销商</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463899846934.png" alt="Alt text"></p>
<p><em>Customer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Customer</span>;</span></span><br><span class="line"><span class="comment">// 代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CustomerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Customer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理对象(经销商)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;CustomerDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购买</span></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Cosutomer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Customer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="comment">// 确保设置了代理对象，且代理对象正确采纳了协议</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(customer:buyItemCount:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate customer:<span class="keyword">self</span></span><br><span class="line">                   buyItemCount:count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Dealer</span> : <span class="title">NSObject</span> &lt;<span class="title">CustomerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dealer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议，实现方法</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, (<span class="keyword">long</span>)count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 顾客</span></span><br><span class="line">    Customer *customer = [[Customer alloc] init];</span><br><span class="line">    <span class="comment">// 经销商</span></span><br><span class="line">    Dealer *dealer = [[Dealer alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将经销商实例做为代理对象</span></span><br><span class="line">    customer.delegate = dealer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户购买（会代理到dealer的相应方法去处理）</span></span><br><span class="line">    [customer buyItemCount:<span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-2-代理与协议"><a href="#4-9-2-代理与协议" class="headerlink" title="4.9.2 代理与协议"></a>4.9.2 代理与协议</h3><blockquote>
<p><code>代理对象</code>本质上是<code>让对象采纳协议</code>的一种特殊情况。和单纯要求对象采纳某种协议相比，代理对象承担者完成代理任务的同时降低与被调用者之间的耦和度的职能。</p>
</blockquote>
<h4 id="案例：单纯使用协议"><a href="#案例：单纯使用协议" class="headerlink" title="案例：单纯使用协议"></a>案例：单纯使用协议</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463922342138.png" alt="Alt text"></p>
<p><em>TCPProtocol.h</em></p>
<blockquote>
<p><strong>说明：</strong>定义协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TCPProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">// 获取源端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort;</span><br><span class="line"><span class="comment">// 获取目的地端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.h</em></p>
<blockquote>
<p><strong>说明：</strong>采纳协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span> &lt;<span class="title">TCPProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<blockquote>
<p><strong>说明：</strong>实现协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> sourcePort;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 tcp 数据源</span></span><br><span class="line">    Model *tcpData = [[Model alloc] init];</span><br><span class="line">    <span class="comment">// 通过 tcp 数据源获取 tcp 数据</span></span><br><span class="line">    [<span class="keyword">self</span> accessTCPData:tcpData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取 tcp 数据</span><br><span class="line"> *</span><br><span class="line"> *  @param data 采纳了 TCP 协议的数据</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessTCPData:(<span class="keyword">id</span> &lt;TCPProtocol&gt;)data &#123;</span><br><span class="line">    <span class="keyword">self</span>.sourcePort = [data sourcePort];</span><br><span class="line">    <span class="keyword">self</span>.destinationPort = [data destinationPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-3-用NSProxy-实现的代理模式"><a href="#4-9-3-用NSProxy-实现的代理模式" class="headerlink" title="4.9.3 用NSProxy 实现的代理模式"></a>4.9.3 用NSProxy 实现的代理模式</h3><blockquote>
<p><code>NSProxy</code>：没有父类，和<code>NSObject</code>是一个级别的<br><strong>用途：</strong>可以方便地向代理对象发送一系列消息。</p>
</blockquote>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464018921308.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建代理</span></span><br><span class="line">ConcreteProxy *proxy = [ConcreteProxy alloc];</span><br><span class="line"><span class="comment">// 设置代理对象</span></span><br><span class="line">proxy.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 派发消息</span></span><br><span class="line">[proxy helloWorld];</span><br><span class="line">[proxy goodBye];</span><br></pre></td></tr></table></figure>
<h2 id="4-10-单例"><a href="#4-10-单例" class="headerlink" title="4.10    单例"></a>4.10    单例</h2><h3 id="4-10-1-单例模式"><a href="#4-10-1-单例模式" class="headerlink" title="4.10.1 单例模式"></a>4.10.1 单例模式</h3><h4 id="单例模式的基本原理"><a href="#单例模式的基本原理" class="headerlink" title="单例模式的基本原理"></a>单例模式的基本原理</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464186654392.png" alt="Alt text"></p>
<h4 id="单例模式用以解决何种问题"><a href="#单例模式用以解决何种问题" class="headerlink" title="单例模式用以解决何种问题"></a>单例模式用以解决何种问题</h4><blockquote>
<p>保证某个类只会存在一个全局的实例，全局共享</p>
</blockquote>
<h4 id="单例模式的优缺点"><a href="#单例模式的优缺点" class="headerlink" title="单例模式的优缺点"></a>单例模式的优缺点</h4><ul>
<li>优点：共享实例</li>
<li>缺点：使使用到单例实例的类之间耦和在一起</li>
</ul>
<h4 id="案例：存储用户信息的单例类"><a href="#案例：存储用户信息的单例类" class="headerlink" title="案例：存储用户信息的单例类"></a>案例：存储用户信息的单例类</h4><p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取单例</span><br><span class="line"> *</span><br><span class="line"> *  @return 单例实例</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="comment">// 使用全局变量保存单例实例</span></span><br><span class="line">    <span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predict;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predict, ^&#123;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>使用</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, center.name);</span><br></pre></td></tr></table></figure>
<h3 id="4-10-2-编写严格的单例"><a href="#4-10-2-编写严格的单例" class="headerlink" title="4.10.2 编写严格的单例"></a>4.10.2 编写严格的单例</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>防止继承：在<code>init</code>构造器中判断当前类名，当子类调用<code>init</code>或工厂方法创建实例时中断程序</li>
<li>确保实例对象只出现一个：限制<code>init</code>构造器只能在获取实例的工厂方法中调用，而且只调用一次</li>
</ul>
</blockquote>
<p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"><span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predicate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predicate, ^&#123;</span><br><span class="line">        center = (UserInfoManagerCenter *)<span class="string">@"UserInfoManagerCenter"</span>;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">    <span class="comment">// 获取当前实例的类名</span></span><br><span class="line">    <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="comment">// 是子类调用该方法则中断程序</span></span><br><span class="line">    <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *string = (<span class="built_in">NSString</span> *)center;</span><br><span class="line">    <span class="keyword">if</span> ([string isKindOfClass:[<span class="built_in">NSString</span> class]] == <span class="literal">YES</span> &amp;&amp; [string isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">            <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">            <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">            <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 正确获取单例的方法 */</span></span><br><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无效的方式:会引起程序崩溃 */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [NewManagerCenter managerCenter]);<span class="comment">// 试图创建子类实例</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[UserInfoManagerCenter alloc] init]);<span class="comment">// 试图直接调用构造器</span></span><br></pre></td></tr></table></figure>
<h3 id="4-10-3-优化本地存储"><a href="#4-10-3-优化本地存储" class="headerlink" title="4.10.3 优化本地存储"></a>4.10.3 优化本地存储</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>用单例设计存储数据接口</li>
<li>用单例接口隔离实现细节</li>
<li>在单例提供接口的基础上进行上层封装</li>
</ul>
<p><strong>扩展：</strong>使用<a href="https://github.com/nicklockwood/FastCoding" target="_blank" rel="external"> FastCoding </a>替代<code>NSCoding</code>存储数据<br><strong>注意：</strong>启用<code>ARC</code>时<code>FastCoding</code>运行会比较慢，建议关闭</p>
<ul>
<li>文件启用了<code>ARC</code>是代码给出了警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464361708327.png" alt="Alt text"></li>
<li>通过关闭<code>FastCoder</code>对应的文件的<code>ARC</code>清除警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464362026510.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464364328834.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将相对复杂的对象数据存储到用户首选项（借由对象的扩展）</span></span><br><span class="line">StudentModel *student = [[StudentModel alloc] init];</span><br><span class="line">student.name = <span class="string">@"A"</span>;</span><br><span class="line"><span class="built_in">NSArray</span> *array = @[[InfoModel new], [InfoModel new], [InfoModel new]];</span><br><span class="line">student.datas = array;</span><br><span class="line">[student storeValueWithKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从用户首选项中取出数据</span></span><br><span class="line">StudentModel *tmpStudent = [StudentModel valueByKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.name);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.datas);</span><br></pre></td></tr></table></figure>
<h2 id="4-11-备忘录"><a href="#4-11-备忘录" class="headerlink" title="4.11    备忘录"></a>4.11    备忘录</h2><h3 id="4-11-1-如何存储记录"><a href="#4-11-1-如何存储记录" class="headerlink" title="4.11.1    如何存储记录"></a>4.11.1    如何存储记录</h3><blockquote>
<p><strong>课程说明：</strong>用几个简单的示例来说明如何存储纪录，并引申出什么是备忘录模式。</p>
</blockquote>
<ul>
<li>存储记录的必要性</li>
<li>记录的唯一标识符</li>
<li>存储纪录和取出记录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447294270.png" alt="Alt text"></li>
</ul>
<h3 id="4-11-2-备忘录模式"><a href="#4-11-2-备忘录模式" class="headerlink" title="4.11.2 备忘录模式"></a>4.11.2 备忘录模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464417280472.png" alt="Alt text"></p>
<ul>
<li>设计存储中心</li>
<li>制定存储接口</li>
<li>实现存储机制</li>
</ul>
<h3 id="4-11-3-优化存储方案"><a href="#4-11-3-优化存储方案" class="headerlink" title="4.11.3    优化存储方案"></a>4.11.3    优化存储方案</h3><ul>
<li>统一存储规范</li>
<li>实现灵活多变的存储机制</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464445381861.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Apple *apple = [[Apple alloc] init];</span><br><span class="line">apple.name = <span class="string">@"laputa-er"</span>;</span><br><span class="line">apple.age = @(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[apple saveStateWithKey:<span class="string">@"birth"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复到指定的状态</span></span><br><span class="line">[apple recoverFromStateWithKey:<span class="string">@"birth"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="4-11-4-恢复-UIView-的状态"><a href="#4-11-4-恢复-UIView-的状态" class="headerlink" title="4.11.4    恢复 UIView 的状态"></a>4.11.4    恢复 UIView 的状态</h3><blockquote>
<p><strong>摘要：</strong>可以借助上面实现的备忘录模式存储／恢复<code>UIView</code>的状态。</p>
</blockquote>
<h4 id="存储UIView的问题"><a href="#存储UIView的问题" class="headerlink" title="存储UIView的问题"></a>存储UIView的问题</h4><ol>
<li><code>UIView</code>实现了<code>NSCoding</code>协议，但没有实现<code>NSCopy</code>协议。所以，<code>UIView</code>可以被存储下来，但无法拷贝副本</li>
<li><code>NSCoding</code>协议只能存储对象的所有数据，不能仅存储特定的状态数据（比如<code>frame</code>值）</li>
</ol>
<h4 id="使用备忘录模式"><a href="#使用备忘录模式" class="headerlink" title="使用备忘录模式"></a>使用备忘录模式</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 UIView</span></span><br><span class="line">DemoView *demoView = [[DemoView alloc] init];</span><br><span class="line">demoView.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[demoView saveStateWithKey:<span class="string">@"A"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复状态</span></span><br><span class="line">[demoView recoverFromStateWithKey:<span class="string">@"A"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="4-12-生成器"><a href="#4-12-生成器" class="headerlink" title="4.12    生成器"></a>4.12    生成器</h2><blockquote>
<p><strong>说明：</strong>有时，构建某些对象有多种不同的方式。如果这些逻辑包含在构建这些对象的类的单一方法中，构建的逻辑会非常的荒唐（例如，针对各种构建需求的一大片 <code>if-else</code> 或者 <code>switch-case</code> 语句）。如果能够把构建过程分解为<code>客户-指导者-生成器</code>的关系，那么过程将更容易管理与复用。针对此类关系的设计模式称为<code>生成器</code>。</p>
</blockquote>
<h3 id="4-12-1-建造房子的承包商"><a href="#4-12-1-建造房子的承包商" class="headerlink" title="4.12.1 建造房子的承包商"></a>4.12.1 建造房子的承包商</h3><blockquote>
<p><strong>课程说明：</strong>本课时用一个生活中建造房子例子说明并引申出何为生成器模式</p>
<ul>
<li>如何建造房子</li>
<li>建造过程的模块化处理 </li>
<li>不同模块找不同的承包商</li>
</ul>
<p><strong>使用生成器模式的优点：</strong></p>
<ul>
<li>不需要知道细节</li>
<li>模块化处理</li>
<li>很好的组合特性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-12-2-生成器模式"><a href="#4-12-2-生成器模式" class="headerlink" title="4.12.2 生成器模式"></a>4.12.2 生成器模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447882554.png" alt="Alt text"></p>
<h3 id="4-12-3-制造汽车的流程"><a href="#4-12-3-制造汽车的流程" class="headerlink" title="4.12.3 制造汽车的流程"></a>4.12.3 制造汽车的流程</h3><blockquote>
<p><strong>说明：</strong>使用生成器模式来制造一辆汽车。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500610532.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500840393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建组装着（指挥者）</span></span><br><span class="line"><span class="keyword">self</span>.builder = [[Builder alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定承包商</span></span><br><span class="line"><span class="keyword">self</span>.builder.engine = [[YEngine alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.wheels = [[Wheels alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.door = [[Door alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构件所有部件</span></span><br><span class="line">[<span class="keyword">self</span>.builder buildAllParts];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取产品信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.builder.productsInfo);</span><br></pre></td></tr></table></figure>
<h2 id="4-13-命令"><a href="#4-13-命令" class="headerlink" title="4.13    命令"></a>4.13    命令</h2><blockquote>
<p><strong>命令模式：</strong>在软件系统中，<code>行为请求者</code>与<code>行为执行者</code>通常呈现一种“紧耦合”。但在某些场合，比如要对行为进行<code>记录、撤销/重做、事务</code>等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将<code>行为请求者</code>与<code>行为执行者</code>解耦，将行为抽象成对象，实现两者之间的松耦合，这就是我们这门课程所要讲的<code>命令模式</code>。 </p>
</blockquote>
<h3 id="4-13-1-电视机、遥控器与接收器之间的关系"><a href="#4-13-1-电视机、遥控器与接收器之间的关系" class="headerlink" title="4.13.1 电视机、遥控器与接收器之间的关系"></a>4.13.1 电视机、遥控器与接收器之间的关系</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="Alt text"></p>
<ul>
<li>遥控器与接收器并非必要的设备</li>
<li>接收器转换遥控器的信号</li>
</ul>
<h3 id="4-13-2-命令模式"><a href="#4-13-2-命令模式" class="headerlink" title="4.13.2 命令模式"></a>4.13.2 命令模式</h3><ul>
<li>命令的发送者和命令的执行者之间完全解耦</li>
<li>命令可以回退（撤销）</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464515129490.png" alt="Alt text"></p>
<h3 id="4-13-3-改变一个视图的明暗程度"><a href="#4-13-3-改变一个视图的明暗程度" class="headerlink" title="4.13.3 改变一个视图的明暗程度"></a>4.13.3 改变一个视图的明暗程度</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331xcode.gif" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464531258992.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Receiver.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Invoker.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DarkerCommand.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LighterCommand.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 按钮的tag</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSInteger</span> &#123;</span><br><span class="line">    kAddButtonTag = <span class="number">10</span>, <span class="comment">// 增加按钮tag枚举值</span></span><br><span class="line">    kDelButtonTag, <span class="comment">// 减少按钮tag枚举值</span></span><br><span class="line">    kRolButtonTag, <span class="comment">// 回退按钮tag枚举值</span></span><br><span class="line">&#125; ViewControllerEnumValue;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *addButton;<span class="comment">// 增加亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *delButton;<span class="comment">// 减少亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *rolButton;<span class="comment">// 退回按钮</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Receiver *receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化接收器</span></span><br><span class="line">    <span class="keyword">self</span>.receiver = [[Receiver alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.receiver.clientView = <span class="keyword">self</span>.view;<span class="comment">// 关联客户端视图（遥控器）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButtons];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButtons &#123;</span><br><span class="line">    <span class="comment">/*1. 初始化按钮*/</span></span><br><span class="line">    <span class="comment">// 减少亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.delButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.delButton.tag = kDelButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.delButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitle:<span class="string">@"-"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.addButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">40</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.addButton.tag = kAddButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.addButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitle:<span class="string">@"+"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 回退按钮</span></span><br><span class="line">    <span class="keyword">self</span>.rolButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">80</span>, <span class="number">25</span>, <span class="number">90</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.rolButton.tag = kRolButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.rolButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitle:<span class="string">@"回退"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*2. 注册事件*/</span></span><br><span class="line">    [<span class="keyword">self</span>.delButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*3. 添加到视图*/</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.delButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.rolButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  为按钮绑定事件</span><br><span class="line"> *</span><br><span class="line"> *  @param button 需要绑定事件的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    <span class="keyword">if</span> (button.tag == kAddButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"增加亮度"</span>);</span><br><span class="line">        LighterCommand *command = [[LighterCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                 parameter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];<span class="comment">// 添加并执行命令</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kDelButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"减少亮度"</span>);</span><br><span class="line">        DarkerCommand *command = [[DarkerCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                paramter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kRolButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"回退操作"</span>);</span><br><span class="line">        [[Invoker shareInstance] rollBack];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-14-组合"><a href="#4-14-组合" class="headerlink" title="4.14    组合"></a>4.14    组合</h2><blockquote>
<p><strong>说明：</strong>将对象组合成树形结构以表示<code>部分-整体</code>的层次结构，组合模式使得用户对单个对象和组合对象的使用具有一致性。组合设计模式可以解决某些线性结构无法解决的难题（如编写文件夹目录结构等类似问题），掌握它具有很实用的意义。 </p>
</blockquote>
<h3 id="4-14-1-树形结构"><a href="#4-14-1-树形结构" class="headerlink" title="4.14.1    树形结构"></a>4.14.1    树形结构</h3><blockquote>
<p><strong>课程说明：</strong>讲解树形结构，并实现一个简易的二叉树，对于后续的组合设计模式的理解很有帮助。</p>
<ul>
<li>树形结构原理</li>
<li>简易的二叉树</li>
<li>用递归遍历树形结构节点</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464533251952.png" alt="Alt text|200x300"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当前节点名</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  左节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *leftNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  右节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rightNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    <span class="comment">// 创建节点实例（考虑子类的情况，使用 self class 创建实例）</span></span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  根节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rootNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建根节点</span></span><br><span class="line">    <span class="keyword">self</span>.rootNode = [Node nodeWithName:<span class="string">@"A"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"B"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"C"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"D"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"E"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"F"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历二叉树</span></span><br><span class="line">    [<span class="keyword">self</span> treeInfomationWithNode:<span class="keyword">self</span>.rootNode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  往根节点上插入节点</span><br><span class="line"> *</span><br><span class="line"> *  @param tree 根节点</span><br><span class="line"> *  @param node 被插入的节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)insertNodeTree:(Node *)tree node:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tree.leftNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.leftNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (tree.rightNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.rightNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:tree.leftNode node:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遍历二叉树</span><br><span class="line"> *</span><br><span class="line"> *  @param node 根节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)treeInfomationWithNode:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node.leftNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.leftNode];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.nodeName);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (node.rightNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.rightNode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-2-组合模式"><a href="#4-14-2-组合模式" class="headerlink" title="4.14.2    组合模式"></a>4.14.2    组合模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464611058484.png" alt="Alt text"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  节点名字</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加子节点</span><br><span class="line"> *</span><br><span class="line"> *  @param nodes 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)nodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  删除字节点</span><br><span class="line"> *</span><br><span class="line"> *  @param node 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  打印 Node</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)operation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-3-编写文件夹系统"><a href="#4-14-3-编写文件夹系统" class="headerlink" title="4.14.3 编写文件夹系统"></a>4.14.3 编写文件夹系统</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464616045947.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464676034326.png" alt="Alt text"></p>
<h2 id="4-15-迭代器"><a href="#4-15-迭代器" class="headerlink" title="4.15    迭代器"></a>4.15    迭代器</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示，这种模式叫迭代器模式，<code>Cocoa</code> 框架中的 <code>NSEnumerator</code> 就是迭代器模式的具体实现。学习迭代器模式有助于理解线性表结构的常规使用，对于优化具备线性表结构的类有实际意义。 </p>
</blockquote>
<h3 id="4-15-1-线性表"><a href="#4-15-1-线性表" class="headerlink" title="4.15.1 线性表"></a>4.15.1 线性表</h3><blockquote>
<p><strong>课程说明：</strong>讲解常用线性表基本原理，对于理解何为迭代器模式很有帮助。<br><strong>线性表：</strong>线性表中数据元素之间的关系是一对一的关系，即除了第一个和最后一个数据元素之外，其它数据元素都是首尾相接的（注意，这句话只适用大部分线性表，而不是全部。比如，循环链表逻辑层次上也是一种线性表（存储层次上属于链式存储），但是把最后一个数据元素的尾指针指向了哨位结点）。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700648380.png" alt="Alt text"></p>
<blockquote>
<p>栈和队列就是典型的线性表<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700681237.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-15-2-迭代器模式"><a href="#4-15-2-迭代器模式" class="headerlink" title="4.15.2 迭代器模式"></a>4.15.2 迭代器模式</h3><blockquote>
<p><strong>课程说明：</strong>讲解迭代器模式基本原理，并简单介绍下 <code>Cocoa</code> 框架已经实现的迭代器。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464708309582.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 系统自身的集合和迭代器 */</span></span><br><span class="line"><span class="comment">// 创建集合对象</span></span><br><span class="line"><span class="built_in">NSArray</span> *datas = @[<span class="string">@"A"</span>, <span class="string">@"B"</span>, <span class="string">@"C"</span>, <span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *iterator = [datas objectEnumerator];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器访问元素</span></span><br><span class="line"><span class="keyword">id</span> arrObj = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (arrObj = [iterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, arrObj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义的集合和迭代器 */</span></span><br><span class="line"><span class="keyword">self</span>.list = [[LinkedList alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"A"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"B"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"C"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line">LinkedListIterator *linkedIterator = [LinkedListIterator linkedListIteratorWithLinkedList:<span class="keyword">self</span>.list];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器遍历元素</span></span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (node = [linkedIterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-15-3-实现组合对象的迭代器"><a href="#4-15-3-实现组合对象的迭代器" class="headerlink" title="4.15.3 实现组合对象的迭代器"></a>4.15.3 实现组合对象的迭代器</h3><blockquote>
<p><strong>课程说明：</strong>实现一个组合对象的迭代器，并遍历出该组合对象中我们需要关心的元素。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464751736763.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Custom<span class="built_in">UIView</span> *custom<span class="built_in">UIView</span> = [[Custom<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">[custom<span class="built_in">UIView</span> resetIterator];</span><br><span class="line"><span class="keyword">while</span> (node = [custom<span class="built_in">UIView</span> nextObject]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">100</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
