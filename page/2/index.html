<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/2/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/2/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/16/imooc_iOS_iOS9新特性之UIStackView/" itemprop="url">
                  iOS9新特性之UIStackView
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-16T10:20:24+08:00" content="2016-06-16">
              2016-06-16
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/16/imooc_iOS_iOS9新特性之UIStackView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/16/imooc_iOS_iOS9新特性之UIStackView/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>视频：</strong><a href="http://www.imooc.com/learn/568" target="_blank" rel="external">http://www.imooc.com/learn/568</a><br><strong>源码：</strong><a href="https://git.coding.net/eli01/imooc_UIStackView.git" target="_blank" rel="external">https://git.coding.net/eli01/imooc_UIStackView.git</a></p>
</blockquote>
<h1 id="1-学习指南"><a href="#1-学习指南" class="headerlink" title="1    学习指南"></a>1    学习指南</h1><blockquote>
<p><strong>说明：</strong><code>iOS</code>设备屏幕尺寸日益多样化，随之而来的是屏幕适配日益复杂。为了解决这个问题，<code>iOS9</code>推出了<code>Stack View</code>。</p>
</blockquote>
<h1 id="2-UIStackView效果实现"><a href="#2-UIStackView效果实现" class="headerlink" title="2    UIStackView效果实现"></a>2    UIStackView效果实现</h1><h2 id="2-1-UIStackView属性介绍"><a href="#2-1-UIStackView属性介绍" class="headerlink" title="2.1    UIStackView属性介绍"></a>2.1    UIStackView属性介绍</h2><blockquote>
<p><strong>说明：</strong>一些常用的属性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8810.47.51.png" alt="Alt text"></p>
</blockquote>
<h2 id="2-2-美团效果实现"><a href="#2-2-美团效果实现" class="headerlink" title="2.2    美团效果实现"></a>2.2    美团效果实现</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.07.12.png" alt="Alt text"></p>
<h2 id="2-3-大众点评子控件代码实现"><a href="#2-3-大众点评子控件代码实现" class="headerlink" title="2.3    大众点评子控件代码实现"></a>2.3    大众点评子控件代码实现</h2><blockquote>
<p><strong>说明：</strong>通过代码（而不是<code>Storyboard</code>）创建并添加该组件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-18%20%E4%B8%8B%E5%8D%8811.47.24.png" alt="Alt text"><br><strong>注意：</strong>向<code>UIStackView</code>中添加子控件的时候要使用<code>addArrangedSubview</code>而不是<code>addSubview</code>，因为前者会保留控件作为<code>Stack View</code>子控件的特性</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">/* 1. 最外部UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackView = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">50</span>)];<span class="comment">// 创建Stack View</span></span><br><span class="line">    stackView.axis = <span class="built_in">UILayoutConstraintAxisHorizontal</span>;<span class="comment">// 设置为水平排列</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 2. 左边图片 */</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    imgView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img1.png"</span>];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/* 3. 右边子UIStackView */</span></span><br><span class="line">    <span class="built_in">UIStackView</span> *stackViewSub = [[<span class="built_in">UIStackView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">50</span>)];</span><br><span class="line">    stackViewSub.axis = <span class="built_in">UILayoutConstraintAxisVertical</span>;</span><br><span class="line">    <span class="comment">// 内部3个控件</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    imgView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"img2.png"</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label1 = [[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">38</span>, <span class="number">10</span>)];</span><br><span class="line">    label1.text = <span class="string">@"人均¥18"</span>;</span><br><span class="line">    label1.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">12.0</span>];</span><br><span class="line">    <span class="built_in">UILabel</span> *label2 =[[<span class="built_in">UILabel</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">10</span>)];</span><br><span class="line">    label2.text = <span class="string">@"口味21环境21价格18"</span>;</span><br><span class="line">    label2.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">10.0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 4. 组合 */</span></span><br><span class="line">    <span class="comment">// 3个控件添加到内部Stack View</span></span><br><span class="line">    [stackViewSub addArrangedSubview:imgView2];</span><br><span class="line">    [stackViewSub addArrangedSubview:label1];</span><br><span class="line">    [stackViewSub addArrangedSubview:label2];</span><br><span class="line">    <span class="comment">// 添加左边的图片到外部的Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:imgView];</span><br><span class="line">    <span class="comment">// 添加内部的 Stack View到外部的 Stack View</span></span><br><span class="line">    [stackView addArrangedSubview:stackViewSub];</span><br><span class="line">    <span class="comment">// 将最外层的stackView添加到View Controller</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:stackView]; </span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-UIStackView使用要点"><a href="#2-4-UIStackView使用要点" class="headerlink" title="2.4    UIStackView使用要点"></a>2.4    UIStackView使用要点</h2><p>无干货</p>
<h1 id="3-总结与预告"><a href="#3-总结与预告" class="headerlink" title="3    总结与预告"></a>3    总结与预告</h1><p>无干货</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_WEB_带你学习pug模版引擎/" itemprop="url">
                  带你学习pug模版引擎
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T22:23:30+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/15/imooc_WEB_带你学习pug模版引擎/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/15/imooc_WEB_带你学习pug模版引擎/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-课程简介"><a href="#1-课程简介" class="headerlink" title="1    课程简介"></a>1    课程简介</h1><blockquote>
<p><strong>模版引擎：</strong>将动态的数据和静态的页面糅合在一起的实现机制或技术<br><strong>流行的模版：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>实现语言</th>
<th>模版引擎例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP</td>
<td><code>Smarty</code>、<code>SimpleTemplate</code>、 <code>Xtemplate</code>、 <code>Savant</code></td>
</tr>
<tr>
<td>Java</td>
<td><code>Velocity</code>、 <code>FreeMarker</code>、 <code>Jbyte</code></td>
</tr>
<tr>
<td>C#</td>
<td><code>Dotliquid</code>、 <code>SharpDom</code>、 <code>Razor</code></td>
</tr>
<tr>
<td>JavaScript</td>
<td><code>Mustache</code>、 <code>Handlebars</code>、 <code>Juicer</code>、 <code>Xtemplate</code>、 <code>EJS</code>、 <code>pug</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>官网：</strong><a href="http://pug-lang.com/" target="_blank" rel="external">http://pug-lang.com/</a><br><strong>提示：</strong><code>jade</code>改名为<code>pug</code>了</p>
</blockquote>
<h2 id="1-1-pug环境配置"><a href="#1-1-pug环境配置" class="headerlink" title="1.1    pug环境配置"></a>1.1    pug环境配置</h2><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><ul>
<li>升级 mac 系统到最新</li>
<li>升级 xcode 及 xcode command line tools 到最新</li>
<li>安装 homebrew</li>
<li>通过 homebrew 安装 git 和 <a href="https://github.com/tj/n" target="_blank" rel="external">node</a></li>
<li>通过 npm 安装 pug<br><code>npm i -g pug</code></li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul>
<li>安装 node 可执行文件</li>
<li>通过 cygwin, 及可能的 openssl、g++-gcc、python、git等</li>
<li>通过 npm 安装 pug<br><code>npm install -g pug</code></li>
</ul>
<h2 id="1-2-pug特点"><a href="#1-2-pug特点" class="headerlink" title="1.2    pug特点"></a>1.2    pug特点</h2><ol>
<li>超强的可读性</li>
<li>灵活易用的缩进</li>
<li>块扩展</li>
<li>代码默认经过编码处理，以增强安全性</li>
<li>编译及运行时的上下文错误报告</li>
<li>命令行编译支持</li>
<li>HTML5模式（使用!!!5文档类型）</li>
<li>可选的内存缓存</li>
<li>联合动态的静态标记类</li>
<li>利用过滤器解析树的处理</li>
</ol>
<h2 id="1-3-pug的诞生"><a href="#1-3-pug的诞生" class="headerlink" title="1.3    pug的诞生"></a>1.3    pug的诞生</h2><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-18%20%E4%B8%8B%E5%8D%8810.40.40.png" alt="pug环境|150x150"></p>
<h3 id="1-4-命令行中的-pug"><a href="#1-4-命令行中的-pug" class="headerlink" title="1.4    命令行中的 pug"></a>1.4    命令行中的 pug</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install pug -g --client</span><br><span class="line">$ pug --help</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Usage: pug [options] [dir|file ...]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">  -h, --help             output usage information</span><br><span class="line">  -V, --version          output the version number</span><br><span class="line">  -O, --obj &lt;str|path&gt;   JavaScript options object or JSON file containing it</span><br><span class="line">  -o, --out &lt;dir&gt;        output the compiled html to &lt;dir&gt;</span><br><span class="line">  -p, --path &lt;path&gt;      filename used to resolve includes</span><br><span class="line">  -P, --pretty           compile pretty html output</span><br><span class="line">  -c, --client           compile <span class="keyword">function</span> <span class="keyword">for</span> client-side runtime.js</span><br><span class="line">  -n, --name &lt;str&gt;       The name of the compiled template (requires --client)</span><br><span class="line">  -D, --no-debug         compile without debugging (smaller <span class="built_in">functions</span>)</span><br><span class="line">  -w, --watch            watch files <span class="keyword">for</span> changes and automatically re-render</span><br><span class="line">  -E, --extension &lt;ext&gt;  specify the output file extension</span><br><span class="line">  -H, --hierarchy        keep directory hierarchy when a directory is specified</span><br><span class="line">  --name-after-file      Name the template after the last section of the file path (requires --client and overriden by --name)</span><br><span class="line">  --doctype &lt;str&gt;        Specify the doctype on the <span class="built_in">command</span> line (useful <span class="keyword">if</span> it is not specified by the template)</span><br></pre></td></tr></table></figure>
<h1 id="2-pug基础语法知识"><a href="#2-pug基础语法知识" class="headerlink" title="2    pug基础语法知识"></a>2    pug基础语法知识</h1><h2 id="2-1-文档声明和头尾标签"><a href="#2-1-文档声明和头尾标签" class="headerlink" title="2.1    文档声明和头尾标签"></a>2.1    文档声明和头尾标签</h2><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 imooc hade study</span><br></pre></td></tr></table></figure>
<h2 id="2-2-实现命令行实时编译"><a href="#2-2-实现命令行实时编译" class="headerlink" title="2.2    实现命令行实时编译"></a>2.2    实现命令行实时编译</h2><p><code>-P</code>:     不压缩生成的html文件<br><code>-w</code>：实时监控</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">└── index.pug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ pug -P index.pug <span class="comment"># 编译到当前目录下</span></span><br><span class="line"></span><br><span class="line">$ tree  </span><br><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line"></span><br><span class="line">├── index.html<span class="comment"># 编译生成的文件</span></span><br><span class="line">└── index.pug</span><br></pre></td></tr></table></figure>
<h2 id="2-3-标签语法"><a href="#2-3-标签语法" class="headerlink" title="2.3    标签语法"></a>2.3    标签语法</h2><ul>
<li>不需要尖括号</li>
<li>不需要闭合</li>
<li>通过缩进实现嵌套</li>
</ul>
<h2 id="2-4-属性文本和值"><a href="#2-4-属性文本和值" class="headerlink" title="2.4    属性文本和值"></a>2.4    属性文本和值</h2><table>
<thead>
<tr>
<th>属性类型</th>
<th>书写方式</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>|id|<code>[标签]# [id]</code>或<code>[标签] (id=[id])</code>|<br>|class|<code>[标签].[className1].[classeName2]</code>或<code>[标签] (class=&quot;[className1] [className2]&quot;)</code><br>|其它|<code>[标签] ([属性]=&quot;[属性值]&quot; [省略值的属性])</code>|</p>
<p><strong>注意：</strong>对于id和class属性，编写div标签且采用<code>#</code>、<code>.</code>的方式时可以省略<code>div</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		</span><br><span class="line">		h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">		</span><br><span class="line">		# id.classname</span><br><span class="line">			a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">			input(value='course',type="text",name="course")</span><br><span class="line">			input(name='type',type='checkbox',checked)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://imooc.com"</span> <span class="attr">title</span>=<span class="string">"imooc pug"</span> <span class="attr">data-uid</span>=<span class="string">"1000"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">"course"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"course"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="2-5-混合的成段文本和标签"><a href="#2-5-混合的成段文本和标签" class="headerlink" title="2.5        混合的成段文本和标签"></a>2.5        混合的成段文本和标签</h1><p><strong>说明：</strong>两种方式</p>
<ul>
<li>每一行文本前加 <code>|</code></li>
<li>为标签添加后缀<code>.</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p </span><br><span class="line">	|	a </span><br><span class="line">	|	b </span><br><span class="line">	|	c </span><br><span class="line">	|	d</span><br><span class="line">p.</span><br><span class="line">	a</span><br><span class="line">	<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">	b</span><br><span class="line">	c</span><br><span class="line">	d</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">  a </span><br><span class="line">  b </span><br><span class="line">  c </span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--接下来的东西是个完整代码块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">  a</span><br><span class="line">  <span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">  d</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-6-注释和条件注释"><a href="#2-6-注释和条件注释" class="headerlink" title="2.6    注释和条件注释"></a>2.6    注释和条件注释</h2><h3 id="2-6-1-注释"><a href="#2-6-1-注释" class="headerlink" title="2.6.1    注释"></a>2.6.1    注释</h3><p><strong>分类：</strong></p>
<ul>
<li>缓冲注释<code>//</code>：会输出到html</li>
<li>非缓冲注释<code>//-</code>：不会输出到html</li>
</ul>
<p><strong>注意：</strong>当注释放在标签下部时，表示块注释</p>
<h3 id="2-6-2-条件注释"><a href="#2-6-2-条件注释" class="headerlink" title="2.6.2    条件注释"></a>2.6.2    条件注释</h3><p><strong>注意：</strong>当使用条件注释时，html需要使用标签，且需要闭合。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">//- html</span><br><span class="line"><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	meta(charset='utf-8')</span><br><span class="line">	title imooc pug study</span><br><span class="line">body</span><br><span class="line">	style.</span><br><span class="line">		</span><br><span class="line">		body&#123;color:# ff6600&#125;</span><br><span class="line">	script.</span><br><span class="line">		var imoocCourse = 'pug'</span><br><span class="line">	</span><br><span class="line">	h1# title.title1.title2(class='title3') imooc pug study</span><br><span class="line">	h2 注释</span><br><span class="line">	//h3 单行注释</span><br><span class="line">	//-h4 非缓冲注释</span><br><span class="line">	</span><br><span class="line">	# id.classname</span><br><span class="line">	//-块注释</span><br><span class="line">		a(href='http://imooc.com',title='imooc pug',data-uid='1000') link</span><br><span class="line">		input(value='course',type="text",name="course")</span><br><span class="line">		input(name='type',type='checkbox',checked)</span><br><span class="line">		p </span><br><span class="line">			|	a </span><br><span class="line">			|	b </span><br><span class="line">			|	c </span><br><span class="line">			|	d</span><br><span class="line">		//接下来的东西是个完整代码块</span><br><span class="line">		p.</span><br><span class="line">			a</span><br><span class="line">			<span class="tag">&lt;<span class="name">strong</span>&gt;</span>strong<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">			b</span><br><span class="line">			c</span><br><span class="line">			d</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 7]&gt;&lt;html class='ie7'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![end if]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"><span class="selector-tag">body</span>&#123;<span class="attribute">color</span>:# ff6600&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> imoocCourse = <span class="string">'pug'</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">class</span>=<span class="string">"title1 title2 title3"</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>注释<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--h3 单行注释--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"id"</span> <span class="attr">class</span>=<span class="string">"classname"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-变量声明与数据传递"><a href="#2-7-变量声明与数据传递" class="headerlink" title="2.7    变量声明与数据传递"></a>2.7    变量声明与数据传递</h2><h3 id="2-7-1-变量声明与使用"><a href="#2-7-1-变量声明与使用" class="headerlink" title="2.7.1        变量声明与使用"></a>2.7.1        变量声明与使用</h3><ul>
<li><p>声明：<code>- var variableName</code></p>
</li>
<li><p>调用<code># {variableName}</code></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		- var course = 'pug'</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-2-数据传递"><a href="#2-7-2-数据传递" class="headerlink" title="2.7.2    数据传递"></a>2.7.2    数据传递</h3><blockquote>
<p><strong>说明：</strong>通过命令行指令传递数据</p>
<ol>
<li><code>--obj {jsonString}</code>：直接传递对象字符串</li>
<li><code>-O file.json</code>：载入json文件</li>
</ol>
</blockquote>
<p><strong>注意</strong>：如果在pug文件中声明了同样的变量，则被pug文件中的覆盖。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pug</span> index.pug -P -w --obj <span class="string">'&#123;"course":"pug"&#125;'</span></span><br><span class="line">或</span><br><span class="line">$ vim imooc.json </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"course"</span>:<span class="string">"pug"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pug</span> index.pug -P -w －O imooc.json</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		meta(charset='utf-8')</span><br><span class="line">		</span><br><span class="line">		title imooc # &#123;course.toUpperCase()&#125; study</span><br><span class="line">	body</span><br><span class="line">		h2 声明变量和替换数据</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>声明变量和替换数据<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-安全转义与非转义"><a href="#2-8-安全转义与非转义" class="headerlink" title="2.8    安全转义与非转义"></a>2.8    安全转义与非转义</h2><blockquote>
<p><strong>说明：</strong>解析并输出变量的内容时，默认会对变量进行<code>安全转义</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">	head</span><br><span class="line">		title imooc pug study</span><br><span class="line">	body</span><br><span class="line">		h1 转义</span><br><span class="line">		- var htmlData = '<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>'</span><br><span class="line">		// 默认(会转义)</span><br><span class="line">		</span><br><span class="line">		p # &#123;htmlData&#125;</span><br><span class="line">		// 安全转义</span><br><span class="line">		p= htmlData</span><br><span class="line"></span><br><span class="line">		// 非安全转义（形式1）</span><br><span class="line">		p !&#123;htmlData&#125;</span><br><span class="line">		// 非安全转义（形式2）</span><br><span class="line">		p!= htmlData</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		// 特殊符号转义（! #  &#123; &#125;）</span><br><span class="line">		</span><br><span class="line">		p \# &#123;htmlData&#125;</span><br><span class="line">		p \!&#123;htmlData&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>转义<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认(会转义)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 安全转义--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&amp;lt;span&amp;gt;&amp;lt;/span&amp;gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式1）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不安全转义（形式2）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(1);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 特殊符号转义（! #  &#123; &#125;）--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span># &#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>!&#123;htmlData&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-流程代码for-in-each-in-while"><a href="#2-9-流程代码for-in-each-in-while" class="headerlink" title="2.9    流程代码for-in /each-in / while"></a>2.9    流程代码for-in /each-in / while</h2><h3 id="2-9-1-for-in"><a href="#2-9-1-for-in" class="headerlink" title="2.9.1    for-in"></a>2.9.1    for-in</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 for</span><br><span class="line">- var imooc = &#123;course: 'pug', level: 'high'&#125;</span><br><span class="line">- for (var k in imooc)</span><br><span class="line">	p= imooc[k]</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-2-each-in"><a href="#2-9-2-each-in" class="headerlink" title="2.9.2    each-in"></a>2.9.2    each-in</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">h3 each</span><br><span class="line">each value, key in imooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;key&#125;:# &#123;value&#125;</span><br><span class="line"></span><br><span class="line">h3 遍历数组</span><br><span class="line">- var courses = ['node', 'pug', 'express']</span><br><span class="line">each item in courses</span><br><span class="line">	p= item</span><br><span class="line"></span><br><span class="line">h3 嵌套循环</span><br><span class="line">- var sections = [&#123;id: 1, items: ['a', 'b']&#125;,&#123;id: 2, items: ['c', 'd']&#125;]</span><br><span class="line">dl</span><br><span class="line">	each section in sections</span><br><span class="line">		dt= section.id</span><br><span class="line">		each item in section.items</span><br><span class="line">			dd= item</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>each<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>course:pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>level:high<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>遍历数组<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>express<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>嵌套循环<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>1<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>a<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>b<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dt</span>&gt;</span>2<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>c<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dd</span>&gt;</span>d<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-3-while"><a href="#2-9-3-while" class="headerlink" title="2.9.3    while"></a>2.9.3    while</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h3 while</span><br><span class="line">- var n = 0</span><br><span class="line">ul</span><br><span class="line">	while n <span class="tag">&lt; <span class="attr">4</span></span><br><span class="line">		<span class="attr">li</span>= <span class="string">n++</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>while<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-流程代码-if-else-unless"><a href="#2-10-流程代码-if-else-unless" class="headerlink" title="2.10    流程代码 if - else/unless"></a>2.10    流程代码 if - else/unless</h2><h3 id="2-10-1-if-else"><a href="#2-10-1-if-else" class="headerlink" title="2.10.1    if-else"></a>2.10.1    if-else</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">h3 if else</span><br><span class="line">- var isImooc = true</span><br><span class="line">- var lessons = ['pug', 'node']</span><br><span class="line">if lessons</span><br><span class="line">	if lessons.length &gt; 2</span><br><span class="line">		</span><br><span class="line">		p more than 2: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else if lessons.length &gt; 1</span><br><span class="line">		</span><br><span class="line">		p more than 1: # &#123;lessons.join(', ')&#125;</span><br><span class="line">	else</span><br><span class="line">		p no lesson</span><br><span class="line">else</span><br><span class="line">	p no lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>if else<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>more than 1: pug, node<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-unless"><a href="#2-10-2-unless" class="headerlink" title="2.10.2    unless"></a>2.10.2    unless</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- var isImooc = true</span><br><span class="line">unless isImooc</span><br><span class="line">	</span><br><span class="line">	p # &#123;lessons.length&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>unless<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-case-when"><a href="#2-10-3-case-when" class="headerlink" title="2.10.3    case-when"></a>2.10.3    case-when</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 case</span><br><span class="line">- var name = 'pug'</span><br><span class="line">case name</span><br><span class="line">	when 'java'</span><br><span class="line">	when 'node'</span><br><span class="line">		p Hi node!</span><br><span class="line">	when 'pug': p Hi exress!</span><br><span class="line">	when 'express': p Hi express</span><br><span class="line">	default</span><br><span class="line">		</span><br><span class="line">		p Hi # &#123;name&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>case<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi exress!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-神奇的mixins"><a href="#2-11-神奇的mixins" class="headerlink" title="2.11    神奇的mixins"></a>2.11    神奇的mixins</h2><h3 id="2-11-1-参数"><a href="#2-11-1-参数" class="headerlink" title="2.11.1    参数"></a>2.11.1    参数</h3><h4 id="2-11-1-1-无参数"><a href="#2-11-1-1-无参数" class="headerlink" title="2.11.1.1    无参数"></a>2.11.1.1    无参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 无参数</span><br><span class="line">mixin lesson</span><br><span class="line">	p imooc pug study</span><br><span class="line">+lesson</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>无参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>imooc pug study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-2-有参数"><a href="#2-22-1-2-有参数" class="headerlink" title="2.22.1.2    有参数"></a>2.22.1.2    有参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">h3 带参数</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">+study('tom', ['pug', 'node'])</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>带参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>tom study<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"courses"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-22-1-3-可变参数"><a href="#2-22-1-3-可变参数" class="headerlink" title="2.22.1.3    可变参数"></a>2.22.1.3    可变参数</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">h3 可变参数</span><br><span class="line">mixin magic(name, ...items)</span><br><span class="line">	</span><br><span class="line">	ul(class='# name')</span><br><span class="line">		each item in items</span><br><span class="line">			li= item</span><br><span class="line">+magic('magic', 'node', 'pug')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>可变参数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"# name"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>node<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>pug<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-嵌套"><a href="#2-11-2-嵌套" class="headerlink" title="2.11.2    嵌套"></a>2.11.2    嵌套</h3><blockquote>
<p><strong>说明：</strong>在一个<code>mixin</code>的定义中调用另一个<code>mixin</code></p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">h3 mixin中调用另一个mixin</span><br><span class="line">mixin study(name, courses)</span><br><span class="line">	</span><br><span class="line">	p # &#123;name&#125; study</span><br><span class="line">	ul.courses</span><br><span class="line">		each course in courses</span><br><span class="line">			li= course</span><br><span class="line">mixin group(student)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;student.name&#125;</span><br><span class="line">	+study(student.name, student.courses)</span><br><span class="line">+group(&#123;name:'tom', courses:['pug', 'node']&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-块包含"><a href="#2-11-3-块包含" class="headerlink" title="2.11.3    块包含"></a>2.11.3    块包含</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 块包含</span><br><span class="line">mixin team(slogon)</span><br><span class="line">	</span><br><span class="line">	h4 # &#123;slogon&#125;</span><br><span class="line">	if block</span><br><span class="line">		block</span><br><span class="line">	else</span><br><span class="line">		p no team</span><br><span class="line">//- 调用时后面跟一个块</span><br><span class="line">+team('slogon')</span><br><span class="line">	p Good job!</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>块包含<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>slogon<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Good job!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-4-传递属性"><a href="#2-11-4-传递属性" class="headerlink" title="2.11.4    传递属性"></a>2.11.4    传递属性</h3><blockquote>
<p><strong>说明：</strong>设置标签的属性有两种方式</p>
<ol>
<li>单个设置：<code>标签(属性名=attributes.属性名)</code></li>
<li>批量设置：<code>标签&amp;attributes(attributes)</code></li>
</ol>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h3 传递属性</span><br><span class="line">//- 索引某个属性</span><br><span class="line">mixin attr(name)</span><br><span class="line">	</span><br><span class="line">	p(class!=attributes.class) # &#123;name&#125;</span><br><span class="line">+attr('attr')(class='magic')</span><br><span class="line">//- 索引所有属性</span><br><span class="line">mixin attrs(name)</span><br><span class="line">	</span><br><span class="line">	p&amp;attributes(attributes) # &#123;name&#125;</span><br><span class="line">+attrs('attrs')(class='magic2', id='attrid')</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>传递属性<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"magic"</span>&gt;</span>attr<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"attrid"</span> <span class="attr">class</span>=<span class="string">"magic2"</span>&gt;</span>attrs<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="3-pug进级"><a href="#3-pug进级" class="headerlink" title="3    pug进级"></a>3    pug进级</h1><h2 id="3-1-模版的继承"><a href="#3-1-模版的继承" class="headerlink" title="3.1    模版的继承"></a>3.1    模版的继承</h2><table>
<thead>
<tr>
<th>关键字</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>extents [pug文件]</code></td>
<td>继承</td>
<td></td>
</tr>
<tr>
<td><code>block</code></td>
<td>定义(或引用，可追加)被继承的内容</td>
</tr>
</tbody>
</table>
<h3 id="3-1-1-案例源码"><a href="#3-1-1-案例源码" class="headerlink" title="3.1.1    案例源码"></a>3.1.1    案例源码</h3><p><em>head.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meta(charset='utf-8')</span><br><span class="line">title  study</span><br></pre></td></tr></table></figure>
<p><em>layout.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line"><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line">head</span><br><span class="line">	include head</span><br><span class="line">body</span><br><span class="line">	block desc</span><br><span class="line">	  p desc from layout</span><br><span class="line">	block content</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extends layout</span><br><span class="line"></span><br><span class="line"><span class="keyword">block</span> content</span><br><span class="line">	p <span class="keyword">desc</span> <span class="keyword">from</span> <span class="keyword">index</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-编译后"><a href="#3-1-2-编译后" class="headerlink" title="3.1.2    编译后"></a>3.1.2    编译后</h3><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span><span class="comment">&lt;!--[if IE 8]&gt;&lt;html class='ie8'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if IE 9]&gt;&lt;html class='ie9'&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if !IE]&gt;&lt;!--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--&lt;![endif]--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span> study<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from layout<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>desc from index<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-模版的包含"><a href="#3-2-模版的包含" class="headerlink" title="3.2    模版的包含"></a>3.2    模版的包含</h2><h3 id="3-2-1-包含其它-pug-文件"><a href="#3-2-1-包含其它-pug-文件" class="headerlink" title="3.2.1    包含其它 pug 文件"></a>3.2.1    包含其它 pug 文件</h3><p><em>style.pug</em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">style</span>.</span><br><span class="line">	<span class="selector-tag">body</span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">h1 模版包含</span><br><span class="line">//- 引入（还可以并追加内容）</span><br><span class="line">include style</span><br><span class="line">	style.</span><br><span class="line">		h2 &#123;</span><br><span class="line">			</span><br><span class="line">			color: # 000;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>模版包含<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">body</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">999</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line">  <span class="selector-tag">h2</span> &#123;</span><br><span class="line">  	</span><br><span class="line">  	<span class="attribute">color</span>: # <span class="number">000</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-包含-html-文件"><a href="#3-2-2-包含-html-文件" class="headerlink" title="3.2.2    包含 html 文件"></a>3.2.2    包含 html 文件</h3><h4 id="原文件"><a href="#原文件" class="headerlink" title="原文件"></a>原文件</h4><p><em>index.pug</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//- 引入静态文件，添加后缀名（.html），就不会被当做pug模版文件处理</span><br><span class="line">include title.html</span><br></pre></td></tr></table></figure>
<p><em>title.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编译后"><a href="#编译后" class="headerlink" title="编译后"></a>编译后</h4><p><em>index.html</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>content from html<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-render及renderFile方法"><a href="#3-3-render及renderFile方法" class="headerlink" title="3.3    render及renderFile方法"></a>3.3    render及renderFile方法</h2><h3 id="3-3-1-pug-API"><a href="#3-3-1-pug-API" class="headerlink" title="3.3.1    pug API"></a>3.3.1    pug API</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461486682614.png" alt="Alt text|400x150"></p>
<h3 id="3-3-2-compile、render、renderFile"><a href="#3-3-2-compile、render、renderFile" class="headerlink" title="3.3.2    compile、render、renderFile"></a>3.3.2    compile、render、renderFile</h3><blockquote>
<p><strong>说明：</strong><code>pug</code>提供写一些方法，帮助开发着在服务端灵活地处理编译工作。</p>
<ul>
<li>compile：返回一个编译特定模版片段的方法</li>
<li>render：直接编译定模版片段</li>
<li>renderFile：直接编译特定pug模版文件</li>
</ul>
</blockquote>
<p><em>server.js</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">'pug'</span>)</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">		<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. pug.compile</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> fn = pug.compile(<span class="string">'div test # &#123;type&#125;'</span>, &#123;&#125;)</span><br><span class="line">	<span class="comment">// var html = fn(&#123;type: 'compile'&#125;)</span></span><br><span class="line">	<span class="comment">// 2. pug.render</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// var html = pug.render('div test # &#123;type&#125;', &#123;type: 'render'&#125;)</span></span><br><span class="line">	<span class="comment">// 3. pug.renderFile</span></span><br><span class="line">	<span class="keyword">var</span> html = pug.renderFile(<span class="string">'index.pug'</span>, &#123;course: <span class="string">'pug renderFile'</span>, pretty: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line">	res.end(html);</span><br><span class="line">&#125;).listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server running at 1337'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#  安装需要的node包</span></span><br><span class="line">➜  imooc_pug git:(master) ✗ npm i pug coffee-script less markdown --save</span><br></pre></td></tr></table></figure>
<h2 id="3-4-过滤器-filters"><a href="#3-4-过滤器-filters" class="headerlink" title="3.4    过滤器 filters"></a>3.4    过滤器 filters</h2><h3 id="3-4-1-markdown"><a href="#3-4-1-markdown" class="headerlink" title="3.4.1    markdown"></a>3.4.1    markdown</h3><blockquote>
<p><strong>注意：</strong><code>markdown</code>中不能使用<code>pug</code>变量</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i jstransformer-markdown -g</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h1 过滤器filters</span><br><span class="line">h3 markdown</span><br><span class="line">:markdown</span><br><span class="line">	Hi, this is **TZM** [link](http://tzmcn.org/)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>过滤器filters<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>markdown<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hi, this is<span class="tag">&lt;<span class="name">strong</span>&gt;</span>TZM<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"# &#123;url&#125;"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-less"><a href="#3-4-2-less" class="headerlink" title="3.4.2    less"></a>3.4.2    less</h3><blockquote>
<p><strong>官网：</strong><a href="http://lesscss.org/" target="_blank" rel="external">http://lesscss.org/</a></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g jstransformer-less</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">h3 less</span><br><span class="line">	style</span><br><span class="line">		:less</span><br><span class="line">			body &#123;</span><br><span class="line">				p &#123;</span><br><span class="line">					</span><br><span class="line">					color: # ccc;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">h3&gt;less<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span><br><span class="line"><span class="selector-tag">body</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">color</span>: # ccc;</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-coffee-script"><a href="#3-4-3-coffee-script" class="headerlink" title="3.4.3    coffee-script"></a>3.4.3    coffee-script</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g jstransformer-coffee-script</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h3 coffee</span><br><span class="line">	script</span><br><span class="line">		:coffee-script</span><br><span class="line">			console.log 'This is coffee!'</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;coffee&lt;/h3&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(function() &#123;</span><br><span class="line">	console.log(&apos;This is coffee!&apos;);</span><br><span class="line">&#125;).call(this);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-runtime环境下使用pug"><a href="#3-5-runtime环境下使用pug" class="headerlink" title="3.5    runtime环境下使用pug"></a>3.5    runtime环境下使用pug</h2><blockquote>
<p><strong>说明：</strong><code>runtime</code>环境这里特指浏览器</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">h1 浏览器端和服务器端能使用pug</span><br><span class="line"></span><br><span class="line"># runtime</span><br><span class="line">//- 服务器端使用</span><br><span class="line">script(src='node_modules/pug/runtime.js')</span><br><span class="line">//- 客户端使用</span><br><span class="line">script(src='runtime.js')</span><br><span class="line">script.</span><br><span class="line">	var runtimeNode = document.getElementById('runtime');</span><br><span class="line">	var runtimeHtml = template(&#123;isRuntime: true&#125;);</span><br><span class="line">	runtimeNode.innerHTML = runtimeHtml;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>浏览器端和服务器端能使用pug<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"runtime"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"node_modules/pug/runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"runtime.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line">  <span class="keyword">var</span> runtimeNode = <span class="built_in">document</span>.getElementById(<span class="string">'runtime'</span>);</span><br><span class="line">  <span class="keyword">var</span> runtimeHtml = template(&#123;isRuntime: <span class="literal">true</span>&#125;);</span><br><span class="line">  runtimeNode.innerHTML = runtimeHtml;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-利用html2pug反编译"><a href="#3-6-利用html2pug反编译" class="headerlink" title="3.6    利用html2pug反编译"></a>3.6    利用html2pug反编译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i html2jade -g</span><br></pre></td></tr></table></figure>
<h3 id="命令行中使用"><a href="#命令行中使用" class="headerlink" title="命令行中使用"></a>命令行中使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="node端使用"><a href="#node端使用" class="headerlink" title="node端使用"></a>node端使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html2pug = <span class="built_in">require</span>(<span class="string">'html2jade'</span>)</span><br><span class="line">html2pug.convertDocument(html, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, pug</span>) </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="4-pug缺点及如何取舍"><a href="#4-pug缺点及如何取舍" class="headerlink" title="4    pug缺点及如何取舍"></a>4    pug缺点及如何取舍</h1><h2 id="4-1-Pug-的缺点"><a href="#4-1-Pug-的缺点" class="headerlink" title="4.1    Pug 的缺点"></a>4.1    Pug 的缺点</h2><ol>
<li>可移植差</li>
<li>调试困难</li>
<li>性能不是非常出色（对性能有需求考虑 <a href="">doT</a>）</li>
</ol>
<h2 id="4-2-选择的因素"><a href="#4-2-选择的因素" class="headerlink" title="4.2    选择的因素"></a>4.2    选择的因素</h2><ol>
<li>初始阶段（开发效率）</li>
<li>稳定阶段（性能和协作成本）</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/15/imooc_iOS_When iOS loves JS/" itemprop="url">
                  When iOS loves JS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-15T21:33:42+08:00" content="2016-06-15">
              2016-06-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/15/imooc_iOS_When iOS loves JS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/15/imooc_iOS_When iOS loves JS/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-JSBinding概述"><a href="#1-JSBinding概述" class="headerlink" title="1    JSBinding概述"></a>1    JSBinding概述</h1><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>是<code>JS</code>和<code>native</code>之间的一个桥梁，通过这个桥梁，<code>JS</code>可以调用<code>Native</code>，<code>Native</code>可以调用<code>JS</code>。</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.35.27.png" alt="Alt text"></p>
<p><strong>注意：</strong><code>JSBinding</code>不是什么</p>
<ul>
<li>not Hybrid</li>
<li>not a new technology</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-04%20%E4%B8%8B%E5%8D%8811.38.56.png" alt="Alt text"></p>
<p><strong>历史：</strong><code>cocos2D-X</code>使用<code>zynga</code>提出的一个方案(<a href="https://github.com/zynga/jsbindings)，`JS" target="_blank" rel="external">https://github.com/zynga/jsbindings)，`JS</a> Engine<code>使用的是</code>SpiderMonkey`。</p>
<h2 id="1-1-JS和Native"><a href="#1-1-JS和Native" class="headerlink" title="1.1    JS和Native"></a>1.1    JS和Native</h2><p><strong>说明：</strong>两者结合初衷如下</p>
</blockquote>
<table>
<thead>
<tr>
<th>原生静态语言</th>
<th>动态脚本语言</th>
</tr>
</thead>
<tbody>
<tr>
<td>高性能</td>
<td>简单易用</td>
</tr>
<tr>
<td>更底层，更强大</td>
<td>免编译</td>
</tr>
<tr>
<td>平台特性</td>
<td>热部署</td>
</tr>
</tbody>
</table>
<h2 id="1-2-iOS-7-and-JavaScriptCore"><a href="#1-2-iOS-7-and-JavaScriptCore" class="headerlink" title="1.2    iOS 7 and JavaScriptCore"></a>1.2    iOS 7 and JavaScriptCore</h2><blockquote>
<p><strong>说明：</strong>在<code>iOS 7</code>之后，苹果公布了<code>JavaScriptCore</code>的<code>API</code>，在这之前一直是<code>iOS</code>系统私有的。<br><strong>扩展：</strong><code>Mac</code>的<code>JavaScriptCore</code>一直是开放的。<br><strong>要点：</strong>包括以下部分</p>
<ul>
<li><code>JavaScriptCore.h</code>头文件</li>
<li><code>JSContext</code>类：<code>JS</code>的运行环境</li>
<li><code>JSValue</code>类：</li>
<li><code>JSExport</code>类</li>
</ul>
</blockquote>
<h3 id="1-2-1-Eval-JavaScript-Code"><a href="#1-2-1-Eval-JavaScript-Code" class="headerlink" title="1.2.1    Eval JavaScript Code"></a>1.2.1    Eval JavaScript Code</h3><blockquote>
<p><strong>说明：</strong>利用引擎执行<code>JS</code>代码</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 使用 JS 上下文执行 JS 语句 "1 + 2"，并返回计算结果</span></span><br><span class="line">    JSValue *result = [context evaluateScript: <span class="string">@"1 + 2"</span>];</span><br><span class="line">    <span class="comment">// 打印计算结果</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"1 + 2 = %f"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-Call-JavaScript-Function"><a href="#1-2-2-Call-JavaScript-Function" class="headerlink" title="1.2.2    Call JavaScript Function"></a>1.2.2    Call JavaScript Function</h3><blockquote>
<p><strong>说明：</strong>假设一个叫做<code>sum</code>的<code>JS</code>方法已经被加载</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a "sum" function was loaded in context</span></span><br><span class="line"><span class="comment">// 使用上下文获取函数 sum</span></span><br><span class="line">J<span class="built_in">AValue</span> *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line"><span class="comment">// 调用sum JS 方法,并传递两个参数</span></span><br><span class="line">JSValue *result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line"><span class="comment">// 打印计算结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h3 id="1-2-3-Create-JavaScript-Value"><a href="#1-2-3-Create-JavaScript-Value" class="headerlink" title="1.2.3    Create JavaScript Value"></a>1.2.3    Create JavaScript Value</h3><blockquote>
<p><strong>说明：</strong>可以先创建<code>JS</code>的值，再赋值给相应变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在指定上下文中创建值 231</span></span><br><span class="line">JSValue *intVar = [JSValue valueWithInt32: <span class="number">231</span> inContext: context];</span><br><span class="line"><span class="comment">// 将值赋给变量 bar</span></span><br><span class="line">context[<span class="string">@"bar"</span>] = intVar;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line">[context evaluateScript: <span class="string">@"bar++];</span></span><br></pre></td></tr></table></figure>
<p><em>another way</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[context evaluateScript: <span class="string">@"var bar = 231;bar++;"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-Type-Conversion"><a href="#1-2-4-Type-Conversion" class="headerlink" title="1.2.4    Type Conversion"></a>1.2.4    Type Conversion</h3><blockquote>
<p><strong>说明：</strong><code>JS</code>和<code>O-C</code>之间对应类型的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th>Objective-C type</th>
<th>JavaScript type</th>
</tr>
</thead>
<tbody>
<tr>
<td>nil</td>
<td>undefined</td>
</tr>
<tr>
<td>NSNull</td>
<td>null</td>
</tr>
<tr>
<td>NSString</td>
<td>string</td>
</tr>
<tr>
<td>NSNumber</td>
<td>number, boolean</td>
</tr>
<tr>
<td>NSDictionary</td>
<td>Object object</td>
</tr>
<tr>
<td>NSArray</td>
<td>Array object</td>
</tr>
<tr>
<td>NSDate</td>
<td>Date object</td>
</tr>
<tr>
<td>NSBlock</td>
<td>Function object</td>
</tr>
<tr>
<td>id</td>
<td>Wrapper object</td>
</tr>
<tr>
<td>Class</td>
<td>Constructor object</td>
</tr>
</tbody>
</table>
<h2 id="1-3-完整实例"><a href="#1-3-完整实例" class="headerlink" title="1.3    完整实例"></a>1.3    完整实例</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 创建 JS 运行的上下文</span></span><br><span class="line">    JSContext *context = [[JSContext alloc] init];</span><br><span class="line">    <span class="comment">// 为上下文指定JS异常处理代码块</span></span><br><span class="line">    context.exceptionHandler = ^(JSContext *ctx, JSValue *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, exception);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">NSString</span> *script;</span><br><span class="line">    JSValue *result;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 表达式</span></span><br><span class="line">    script = <span class="string">@"1 + 2 + 3"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" %@ = %f"</span>, script, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 语句(创建一个全局变量)</span></span><br><span class="line">    script = <span class="string">@"var globalVal = 2 * 3;"</span>;</span><br><span class="line">    result = [context evaluateScript:script];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@" globalVar = %@"</span>, context[<span class="string">@"globalVar"</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 函数</span></span><br><span class="line">    script = <span class="string">@"function sum(a, b)&#123;return a + b;&#125;"</span>;</span><br><span class="line">    [context evaluateScript:script];</span><br><span class="line">    JSValue *sum = context[<span class="string">@"sum"</span>];</span><br><span class="line">    result = [sum callWithArguments:@[@<span class="number">1</span>, @<span class="number">2</span>]];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, <span class="string">@"sum(1,2)"</span>, [result toDouble]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建值</span></span><br><span class="line">    JSValue *foo = [JSValue valueWithDouble:<span class="number">123.45</span> inContext:context];</span><br><span class="line">    context[<span class="string">@"foo"</span>] = foo;</span><br><span class="line">    [context evaluateScript:<span class="string">@"foo++"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"foo = %f"</span>, [context[<span class="string">@"foo"</span>] toDouble]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="2-初始iOS7-JavaScriptCore-API"><a href="#2-初始iOS7-JavaScriptCore-API" class="headerlink" title="2    初始iOS7 JavaScriptCore API"></a>2    初始iOS7 JavaScriptCore API</h1><h2 id="2-1-Call-Native-Code-via-Block"><a href="#2-1-Call-Native-Code-via-Block" class="headerlink" title="2.1    Call Native Code via Block"></a>2.1    Call Native Code via Block</h2><blockquote>
<p><strong>说明：</strong><code>JS</code>调用<code>Native</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------ JS 调用 Native</span></span><br><span class="line"><span class="comment">// 为 JS 的上下文注入可以调用的本地 BLOCK</span></span><br><span class="line">context[<span class="string">@"sum"</span>] = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 在 JS 中调用 Native block</span></span><br><span class="line">result = [context evaluateScript:<span class="string">@"sum(1, 2)"</span>];</span><br><span class="line"><span class="comment">// 观察运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"sum(1, 2) = %f"</span>, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-2-Call-Native-Code-via-JSExport"><a href="#2-2-Call-Native-Code-via-JSExport" class="headerlink" title="2.2    Call Native Code via JSExport"></a>2.2    Call Native Code via JSExport</h2><blockquote>
<p><strong>说明：</strong>通过<code>jsExport</code>调用<code>Native</code></p>
<ul>
<li>Create a js export Class in Objective-C（创建<code>jsExport</code>类）</li>
<li>the instance of this class can be accessed in js context（该类的实例可以在<code>js</code>的上下文中访问到）</li>
<li>No Constructor in JS（无法在<code>JS</code>中访问到<code>JSExport</code>对象的构造函数）</li>
</ul>
</blockquote>
<p>###实例</p>
<blockquote>
<p><strong>说明：</strong>需要做以下工作</p>
<ol>
<li>定义一个<code>JSExport</code>的子协议：协议指定的成员才能够暴露给<code>JS</code>上下文</li>
<li>创建一个<code>O-C</code>类，并采纳协议</li>
</ol>
</blockquote>
<p><em>Point3D.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">// 协议：继承 JSExport</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">Point3DExport</span> &lt;<span class="title">JSExport</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> x;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> y;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>) length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Point3D</span> : <span class="title">NSObject</span> &lt;<span class="title">Point3DExport</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    JSContext *context;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Point3D.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JavaScriptCore.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Point3D.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Point3D</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> x;</span><br><span class="line"><span class="keyword">@synthesize</span> y;</span><br><span class="line"><span class="keyword">@synthesize</span> z;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithContext: (JSContext *) ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        context = ctx;</span><br><span class="line">        context[<span class="string">@"Point3D"</span>] = [Point3D class];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">double</span>)length &#123;</span><br><span class="line">    <span class="keyword">return</span> sqrt(<span class="keyword">self</span>.x * <span class="keyword">self</span>.x + <span class="keyword">self</span>.y * <span class="keyword">self</span>.y + <span class="keyword">self</span>.z * <span class="keyword">self</span>.z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *script;</span><br><span class="line">JSValue *result;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line">Point3D *point3D = [[Point3D alloc] initWithContext:context];</span><br><span class="line">point3D.x = <span class="number">1</span>;</span><br><span class="line">point3D.y = <span class="number">2</span>;</span><br><span class="line">point3D.z = <span class="number">3</span>;</span><br><span class="line"><span class="comment">// 将实例注入到 JS 上下文</span></span><br><span class="line">context[<span class="string">@"point3D"</span>] = point3D;</span><br><span class="line"><span class="comment">// 待执行的 JS 脚本</span></span><br><span class="line">script = <span class="string">@"point3D.x = 2; point3D.y = 2; point3D.length();"</span>;</span><br><span class="line"><span class="comment">// 在 JS 上下文中调用该实例</span></span><br><span class="line">result = [context evaluateScript:script];</span><br><span class="line"><span class="comment">// 观察 JS 运行结果</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Result of %@ is %f"</span>, script, [result toDouble]);</span><br></pre></td></tr></table></figure>
<h2 id="2-3-载入js文件来执行"><a href="#2-3-载入js文件来执行" class="headerlink" title="2.3    载入js文件来执行"></a>2.3    载入js文件来执行</h2><blockquote>
<p><strong>说明：</strong>加入<code>js</code>文件比起在<code>Native</code>代码中创建<code>js</code>脚本子串要通用、易用的多。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建文件路径</span></span><br><span class="line"><span class="built_in">NSString</span> *filePath = [<span class="built_in">NSString</span> stringWithFormat:</span><br><span class="line">                       <span class="string">@"%@/%@"</span>,</span><br><span class="line">                       [[<span class="built_in">NSBundle</span> mainBundle] resourcePath],</span><br><span class="line">                       fileName];</span><br><span class="line"><span class="comment">// 载入 js 文件</span></span><br><span class="line"><span class="built_in">NSString</span> *script = [<span class="built_in">NSString</span> stringWithContentsOfFile:filePath encoding:<span class="built_in">NSUTF8StringEncoding</span> error:<span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 执行 js</span></span><br><span class="line">[context evaluateScript:script];</span><br></pre></td></tr></table></figure>
<h1 id="3-JavaScriptCore-API-进阶"><a href="#3-JavaScriptCore-API-进阶" class="headerlink" title="3    JavaScriptCore API 进阶"></a>3    JavaScriptCore API 进阶</h1><h2 id="3-1-Memory-Leak"><a href="#3-1-Memory-Leak" class="headerlink" title="3.1    Memory Leak"></a>3.1    Memory Leak</h2><blockquote>
<p><strong>说明：</strong><code>js</code>中对象的<code>循环引用</code>和<code>o-c</code>中对象的<code>循环引用</code>都不会导致内存泄漏。但<code>js</code>对象和<code>Native</code>对象之间的循环引用会导致内存泄漏。</p>
<ul>
<li><code>js</code>对象之间循环引用：不会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454685937810.png" alt="Alt text"></li>
<li><code>o-c</code>对象和<code>js</code>对象之间循环引用：会内存泄漏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686063492.png" alt="Alt text"></li>
</ul>
<p><strong>解决：</strong><code>o-c</code>对象引用<code>js</code>对象时将后者包装为<code>JSManageredValue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454686201162.png" alt="Alt text"><br><em>JS Code</em></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> girl = <span class="keyword">new</span> Girl();</span><br><span class="line">girl.boyFriend = boy;</span><br><span class="line">boy.girlFriend = girl;</span><br></pre></td></tr></table></figure>
<p><em>Objective-C Code</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Boy</span></span></span><br><span class="line">- (<span class="keyword">void</span>)setGirlFriend: (JSValue *)girl</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 使用 JSManageredValue 进行包装</span></span><br><span class="line">	<span class="keyword">self</span>.girlFriend = [JSManageredValue manageredValueWithValue: girl];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-Threding-and-parallelism"><a href="#3-2-Threding-and-parallelism" class="headerlink" title="3.2    Threding and parallelism"></a>3.2    Threding and parallelism</h2><blockquote>
<p><strong>说明：</strong>要点</p>
<ul>
<li>API is thread safe（API是线程安全的）</li>
<li>Locking granularity is JSVirtualMachine（锁的最小粒度为是<code>JS</code>虚拟机）</li>
<li>Use separate JSVirtualMachines for parallelism（并发时要使用不同的<code>JS</code>虚拟机）<br>###实例<br><strong>说明：</strong>创建了2个虚拟机实例</li>
<li>jsvmA：运行了两个<code>js</code>上下文(<code>ctxA1</code>和<code>ctxA2</code>)</li>
<li>jsvmB：运行了一个<code>js</code>上下文(<code>ctxB</code>)</li>
</ul>
<p><code>ctxA1</code>和<code>ctxA2</code>能够在并发情形下正常通信，但他们<code>ctxB</code>在并发环境下不能通信。因为前两者在同一个虚拟机中运行，也就意味着运行在同一个线程中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 js 虚拟机实例 jsvmA</span></span><br><span class="line">JSVirtualMachine *jsvmA = [[JSVirtualMachine alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 jsvmA 虚拟机中创建两个js上下文</span></span><br><span class="line">JSContext *ctxA1 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line">JSContext *ctxA2 = [[JSContext alloc] initWithVirtualMachine: jsvmA];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建另一个 js 虚拟机实例 javmB</span></span><br><span class="line">JSVirtualMachine *jsvmB = [[JSVirtualMachine alloc] init];</span><br><span class="line"><span class="comment">// // 在 jsvmB 虚拟机中创建一个js上下文</span></span><br><span class="line">JSContext *ctxB = [[JSContext alloc] initWithVirtualMachine: jsvmB];</span><br></pre></td></tr></table></figure>
<h2 id="3-3-JSBinding-in-the-Real-World"><a href="#3-3-JSBinding-in-the-Real-World" class="headerlink" title="3.3    JSBinding in the Real World"></a>3.3    JSBinding in the Real World</h2><blockquote>
<p><strong>说明：</strong><code>JSBinding</code>的一些实际应用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744485627.png" alt="Alt text"></p>
<ul>
<li>Cocos2D</li>
<li>Ejecta</li>
<li>CocoonJS<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454744686882.png" alt="Alt text"></li>
<li>node.app<h3 id="3-3-1-JS-Engines"><a href="#3-3-1-JS-Engines" class="headerlink" title="3.3.1    JS Engines"></a>3.3.1    JS Engines</h3></li>
</ul>
<p><strong>说明：</strong>2种<code>JS</code>引擎比较，<code>JavaScriptCore</code>和<code>SpiderMonkey</code></p>
<ul>
<li>JavaScriptCore</li>
<li>SpiderMonkey(Cocos2D-iPhone-2.1-bate3)</li>
<li>SpiderMonkey(Cocos2D-x-2.1-bate3)</li>
<li>SpiderMonkey(iMonkey)</li>
</ul>
<p><strong>注意：</strong><code>v8</code>引擎不受支持，因为其依赖于<code>JIT</code>，被苹果禁用。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1454745052574.png" alt="Alt text"></p>
<h3 id="3-3-2-JSBind-VS-LuaBinding"><a href="#3-3-2-JSBind-VS-LuaBinding" class="headerlink" title="3.3.2    JSBind VS LuaBinding"></a>3.3.2    JSBind VS LuaBinding</h3><p><strong>说明：</strong><code>JSBinding</code>和<code>LuaBinding</code>比较</p>
<ul>
<li><code>LUA</code>为什么在游戏编程领域被广泛运用<br><a href="https://www.zhihu.com/question/21717567" target="_blank" rel="external">https://www.zhihu.com/question/21717567</a></li>
<li><code>Cocos2dx+LUA</code>合适还是<code>Cocos2dx+JS</code>合适<br><a href="https://www.zhihu.com/question/21130385" target="_blank" rel="external">https://www.zhihu.com/question/21130385</a><h2 id="3-3-3-Which-to-Choose"><a href="#3-3-3-Which-to-Choose" class="headerlink" title="3.3.3    Which to Choose"></a>3.3.3    Which to Choose</h2></li>
</ul>
</blockquote>
<ul>
<li>Native</li>
<li>Web</li>
<li>Hybrid</li>
<li>ScriptBinding</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/03/JK_IOS高级_4 设计模式/" itemprop="url">
                  4 设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-03T14:11:18+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/03/JK_IOS高级_4 设计模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/03/JK_IOS高级_4 设计模式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="4-1-iOS设计模式简介"><a href="#4-1-iOS设计模式简介" class="headerlink" title="4.1    iOS设计模式简介"></a>4.1    iOS设计模式简介</h2><h3 id="4-1-1-编码是门艺术"><a href="#4-1-1-编码是门艺术" class="headerlink" title="4.1.1    编码是门艺术"></a>4.1.1    编码是门艺术</h3><h3 id="4-1-2-设计模式的基本原则"><a href="#4-1-2-设计模式的基本原则" class="headerlink" title="4.1.2    设计模式的基本原则"></a>4.1.2    设计模式的基本原则</h3><ul>
<li><strong>开闭原则</strong>：一个模块的修改应该对扩展开发，对修改关闭</li>
<li><strong>里氏代换原则</strong>：子类、父类可以替换使用</li>
<li><strong>依赖倒转原则</strong>：抽象比依赖细节，细节依赖抽象</li>
<li><strong>接口隔离原则</strong>：只做和接口相关的必要的事情，不做和接口不相关的事情</li>
<li><strong>合成／聚合复用</strong>：从一个类扩展出新的方法时，尽量不要通过继承实现，而是在新的类中的方法中将原来的类作为一个组件调用</li>
</ul>
<h3 id="4-1-3-设计模式的类型"><a href="#4-1-3-设计模式的类型" class="headerlink" title="4.1.3    设计模式的类型"></a>4.1.3    设计模式的类型</h3><h2 id="4-2-适配器"><a href="#4-2-适配器" class="headerlink" title="4.2    适配器"></a>4.2    适配器</h2><h3 id="4-2-1-何为适配器模式"><a href="#4-2-1-何为适配器模式" class="headerlink" title="4.2.1    何为适配器模式"></a>4.2.1    何为适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过现实生活中遇到的电源适配问题，来讲解何为适配器模式。<br><strong>说明：</strong>苹果的电源适配器，可以将各种输入电压频率转为一致的电压频率为设备供电，从而解决国家电压频率不一致问题</p>
<ul>
<li><strong>类适配器：</strong>比之于一般的电源适配器，在不同国家要购买相应的电源适配器</li>
<li><strong>对象适配器：</strong>比之于苹果的电源适配器，能自动适应各个国家的情况</li>
</ul>
</blockquote>
<h3 id="4-2-2-数据直接适配带来的困境"><a href="#4-2-2-数据直接适配带来的困境" class="headerlink" title="4.2.2    数据直接适配带来的困境"></a>4.2.2    数据直接适配带来的困境</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解开发过程中遇到的最常见的几种数据适配问题的弊端，并配以代码示例，来引申出为何要用适配器模式。</p>
<ul>
<li>直接赋值的弊端</li>
<li>用对象赋值的灵活性问题</li>
<li>如何降低数据层与视图层的耦合度</li>
</ul>
</blockquote>
<h3 id="4-2-3-使用适配器模式"><a href="#4-2-3-使用适配器模式" class="headerlink" title="4.2.3    使用适配器模式"></a>4.2.3    使用适配器模式</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解用适配器模式来优化名片视图加载数据的问题。</p>
<ul>
<li>创建抽象适配器模式</li>
<li>适配器与视图层建立输出联系</li>
<li>类适配器与对象适配器<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.48.25.png" alt="Alt text"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462074739914.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="4-2-3-1-类适配器"><a href="#4-2-3-1-类适配器" class="headerlink" title="4.2.3.1    类适配器"></a>4.2.3.1    类适配器</h4><blockquote>
<p><strong>说明：</strong>为每种数据模型都创建相应的适配器，用到哪种数据就使用相应的适配器。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.30.25.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462073700393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">// 3. 将数据连接到适配器</span><br><span class="line">BusinessCardAdapter *modelAdapter = [[NewCardModelAdapter alloc] initWithData:newCardModel];</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[ModelAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-2-对象适配器"><a href="#4-2-3-2-对象适配器" class="headerlink" title="4.2.3.2        对象适配器"></a>4.2.3.2        对象适配器</h4><blockquote>
<p><strong>说明：</strong>每种数据模型都使用同一个适配器，适配器中承担为每种数据模型都提供适配的任务。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.31.00.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8A%E5%8D%8811.38.40.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建商务名片实例</span></span><br><span class="line">BusinessCard<span class="built_in">UIView</span> *cardView = [[BusinessCard<span class="built_in">UIView</span> alloc] initWithFrame:BUSINESS_FRAME];</span><br><span class="line">cardView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化要数据</span></span><br><span class="line"><span class="comment">// 第一种数据</span></span><br><span class="line">Model *model = [[Model alloc] init];</span><br><span class="line">model.name = <span class="string">@"TZM"</span>;</span><br><span class="line">model.lineColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">model.phoneNumber = <span class="string">@"101 - 5687 -000"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种数据</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line">NewCardModel *newCardModel = [[NewCardModel alloc] init];</span><br><span class="line">newCardModel.name = @"JikeXueYuan";</span><br><span class="line">newCardModel.colorHexString = @"black";</span><br><span class="line">newCardModel.phoneNumber = @"13671208074";</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将数据连接到适配器</span></span><br><span class="line">BusinessCardAdapter *modelAdapter = [[CardAdapter alloc] initWithData:model];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将适配器连接到视图</span></span><br><span class="line">[cardView loadData:modelAdapter];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:cardView];</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4-适配器模式的优缺点"><a href="#4-2-4-适配器模式的优缺点" class="headerlink" title="4.2.4    适配器模式的优缺点"></a>4.2.4    适配器模式的优缺点</h3><p><strong>优点：</strong>降低数据层和视图层之间的耦合度<br><strong>缺点：</strong>对不理解适配器模式的人可读性不好</p>
<h2 id="4-3-策略"><a href="#4-3-策略" class="headerlink" title="4.3    策略"></a>4.3    策略</h2><h3 id="4-3-1-if-else-的问题"><a href="#4-3-1-if-else-的问题" class="headerlink" title="4.3.1    if - else 的问题"></a>4.3.1    if - else 的问题</h3><blockquote>
<p><strong>课程说明：</strong>程序中出现了大量 if - else 之后，出现的阅读障碍以及维护的困境。</p>
</blockquote>
<h3 id="4-3-2-策略模式的原理"><a href="#4-3-2-策略模式的原理" class="headerlink" title="4.3.2    策略模式的原理"></a>4.3.2    策略模式的原理</h3><blockquote>
<p><strong>课程说明：</strong>策略模式的基本原理以及定义的条件。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462093482279.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-3-3-策略模式的使用"><a href="#4-3-3-策略模式的使用" class="headerlink" title="4.3.3    策略模式的使用"></a>4.3.3    策略模式的使用</h3><blockquote>
<p><strong>课程说明：</strong>怎样将策略模式用到 <code>UITextField</code> 的验证逻辑上。</p>
<ul>
<li>如何抽象出策略</li>
<li>制定协议来维护输出信息<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%889.41.29.png" alt="Alt text|200x100"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462113251890.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIButton+inits.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIView+SetRect.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIInfomationView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CustomUITextField.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EmailValidator.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PhoneNumberValidator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITextFieldDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *emailField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Custom<span class="built_in">UITextField</span> *phoneNumberField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButton];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化输入框</span></span><br><span class="line">    [<span class="keyword">self</span> initCustonFields];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳 UITextFieldDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)textFieldDidEndEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    Custom<span class="built_in">UITextField</span> *customField = (Custom<span class="built_in">UITextField</span> *)textField;</span><br><span class="line">    <span class="keyword">if</span> ([customField validate] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="comment">// 弹出错误提示窗</span></span><br><span class="line">        [<span class="built_in">UIInfomationView</span> showAlertViewWithTitle:<span class="literal">nil</span></span><br><span class="line">                                         message:customField</span><br><span class="line">                                                .validator</span><br><span class="line">                                                .errorMessage</span><br><span class="line">                               cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                               otherButtonTitles:@[<span class="string">@"确定"</span>]</span><br><span class="line">                                    clickAtIndex:^(<span class="built_in">NSInteger</span> buttonIndex) &#123;</span><br><span class="line">                                        </span><br><span class="line">                                    &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化输入框</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initCustonFields &#123;</span><br><span class="line">    <span class="comment">// 邮箱输入框</span></span><br><span class="line">    <span class="keyword">self</span>.emailField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.emailField.placeholder = <span class="string">@"请输入邮箱"</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.delegate =  <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.emailField.validator = [EmailValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.emailField];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手机号输入框</span></span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField = [[Custom<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">80</span> + <span class="number">40</span>, Width - <span class="number">60</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.placeholder = <span class="string">@"请输入电话号码"</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="keyword">self</span>.phoneNumberField.validator = [PhoneNumberValidator new];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneNumberField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化返回按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButton &#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> createButtonWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">30</span>)</span><br><span class="line">                                            buttonType:<span class="number">0</span></span><br><span class="line">                                                 title:<span class="string">@"Back"</span></span><br><span class="line">                                                   tag:<span class="number">0</span></span><br><span class="line">                                                target:<span class="keyword">self</span></span><br><span class="line">                                                action:<span class="keyword">@selector</span>(buttonEvent:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:button];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  结束编辑</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4-策略模式的优缺点"><a href="#4-3-4-策略模式的优缺点" class="headerlink" title="4.3.4    策略模式的优缺点"></a>4.3.4    策略模式的优缺点</h3><p><strong>优点：</strong>避免大量<code>if-else</code>的使用，精简逻辑，可维护性高<br><strong>缺点：</strong>使用场景受限，使用之前就需要确定对应的策略。</p>
<h2 id="4-4-观察者"><a href="#4-4-观察者" class="headerlink" title="4.4    观察者"></a>4.4    观察者</h2><h3 id="4-4-1-如何订阅一本杂志"><a href="#4-4-1-如何订阅一本杂志" class="headerlink" title="4.4.1    如何订阅一本杂志"></a>4.4.1    如何订阅一本杂志</h3><blockquote>
<p><strong>课程说明：</strong>本课时通过讲解如何订阅杂志的生活实例，来讲解何为观察者模式。</p>
</blockquote>
<h4 id="4-4-1-1-如何订阅一本杂志"><a href="#4-4-1-1-如何订阅一本杂志" class="headerlink" title="4.4.1.1    如何订阅一本杂志"></a>4.4.1.1    如何订阅一本杂志</h4><blockquote>
<ol>
<li>通过邮局或网络查询刊物的编号</li>
<li>找到后，提供个人住址等相关信息</li>
<li>发行商在一般每月的固定时间发送刊物</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-05-01%20%E4%B8%8B%E5%8D%8811.30.22.png" alt="Alt text"></p>
<h3 id="4-4-2-通知中心的抽象设计"><a href="#4-4-2-通知中心的抽象设计" class="headerlink" title="4.4.2    通知中心的抽象设计"></a>4.4.2    通知中心的抽象设计</h3><blockquote>
<p><strong>课程说明：</strong>本课时根据订阅杂志的实例，讲解如何将抽象的模型转换成代码。</p>
<ul>
<li>如何抽象接口</li>
<li>对订阅对象的约束：订阅对象必须采纳相应的协议</li>
<li>针对接口编程：先根据目标功能定好接口，然后再具体实现</li>
</ul>
</blockquote>
<p><em>SubscriptionServiceCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenterProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubscriptionServiceCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护订阅信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除订阅号</span><br><span class="line"> *</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 维护客户信息</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加客户到具体的订阅号当中</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           客户</span><br><span class="line"> *  @param subscriptionNumber 订阅号码</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从具体的订阅号中移除客户</span><br><span class="line"> *</span><br><span class="line"> *  @param customer           &lt;#customer description#&gt;</span><br><span class="line"> *  @param subscriptionNumber &lt;#subscriptionNumber description#&gt;</span><br><span class="line"> */</span></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 发送消息</span></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-3-实现通知中心"><a href="#4-4-3-实现通知中心" class="headerlink" title="4.4.3    实现通知中心"></a>4.4.3    实现通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时将实现通知中心，并讲解<code>NSHashTable</code> 与<code>NSParameterAssert</code> 的使用。<br><strong>注意：</strong><code>NSHashTable</code>和<code>NSSet</code>类似，但前者可以不会强引用集合中的元素。</p>
</blockquote>
<ul>
<li>对象持有的问题<br><em>描述</em>：书刊和用户之间的联系导致用户实例无法被释放<br><em>解决</em>：用<code>NSHashTable</code>实现<code>weak</code>引用</li>
<li>参数的严格验证<br><em>描述</em>：比如参数值不允许值为<code>nil</code></li>
</ul>
<p><img src="./屏幕快照 2016-05-02 下午2.57.40.png" alt="Alt text"></p>
<h4 id="4-4-3-1-实现通知中心类"><a href="#4-4-3-1-实现通知中心类" class="headerlink" title="4.4.3.1    实现通知中心类"></a>4.4.3.1    实现通知中心类</h4><p><em>SubscriptionServiceCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"><span class="comment">// 存储订阅号的字典</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *_subscriptionDictionary = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubscriptionServiceCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化存储订阅号的字典</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == [SubscriptionServiceCenter class]) &#123;</span><br><span class="line">        _subscriptionDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取具体的订阅号</span></span><br><span class="line">+ (<span class="built_in">NSHashTable</span> *)existSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="keyword">return</span> [_subscriptionDictionary objectForKey:subscriptionNumber];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)createSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable == <span class="literal">nil</span>) &#123;</span><br><span class="line">        hashTable = [<span class="built_in">NSHashTable</span> weakObjectsHashTable];</span><br><span class="line">        [_subscriptionDictionary setObject:hashTable forKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        [_subscriptionDictionary removeObjectForKey:subscriptionNumber];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)addCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(customer);</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable addObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)removeCustomer:(<span class="keyword">id</span>&lt;SubscriptionServiceCenterProtocol&gt;)customer withSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);</span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];</span><br><span class="line">    [hashTable removeObject:customer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)sendMessage:(<span class="keyword">id</span>)message toSubscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSParameterAssert</span>(subscriptionNumber);<span class="comment">// 确保订阅号不为nil</span></span><br><span class="line">    <span class="built_in">NSHashTable</span> *hashTable = [<span class="keyword">self</span> existSubscriptionNumber:subscriptionNumber];<span class="comment">// 存储订阅号的字典</span></span><br><span class="line">    <span class="keyword">if</span> (hashTable) &#123;</span><br><span class="line">        <span class="comment">// 遍历订阅号</span></span><br><span class="line">        <span class="built_in">NSEnumerator</span> *enumerator = [hashTable objectEnumerator];</span><br><span class="line">        <span class="keyword">id</span> &lt;SubscriptionServiceCenterProtocol&gt;object = <span class="literal">nil</span>;</span><br><span class="line">        <span class="keyword">while</span> (object = [enumerator nextObject]) &#123;</span><br><span class="line">            <span class="comment">// 向每个订阅用户发送订阅订阅内容</span></span><br><span class="line">            <span class="keyword">if</span> ([object respondsToSelector:<span class="keyword">@selector</span>(subscriptionMessage:subscriptionNumber:)]) &#123;</span><br><span class="line">                [object subscriptionMessage:message subscriptionNumber:subscriptionNumber];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-3-2-使用通知中心"><a href="#4-4-3-2-使用通知中心" class="headerlink" title="4.4.3.2    使用通知中心"></a>4.4.3.2    使用通知中心</h4><p><em>SubscriptionServiceCenterProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SubscriptionServiceCenterProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"SubscriptionServiceCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *S<span class="built_in">CIENCE</span> = <span class="string">@"SCIENCE"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">SubscriptionServiceCenterProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅号</span></span><br><span class="line">    [SubscriptionServiceCenter createSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加订阅的用户到指定的刊物</span></span><br><span class="line">    [SubscriptionServiceCenter addCustomer:<span class="keyword">self</span></span><br><span class="line">                    withSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发型机构发送刊物</span></span><br><span class="line">    [SubscriptionServiceCenter sendMessage:<span class="string">@"V1.0"</span></span><br><span class="line">                      toSubscriptionNumber:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 采纳协议 SubscriptionServiceCenterProtocol</span></span><br><span class="line"><span class="comment">// 发行机构发送刊物时触发该方法的调用</span></span><br><span class="line">- (<span class="keyword">void</span>)subscriptionMessage:(<span class="keyword">id</span>)message subscriptionNumber:(<span class="built_in">NSString</span> *)subscriptionNumber &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, message, subscriptionNumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-4-KVO与通知中心"><a href="#4-4-4-KVO与通知中心" class="headerlink" title="4.4.4    KVO与通知中心"></a>4.4.4    KVO与通知中心</h3><blockquote>
<p><strong>课程说明：</strong>本课时简单介绍下 Cocoa 框架中的 KVO 与通知中心的使用。</p>
</blockquote>
<h4 id="4-4-4-1-Cocoa框架的通知中心"><a href="#4-4-4-1-Cocoa框架的通知中心" class="headerlink" title="4.4.4.1    Cocoa框架的通知中心"></a>4.4.4.1    Cocoa框架的通知中心</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>框架提供了自己的通知中心<code>API</code>，该通知中心就是通过观察者模式实现的。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加客户到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span></span><br><span class="line">                                             selector:<span class="keyword">@selector</span>(notificationCenterEvent:)</span><br><span class="line">                                                 name:S<span class="built_in">CIENCE</span></span><br><span class="line">                                               object:<span class="string">@"v1.0"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发送消息到指定的订阅号中</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:S<span class="built_in">CIENCE</span></span><br><span class="line">                                                        object:<span class="string">@"V1.0"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当客户收到消息时被调用的方法</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)notificationCenterEvent:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, sender);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// 从通知中心移除</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span></span><br><span class="line">                                              forKeyPath:S<span class="built_in">CIENCE</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-4-4-2-KVO机制的观察者模式"><a href="#4-4-4-2-KVO机制的观察者模式" class="headerlink" title="4.4.4.2    KVO机制的观察者模式"></a>4.4.4.2    KVO机制的观察者模式</h4><blockquote>
<p><strong>说明：</strong><code>KVO</code>机制本身就是一种观察者模式。<br><strong>注意：</strong>观察者被释放时需要手动将观察者从订阅号中移除，否则会存在内存泄漏（通知中心会继续持有对观察者的引用）。</p>
</blockquote>
<h5 id="通知中心"><a href="#通知中心" class="headerlink" title="通知中心"></a>通知中心</h5><p><em>Model.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h5><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define SCIENCE @<span class="meta-string">"SCIENCE"</span>// 订阅号名</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Model *model;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建订阅中心</span></span><br><span class="line">    <span class="keyword">self</span>.model = [Model new];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户添加订阅中心的"name"服务：当name属性被修改时会发送消息给观察者</span></span><br><span class="line">    [<span class="keyword">self</span>.model addObserver:<span class="keyword">self</span></span><br><span class="line">                 forKeyPath:<span class="string">@"name"</span></span><br><span class="line">                    options:<span class="built_in">NSKeyValueObservingOptionNew</span></span><br><span class="line">                    context:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 订阅中心发送消息（通过修改 name 属性值）</span></span><br><span class="line">    <span class="keyword">self</span>.model.name = <span class="string">@"V1.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 通过KVO该表属性时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, change);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 释放资源</span></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">	<span class="comment">// 移除 KVO</span></span><br><span class="line">    [<span class="keyword">self</span>.model removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-5-原型模式和外观模式"><a href="#4-5-原型模式和外观模式" class="headerlink" title="4.5    原型模式和外观模式"></a>4.5    原型模式和外观模式</h2><h3 id="4-5-1-原型模式"><a href="#4-5-1-原型模式" class="headerlink" title="4.5.1    原型模式"></a>4.5.1    原型模式</h3><h4 id="4-5-1-1-模版的用处"><a href="#4-5-1-1-模版的用处" class="headerlink" title="4.5.1.1    模版的用处"></a>4.5.1.1    模版的用处</h4><blockquote>
<p><strong>用途：</strong>当要创建的对象有很多相似的细节的时候，就可以通过制作模版简化工作。</p>
</blockquote>
<h4 id="4-5-1-2-原型模式的原理"><a href="#4-5-1-2-原型模式的原理" class="headerlink" title="4.5.1.2    原型模式的原理"></a>4.5.1.2    原型模式的原理</h4><blockquote>
<p><strong>说明：</strong>定义一个协议，采纳该协议个类要实现<code>clone</code>方法，也就是具备拷贝自身的能力。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462191691369.png" alt="Alt text"></p>
</blockquote>
<h5 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462192387967.png" alt="Alt text"></p>
<p><em>PrototypeCopyProtocol.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">PrototypeCopyProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  复制自己</span><br><span class="line"> *</span><br><span class="line"> *  @return 返回一个拷贝</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>)clone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">```	</span><br><span class="line">*StudentModel.h*</span><br><span class="line"></span><br><span class="line">```objectivec</span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PrototypeCopyProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StudentModel</span> : <span class="title">NSObject</span> &lt;<span class="title">PrototypeCopyProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *address;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *totalScore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>StudentModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">StudentModel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)clone &#123;</span><br><span class="line">    <span class="comment">// 创建一个新的实例</span></span><br><span class="line">    StudentModel *student = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    <span class="comment">// 按照当前实例初始化新的实例</span></span><br><span class="line">    student.name = <span class="keyword">self</span>.name;</span><br><span class="line">    student.age = <span class="keyword">self</span>.age;</span><br><span class="line">    student.address = <span class="keyword">self</span>.address;</span><br><span class="line">    student.totalScore = <span class="keyword">self</span>.totalScore;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"StudentModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生1</span></span><br><span class="line">    StudentModel *stu1 = [[StudentModel alloc] init];</span><br><span class="line">    stu1.name = <span class="string">@"mengxiang"</span>;</span><br><span class="line">    stu1.age = @(<span class="number">1</span>);</span><br><span class="line">    stu1.address = <span class="string">@"海淀区"</span>;</span><br><span class="line">    stu1.totalScore = @(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 学生2</span></span><br><span class="line">    StudentModel *stu2 = [stu1 clone];<span class="comment">// 应用原型模式</span></span><br><span class="line">    stu2.name = <span class="string">@"Viking"</span>;</span><br><span class="line">    stu2.address = <span class="string">@"Northern Europe"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="4-5-1-3-NSCoping协议的使用细节"><a href="#4-5-1-3-NSCoping协议的使用细节" class="headerlink" title="4.5.1.3    NSCoping协议的使用细节"></a>4.5.1.3    NSCoping协议的使用细节</h4><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>通过<code>NSCoping</code>协议为原型模式提供了支持。<br><strong>注意：</strong></p>
<ul>
<li>深拷贝与浅拷贝</li>
<li>不支持<code>NSCopying</code>协议的对象<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462199219485.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-5-2-外观模式"><a href="#4-5-2-外观模式" class="headerlink" title="4.5.2    外观模式"></a>4.5.2    外观模式</h3><h4 id="4-5-2-1-如何去一个指定的地方"><a href="#4-5-2-1-如何去一个指定的地方" class="headerlink" title="4.5.2.1    如何去一个指定的地方"></a>4.5.2.1    如何去一个指定的地方</h4><blockquote>
<p><strong>说明：</strong>用来说明外观模式的一个显示场景</p>
<ul>
<li>自驾：自己负责路线相关的各种事务</li>
<li>坐火车：将细节交给黑盒</li>
</ul>
</blockquote>
<h4 id="4-5-2-2-外观模式的原理"><a href="#4-5-2-2-外观模式的原理" class="headerlink" title="4.5.2.2    外观模式的原理"></a>4.5.2.2    外观模式的原理</h4><blockquote>
<p><strong>说明：</strong>就是将细节封装了起来，使用时不需要了解细节<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462186013642.png" alt="Alt text"></p>
</blockquote>
<h4 id="4-5-2-3-如何绘制复杂的图形"><a href="#4-5-2-3-如何绘制复杂的图形" class="headerlink" title="4.5.2.3    如何绘制复杂的图形"></a>4.5.2.3    如何绘制复杂的图形</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462201625961.png" alt="Alt text"></p>
<h2 id="4-6-装饰"><a href="#4-6-装饰" class="headerlink" title="4.6    装饰"></a>4.6    装饰</h2><p><code>不改变原类，动态地扩展原类的功能</code></p>
<h3 id="4-6-1-照片与相框"><a href="#4-6-1-照片与相框" class="headerlink" title="4.6.1    照片与相框"></a>4.6.1    照片与相框</h3><blockquote>
<p><strong>课程说明：</strong>通过照片与相框之间的联系，来讲解何为装饰模式。</p>
</blockquote>
<h3 id="4-6-2-装饰模式的原理"><a href="#4-6-2-装饰模式的原理" class="headerlink" title="4.6.2    装饰模式的原理"></a>4.6.2    装饰模式的原理</h3><blockquote>
<p>基本原理<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410189425.png" alt="Alt text"></p>
<p>装饰起模式的优点<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463410420677.png" alt="Alt text"></p>
<p> 装饰模式的使用场景</p>
</blockquote>
<p>不知道一个类的实现细节，只知道相关的接口，又需要扩展这个类的功能。</p>
<h3 id="4-6-3-实现装饰模式"><a href="#4-6-3-实现装饰模式" class="headerlink" title="4.6.3    实现装饰模式"></a>4.6.3    实现装饰模式</h3><blockquote>
<p><strong>课程说明：</strong>通过一个扩展游戏机手柄行为的事例，来实现装饰模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463490224877.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463495040772.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-6-4-category的使用"><a href="#4-6-4-category的使用" class="headerlink" title="4.6.4    category的使用"></a>4.6.4    category的使用</h3><blockquote>
<p><strong>课程说明：</strong>讲解 <code>Cocoa</code> 框架已经实现的装饰模式，并延伸讲解下如何给 <code>category</code> 添加属性。<br><strong>说明：</strong>利用<code>Objective-C</code>的动态运行时分配机制，你可以为现有的类添加方法或计算属性，这种机制称为类别(<code>category</code>)。<br><strong>注意：</strong>和装饰模式不同，这种扩展方式会导致原类型的改变。</p>
</blockquote>
<ol>
<li>原类型</li>
</ol>
<p><em>GamePad.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  上下左右的操作</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)up;</span><br><span class="line">- (<span class="keyword">void</span>)down;</span><br><span class="line">- (<span class="keyword">void</span>)left;</span><br><span class="line">- (<span class="keyword">void</span>)right;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  选择与开始的操作</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)select;</span><br><span class="line">- (<span class="keyword">void</span>)start;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  按钮 A + B + X + Y</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)commandA;</span><br><span class="line">- (<span class="keyword">void</span>)commandB;</span><br><span class="line">- (<span class="keyword">void</span>)commandX;</span><br><span class="line">- (<span class="keyword">void</span>)commandY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePod.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span></span></span><br><span class="line">- (<span class="keyword">void</span>)up &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"up"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)down &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"down"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)left &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"left"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)right &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"right"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)select &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"select"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)start &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"start"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandA &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandA"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandB &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandB"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandX &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandX"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)commandY &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"commandY"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>扩展</li>
</ol>
<p><em>GamePad+Coin.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  游戏币</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span>  coin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>GamePad+Coin.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">GamePad</span> (<span class="title">Coin</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作为类和属性之间的关联key</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSString</span> *_coinStr = <span class="string">@"_coinStr"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setCoin:(<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 将当前类（GamePad）和 coin 属性关联在一起</span></span><br><span class="line">    <span class="comment">// 也就是额外添加了一个属性</span></span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr, @(coin), OBJC_ASSO<span class="built_in">CIATION_ASSIGN</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)coin &#123;</span><br><span class="line">    <span class="comment">// 通过key扩区绑定到当前类的属性的值</span></span><br><span class="line">    <span class="built_in">NSNumber</span> *number = objc_getAssociatedObject(<span class="keyword">self</span>, (__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)_coinStr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> number.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li>使用扩展后的GamePod</li>
</ol>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GamePad+Coin.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">    GamePad *gamePad = [[GamePad alloc] init];</span><br><span class="line">    [gamePad up];</span><br><span class="line">    </span><br><span class="line">    gamePad.coin = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"coin %ld"</span>, (<span class="keyword">long</span>)gamePad.coin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-7-工厂"><a href="#4-7-工厂" class="headerlink" title="4.7    工厂"></a>4.7    工厂</h2><h3 id="4-7-1-制造手机与使用手机"><a href="#4-7-1-制造手机与使用手机" class="headerlink" title="4.7.1    制造手机与使用手机"></a>4.7.1    制造手机与使用手机</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463587653123.png" alt="Alt text"></p>
<h3 id="4-7-2-简单工厂"><a href="#4-7-2-简单工厂" class="headerlink" title="4.7.2    简单工厂"></a>4.7.2    简单工厂</h3><blockquote>
<p><strong>说明：</strong>将“产品”的生产任务封装在“工厂中”</p>
<ol>
<li>简化生产流程</li>
<li>隔离生产产品的细节</li>
<li>不同类型产品之间有着一些共同的功能</li>
<li>一个具体的工厂<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463799288205.png" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="案例：通过简单工厂获取手机实例"><a href="#案例：通过简单工厂获取手机实例" class="headerlink" title="案例：通过简单工厂获取手机实例"></a>案例：通过简单工厂获取手机实例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463798863229.png" alt="Alt text"></p>
<blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463743818102.png" alt="Alt text"></p>
<p>类图：通过</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463715567130.png" alt="Alt text|500x500"></p>
<blockquote>
<p>使用</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DeviceFactory.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过工厂创建手机</span></span><br><span class="line">    iPhoneDevice *iPhone = (iPhoneDevice *)[DeviceFactory deviceFactoryWithDeviceType:kiPhone];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用手机功能</span></span><br><span class="line">    [iPhone fingerprintIndentification];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-7-3-抽象工厂"><a href="#4-7-3-抽象工厂" class="headerlink" title="4.7.3    抽象工厂"></a>4.7.3    抽象工厂</h3><blockquote>
<p><strong>说明：</strong><code>客户端</code>通过<code>抽象工厂</code>创建具体的<code>工厂</code>，然后通过具体的<code>工厂</code>获取产品。相比简单工厂，抽象工厂多了一层抽象，在很多场景中可以比简单工厂更好地解耦。</p>
<ul>
<li>抽象工厂原理</li>
<li>抽象工厂抽象在哪里</li>
<li>抽象工厂使用场景</li>
</ul>
</blockquote>
<h4 id="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"><a href="#案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品" class="headerlink" title="案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品"></a>案例：通过工厂管理器获取定制的具体工厂，并通过具体的工厂获取产品</h4><blockquote>
<p>源码结构<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816866737.png" alt="Alt text"></p>
<p>类图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463816799001.png" alt="Alt text"></p>
<p>使用</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取工厂</span></span><br><span class="line">BaseFactory *factory = [FactoryManager factoryWithBrand:kGoogle];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建商品</span></span><br><span class="line">BasePhone *phone = [factory createPhone];</span><br><span class="line">BaseWatch *watch = [factory createWatch];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@ %@"</span>, phone, watch);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-4-Cocoa-框架中的-NSNumber"><a href="#4-7-4-Cocoa-框架中的-NSNumber" class="headerlink" title="4.7.4    Cocoa 框架中的 NSNumber"></a>4.7.4    Cocoa 框架中的 NSNumber</h3><blockquote>
<p><strong>说明：</strong><code>NSNumber</code>本身是一个抽象工厂类，直接通过该类<code>init</code>一个实例会获得一个<code>nil</code>。<code>NSNumber</code>提供了一系列工厂方法来获取针对具体数值类型的工厂。<br><strong>注意：</strong><code>NSNumber</code>是针对<code>数值</code>的抽象工厂，产品是各种<code>数值</code>类型，而且这些<code>数值</code>之间可以进行类型转换。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于NSNumber是一个抽象工厂，这里只会返回一个 nil</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[<span class="built_in">NSNumber</span> alloc] init]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建具体的工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *number = [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">100</span>];<span class="comment">// 通过Int类型的100获取一个工厂实例</span></span><br><span class="line"><span class="built_in">NSNumber</span> *floatValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">100.</span>f];<span class="comment">// 通过浮点数100.f获取一个工厂实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用工厂实例生产具体的产品（具体类型的数字）</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [number charValue]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%c"</span>, [floatValue charValue]);</span><br></pre></td></tr></table></figure>
<h2 id="4-8-桥接"><a href="#4-8-桥接" class="headerlink" title="4.8    桥接"></a>4.8    桥接</h2><blockquote>
<p><strong>说明：</strong>两类存在通信的实体，其实例实现各自的协议，两类实体的实例就可以正确通信。这种设计方式解耦了通信协议的定义和具体实例的实现。</p>
</blockquote>
<h3 id="4-8-1-遥控器与电视机"><a href="#4-8-1-遥控器与电视机" class="headerlink" title="4.8.1 遥控器与电视机"></a>4.8.1 遥控器与电视机</h3><blockquote>
<p><strong>例子：</strong>为遥控器和电视机分别定义了协议，采纳了协议的具体的遥控器和电视机之间只需完成各自的实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463818469080.png" alt="Alt text|400x250"></p>
</blockquote>
<h3 id="4-8-2-桥接模式原理"><a href="#4-8-2-桥接模式原理" class="headerlink" title="4.8.2 桥接模式原理"></a>4.8.2 桥接模式原理</h3><blockquote>
<p><strong>目的：</strong> 把抽象层次结构从具体的实现分离出来，使其能够独立变更。<br><strong>抽象层：</strong>定义了共客户端使用的上层抽象接口。<br><strong>实现层：</strong>定义了供抽象层使用的底层接口。<br><strong>桥接：</strong>实现类的引用被封装到抽象层的实例中，桥接就形成了。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839147515.png" alt="Alt text"></p>
<h3 id="4-8-3-设计游戏机模拟器"><a href="#4-8-3-设计游戏机模拟器" class="headerlink" title="4.8.3 设计游戏机模拟器"></a>4.8.3 设计游戏机模拟器</h3><ul>
<li>游戏机模拟器的功能定义</li>
<li>按钮协议的制定</li>
<li>游戏机模拟器的实现<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463839248044.png" alt="Alt text"></li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463845234221.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* GBA系统 ＋ GBA执行器 */</span></span><br><span class="line"><span class="comment">// 创建GBA系统</span></span><br><span class="line">AbstractSystem *gbaSystem = [[GBASystem alloc] init];</span><br><span class="line"><span class="comment">// 设置GBA执行器</span></span><br><span class="line">gbaSystem.implementor = [[GBAImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[gbaSystem loadSystem];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* PSP系统 ＋ PSP执行器 */</span></span><br><span class="line"><span class="comment">// 创建PSP系统</span></span><br><span class="line">AbstractSystem *pspSystem = [[PSPSystem alloc] init];</span><br><span class="line"><span class="comment">// 设置PSP执行器</span></span><br><span class="line">pspSystem.implementor = [[PSPImplementor alloc] init];</span><br><span class="line"><span class="comment">// 启动系统</span></span><br><span class="line">[pspSystem loadSystem];</span><br></pre></td></tr></table></figure>
<h2 id="4-9-代理"><a href="#4-9-代理" class="headerlink" title="4.9    代理"></a>4.9    代理</h2><h3 id="4-9-1-代理模式"><a href="#4-9-1-代理模式" class="headerlink" title="4.9.1 代理模式"></a>4.9.1 代理模式</h3><blockquote>
<p><strong>说明：</strong>当一个对象和另一个对象必然耦合的时候，为了降低这种耦合，可以选择和代理对象耦和。代理对象可以是实现了代理协议的任意对象，由于采纳代理协议的对象相比具体对象更灵活且可配置，从而降低了耦和度。<br><strong>注意：</strong>代理对象建议修饰为<code>weak</code>，从而有助于减低消耗。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464019108656.png" alt="Alt text"></p>
<h4 id="案例：顾客和经销商"><a href="#案例：顾客和经销商" class="headerlink" title="案例：顾客和经销商"></a>案例：顾客和经销商</h4><blockquote>
<p>顾客的购买行为代理给经销商</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463899846934.png" alt="Alt text"></p>
<p><em>Customer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Customer</span>;</span></span><br><span class="line"><span class="comment">// 代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CustomerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Customer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理对象(经销商)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> &lt;CustomerDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 购买</span></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Cosutomer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Customer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="comment">// 确保设置了代理对象，且代理对象正确采纳了协议</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(customer:buyItemCount:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate customer:<span class="keyword">self</span></span><br><span class="line">                   buyItemCount:count];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Dealer</span> : <span class="title">NSObject</span> &lt;<span class="title">CustomerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Dealer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Dealer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议，实现方法</span></span><br><span class="line">- (<span class="keyword">void</span>)customer:(Customer *)customer buyItemCount:(<span class="built_in">NSInteger</span>)count &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%ld"</span>, (<span class="keyword">long</span>)count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Customer.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Dealer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 顾客</span></span><br><span class="line">    Customer *customer = [[Customer alloc] init];</span><br><span class="line">    <span class="comment">// 经销商</span></span><br><span class="line">    Dealer *dealer = [[Dealer alloc] init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将经销商实例做为代理对象</span></span><br><span class="line">    customer.delegate = dealer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户购买（会代理到dealer的相应方法去处理）</span></span><br><span class="line">    [customer buyItemCount:<span class="number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-2-代理与协议"><a href="#4-9-2-代理与协议" class="headerlink" title="4.9.2 代理与协议"></a>4.9.2 代理与协议</h3><blockquote>
<p><code>代理对象</code>本质上是<code>让对象采纳协议</code>的一种特殊情况。和单纯要求对象采纳某种协议相比，代理对象承担者完成代理任务的同时降低与被调用者之间的耦和度的职能。</p>
</blockquote>
<h4 id="案例：单纯使用协议"><a href="#案例：单纯使用协议" class="headerlink" title="案例：单纯使用协议"></a>案例：单纯使用协议</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1463922342138.png" alt="Alt text"></p>
<p><em>TCPProtocol.h</em></p>
<blockquote>
<p><strong>说明：</strong>定义协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TCPProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line"><span class="comment">// 获取源端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort;</span><br><span class="line"><span class="comment">// 获取目的地端口号</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.h</em></p>
<blockquote>
<p><strong>说明：</strong>采纳协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Model</span> : <span class="title">NSObject</span> &lt;<span class="title">TCPProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model.m</em></p>
<blockquote>
<p><strong>说明：</strong>实现协议</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Model</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)sourcePort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)destinationPort &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"TCPProtocol.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Model.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> sourcePort;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> destinationPort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 tcp 数据源</span></span><br><span class="line">    Model *tcpData = [[Model alloc] init];</span><br><span class="line">    <span class="comment">// 通过 tcp 数据源获取 tcp 数据</span></span><br><span class="line">    [<span class="keyword">self</span> accessTCPData:tcpData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取 tcp 数据</span><br><span class="line"> *</span><br><span class="line"> *  @param data 采纳了 TCP 协议的数据</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessTCPData:(<span class="keyword">id</span> &lt;TCPProtocol&gt;)data &#123;</span><br><span class="line">    <span class="keyword">self</span>.sourcePort = [data sourcePort];</span><br><span class="line">    <span class="keyword">self</span>.destinationPort = [data destinationPort];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-9-3-用NSProxy-实现的代理模式"><a href="#4-9-3-用NSProxy-实现的代理模式" class="headerlink" title="4.9.3 用NSProxy 实现的代理模式"></a>4.9.3 用NSProxy 实现的代理模式</h3><blockquote>
<p><code>NSProxy</code>：没有父类，和<code>NSObject</code>是一个级别的<br><strong>用途：</strong>可以方便地向代理对象发送一系列消息。</p>
</blockquote>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464018921308.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建代理</span></span><br><span class="line">ConcreteProxy *proxy = [ConcreteProxy alloc];</span><br><span class="line"><span class="comment">// 设置代理对象</span></span><br><span class="line">proxy.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 派发消息</span></span><br><span class="line">[proxy helloWorld];</span><br><span class="line">[proxy goodBye];</span><br></pre></td></tr></table></figure>
<h2 id="4-10-单例"><a href="#4-10-单例" class="headerlink" title="4.10    单例"></a>4.10    单例</h2><h3 id="4-10-1-单例模式"><a href="#4-10-1-单例模式" class="headerlink" title="4.10.1 单例模式"></a>4.10.1 单例模式</h3><h4 id="单例模式的基本原理"><a href="#单例模式的基本原理" class="headerlink" title="单例模式的基本原理"></a>单例模式的基本原理</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464186654392.png" alt="Alt text"></p>
<h4 id="单例模式用以解决何种问题"><a href="#单例模式用以解决何种问题" class="headerlink" title="单例模式用以解决何种问题"></a>单例模式用以解决何种问题</h4><blockquote>
<p>保证某个类只会存在一个全局的实例，全局共享</p>
</blockquote>
<h4 id="单例模式的优缺点"><a href="#单例模式的优缺点" class="headerlink" title="单例模式的优缺点"></a>单例模式的优缺点</h4><ul>
<li>优点：共享实例</li>
<li>缺点：使使用到单例实例的类之间耦和在一起</li>
</ul>
<h4 id="案例：存储用户信息的单例类"><a href="#案例：存储用户信息的单例类" class="headerlink" title="案例：存储用户信息的单例类"></a>案例：存储用户信息的单例类</h4><p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取单例</span><br><span class="line"> *</span><br><span class="line"> *  @return 单例实例</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="comment">// 使用全局变量保存单例实例</span></span><br><span class="line">    <span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predict;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predict, ^&#123;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>使用</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, center.name);</span><br></pre></td></tr></table></figure>
<h3 id="4-10-2-编写严格的单例"><a href="#4-10-2-编写严格的单例" class="headerlink" title="4.10.2 编写严格的单例"></a>4.10.2 编写严格的单例</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>防止继承：在<code>init</code>构造器中判断当前类名，当子类调用<code>init</code>或工厂方法创建实例时中断程序</li>
<li>确保实例对象只出现一个：限制<code>init</code>构造器只能在获取实例的工厂方法中调用，而且只调用一次</li>
</ul>
</blockquote>
<p><em>UserInfoManagerCenter.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UserInfoManagerCenter</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSNumber</span> *age;</span><br><span class="line">+ (instancetype)managerCenter;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>UserInfoManagerCenter.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"UserInfoManagerCenter.h"</span></span></span><br><span class="line"><span class="keyword">static</span> UserInfoManagerCenter *center = <span class="literal">nil</span>;</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UserInfoManagerCenter</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)managerCenter &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> predicate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只执行一次</span></span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;predicate, ^&#123;</span><br><span class="line">        center = (UserInfoManagerCenter *)<span class="string">@"UserInfoManagerCenter"</span>;</span><br><span class="line">        center = [[UserInfoManagerCenter alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">    <span class="comment">// 获取当前实例的类名</span></span><br><span class="line">    <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">    <span class="comment">// 是子类调用该方法则中断程序</span></span><br><span class="line">    <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">        <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *string = (<span class="built_in">NSString</span> *)center;</span><br><span class="line">    <span class="keyword">if</span> ([string isKindOfClass:[<span class="built_in">NSString</span> class]] == <span class="literal">YES</span> &amp;&amp; [string isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">            <span class="comment">/* 防止子类使用 */</span></span><br><span class="line">            <span class="built_in">NSString</span> *classString = <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> class]);</span><br><span class="line">            <span class="keyword">if</span> ([classString isEqualToString:<span class="string">@"UserInfoManagerCenter"</span>] == <span class="literal">NO</span>) &#123;</span><br><span class="line">                <span class="built_in">NSParameterAssert</span>(<span class="literal">nil</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 正确获取单例的方法 */</span></span><br><span class="line">UserInfoManagerCenter *center = [UserInfoManagerCenter managerCenter];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无效的方式:会引起程序崩溃 */</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [NewManagerCenter managerCenter]);<span class="comment">// 试图创建子类实例</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [[UserInfoManagerCenter alloc] init]);<span class="comment">// 试图直接调用构造器</span></span><br></pre></td></tr></table></figure>
<h3 id="4-10-3-优化本地存储"><a href="#4-10-3-优化本地存储" class="headerlink" title="4.10.3 优化本地存储"></a>4.10.3 优化本地存储</h3><blockquote>
<p><strong>要点</strong></p>
<ul>
<li>用单例设计存储数据接口</li>
<li>用单例接口隔离实现细节</li>
<li>在单例提供接口的基础上进行上层封装</li>
</ul>
<p><strong>扩展：</strong>使用<a href="https://github.com/nicklockwood/FastCoding" target="_blank" rel="external"> FastCoding </a>替代<code>NSCoding</code>存储数据<br><strong>注意：</strong>启用<code>ARC</code>时<code>FastCoding</code>运行会比较慢，建议关闭</p>
<ul>
<li>文件启用了<code>ARC</code>是代码给出了警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464361708327.png" alt="Alt text"></li>
<li>通过关闭<code>FastCoder</code>对应的文件的<code>ARC</code>清除警告<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464362026510.png" alt="Alt text"></li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464364328834.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将相对复杂的对象数据存储到用户首选项（借由对象的扩展）</span></span><br><span class="line">StudentModel *student = [[StudentModel alloc] init];</span><br><span class="line">student.name = <span class="string">@"A"</span>;</span><br><span class="line"><span class="built_in">NSArray</span> *array = @[[InfoModel new], [InfoModel new], [InfoModel new]];</span><br><span class="line">student.datas = array;</span><br><span class="line">[student storeValueWithKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从用户首选项中取出数据</span></span><br><span class="line">StudentModel *tmpStudent = [StudentModel valueByKey:<span class="string">@"FastCoding"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.name);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, tmpStudent.datas);</span><br></pre></td></tr></table></figure>
<h2 id="4-11-备忘录"><a href="#4-11-备忘录" class="headerlink" title="4.11    备忘录"></a>4.11    备忘录</h2><h3 id="4-11-1-如何存储记录"><a href="#4-11-1-如何存储记录" class="headerlink" title="4.11.1    如何存储记录"></a>4.11.1    如何存储记录</h3><blockquote>
<p><strong>课程说明：</strong>用几个简单的示例来说明如何存储纪录，并引申出什么是备忘录模式。</p>
</blockquote>
<ul>
<li>存储记录的必要性</li>
<li>记录的唯一标识符</li>
<li>存储纪录和取出记录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447294270.png" alt="Alt text"></li>
</ul>
<h3 id="4-11-2-备忘录模式"><a href="#4-11-2-备忘录模式" class="headerlink" title="4.11.2 备忘录模式"></a>4.11.2 备忘录模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464417280472.png" alt="Alt text"></p>
<ul>
<li>设计存储中心</li>
<li>制定存储接口</li>
<li>实现存储机制</li>
</ul>
<h3 id="4-11-3-优化存储方案"><a href="#4-11-3-优化存储方案" class="headerlink" title="4.11.3    优化存储方案"></a>4.11.3    优化存储方案</h3><ul>
<li>统一存储规范</li>
<li>实现灵活多变的存储机制</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464445381861.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line">Apple *apple = [[Apple alloc] init];</span><br><span class="line">apple.name = <span class="string">@"laputa-er"</span>;</span><br><span class="line">apple.age = @(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[apple saveStateWithKey:<span class="string">@"birth"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复到指定的状态</span></span><br><span class="line">[apple recoverFromStateWithKey:<span class="string">@"birth"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="4-11-4-恢复-UIView-的状态"><a href="#4-11-4-恢复-UIView-的状态" class="headerlink" title="4.11.4    恢复 UIView 的状态"></a>4.11.4    恢复 UIView 的状态</h3><blockquote>
<p><strong>摘要：</strong>可以借助上面实现的备忘录模式存储／恢复<code>UIView</code>的状态。</p>
</blockquote>
<h4 id="存储UIView的问题"><a href="#存储UIView的问题" class="headerlink" title="存储UIView的问题"></a>存储UIView的问题</h4><ol>
<li><code>UIView</code>实现了<code>NSCoding</code>协议，但没有实现<code>NSCopy</code>协议。所以，<code>UIView</code>可以被存储下来，但无法拷贝副本</li>
<li><code>NSCoding</code>协议只能存储对象的所有数据，不能仅存储特定的状态数据（比如<code>frame</code>值）</li>
</ol>
<h4 id="使用备忘录模式"><a href="#使用备忘录模式" class="headerlink" title="使用备忘录模式"></a>使用备忘录模式</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 UIView</span></span><br><span class="line">DemoView *demoView = [[DemoView alloc] init];</span><br><span class="line">demoView.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储此时的状态</span></span><br><span class="line">[demoView saveStateWithKey:<span class="string">@"A"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复状态</span></span><br><span class="line">[demoView recoverFromStateWithKey:<span class="string">@"A"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="4-12-生成器"><a href="#4-12-生成器" class="headerlink" title="4.12    生成器"></a>4.12    生成器</h2><blockquote>
<p><strong>说明：</strong>有时，构建某些对象有多种不同的方式。如果这些逻辑包含在构建这些对象的类的单一方法中，构建的逻辑会非常的荒唐（例如，针对各种构建需求的一大片 <code>if-else</code> 或者 <code>switch-case</code> 语句）。如果能够把构建过程分解为<code>客户-指导者-生成器</code>的关系，那么过程将更容易管理与复用。针对此类关系的设计模式称为<code>生成器</code>。</p>
</blockquote>
<h3 id="4-12-1-建造房子的承包商"><a href="#4-12-1-建造房子的承包商" class="headerlink" title="4.12.1 建造房子的承包商"></a>4.12.1 建造房子的承包商</h3><blockquote>
<p><strong>课程说明：</strong>本课时用一个生活中建造房子例子说明并引申出何为生成器模式</p>
<ul>
<li>如何建造房子</li>
<li>建造过程的模块化处理 </li>
<li>不同模块找不同的承包商</li>
</ul>
<p><strong>使用生成器模式的优点：</strong></p>
<ul>
<li>不需要知道细节</li>
<li>模块化处理</li>
<li>很好的组合特性<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="4-12-2-生成器模式"><a href="#4-12-2-生成器模式" class="headerlink" title="4.12.2 生成器模式"></a>4.12.2 生成器模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464447882554.png" alt="Alt text"></p>
<h3 id="4-12-3-制造汽车的流程"><a href="#4-12-3-制造汽车的流程" class="headerlink" title="4.12.3 制造汽车的流程"></a>4.12.3 制造汽车的流程</h3><blockquote>
<p><strong>说明：</strong>使用生成器模式来制造一辆汽车。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500610532.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464500840393.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建组装着（指挥者）</span></span><br><span class="line"><span class="keyword">self</span>.builder = [[Builder alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定承包商</span></span><br><span class="line"><span class="keyword">self</span>.builder.engine = [[YEngine alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.wheels = [[Wheels alloc] init];</span><br><span class="line"><span class="keyword">self</span>.builder.door = [[Door alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构件所有部件</span></span><br><span class="line">[<span class="keyword">self</span>.builder buildAllParts];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取产品信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>.builder.productsInfo);</span><br></pre></td></tr></table></figure>
<h2 id="4-13-命令"><a href="#4-13-命令" class="headerlink" title="4.13    命令"></a>4.13    命令</h2><blockquote>
<p><strong>命令模式：</strong>在软件系统中，<code>行为请求者</code>与<code>行为执行者</code>通常呈现一种“紧耦合”。但在某些场合，比如要对行为进行<code>记录、撤销/重做、事务</code>等处理，这种无法抵御变化的紧耦合是不合适的。在这种情况下，如何将<code>行为请求者</code>与<code>行为执行者</code>解耦，将行为抽象成对象，实现两者之间的松耦合，这就是我们这门课程所要讲的<code>命令模式</code>。 </p>
</blockquote>
<h3 id="4-13-1-电视机、遥控器与接收器之间的关系"><a href="#4-13-1-电视机、遥控器与接收器之间的关系" class="headerlink" title="4.13.1 电视机、遥控器与接收器之间的关系"></a>4.13.1 电视机、遥控器与接收器之间的关系</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="Alt text"></p>
<ul>
<li>遥控器与接收器并非必要的设备</li>
<li>接收器转换遥控器的信号</li>
</ul>
<h3 id="4-13-2-命令模式"><a href="#4-13-2-命令模式" class="headerlink" title="4.13.2 命令模式"></a>4.13.2 命令模式</h3><ul>
<li>命令的发送者和命令的执行者之间完全解耦</li>
<li>命令可以回退（撤销）</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464515129490.png" alt="Alt text"></p>
<h3 id="4-13-3-改变一个视图的明暗程度"><a href="#4-13-3-改变一个视图的明暗程度" class="headerlink" title="4.13.3 改变一个视图的明暗程度"></a>4.13.3 改变一个视图的明暗程度</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464934489331xcode.gif" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464531258992.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Receiver.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Invoker.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"DarkerCommand.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LighterCommand.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 按钮的tag</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSInteger</span> &#123;</span><br><span class="line">    kAddButtonTag = <span class="number">10</span>, <span class="comment">// 增加按钮tag枚举值</span></span><br><span class="line">    kDelButtonTag, <span class="comment">// 减少按钮tag枚举值</span></span><br><span class="line">    kRolButtonTag, <span class="comment">// 回退按钮tag枚举值</span></span><br><span class="line">&#125; ViewControllerEnumValue;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *addButton;<span class="comment">// 增加亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *delButton;<span class="comment">// 减少亮度按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *rolButton;<span class="comment">// 退回按钮</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Receiver *receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化接收器</span></span><br><span class="line">    <span class="keyword">self</span>.receiver = [[Receiver alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.receiver.clientView = <span class="keyword">self</span>.view;<span class="comment">// 关联客户端视图（遥控器）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化按钮</span></span><br><span class="line">    [<span class="keyword">self</span> initButtons];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initButtons &#123;</span><br><span class="line">    <span class="comment">/*1. 初始化按钮*/</span></span><br><span class="line">    <span class="comment">// 减少亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.delButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.delButton.tag = kDelButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.delButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitle:<span class="string">@"-"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.delButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 增加亮度按钮</span></span><br><span class="line">    <span class="keyword">self</span>.addButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">40</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.addButton.tag = kAddButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.addButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitle:<span class="string">@"+"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 回退按钮</span></span><br><span class="line">    <span class="keyword">self</span>.rolButton = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span> + <span class="number">80</span>, <span class="number">25</span>, <span class="number">90</span>, <span class="number">30</span>)];</span><br><span class="line">    <span class="keyword">self</span>.rolButton.tag = kRolButtonTag;</span><br><span class="line">    <span class="keyword">self</span>.rolButton.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitle:<span class="string">@"回退"</span></span><br><span class="line">                    forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton setTitleColor:[<span class="built_in">UIColor</span> redColor]</span><br><span class="line">                         forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*2. 注册事件*/</span></span><br><span class="line">    [<span class="keyword">self</span>.delButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.addButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.rolButton addTarget:<span class="keyword">self</span></span><br><span class="line">                       action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">             forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*3. 添加到视图*/</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.delButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addButton];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.rolButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  为按钮绑定事件</span><br><span class="line"> *</span><br><span class="line"> *  @param button 需要绑定事件的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button &#123;</span><br><span class="line">    <span class="keyword">if</span> (button.tag == kAddButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"增加亮度"</span>);</span><br><span class="line">        LighterCommand *command = [[LighterCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                 parameter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];<span class="comment">// 添加并执行命令</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kDelButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"减少亮度"</span>);</span><br><span class="line">        DarkerCommand *command = [[DarkerCommand alloc] initWithReceiver:<span class="keyword">self</span>.receiver</span><br><span class="line">                                                                paramter:<span class="number">0.1</span>];</span><br><span class="line">        [[Invoker shareInstance] addAndExcute:command];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (button.tag == kRolButtonTag) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"回退操作"</span>);</span><br><span class="line">        [[Invoker shareInstance] rollBack];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="4-14-组合"><a href="#4-14-组合" class="headerlink" title="4.14    组合"></a>4.14    组合</h2><blockquote>
<p><strong>说明：</strong>将对象组合成树形结构以表示<code>部分-整体</code>的层次结构，组合模式使得用户对单个对象和组合对象的使用具有一致性。组合设计模式可以解决某些线性结构无法解决的难题（如编写文件夹目录结构等类似问题），掌握它具有很实用的意义。 </p>
</blockquote>
<h3 id="4-14-1-树形结构"><a href="#4-14-1-树形结构" class="headerlink" title="4.14.1    树形结构"></a>4.14.1    树形结构</h3><blockquote>
<p><strong>课程说明：</strong>讲解树形结构，并实现一个简易的二叉树，对于后续的组合设计模式的理解很有帮助。</p>
<ul>
<li>树形结构原理</li>
<li>简易的二叉树</li>
<li>用递归遍历树形结构节点</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464533251952.png" alt="Alt text|200x300"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  当前节点名</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  左节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *leftNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  右节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rightNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    <span class="comment">// 创建节点实例（考虑子类的情况，使用 self class 创建实例）</span></span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  根节点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Node *rootNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建根节点</span></span><br><span class="line">    <span class="keyword">self</span>.rootNode = [Node nodeWithName:<span class="string">@"A"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入节点</span></span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"B"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"C"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"D"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"E"</span>]];</span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:<span class="keyword">self</span>.rootNode node:[Node nodeWithName:<span class="string">@"F"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历二叉树</span></span><br><span class="line">    [<span class="keyword">self</span> treeInfomationWithNode:<span class="keyword">self</span>.rootNode];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  往根节点上插入节点</span><br><span class="line"> *</span><br><span class="line"> *  @param tree 根节点</span><br><span class="line"> *  @param node 被插入的节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)insertNodeTree:(Node *)tree node:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tree.leftNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.leftNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (tree.rightNode == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        tree.rightNode = node;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> insertNodeTree:tree.leftNode node:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遍历二叉树</span><br><span class="line"> *</span><br><span class="line"> *  @param node 根节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)treeInfomationWithNode:(Node *)node &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node.leftNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.leftNode];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.nodeName);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (node.rightNode) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> treeInfomationWithNode:node.rightNode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-2-组合模式"><a href="#4-14-2-组合模式" class="headerlink" title="4.14.2    组合模式"></a>4.14.2    组合模式</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464611058484.png" alt="Alt text"></p>
<p><em>Node.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  节点名字</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *nodeName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  便利构造器</span><br><span class="line"> *</span><br><span class="line"> *  @param nodeName 节点名字</span><br><span class="line"> *</span><br><span class="line"> *  @return 节点</span><br><span class="line"> */</span></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  添加子节点</span><br><span class="line"> *</span><br><span class="line"> *  @param nodes 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)nodes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  删除字节点</span><br><span class="line"> *</span><br><span class="line"> *  @param node 节点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  打印 Node</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)operation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Node.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Node.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Node</span> ()</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  子节点集合</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;Node *&gt;*childNodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Node</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.childNodes = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)nodeWithNodeName:(<span class="built_in">NSString</span> *)nodeName &#123;</span><br><span class="line">    Node *node = [[[<span class="keyword">self</span> class] alloc] init];</span><br><span class="line">    node.nodeName = nodeName;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes addObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeNode:(Node *)node &#123;</span><br><span class="line">    [<span class="keyword">self</span>.childNodes removeObject:node];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Node *)nodeAtIndex:(<span class="built_in">NSInteger</span>)index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= <span class="keyword">self</span>.childNodes.count) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.childNodes[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)operation &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"nodeName --&gt; %@"</span>, <span class="keyword">self</span>.nodeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"[Node] - %@"</span>, <span class="keyword">self</span>.nodeName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-14-3-编写文件夹系统"><a href="#4-14-3-编写文件夹系统" class="headerlink" title="4.14.3 编写文件夹系统"></a>4.14.3 编写文件夹系统</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464616045947.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464676034326.png" alt="Alt text"></p>
<h2 id="4-15-迭代器"><a href="#4-15-迭代器" class="headerlink" title="4.15    迭代器"></a>4.15    迭代器</h2><blockquote>
<p>提供一种方法顺序访问一个聚合对象中的各种元素，而又不暴露该对象的内部表示，这种模式叫迭代器模式，<code>Cocoa</code> 框架中的 <code>NSEnumerator</code> 就是迭代器模式的具体实现。学习迭代器模式有助于理解线性表结构的常规使用，对于优化具备线性表结构的类有实际意义。 </p>
</blockquote>
<h3 id="4-15-1-线性表"><a href="#4-15-1-线性表" class="headerlink" title="4.15.1 线性表"></a>4.15.1 线性表</h3><blockquote>
<p><strong>课程说明：</strong>讲解常用线性表基本原理，对于理解何为迭代器模式很有帮助。<br><strong>线性表：</strong>线性表中数据元素之间的关系是一对一的关系，即除了第一个和最后一个数据元素之外，其它数据元素都是首尾相接的（注意，这句话只适用大部分线性表，而不是全部。比如，循环链表逻辑层次上也是一种线性表（存储层次上属于链式存储），但是把最后一个数据元素的尾指针指向了哨位结点）。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700648380.png" alt="Alt text"></p>
<blockquote>
<p>栈和队列就是典型的线性表<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464700681237.png" alt="Alt text"></p>
</blockquote>
<h3 id="4-15-2-迭代器模式"><a href="#4-15-2-迭代器模式" class="headerlink" title="4.15.2 迭代器模式"></a>4.15.2 迭代器模式</h3><blockquote>
<p><strong>课程说明：</strong>讲解迭代器模式基本原理，并简单介绍下 <code>Cocoa</code> 框架已经实现的迭代器。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464708309582.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 系统自身的集合和迭代器 */</span></span><br><span class="line"><span class="comment">// 创建集合对象</span></span><br><span class="line"><span class="built_in">NSArray</span> *datas = @[<span class="string">@"A"</span>, <span class="string">@"B"</span>, <span class="string">@"C"</span>, <span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *iterator = [datas objectEnumerator];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器访问元素</span></span><br><span class="line"><span class="keyword">id</span> arrObj = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (arrObj = [iterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, arrObj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义的集合和迭代器 */</span></span><br><span class="line"><span class="keyword">self</span>.list = [[LinkedList alloc] init];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"A"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"B"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"C"</span>];</span><br><span class="line">[<span class="keyword">self</span>.list addItem:<span class="string">@"D"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从集合对象创建迭代器</span></span><br><span class="line">LinkedListIterator *linkedIterator = [LinkedListIterator linkedListIteratorWithLinkedList:<span class="keyword">self</span>.list];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过迭代器遍历元素</span></span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">while</span> (node = [linkedIterator nextObject]) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-15-3-实现组合对象的迭代器"><a href="#4-15-3-实现组合对象的迭代器" class="headerlink" title="4.15.3 实现组合对象的迭代器"></a>4.15.3 实现组合对象的迭代器</h3><blockquote>
<p><strong>课程说明：</strong>实现一个组合对象的迭代器，并遍历出该组合对象中我们需要关心的元素。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1464751736763.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Custom<span class="built_in">UIView</span> *custom<span class="built_in">UIView</span> = [[Custom<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">Node *node = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">[custom<span class="built_in">UIView</span> resetIterator];</span><br><span class="line"><span class="keyword">while</span> (node = [custom<span class="built_in">UIView</span> nextObject]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, node.item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_3  音频视频处理/" itemprop="url">
                  3 音频视频处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:52+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_3  音频视频处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_3  音频视频处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-iOS-API视频的播放和录制"><a href="#3-1-iOS-API视频的播放和录制" class="headerlink" title="3.1    iOS API视频的播放和录制"></a>3.1    iOS API视频的播放和录制</h2><blockquote>
<p><strong>注意：</strong><code>MPMoviePlayerViewController</code>在<code>iOS9中</code>过时了</p>
</blockquote>
<h3 id="3-1-1-播放视频"><a href="#3-1-1-播放视频" class="headerlink" title="3.1.1    播放视频"></a>3.1.1    播放视频</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_video1.gif" alt="Alt text|200x350"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> pc:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        pc = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSBundle</span>.mainBundle().<span class="type">URLForResource</span>(<span class="string">"video"</span>, withExtension: <span class="string">"mp4"</span>))</span><br><span class="line">        presentViewController(pc, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-录制视频"><a href="#3-1-2-录制视频" class="headerlink" title="3.1.2    录制视频"></a>3.1.2    录制视频</h3><blockquote>
<p><strong>注意：</strong> xcode 的虚拟机不支持使用相机，模拟使用相机只能选择真机！<br><strong>技巧：</strong>调试时可以通过<code>window-&gt;Devices</code>，在设备管理面板选择要管理的设备进行操作（比如截屏）。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MobileCoreServices<span class="comment">// 录制视频使用到的库</span></span><br><span class="line"><span class="keyword">import</span> MediaPlayer<span class="comment">// 播放视频用到的库</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UIImagePickerControllerDelegate</span>, <span class="title">UINavigationControllerDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片选择器</span></span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">UIImagePickerController</span>!<span class="comment">// 可以选择从图库或摄像头中选择图片或视频（源为摄像头意味着拍照或视频）</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> videoUrl:<span class="type">NSURL</span>?</span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMoviePlayerViewController</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录制</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">recVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        picker = <span class="type">UIImagePickerController</span>()</span><br><span class="line">        picker.mediaTypes = [kUTTypeMovie <span class="keyword">as</span> <span class="type">String</span>]</span><br><span class="line">        picker.sourceType = <span class="type">UIImagePickerControllerSourceType</span>.<span class="type">Camera</span><span class="comment">// 设置源通过摄像头</span></span><br><span class="line">        picker.cameraCaptureMode = <span class="type">UIImagePickerControllerCameraCaptureMode</span>.<span class="type">Video</span><span class="comment">// 设置摄像头为录制视频模式</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playVideoBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = videoUrl &#123;</span><br><span class="line">            player = <span class="type">MPMoviePlayerViewController</span>(contentURL: url)</span><br><span class="line">            presentViewController(player, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选中了视频时（录制完成后）被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(picker: UIImagePickerController, didFinishPickingImage image: UIImage, editingInfo: [String : AnyObject]?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取录制好的视频资源的url地址</span></span><br><span class="line">        videoUrl = editingInfo![<span class="type">UIImagePickerControllerMediaURL</span>] <span class="keyword">as</span>? <span class="type">NSURL</span></span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消录制视频时被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">imagePickerControllerDidCancel</span><span class="params">(picker: UIImagePickerController)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭录制视频的视图控制器</span></span><br><span class="line">        picker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS音频相关-API-的使用"><a href="#3-2-iOS音频相关-API-的使用" class="headerlink" title="3.2    iOS音频相关 API 的使用"></a>3.2    iOS音频相关 API 的使用</h2><h3 id="3-2-1-播放声音"><a href="#3-2-1-播放声音" class="headerlink" title="3.2.1    播放声音"></a>3.2.1    播放声音</h3><blockquote>
<p><strong>说明：</strong>给出两种方式</p>
<ul>
<li>使用<code>AVAudioPlayer</code>播放音乐文件</li>
<li>使用<code>MediaPlayer</code>播放音乐</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> aPlayer:<span class="type">AVAudioPlayer</span>!</span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 暂定</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">pauseBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.pause()<span class="comment">// 暂停后音乐仍然处在准备播放的状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        aPlayer.stop()<span class="comment">// 通知后音乐不会处在准备播放状态，但会记住停止时的位置</span></span><br><span class="line">        aPlayer.currentTime = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另一种方式播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playSongBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 初始化播放控制器</span></span><br><span class="line">        <span class="keyword">let</span> p = <span class="type">MPMoviePlayerViewController</span>(contentURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        presentViewController(p, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">// 初始化 AVAudioPlayer</span></span><br><span class="line">            aPlayer = <span class="keyword">try</span> <span class="type">AVAudioPlayer</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"sound"</span>, ofType: <span class="string">"mp3"</span>)!))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"failed"</span>)</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-播放乐库音乐"><a href="#3-2-2-播放乐库音乐" class="headerlink" title="3.2.2    播放乐库音乐"></a>3.2.2    播放乐库音乐</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>（<code>ViewController</code>）采纳<code>MPMediaPickerControllerDelegate</code>协议</li>
<li>初始化媒体选择控制器（<code>MPMediaPickerController</code>）和音乐播放控制器（<code>MPMusicPlayerController</code>）</li>
<li>实现采纳协议的相关方法</li>
</ol>
<p><strong>注意：</strong>在虚拟机中是不能使用音乐库的</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> MediaPlayer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">MPMediaPickerControllerDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> picker:<span class="type">MPMediaPickerController</span>!<span class="comment">// 选择音乐控制器</span></span><br><span class="line">    <span class="keyword">var</span> player:<span class="type">MPMusicPlayerController</span>!<span class="comment">// 播放音乐控制器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSelectMusicClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        presentViewController(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 选择音乐完成后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPicker</span><span class="params">(mediaPicker: MPMediaPickerController, didPickMediaItems mediaItemCollection: MPMediaItemCollection)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 关闭视频选择控制器</span></span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="comment">// 将选中的音乐加入到播放列表</span></span><br><span class="line">        player.setQueueWithItemCollection(mediaItemCollection)</span><br><span class="line">        <span class="comment">// 开始播放</span></span><br><span class="line">        player.play()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取选中的第一首歌的名字</span></span><br><span class="line">        <span class="keyword">let</span> firstName:<span class="type">AnyObject</span> = mediaItemCollection.items[<span class="number">0</span>].valueForProperty(<span class="type">MPMediaItemPropertyTitle</span>)!</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\(firstName)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 取消播放时调用</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mediaPickerDidCancel</span><span class="params">(mediaPicker: MPMediaPickerController)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cancel"</span>)</span><br><span class="line">        mediaPicker.dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        picker = <span class="type">MPMediaPickerController</span>(mediaTypes: <span class="type">MPMediaType</span>.<span class="type">Music</span>)</span><br><span class="line">        picker.allowsPickingMultipleItems = <span class="literal">true</span><span class="comment">// 可以选择多个</span></span><br><span class="line">        picker.delegate = <span class="keyword">self</span></span><br><span class="line">        </span><br><span class="line">        player = <span class="type">MPMusicPlayerController</span>.systemMusicPlayer()<span class="comment">// 创建全局音乐播放器(程序退出后仍可以播放)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-录制声音"><a href="#3-2-3-录制声音" class="headerlink" title="3.2.3    录制声音"></a>3.2.3    录制声音</h3><blockquote>
<p><strong>疑问：</strong>下面程序找到的<code>Documents</code>文件夹路径不可用，竟然在<code>Library</code>下面，但下面其实没有<code>Documents</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E/Library/Documentation/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cd</span> /Users/tonyearth/Library/Developer/CoreSimulator/Devices/5A05DBF7-F5EC-4B5B-ABF0-EA396DA417DB/data/Containers/Data/Application/3483064B-0B9F-4E73-B193-D0829300D43E</span><br><span class="line"></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── Documents</span><br><span class="line">├── Library</span><br><span class="line">│   ├── Caches</span><br><span class="line">│   │   └── Snapshots</span><br><span class="line">│   │       └── com.earth.L0204-----</span><br><span class="line">│   │           ├── 50998B49-4017-4DAA-A8BB-49F0A32325DD@2x.png</span><br><span class="line">│   │           └── C0EB8483-DCD1-41F9-8F4D-1AADC05666E1@2x.png</span><br><span class="line">│   └── Preferences</span><br><span class="line">└── tmp</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> avRec:<span class="type">AVAudioRecorder</span>!<span class="comment">// 录音器</span></span><br><span class="line">    <span class="keyword">var</span> audioFileUrl:<span class="type">NSURL</span>!<span class="comment">// 保存地址</span></span><br><span class="line">    <span class="keyword">var</span> avPlayer:<span class="type">AVAudioPlayer</span>!<span class="comment">// 播放器</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 开始录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">startRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"start rec"</span>)</span><br><span class="line">        avRec.record()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 停止录音</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">stopRecBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"stop rec"</span>)</span><br><span class="line">        avRec.stop()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">playRectBtnClicked</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"play rec：\(audioFileUrl)"</span>)</span><br><span class="line">        avPlayer = <span class="keyword">try</span>? <span class="type">AVAudioPlayer</span>(contentsOfURL: audioFileUrl)</span><br><span class="line">        avPlayer.prepareToPlay()</span><br><span class="line">        avPlayer.play()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        audioFileUrl = (<span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">NSURL</span>).<span class="type">URLByAppendingPathComponent</span>(<span class="string">"rec"</span>)</span><br><span class="line">        avRec = <span class="keyword">try</span>? <span class="type">AVAudioRecorder</span>(<span class="type">URL</span>: audioFileUrl,</span><br><span class="line">                                        settings: [:])</span><br><span class="line">        avRec.prepareToRecord()</span><br><span class="line"><span class="comment">// 查看文件路径</span></span><br><span class="line">        <span class="keyword">let</span> sp = <span class="type">NSFileManager</span>.defaultManager().<span class="type">URLsForDirectory</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">DocumentationDirectory</span>, inDomains: <span class="type">NSSearchPathDomainMask</span>.<span class="type">AllDomainsMask</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sp &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\(item)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_2  网络通信/" itemprop="url">
                  2 网络通信
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:03:10+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_2  网络通信/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_2  网络通信/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="2-1-iOS-HTTP通信"><a href="#2-1-iOS-HTTP通信" class="headerlink" title="2.1    iOS-HTTP通信"></a>2.1    iOS-HTTP通信</h2><h3 id="2-1-1-同步加载网络数据"><a href="#2-1-1-同步加载网络数据" class="headerlink" title="2.1.1    同步加载网络数据"></a>2.1.1    同步加载网络数据</h3><blockquote>
<p><strong>说明：</strong>介绍两种方式</p>
<ul>
<li><code>NSString</code>提供的构造器</li>
<li><code>NSURLConnection.sendSynchronousRequest</code>方法（iOS 9中已过时）</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPageByNSString()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSString）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSString</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> str = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> data = <span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(str)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     同步方式请求极客学院首页（通过 NSURLConnection）</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPageByNSURLConnection</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> resp:<span class="type">NSURLResponse</span>?</span><br><span class="line">            <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="type">NSURLConnection</span>.sendSynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://hikexueyuan.com"</span>)!), returningResponse: &amp;resp)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(resp)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"无法连接网络"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-异步加载网络数据"><a href="#2-2-2-异步加载网络数据" class="headerlink" title="2.2.2    异步加载网络数据"></a>2.2.2    异步加载网络数据</h3><blockquote>
<p><strong>说明：</strong><code>NSURLConnection.sendAsynchronousRequest</code>（在<code>iOS9 中过时</code>）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        loadJKPage()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadJKPage</span><span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://jikexueyuan.com"</span>)!), queue: <span class="type">NSOperationQueue</span>()) &#123;(resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> e = error &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"请求失败:\(e)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="type">NSString</span>(data: data!, encoding: <span class="type">NSUTF8StringEncoding</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-搭建J2E集成开发环境"><a href="#2-2-3-搭建J2E集成开发环境" class="headerlink" title="2.2.3 搭建J2E集成开发环境"></a>2.2.3 搭建J2E集成开发环境</h3><h4 id="2-2-3-1-安装-Apache-Tomcat"><a href="#2-2-3-1-安装-Apache-Tomcat" class="headerlink" title="2.2.3.1    安装 Apache Tomcat"></a>2.2.3.1    安装 Apache Tomcat</h4><blockquote>
<p><strong>下载 Apache Tomcat：</strong><a href="http://tomcat.apache.org/download-80.cgi" target="_blank" rel="external">http://tomcat.apache.org/download-80.cgi</a></p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.30.32.png" alt="Alt text"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /usr/<span class="built_in">local</span></span><br><span class="line">$ mv ~/Downloads/apache-tomcat-8.0.33 /usr/<span class="built_in">local</span></span><br><span class="line">$ sudo ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/apache-tomcat-8.0.33 /Library/Tomcat8</span><br><span class="line">$ chown -R  tonyearth /Library/Tomcat8</span><br><span class="line">$ sudo chown -R  tonyearth /Library/Tomcat8/bin/*.sh</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-2-安装-Tomcat-Controller"><a href="#2-2-3-2-安装-Tomcat-Controller" class="headerlink" title="2.2.3.2    安装 Tomcat Controller"></a>2.2.3.2    安装 Tomcat Controller</h4><blockquote>
<p><strong>下载 Tomcat Controller：</strong><a href="http://tomcat-controller.en.softonic.com/mac/download#downloading" target="_blank" rel="external">http://tomcat-controller.en.softonic.com/mac/download#downloading</a></p>
</blockquote>
<h4 id="2-2-3-3-安装-eclispe"><a href="#2-2-3-3-安装-eclispe" class="headerlink" title="2.2.3.3    安装 eclispe"></a>2.2.3.3    安装 eclispe</h4><blockquote>
<p><strong>下载eclipse：</strong><a href="http://www.eclipse.org/downloads/" target="_blank" rel="external">http://www.eclipse.org/downloads/</a></p>
</blockquote>
<h5 id="创建Dynamic-Web-Project"><a href="#创建Dynamic-Web-Project" class="headerlink" title="创建Dynamic Web Project"></a>创建Dynamic Web Project</h5><ol>
<li>开始创建新项目<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.45.png" alt="Alt text|300x150"></li>
<li>New Runtime<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.56.png" alt="Alt text|300x200"></li>
<li>选择前面安装好的 Tomecat8 的安装目录<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.35.17.png" alt="Alt text|300x120"></li>
<li>创建 JSP文件 测试<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-21%20%E4%B8%8A%E5%8D%8812.39.14.png" alt="Alt text|300x200"></li>
</ol>
<h3 id="2-2-4-通过GET-POST方式与服务器通信"><a href="#2-2-4-通过GET-POST方式与服务器通信" class="headerlink" title="2.2.4    通过GET/POST方式与服务器通信"></a>2.2.4    通过GET/POST方式与服务器通信</h3><h4 id="2-2-4-1-后端"><a href="#2-2-4-1-后端" class="headerlink" title="2.2.4.1    后端"></a>2.2.4.1    后端</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1461253557430.png" alt="Alt text|200x200"></p>
<p><em>returnParas.jsp</em></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"><span class="keyword">if</span> (name != <span class="keyword">null</span>) &#123;</span><br><span class="line">	out.print(<span class="string">"Hello "</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	out.print(<span class="string">"No Args"</span>);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-2-客户端"><a href="#2-2-4-2-客户端" class="headerlink" title="2.2.4.2    客户端"></a>2.2.4.2    客户端</h4><blockquote>
<p><strong>注意：</strong>下面请求使用的<code>API</code>在<code>iOS9</code>中已过时<br><strong>技巧：</strong>网络请求交给子线程而不是主线程处理，不占用主线程的资源，从而不带来界面卡顿的问题<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1462710986603_get.gif" alt="Alt text|300x200"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textInput: <span class="type">UITextField</span>!<span class="comment">// 输入请求参数</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textShow: <span class="type">UITextView</span>!<span class="comment">// 展示请求会的结果</span></span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnRequestPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        testGet()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送 get 请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testGet</span><span class="params">()</span></span>-&gt; () &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建一个线程发起请求，不占用主线程的资源</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(<span class="type">NSURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp?name=\(name)"</span>)!), queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                <span class="comment">// 交给主线程处理</span></span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="comment">// self.textShow 是主线程的控件，因此必须在主线程中处理</span></span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     发送post请求</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testPost</span><span class="params">()</span></span>-&gt;() &#123;</span><br><span class="line">        <span class="keyword">let</span> name = textInput.text!</span><br><span class="line">        <span class="comment">// 创建并设置请求</span></span><br><span class="line">        <span class="keyword">let</span> req = <span class="type">NSMutableURLRequest</span>(<span class="type">URL</span>: <span class="type">NSURL</span>(string: <span class="string">"http://localhost:8080/MyServer/returnParas.jsp"</span>)!)</span><br><span class="line">        req.<span class="type">HTTPMethod</span> = <span class="string">"POST"</span></span><br><span class="line">        req.<span class="type">HTTPBody</span> = <span class="type">NSString</span>(string: <span class="string">"name=\(name)"</span>).dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="type">NSURLConnection</span>.sendAsynchronousRequest(req, queue: <span class="type">NSOperationQueue</span>(), completionHandler: &#123;</span><br><span class="line">            (resp:<span class="type">NSURLResponse</span>?, data:<span class="type">NSData</span>?, error:<span class="type">NSError</span>?) -&gt; () <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> d = data &#123;</span><br><span class="line">                dispatch_sync(dispatch_get_main_queue(), &#123;</span><br><span class="line">                    <span class="keyword">self</span>.textShow.text = <span class="type">NSString</span>(data: d, encoding: <span class="type">NSUTF8StringEncoding</span>)! <span class="keyword">as</span> <span class="type">String</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS高级_1  数据处理/" itemprop="url">
                  1 数据处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:02:28+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS高级_1  数据处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS高级_1  数据处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-操作plist数据"><a href="#1-1-操作plist数据" class="headerlink" title="1.1    操作plist数据"></a>1.1    操作plist数据</h2><h3 id="1-1-1-plist数据介绍"><a href="#1-1-1-plist数据介绍" class="headerlink" title="1.1.1    plist数据介绍"></a>1.1.1    plist数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解<code>plist</code>数据格式以及如何编辑<code>plist</code>文件。</p>
</blockquote>
<h3 id="1-1-2-plist数组解析"><a href="#1-1-2-plist数组解析" class="headerlink" title="1.1.2    plist数组解析"></a>1.1.2    plist数组解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析plist数组。</p>
</blockquote>
<p><em>TestArr.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-16%20%E4%B8%8B%E5%8D%8811.46.38.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取出plist中的数据（数组）</span></span><br><span class="line"><span class="keyword">let</span> arr = <span class="type">NSArray</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestArr"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Optional((</span><br><span class="line">    human,</span><br><span class="line">    bear,</span><br><span class="line">    elephant,</span><br><span class="line">    wolf,</span><br><span class="line">    monkey,</span><br><span class="line">    tiger</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<h3 id="1-1-3-plist字典解析"><a href="#1-1-3-plist字典解析" class="headerlink" title="1.1.3    plist字典解析"></a>1.1.3    plist字典解析</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何解析<code>plist</code>字典。</p>
</blockquote>
<p><em>TestDic.plist</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460822236961.png" alt="Alt text"><br><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dict = <span class="type">NSDictionary</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"TestDic"</span>, ofType: <span class="string">"plist"</span>)!));</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dict)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Optional(&#123;</span><br><span class="line">    event = film;</span><br><span class="line">    members =     (</span><br><span class="line">        me,</span><br><span class="line">        lili,</span><br><span class="line">        xiaoli</span><br><span class="line">    );</span><br><span class="line">    time = <span class="string">"2016\U5e744\U670816\U65e5\U5468\U516d\U4e0b\U534811:54"</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="1-2-CoreData"><a href="#1-2-CoreData" class="headerlink" title="1.2    CoreData"></a>1.2    CoreData</h2><h3 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h3><blockquote>
<p><strong>官网：</strong><a href="http://sqlite.org/" target="_blank" rel="external">http://sqlite.org/</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_coredata.gif" alt="案例| 200x150"></p>
</blockquote>
<h3 id="1-2-1-创建使用CoreData的项目"><a href="#1-2-1-创建使用CoreData的项目" class="headerlink" title="1.2.1    创建使用CoreData的项目"></a>1.2.1    创建使用<code>CoreData</code>的项目</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍<code>SQLite</code>以及如何创建一个使用<code>CoreData</code>的项目。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.32.25.png" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作sqlite的上下文环境</span></span><br><span class="line"><span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-设计数据结构"><a href="#1-2-2-设计数据结构" class="headerlink" title="1.2.2    设计数据结构"></a>1.2.2    设计数据结构</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用<code>Xcode</code>设计数据库的结构。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%883.40.34.png" alt="Alt text"></p>
</blockquote>
<h3 id="1-2-3-插入数据"><a href="#1-2-3-插入数据" class="headerlink" title="1.2.3    插入数据"></a>1.2.3    插入数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何插入一条数据。</p>
</blockquote>
<h4 id="1-2-3-1-插入数据"><a href="#1-2-3-1-插入数据" class="headerlink" title="1.2.3.1    插入数据"></a>1.2.3.1    插入数据</h4><p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 1. 获取操作sqlite的上下文环境</span></span><br><span class="line">        <span class="keyword">let</span> context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        <span class="comment">// 2. 为 Users 表插入一行数据</span></span><br><span class="line">        <span class="comment">// 创建一行（字段为默认值）</span></span><br><span class="line">        <span class="keyword">let</span> row:<span class="type">AnyObject</span> = <span class="type">NSEntityDescription</span>.insertNewObjectForEntityForName(<span class="string">"Users"</span>, inManagedObjectContext:context)</span><br><span class="line">        <span class="comment">// 设置 name 字段</span></span><br><span class="line">        row.setValue(<span class="string">"jikexueyuan"</span>, forKey:<span class="string">"name"</span>)</span><br><span class="line">        <span class="comment">// 设置 age 字段</span></span><br><span class="line">        row.setValue(<span class="number">10</span>, forKey: <span class="string">"age"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 持久化</span></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> context.save()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"Error"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-3-2-查看SQLite文件地址"><a href="#1-2-3-2-查看SQLite文件地址" class="headerlink" title="1.2.3.2    查看SQLite文件地址"></a>1.2.3.2    查看<code>SQLite</code>文件地址</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-17%20%E4%B8%8B%E5%8D%886.00.14.png" alt="Alt text"><br><em>AppDelegate.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="meta">@UIApplicationMain</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDelegate</span>: <span class="title">UIResponder</span>, <span class="title">UIApplicationDelegate</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	 <span class="built_in">lazy</span> <span class="keyword">var</span> persistentStoreCoordinator: <span class="type">NSPersistentStoreCoordinator</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> coordinator = <span class="type">NSPersistentStoreCoordinator</span>(managedObjectModel: <span class="keyword">self</span>.managedObjectModel)</span><br><span class="line">        <span class="keyword">let</span> url = <span class="keyword">self</span>.applicationDocumentsDirectory.<span class="type">URLByAppendingPathComponent</span>(<span class="string">"SingleViewCoreData.sqlite"</span>)</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">		...</span><br><span class="line">     &#125;()</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///Users/tonyearth/Library/Developer/CoreSimulator/Devices/1041D05D-4C13-45A9-BD8C-B209722B59F2/data/Containers/Data/Application/AA16281E-DE67-4A56-859C-2C96834101CE/Documents/SingleViewCoreData.sqlite</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-读取数据"><a href="#1-2-4-读取数据" class="headerlink" title="1.2.4    读取数据"></a>1.2.4    读取数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取<code>SQLite</code>的数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">let</span> f = <span class="type">NSFetchRequest</span>(entityName: <span class="string">"Users"</span>)</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> dataArr = context.executeFetchRequest(f)</span><br><span class="line">    tableView.reloadData()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"数据查询失败"</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="1-2-5-更新数据"><a href="#1-2-5-更新数据" class="headerlink" title="1.2.5    更新数据"></a>1.2.5    更新数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何更新数据。</p>
</blockquote>
<p><em>UserContentViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserContentViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfName: <span class="type">UITextField</span>!<span class="comment">// 姓名</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> tfAge: <span class="type">UITextField</span>!<span class="comment">// 年龄</span></span><br><span class="line">    <span class="keyword">var</span> data:<span class="type">NSManagedObject</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">        tfName.text = data.valueForKey(<span class="string">"name"</span>) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> age:<span class="type">AnyObject</span>! = data.valueForKey(<span class="string">"age"</span>)</span><br><span class="line">        tfAge.text = <span class="string">"\(age)"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">didReceiveMemoryWarning</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.didReceiveMemoryWarning()</span><br><span class="line">        <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击提交按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">submitBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">	    <span class="comment">// 更新数据</span></span><br><span class="line">        data.setValue(tfName.text, forKey: <span class="string">"name"</span>)</span><br><span class="line">        data.setValue(<span class="type">Int</span>(tfAge.text!), forKey: <span class="string">"age"</span>)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> data.managedObjectContext?.save()</span><br><span class="line">            dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"save failed"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击取消按钮</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">cancelBtnPressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        dismissViewControllerAnimated(<span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-6-删除数据"><a href="#1-2-6-删除数据" class="headerlink" title="1.2.6    删除数据"></a>1.2.6    删除数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何删除数据。</p>
</blockquote>
<p><em>UserTableViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserTableViewController</span>: <span class="title">UITableViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 存放数据库信息</span></span><br><span class="line">    <span class="keyword">var</span> dataArr:<span class="type">Array</span>&lt;<span class="type">AnyObject</span>&gt; = []</span><br><span class="line">    <span class="comment">// 数据库上下文</span></span><br><span class="line">    <span class="keyword">var</span> context:<span class="type">NSManagedObjectContext</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">        context = (<span class="type">UIApplication</span>.sharedApplication().delegate <span class="keyword">as</span>! <span class="type">AppDelegate</span>).managedObjectContext</span><br><span class="line">        refreshData()</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Override to support editing the table view.</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, commitEditingStyle editingStyle: UITableViewCellEditingStyle, forRowAtIndexPath indexPath: NSIndexPath)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 删除 table 中的一个cell</span></span><br><span class="line">        <span class="keyword">if</span> editingStyle == .<span class="type">Delete</span> &#123;</span><br><span class="line">            <span class="comment">// 删除数据</span></span><br><span class="line">            context.deleteObject(dataArr[indexPath.row] <span class="keyword">as</span>! <span class="type">NSManagedObject</span>)</span><br><span class="line">            <span class="comment">// 持久化</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> context.save()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"删除数据失败"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            refreshData()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向 table 中插入一条 cell</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> editingStyle == .<span class="type">Insert</span> &#123;</span><br><span class="line">            <span class="comment">// Create a new instance of the appropriate class, insert it into the array, and add a new row to the table view</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-操作-JSON-数据"><a href="#1-3-操作-JSON-数据" class="headerlink" title="1.3    操作 JSON 数据"></a>1.3    操作 JSON 数据</h2><h3 id="1-3-1-JSON数据介绍"><a href="#1-3-1-JSON数据介绍" class="headerlink" title="1.3.1    JSON数据介绍"></a>1.3.1    JSON数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>JSON</code> 格式数据的语法。</p>
</blockquote>
<h3 id="1-3-2-Swift-解析-JSON-数据"><a href="#1-3-2-Swift-解析-JSON-数据" class="headerlink" title="1.3.2    Swift 解析 JSON 数据"></a>1.3.2    Swift 解析 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言解析 <code>JSON</code> 格式的数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 从json文件中读取 json 格式数据</span></span><br><span class="line">    <span class="keyword">let</span> json:<span class="type">AnyObject</span>? = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(<span class="type">NSData</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"obj"</span>, ofType: <span class="string">"json"</span>)!))!, options: <span class="type">NSJSONReadingOptions</span>())</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 索引 json 内容</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> lang:<span class="type">AnyObject</span> = json?.objectForKey(<span class="string">"language"</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(lang)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"json 文件读取失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-Swift-生成-JSON-数据"><a href="#1-3-3-Swift-生成-JSON-数据" class="headerlink" title="1.3.3    Swift 生成 JSON 数据"></a>1.3.3    Swift 生成 JSON 数据</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解如何使用 <code>Swift</code> 语言生成<code>JSON</code> 格式数据。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字典</span></span><br><span class="line"><span class="keyword">let</span> dict = [<span class="string">"name"</span>:<span class="string">"lixiangguo"</span>, <span class="string">"age"</span>: <span class="string">"-1"</span>];</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 将字典转化为 json 格式的NSData</span></span><br><span class="line">    <span class="keyword">let</span> jsonData = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.dataWithJSONObject(dict, options: <span class="type">NSJSONWritingOptions</span>())</span><br><span class="line">    <span class="comment">// 将 NSData 转换为 NSString</span></span><br><span class="line">    <span class="keyword">let</span> jsonStr  = <span class="type">NSString</span>(data: jsonData, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(jsonStr)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"字典解析为json格式字符串失败"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-4-操作XML数据"><a href="#1-4-操作XML数据" class="headerlink" title="1.4    操作XML数据"></a>1.4    操作XML数据</h2><h3 id="1-4-1-XML格式数据介绍"><a href="#1-4-1-XML格式数据介绍" class="headerlink" title="1.4.1    XML格式数据介绍"></a>1.4.1    XML格式数据介绍</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍XML格式数据的结构以及如何编写XML文件</p>
</blockquote>
<h3 id="1-4-2-Swift解析XML格式的数据"><a href="#1-4-2-Swift解析XML格式的数据" class="headerlink" title="1.4.2    Swift解析XML格式的数据"></a>1.4.2    Swift解析XML格式的数据</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍如何使用Swift语言解析<code>XML</code>格式的数据</p>
<ol>
<li>引入资源：xml 文件</li>
<li>采纳协议：<code>NSXMLParserDelegate</code></li>
<li>获取资源并解析（通过代理）</li>
</ol>
</blockquote>
<p><em>testData.xml</em></p>
<blockquote>
<p><strong>说明：</strong>待解析的 xml 文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>mengqingshen<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"25"</span>&gt;</span>yixiaoli<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"0.3"</span>&gt;</span>mengxiang<span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c</span>&gt;</span>Data<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">NSXMLParserDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前解析出的节点</span></span><br><span class="line">    <span class="keyword">var</span> currentNodeName:<span class="type">String</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过 xml 文件获取 NSXMLParser</span></span><br><span class="line">        <span class="keyword">let</span> parser = <span class="type">NSXMLParser</span>(contentsOfURL: <span class="type">NSURL</span>(fileURLWithPath: <span class="type">NSBundle</span>.mainBundle().pathForResource(<span class="string">"testData"</span>, ofType: <span class="string">"xml"</span>)!))</span><br><span class="line">        <span class="comment">// 设置代理</span></span><br><span class="line">        parser?.delegate = <span class="keyword">self</span></span><br><span class="line">        <span class="comment">// 解析数据</span></span><br><span class="line">        parser?.parse()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每解析到一个节点的开标签时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String])</span></span> &#123;</span><br><span class="line">        currentNodeName = elementName</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印 person 节点的 age 属性</span></span><br><span class="line">        <span class="keyword">if</span> elementName == <span class="string">"person"</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> age:<span class="type">AnyObject</span> = attributeDict[<span class="string">"age"</span>] &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"age:\(age)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     @ 采纳协议</span><br><span class="line">     每发现一个叶子节点包裹的字符串时调用一次</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">parser</span><span class="params">(parser: NSXMLParser, foundCharacters string: String)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> str = string.stringByTrimmingCharactersInSet(<span class="type">NSCharacterSet</span>.whitespaceAndNewlineCharacterSet())</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 过滤掉空白符号(包括换行符)</span></span><br><span class="line">        <span class="keyword">if</span> str != <span class="string">""</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"current node: \(currentNodeName), value:\(str)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-3-选择题实例"><a href="#1-4-3-选择题实例" class="headerlink" title="1.4.3    选择题实例"></a>1.4.3    选择题实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个实例演示如何在程序中使用<code>XML</code>格式的数据</p>
<ol>
<li>（工程）引入 xml 文件</li>
<li>（storyboard）编辑界面</li>
<li>（ViewController.swift）绑定控件和注册事件</li>
</ol>
</blockquote>
<h2 id="1-5-iOS用户首选项数据"><a href="#1-5-iOS用户首选项数据" class="headerlink" title="1.5    iOS用户首选项数据"></a>1.5    iOS用户首选项数据</h2><h3 id="1-5-1-用户首选项数据说明"><a href="#1-5-1-用户首选项数据说明" class="headerlink" title="1.5.1    用户首选项数据说明"></a>1.5.1    用户首选项数据说明</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解iOS首选项数据的概念及用途<br><strong>说明：</strong>用户首选项数据适合以下场景</p>
<ol>
<li>数据量小</li>
<li>键值对形式存储</li>
<li>保存到首选项的数据在app关闭后不会被清空</li>
</ol>
</blockquote>
<h3 id="1-5-2-存储用户首选项数据"><a href="#1-5-2-存储用户首选项数据" class="headerlink" title="1.5.2    存储用户首选项数据"></a>1.5.2    存储用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何存储用户首选项数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_shouxuanxiang.gif" alt="Alt text|200x350"></p>
</blockquote>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span>!<span class="comment">// 输入框</span></span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">btnSavePressed</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 保存到首选项</span></span><br><span class="line">        ud.setObject(textView.text, forKey: <span class="string">"data"</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"saved"</span>)</span><br><span class="line">        <span class="comment">// 创建提示框</span></span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"成功"</span>,</span><br><span class="line">            message: <span class="string">"成功保存到首选项"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">ActionSheet</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: <span class="type">UIAlertActionStyle</span>.<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 弹出提示框</span></span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 读取首选项数据初始化界面</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> value:<span class="type">AnyObject</span> = ud.objectForKey(<span class="string">"data"</span>) &#123;</span><br><span class="line">            textView.text = value <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            textView.text = <span class="string">"No value"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-5-3-读取用户首选项数据"><a href="#1-5-3-读取用户首选项数据" class="headerlink" title="1.5.3    读取用户首选项数据"></a>1.5.3    读取用户首选项数据</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何读取用户首选项数据</p>
</blockquote>
<h3 id="1-5-4-启动时小贴士实例"><a href="#1-5-4-启动时小贴士实例" class="headerlink" title="1.5.4    启动时小贴士实例"></a>1.5.4    启动时小贴士实例</h3><blockquote>
<p><strong>课程说明：</strong>本课用一个小实例演示用户首选项数据的使用场景<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_tip.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">weak</span> <span class="keyword">var</span> mySwitch: <span class="type">UISwitch</span>!</span><br><span class="line">    <span class="keyword">var</span> ud:<span class="type">NSUserDefaults</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">switchChangedHandler</span><span class="params">(sender: AnyObject)</span></span> &#123;</span><br><span class="line">        ud.setBool(mySwitch.on, forKey: <span class="string">"showTips"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        ud = <span class="type">NSUserDefaults</span>.standardUserDefaults()</span><br><span class="line">        mySwitch.on = ud.boolForKey(<span class="string">"showTips"</span>)</span><br><span class="line">        <span class="keyword">if</span> mySwitch.on &#123;</span><br><span class="line">            <span class="type">NSTimer</span>.scheduledTimerWithTimeInterval(<span class="number">2</span>,</span><br><span class="line">                target: <span class="keyword">self</span>,</span><br><span class="line">                selector: <span class="string">"showTip"</span>,</span><br><span class="line">                userInfo: <span class="literal">nil</span>,</span><br><span class="line">                repeats: <span class="literal">false</span>)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 弹出提示窗</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">showTip</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> alert:<span class="type">UIAlertController</span> = <span class="type">UIAlertController</span>(title: <span class="string">"提示"</span>,</span><br><span class="line">            message: <span class="string">"今天要下雨，出门要带雨具哦！"</span>,</span><br><span class="line">            preferredStyle: .<span class="type">Alert</span>)</span><br><span class="line">        <span class="keyword">let</span> ok:<span class="type">UIAlertAction</span> = <span class="type">UIAlertAction</span>(title: <span class="string">"OK"</span>, style: .<span class="type">Cancel</span>, handler: <span class="literal">nil</span>)</span><br><span class="line">        alert.addAction(ok)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-6-iOS文件存取"><a href="#1-6-iOS文件存取" class="headerlink" title="1.6    iOS文件存取"></a>1.6    iOS文件存取</h2><blockquote>
<p><strong>官方文档：</strong><a href="https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1" target="_blank" rel="external">https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40010672-CH1-SW1</a></p>
</blockquote>
<h3 id="1-6-1-iOS应用沙盒"><a href="#1-6-1-iOS应用沙盒" class="headerlink" title="1.6.1    iOS应用沙盒"></a>1.6.1    iOS应用沙盒</h3><blockquote>
<p><strong>笔记参考：</strong><a href="http://blog.csdn.net/wzzvictory/article/details/18269713" target="_blank" rel="external">http://blog.csdn.net/wzzvictory/article/details/18269713</a><br><strong>沙盒机制：</strong>出于安全考虑，iOS系统的沙盒机制规定每个应用都只能访问当前沙盒目录下面的文件（也有例外，比如系统通讯录能在用户授权的情况下被第三方应用访问）。</p>
</blockquote>
<h4 id="1-6-1-1-app目录"><a href="#1-6-1-1-app目录" class="headerlink" title="1.6.1.1    app目录"></a>1.6.1.1    app目录</h4><blockquote>
<p><strong>说明：</strong>每个应用的沙盒目录都是相似的，主要包如下所示的4个目录</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── MyApp.app<span class="comment"># 应用程序本身</span></span><br><span class="line">├── Documents<span class="comment"># 应用程序的数据文件</span></span><br><span class="line">│   └── Inbox<span class="comment">#由外部应用请求当前应用程序打开的文件</span></span><br><span class="line">├── Library<span class="comment"># 默认设置或其它状态信息</span></span><br><span class="line">│   ├── Caches<span class="comment">#缓存文件</span></span><br><span class="line">│   └── Preferences<span class="comment">#应用程序的偏好设置文件</span></span><br><span class="line">└── tmp<span class="comment"># 临时文件</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>目录</th>
<th>内容</th>
<th>读写</th>
<th>是否会被iTunes同步</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MyApp.app</code></td>
<td>应用程序本身的数据，包括<code>资源文件</code>和<code>可执行文件</code>等</td>
<td>只读</td>
<td>否</td>
</tr>
<tr>
<td><code>Documents</code></td>
<td>读写</td>
<td>是</td>
<td>应用程序的数据文件保存在该目录下</td>
<td>数据类型仅限于<code>不可再生</code>的数据，<code>可再生</code>的数据文件应该存放在<code>Library/Cache</code>目录下。</td>
</tr>
<tr>
<td><code>Documents/Inbox</code></td>
<td>用来保存由外部应用请求当前应用程序打开的文件</td>
<td>读写</td>
<td>是</td>
<td>比如我们的应用叫<code>A</code>，向系统注册了几种可打开的文件格式，<code>B</code>应用有一个<code>A</code>支持的格式的文件<code>F</code>，并且申请调用<code>A</code>打开<code>F</code>。由于<code>F</code>当前是在<code>B</code>应用的沙盒中，我们知道，沙盒机制是不允许<code>A</code>访问<code>B</code>沙盒中的文件，因此苹果的解决方案是将<code>F</code>拷贝一份到<code>A</code>应用的<code>Documents/Inbox</code>目录下，再让<code>A</code>打开<code>F</code>。</td>
</tr>
<tr>
<td><code>Library</code></td>
<td>苹果建议用来存放默认设置或其它状态信息</td>
<td>读写</td>
<td>是，但是要除了<code>Caches</code>子目录外</td>
<td></td>
</tr>
<tr>
<td><code>Library/Caches</code></td>
<td>主要是缓存文件，用户使用过程中缓存都可以保存在这个目录中</td>
<td>读写</td>
<td>否</td>
<td>Documents目录用于保存不可再生的文件，那么这个目录就用于保存那些可再生的文件，比如网络请求的数据。鉴于此，应用程序通常还需要负责删除这些文件。</td>
</tr>
<tr>
<td><code>Library/Preferences</code></td>
<td>应用程序的偏好设置文件</td>
<td>读写</td>
<td>是</td>
<td>我们使用<code>NSUserDefaults</code>写的设置数据都会保存到该目录下的一个<code>plist</code>文件中，这就是所谓的写到<code>plist</code>中!</td>
</tr>
<tr>
<td><code>tmp</code></td>
<td>各种临时文件，保存应用再次启动时不需要的文件</td>
<td>读写</td>
<td>否</td>
<td>当应用不再需要这些文件时应该主动将其删除，因为该目录下的东西随时有可能被系统清理掉，目前已知的一种可能清理的原因是系统磁盘存储空间不足的时候。</td>
</tr>
</tbody>
</table>
<h4 id="1-6-1-2-获取目录-API"><a href="#1-6-1-2-获取目录-API" class="headerlink" title="1.6.1.2    获取目录 API"></a>1.6.1.2    获取目录 API</h4><h5 id="NSSearchPathForDirectoriesInDomains方法"><a href="#NSSearchPathForDirectoriesInDomains方法" class="headerlink" title="NSSearchPathForDirectoriesInDomains方法"></a>NSSearchPathForDirectoriesInDomains方法</h5><blockquote>
<p><strong>说明：</strong>用于返回指定范围内的指定名称的目录的路径集合<br><strong>注意：</strong>使用<code>沙盒/Documents</code>目录要用该方法获取路径</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* </span><br><span class="line">* @param &#123;enum&#125; directory 表明我们要搜索的目录名称</span><br><span class="line">* @param &#123;enum&#125; domainMask 指定搜索范围。</span><br><span class="line">* @param &#123;Bool&#125; expandTilde 表示是否展开波浪线~</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">NSSearchPathForDirectoriesInDomains</span><span class="params">(directory: NSSearchPathDirectory, <span class="number">_</span> domainMask: NSSearchPathDomainMask, <span class="number">_</span> expandTilde: Bool)</span></span> -&gt; [<span class="type">String</span>]</span><br></pre></td></tr></table></figure>
<h3 id="1-6-2-写入文件"><a href="#1-6-2-写入文件" class="headerlink" title="1.6.2    写入文件"></a>1.6.2    写入文件</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*- 获取目录路径 -*/</span></span><br><span class="line"><span class="keyword">let</span> homePath = <span class="type">NSHomeDirectory</span>()<span class="comment">// 沙盒(home)</span></span><br><span class="line"><span class="keyword">let</span> appPath = <span class="type">NSBundle</span>.mainBundle().bundlePath<span class="comment">// MyApp.app</span></span><br><span class="line"><span class="keyword">let</span> tmpPath = <span class="type">NSTemporaryDirectory</span>()<span class="comment">// tmp</span></span><br><span class="line"><span class="keyword">let</span> documentPaths = <span class="type">NSSearchPathForDirectoriesInDomains</span>(.<span class="type">DocumentationDirectory</span>, .<span class="type">AllDomainsMask</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">var</span> documentPath:<span class="type">String</span> = <span class="string">""</span>;<span class="comment">// Documents</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> documentPaths.<span class="built_in">count</span> &gt; <span class="number">0</span> &#123;</span><br><span class="line">    documentPath = documentPaths[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"home:\(homePath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"app:\(appPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"tmp:\(tmpPath)"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Documents\(documentPath)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 在 Documents 下创建文件 -*/</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">NSURL</span>(fileURLWithPath: <span class="string">"\(documentPath)/test.txt"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 向文件中写入文本 -*/</span></span><br><span class="line"><span class="keyword">let</span> textData = <span class="type">NSMutableData</span>()</span><br><span class="line">textData.appendData(<span class="string">"Hello Swift\n"</span>.dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>, allowLossyConversion: <span class="literal">true</span>)!)</span><br><span class="line">textData.writeToFile(url.path!, atomically: <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-3-读取文件"><a href="#1-6-3-读取文件" class="headerlink" title="1.6.3    读取文件"></a>1.6.3    读取文件</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*- 从文件中读取文本 -*/</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">let</span> readedText = <span class="keyword">try</span> <span class="type">NSString</span>(contentsOfURL: url, encoding: <span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">    <span class="built_in">print</span>(readedText)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"read failed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" itemprop="url">
                  4 中级ios开发工程师面试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T09:01:39+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_4  中级iOS开发工程师面试题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#4    中级iOS开发工程师面试题</p>
<h2 id="4-1-MVC的理解"><a href="#4-1-MVC的理解" class="headerlink" title="4.1 MVC的理解"></a>4.1 MVC的理解</h2><blockquote>
<p><code>MVC</code>设计模式考虑三种对象：数据模型对象、视图对象、控制器对象。</p>
<ul>
<li>数据模型（<code>M</code>）：负责存储、定义、操作数据</li>
<li>视图（<code>V</code>）：用来战术数据给用户，和用户进行操作交互</li>
<li>控制器（<code>C</code>）：<code>M</code>与<code>V</code>的协调者，控制获取数据，将数据交给视图取展示</li>
</ul>
</blockquote>
<h2 id="4-2-线程和进程"><a href="#4-2-线程和进程" class="headerlink" title="4.2    线程和进程"></a>4.2    线程和进程</h2><blockquote>
<p><strong>进程：</strong>进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，是系统畸形资源分配和调度的一个独立单元。<br><strong>线程：</strong>线程是进程的的一个实体，是cpu调度和分派的基本单位，是比进程更小的能独立运行的基本单位，线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器、一组寄存器和栈），一个线程可以创建和撤销另一个线程。</p>
</blockquote>
<h3 id="4-2-1-线程和进程的关系"><a href="#4-2-1-线程和进程的关系" class="headerlink" title="4.2.1    线程和进程的关系"></a>4.2.1    线程和进程的关系</h3><blockquote>
<ol>
<li>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程。</li>
<li>资源跟配给进程，同一进程的所有线程共享该进程的所有资源。</li>
<li>线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。</li>
<li>真正在处理机上运行的是线程。</li>
<li>线程是指进程內的一个可执行单元，也是进程內的可调度实体。</li>
</ol>
</blockquote>
<h3 id="4-2-2-线程和进程的区别"><a href="#4-2-2-线程和进程的区别" class="headerlink" title="4.2.2    线程和进程的区别"></a>4.2.2    线程和进程的区别</h3><table>
<thead>
<tr>
<th>区别</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>调度</td>
<td>线程作为调度和分配的基本单元，进程作为拥有过资源的基本单位</td>
</tr>
<tr>
<td>并发性</td>
<td>不仅进程之间可以并发执行，同一个进程的多个线程之间也可以并发执行</td>
</tr>
<tr>
<td>拥有资源</td>
<td>进程是拥有资源的一个独立单位，线程不拥有系统资源，但可以访问隶属于进程的资源</td>
</tr>
<tr>
<td>系统开销</td>
<td>创建或者撤销进程的开销比较大</td>
</tr>
</tbody>
</table>
<h3 id="4-2-3-进程的同步机制"><a href="#4-2-3-进程的同步机制" class="headerlink" title="4.2.3    进程的同步机制"></a>4.2.3    进程的同步机制</h3><blockquote>
<p>原子操作：、信号量机制、自旋锁、分布式系统等</p>
</blockquote>
<h3 id="4-2-4-进程死锁"><a href="#4-2-4-进程死锁" class="headerlink" title="4.2.4    进程死锁"></a>4.2.4    进程死锁</h3><blockquote>
<p><strong>原因：</strong>资源竞争以及进程推进顺序非法<br><strong>必要条件：</strong>4个</p>
<ol>
<li>互斥</li>
<li>请求保持</li>
<li>不可剥夺</li>
<li>环路</li>
</ol>
<p><strong>处理：</strong></p>
<ul>
<li>鸵鸟策略</li>
<li>预防策略</li>
<li>监测与接触死锁</li>
</ul>
</blockquote>
<h2 id="4-3-KVC和KVO"><a href="#4-3-KVC和KVO" class="headerlink" title="4.3    KVC和KVO"></a>4.3    KVC和KVO</h2><blockquote>
<ol>
<li><code>KVC</code>（键值编码）：是一种间接访问对象实例变量的机制，该机制可以不通过存取方法就可以访问对象的实例变量。</li>
<li><code>KVO</code> （键值观察）：是一种能使得对象获取到其他对象属性变化的通知机制。</li>
<li>实现<code>KVO简直观察模式</code>，被观察的对象必须使用<code>kvc</code>键值编码来修改它的实例变量，这样才能被观察者观察到。因此，<code>KVC</code>是<code>KVO</code>的基础或者说<code>KVO</code>的实现是建立在<code>KVC</code>的基础之上。</li>
</ol>
</blockquote>
<h2 id="4-4-深复制、浅复制"><a href="#4-4-深复制、浅复制" class="headerlink" title="4.4    深复制、浅复制"></a>4.4    深复制、浅复制</h2><blockquote>
<p><strong>深复制：</strong>不仅复制对象本身，对象持有的属性对象也做复制。<br><strong>浅复制：</strong>只复制对象本身，不对里面的属性复制。</p>
</blockquote>
<h2 id="4-5-定义属性时，什么时候用assign、retain、copy、nonatomic"><a href="#4-5-定义属性时，什么时候用assign、retain、copy、nonatomic" class="headerlink" title="4.5    定义属性时，什么时候用assign、retain、copy、nonatomic?"></a>4.5    定义属性时，什么时候用<code>assign</code>、<code>retain</code>、<code>copy</code>、<code>nonatomic</code>?</h2><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>assign</code></td>
<td>普通赋值</td>
<td>一般用于基本数据类型，常见委托设计模式，以此来防止循环引用</td>
</tr>
<tr>
<td><code>retain</code></td>
<td>保留计数</td>
<td>获得了对象的所有权，引用计数+1</td>
</tr>
<tr>
<td><code>copy</code></td>
<td><code>set</code>是使用副本</td>
<td>一般字符串使用<code>copy</code>，<code>Foundation</code>中的不可变对象使用<code>copy</code>效果相当于<code>retain</code>，只是引用计数+1</td>
</tr>
<tr>
<td><code>nonatomic</code></td>
<td>非原子性访问，不加同步</td>
<td>多线程并发访问会提高性能</td>
</tr>
</tbody>
</table>
<h2 id="4-6-内存管理"><a href="#4-6-内存管理" class="headerlink" title="4.6    内存管理"></a>4.6    内存管理</h2><h3 id="4-6-1-strong与weak，-unsafe-unretained与weak的区别"><a href="#4-6-1-strong与weak，-unsafe-unretained与weak的区别" class="headerlink" title="4.6.1    strong与weak，_unsafe_unretained与weak的区别"></a>4.6.1    strong与weak，_unsafe_unretained与weak的区别</h3><table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>strong</code></td>
<td>强引用</td>
<td>在<code>ARC</code>中，使用<code>strong</code>告诉编译器自动插入<code>retain</code></td>
</tr>
<tr>
<td><code>weak</code></td>
<td>弱引用</td>
<td>在<code>ARC</code>中，<code>weak</code>相当于手动管理内存的<code>assign</code></td>
</tr>
<tr>
<td><code>_unsafe_unretained</code></td>
<td>安全版<code>weak</code></td>
<td>与<code>weak</code>功能一致,区别在于当指向的对象销毁后，<code>weak</code>会将变量置为<code>nil</code>，防止调用野指针</td>
</tr>
</tbody>
</table>
<h3 id="4-6-2-ARC存在内存泄漏吗？"><a href="#4-6-2-ARC存在内存泄漏吗？" class="headerlink" title="4.6.2    ARC存在内存泄漏吗？"></a>4.6.2    <code>ARC</code>存在内存泄漏吗？</h3><blockquote>
<p>循环引用导致内存泄漏，<code>Objective-C</code>对象与<code>CoreFoundation</code>类之间桥接时，管理不当也会产生内存泄漏。</p>
</blockquote>
<h2 id="4-7-事件响应者链"><a href="#4-7-事件响应者链" class="headerlink" title="4.7    事件响应者链"></a>4.7    事件响应者链</h2><blockquote>
<p>响应者链表示一系列的响应者对象。事件被交由第一响应者对象，如果第一响应者不处理，事件被沿着响应者链向上传递，交给下一个响应者。</p>
</blockquote>
<p>View -&gt; ViewController -&gt; Window -&gt; application -&gt; 丢弃事件</p>
<h2 id="4-8-其它"><a href="#4-8-其它" class="headerlink" title="4.8    其它"></a>4.8    其它</h2><ul>
<li><code>SVN</code>、<code>git</code>使用</li>
<li>打包静态库</li>
<li><code>APP</code>发布的上架流程</li>
<li><code>Storyboard</code>的使用</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="url">
                  3 动画图层部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:59:02+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_3  动画图层部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_3  动画图层部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="3-1-设计复杂的iOS动画效果"><a href="#3-1-设计复杂的iOS动画效果" class="headerlink" title="3.1    设计复杂的iOS动画效果"></a>3.1    设计复杂的iOS动画效果</h2><h3 id="3-1-1-制定统一的动画接口"><a href="#3-1-1-制定统一的动画接口" class="headerlink" title="3.1.1    制定统一的动画接口"></a>3.1.1    制定统一的动画接口</h3><blockquote>
<p><strong>说明：</strong>制定统一的动画接口有如下优点</p>
<ul>
<li>便于实现后续复杂的动画组合</li>
<li>对于后续的代码维护极为方便</li>
<li>需要优先考虑里氏代换原则</li>
</ul>
</blockquote>
<h3 id="3-1-2-动画中的高内聚低耦合原理"><a href="#3-1-2-动画中的高内聚低耦合原理" class="headerlink" title="3.1.2    动画中的高内聚低耦合原理"></a>3.1.2    动画中的高内聚低耦合原理</h3><blockquote>
<p><strong>说明：</strong>将视图的动画效果的实现和视图本身封装到另一个<code>UIView</code>中。<br><strong>技巧：</strong></p>
<ul>
<li>不要把实现动画的细节暴露在外</li>
<li>设计动画类尽力那个要符合<code>单一职能原则</code>，以便后续方便组合成复杂的动画效果</li>
</ul>
<p><strong>单一职能原则：</strong>如果一个类承担的只能过多，就等于把这些功能耦合在一起，一个职能的变化可能会削弱或者抑制其他职能的能力，这种耦合会导致脆弱的设计，当发生变化时，设计会遭到意想不到的破坏。如果想要避免这种现象发生，就要尽可能的遵守<code>单一职能原则</code>。</p>
</blockquote>
<p><em>LineView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">@(中级ios开发工程师)interface LineView : <span class="built_in">UIView</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span>  offsetX;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> rect;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.rect = frame;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.rect.origin.x + <span class="keyword">self</span>.offsetX + <span class="keyword">self</span>.offsetX,</span><br><span class="line">                                <span class="keyword">self</span>.rect.origin.y,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.width,</span><br><span class="line">                                <span class="keyword">self</span>.rect.size.height);</span><br><span class="line">    </span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = newRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>viewcntroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *line<span class="built_in">UIView</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    [<span class="keyword">self</span> testLineAnimate];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用封装在LineUIView中的动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)testLineAnimate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建封装着动画效果的视图实例</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置初始状态</span></span><br><span class="line">    <span class="keyword">self</span>.lineUIView.offsetX = <span class="number">50.</span>f;</span><br><span class="line">    <span class="keyword">self</span>.lineUIView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineUIView];</span><br><span class="line">    <span class="comment">// 展现带有动画的视图（展现带有动画）</span></span><br><span class="line">    [<span class="keyword">self</span>.lineUIView show];</span><br><span class="line">    <span class="comment">// 3秒中后隐藏视图（带消失有动画）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(excuteAfterDelay) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)excuteAfterDelay</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineUIView hide];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-设计动画函数的注意事项"><a href="#3-1-3-设计动画函数的注意事项" class="headerlink" title="3.1.3    设计动画函数的注意事项"></a>3.1.3    设计动画函数的注意事项</h3><ul>
<li>动画方法的命名统一：封装在不同的<code>view</code>的同类动画方法命名要一致</li>
<li>预留非动画情形的设计：避免<code>TableView</code>或者其它存在重用问题的场景下的性能问题</li>
<li>用百分比来表示动画的执行程度</li>
<li>懒加载的使用</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_anime.gif" alt="Alt text"></p>
<p><em>LineUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> offSetX;<span class="comment">// 对应动画进度的偏移量</span></span><br><span class="line"><span class="comment">// 显示动画</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏动画</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建view（懒加载方式）</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画百分比（动画进行程度）</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LineUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> startRect;<span class="comment">// 开始区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> midRect;<span class="comment">// 动画进行到中间时的区域</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> endRect;<span class="comment">// 结束区域</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LineUIView</span></span></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;<span class="comment">// 视图创建时是不可见的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.midRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">1.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  隐藏视图</span><br><span class="line"> *  预留了非动画情形</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 持续时长</span><br><span class="line"> *  @param animated 是否展现动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hideWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (animated == <span class="literal">YES</span>) &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:duration animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.endRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished)&#123;</span><br><span class="line">            <span class="comment">// 视图隐藏后将视图复原到初始位置</span></span><br><span class="line">            <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">            <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.frame = <span class="keyword">self</span>.startRect;</span><br><span class="line">        <span class="keyword">self</span>.alpha = <span class="number">0.</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建view（懒加载方式）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buildView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.startRect = <span class="keyword">self</span>.frame;</span><br><span class="line">    <span class="keyword">self</span>.midRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">    <span class="keyword">self</span>.endRect = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + <span class="keyword">self</span>.offSetX * <span class="number">2</span>,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                              <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  动画百分比（动画进行程度）</span><br><span class="line"> *</span><br><span class="line"> *  @param percent 动画进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)percent:(<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (percent &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        tmpOffsetX = <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        tmpOffsetX = percent * <span class="keyword">self</span>.offSetX;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.startRect.origin.x + tmpOffsetX,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.origin.y,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.width,</span><br><span class="line">                            <span class="keyword">self</span>.startRect.size.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 创建动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">3</span>)];</span><br><span class="line">    <span class="comment">// 设置动画视图</span></span><br><span class="line">    <span class="keyword">self</span>.lineView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.lineView.offSetX = <span class="keyword">self</span>.view.frame.size.width / <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.lineView buildView];<span class="comment">// 初始化视图成员</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将动画视图添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.lineView];</span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    [<span class="keyword">self</span> delayShow];</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    [<span class="keyword">self</span> delayHide];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayShow</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView showWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)delayHide</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.lineView hideWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-用里氏代换原则来处理动画类的继承问题"><a href="#3-1-4-用里氏代换原则来处理动画类的继承问题" class="headerlink" title="3.1.4    用里氏代换原则来处理动画类的继承问题"></a>3.1.4    用里氏代换原则来处理动画类的继承问题</h3><blockquote>
<p><strong>说明：</strong>其实就是利用对象的<code>多态性</code>，父类变量动态调用子类对象的方法。<br><strong>要点：</strong></p>
<ul>
<li>里氏代换原则的基本原理</li>
<li>设计中要确保父类可以直接调用子类的方法</li>
<li>将父类设计成虚类（需要时，父类也可以提供实现）</li>
</ul>
</blockquote>
<h4 id="3-1-4-1-父类"><a href="#3-1-4-1-父类" class="headerlink" title="3.1.4.1    父类"></a>3.1.4.1    父类</h4><p><em>SuperUIView.h</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface SuperUIView : UIView</span><br><span class="line"></span><br><span class="line">- (void)show;</span><br><span class="line">- (void)hide;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><em>SuperUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SuperUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperUIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)hide</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SuperUIView hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-2-子类"><a href="#3-1-4-2-子类" class="headerlink" title="3.1.4.2    子类"></a>3.1.4.2    子类</h4><blockquote>
<p><strong>说明：</strong>在子类中重写集成来的<code>show</code>的<code>hide</code>方法。</p>
</blockquote>
<p><em>SubUIView1.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView1</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView1 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>SubUIView2.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SubUIView2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubUIView2</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 show"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"SubUIView2 hide"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-3-演示"><a href="#3-1-4-3-演示" class="headerlink" title="3.1.4.3    演示"></a>3.1.4.3    演示</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 演示类的多态性</span></span><br><span class="line">Super<span class="built_in">UIView</span> *tmpView = [[Sub<span class="built_in">UIView1</span> alloc]init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br><span class="line"></span><br><span class="line">tmpView = [[Sub<span class="built_in">UIView2</span> alloc] init];</span><br><span class="line">[tmpView show];</span><br><span class="line">[tmpView hide];</span><br></pre></td></tr></table></figure>
<h3 id="3-1-5-动画中的模块化设计"><a href="#3-1-5-动画中的模块化设计" class="headerlink" title="3.1.5    动画中的模块化设计"></a>3.1.5    动画中的模块化设计</h3><blockquote>
<p><strong>说明：</strong>模块化设计在开发中非常重要，拆分成小颗粒的模块非常便于代码的维护<br><strong>要点：</strong></p>
<ul>
<li>动画效果实现难度的判断</li>
<li>将看到的动画效果查分成小模块</li>
<li>将写好的小模块组合成你所需要的动画效果</li>
</ul>
</blockquote>
<h4 id="3-1-5-1-子模块"><a href="#3-1-5-1-子模块" class="headerlink" title="3.1.5.1    子模块"></a>3.1.5.1    子模块</h4><p><em>LineUIView.h、CircleUIView.h、RectUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>LineUIView.m、CircleUIView.m、RectUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="3-1-5-2-组合使用"><a href="#3-1-5-2-组合使用" class="headerlink" title="3.1.5.2    组合使用"></a>3.1.5.2    组合使用</h4><p><em>BaseAnimationView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line">- (<span class="keyword">void</span>)buildView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BaseAnimationView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BaseAnimationView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"LineUIView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RectUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseAnimationView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Circle<span class="built_in">UIView</span> *circleView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Line<span class="built_in">UIView</span> *lineView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BaseAnimationView</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView show];</span><br><span class="line">    [<span class="keyword">self</span>.lineView show];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;</span><br><span class="line">    [<span class="keyword">self</span>.circleView hide];</span><br><span class="line">    [<span class="keyword">self</span>.lineView hide];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)buildView &#123;</span><br><span class="line">    <span class="keyword">self</span>.circleView = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.circleView];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.lineView = [[Line<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span>];</span><br><span class="line">    [<span class="keyword">self</span> addSubview: <span class="keyword">self</span>.lineView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-iOS模糊效果的使用"><a href="#3-2-iOS模糊效果的使用" class="headerlink" title="3.2    iOS模糊效果的使用"></a>3.2    iOS模糊效果的使用</h2><blockquote>
<p><strong>背景：</strong>在项目开发中，使用模糊效果或许是很多开发者并不愿意接触的东西，因为大部分都是从开源代码里获取到的代码片段，并不一定理解别人的设计思路，此时要最大程度的修改来符合自己的项目需求并不容易。本课程我将会带领大家来定制出自己需要的模糊效果，理解设计的原理，并根据不同的需求设计出符合我们期望的效果。<br><strong>要点：</strong></p>
<ol>
<li>CoreImage 中的模糊滤镜</li>
<li>UIImage+ImageEffects 的 category 模糊效果</li>
<li>iOS8 中 UIVisualEffectView 模糊效果的使用</li>
<li>设计下载图片后自动模糊的控件</li>
</ol>
</blockquote>
<h3 id="3-2-1-CoreImage中的模糊滤镜"><a href="#3-2-1-CoreImage中的模糊滤镜" class="headerlink" title="3.2.1    CoreImage中的模糊滤镜"></a>3.2.1    CoreImage中的模糊滤镜</h3><blockquote>
<p><strong>要点：</strong></p>
<ul>
<li><code>CoreImage</code>是苹果用来简化图片处理的框架</li>
<li><code>CIImage</code>、<code>CIFilter</code>与<code>CIContext</code>三者之间的联系</li>
<li><code>CIGaussianBlur</code>中可以设置的参数<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%881.08.34.png" alt="Alt text|200x400"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1. 原始图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"sourceImage"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. coreImage部分</span></span><br><span class="line"><span class="comment">/*------- coreImage 部分 ------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CIImage - 将 UIImage 包装为 CIImage 才可以用于滤镜</span></span><br><span class="line"><span class="built_in">CIImage</span> *ciImage = [[<span class="built_in">CIImage</span> alloc]initWithImage:image];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIFilter － 滤镜</span></span><br><span class="line"><span class="built_in">CIFilter</span> *blurFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看滤镜可以设置的参数以及一些相关的信息</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [blurFilter attributes]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将图片输入到滤镜中</span></span><br><span class="line">[blurFilter setValue:ciImage forKey:k<span class="built_in">CIInputImageKey</span>];<span class="comment">//  KVC方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模糊程度(0-100)</span></span><br><span class="line">[blurFilter setValue:@(<span class="number">3</span>) forKey:<span class="string">@"inputRadius"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将处理好的图片输出为 CIImage</span></span><br><span class="line"><span class="built_in">CIImage</span> *outCiImage = [blurFilter valueForKey:k<span class="built_in">CIOutputImageKey</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// CIContext</span></span><br><span class="line"><span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRef</span> <span class="keyword">out</span><span class="built_in">CGImage</span> = [context create<span class="built_in">CGImage</span>:outCiImage fromRect:[outCiImage extent]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最终获取的图片</span></span><br><span class="line"><span class="built_in">UIImage</span> *blurImage = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:<span class="keyword">out</span><span class="built_in">CGImage</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放 CGImage 句柄</span></span><br><span class="line"><span class="built_in">CGImageRelease</span>(<span class="keyword">out</span><span class="built_in">CGImage</span>);</span><br><span class="line"><span class="comment">/*-----------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 初始化UIImageView</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">590</span> / <span class="number">2.</span>f, <span class="number">988</span> / <span class="number">2.</span>f)];</span><br><span class="line">imageView.image = blurImage;</span><br><span class="line">imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-UIImage-ImageEffects的category模糊效果"><a href="#3-2-2-UIImage-ImageEffects的category模糊效果" class="headerlink" title="3.2.2    UIImage + ImageEffects的category模糊效果"></a>3.2.2    UIImage + ImageEffects的category模糊效果</h3><blockquote>
<p><strong>说明：</strong>苹果官方提供了一段无论是性能还是效果都更优的实现图片模糊效果的代码。在此基础上封装的库在以下地址可以拿到<br><a href="https://github.com/YouXianMing/UIImageBlur" target="_blank" rel="external">https://github.com/YouXianMing/UIImageBlur</a></p>
<ul>
<li>性能更好</li>
<li>可以局部模糊</li>
<li>更加易用<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-04%20%E4%B8%8B%E5%8D%8810.02.55.png" alt="Alt text|200x350"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 原始图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *sourceImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对图片进行模糊</span></span><br><span class="line">    <span class="built_in">UIImage</span> *blurImage = [sourceImage blurImageAtFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, sourceImage.size.width, sourceImage.size.height / <span class="number">2.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:blurImage];</span><br><span class="line">    imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="keyword">self</span>.view.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-3-iOS8种UIVisualEffectView模糊效果的使用"><a href="#3-2-3-iOS8种UIVisualEffectView模糊效果的使用" class="headerlink" title="3.2.3    iOS8种UIVisualEffectView模糊效果的使用"></a>3.2.3    iOS8种UIVisualEffectView模糊效果的使用</h3><blockquote>
<p><strong>说明：</strong><code>UIVisyalEffectView</code>的模糊效果是即时渲染的，效率非常高<br><strong>注意：</strong>在<code>UIVisualEffectView</code>之上的文本显示需要特殊处理<br><strong>兼容性：</strong><code>iOS8+</code><br><strong>案例：</strong><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_effective.gif" alt="Alt text|100x100"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--- 1. 环境 ----*/</span></span><br><span class="line"><span class="comment">// 1.1 图片</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"normal"</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 展示视图（UIScrollView）：用以显示动态模糊</span></span><br><span class="line"><span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line"><span class="keyword">self</span>.scrollView.contentSize = imageView.image.size;<span class="comment">// 展现视图和图片大小一致</span></span><br><span class="line"><span class="keyword">self</span>.scrollView.bounces = <span class="literal">NO</span>;<span class="comment">// 无边缘反弹效果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.3 将图片添加到展示视图</span></span><br><span class="line">[<span class="keyword">self</span>.scrollView addSubview:imageView];</span><br><span class="line"><span class="comment">// 1.4 将展示视图添加到当前视图</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*--- 2. 添加模糊视图 ---*/</span></span><br><span class="line"><span class="comment">// 2.1 创建模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *effecView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>]];</span><br><span class="line"><span class="comment">// 2.2 设置尺寸（动态模糊区域）</span></span><br><span class="line">effecView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>);</span><br><span class="line"><span class="comment">// 2.3 添加到 view</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:effecView];</span><br><span class="line"><span class="comment">/*------ 3. 子模糊视图（文本） ------*/</span></span><br><span class="line"><span class="comment">// 3.1  添加显示文本</span></span><br><span class="line"><span class="built_in">UILabel</span> *label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:effecView.bounds];</span><br><span class="line">label.text = <span class="string">@"时代精神"</span>;</span><br><span class="line">label.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">50.</span>f];</span><br><span class="line">label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line"><span class="comment">// 3.2  创建子模糊 view</span></span><br><span class="line"><span class="built_in">UIVisualEffectView</span> *subEffectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:[<span class="built_in">UIVibrancyEffect</span> effectForBlurEffect:(<span class="built_in">UIBlurEffect</span> *)effecView.effect]];</span><br><span class="line"><span class="comment">// 3.3  尺寸</span></span><br><span class="line">subEffectView.frame = effecView.bounds;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.4  将子模糊view添加到effectView的contentView才能够生效</span></span><br><span class="line">[effecView.contentView addSubview:subEffectView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.5  添加文本（此时文本会个模糊视图融合得比较好）</span></span><br><span class="line">[subEffectView.contentView addSubview:label];</span><br></pre></td></tr></table></figure>
<h3 id="3-2-4-设计下载图片后自动模糊的控件"><a href="#3-2-4-设计下载图片后自动模糊的控件" class="headerlink" title="3.2.4    设计下载图片后自动模糊的控件"></a>3.2.4    设计下载图片后自动模糊的控件</h3><blockquote>
<p><strong>说明：</strong>将下载下来的图片自动模糊的控件。<br><strong>要点：</strong></p>
<ul>
<li>KVO监听下载完成后的事件</li>
<li>在子线程中进行渲染，主线程中进行图片的下载 （提升性能）</li>
</ul>
<p><strong>GDC：</strong><a href="https://github.com/YouXianMing/GCD-Program" target="_blank" rel="external">https://github.com/YouXianMing/GCD-Program</a></p>
</blockquote>
<h4 id="3-2-4-1-控件实现"><a href="#3-2-4-1-控件实现" class="headerlink" title="3.2.4.1    控件实现"></a>3.2.4.1    控件实现</h4><blockquote>
<p><strong>依赖:</strong><code>GDC</code>和<code>UIImage+ImageEffects</code></p>
</blockquote>
<p><em>BlurDownloadPicView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *pictureUrlString;<span class="comment">// 图片下载地址</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIViewContentMode</span> contentMode;<span class="comment">// 图片显示的方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始执行</span></span><br><span class="line">- (<span class="keyword">void</span>)startProgress;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>BlurDownloadPicView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"GCD.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UIImage+ImageEffects.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlurDownloadPicView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BlurDownloadPicView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化控件</span></span><br><span class="line">        <span class="keyword">self</span>.imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="keyword">self</span>.imageView.alpha = <span class="number">0.</span>f;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.imageView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startProgress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.pictureUrlString) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在子线程中执行下载图片的过程</span></span><br><span class="line">        [GCDQueue executeInGlobalQueue:^&#123;</span><br><span class="line">            <span class="comment">// 创建请求</span></span><br><span class="line">            <span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.pictureUrlString]];</span><br><span class="line">            <span class="comment">// 获取数据(因为是同步请求，会阻塞主线程)</span></span><br><span class="line">            <span class="built_in">NSData</span> *data = [<span class="built_in">NSURLConnection</span> sendSynchronousRequest:request</span><br><span class="line">                                                 returningResponse:<span class="literal">nil</span></span><br><span class="line">                                                             error:<span class="literal">nil</span>];</span><br><span class="line">            <span class="built_in">UIImage</span> *image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">UIImage</span> *blurImage = [image blurImage];</span><br><span class="line">            </span><br><span class="line">            [GCDQueue executeInMainQueue:^&#123;</span><br><span class="line">                <span class="comment">// 在主线程中加载图片</span></span><br><span class="line">                <span class="keyword">self</span>.imageView.image = blurImage;</span><br><span class="line">                <span class="comment">// 动画效果：淡出</span></span><br><span class="line">                [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">                    <span class="keyword">self</span>.imageView.alpha = <span class="number">1.</span>f;</span><br><span class="line">                &#125;];</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> contentMode = _contentMode;</span><br><span class="line">- (<span class="keyword">void</span>)setContentMode:(<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    _contentMode = contentMode;</span><br><span class="line">    <span class="keyword">self</span>.imageView.contentMode = contentMode;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIViewContentMode</span>)contentMode &#123;</span><br><span class="line">    <span class="keyword">return</span> _contentMode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-4-2-使用"><a href="#3-2-4-2-使用" class="headerlink" title="3.2.4.2    使用"></a>3.2.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"BlurDownloadPicView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *picUrlString = <span class="string">@"http://img.zcool.cn/community/0207a4570363fc6ac7257948ec0f00.jpg@800w_1l_2o"</span>;<span class="comment">// 下载地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建模糊视图</span></span><br><span class="line">    BlurDownloadPicView *blurDownloadView = [[BlurDownloadPicView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">400</span>)];</span><br><span class="line">    blurDownloadView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    blurDownloadView.pictureUrlString = picUrlString;</span><br><span class="line">    blurDownloadView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:blurDownloadView];</span><br><span class="line">    <span class="comment">// 下载图片 模糊图片 呈现</span></span><br><span class="line">    [blurDownloadView startProgress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-使用-maskView-设计动画"><a href="#3-3-使用-maskView-设计动画" class="headerlink" title="3.3    使用 maskView 设计动画"></a>3.3    使用 maskView 设计动画</h2><h3 id="3-3-1-maskView-maskLayer-的基本原理"><a href="#3-3-1-maskView-maskLayer-的基本原理" class="headerlink" title="3.3.1    maskView(maskLayer)的基本原理"></a>3.3.1    maskView(maskLayer)的基本原理</h3><blockquote>
<p><strong>说明：</strong>本课时主要讲解 <code>maskView(maskLayer)</code>的基本原理，并用示例演示。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-06%20%E4%B8%8B%E5%8D%883.14.40.png" alt="Alt text|100x200"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> width = <span class="number">120</span>;</span><br><span class="line"><span class="comment">// 情形1. 只有底图的情形</span></span><br><span class="line"><span class="keyword">self</span>.baseImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.baseImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形2. 只有mask（png图片）</span></span><br><span class="line"><span class="keyword">self</span>.maskImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + width + <span class="number">20</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.maskImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 情形3. 底图通过maskView组合mask</span></span><br><span class="line"><span class="comment">// 底图</span></span><br><span class="line"><span class="keyword">self</span>.addImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>, <span class="number">20</span> + (width + <span class="number">20</span>) * <span class="number">2</span>, width, width)];</span><br><span class="line"><span class="keyword">self</span>.addImageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// mask</span></span><br><span class="line"><span class="built_in">UIImageView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, width, width)];</span><br><span class="line">mask.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask"</span>];</span><br><span class="line"><span class="comment">// 在底图上设置maskView</span></span><br><span class="line"><span class="keyword">self</span>.addImageView.maskView = mask;</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.baseImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.maskImageView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.addImageView];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-maskView配合-CAGradientLayer的使用"><a href="#3-3-2-maskView配合-CAGradientLayer的使用" class="headerlink" title="3.3.2    maskView配合 CAGradientLayer的使用"></a>3.3.2    maskView配合 CAGradientLayer的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解如何在 maskView 中加载 <code>CAGradientLayer</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_ga.gif" alt="Alt text|100x100"></p>
<p><strong>要点：</strong></p>
<ul>
<li>用<code>CAGradientLayer</code>直接产生带透明像素通道的<code>layer</code></li>
<li>用<code>maskView</code>直接加载带<code>CAGradientLayer</code>的<code>View</code></li>
<li>可以通过<code>CAGradientLayer</code>进行动画的操作实现动画效果</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 底图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="keyword">self</span>.view.bounds.size.width, <span class="number">200</span>)];</span><br><span class="line">imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. mask (使用 CAGradientLayer 替代 png 图片)</span></span><br><span class="line"><span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">gradientLayer.frame = imageView.bounds;</span><br><span class="line">gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                         (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIView</span> *containerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:imageView.bounds];</span><br><span class="line">[containerView.layer addSublayer:gradientLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. set maskView</span></span><br><span class="line">imageView.maskView = containerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 maskView 做动画效果</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 新位置</span></span><br><span class="line">    <span class="built_in">CGRect</span> frame = containerView.frame;</span><br><span class="line">    frame.origin.x += <span class="number">400</span>;</span><br><span class="line">    containerView.frame = frame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-maskView-配合带-alpha-通道图片的使用"><a href="#3-3-3-maskView-配合带-alpha-通道图片的使用" class="headerlink" title="3.3.3    maskView 配合带 alpha 通道图片的使用"></a>3.3.3    maskView 配合带 alpha 通道图片的使用</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>maskView</code> 加载 <code>png</code> 图片的原理。</p>
<ul>
<li>直接使用带<code>alpha</code>通道的<code>png</code>图片比用<code>CAGradientLayer</code>的方式更加高效</li>
<li>可以使用技巧在<code>maskView</code>上添加多张图片</li>
<li>在<code>maskView</code>中做简单的动画</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text|100x100"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遮罩图片1</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picOne = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line">picOne.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮罩图片2</span></span><br><span class="line"><span class="built_in">UIImageView</span> *picTwo = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">-200</span>, <span class="number">100</span>, <span class="number">400</span>)];</span><br><span class="line"></span><br><span class="line">picTwo.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"2"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原始背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *backgroundView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">backgroundView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"background"</span>];</span><br><span class="line">backgroundView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待切换目标背景图</span></span><br><span class="line"><span class="built_in">UIImageView</span> *baseView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:backgroundView.frame];</span><br><span class="line">baseView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"base"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为带切换图 set maskView</span></span><br><span class="line"><span class="built_in">UIView</span> *mask = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:baseView.bounds];</span><br><span class="line"><span class="comment">// 两个png图片合成新遮罩</span></span><br><span class="line">[mask addSubview:picOne];</span><br><span class="line">[mask addSubview:picTwo];</span><br><span class="line">baseView.maskView = mask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:backgroundView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:baseView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动画</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.</span>f animations:^&#123;</span><br><span class="line">    <span class="comment">// 偏移左半边的遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> oneFrame = picOne.frame;</span><br><span class="line">    oneFrame.origin.y -= <span class="number">400</span>;</span><br><span class="line">    picOne.frame = oneFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 偏移右半边遮罩</span></span><br><span class="line">    <span class="built_in">CGRect</span> twoFrame = picTwo.frame;</span><br><span class="line">    twoFrame.origin.y += <span class="number">400</span>;</span><br><span class="line">    picTwo.frame = twoFrame;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-设计文本横向渐变消失的控件"><a href="#3-3-4-设计文本横向渐变消失的控件" class="headerlink" title="3.3.4    设计文本横向渐变消失的控件"></a>3.3.4    设计文本横向渐变消失的控件</h3><blockquote>
<p><strong>说明：</strong>本课时将综合前面所学内容设计一个效果不错的文本渐变消失的控件，并做简易的扩展设计。</p>
<ul>
<li>接口的设计</li>
<li>封装<code>CAGradientLayer</code>用以提供<code>mask</code>遮罩</li>
<li>动画样式的分析与设计</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_text.gif" alt="Alt text"></p>
<h4 id="3-3-4-1-文本横向渐变消失的控件"><a href="#3-3-4-1-文本横向渐变消失的控件" class="headerlink" title="3.3.4.1    文本横向渐变消失的控件"></a>3.3.4.1    文本横向渐变消失的控件</h4><p><em>FadeStrinUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示的文本</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  从左到右渐变消失</span><br><span class="line"> *</span><br><span class="line"> *  @param duration 动画持续时间</span><br><span class="line"> *  @param animated 是否显示动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeStringUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeStringUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *label;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *mask;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeStringUIView</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 创建文本</span></span><br><span class="line">        [<span class="keyword">self</span> createLabel:<span class="keyword">self</span>.bounds];</span><br><span class="line">        <span class="comment">// 创建mask</span></span><br><span class="line">        [<span class="keyword">self</span> createMask:<span class="keyword">self</span>.bounds];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fadeRightWithDuration:(<span class="built_in">CGFloat</span>)duration animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.mask.frame;</span><br><span class="line">    frame.origin.x += frame.size.width;</span><br><span class="line">    <span class="keyword">if</span> (animated) &#123;</span><br><span class="line"></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">3.</span>f animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.mask.frame = frame;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createLabel:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span>.label = [[<span class="built_in">UILabel</span> alloc] initWithFrame:frame];</span><br><span class="line">    <span class="keyword">self</span>.label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20.</span>f];</span><br><span class="line">    <span class="keyword">self</span>.label.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    <span class="keyword">self</span>.label.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.label];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)createMask:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="comment">// 创建出渐变的layer</span></span><br><span class="line">    <span class="built_in">CAGradientLayer</span> *gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    gradientLayer.frame = frame;</span><br><span class="line">    gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blackColor].CGColor,</span><br><span class="line">                             (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor];</span><br><span class="line">    gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.1</span>), @(<span class="number">0.9</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">    gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.mask = [[<span class="built_in">UIView</span> alloc] initWithFrame:frame];</span><br><span class="line">    [<span class="keyword">self</span>.mask.layer addSublayer:gradientLayer];</span><br><span class="line">    <span class="keyword">self</span>.maskView = <span class="keyword">self</span>.mask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 重写 text 的set和get， 该值被修改时同时更新到 label</span></span><br><span class="line"><span class="keyword">@synthesize</span> text = _text;</span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    _text = text;</span><br><span class="line">    <span class="keyword">self</span>.label.text = text;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">return</span> _text;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-2-使用该控件"><a href="#3-3-4-2-使用该控件" class="headerlink" title="3.3.4.2    使用该控件"></a>3.3.4.2    使用该控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeStringUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    <span class="comment">// 创建 FadeStringUIView 实例</span></span><br><span class="line">    FadeString<span class="built_in">UIView</span> *fadeString = [[FadeString<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">100</span>)];</span><br><span class="line">    fadeString.text = <span class="string">@"如果一个人不按照他想的方式活，那么很快就会按照他活的方式想。"</span>;</span><br><span class="line">    fadeString.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:fadeString];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行动画效果</span></span><br><span class="line">    [fadeString fadeRightWithDuration:<span class="number">3.</span>f animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-4-使用-Facebook-开源动画库-POP-实现"><a href="#3-4-使用-Facebook-开源动画库-POP-实现" class="headerlink" title="3.4    使用 Facebook 开源动画库 POP 实现"></a>3.4    使用 Facebook 开源动画库 POP 实现</h2><blockquote>
<p><strong>课程说明：</strong><code>POP</code> 动画库是 <code>Facebook</code> 在 2014 年开源出来的一个高效的动画引擎，它与 <code>CoreAnimation</code> 的实现机制有着巨大区别，但使用方式极为相似，其动画效果逼真而优美，虽无法完全替换 <code>CoreAnimation</code>，但掌握它，将会使你的应用的交互效果惊艳而脱颖而出。<br><strong>Github地址：</strong><a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a></p>
</blockquote>
<h3 id="3-4-1-POP动画引擎简介"><a href="#3-4-1-POP动画引擎简介" class="headerlink" title="3.4.1    POP动画引擎简介"></a>3.4.1    <code>POP</code>动画引擎简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时示例演示 <code>POP</code> 动画的强大之处，讲解 <code>CADisplayLink</code> 的作用，以及 <code>POP</code> 动画引擎与 <code>CoreAnimation</code> 之间的联系。</p>
<ol>
<li>pop动画引擎是Facebook公司开源的</li>
<li>pop动画引擎主要实现了真实物理系的动画效果（弹簧效果与衰减效果）</li>
<li>pop动画引擎的动画效果非常流畅，因为它是用了<code>CADisplayLink</code>来刷新画面（帧）</li>
<li>pop动画引擎自成体系，与系统的<code>CoreAnimation</code>有很大的区别，但使用非常类似</li>
</ol>
</blockquote>
<h4 id="3-4-1-1-POP效果展示"><a href="#3-4-1-1-POP效果展示" class="headerlink" title="3.4.1.1    POP效果展示"></a>3.4.1.1    POP效果展示</h4><h4 id="3-4-1-2-CADisplayLink"><a href="#3-4-1-2-CADisplayLink" class="headerlink" title="3.4.1.2    CADisplayLink"></a>3.4.1.2    CADisplayLink</h4><blockquote>
<p><strong>说明：</strong><code>POP</code>通过<code>CADisplayLink</code>刷新动画的（60帧/秒，同iOS系统本身的刷新频率）。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>演示<code>CADisplayLink</code>使用方式，在中端1秒输出60次。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CADisplayLink</span> *displayLink;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> count;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 displayLink</span></span><br><span class="line">    <span class="keyword">self</span>.displayLink = [<span class="built_in">CADisplayLink</span> displayLinkWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(displayLinkEvent:)];</span><br><span class="line">    <span class="comment">// 1秒钟后开始刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventOne) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 2秒中后停止刷新</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(eventTwo) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  每次刷新调用该方法</span><br><span class="line"> *</span><br><span class="line"> *  @param object 对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)displayLinkEvent:(<span class="keyword">id</span>)object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.count ++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"count = %ld"</span>, (<span class="keyword">long</span>)<span class="keyword">self</span>.count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  开始刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventOne</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink addToRunLoop:[<span class="built_in">NSRunLoop</span> currentRunLoop] forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  停止刷新</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)eventTwo</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.displayLink invalidate];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-POP动画引擎中Layer与CALayer的联系与区别"><a href="#3-4-2-POP动画引擎中Layer与CALayer的联系与区别" class="headerlink" title="3.4.2    POP动画引擎中Layer与CALayer的联系与区别"></a>3.4.2    <code>POP</code>动画引擎中<code>Layer</code>与<code>CALayer</code>的联系与区别</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>POP</code> 动画中的 Layer 与 <code>CALayer</code> 的一些共性与区别。<br><strong>比较：</strong></p>
<ol>
<li>使用<code>POP</code>动画与使用<code>CALayer</code>动画非常相似</li>
<li><p><code>POP</code>动画的执行没有中间状态：相比POP动画，<code>CALayer</code>动画有中间状态：实际动画角色是立即到达结束时的位置的，中间状态指的是是“虚拟”的动画<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.44.12.png" alt="Alt text"></p>
</li>
<li><p><code>POP</code>动画是对<code>CALayer</code>动画的扩充，但不能实现所有的<code>CALayer</code>的动画效果</p>
</li>
<li><code>POP</code>动画可以作用在任何对象上，不仅仅是<code>CALayer</code></li>
</ol>
<p><strong>其它参考：</strong></p>
<ul>
<li><a href="http://www.cocoachina.com/industry/20140527/8565.html" target="_blank" rel="external">http://www.cocoachina.com/industry/20140527/8565.html</a></li>
</ul>
<p><strong>实例：</strong></p>
<ol>
<li>导入<code>POP</code>框架(<a href="https://github.com/facebook/pop" target="_blank" rel="external">https://github.com/facebook/pop</a>)<blockquote>
<p><strong>方式1：</strong>使用<a href="http://www.jianshu.com/p/071d30a3af02" target="_blank" rel="external">cocoapods</a>安装<br><strong>方式2：</strong>直接导入源码（可以配合<code>pch</code>文件）<br>教程：<a href="http://www.jianshu.com/p/67ce72c4ad6c" target="_blank" rel="external">http://www.jianshu.com/p/67ce72c4ad6c</a><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-07%2018.53.54.png" alt="Alt text"><br><strong>方式3：</strong>二进制文件<code>.framework</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<h4 id="3-4-2-1-导入POP框架"><a href="#3-4-2-1-导入POP框架" class="headerlink" title="3.4.2.1    导入POP框架"></a>3.4.2.1    导入<code>POP</code>框架</h4><blockquote>
<p><strong>说明：</strong>使用<code>CocoaPods</code><br><strong>可能的出错：</strong><a href="http://www.tuicool.com/articles/InIBbaf" target="_blank" rel="external">http://www.tuicool.com/articles/InIBbaf</a><br><strong>注意：</strong>安装好依赖后，需要从<code>项目名.xcworkspace</code>重启项目。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ pod search pop<span class="comment"># 搜索版本号</span></span><br><span class="line">$ <span class="built_in">cd</span> /Users/tonyearth/Documents/My Study/Animation/L04POP动画引擎中Layer与CALayer的联系与区别 <span class="comment">#到项目目录下</span></span><br><span class="line">$ pod init<span class="comment"># 初始化环境</span></span><br><span class="line">$ vim Podfile<span class="comment"># 依赖配置</span></span><br><span class="line">	platform :ios, <span class="string">'7.0'</span></span><br><span class="line">	pod <span class="string">'pop'</span>, <span class="string">'~&gt; 1.0'</span></span><br><span class="line">$ pod install<span class="comment"># 安装依赖</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-1-比较CALayer和POP-CAlayer"><a href="#3-4-2-1-比较CALayer和POP-CAlayer" class="headerlink" title="3.4.2.1    比较CALayer和POP CAlayer"></a>3.4.2.1    比较CALayer和POP CAlayer</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_pop.gif" alt="Alt text|150x200"></p>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *normal<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *pop<span class="built_in">CALayer</span>;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理 normalCALayer</span></span><br><span class="line">    [<span class="keyword">self</span> accessNormal<span class="built_in">CALayer</span>];</span><br><span class="line">    <span class="comment">// 处理 POP 动画</span></span><br><span class="line">    [<span class="keyword">self</span> accessPOP<span class="built_in">CALayer</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - pop CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  pop CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessPOP<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.popCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.popCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.popCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化 POP 动画</span></span><br><span class="line">    POPBasicAnimation *popAnimation = \</span><br><span class="line">    [POPBasicAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">    popAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">100</span> + <span class="number">50</span>, <span class="number">400</span>)];<span class="comment">// pop 动画不需要 fromValue</span></span><br><span class="line">    popAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    popAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_addAnimation:popAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：在哪儿移除就停在哪儿</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removePopAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1.5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removePopAnimation</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.popCALayer pop_removeAllAnimations];<span class="comment">// 移除所有 pop 动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - CALayer 动画</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  CALyer 动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)accessNormal<span class="built_in">CALayer</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化 layer</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.backgroundColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.normalCALayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化动画</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *baseAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    baseAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.normalCALayer.position];</span><br><span class="line">    baseAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>)];</span><br><span class="line">        baseAnimation.duration = <span class="number">4.</span>f;</span><br><span class="line">    baseAnimation.timingFunction = \</span><br><span class="line">    [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置结束位置的值</span></span><br><span class="line">    <span class="keyword">self</span>.normalCALayer.position = <span class="built_in">CGPointMake</span>(<span class="number">250</span> + <span class="number">50</span>, <span class="number">400</span>);</span><br><span class="line">    <span class="comment">// 开始动画</span></span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer addAnimation:baseAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.5s后移除动画：无论在哪儿停止，都会出现在最后设置的位置（非常突兀）</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(removeNormalAnimation) withObject:<span class="literal">nil</span> afterDelay:<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  移除动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeNormalAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CALayer</span> *layer = <span class="keyword">self</span>.normalCALayer.presentationLayer;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(layer.frame));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGRect</span>(<span class="keyword">self</span>.normalCALayer.frame));</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.normalCALayer removeAllAnimations];<span class="comment">// 移除掉所有动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-用POP动画引擎实现衰减动画"><a href="#3-4-3-用POP动画引擎实现衰减动画" class="headerlink" title="3.4.3    用POP动画引擎实现衰减动画"></a>3.4.3    用<code>POP</code>动画引擎实现衰减动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现移动<code>View</code> 并停止时衰减的动画效果。<br><strong>要点：</strong></p>
<ol>
<li>衰减动画由<code>POPDecayAnimation</code>来实现</li>
<li>需要精确计算停止运动瞬间的加速度才能用衰减动画做出真实的效果</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_decay.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *button;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化button</span></span><br><span class="line">    <span class="keyword">self</span>.button = [[<span class="built_in">UIButton</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.button.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="keyword">self</span>.button.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.button.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.button];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [<span class="keyword">self</span>.button addTarget:<span class="keyword">self</span></span><br><span class="line">                    action:<span class="keyword">@selector</span>(buttonEvent:)</span><br><span class="line">          forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 初始化手势</span></span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *panGesture = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handlePanGesture:)];</span><br><span class="line">    <span class="comment">// 添加手势</span></span><br><span class="line">    [<span class="keyword">self</span>.button addGestureRecognizer:panGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击按钮取消按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param button 按钮控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonEvent:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    [button.layer pop_removeAllAnimations];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  手势操作的响应函数</span><br><span class="line"> *</span><br><span class="line"> *  @param recognizer 事件目标控件</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)handlePanGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)recognizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [recognizer translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    recognizer.view.center = <span class="built_in">CGPointMake</span>(recognizer.view.center.x + translation.x,</span><br><span class="line">                                         recognizer.view.center.y + translation.y);</span><br><span class="line">    [recognizer setTranslation:<span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>) inView:<span class="keyword">self</span>.view];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 拖动停止</span></span><br><span class="line">    <span class="keyword">if</span> (recognizer.state == <span class="built_in">UIGestureRecognizerStateEnded</span>) &#123;</span><br><span class="line">        <span class="comment">//1. 创建动画</span></span><br><span class="line">        <span class="comment">// 获取加速度</span></span><br><span class="line">        <span class="built_in">CGPoint</span> velocity = [recognizer velocityInView:<span class="keyword">self</span>.view];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化POP的decay(衰减)动画</span></span><br><span class="line">        POPDecayAnimation *decayAnimation = \</span><br><span class="line">            [POPDecayAnimation animationWithPropertyNamed:kPOPLayerPosition];</span><br><span class="line">        <span class="comment">// 设置加速度</span></span><br><span class="line">        decayAnimation.velocity = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:velocity];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 执行动画</span></span><br><span class="line">        [recognizer.view.layer pop_addAnimation:decayAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-用POP动画引擎实现弹簧动画"><a href="#3-4-4-用POP动画引擎实现弹簧动画" class="headerlink" title="3.4.4    用POP动画引擎实现弹簧动画"></a>3.4.4    用<code>POP</code>动画引擎实现弹簧动画</h3><blockquote>
<p><strong>课程说明：</strong>本课时用 <code>POP</code> 动画引擎实现 View 的放大缩小等的弹簧效果。<br><strong>扩展：</strong><code>Shimmer</code><br><strong>要点：</strong></p>
<ol>
<li>弹簧动画由<code>POPSpringAnimation</code></li>
<li>弹簧的质量、速度、时间等值都是可以设置的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_spring.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;POP.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置背景色</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 延时3秒执行动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(startSpringAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例弹簧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)startSpringAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化spring动画</span></span><br><span class="line">    POPSpringAnimation *sizeAnimation = \</span><br><span class="line">    [POPSpringAnimation animationWithPropertyNamed:kPOPLayerBounds];<span class="comment">// 缩放型动画</span></span><br><span class="line">    sizeAnimation.springSpeed = <span class="number">0.</span>f;</span><br><span class="line">    sizeAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.showView pop_addAnimation:sizeAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-5-用缓动函数模拟物理动画"><a href="#3-5-用缓动函数模拟物理动画" class="headerlink" title="3.5    用缓动函数模拟物理动画"></a>3.5    用缓动函数模拟物理动画</h2><h3 id="3-5-1-缓动函数简介"><a href="#3-5-1-缓动函数简介" class="headerlink" title="3.5.1    缓动函数简介"></a>3.5.1    缓动函数简介</h3><blockquote>
<p><strong>课程说明：</strong>本课时将演示缓动函数能做出来的效果，然后讲解它的基本原理。</p>
<ol>
<li>缓动函数的动画效果是建立在<code>CALayer</code>层级的关键帧动画基础之上</li>
<li>缓动函数是一系列模拟物理效果（如抛物线）方程式的统称，用以计算给定亮点之间的插值</li>
<li>两点之间插的值越多，效果越好，但是会耗费更多的性能</li>
<li>只有理解了缓动函数的原理才有可能写出自己想要的效果</li>
</ol>
<p><strong>缓动函数源码：</strong><a href="https://github.com/YouXianMing/EasingAnimation" target="_blank" rel="external">https://github.com/YouXianMing/EasingAnimation</a></p>
</blockquote>
<h4 id="3-5-1-1-缓动函数类型"><a href="#3-5-1-1-缓动函数类型" class="headerlink" title="3.5.1.1    缓动函数类型"></a>3.5.1.1    缓动函数类型</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-09%20%E4%B8%8B%E5%8D%8810.52.45.png" alt="Alt text"></p>
<h4 id="3-5-1-2-缓动效果示例"><a href="#3-5-1-2-缓动效果示例" class="headerlink" title="3.5.1.2    缓动效果示例"></a>3.5.1.2    缓动效果示例</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_easing.gif" alt="Alt text"></p>
<h3 id="3-5-2-缓动函数与关键帧动画的联系"><a href="#3-5-2-缓动函数与关键帧动画的联系" class="headerlink" title="3.5.2    缓动函数与关键帧动画的联系"></a>3.5.2    缓动函数与关键帧动画的联系</h3><blockquote>
<p><strong>课程说明：</strong>本课时将讲解关键帧动画的原理，并分析关键帧动画与缓动函数之间的联系。</p>
<ol>
<li>关键帧动画需要提供很多的帧来完善动画效果</li>
<li>关键帧动画的帧可以通过一定的数学计算来提供需要的帧数</li>
<li><code>关键帧动画只需要提供起始点、结束点，就可以通过缓动函数来计算中间“缺失”的帧</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-10%20%E4%B8%8B%E5%8D%8812.00.12.png" alt="Alt text"></li>
<li>缓动函数可以指定计算出多少帧</li>
<li>帧数越多，动画越流畅，但同时耗费更多GPU性能</li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>缓动动画只是缓动函数在关键帧动画中的一种应用</li>
<li>当只插值只有起点和终点时，关键帧动画和基本动画效果一致</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *showView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 初始化显示用的view</span></span><br><span class="line">    <span class="keyword">self</span>.showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.cornerRadius = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.layer.masksToBounds = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">self</span>.showView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加到当前视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本动画</span></span><br><span class="line">    <span class="comment">// [self baseAnimation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关键帧动画</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  基本动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)baseAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *basicAnimation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    basicAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    basicAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    <span class="comment">// fromValue = A, toValue = B</span></span><br><span class="line">    basicAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="keyword">self</span>.showView.center];</span><br><span class="line">    basicAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:basicAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  关键帧动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    <span class="comment">// 插值（通过缓动函数创建一些列插值点）</span></span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromPoint:<span class="keyword">self</span>.showView.center<span class="comment">// 起点</span></span><br><span class="line">                                                         toPoint:<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>)<span class="comment">//终点</span></span><br><span class="line">                                                            func:BounceEaseIn<span class="comment">// 动画进度</span></span><br><span class="line">                                                      frameCount:<span class="number">60</span> * <span class="number">2</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="comment">// 2. 实际目标位置</span></span><br><span class="line">    <span class="keyword">self</span>.showView.center = <span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">200</span>);<span class="comment">// 真正目标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 添加动画到视图</span></span><br><span class="line">    [<span class="keyword">self</span>.showView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-用缓动函数模拟弹簧效果"><a href="#3-5-3-用缓动函数模拟弹簧效果" class="headerlink" title="3.5.3    用缓动函数模拟弹簧效果"></a>3.5.3    用缓动函数模拟弹簧效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数结合关键帧动画实现弹簧效果，并模拟秒表摆动效果。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_time.gif" alt="Alt text|100x90"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *secLayer;<span class="comment">// 秒针</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个表盘 UIView</span></span><br><span class="line">    <span class="built_in">UIView</span> *showView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    showView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    showView.layer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    showView.layer.cornerRadius = <span class="number">150</span>;</span><br><span class="line">    showView.layer.borderColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:showView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建出秒针 CALayer</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.secLayer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">150</span>, <span class="number">150</span>, <span class="number">1</span>, <span class="number">150</span>);</span><br><span class="line">    <span class="keyword">self</span>.secLayer.backgroundColor = [<span class="built_in">UIColor</span> blackColor].CGColor;</span><br><span class="line">    [showView.layer addSublayer:<span class="keyword">self</span>.secLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f<span class="comment">// 1秒钟调用一次</span></span><br><span class="line">                                                  target:<span class="keyword">self</span><span class="comment">// 目标控制器</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent) <span class="comment">// 目标方法</span></span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  指针变化动画</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">1</span>;<span class="comment">// 时间点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> oldValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i++);<span class="comment">// 旧弧度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> newValue = DEGREES_TO_RADIANS((<span class="number">360</span> / <span class="number">60.</span>f) * i);<span class="comment">// 新弧度</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"transform.rotation.z"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">0.5</span>;</span><br><span class="line">    keyFrameAnimation.values = [YXEasing calculateFrameFromValue:oldValue<span class="comment">// 起始弧度</span></span><br><span class="line">                                                         toValue:newValue<span class="comment">// 结束弧度</span></span><br><span class="line">                                                            func:ElasticEaseOut <span class="comment">// 动画效果</span></span><br><span class="line">                                                      frameCount:<span class="number">0.5</span> * <span class="number">30</span>];<span class="comment">// 帧数</span></span><br><span class="line">    <span class="keyword">self</span>.secLayer.transform = <span class="built_in">CATransform3DMakeRotation</span>(newValue,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">0</span>,</span><br><span class="line">                                                        <span class="number">1</span>);</span><br><span class="line">    [<span class="keyword">self</span>.secLayer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-4-用缓动函数模拟碰撞效果"><a href="#3-5-4-用缓动函数模拟碰撞效果" class="headerlink" title="3.5.4    用缓动函数模拟碰撞效果"></a>3.5.4    用缓动函数模拟碰撞效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现碰撞动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutBounce</code>函数来创建碰撞效果</li>
<li>将<code>easeOutBounce</code>创建出来的帧数组添加到关键帧动画中</li>
<li>碰撞效果用途</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_bounce.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 创建图 view</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">100</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    imageView.contentMode = <span class="built_in">UIViewContentModeScaleAspectFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画（移动距离的动画）</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">2.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>)</span><br><span class="line">                                     func:BounceEaseOut<span class="comment">// 碰撞动画</span></span><br><span class="line">                               frameCount:<span class="number">2</span> * <span class="number">30</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="number">320</span> / <span class="number">2.</span>f, <span class="number">320</span> / <span class="number">2.</span>f + <span class="number">240</span>);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation</span><br><span class="line">                           forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-用缓动函数模拟衰减效果"><a href="#3-5-5-用缓动函数模拟衰减效果" class="headerlink" title="3.5.5    用缓动函数模拟衰减效果"></a>3.5.5    用缓动函数模拟衰减效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时用缓动函数实现衰减动画效果，并分析用途。</p>
<ol>
<li>使用<code>easeOutCubic</code>函数来创建弹簧效果</li>
<li>将<code>easeOutCubic</code>创建出来的的帧数组添加到关键帧动画中</li>
<li>衰减效果用途</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_cubic.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"YXEasing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画1:背景变暗</span></span><br><span class="line">    <span class="built_in">UIView</span>  *backView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    backView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.</span>f animations:^&#123;</span><br><span class="line">        backView.alpha = <span class="number">0.3</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:backView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动画2:衰减滑出</span></span><br><span class="line">    <span class="comment">// 创建图片</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">320</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">568</span>)];</span><br><span class="line">    imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic"</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建关键帧动画</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *keyFrameAnimation = [<span class="built_in">CAKeyframeAnimation</span> animation];</span><br><span class="line">    keyFrameAnimation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    keyFrameAnimation.duration = <span class="number">1.</span>f;</span><br><span class="line">    keyFrameAnimation.values = \</span><br><span class="line">        [YXEasing calculateFrameFromPoint:imageView.center</span><br><span class="line">                                  toPoint:<span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y)</span><br><span class="line">                                     func:CubicEaseOut</span><br><span class="line">                               frameCount:<span class="number">1</span> * <span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 添加动画</span></span><br><span class="line">    imageView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.view.center.x + <span class="number">100</span>, <span class="keyword">self</span>.view.center.y);</span><br><span class="line">    [imageView.layer addAnimation:keyFrameAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-6-使用带粒子效果的-CAEmitterLayer"><a href="#3-6-使用带粒子效果的-CAEmitterLayer" class="headerlink" title="3.6    使用带粒子效果的 CAEmitterLayer"></a>3.6    使用带粒子效果的 CAEmitterLayer</h2><h3 id="3-6-1-用-CAEmitterLayer-产生粒子效果"><a href="#3-6-1-用-CAEmitterLayer-产生粒子效果" class="headerlink" title="3.6.1    用 CAEmitterLayer 产生粒子效果"></a>3.6.1    用 CAEmitterLayer 产生粒子效果</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解 <code>CAEmitterLayer</code> 的一些基本属性，以及基本的用法。</p>
<ul>
<li><code>CAEmitterLayer</code>的用途：实现粒子效果</li>
<li><code>CAEmitterLayer</code>参数</li>
<li><code>CAEmitterLayer</code>优点：使用<code>GPU</code>渲染，不占用<code>CPU</code>资源，远优于使用大量的随机<code>View</code>来实现。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_emitter.gif" alt="Alt text"></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. CAEmitterLayer</span></span><br><span class="line"><span class="comment">// 创建出粒子发射图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayer</span> *emitterLayer = [<span class="built_in">CAEmitterLayer</span> layer];</span><br><span class="line">emitterLayer.borderWidth = <span class="number">2.</span>f;<span class="comment">// 边框宽度（显示边框）</span></span><br><span class="line">emitterLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>);<span class="comment">// 设置尺寸</span></span><br><span class="line">emitterLayer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏溢出的粒子</span></span><br><span class="line">emitterLayer.emitterPosition = <span class="built_in">CGPointMake</span>(<span class="number">50</span>, <span class="number">50</span>);<span class="comment">// 发射点</span></span><br><span class="line">emitterLayer.emitterMode = k<span class="built_in">CAEmitterLayerSurface</span>;<span class="comment">// 发射模式</span></span><br><span class="line">emitterLayer.emitterShape = k<span class="built_in">CAEmitterLayerLine</span>;<span class="comment">// 发射形状</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加图层到当前视图图层</span></span><br><span class="line">[<span class="keyword">self</span>.view.layer addSublayer:emitterLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. CAEmitterCell（粒子）</span></span><br><span class="line"><span class="built_in">CAEmitterCell</span> *cell = [<span class="built_in">CAEmitterCell</span> emitterCell];</span><br><span class="line">cell.birthRate = <span class="number">10.</span>f;<span class="comment">// 粒子产生率</span></span><br><span class="line">cell.lifetime = <span class="number">120.</span>f;<span class="comment">// 粒子声明周期</span></span><br><span class="line">cell.velocity = <span class="number">30</span>;<span class="comment">// 加速度</span></span><br><span class="line">cell.velocityRange = <span class="number">10.</span>f;<span class="comment">// 加速度微调</span></span><br><span class="line">cell.yAcceleration = <span class="number">2.</span>f;<span class="comment">// y 轴加速度</span></span><br><span class="line">cell.emissionRange = <span class="number">0.5</span> * M_1_PI;<span class="comment">// 发射角度</span></span><br><span class="line">cell.color = [<span class="built_in">UIColor</span> blackColor].CGColor;<span class="comment">// 设置粒子颜色</span></span><br><span class="line">cell.contents = (__bridge <span class="keyword">id</span>)([<span class="built_in">UIImage</span> imageNamed:<span class="string">@"snow"</span>].CGImage);<span class="comment">// 设置图片</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将 CAEmitterCell(粒子)关联到CAEmitterLayer</span></span><br><span class="line">emitterLayer.emitterCells = @[cell];</span><br></pre></td></tr></table></figure>
<h3 id="3-6-2-封装-CAEmitterLayerUIVIew"><a href="#3-6-2-封装-CAEmitterLayerUIVIew" class="headerlink" title="3.6.2    封装 CAEmitterLayerUIVIew"></a>3.6.2    封装 CAEmitterLayerUIVIew</h3><blockquote>
<p><strong>课程说明：</strong>本课时讲解了为了避免繁琐的设置而将 <code>CAEmitterLayer</code> 封装成一个较为通用的父类供子类使用。</p>
<ul>
<li>替换<code>CAEmitterLayer</code>成<code>UIView</code>子类的<code>backedLayer</code></li>
<li>将<code>CAEmitterLayer</code>封装的类作为“抽象“父类</li>
</ul>
<p><strong>说明：</strong>封装一个父类(<code>CAEmitterLayerUIView</code>)，其它类型的粒子图层继承该类，将设置封装到子类的<code>show</code>和<code>hide</code>实现中。</p>
</blockquote>
<p><em>CAEmitterLayerUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示view</span></span><br><span class="line">- (<span class="keyword">void</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏view</span></span><br><span class="line">- (<span class="keyword">void</span>)hide;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CAEmitterLayerUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CAEmitterLayerUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CAEmitterLayerUIView</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">CAEmitterLayer</span> *_emitterLayer;<span class="comment">// 粒子图层</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CAEmitterLayerUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        _emitterLayer = (<span class="built_in">CAEmitterLayer</span> *)<span class="keyword">self</span>.layer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类本身</span></span><br><span class="line">+ (Class)layerClass</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">CAEmitterLayer</span> class];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">- (<span class="keyword">void</span>)setEmitterLayer:(<span class="built_in">CAEmitterLayer</span> *)layer</span><br><span class="line">&#123;</span><br><span class="line">    _emitterLayer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line">- (<span class="built_in">CAEmitterLayer</span> *)emitterLayer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _emitterLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)show &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)hide &#123;&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-6-3-封装下雪、下雨的粒子效果控件"><a href="#3-6-3-封装下雪、下雨的粒子效果控件" class="headerlink" title="3.6.3    封装下雪、下雨的粒子效果控件"></a>3.6.3    封装下雪、下雨的粒子效果控件</h3><blockquote>
<p><strong>课程说明：</strong>本课时在封装 <code>CAEmitterLayer</code> 基础上进一步从“抽象”父类派生出下雪、下雨的子类控件。</p>
<ul>
<li>从封装<code>CAEmitterLayer</code>的“抽象”父类继承的原因</li>
<li>下雪、下雨效果参数的设置</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_rain.gif" alt="Alt text"></p>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用控件</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 初始化粒子效果图层</span></span><br><span class="line"><span class="comment">// 下雪效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *snowView = [[SnowView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line"><span class="comment">// 下雨效果图层</span></span><br><span class="line"><span class="built_in">CAEmitterLayerView</span> *rainView = [[RainView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">210</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 模糊化粒子视图边界</span></span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView1 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView1.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"><span class="built_in">UIImageView</span> *alphaView2 = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">alphaView2.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"alpha"</span>];</span><br><span class="line"></span><br><span class="line">snowView.maskView = alphaView1;</span><br><span class="line">rainView.maskView = alphaView2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 添加到当前图层</span></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:snowView];</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:rainView];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 展现</span></span><br><span class="line">[snowView show];</span><br><span class="line">[rainView show];</span><br></pre></td></tr></table></figure>
<h2 id="3-7-iOS-中-CAGradientLaueyer-的使用"><a href="#3-7-iOS-中-CAGradientLaueyer-的使用" class="headerlink" title="3.7    iOS 中 CAGradientLaueyer 的使用"></a>3.7    iOS 中 CAGradientLaueyer 的使用</h2><h3 id="3-7-1-CAGradientLayer-简介"><a href="#3-7-1-CAGradientLayer-简介" class="headerlink" title="3.7.1    CAGradientLayer 简介"></a>3.7.1    CAGradientLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课演示 <code>CAGradientLayer</code> 能做的一些动画效果，以及 <code>CAGradientLayer</code> 与 <code>CAShapeLayer</code> 配合使用的实例。</p>
<ol>
<li><code>CAGradientLayer</code>是用于处理渐变色的层结构</li>
<li><code>CAGradientLayer</code>的渐变色可以做隐式动画</li>
<li>大部分情况下，<code>CAGradientLayer</code>都是与<code>CAShapeLayer</code>配合使用的</li>
<li><code>CAGradientLayer</code>可以用作<code>png</code>遮罩效果</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam1.gif" alt="Alt text|100x100"> <code>CAShapeLayer</code>作为<code>CAGradientLayer</code>的遮罩实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam2.gif" alt="Alt text|100x100">旋转<code>CAGradientLayer</code>实现的效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam3.gif" alt="Alt text|100x160"> 色差动画效果</p>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_exam4.gif" alt="Alt text|100x160">作为<code>png</code>图片遮罩动画效果</p>
<h3 id="3-7-2-CAGradientLayer-坐标系统"><a href="#3-7-2-CAGradientLayer-坐标系统" class="headerlink" title="3.7.2    CAGradientLayer 坐标系统"></a>3.7.2    CAGradientLayer 坐标系统</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解 CAGradientLayer 的坐标系统，并延伸讲解了坐标系统影响如何颜色分配、动画效果。</p>
<ol>
<li><code>CAGradientLayer</code>的坐标系统是从坐标（0, 0）到（1, 1）绘制的矩形<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.44.12.png" alt="Alt text|200x180"></li>
<li><code>CAGradientLayer</code>的<code>frame</code>值的<code>size</code>不为正方形的话，坐标系统会被拉伸</li>
<li><code>CAGradientLayer</code>的<code>startPoint</code>与<code>endPoint</code>会直接影响颜色的绘制方向</li>
<li><code>CAGradientLayer</code>的颜色分割线是以0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-11%20%E4%B8%8B%E5%8D%8811.45.28.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_gra.gif" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 1. 创建并初始化 CAGradientLayer 实例</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.borderWidth = <span class="number">1.</span>f;</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.gradientLayer];<span class="comment">// 添加到视图</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 渐变效果相关设置</span></span><br><span class="line">    <span class="comment">// 颜色</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> greenColor].CGColor,</span><br><span class="line">                                (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor].CGColor];</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.25</span>), @(<span class="number">0.5</span>), @(<span class="number">0.75</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 动画:3秒后修改分割点</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(gradientLayerLocationLocationAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  修改分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)gradientLayerLocationLocationAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 颜色分割点效果</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.01</span>), @(<span class="number">0.5</span>), @(<span class="number">0.99</span>)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-3-色差动画的实现"><a href="#3-7-3-色差动画的实现" class="headerlink" title="3.7.3    色差动画的实现"></a>3.7.3    色差动画的实现</h3><blockquote>
<p><strong>课程说明：</strong>本课用 CAGradientLayer 实现色差动画效果。</p>
<ol>
<li>确定渐变色渐变方向</li>
<li>设定两种颜色，其中一种是透明色，另外一种是自定义颜色</li>
<li>设定好<code>location</code>颜色分割点</li>
<li><code>CAGradientLayer</code>的颜色分割点是0到1的比例来计算的<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_colors.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建 UIImage 实例（作为背景）</span></span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>]];</span><br><span class="line">    imageView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 初始化渐变图层</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.frame = imageView.bounds;</span><br><span class="line">    <span class="comment">// 渐变方向</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.endPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">0.5</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 组合背景和渐变图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imageView];</span><br><span class="line">    [imageView.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 初始化定时器</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                                  target:<span class="keyword">self</span></span><br><span class="line">                                                selector:<span class="keyword">@selector</span>(timerEvent)</span><br><span class="line">                                                userInfo:<span class="literal">nil</span></span><br><span class="line">                                                 repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  刷新颜色组合分割点，从而制造动画效果</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取一组随机产生的颜色组</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> colorWithRed:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               green:arc4random() % <span class="number">255</span> /  <span class="number">255.</span>f</span><br><span class="line">                                                                blue:arc4random() % <span class="number">255</span> / <span class="number">255.</span>f</span><br><span class="line">                                                               alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">    <span class="comment">// 获取随机产生的分割点</span></span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(arc4random() % <span class="number">10</span> / <span class="number">10.</span>f), @(<span class="number">1.</span>f)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-7-4-用-CAGradientLayer-封装带色差动画的-View"><a href="#3-7-4-用-CAGradientLayer-封装带色差动画的-View" class="headerlink" title="3.7.4    用 CAGradientLayer 封装带色差动画的 View"></a>3.7.4    用 CAGradientLayer 封装带色差动画的 View</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解将色差动画效果封装到 View 当中。</p>
<ol>
<li>确定几个属性值</li>
<li>去定意义做动画的参数</li>
<li>重写<code>setter</code>做动画</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_last.gif" alt="Alt text"></p>
<h4 id="3-7-4-1-封装好的视图"><a href="#3-7-4-1-封装好的视图" class="headerlink" title="3.7.4.1    封装好的视图"></a>3.7.4.1    封装好的视图</h4><blockquote>
<p><strong>说明：</strong>将对视图的渐变层的设置工作整合到<code>setter</code>中。</p>
</blockquote>
<p><em>ColorUIImageView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> 渐变方向</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    UP,<span class="comment">// 从上至下</span></span><br><span class="line">    DOWN,<span class="comment">// 从下往上</span></span><br><span class="line">    RIGHT,<span class="comment">// 从左到右</span></span><br><span class="line">    LEFT<span class="comment">// 从右往左</span></span><br><span class="line">&#125; EColorDirection;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> : <span class="title">UIImageView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) EColorDirection direction;<span class="comment">// 渐变方向(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *color;<span class="comment">// 颜色(可以做动画)</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> percent;<span class="comment">// 百分比(可以做动画)</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ColorUIImageView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ColorUIImageView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAGradientLayer</span> *gradientLayer;<span class="comment">// 渐变图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ColorUIImageView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 初始化 CAGradientLayer 实例</span></span><br><span class="line">        <span class="keyword">self</span>.gradientLayer = [<span class="built_in">CAGradientLayer</span> layer];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                      (__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor];</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.locations = @[@(<span class="number">1</span>), @(<span class="number">1</span>)];</span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:<span class="keyword">self</span>.gradientLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 颜色组 color</span></span><br><span class="line"><span class="keyword">@synthesize</span> color = _color;</span><br><span class="line">- (<span class="keyword">void</span>)setColor:(<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    _color = color;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.colors = @[(__bridge <span class="keyword">id</span>)[<span class="built_in">UIColor</span> clearColor].CGColor,</span><br><span class="line">                                  (__bridge <span class="keyword">id</span>)color.CGColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渐变方向 direction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> direction = _direction;</span><br><span class="line">- (<span class="keyword">void</span>)setDirection:(EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    _direction = direction;</span><br><span class="line">    <span class="keyword">if</span> (direction == UP) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == DOWN) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == RIGHT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == LEFT) &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.startPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">self</span>.gradientLayer.endPoint   = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (EColorDirection)direction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _direction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 分割点 percent</span></span><br><span class="line"><span class="keyword">@synthesize</span> percent = _percent;</span><br><span class="line">- (<span class="keyword">void</span>)setPercent:(<span class="built_in">CGFloat</span>)percent &#123;</span><br><span class="line">    _percent = percent;</span><br><span class="line">    <span class="keyword">self</span>.gradientLayer.locations = @[@(percent), @(<span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)percent</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _percent;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-7-4-2-使用"><a href="#3-7-4-2-使用" class="headerlink" title="3.7.4.2    使用"></a>3.7.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColorUIImageView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Color<span class="built_in">UIImageView</span> *colorView;<span class="comment">// 渐变图层</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 初始化封装了渐变图层的自定义视图</span></span><br><span class="line">    <span class="keyword">self</span>.colorView        = [[Color<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">198</span>, <span class="number">253</span>)];</span><br><span class="line">    <span class="keyword">self</span>.colorView.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    <span class="keyword">self</span>.colorView.image  = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"bg"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加到当前视图</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.colorView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 1秒钟后改变视图</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(event)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">1.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变渐变颜色组、渐变方向和分割点</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)event &#123;</span><br><span class="line">    <span class="keyword">self</span>.colorView.direction = DOWN;</span><br><span class="line">    <span class="keyword">self</span>.colorView.color     = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">    <span class="keyword">self</span>.colorView.percent   = <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-8-iOS中-CAShapeLayer-的使用"><a href="#3-8-iOS中-CAShapeLayer-的使用" class="headerlink" title="3.8    iOS中 CAShapeLayer 的使用"></a>3.8    iOS中 CAShapeLayer 的使用</h2><h3 id="3-8-1-CAShapeLayer-简介"><a href="#3-8-1-CAShapeLayer-简介" class="headerlink" title="3.8.1    CAShapeLayer 简介"></a>3.8.1    CAShapeLayer 简介</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍 <code>CAShapeLayer</code> 与 <code>CALayer</code>、贝塞尔曲线之间的简单联系，并通过一个 demo 演示 <code>CAShapeLayer</code> 实现的路径动画效果。</p>
<ol>
<li><code>CAShapeLayer</code>继承自<code>CALayer</code>，可以使用<code>CALayer</code>的所有属性值</li>
<li><code>CAShapeLayer</code>需要与贝塞尔曲线配合使用才有意义</li>
<li>使用<code>CAShapeLayer</code>与贝塞尔曲线可以实现不在<code>view</code>的<code>drawRect</code>方法中画出一些想要的图形</li>
<li><code>CAShapeLayer</code>属于<code>CoreAnimation</code>框架，其动画渲染直接提交到手机的<code>GPU</code>当中，相较于<code>view</code>的<code>srawRect</code>方法使用<code>CPU</code>渲染而言，其效率极高，能大大优化内存使用情况。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_path.gif" alt="Alt text"></p>
<h3 id="3-8-2-贝塞尔曲线与-CAShapeLayer-的关系"><a href="#3-8-2-贝塞尔曲线与-CAShapeLayer-的关系" class="headerlink" title="3.8.2    贝塞尔曲线与 CAShapeLayer 的关系"></a>3.8.2    贝塞尔曲线与 CAShapeLayer 的关系</h3><blockquote>
<p><strong>课程说明：</strong>本课介绍多阶贝塞尔曲线的用途，并详细讲解贝塞尔曲线与 <code>CAShapeLayer</code> 之间的关系，以及使用贝塞尔曲线的一些注意事项。</p>
<ol>
<li><code>CAShapeLayer</code>中有<code>Shape</code>这个单词，顾名思义，它需要一个形状才能生效</li>
<li>贝赛尔曲线可以创建基于矢量的路径<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_beisaier.gif" alt="Alt text"></li>
<li>贝塞尔曲线给<code>CAShaperLayer</code>提供路径，<code>CAShpaeLayer</code>在提供的路径中进行渲染，路径会闭环，所以路径绘制出了<code>Shape</code></li>
<li>用于<code>CAShapeLayer</code>的贝赛尔曲线作为<code>path</code>，其中<code>path</code>是一个首尾相接的闭环的曲线，即使该贝赛尔曲线不是一个闭环的曲线。</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-12%2019.14.35.png" alt="Alt text"></p>
<p><em>ViewCnotroller.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">    <span class="comment">// UIBezierPath *oval = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(0, 0, 200, 100)];// 椭圆形</span></span><br><span class="line">    <span class="comment">// UIBezierPath *rect = [UIBezierPath bezierPathWithRect:CGRectMake(0, 0, 200, 100)];// 矩形</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *circle = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];<span class="comment">// 圆形</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">    <span class="built_in">CAShapeLayer</span> *shape = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    shape.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">50</span>);</span><br><span class="line">    shape.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    shape.borderWidth = <span class="number">1.</span>f;<span class="comment">// 显示 CAShapeLayer 的边界</span></span><br><span class="line">    shape.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 隐藏益处的贝塞尔曲线围住的区域</span></span><br><span class="line">    shape.fillColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 建立关联</span></span><br><span class="line">    shape.path = circle.CGPath;<span class="comment">// 看下圆形的效果</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:shape];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-3-StrokeStart-与-StrokeEnd-动画"><a href="#3-8-3-StrokeStart-与-StrokeEnd-动画" class="headerlink" title="3.8.3    StrokeStart 与 StrokeEnd 动画"></a>3.8.3    StrokeStart 与 StrokeEnd 动画</h3><blockquote>
<p><strong>课程说明：</strong>本课讲解如何设置 <code>CAShapeLayer</code> 的属性值来显示出圆环并用 <code>CAShapeLayer</code> 的 <code>StrokeStart</code> 与 <code>StrokeEnd</code> 属性做动画。</p>
<ol>
<li>将<code>ShapeLayer</code>的<code>fillColor</code>设置成透明背景</li>
<li>设置线条的宽度(<code>lineWidth</code>)的值</li>
<li>设置线条的颜色</li>
<li>将<code>strokeStart</code>的值设定成0，然后让<code>strokeEnd</code>的值变化触发隐式动画</li>
</ol>
<p><strong>注意：</strong>同时设置<code>strokeStart</code>和<code>strokeEnd</code>时，前者不能大于后者。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_animeTwo.gif" alt="Alt text"></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;<span class="comment">// 定时器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 背景设置</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.878</span> green:<span class="number">0.878</span> blue:<span class="number">0.878</span> alpha:<span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 贝塞尔曲线</span></span><br><span class="line">    <span class="built_in">UIBezierPath</span> *oval = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. CAShapeLayer</span></span><br><span class="line">    _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    _shapeLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    _shapeLayer.position = <span class="keyword">self</span>.view.center;</span><br><span class="line">    _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">    _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">    _shapeLayer.lineWidth = <span class="number">2.</span>f;</span><br><span class="line">    _shapeLayer.strokeStart = <span class="number">0.</span>f;</span><br><span class="line">    _shapeLayer.strokeEnd = <span class="number">0.</span>f;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 建立贝塞尔曲线与CAShapeLayer之间的关联</span></span><br><span class="line">    _shapeLayer.path = oval.CGPath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:_shapeLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 定时器</span></span><br><span class="line">    _timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1.</span>f</span><br><span class="line">                                              target:<span class="keyword">self</span></span><br><span class="line">                                            selector:<span class="keyword">@selector</span>(animationEventTypeTwo)</span><br><span class="line">                                            userInfo:<span class="literal">nil</span></span><br><span class="line">                                             repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  只改变 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeOne</span><br><span class="line">&#123;</span><br><span class="line">    _shapeLayer.strokeEnd = arc4random() % <span class="number">100</span> / <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  同时改变 strokeStart 和 strokeEnd</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)animationEventTypeTwo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueOne = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    <span class="built_in">CGFloat</span> valueTwo = arc4random() % <span class="number">100</span> / <span class="number">100.</span>f;</span><br><span class="line">    </span><br><span class="line">    _shapeLayer.strokeStart = valueOne &lt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取小的</span></span><br><span class="line">    _shapeLayer.strokeEnd = valueOne &gt; valueTwo ? valueOne : valueTwo;<span class="comment">// 取大的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-8-4-用-CAShapeLayer-实现圆形进度条效果"><a href="#3-8-4-用-CAShapeLayer-实现圆形进度条效果" class="headerlink" title="3.8.4    用 CAShapeLayer 实现圆形进度条效果"></a>3.8.4    用 CAShapeLayer 实现圆形进度条效果</h3><blockquote>
<p><strong>课程说明：</strong>本课在课时 3 的基础上将动画效果封装到控件当中。</p>
<ol>
<li>确定需要设定的参数</li>
<li>实现细节</li>
<li>进行测试</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_circle.gif" alt="Alt text"></p>
<h4 id="3-8-4-1-圆形进度条控件"><a href="#3-8-4-1-圆形进度条控件" class="headerlink" title="3.8.4.1    圆形进度条控件"></a>3.8.4.1    圆形进度条控件</h4><p><em>CircleUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> startValue;<span class="comment">// 起始值（0～1）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> lineWidth;<span class="comment">// 线宽（&gt;0）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> value;<span class="comment">// 变化的值</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *lineColor;<span class="comment">// 线条颜色</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CircleUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CircleUIView</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CAShapeLayer</span> *shapeLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CircleUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        <span class="comment">// 1. 贝塞尔曲线</span></span><br><span class="line">        <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPathWithOvalInRect:<span class="keyword">self</span>.bounds];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. CAShapeLayer</span></span><br><span class="line">        _shapeLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">        _shapeLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">        _shapeLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">        _shapeLayer.lineWidth=  <span class="number">1.</span>f;</span><br><span class="line">        _shapeLayer.strokeColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">        _shapeLayer.strokeEnd = <span class="number">0.</span>f;<span class="comment">// 一开使进度为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 关联</span></span><br><span class="line">        _shapeLayer.path = path.CGPath;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 添加并显示</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addSublayer:_shapeLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeStart</span></span><br><span class="line"><span class="keyword">@synthesize</span> startValue = _startValue;</span><br><span class="line">- (<span class="keyword">void</span>)setStartValue:(<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    _startValue = startValue;</span><br><span class="line">    _shapeLayer.strokeStart = startValue;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)startValue &#123;</span><br><span class="line">    <span class="keyword">return</span> _startValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeEnd</span></span><br><span class="line"><span class="keyword">@synthesize</span> value = _value;</span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    _value = value;</span><br><span class="line">    _shapeLayer.strokeEnd = value;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)value &#123;</span><br><span class="line">    <span class="keyword">return</span> _value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lineWidth</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineWidth = _lineWidth;</span><br><span class="line">- (<span class="keyword">void</span>)setLineWidth:(<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    _lineWidth = lineWidth;</span><br><span class="line">    _shapeLayer.lineWidth = lineWidth;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGFloat</span>)lineWidth &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strokeColor</span></span><br><span class="line"><span class="keyword">@synthesize</span> lineColor = _lineColor;</span><br><span class="line">- (<span class="keyword">void</span>)setLineColor:(<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    _lineColor = lineColor;</span><br><span class="line">    _shapeLayer.strokeColor = lineColor.CGColor;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIColor</span> *)lineColor &#123;</span><br><span class="line">    <span class="keyword">return</span> _lineColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-8-4-2-使用"><a href="#3-8-4-2-使用" class="headerlink" title="3.8.4.2    使用"></a>3.8.4.2    使用</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CircleUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    Circle<span class="built_in">UIView</span> *circle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 1. 创建并设置圆型进度条</span></span><br><span class="line">    circle = [[Circle<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    circle.center = <span class="keyword">self</span>.view.center;</span><br><span class="line">    circle.startValue = <span class="number">0.</span>f;</span><br><span class="line">    circle.lineWidth = <span class="number">3.</span>f;</span><br><span class="line">    circle.lineColor = [<span class="built_in">UIColor</span> grayColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 添加并显示</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:circle];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 延迟3秒后动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(delayAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置圆型进度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)delayAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使进度达到100%</span></span><br><span class="line">    circle.value = <span class="number">1.</span>f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-9-iOS中-CALayer-的使用"><a href="#3-9-iOS中-CALayer-的使用" class="headerlink" title="3.9    iOS中 CALayer 的使用"></a>3.9    iOS中 CALayer 的使用</h2><h3 id="3-9-1-用-CALayer-定制下载进度条控件"><a href="#3-9-1-用-CALayer-定制下载进度条控件" class="headerlink" title="3.9.1    用 CALayer 定制下载进度条控件"></a>3.9.1    用 CALayer 定制下载进度条控件</h3><blockquote>
<p><strong>课程说明：</strong>本课在通过对 <code>CALayer</code> 的基本原理讲解后用 <code>CALayer</code> 基本知识定制下载进度条控件。</p>
<ol>
<li>单独创建出<code>CALayer</code></li>
<li>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果</li>
<li>用定时器（<code>NSTimer</code>）模拟网络下载时提供的百分比数据</li>
<li>将<code>CALayer</code>封装进<code>UIView</code>子类中定制进度条控件</li>
</ol>
<p><strong>CALayer简介：</strong></p>
<ol>
<li><code>CALayer</code>一般作为<code>UIView</code>的容器使用</li>
<li><code>CALayer</code>是一个管理着图片载体（image-based content）的 层结构</li>
<li>直接修改单独创建出的<code>CALayer</code>的属性可以触发隐式动画（不需要其它设置，修改属性直接触发动画）</li>
<li><code>UIView</code>中的<code>CALayer</code>动画必须显式触发才能生效</li>
</ol>
</blockquote>
<h4 id="3-9-2-1-原理"><a href="#3-9-2-1-原理" class="headerlink" title="3.9.2.1    原理"></a>3.9.2.1    原理</h4><blockquote>
<p><strong>说明：</strong>直接修改<code>CALayer</code>的<code>frame</code>值执行隐式动画，实现进度条效果。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建layer并添加layer</span></span><br><span class="line"><span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">5</span>);</span><br><span class="line">[<span class="keyword">self</span>.view.layer addSubLayer:layer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发隐式动画</span></span><br><span class="line">layer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>,<span class="number">0</span>, <span class="number">200</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-13%2010.29.42.png" alt="Alt text|200x120"></p>
<h4 id="3-9-1-2-实战"><a href="#3-9-1-2-实战" class="headerlink" title="3.9.1.2    实战"></a>3.9.1.2    实战</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S1_xcode-progress.gif" alt="Alt text"></p>
<h3 id="3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果"><a href="#3-9-2-用-CALayer-定制-UIImageView-淡入淡出切换图片效果" class="headerlink" title="3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果"></a>3.9.2    用 CALayer 定制 UIImageView 淡入淡出切换图片效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用动画组 <code>CAAnimationGroup</code> 将 <code>bounds</code> 动画与 <code>contents</code> 动画组合起来实现切换图片时的淡入淡出效果。</p>
<ol>
<li>操作<code>UIImageView</code>的<code>CALayer</code>修改其<code>bounds</code>值进行显示动画</li>
<li>修改<code>UIImageView</code>的<code>CALayer</code>中的<code>contents</code>属性实现切换图片的动画</li>
<li>用<code>CAAnimationGroup</code>将<code>bounds</code>动画与<code>contents</code>动画组合起来</li>
<li>将上述效果封装进<code>UIView</code>的子类中生成控件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_fade.gif" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="3-9-2-1-封装动画效果"><a href="#3-9-2-1-封装动画效果" class="headerlink" title="3.9.2.1    封装动画效果"></a>3.9.2.1    封装动画效果</h4><p><em>FadeUIView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FadeUIView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *image;<span class="comment">// 当前图片</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>FadeUIView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FadeUIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 setter, getter</span></span><br><span class="line"><span class="keyword">@synthesize</span> image = _image;</span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    _image = image;</span><br><span class="line">    <span class="comment">// 除了第一次设置图片，都加入淡如淡出的效果</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.layer.contents != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建淡入/淡出的切换动画</span></span><br><span class="line">        <span class="built_in">CABasicAnimation</span> *contentsAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"contents"</span>];</span><br><span class="line">        contentsAnimation.fromValue = <span class="keyword">self</span>.layer.contents;</span><br><span class="line">        contentsAnimation.toValue = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">        contentsAnimation.duration = <span class="number">3.</span>f;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将动画添加到图层</span></span><br><span class="line">        [<span class="keyword">self</span>.layer addAnimation:contentsAnimation forKey:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改 contents，触发动画</span></span><br><span class="line">    <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span>)(image.CGImage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="3-9-2-2-使用控件"><a href="#3-9-2-2-使用控件" class="headerlink" title="3.9.2.2    使用控件"></a>3.9.2.2    使用控件</h4><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FadeUIView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>)Fade<span class="built_in">UIView</span> *fadeView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化呈现动画的视图</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView = [[Fade<span class="built_in">UIView</span> alloc] initWithFrame:<span class="keyword">self</span>.view.bounds];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.fadeView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置第一张图片</span></span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"起始图片"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2秒钟后设置下一张图片</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(layerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置下一张图片</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)layerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.fadeView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"结束图片"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-9-3-用-CALayer-实现复杂遮罩效果"><a href="#3-9-3-用-CALayer-实现复杂遮罩效果" class="headerlink" title="3.9.3    用 CALayer 实现复杂遮罩效果"></a>3.9.3    用 CALayer 实现复杂遮罩效果</h3><blockquote>
<p><strong>课程说明：</strong>本课将利用 CALayer 的 mask 属性作为遮罩 Layer，通过移动该遮罩 Layer 的 frame 值实现复杂的遮罩效果。</p>
<ol>
<li>遮罩原理分析</li>
<li>用<code>png</code>图片作为<code>CALayer</code>中<code>mask</code>属性的遮罩<code>Layer</code></li>
<li>移动该<code>CALayer</code>的<code>mask</code>的<code>frame</code>值实现遮罩<code>Layer</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8A%E5%8D%8812.01.58.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_mask.gif" alt="Alt text"></li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *imageLayer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *maskLayer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *imageForContents = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"原始图片"</span>];<span class="comment">// 底图</span></span><br><span class="line">    <span class="built_in">UIImage</span> *imageForMask = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"maskLayerContents"</span>];<span class="comment">// 作为遮罩的图片</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 图片 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">self</span>.imageLayer.contents = (__bridge <span class="keyword">id</span>)(imageForContents.CGImage);</span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:<span class="keyword">self</span>.imageLayer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遮罩 layer</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.contents = (__bridge <span class="keyword">id</span>)(imageForMask.CGImage);</span><br><span class="line">    <span class="comment">// self.maskLayer.backgroundColor = [UIColor whiteColor].CGColor;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给图片 layer 提供遮罩的 layer</span></span><br><span class="line">    <span class="keyword">self</span>.imageLayer.mask = <span class="keyword">self</span>.maskLayer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3秒中中后做 maskLayer 动画</span></span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(maskLayerAnimation)</span><br><span class="line">               withObject:<span class="literal">nil</span></span><br><span class="line">               afterDelay:<span class="number">3.</span>f];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)maskLayerAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.maskLayer.frame = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="3-10-iOS绘图-API-绘制线条／文字／几何图形"><a href="#3-10-iOS绘图-API-绘制线条／文字／几何图形" class="headerlink" title="3.10    iOS绘图 API 绘制线条／文字／几何图形"></a>3.10    iOS绘图 API 绘制线条／文字／几何图形</h2><h3 id="3-10-1-绘制线条"><a href="#3-10-1-绘制线条" class="headerlink" title="3.10.1    绘制线条"></a>3.10.1    绘制线条</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460642543336.png" alt="Alt text|100x150"><br><em>DrawLines.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawLinesView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 描绘线条</span></span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="type">CGContextMoveToPoint</span>(context, <span class="number">100</span>, <span class="number">300</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">400</span>)</span><br><span class="line">        <span class="type">CGContextAddLineToPoint</span>(context, <span class="number">200</span>, <span class="number">500</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出来</span></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-2-绘制矩形"><a href="#3-10-2-绘制矩形" class="headerlink" title="3.10.2    绘制矩形"></a>3.10.2    绘制矩形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8810.36.09.png" alt="Alt text"><br><em>DrawRectView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawRectView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取绘图上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 矩形</span></span><br><span class="line">        <span class="type">CGContextAddRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 设置绘图上下文</span></span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">5</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBStrokeColor</span>(context, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 绘制出矩形</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-3-绘制圆形"><a href="#3-10-3-绘制圆形" class="headerlink" title="3.10.3    绘制圆形"></a>3.10.3    绘制圆形</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/1460644510040.png" alt="Alt text|100x150"><br><em>DrawCircleView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawCircleView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 1. 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 画圆</span></span><br><span class="line">        <span class="comment">/*-- 方案一 --*/</span></span><br><span class="line">        <span class="comment">// 内部用来填充的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetRGBFillColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="type">CGContextFillPath</span>(context)</span><br><span class="line">        <span class="comment">// 外部作为边的圆</span></span><br><span class="line">        <span class="type">CGContextAddArc</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">3.141592653</span> * <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="type">CGContextSetLineWidth</span>(context, <span class="number">10</span>)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*-- 方案二 --*/</span></span><br><span class="line">        <span class="type">CGContextAddEllipseInRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">400</span>, <span class="number">200</span>, <span class="number">100</span>))</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line"></span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-4-绘制图片"><a href="#3-10-4-绘制图片" class="headerlink" title="3.10.4    绘制图片"></a>3.10.4    绘制图片</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-04-14%20%E4%B8%8B%E5%8D%8811.43.57.png" alt="Alt text"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawImageView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> uiImage:<span class="type">CGImageRef</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">        uiImage = <span class="type">UIImage</span>(named: <span class="string">"walle.jpg"</span>)?.<span class="type">CGImage</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 获取上下文</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制图片 */</span></span><br><span class="line">        <span class="comment">// 1. 保留之前的上下文信息（设置暂存点）</span></span><br><span class="line">        <span class="type">CGContextSaveGState</span>(context)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 设置当前上下文</span></span><br><span class="line">        <span class="type">CGContextTranslateCTM</span>(context, <span class="number">10</span>, <span class="number">400</span>)<span class="comment">// 移动</span></span><br><span class="line">        <span class="type">CGContextScaleCTM</span>(context, <span class="number">1</span>, -<span class="number">1</span>)<span class="comment">// 缩放（翻转坐标系）</span></span><br><span class="line">        <span class="comment">// 3. 呈现图片</span></span><br><span class="line">        <span class="type">CGContextDrawImage</span>(context, <span class="type">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>), uiImage)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 绘制矩形 */</span></span><br><span class="line">        <span class="type">CGContextRestoreGState</span>(context)<span class="comment">// 恢复暂存点之前的上下文</span></span><br><span class="line">        <span class="type">CGContextStrokeRect</span>(context, <span class="type">CGRectMake</span>(<span class="number">50</span>, <span class="number">80</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-10-5-画板实例"><a href="#3-10-5-画板实例" class="headerlink" title="3.10.5    画板实例"></a>3.10.5    画板实例</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S3_panel.gif" alt="Alt text"><br><em>DrawBoardView.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawBoardView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">CGPathCreateMutable</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathMoveToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesMoved</span><span class="params">(touches: Set&lt;UITouch&gt;, withEvent event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> p = touches.first?.locationInView(<span class="keyword">self</span>)</span><br><span class="line">        <span class="type">CGPathAddLineToPoint</span>(path, <span class="literal">nil</span>, p!.x, p!.y)</span><br><span class="line">        </span><br><span class="line">        setNeedsDisplay()<span class="comment">// 重绘当前view（触发drawRect）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>()</span><br><span class="line">        <span class="type">CGContextAddPath</span>(context, path)</span><br><span class="line">        <span class="type">CGContextStrokePath</span>(context)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/14/JK_IOS中级_2  UI部分/" itemprop="url">
                  2 UI部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-14T08:56:56+08:00" content="2016-05-14">
              2016-05-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/14/JK_IOS中级_2  UI部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/14/JK_IOS中级_2  UI部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>iOS</code>实战项目</p>
</blockquote>
<h2 id="2-1-汤姆猫小游戏（投诉下线）"><a href="#2-1-汤姆猫小游戏（投诉下线）" class="headerlink" title="2.1    汤姆猫小游戏（投诉下线）"></a>2.1    汤姆猫小游戏（投诉下线）</h2><h2 id="2-2-加法计算器"><a href="#2-2-加法计算器" class="headerlink" title="2.2    加法计算器"></a>2.2    加法计算器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>storyboard</code> 中利用 <code>UITextField</code>、<code>UILabel</code>、<code>UIButton</code> 快速搭建器计算器UI界面，并在 <code>viewController</code> 中用代码完成计算的业务逻辑以及排除部分隐含的 bug，让大家学会自制计算器。</p>
<ul>
<li>设置<code>Text Field</code>使用数字键盘</li>
<li>点击“计算”后，使<code>Text Field</code>失去焦点</li>
<li>处理<code>Text Field</code>没有输入的情况</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-27%20%E4%B8%8B%E5%8D%8810.16.26.png" alt="Alt text"></p>
<p><em>ViewController.swift</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text1: <span class="type">UITextField</span>!<span class="comment">// 操作数1控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> text2: <span class="type">UITextField</span>!<span class="comment">// 操作数2控件</span></span><br><span class="line">    <span class="meta">@IBOutlet</span> <span class="keyword">var</span> result: <span class="type">UILabel</span>!<span class="comment">// 结果控件</span></span><br><span class="line">    <span class="comment">// 计算</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">calculate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> num1 = <span class="type">Int</span>(<span class="keyword">self</span>.text1.text!) ?? <span class="number">0</span></span><br><span class="line">        <span class="keyword">let</span> num2 = <span class="type">Int</span>(<span class="keyword">self</span>.text2.text!) ?? <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> resultNum = num1 + num2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> resultString = <span class="string">"\(resultNum)"</span><span class="comment">//String(resultNum)</span></span><br><span class="line">        <span class="keyword">self</span>.result.text = resultString</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使输入框失去焦点</span></span><br><span class="line">        <span class="keyword">self</span>.text1.endEditing(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">self</span>.text2.endEditing(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清零</span></span><br><span class="line">    <span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.result.text = <span class="string">"0"</span></span><br><span class="line">        <span class="keyword">self</span>.text1.text = <span class="string">""</span></span><br><span class="line">        <span class="keyword">self</span>.text2.text = <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-制作图片浏览器"><a href="#2-3-制作图片浏览器" class="headerlink" title="2.3    制作图片浏览器"></a>2.3    制作图片浏览器</h2><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>UILable</code>、<code>UIButton</code>、<code>UIImageView</code> 搭建一个图片浏览器的结构，并通过字典数组完成它的业务逻辑，实现浏览趣味图片的功能。</p>
<ul>
<li>切换按钮的不同<code>State Config</code>要分别进行设置</li>
<li>通过设置按钮控件的<code>enabled</code>属性设置按钮是否可点击</li>
<li>图片资源通过<code>plist</code>存储</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%888.59.20.png" alt="Alt text"><br><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *leftBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *rightBtn;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *imageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> index;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSArray</span> *imageDicts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)leftBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index--;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">IBAction</span>)rightBtnOnClicked &#123;</span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    [<span class="keyword">self</span> btnClickChange: <span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取存储图片的数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 存储图片的数组（字典数组）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)imageDicts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_imageDicts.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"imageData"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        _imageDicts = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"still"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _imageDicts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  切换图片</span><br><span class="line"> *</span><br><span class="line"> *  @param isAdd 是否向后(右)翻</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) btnClickChange: (<span class="built_in">BOOL</span>) isAdd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), <span class="keyword">self</span>.imageDicts.count]);</span><br><span class="line">    <span class="keyword">self</span>.topLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%lu"</span>, (<span class="keyword">self</span>.index + (isAdd ? <span class="number">1</span> : <span class="number">-1</span>)), (<span class="keyword">unsigned</span> <span class="keyword">long</span>)<span class="keyword">self</span>.imageDicts.count];</span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = <span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"description"</span>];</span><br><span class="line">    <span class="keyword">self</span>.imageView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageDicts[<span class="keyword">self</span>.index][<span class="string">@"name"</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.leftBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">0</span>);<span class="comment">// 左边按钮的状态</span></span><br><span class="line">    <span class="keyword">self</span>.rightBtn.enabled = (<span class="keyword">self</span>.index != <span class="number">4</span>);<span class="comment">// 右边按钮的状态</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4-LOL英雄展示"><a href="#2-4-LOL英雄展示" class="headerlink" title="2.4    LOL英雄展示"></a>2.4    LOL英雄展示</h2><blockquote>
<p><strong>说明：</strong>通过<code>UITableView</code>和<code>plist</code>数据文件，搭建一个LOL英雄展示界面。</p>
<ul>
<li><code>UITableView</code>需要通过右键菜单设置<code>dataSource</code>和<code>delegate</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%889.29.01.png" alt="Alt text"></li>
<li><code>ViewController</code>要采纳相应的协议（<code>UITableViewDataSource</code>,<code>UITableViewDelegate</code>）：通过采纳相应的协议实现对<code>TableView</code>的中的<code>cell</code>的创建工作</li>
<li>通过使用<code>JKHero</code>类封装<code>plist</code>数据<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-02-28%20%E4%B8%8B%E5%8D%8810.43.32.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="2-4-1-数据模版"><a href="#2-4-1-数据模版" class="headerlink" title="2.4.1    数据模版"></a>2.4.1    数据模版</h3><p><em>JKHero.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKHero</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 成员属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKHero.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKHero</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line"><span class="comment">//        self.icon = [dict[@"icon"] copy];</span></span><br><span class="line"><span class="comment">//        self.name = [dict[@"name"] copy];</span></span><br><span class="line"><span class="comment">//        self.intro = [dict[@"intro"] copy];</span></span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];<span class="comment">// 利用 kvc</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)heroWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-2-采纳协议"><a href="#2-4-2-采纳协议" class="headerlink" title="2.4.2    采纳协议"></a>2.4.2    采纳协议</h3><blockquote>
<p><strong>说明：</strong>通过扩展采纳协议。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKHero.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UITableViewDataSource</span>, <span class="title">UITableViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *heros;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取英雄列表数据(懒加载)</span><br><span class="line"> *</span><br><span class="line"> *  @return JKHero类型的可变数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *) heros</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_heros) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"heros"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKHero *hero = [JKHero heroWithDict:dict];</span><br><span class="line">            [arrayM addObject:hero];</span><br><span class="line">        &#125;</span><br><span class="line">        _heros = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _heros;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - UITableViewDataSource</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少行</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.heros.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组默认有多少行(可以不实现，默认就是1)</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView sectionForSectionIndexTitle:(<span class="built_in">NSString</span> *)title atIndex:(<span class="built_in">NSInteger</span>)index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置cell的高度</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">60</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建tableView中的所有cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"heroCell"</span>;</span><br><span class="line">    <span class="comment">// 创建cell</span></span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置cell的样式风格</span></span><br><span class="line">    cell.accessoryType = <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>;</span><br><span class="line">    <span class="comment">// 设置cell内容</span></span><br><span class="line">    JKHero *hero = <span class="keyword">self</span>.heros[indexPath.row];</span><br><span class="line">    cell.textLabel.text = hero.name;</span><br><span class="line">    cell.detailTextLabel.text = hero.intro;</span><br><span class="line">    cell.detailTextLabel.textColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:hero.icon];</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏状态栏</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)prefersStatusBarHidden</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-5-Face-人脸识别技术入门"><a href="#2-5-Face-人脸识别技术入门" class="headerlink" title="2.5    Face++人脸识别技术入门"></a>2.5    Face++人脸识别技术入门</h2><blockquote>
<p><strong>注意：</strong>课程中的演示程项目是<code>Android</code>项目！</p>
</blockquote>
<h3 id="2-5-1-本课概要"><a href="#2-5-1-本课概要" class="headerlink" title="2.5.1    本课概要"></a>2.5.1    本课概要</h3><h4 id="2-5-1-1-Face-公司简介"><a href="#2-5-1-1-Face-公司简介" class="headerlink" title="2.5.1.1    Face++公司简介"></a>2.5.1.1    Face++公司简介</h4><blockquote>
<p><strong>网址：</strong><a href="http://www.faceplusplus.com.cn/" target="_blank" rel="external">http://www.faceplusplus.com.cn/</a></p>
</blockquote>
<ul>
<li>北京旷视科技有限公司（Face++）创立于2011年，是一家专注于机器视觉和深度学习的科技创业公司。</li>
<li>北京旷视科技旗下的Face++人脸识别云平台，是世界最大的人脸识别技术云平台。服务超过2万的开发者，日调用超过2百万次，积累人脸数据超过10亿张。</li>
<li>北京旷世科技先后获得联想创投的天使投资，和创新工场李开复博士的A轮投资。并获得2012年黑马创业大赛全国总冠军。</li>
</ul>
<h4 id="2-5-1-2-Face-核心技术简介"><a href="#2-5-1-2-Face-核心技术简介" class="headerlink" title="2.5.1.2 Face++核心技术简介"></a>2.5.1.2 Face++核心技术简介</h4><ul>
<li>旷视科技旗下Face++平台是世界最大的人脸识别技术云平台，提供包括人脸检测、人脸分析、人脸识别、人脸搜索等全套核心技术。</li>
<li>Face++的人脸技术居世界领先地位。其中，人脸检测技术获<code>FDDB</code>评测世界第一，人脸关键点技术获300-W评测世界第一，人脸识别技术获LFW评测世界第一。</li>
<li>Face++已搭建起世界领先的大数据深度学习（deep learning）技术引擎，可以提供人脸技术以外先进的视觉技术。其深度学习引擎可以和<code>Google</code>、<code>Facebook</code>形成强有力竞争。</li>
<li>旷视科技拥有自己独立的知识产权，有多项国内国外专利在申。</li>
</ul>
<h5 id="人脸检测和追踪"><a href="#人脸检测和追踪" class="headerlink" title="人脸检测和追踪"></a>人脸检测和追踪</h5><ul>
<li>Face++人脸检测技术在世界权威<code>FDDB</code>测试集上排名世界第一</li>
<li>Face++人脸检测技术针对移动和嵌入式设备做过多项性能优化，检测率高、内存消耗小、模型小，最小可稳定检测16x16大小的人脸<h5 id="Face-人脸关键点定位"><a href="#Face-人脸关键点定位" class="headerlink" title="Face++人脸关键点定位"></a>Face++人脸关键点定位</h5></li>
<li>Face++人脸关键点定位技术在世界权威300-W测试集上排名世界第一</li>
<li>Face++人脸关键点定位提供5点，23点，83点等多个版本，对移动和嵌入式设备做过多项性能优化<h5 id="Face-人脸属性分析"><a href="#Face-人脸属性分析" class="headerlink" title="Face++人脸属性分析"></a>Face++人脸属性分析</h5></li>
<li>Face++ 人脸属性分析可以分析出性别、年龄、种族、情绪，是否佩戴眼镜</li>
<li>Face++性别、种族、情绪、眼镜分析精确度均在95%以上，年龄准确度平均误差在5岁范围内<h5 id="Face-人脸1-1识别技术"><a href="#Face-人脸1-1识别技术" class="headerlink" title="Face++人脸1:1识别技术"></a>Face++人脸1:1识别技术</h5></li>
<li>Face++人脸1:1验证技术已被广泛应用于帐号登录、身份验证等服务中，被联想、神州智联等大客户使用。在千分之一的误检率情况下，通过率超过70%<h5 id="Face-人脸1-N识别技术"><a href="#Face-人脸1-N识别技术" class="headerlink" title="Face++人脸1:N识别技术"></a>Face++人脸1:N识别技术</h5></li>
<li>Face++人脸识别技术在世界最著名<code>LFW</code>评测中排名世界第一，取到97.72%的准确度，力压<code>Facebook</code><h5 id="Face-人脸大规模搜索"><a href="#Face-人脸大规模搜索" class="headerlink" title="Face++人脸大规模搜索"></a>Face++人脸大规模搜索</h5></li>
<li>Face++人脸大规模搜索技术被奇虎360、世纪佳缘等大客户使用，可以用不超过4字节表示一张人脸，千万级别图片搜索可达0.1ms响应速度</li>
</ul>
<h4 id="2-5-1-3-Face-技术使用场景介绍"><a href="#2-5-1-3-Face-技术使用场景介绍" class="headerlink" title="2.5.1.3    Face++技术使用场景介绍"></a>2.5.1.3    Face++技术使用场景介绍</h4><ul>
<li>相机和相册类应用</li>
<li>电子商务和广告营销类</li>
<li>游戏类应用</li>
<li>人脸搜索</li>
</ul>
<h5 id="相机和广告"><a href="#相机和广告" class="headerlink" title="相机和广告"></a>相机和广告</h5><ul>
<li>Face++ 已经为美图秀秀、相机360等移动应用广告厂商提供了人脸检测、人脸追踪以及人脸关键点定位技术，通过这些技术移动应用可以在相机和相册中快速得定为人脸的位置以及五官的位置，为下一步的美化做提前准备。</li>
<li>通过Face++所能提供的人脸属性分析，包括年龄、性别、种族以及微笑程度的判断，可以更好地评估电子商务、广告营销类的用户群体和这些群体所带有的属性。</li>
</ul>
<h5 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h5><ul>
<li>现有的移动设备大多都带有前置摄像头，那我们可以通过这些前置摄像头以及Face++ 所能提供的人脸检测和追踪技术，快速定位人脸以及人脸位置的变化。通过具体实际人脸的位置变化来操控游戏中的人物的位置变化。</li>
</ul>
<h5 id="人脸搜索和人脸登录"><a href="#人脸搜索和人脸登录" class="headerlink" title="人脸搜索和人脸登录"></a>人脸搜索和人脸登录</h5><ul>
<li>Face++已经为360搜索和世纪佳缘提供了此项技术，可以在千万级的会员库中快速准确地定位到具体的某个人以及与他相似的人</li>
<li>Face++已经为联想视频通话软件－－友约和神州智联提供了此项技术，可以瞬间验证使用者的身份是否属实。</li>
</ul>
<h3 id="2-5-2-Face-介绍"><a href="#2-5-2-Face-介绍" class="headerlink" title="2.5.2    Face++介绍"></a>2.5.2    Face++介绍</h3><h3 id="2-5-3-线上API分析"><a href="#2-5-3-线上API分析" class="headerlink" title="2.5.3    线上API分析"></a>2.5.3    线上API分析</h3><blockquote>
<p><strong>说明：</strong><a href="http://www.faceplusplus.com.cn/api-overview/" target="_blank" rel="external">http://www.faceplusplus.com.cn/api-overview/</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>用途</th>
<th>依赖的数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>face</td>
<td>基本属性</td>
<td></td>
<td></td>
</tr>
<tr>
<td>faceset</td>
<td>face集合</td>
<td>搜索集合中的face</td>
<td><code>faceid</code>、<code>faceset_name</code>、<code>face</code>、<code>set_id</code></td>
</tr>
<tr>
<td>person</td>
<td>人</td>
<td>验证</td>
<td><code>faceid</code>、 <code>person_name(person_id)</code></td>
</tr>
<tr>
<td>group</td>
<td>人群</td>
<td>匹配</td>
<td><code>identity</code>、 <code>url(ing)</code>、 <code>group_name(group_id)</code></td>
</tr>
</tbody>
</table>
<h3 id="2-5-4-离线API的下载和配置"><a href="#2-5-4-离线API的下载和配置" class="headerlink" title="2.5.4    离线API的下载和配置"></a>2.5.4    离线API的下载和配置</h3><blockquote>
<p><strong>说明：</strong>离线API主要用于在客户端提取图片的信息，从而与线上服务器配合完成一些处理。<br><strong>注意：</strong>在<code>Face++</code>官网创建自己的应用后才能下载到相应的离线<code>SDK</code></p>
<blockquote>
<p><strong>我的学习应用：</strong><a href="http://www.faceplusplus.com.cn/uc/app/home?app_id=42841" target="_blank" rel="external">http://www.faceplusplus.com.cn/uc/app/home?app_id=42841</a></p>
</blockquote>
</blockquote>
<h3 id="2-5-5-Face-实例编写"><a href="#2-5-5-Face-实例编写" class="headerlink" title="2.5.5    Face++实例编写"></a>2.5.5    Face++实例编写</h3><h3 id="2-5-6-Face-人脸识别总结语"><a href="#2-5-6-Face-人脸识别总结语" class="headerlink" title="2.5.6    Face++人脸识别总结语"></a>2.5.6    Face++人脸识别总结语</h3><h2 id="2-6-应用管理"><a href="#2-6-应用管理" class="headerlink" title="2.6    应用管理"></a>2.6    应用管理</h2><h3 id="2-6-1-项目讲解和模型搭建"><a href="#2-6-1-项目讲解和模型搭建" class="headerlink" title="2.6.1    项目讲解和模型搭建"></a>2.6.1    项目讲解和模型搭建</h3><ol>
<li>创建项目</li>
<li>设置<code>Storyboard</code>(设置<code>Size</code>为<code>iPhone 3.5-inch</code>，取消<code>Use Auto Layout</code>和<code>Use Size Classes</code>)</li>
<li>导入素材（图片和<code>plist</code>文件）</li>
<li>为<code>plist</code>文件创建<code>数据模型</code><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><em>JKAppInfo.h</em></li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKAppInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;<span class="comment">// 通过定义为私有属性使其可在 image 方法中被访问</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)appInfoWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 image 的set(因为 通过 @property 创建的 image 是只读的，因此不会自动生成 get)</span></span><br><span class="line"><span class="comment">// 注意：将访问 image 自定义为访问 _image</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-2-Xib自定义视图"><a href="#2-6-2-Xib自定义视图" class="headerlink" title="2.6.2    Xib自定义视图"></a>2.6.2    Xib自定义视图</h3><ol>
<li>创建<code>JKAppView</code>（继承<code>UIView</code>）</li>
<li>创建<code>xib</code>文件（<code>iOS</code>-&gt;<code>User Interface</code>-&gt;<code>Empty</code>）</li>
</ol>
<ul>
<li><code>Size</code>：Freeform(然后宽和高就可以设置了)</li>
</ul>
<ol>
<li>在<code>xib</code>中创建需要的展现单个<code>app</code>信息的控件</li>
<li>在<code>xib</code>文件和<code>JKAppView</code>类之间创建关联</li>
<li>完善<code>JKAppView</code>类</li>
</ol>
<h4 id="2-6-2-1-xib视图文件"><a href="#2-6-2-1-xib视图文件" class="headerlink" title="2.6.2.1    xib视图文件"></a>2.6.2.1    xib视图文件</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-02%20%E4%B8%8A%E5%8D%8812.11.15.png" alt="Alt text"></p>
<h4 id="2-6-2-2-绑定的类-UIView"><a href="#2-6-2-2-绑定的类-UIView" class="headerlink" title="2.6.2.2    绑定的类(UIView)"></a>2.6.2.2    绑定的类(<code>UIView</code>)</h4><p><em>JKView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKAppInfo</span>;</span></span><br><span class="line"><span class="comment">//-------协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">JKAppViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">// 下载按钮被点击的响应函数</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//-------接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性：一项app信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKAppInfo *appInfo;</span><br><span class="line"><span class="comment">// 属性：代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;JKAppViewDelegate&gt; delegate;<span class="comment">// 要求代理对象采纳JKAppViewDelegate协议</span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)appView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="comment">//------ 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKAppView</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *iconView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *nameLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKAppView</span></span></span><br><span class="line">- (<span class="keyword">IBAction</span>)downloadBtnOnClick:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 调用代理对象的”点击下载按钮“的响应函数</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(downloadClickWithBtn:)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate downloadClickWithBtn:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂构造</span></span><br><span class="line">+ (instancetype)appView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从指定nib文件中获取目标View控件（是唯一的，所以可以用lastObject）</span></span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle]loadNibNamed:<span class="string">@"JKAppView"</span> owner:<span class="literal">nil</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为View控件初始化内部信息</span></span><br><span class="line">- (<span class="keyword">void</span>)setAppInfo:(JKAppInfo *)appInfo</span><br><span class="line">&#123;</span><br><span class="line">    _appInfo = appInfo;</span><br><span class="line">    <span class="keyword">self</span>.iconView.image = appInfo.image;</span><br><span class="line">    <span class="keyword">self</span>.nameLabel.text = appInfo.name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-3-创建自定义视图数组"><a href="#2-6-3-创建自定义视图数组" class="headerlink" title="2.6.3    创建自定义视图数组"></a>2.6.3    创建自定义视图数组</h3><blockquote>
<p><strong>说明：</strong>在<code>ViewController</code>中初始化<code>JKAppView</code>数组</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据plist初始化所有的小view（懒加载）</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)appViews</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_appViews) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"app"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKAppInfo *appInfo = [JKAppInfo appInfoWithDict:dict];</span><br><span class="line">            JKAppView *appView = [JKAppView appView];</span><br><span class="line">            appView.appInfo = appInfo;</span><br><span class="line">            appView.delegate = <span class="keyword">self</span>;</span><br><span class="line">            </span><br><span class="line">            [arrayM addObject:appView];</span><br><span class="line">        &#125;</span><br><span class="line">        _appViews = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _appViews;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-4-九宫格布局展示"><a href="#2-6-4-九宫格布局展示" class="headerlink" title="2.6.4    九宫格布局展示"></a>2.6.4    九宫格布局展示</h3><blockquote>
<p><strong>说明：</strong>九宫格布局开发</p>
<ol>
<li>宏定义界面布局的相关参数</li>
<li>确定间距</li>
<li>为确定每个下载项的位置（通过设置中心点坐标）</li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenH [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"><span class="comment">// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="comment">// 每个下载项的高度</span></span><br><span class="line"><span class="meta">#define kAppViewH [JKAppView appView].bounds.size.height</span></span><br><span class="line"><span class="comment">// 每个下载项的宽度</span></span><br><span class="line"><span class="meta">#define kAppViewW [JKAppView appView].bounds.size.width</span></span><br><span class="line"><span class="comment">// 分3列</span></span><br><span class="line"><span class="meta">#define kTotaoCol 3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">JKAppViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *appViews;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 间距</span></span><br><span class="line">    <span class="built_in">CGFloat</span> margin = (kScreenW - kTotaoCol * kAppViewW) / (kTotaoCol + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 确定每个自定义视图在父视图中的位置并添加到父视图中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">self</span>.appViews.count; i++) &#123;</span><br><span class="line">        JKAppView *appView = <span class="keyword">self</span>.appViews[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> col = i % kTotaoCol;</span><br><span class="line">        <span class="keyword">int</span> row = i / kTotaoCol;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGFloat</span> centerX = (margin + kAppViewW * <span class="number">0.5</span>) + (margin + kAppViewW) * col;</span><br><span class="line">        <span class="built_in">CGFloat</span> centerY = (margin + kAppViewH * <span class="number">0.5</span>) + (margin + kAppViewH) * row;</span><br><span class="line">        <span class="comment">// 设置中心点</span></span><br><span class="line">        appView.center = <span class="built_in">CGPointMake</span>(centerX, centerY);</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:appView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-5-点击效果分析与bug排除"><a href="#2-6-5-点击效果分析与bug排除" class="headerlink" title="2.6.5    点击效果分析与bug排除"></a>2.6.5    点击效果分析与bug排除</h3><blockquote>
<p><strong>说明：</strong>点击<code>下载</code>时弹出等待画面</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 获取要下载的应用的名字</span></span><br><span class="line">    JKAppView *appView = (JKAppView *)btn.superview;</span><br><span class="line">    <span class="built_in">NSString</span> *appName = appView.appInfo.name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建加载提示窗</span></span><br><span class="line">    <span class="built_in">UIActivityIndicatorView</span> *juhua = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleGray</span>];<span class="comment">// 样式</span></span><br><span class="line">    juhua.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 尺寸</span></span><br><span class="line">    [juhua startAnimating];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:juhua];<span class="comment">// 将提示窗添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 创建下载中文案</span></span><br><span class="line">    <span class="built_in">UILabel</span> *downloadLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">    downloadLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">10</span>, kScreenW, <span class="number">20</span>);</span><br><span class="line">    </span><br><span class="line">    downloadLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    downloadLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    downloadLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@正在下载..."</span>, appName];</span><br><span class="line">    downloadLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">15.0</span>];</span><br><span class="line">    </span><br><span class="line">    downloadLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    downloadLabel.alpha = <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    [juhua addSubview:downloadLabel];<span class="comment">// 将文案添加到加载窗上</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-延时操作与块动画"><a href="#2-6-6-延时操作与块动画" class="headerlink" title="2.6.6    延时操作与块动画"></a>2.6.6    延时操作与块动画</h3><blockquote>
<p><strong>说明：</strong>过一段时间以多线程的方式延时处理。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKAppView.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - JKAppViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)downloadClickWithBtn:(<span class="built_in">UIButton</span> *)btn</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 4. 设置两秒钟后完成下载</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 加载窗停止转动，并且自动隐藏</span></span><br><span class="line">        [juhua stopAnimating];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 下载完成的提示</span></span><br><span class="line">        <span class="built_in">UILabel</span> *noteLabel = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        noteLabel.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenH * <span class="number">0.5</span> + <span class="number">20</span>, kScreenW, <span class="number">30</span>);</span><br><span class="line">        </span><br><span class="line">        noteLabel.textColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        noteLabel.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        noteLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@下载完成"</span>, appName];</span><br><span class="line">        </span><br><span class="line">        noteLabel.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:noteLabel];</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">2.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 执行动画</span></span><br><span class="line">            noteLabel.alpha = <span class="number">1</span>;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            <span class="comment">// 动画完成后需要做的事情</span></span><br><span class="line">            btn.enabled = <span class="literal">NO</span>;</span><br><span class="line">            [btn setTitle:<span class="string">@"已下载"</span> forState: <span class="built_in">UIControlStateDisabled</span>];</span><br><span class="line">            [noteLabel removeFromSuperview];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-7-超级猜图"><a href="#2-7-超级猜图" class="headerlink" title="2.7    超级猜图"></a>2.7    超级猜图</h2><h3 id="2-7-1-效果展示与业务逻辑分析"><a href="#2-7-1-效果展示与业务逻辑分析" class="headerlink" title="2.7.1    效果展示与业务逻辑分析"></a>2.7.1    效果展示与业务逻辑分析</h3><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-04%2012.15.01.png" alt="Alt text"></p>
<h3 id="2-7-2-模型搭建"><a href="#2-7-2-模型搭建" class="headerlink" title="2.7.2    模型搭建"></a>2.7.2    模型搭建</h3><blockquote>
<p><strong>说明：</strong>创建对应<code>plist</code>文件的数据模型。</p>
<ol>
<li>视图控制器基本设置</li>
<li>导入相关素材（图片和<code>plist</code>）</li>
<li>创建对应<code>plist</code>文件的数据模型</li>
</ol>
</blockquote>
<p><em>JKQuestionInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKQuestionInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">// 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *answer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *options;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *image;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)doct;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKQuestionInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKQuestionInfo</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *_image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法（工厂方法）</span></span><br><span class="line">+ (instancetype)questionWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为_image手动定义 get</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_image) &#123;</span><br><span class="line">        _image = [<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.icon];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 plist 创建 options</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"questions"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">        [arrayM addObject:[<span class="keyword">self</span> questionWithDict:dict]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 保证每次调用该方法获取的都是全新的数组</span></span><br><span class="line">    <span class="keyword">return</span> [arrayM <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-3-Storyboard-布局-UI"><a href="#2-7-3-Storyboard-布局-UI" class="headerlink" title="2.7.3    Storyboard 布局 UI"></a>2.7.3    Storyboard 布局 UI</h3><blockquote>
<p><strong>技巧：</strong></p>
<ul>
<li>可以在<code>Storyboard</code>中为控件设置内边距</li>
<li>有时候用<code>Button</code>替代<code>ImageView</code>会更方便</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-05%20%E4%B8%8B%E5%8D%883.20.24.png" alt="Alt text"></p>
<h3 id="2-7-4-拖线与注释"><a href="#2-7-4-拖线与注释" class="headerlink" title="2.7.4    拖线与注释"></a>2.7.4    拖线与注释</h3><blockquote>
<p><strong>技巧：</strong>多个控件可以绑定同一个<code>action</code>。方式是<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_more.gif" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="comment">// 顶部索引情况 label</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *topindexLabel;</span><br><span class="line"><span class="comment">// 图片描述</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *descLabel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 金币</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *coinBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *imgInsideBtn;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *answerView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备选的答案</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIView</span> *optionsView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录索引</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：帮助</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)helpBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮：大图</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-5-创建模型数组与遮罩"><a href="#2-7-5-创建模型数组与遮罩" class="headerlink" title="2.7.5    创建模型数组与遮罩"></a>2.7.5    创建模型数组与遮罩</h3><blockquote>
<p><strong>说明：</strong>遮罩用来监听点<code>击屏幕任何地方</code>的事件。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"><span class="comment">//-------------------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 模型数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *questions;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遮盖按钮</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cover;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取数据模型数组（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @return 模型数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)questions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _questions) &#123;</span><br><span class="line">        _questions = [JKQuestionInfo questions];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _questions;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取遮罩（懒加载），用来监听用户的点击行为</span><br><span class="line"> *</span><br><span class="line"> *  @return 遮罩</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">UIButton</span> *)cover</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == _cover) &#123;</span><br><span class="line">        _cover = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;<span class="comment">// 和最外层视图一样大</span></span><br><span class="line">        _cover.frame = <span class="keyword">self</span>.view.bounds;</span><br><span class="line">        _cover.alpha = <span class="number">0.0</span>;<span class="comment">// 一开始隐藏遮罩：当透明度为0时，该遮罩不会存在于任何位置</span></span><br><span class="line">        _cover.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        <span class="comment">// 为遮罩注册点击事件</span></span><br><span class="line">        [_cover addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(imgBtnChangeOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.view addSubview:_cover];<span class="comment">// 把遮罩添加到视图中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-6-实现图片缩放"><a href="#2-7-6-实现图片缩放" class="headerlink" title="2.7.6    实现图片缩放"></a>2.7.6    实现图片缩放</h3><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 1. 按钮：大图(拖线) 2. 遮罩（代码调用） 3. 图片本身（拖线）</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)imgBtnChangeOnClick &#123;</span><br><span class="line">    <span class="comment">// 放大图片</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == <span class="keyword">self</span>.cover.alpha) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> scaleX = kScreenW / imgW;<span class="comment">// 水平方向放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> scaleY = scaleX;<span class="comment">// 垂直方向上放大倍数</span></span><br><span class="line">        <span class="built_in">CGFloat</span> translateY = <span class="keyword">self</span>.imgInsideBtn.frame.origin.y / scaleX;<span class="comment">// 垂直方向上的偏移（倍数）</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用块动画</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="comment">// 显示遮罩</span></span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.5</span>;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scaleX, scaleY);<span class="comment">// 放大</span></span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformTranslate</span>(<span class="keyword">self</span>.imgInsideBtn.transform, <span class="number">0</span>, translateY);<span class="comment">// 在现有的基础上向上移动</span></span><br><span class="line">        &#125;];</span><br><span class="line">        <span class="comment">// 将中间图片所在图层置顶</span></span><br><span class="line">        [<span class="keyword">self</span>.view bringSubviewToFront:<span class="keyword">self</span>.imgInsideBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 还原图片</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 图片还原事件</span></span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.imgInsideBtn.transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">            <span class="keyword">self</span>.cover.alpha = <span class="number">0.0</span>;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-7-下一题方法实现"><a href="#2-7-7-下一题方法实现" class="headerlink" title="2.7.7    下一题方法实现"></a>2.7.7    下一题方法实现</h3><blockquote>
<p><strong>说明：</strong>用户点击下一题按钮时界面做出相应的改变</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 索引自增（判断是否越界）</span></span><br><span class="line">    <span class="keyword">self</span>.index++;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"INDEX == %D"</span>, <span class="keyword">self</span>.index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.index &gt;= <span class="keyword">self</span>.questions.count) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"恭喜过关！"</span>);</span><br><span class="line">        <span class="meta">#warning noCode</span></span><br><span class="line">        <span class="keyword">self</span>.index--;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出数据模型</span></span><br><span class="line">    JKQuestionInfo *question = <span class="keyword">self</span>.questions[<span class="keyword">self</span>.index];</span><br><span class="line">    <span class="comment">// 3. 设置</span></span><br><span class="line">    [<span class="keyword">self</span> setupBaseInfo:question];</span><br><span class="line">    <span class="comment">// 4. 创建答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createAnswerBtns:question];</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - 私有方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置基本信息</span><br><span class="line"> *</span><br><span class="line"> *  @param question 问题的数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setupBaseInfo: (JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 恢复（enable）optionView 的用户交互</span></span><br><span class="line">    <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">    <span class="comment">// 改变顶部图片索引信息</span></span><br><span class="line">    <span class="keyword">self</span>.topindexLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d/%d"</span>, <span class="keyword">self</span>.index + <span class="number">1</span>, <span class="keyword">self</span>.questions.count];</span><br><span class="line">    <span class="comment">// 改变图片描述</span></span><br><span class="line">    <span class="keyword">self</span>.descLabel.text = question.title;</span><br><span class="line">    <span class="comment">// 更换图片</span></span><br><span class="line">    [<span class="keyword">self</span>.imgInsideBtn setImage:question.image forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下一题按钮状态判断改变</span></span><br><span class="line">    <span class="keyword">self</span>.nextBtn.enabled = (<span class="keyword">self</span>.index != <span class="keyword">self</span>.questions.count - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-8-创建答案按钮"><a href="#2-7-8-创建答案按钮" class="headerlink" title="2.7.8    创建答案按钮"></a>2.7.8    创建答案按钮</h3><blockquote>
<p><strong>说明：</strong>设置基本信息时创建放置答案的一排按钮集合。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要计算的常量</span></span><br><span class="line"><span class="meta">#define kScreenW [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define imgW  self.imgInsideBtn.bounds.size.width</span></span><br><span class="line"><span class="meta">#define kAnswerBtnTitleColor [UIColor blackColor]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不需要计算的常量</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnW = <span class="number">35</span>;<span class="comment">// 按钮宽</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kBtnH = <span class="number">35</span>;<span class="comment">// 按钮高</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> kMarginBetweenBtns = <span class="number">10</span>;<span class="comment">// 按钮间距</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kOptionViewTotalCol = <span class="number">7</span>;<span class="comment">// 备选答案总列数</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTrueAddScore = <span class="number">200</span>;<span class="comment">// 猜对加分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kFalseDecreaseScore = <span class="number">-200</span>;<span class="comment">// 猜错减分</span></span><br><span class="line"><span class="built_in">NSInteger</span> <span class="keyword">const</span> kTipDecreaseScore = <span class="number">-200</span>;<span class="comment">// 亲求提示减分</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建放置答案的按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createAnswerBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 清空放置答案的按钮</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *btn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [btn removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 获取答案按钮的数量</span></span><br><span class="line">    <span class="built_in">NSInteger</span> answerBtnCount = question.answer.length;</span><br><span class="line">    <span class="comment">// 3. 创建放置答案的按钮</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerW = <span class="keyword">self</span>.answerView.bounds.size.width;<span class="comment">// 放答案的父容器宽度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> answerEdgeInset = (answerW - answerBtnCount * kBtnW - (answerBtnCount - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 放答案的父容器两侧内边距</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; answerBtnCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [[<span class="built_in">UIButton</span> alloc] init];</span><br><span class="line">        <span class="built_in">CGFloat</span> btnX = answerEdgeInset + i * i * (kBtnW + kMarginBetweenBtns);<span class="comment">// 起点水平坐标</span></span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnX, <span class="number">0</span>, kBtnW, kBtnH);<span class="comment">// 设置frame</span></span><br><span class="line">        <span class="comment">// 设置背景图片</span></span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        <span class="comment">// 设置字体颜色</span></span><br><span class="line">        [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 注册点击事件</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick:) forControlEvents:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 添加到视图中</span></span><br><span class="line">        [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-9-创建备选答案按钮"><a href="#2-7-9-创建备选答案按钮" class="headerlink" title="2.7.9    创建备选答案按钮"></a>2.7.9    创建备选答案按钮</h3><blockquote>
<p><strong>说明：</strong>当<code>点击下一题</code>或<code>程序刚启动</code>时，需要设置备选答案按钮。<br><strong>技巧：</strong>以懒加载的方式创建备选按钮，这样就不用每次都重新创建备选按钮。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮:下一题</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)nextBtnOnClick &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 5. 创建备选答案按钮</span></span><br><span class="line">    [<span class="keyword">self</span> createOptionBtns:question];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">self</span>.index = <span class="number">-1</span>;</span><br><span class="line">    [<span class="keyword">self</span> nextBtnOnClick];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置备选字按钮（懒加载）</span><br><span class="line"> *</span><br><span class="line"> *  @param question 数据模型</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)createOptionBtns:(JKQuestionInfo *)question</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 备选字总个数</span></span><br><span class="line">    <span class="keyword">int</span> optionsCount = question.options.count;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 没有备选字按钮就创建</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.optionsView.subviews.count != optionsCount) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> optionW = <span class="keyword">self</span>.optionsView.bounds.size.width;<span class="comment">// 备选字按钮父控件宽度</span></span><br><span class="line">        <span class="built_in">CGFloat</span> optionEdgeInset = (optionW - kOptionViewTotalCol * kBtnW - (kOptionViewTotalCol - <span class="number">1</span>) * kMarginBetweenBtns) * <span class="number">0.5</span>;<span class="comment">// 父控件左右内边距</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">            <span class="keyword">int</span> col = i % kOptionViewTotalCol;<span class="comment">// 所在列</span></span><br><span class="line">            <span class="keyword">int</span> row = i / kOptionViewTotalCol;<span class="comment">// 所在行</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CGFloat</span> btnX = optionEdgeInset + (kBtnW + kMarginBetweenBtns) * col;<span class="comment">// 水平坐标</span></span><br><span class="line">            <span class="built_in">CGFloat</span> btnY = kMarginBetweenBtns + (kBtnH + kMarginBetweenBtns) * row;<span class="comment">// 垂直坐标</span></span><br><span class="line">            <span class="comment">// 设置frame</span></span><br><span class="line">            btn.frame = <span class="built_in">CGRectMake</span>(btnX, btnY, kBtnW, kBtnH);</span><br><span class="line">            <span class="comment">// 设置背景图</span></span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"btn_answer_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">            <span class="comment">// 设置字颜色</span></span><br><span class="line">            [btn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            <span class="comment">// 注册点击事件</span></span><br><span class="line">            [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(optionBtnOnClick) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">            <span class="comment">// 添加到视图</span></span><br><span class="line">            [<span class="keyword">self</span>.optionsView addSubview:btn];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新备选字</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; optionsCount; i++) &#123;</span><br><span class="line">            <span class="built_in">UIButton</span> *optionBtn = <span class="keyword">self</span>.optionsView.subviews[i];</span><br><span class="line">            [optionBtn setTitle:question.options[i] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-10-答案按钮点击"><a href="#2-7-10-答案按钮点击" class="headerlink" title="2.7.10    答案按钮点击"></a>2.7.10    答案按钮点击</h3><blockquote>
<p><strong>说明：</strong> 点击组成答案的按钮，该按钮清除其文字，而相应的备选答案按钮会重新出现该文字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-11-备选按钮点击"><a href="#2-7-11-备选按钮点击" class="headerlink" title="2.7.11    备选按钮点击"></a>2.7.11    备选按钮点击</h3><blockquote>
<p><strong>说明：</strong>被点击的备选按钮会清除其文字，并将该文字写到答案按钮中。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 文字按钮的点击绑定的方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  点击答案按钮</span><br><span class="line"> *</span><br><span class="line"> *  @param answerBtn 答案按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)answerBtnOnClick:(<span class="built_in">UIButton</span> *)answerBtn</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *answerStr = answerBtn.currentTitle;</span><br><span class="line">    <span class="comment">// 按钮没有设置字</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> == answerStr) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 按钮有字(用户打算去掉选择作为答案的一个字)</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 清空按钮的字</span></span><br><span class="line">        [answerBtn setTitle:<span class="literal">nil</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        <span class="comment">// 2. 恢复optionView中隐藏的备选字按钮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([answerStr isEqualToString:optionBtn.currentTitle] &amp;&amp; optionBtn.isHidden) &#123;</span><br><span class="line">                optionBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 如果字体颜色为错误答案的颜色，则恢复为黑色</span></span><br><span class="line">        <span class="keyword">if</span> (answerBtn.currentTitleColor != kAnswerBtnTitleColor) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">                [answerBtn setTitleColor:kAnswerBtnTitleColor forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 恢复（enable）optionView的用户交互</span></span><br><span class="line">            <span class="keyword">self</span>.optionsView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-12-提示点击方法的实现"><a href="#2-7-12-提示点击方法的实现" class="headerlink" title="2.7.12    提示点击方法的实现"></a>2.7.12    提示点击方法的实现</h3><blockquote>
<p><strong>说明：</strong>提示按钮每被点击一次，答案按钮就回为答案生成一个字。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKQuestionInfo.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//----------------------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 按钮：提示</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)tipBtnOnClick &#123;</span><br><span class="line">    <span class="comment">// 1. 清空答案按钮的文字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *answerBtn <span class="keyword">in</span> <span class="keyword">self</span>.answerView.subviews) &#123;</span><br><span class="line">        [<span class="keyword">self</span> answerBtnOnClick:answerBtn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 取出实际答案中的第一个字</span></span><br><span class="line">    <span class="built_in">NSString</span> *answer = [<span class="keyword">self</span>.questions[<span class="keyword">self</span>.index] answer];</span><br><span class="line">    <span class="built_in">NSString</span> *firstWord = [answer substringToIndex:<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 3. 模拟点击optionView中第一个正确的按钮，扣分</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIButton</span> *optionBtn <span class="keyword">in</span> <span class="keyword">self</span>.optionsView.subviews) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([optionBtn.currentTitle isEqualToString:firstWord]) &#123;</span><br><span class="line">            [<span class="keyword">self</span> optionBtnOnClick:optionBtn];</span><br><span class="line">            [<span class="keyword">self</span> coinChange:kTipDecreaseScore];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-8-国家选择"><a href="#2-8-国家选择" class="headerlink" title="2.8    国家选择"></a>2.8    国家选择</h2><h3 id="2-8-1-UIPickerView与数据模型的创建"><a href="#2-8-1-UIPickerView与数据模型的创建" class="headerlink" title="2.8.1    UIPickerView与数据模型的创建"></a>2.8.1    <code>UIPickerView</code>与<code>数据模型</code>的创建</h3><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>导入素材（<code>jpg</code>格式的图片不能放在<code>Assets.xcassets</code>中管理）</li>
<li>创建自定义<code>UIView</code>类:<code>JKCountryInfo</code></li>
<li><code>ViewController</code>采纳<code>UIPickerView</code></li>
</ol>
<p><strong>注意：</strong><code>gif</code>格式的图片不能放在<code>Assets.xcassets</code>。</p>
</blockquote>
<h4 id="2-8-1-1-UIPickerView"><a href="#2-8-1-1-UIPickerView" class="headerlink" title="2.8.1.1    UIPickerView"></a>2.8.1.1    <code>UIPickerView</code></h4><blockquote>
<p><strong>说明：</strong>类似<code>TableView</code>，可以通过让普通<code>ViewControll</code>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code>实现</p>
<ol>
<li>通过拖动建立<code>PickerView</code>控件和<code>ViewController</code>类之间的关联<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.29.09.png" alt="Alt text"></li>
</ol>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-1-2-数据模型的创建"><a href="#2-8-1-2-数据模型的创建" class="headerlink" title="2.8.1.2     数据模型的创建"></a>2.8.1.2     数据模型的创建</h4><p><em>JKContryInfo.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryInfo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *name;<span class="comment">// 国家名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSString</span> *icon;<span class="comment">// 国旗（图片名）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (instancetype)initWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"><span class="comment">// 工厂方法</span></span><br><span class="line">+ (instancetype) CountryWithDict: (<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContryInfo.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryInfo</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)CountryWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-2-自定义视图完善实例"><a href="#2-8-2-自定义视图完善实例" class="headerlink" title="2.8.2    自定义视图完善实例"></a>2.8.2    自定义视图完善实例</h3><blockquote>
<p><strong>说明：</strong>自定义<code>PickerView</code>中的每一行采用的视图。</p>
</blockquote>
<h4 id="2-8-2-1-创建xib文件"><a href="#2-8-2-1-创建xib文件" class="headerlink" title="2.8.2.1    创建xib文件"></a>2.8.2.1    创建<code>xib</code>文件</h4><blockquote>
<p><strong>说明：</strong>要点如下</p>
<ol>
<li>创建的<code>xib</code>文件和要绑定的<code>UIVIew</code>的文件名要一致。</li>
</ol>
<p><strong>注意：</strong>待对应的<code>UIView</code>子类创建完毕后，手动绑定之。</p>
</blockquote>
<p><em>JKCountryFlagView.xib</em><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-12%20%E4%B8%8B%E5%8D%884.24.35.png" alt="Alt text"></p>
<h4 id="2-8-2-2-创建JKCountryFlagView类"><a href="#2-8-2-2-创建JKCountryFlagView类" class="headerlink" title="2.8.2.2    创建JKCountryFlagView类"></a>2.8.2.2    创建<code>JKCountryFlagView</code>类</h4><blockquote>
<p><strong>说明：</strong>该类用来绑定上面创建的<code>xib</code>文件。</p>
</blockquote>
<p><em>JKCountryFlagView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKCountryInfo</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKCountryFlagView</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IBOutlet 属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIImageView</span> *flag;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKCountryInfo *countryModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器(工厂方法)</span></span><br><span class="line">+ (instancetype)countryView;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类方法</span></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKCountryFlagView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKCountryFlagView</span></span></span><br><span class="line"></span><br><span class="line">+ (instancetype)countryView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[[<span class="built_in">NSBundle</span> mainBundle] loadNibNamed:<span class="string">@"JKCountryFlagView"</span> owner:<span class="keyword">self</span> options:<span class="literal">nil</span>] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setCountryModel:(JKCountryInfo *)countryModel</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_countryModel != countryModel) &#123;</span><br><span class="line">        _countryModel = countryModel;</span><br><span class="line">        <span class="keyword">self</span>.name.text = _countryModel.name;</span><br><span class="line">        <span class="keyword">self</span>.flag.image = [<span class="built_in">UIImage</span> imageNamed:_countryModel.icon];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">CGFloat</span>)rowHeight</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">54</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-8-2-3-完善ViewController"><a href="#2-8-2-3-完善ViewController" class="headerlink" title="2.8.2.3    完善ViewController"></a>2.8.2.3    完善<code>ViewController</code></h4><blockquote>
<p><strong>说明：</strong>采纳协议<code>UIPickerViewDelegate</code>和<code>UIPickerViewDataSource</code></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryInfo.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKCountryFlagView.h"</span></span></span><br><span class="line"><span class="comment">// 扩展--------------</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIPickerViewDelegate</span>, <span class="title">UIPickerViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现---------------</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  获取plist中的字典数组</span><br><span class="line"> *</span><br><span class="line"> *  @return 字典数组</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="comment">// plist文件路径</span></span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle]pathForResource:<span class="string">@"flags"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="comment">// 取出字典数组</span></span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:path];</span><br><span class="line">        <span class="comment">// 将所有数据相放入可变数组中</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *arrayM = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKCountryInfo *countryModel = [JKCountryInfo CountryWithDict:dict];</span><br><span class="line">            [arrayM addObject:countryModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [arrayM <span class="keyword">copy</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"path:%@"</span>, path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"array:%@"</span>, _dataArray);</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDataSource</span></span><br><span class="line"><span class="comment">// 决定PlickerView一共的组数（共1组）</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfComponentsInPickerView:(<span class="built_in">UIPickerView</span> *)pickerView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每组有多少条数据</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView numberOfRowsInComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIPickerViewDelegate</span></span><br><span class="line"><span class="comment">// 定义详情视图的创建过程</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView viewForRow:(<span class="built_in">NSInteger</span>)row forComponent:(<span class="built_in">NSInteger</span>)component reusingView:(<span class="built_in">UIView</span> *)view</span><br><span class="line">&#123;</span><br><span class="line">    JKCountryFlagView *countryView = (JKCountryFlagView *)view;</span><br><span class="line">    <span class="keyword">if</span> (!countryView) &#123;</span><br><span class="line">        countryView = [JKCountryFlagView countryView];</span><br><span class="line">    &#125;</span><br><span class="line">    countryView.countryModel = <span class="keyword">self</span>.dataArray[row];</span><br><span class="line">    <span class="keyword">return</span> countryView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义行高</span></span><br><span class="line">- (<span class="built_in">CGFloat</span>)pickerView:(<span class="built_in">UIPickerView</span> *)pickerView rowHeightForComponent:(<span class="built_in">NSInteger</span>)component</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [JKCountryFlagView rowHeight];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-9-图片自动播放"><a href="#2-9-图片自动播放" class="headerlink" title="2.9    图片自动播放"></a>2.9    图片自动播放</h2><h3 id="2-9-1-创建UIScrollView和UIPageControl"><a href="#2-9-1-创建UIScrollView和UIPageControl" class="headerlink" title="2.9.1    创建UIScrollView和UIPageControl"></a>2.9.1    创建<code>UIScrollView</code>和<code>UIPageControl</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><code>ViewController</code>采纳<code>UIScrollViewDelegate</code></li>
<li>创建<code>UIScrollView</code></li>
<li>创建<code>UIScrollPageControl</code></li>
</ol>
</blockquote>
<h3 id="2-9-2-定时器与代理方法调用"><a href="#2-9-2-定时器与代理方法调用" class="headerlink" title="2.9.2    定时器与代理方法调用"></a>2.9.2    定时器与代理方法调用</h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li><strong>封装一些相关的方法：</strong>清除<code>timer</code>、添加<code>timer</code>等</li>
<li><strong>遵守协议<code>UIScrollViewDelegate</code>：</strong>定义滑动前、中、后需要的操作</li>
</ol>
</blockquote>
<h3 id="2-9-3-代码摘要"><a href="#2-9-3-代码摘要" class="headerlink" title="2.9.3    代码摘要"></a>2.9.3    代码摘要</h3><p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height// 屏幕高度</span></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width// 屏幕高度</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> kImgCount = <span class="number">10</span>;<span class="comment">// 图片总数</span></span><br><span class="line"><span class="built_in">CGFloat</span> scrollY = <span class="number">20</span>;<span class="comment">// 上边距</span></span><br><span class="line"><span class="built_in">CGFloat</span> pageCtrlWidth = <span class="number">200</span>;<span class="comment">// 滚动指示器宽度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//--------- 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UIScrollViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIPageControl</span> *pageCtrl;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------- 实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initScrollView];</span><br><span class="line">    [<span class="keyword">self</span> initPageControl];</span><br><span class="line">    [<span class="keyword">self</span> addTimer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIScrollView</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initScrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView = [[<span class="built_in">UIScrollView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">    <span class="comment">// 设置代理对象</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 初始化所有滚动的屏的内容</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kImgCount; i++) &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span> *imgview = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(kScreenWidth * i, scrollY, kScreenWidth, kScreenHeight - scrollY)];</span><br><span class="line">        imgview.image = [<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"huoying%d"</span>, i + <span class="number">1</span>]];</span><br><span class="line">        [<span class="keyword">self</span>.scrollView addSubview:imgview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置 UIScrollView</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(kScreenWidth * kImgCount, kScreenHeight - scrollY);</span><br><span class="line">    <span class="keyword">self</span>.scrollView.pagingEnabled = <span class="literal">YES</span>;<span class="comment">// 使滚动操作停止在恰当的位置</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  创建并初始化 UIPageControl</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPageControl</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl = [[<span class="built_in">UIPageControl</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>((kScreenWidth - pageCtrlWidth) / <span class="number">2</span>, kScreenHeight - scrollY, pageCtrlWidth, scrollY)];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.numberOfPages = kImgCount;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.pageIndicatorTintColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPageIndicatorTintColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span>.view insertSubview:<span class="keyword">self</span>.pageCtrl aboveSubview:<span class="keyword">self</span>.scrollView];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  自动滚动到下一屏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)nextPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = <span class="keyword">self</span>.pageCtrl.currentPage;</span><br><span class="line">    page++;</span><br><span class="line">    <span class="keyword">if</span> (page == kImgCount) &#123;</span><br><span class="line">        page = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">CGPoint</span> point = <span class="built_in">CGPointMake</span>(kScreenWidth * page, <span class="number">0</span>);</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:point animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addTimer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 timer (interval)</span></span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">2.0</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(nextPage) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  清除延时反复</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)removeTimer</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma  mark -UIScrollViewDelegae</span></span><br><span class="line"><span class="comment">// 滑动前：清除计时器</span></span><br><span class="line">- (<span class="keyword">void</span>) scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> removeTimer];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"BeginDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动中：更改指示器</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> page = scrollView.contentOffset.x / kScreenWidth + <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.pageCtrl.currentPage = page;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 滑动后：开始下一次互动倒计时</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 2秒钟后重新开始自动滚屏</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="keyword">self</span> addTimer];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"EndDragging"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-10-QQ列表展示"><a href="#2-10-QQ列表展示" class="headerlink" title="2.10    QQ列表展示"></a>2.10    QQ列表展示</h2><blockquote>
<p><strong>说明：</strong>该项目使用<code>MVC</code>模式。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_qq.gif" alt="Alt text|200x400"><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-16%20%E4%B8%8A%E5%8D%889.34.22.png" alt="Alt text|400x300"></p>
<p><strong>注意：</strong><code>Xcode</code>工程中的文件夹有两种：<code>黄色</code>的为辅助进行代码管理的“伪文件夹”，<code>蓝色</code>的为真正的文件夹。</p>
</blockquote>
<h3 id="2-10-1-模型搭建"><a href="#2-10-1-模型搭建" class="headerlink" title="2.10.1    模型搭建"></a>2.10.1    模型搭建</h3><blockquote>
<p><strong>说明：</strong>需要两个数据模型，<code>JKGroupModel</code>（好友所在分组）和<code>JKFriendsModel</code>（好友）</p>
<ol>
<li>导入<code>plist</code></li>
<li>创建数据模型</li>
</ol>
</blockquote>
<h4 id="2-10-1-1-JKGroupModel"><a href="#2-10-1-1-JKGroupModel" class="headerlink" title="2.10.1.1    JKGroupModel"></a>2.10.1.1    <code>JKGroupModel</code></h4><blockquote>
<p><strong>说明：</strong>好友分组的数据模型</p>
</blockquote>
<p><em>JKGroupModel</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKGroupModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKGroupModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> <span class="keyword">self</span>.friends) &#123;</span><br><span class="line">            JKFriendsModel *model = [JKFriendsModel friendWithDict:dict];</span><br><span class="line">            [muArray addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.friends = muArray;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)GroupWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-1-2-JKFriendsModel"><a href="#2-10-1-2-JKFriendsModel" class="headerlink" title="2.10.1.2    JKFriendsModel"></a>2.10.1.2    <code>JKFriendsModel</code></h4><blockquote>
<p><strong>说明：</strong>好友的数据模型。</p>
</blockquote>
<p><em>JKFriendsModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKFriendsModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *icon;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)<span class="built_in">NSString</span> *intro;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isVip;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKFriendsModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKFriendsModel</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValuesForKeysWithDictionary:dict];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)friendWithDict:(<span class="built_in">NSDictionary</span> *)dict</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithDict:dict];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-2-创建UITableView"><a href="#2-10-2-创建UITableView" class="headerlink" title="2.10.2    创建UITableView"></a>2.10.2    创建<code>UITableView</code></h3><blockquote>
<p><strong>说明：</strong>要点</p>
<ol>
<li>在<code>AppDelegate</code>中创建二级导航（通过<code>UINavigationController</code>）</li>
<li>在<code>ListTableViewController</code>完善<code>TableView</code></li>
</ol>
</blockquote>
<p><em>Model/AppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    <span class="comment">// 创建 window</span></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建 TableViewController</span></span><br><span class="line">    ListTableViewController *listVC = [[ListTableViewController alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建 UINavigationController(需要指定导航控制器控制的是那个控制器)</span></span><br><span class="line">    <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc] initWithRootViewController:listVC];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将导航控制器设置为 window 的 rootViewController（这就是所谓的二级视图）</span></span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = navCtrl;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];<span class="comment">// 将该window置顶并显示出来</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Model/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-3-自定义头视图"><a href="#2-10-3-自定义头视图" class="headerlink" title="2.10.3    自定义头视图"></a>2.10.3    自定义头视图</h3><blockquote>
<p><strong>说明：</strong><code>MVC</code>的<code>View</code>部分</p>
<ul>
<li>不创建<code>xib</code>文件</li>
<li>完全通过代码创建视图</li>
<li>继承<code>UITableViewHeaderFooterView</code></li>
</ul>
<p><strong>注意：</strong>如果头视图被自定义了，则需要在<code>viewDidLoad</code>中重新设置其高度。</p>
</blockquote>
<h4 id="2-10-3-1-View部分"><a href="#2-10-3-1-View部分" class="headerlink" title="2.10.3.1    View部分"></a>2.10.3.1    <code>View</code>部分</h4><p><em>View/HeaderView.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 协议（为代理对象定义协议）</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">HeaderViewDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------ 接口</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeaderView</span> : <span class="title">UITableViewHeaderFooterView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;HeaderViewDelegate&gt;delegate;<span class="comment">// 代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKGroupModel *groupModel;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>View/HeadView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *_arrowBtn;<span class="comment">// 三角按钮（展开和关闭）</span></span><br><span class="line">    <span class="built_in">UILabel</span> *_label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)headerView:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"header"</span>;</span><br><span class="line">    <span class="comment">// 尝试获取该 UITableViewHeaderFooterView</span></span><br><span class="line">    HeaderView *header = [tableView dequeueReusableHeaderFooterViewWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!header) &#123;</span><br><span class="line">        header = [[HeaderView alloc] initWithReuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        <span class="comment">// 初始化_arrowBtn(带三角的按钮)</span></span><br><span class="line">        <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg"</span>] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 北京图片</span></span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header_bg_highlighted"</span>] forState:<span class="built_in">UIControlStateHighlighted</span>];</span><br><span class="line">        [button setImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"arrow"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [button setTitleColor:[<span class="built_in">UIColor</span> blackColor] forState:<span class="built_in">UIControlStateNormal</span>];<span class="comment">// 标题</span></span><br><span class="line">        button.contentEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 整体内边距</span></span><br><span class="line">        button.contentHorizontalAlignment = <span class="built_in">UIControlContentHorizontalAlignmentLeft</span>;<span class="comment">// 左对齐</span></span><br><span class="line">        button.titleEdgeInsets = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">// 文字部分的内边距</span></span><br><span class="line">        button.imageView.contentMode = <span class="built_in">UIViewContentModeCenter</span>;</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        button.imageView.clipsToBounds = <span class="literal">NO</span>;</span><br><span class="line">        _arrowBtn = button;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_arrowBtn];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化_label</span></span><br><span class="line">        <span class="built_in">UILabel</span> *labelRight = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        labelRight.textAlignment = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        _label = labelRight;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_label];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写布局方法:为_arrowBtn和_label设置布局</span></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    _arrowBtn.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    _label.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.frame.size.width - <span class="number">70</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">- (<span class="keyword">void</span>)setGroupModel:(JKGroupModel *)groupModel</span><br><span class="line">&#123;</span><br><span class="line">    _groupModel = groupModel;</span><br><span class="line">    [_arrowBtn setTitle:_groupModel.name forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    _label.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/%lu"</span>, _groupModel.online, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)_groupModel.friends.count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - buttonAction</span></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-10-3-2-Controller部分"><a href="#2-10-3-2-Controller部分" class="headerlink" title="2.10.3.2    Controller部分"></a>2.10.3.2    <code>Controller</code>部分</h4><blockquote>
<p><strong>说明：</strong>整个qq列表实际上是一个<code>UITableView</code></p>
</blockquote>
<p><em>Controller/ListTableViewController</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ListTableViewController</span> ()&lt;<span class="title">HeaderViewDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *dataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 懒加载</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)dataArray</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dataArray) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"friends"</span> ofType:<span class="string">@"plist"</span>];</span><br><span class="line">        <span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithContentsOfFile: path];</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *muArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:array.count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</span><br><span class="line">            JKGroupModel *groupModel = [JKGroupModel GroupWithDict:dict];</span><br><span class="line">            [muArray addObject:groupModel];</span><br><span class="line">        &#125;</span><br><span class="line">        _dataArray = [muArray <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dataArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 自定义的透视图需要重新定义高度</span></span><br><span class="line">    <span class="keyword">self</span>.tableView.sectionHeaderHeight = <span class="number">40</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line"><span class="comment">// num of section</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num of cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    JKGroupModel *groupModel =  <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="built_in">NSInteger</span> count = groupModel.isOpen ? groupModel.friends.count : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建 cell</span></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *identifier = <span class="string">@"friendCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:identifier];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleSubtitle</span> reuseIdentifier:identifier];</span><br><span class="line">    &#125;</span><br><span class="line">    JKGroupModel *groupModel = <span class="keyword">self</span>.dataArray[indexPath.section];</span><br><span class="line">    JKFriendsModel *friendModel = groupModel.friends[indexPath.row];</span><br><span class="line">    cell.imageView.image = [<span class="built_in">UIImage</span> imageNamed:friendModel.icon];</span><br><span class="line">    cell.textLabel.text = friendModel.name;</span><br><span class="line">    cell.detailTextLabel.text = friendModel.intro;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UITableView delagate</span></span><br><span class="line"><span class="comment">// 添加自定义的头视图：初始化TableView中每个section中的header部分</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    HeaderView *header = [HeaderView headerView:tableView];</span><br><span class="line">    header.delegate = <span class="keyword">self</span>;<span class="comment">// 将自身作为代理对象</span></span><br><span class="line">    header.groupModel = <span class="keyword">self</span>.dataArray[section];</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-4-点击效果的实现"><a href="#2-10-4-点击效果的实现" class="headerlink" title="2.10.4    点击效果的实现"></a>2.10.4    点击效果的实现</h3><blockquote>
<p><strong>说明：</strong></p>
<ol>
<li>点击群组栏（<code>HeaderView</code>，继承自<code>UITableViewHeaderFooterView</code>）中的按钮</li>
</ol>
<ul>
<li>展开群组</li>
<li>三角按钮变化</li>
</ul>
<ol>
<li>点击好友（<code>cell</code>），push到一个空界面</li>
</ol>
</blockquote>
<p><em>View/HeaderView.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeaderView</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 UITableViewHeaderFooterView 的构造器</span></span><br><span class="line">- (instancetype)initWithReuseIdentifier:(<span class="built_in">NSString</span> *)reuseIdentifier</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithReuseIdentifier:reuseIdentifier]) &#123;</span><br><span class="line">        ...</span><br><span class="line">        [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(buttonAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];<span class="comment">// 注册点击事件</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展开或关闭组</span></span><br><span class="line">- (<span class="keyword">void</span>)buttonAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.groupModel.isOpen = !<span class="keyword">self</span>.groupModel.isOpen;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(clickView)]) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.delegate clickView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父视图发生变化时被调用（不知为什么并没有被调用）</span></span><br><span class="line">- (<span class="keyword">void</span>)didMoveToSuperview</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 三角符号旋转180度</span></span><br><span class="line">    _arrowBtn.imageView.transform = <span class="keyword">self</span>.groupModel.isOpen ? <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_2) : <span class="built_in">CGAffineTransformMakeRotation</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Controller/ListTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ListTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKGroupModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKFriendsModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HeaderView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ListTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">self</span> clipExtraCellLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cell被点击（选中进入）时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 通过导航控制器进入一个新的 ViewController</span></span><br><span class="line">    ViewController *viewCtrl = [[ViewController alloc] init];</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewCtrl animated:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - HeadViewDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)clickView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的cell的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clipExtraCellLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc] init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-11-三级控制器"><a href="#2-11-三级控制器" class="headerlink" title="2.11    三级控制器"></a>2.11    三级控制器</h2><blockquote>
<p><strong>说明：</strong>项目截图<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.09.10.png" alt="Alt text|200x350"></p>
<p><strong>API：</strong><code>三级控制器</code>的实现使用到的<code>UIKit</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UITabViewController</code>相关成员</th>
<th>原型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>viewControllers</td>
<td><code>@property(nonatomic, copy) NSArray&lt;__kindof UIViewController *&gt; *viewControllers</code></td>
<td>存储着tab视图管理的所有二级控制器实例</td>
</tr>
<tr>
<td>selectedIndex</td>
<td><code>@property(nonatomic) NSUInteger selectedIndex</code></td>
<td>当前被选中的tab item的下标，修改该值会导致视图的切换</td>
</tr>
</tbody>
</table>
<h3 id="2-11-1-初始化视图控制器"><a href="#2-11-1-初始化视图控制器" class="headerlink" title="2.11.1    初始化视图控制器"></a>2.11.1    初始化视图控制器</h3><blockquote>
<p><strong>说明：</strong>本课时讲解<code>三级控制器</code>的结构，自定义视图控制器并初始化学习用新语法创建数组并赋值。用<code>导航控制器</code>构建<code>二级控制器</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%887.06.44.png" alt="Alt text|450x250"></p>
</blockquote>
<p><em>AppDelegate.m</em></p>
<blockquote>
<p><strong>说明：</strong>使用新的<code>window</code>替换掉项目创建时默认的<code>window</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</span><br><span class="line">    <span class="keyword">self</span>.window.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line">    RootViewController *rootVC = [[RootViewController alloc] init];</span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = rootVC;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"><span class="comment">// 初始化所有第二级控制器</span></span><br><span class="line">- (<span class="keyword">void</span>)initViewController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化视图控制器</span></span><br><span class="line">    ProfileViewController *profileVC = [[ProfileViewController alloc]init];</span><br><span class="line">    MessageViewController *messageVC = [[MessageViewController alloc]init];</span><br><span class="line">    ColaViewController *colaVC = [[ColaViewController alloc]init];</span><br><span class="line">    UserViewController *userVC = [[UserViewController alloc]init];</span><br><span class="line">    MoreViewController *moreVC = [[MoreViewController alloc]init];</span><br><span class="line">    <span class="comment">// 封装到数组中</span></span><br><span class="line">    <span class="built_in">NSArray</span> *vcArr = @[profileVC, messageVC, colaVC, userVC, moreVC];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *tabArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:vcArr.count];</span><br><span class="line">    <span class="comment">// 为每个视图控制器创建对应的导航控制器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vcArr.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UINavigationController</span> *navCtrl = [[<span class="built_in">UINavigationController</span> alloc]initWithRootViewController:vcArr[i]];<span class="comment">// 创建导航视图器时为其绑定对应的视图控制器</span></span><br><span class="line">        [tabArray addObject:navCtrl];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将初始化好的存储导航控制器的数组作为一个属性赋值给第一级控制器</span></span><br><span class="line">    <span class="keyword">self</span>.viewControllers = tabArray;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-2-自定义标签工具栏"><a href="#2-11-2-自定义标签工具栏" class="headerlink" title="2.11.2    自定义标签工具栏"></a>2.11.2    自定义标签工具栏</h3><blockquote>
<p><strong>说明：</strong>本课时讲解隐藏系统自带<code>标签工具栏</code>样式，并自定义按钮和视图，根据系统的<code>标签工具栏</code>的属性实现切换。</p>
</blockquote>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line">...</span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> btnHeight = <span class="number">45</span>;<span class="comment">// 标签工具栏中按钮的高度</span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 初始化标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)initTabBarView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图</span></span><br><span class="line">    _tabBarView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, kScreenHeight - tabViewHeight, kScreenWidth, tabViewHeight)];</span><br><span class="line">    _tabBarView.backgroundColor = [<span class="built_in">UIColor</span> colorWithPatternImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mask_navbar"</span>]];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_tabBarView];</span><br><span class="line">    <span class="comment">// 初始化 标签工具栏视图 中的按钮</span></span><br><span class="line">    <span class="built_in">NSArray</span> *imgArray = @[<span class="string">@"home_tab_icon_1"</span>, <span class="string">@"home_tab_icon_2"</span>, <span class="string">@"home_tab_icon_3"</span>, <span class="string">@"home_tab_icon_4"</span>, <span class="string">@"home_tab_icon_5"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i; i &lt; imgArray.count; i++) &#123;</span><br><span class="line">        <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [btn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:imgArray[i]] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        btn.frame = <span class="built_in">CGRectMake</span>(btnWidth * i, (tabViewHeight - btnHeight) / <span class="number">2</span>, btnWidth, btnHeight);</span><br><span class="line">        btn.tag = <span class="number">100</span> + i;<span class="comment">// 用来识别点击哪些按钮进行的tab切换（100以内的tag有特殊用途）</span></span><br><span class="line">        [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(btnAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span>.tabBarView addSubview:btn];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化当前被选中的tab按钮上展现的视图（倒三角）</span></span><br><span class="line">    _selectView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, btnWidth, btnHeight)];</span><br><span class="line">    _selectView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"home_bottom_tab_arrow"</span>];</span><br><span class="line">    [_tabBarView addSubview:_selectView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - tab按钮被点击时的处理函数</span></span><br><span class="line">- (<span class="keyword">void</span>)btnAction:(<span class="built_in">UIButton</span> *)button</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 切换视图（根据tag值获取当前索引）</span></span><br><span class="line">    <span class="keyword">self</span>.selectedIndex = button.tag - <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// 将倒三角移动到被选中的tab按钮上，移动动画持续时间为0.2秒</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        _selectView.center = button.center;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">self</span>.tabBar.hidden = <span class="literal">YES</span>;<span class="comment">// 隐藏 UITabViewController 自带的tab bar</span></span><br><span class="line">    [<span class="keyword">self</span> initTabBarView];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-11-3-页面跳转的两种方式"><a href="#2-11-3-页面跳转的两种方式" class="headerlink" title="2.11.3    页面跳转的两种方式"></a>2.11.3    页面跳转的两种方式</h3><blockquote>
<p><strong>说明：</strong>本课时讲解页面两种跳转方式。通过<code>导航控制器</code>实现 <code>push</code> 和通过<code>视图控制器</code>实现模态视图。并讲解 <code>iOS8</code> 中新的方法。</p>
<ul>
<li>从<code>三级控制器</code> <code>push</code>出其它页面需要隐藏<code>标签工具栏</code>，<code>pop</code>回来后需要展现<code>标签工具栏</code></li>
</ul>
</blockquote>
<h4 id="2-11-3-1-RootViewController"><a href="#2-11-3-1-RootViewController" class="headerlink" title="2.11.3.1    RootViewController"></a>2.11.3.1    RootViewController</h4><blockquote>
<p><strong>说明：</strong>在<code>标签控制器</code>中定义<code>标签工具栏</code>的显示／隐藏方法</p>
</blockquote>
<p><em>RootViewController.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> : <span class="title">UITabBarController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *tabBarView;<span class="comment">// 标签工具栏</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示或隐藏标签工具栏</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>RootViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MessageViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ColaViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"UserViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MoreViewController.h"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RootViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *selectView;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RootViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  显示／隐藏tab工具栏</span><br><span class="line"> *</span><br><span class="line"> *  @param show YES: 显示, NO: 隐藏</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)showTabBar:(<span class="built_in">BOOL</span>)show</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.tabBarView.frame;</span><br><span class="line">    <span class="comment">// 更新frame</span></span><br><span class="line">    <span class="keyword">if</span> (show) &#123;</span><br><span class="line">        frame.origin.x = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        frame.origin.x = -kScreenWidth;<span class="comment">// 隐藏tab bar：将tab bar移除屏幕</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重新赋值tabBarView的frame</span></span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.2</span> animations:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.tabBarView.frame = frame;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-2-ProfileViewController"><a href="#2-11-3-2-ProfileViewController" class="headerlink" title="2.11.3.2    ProfileViewController"></a>2.11.3.2    ProfileViewController</h4><blockquote>
<p><strong>说明：</strong><code>首页</code>中通过两种方式跳转。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ProfileViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"RootViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonWidth = <span class="number">33</span>;<span class="comment">// 导航栏按钮宽度</span></span><br><span class="line"><span class="built_in">CGFloat</span> <span class="keyword">const</span> writeButtonHeight = <span class="number">32</span>;<span class="comment">// 导航栏按钮高度</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProfileViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ProfileViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.title = <span class="string">@"首页"</span>;</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> yellowColor];</span><br><span class="line">    [<span class="keyword">self</span> initNavButton];</span><br><span class="line">    [<span class="keyword">self</span> initPushButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义导航栏按钮</span></span><br><span class="line">- (<span class="keyword">void</span>)initNavButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 UIButton</span></span><br><span class="line">    <span class="built_in">UIButton</span> *writeBtn =  [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">    writeBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, writeButtonWidth, writeButtonHeight);</span><br><span class="line">    [writeBtn setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"write"</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [writeBtn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(presentAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 封装为 UIBarButtonItem</span></span><br><span class="line">    <span class="built_in">UIBarButtonItem</span> *item = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithCustomView:writeBtn];</span><br><span class="line">    <span class="comment">// 添加到导航栏</span></span><br><span class="line">    <span class="keyword">self</span>.navigationItem.rightBarButtonItem = item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  初始化 push 页面的按钮</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initPushButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *pushButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    pushButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [pushButton setTitle:<span class="string">@"Push"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    [pushButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pushAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:pushButton];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用push的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pushAction</span><br><span class="line">&#123;</span><br><span class="line">    PushViewController *pushVC = [[PushViewController alloc] init];</span><br><span class="line">    <span class="comment">// 通过和当前的视图控制器绑定的导航控制器完成页面的 push</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:pushVC animated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 隐藏首页的tab bar</span></span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">NO</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  使用模态的方式展现新视图</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)presentAction</span><br><span class="line">&#123;</span><br><span class="line">    ModalViewController *modalVC = [[ModalViewController alloc] init];</span><br><span class="line">    <span class="comment">// 使用模态视图</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:modalVC animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// 展现首页前显示tab bar</span></span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">    RootViewController *rootVC = (RootViewController *)<span class="keyword">self</span>.tabBarController;</span><br><span class="line">    [rootVC showTabBar:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-3-PushViewController"><a href="#2-11-3-3-PushViewController" class="headerlink" title="2.11.3.3    PushViewController"></a>2.11.3.3    PushViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>push</code>跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"PushViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PushViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PushViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建回退（pop）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *popButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    popButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="comment">// 设置文本（使用了setTitle就不能setImage了）</span></span><br><span class="line">    [popButton setTitle:<span class="string">@"Pop"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    [popButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(popAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:popButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  回退(pop)到堆栈中的上一个视图(首页)</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)popAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-11-3-4-ModalViewController"><a href="#2-11-3-4-ModalViewController" class="headerlink" title="2.11.3.4    ModalViewController"></a>2.11.3.4    ModalViewController</h4><blockquote>
<p><strong>说明：</strong>作为<code>dismiss</code>方式跳转方式的目的地视图</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ModalViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ModalViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ModalViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">    <span class="comment">// 创建回退（dismisss）按钮</span></span><br><span class="line">    <span class="built_in">UIButton</span> *dismissButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</span><br><span class="line">    dismissButton.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">40</span>);</span><br><span class="line">    [dismissButton setTitle:<span class="string">@"Dismiss"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="comment">// 注册点击事件</span></span><br><span class="line">    [dismissButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(dismissAction) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:dismissButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 回退页面</span></span><br><span class="line">- (<span class="keyword">void</span>)dismissAction</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-12-通讯录"><a href="#2-12-通讯录" class="headerlink" title="2.12    通讯录"></a>2.12    通讯录</h2><blockquote>
<p><strong>说明：</strong>本课实现模拟通讯录的登陆、添加、删除、修改的功能，涉及到第三方类库的使用，数据存储并加深理解代理和 <code>UITableView</code>。</p>
<ol>
<li><code>Storyboard</code>中设置页面跳转</li>
<li>第三方类库<code>MBProgressHUD</code></li>
<li>数据存储</li>
<li><code>UITableView</code>的深入理解</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_contact.gif" alt="Alt text|200x350"></p>
</blockquote>
<h3 id="2-12-1-Storyboard实现布局和跳转"><a href="#2-12-1-Storyboard实现布局和跳转" class="headerlink" title="2.12.1    Storyboard实现布局和跳转"></a>2.12.1    <code>Storyboard</code>实现布局和跳转</h3><blockquote>
<p><strong>说明：</strong>本课时讲解创建自定义视图控制器并通过 <code>storyboard</code> 来布局页面，学习手动跳转的方法。</p>
</blockquote>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><hr>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>becomeFirstResponder</code></td>
<td>实例方法</td>
<td>使文本输入框自动获取焦点，呼出键盘，类似<code>html</code>中的<code>autofocus</code></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><code>UITextField</code>成员</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>``</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="2-12-1-1-布局"><a href="#2-12-1-1-布局" class="headerlink" title="2.12.1.1    布局"></a>2.12.1.1    布局</h4><p><strong>1. 建立<code>Navigaton Controller</code>和<code>LoginViewController</code>之间的关联</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-21%20%E4%B8%8B%E5%8D%8810.17.31.png" alt="Alt text"><br><strong>2. <code>LoginViewController</code>跳转到<code>ContactTableViewController</code></strong></p>
<blockquote>
<p>采用<code>iOS8</code>后的新的<code>show</code>替代<code>push</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_show.gif" alt="Alt text"><br><strong>3. 自定义<code>ContactTableViewController</code>的导航栏</strong></p>
<ul>
<li>自定义导航栏需要添加<code>Navigation Item</code>控件</li>
<li><code>Navigation Item</code>内的按钮要使用<code>Button Item</code>控件</li>
<li>按钮中使用系统图标(<code>System Icon</code>)<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8A%E5%8D%8812.23.35.png" alt="Alt text"></li>
</ul>
</blockquote>
<h4 id="2-12-1-2-跳转"><a href="#2-12-1-2-跳转" class="headerlink" title="2.12.1.2    跳转"></a>2.12.1.2    跳转</h4><blockquote>
<ul>
<li>使用<code>NSNotificationCenter</code>监控文本的变化</li>
<li>使用在<code>Storyboard</code>中为视图之间建立的<code>连接</code>的<code>identifier</code>访问<code>连接</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"LoginViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LoginViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *pwdField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UISwitch</span> *rembField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *loginBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.pwdField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// In a storyboard-based application, you will often want to do a little preparation before navigation</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  跳转之前之行</span><br><span class="line"> *</span><br><span class="line"> *  @param segue 跳转的信息</span><br><span class="line"> *  @param sender 和performSegueWithIdentifier方法传入的sender是同一个</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// Get the new view controller using [segue destinationViewController].</span></span><br><span class="line">    <span class="comment">// Pass the selected object to the new view controller.</span></span><br><span class="line">    <span class="comment">// 1. 获取跳转目的地视图的控制器</span></span><br><span class="line">    <span class="built_in">UIViewController</span> *contactVC = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 2. 设置标题（传值）</span></span><br><span class="line">    contactVC.title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@的联系人列表"</span>, <span class="keyword">self</span>.nameField.text];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.loginBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.pwdField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-2-UIAlertController与添加页面布局"><a href="#2-12-2-UIAlertController与添加页面布局" class="headerlink" title="2.12.2    UIAlertController与添加页面布局"></a>2.12.2    <code>UIAlertController</code>与添加页面布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>iOS8</code> 中新控制器 <code>UIAlertController</code> 的使用，并通过 <code>storyboard</code> 布局添加联系人页面，用第三方类库 <a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> 实现网络加载进程的效果。</p>
</blockquote>
<p><strong>1. 登录过程中使用<code>MBProgressHUD</code>实现提示窗</strong><br><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.nameField.text isEqualToString:<span class="string">@"jike"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"账号不存在"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span>.pwdField.text isEqualToString:<span class="string">@"qq"</span>]) &#123;</span><br><span class="line">        [MBProgressHUD showError:<span class="string">@"密码错误"</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [MBProgressHUD showMessage:<span class="string">@"努力加载中"</span>];</span><br><span class="line">    <span class="comment">// 2秒后（模拟网络请求）跳转</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="comment">// 移除蒙板弹窗</span></span><br><span class="line">        [MBProgressHUD hideHUD];</span><br><span class="line">        [<span class="keyword">self</span> performSegueWithIdentifier:<span class="string">@"LoginToContact"</span> sender:<span class="literal">nil</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 在<code>联系人列表界面</code>中点击<code>添加按钮</code>跳转到<code>添加页面</code></strong><br><img src="./show2.gif" alt="Alt text|200x200"></p>
<p><strong>3. 在<code>联系人列表界面</code>中点击注销按钮，注销登陆</strong></p>
<blockquote>
<p><code>UIAlertController</code>：<code>iOS8</code>之后出现的，用来弹出提示窗，取代了<code>UIAcionSheet</code>和<code>UIAlertView</code>。</p>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 初始化 UIAlertController,使用 actionSheet 样式</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"是否注销?"</span> message:<span class="string">@"真的要注销吗？"</span> preferredStyle:<span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">    <span class="comment">// 添加取消按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span> style:<span class="built_in">UIAlertActionStyleCancel</span> handler:<span class="literal">nil</span>]];</span><br><span class="line">    <span class="comment">// 添加确定按钮（并绑定事件）</span></span><br><span class="line">    [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"确定"</span> style:<span class="built_in">UIAlertActionStyleDestructive</span> handler:^(<span class="built_in">UIAlertAction</span> *action) &#123;</span><br><span class="line">        <span class="comment">// pop掉适当前的视图控制器</span></span><br><span class="line">        [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;]];</span><br><span class="line">    <span class="comment">// 弹出这个控制器</span></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 为<code>登陆界面</code>的输入框增加清空按钮</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.43.58.png" alt="Alt text"></p>
<p><strong>5. 为<code>登陆界面</code>的密码输入框设置安全输入</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-22%20%E4%B8%8B%E5%8D%888.44.32.png" alt="Alt text"></p>
<p><strong>6. 初始化<code>联系人列表界面</code>中的联系人</strong></p>
<blockquote>
<ul>
<li>添加属性<code>contactArr</code></li>
<li>在<code>Storyboard</code>中为<code>联系人cell</code>设置<code>identifier</code>，并设置其<code>Style</code>为<code>Right Style</code></li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Table view data source</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.contactArr.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"contactPeopleCell"</span> forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Configure the cell...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-3-添加功能与传值"><a href="#2-12-3-添加功能与传值" class="headerlink" title="2.12.3    添加功能与传值"></a>2.12.3    添加功能与传值</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现添加功能，添加联系人信息后通过代理传递数据到上一层视图控制器。用 <code>storyboard</code> 布局编辑页面。</p>
</blockquote>
<p><strong>1. 创建<code>JKContactModel</code>数据模型</strong></p>
<blockquote>
<p>该数据模型能够<code>序列化</code>和<code>反序列化</code></p>
</blockquote>
<p><em>JKContactModel.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKContactModel</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *phone;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKContactModel.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKContactModel</span></span></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)encoder &#123;</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.name forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [encoder encodeObject:<span class="keyword">self</span>.phone forKey:<span class="string">@"phone"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)decoder &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"phone"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>2. 定义具备添加功能（传值）的代理协议，并使用代理对象实现添加功能</strong></p>
<blockquote>
<ul>
<li>让姓名文本框自动获取光标，弹出虚拟键盘</li>
</ul>
</blockquote>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">AddViewController</span>, <span class="title">JKContactModel</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义处理添加工作的代理协议</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AddViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>)<span class="keyword">id</span>&lt;AddViewControllerDelegate&gt; delegate;<span class="comment">// 代理对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AddViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AddViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *addBtn;</span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction;</span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AddViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view.</span></span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="comment">// 让性命文本框 autofocus</span></span><br><span class="line">    [<span class="keyword">self</span>.nameField becomeFirstResponder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)addAction &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通过代理对象传值</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(addContact:didAddContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 创建数据模型</span></span><br><span class="line">        JKContactModel *contactModel = [[JKContactModel alloc] init];</span><br><span class="line">        contactModel.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        contactModel.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理对象将数据添加到 联系人列表视图的数组中</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate addContact:<span class="keyword">self</span> didAddContact:contactModel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)backAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.addBtn.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>联系人列表视图</code>中接受数据并增加一条联系人信息<blockquote>
<ul>
<li>去掉多余的 table 中多余的线</li>
<li>在cell右侧添加箭头</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *contactArr;<span class="comment">// 联系人数组</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginOut:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> clearExtraLine:<span class="keyword">self</span>.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - 去掉多余的线</span></span><br><span class="line">- (<span class="keyword">void</span>)clearExtraLine:(<span class="built_in">UITableView</span> *)tableView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIView</span> *view = [[<span class="built_in">UIView</span> alloc]init];</span><br><span class="line">    view.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    [<span class="keyword">self</span>.tableView setTableFooterView:view];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    AddViewController *addVc = vc;</span><br><span class="line">    addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>4. 设置键盘类型</strong><br><img src="./屏幕快照 2016-03-23 10.14.46.png" alt="Alt text"></p>
<h3 id="2-12-4-编辑页面功能完善"><a href="#2-12-4-编辑页面功能完善" class="headerlink" title="2.12.4    编辑页面功能完善"></a>2.12.4    编辑页面功能完善</h3><blockquote>
<p><strong>说明：</strong>本课时讲解实现编辑页面的功能，点击编辑修改响应的按钮和文本框状态，并通过代理方法传值。</p>
</blockquote>
<p><strong>1. 在<code>Storyboard</code>中创建并初始化编辑页面的布局</strong></p>
<blockquote>
<ul>
<li>为cell建立<code>selection segue</code><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_section.gif" alt="Alt text|200x200"></li>
<li>设置按钮默认隐藏<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-23%2010.35.09.png" alt="Alt text|350x200"></li>
<li>设置<code>编辑界面</code>的输入框默认不可点击</li>
</ul>
</blockquote>
<p><strong>2. 完善<code>EditViewController</code></strong></p>
<blockquote>
<ul>
<li>初始化界面数据</li>
<li>定义编辑界面的代理协议</li>
<li>实现编辑action</li>
<li>实现保存action</li>
</ul>
</blockquote>
<p>“<em>Controller/EditViewController.h”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">JKContactModel</span>, <span class="title">EditViewController</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">EditViewControllerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc ddidSavaContact: (JKContactModel *)model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="keyword">id</span>&lt;EditViewControllerDelegate&gt;delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) JKContactModel *contactMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>“<em>Controller/EditViewController.m”</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">EditViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *phoneField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIButton</span> *saveBtn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UIBarButtonItem</span> *edit;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender;</span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">EditViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// 通过数据模型初始化页面数据</span></span><br><span class="line">    <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">    <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加观察者:姓名输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.nameField];</span><br><span class="line">    <span class="comment">// 添加观察者:密码输入框内容发生改变时调用 textChange 方法</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textChange) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="keyword">self</span>.phoneField];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)saveAction:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// 1. 关闭当前页面</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">// 2. 通知代理</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(editViewController:didSavaContact:)]) &#123;</span><br><span class="line">        <span class="comment">// 更新编辑界面的显示</span></span><br><span class="line">        <span class="keyword">self</span>.contactMode.name = <span class="keyword">self</span>.nameField.text;</span><br><span class="line">        <span class="keyword">self</span>.contactMode.phone = <span class="keyword">self</span>.phoneField.text;</span><br><span class="line">        <span class="comment">// 通过代理更新联系人列表界面的显示</span></span><br><span class="line">        [<span class="keyword">self</span>.delegate editViewController:<span class="keyword">self</span> didSavaContact:<span class="keyword">self</span>.contactMode];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)editAction:(<span class="built_in">UIBarButtonItem</span> *)sender &#123;</span><br><span class="line">    <span class="comment">// 进入不可编辑状态</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.nameField.enabled) &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">YES</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">YES</span>;</span><br><span class="line">        sender.title = <span class="string">@"编辑"</span>;</span><br><span class="line">        <span class="comment">// 使用原来的数据还原输入框显示</span></span><br><span class="line">        <span class="keyword">self</span>.nameField.text = <span class="keyword">self</span>.contactMode.name;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.text = <span class="keyword">self</span>.contactMode.phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 进入可编辑状态</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.nameField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        <span class="keyword">self</span>.phoneField.enabled = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span>.view endEditing:<span class="literal">NO</span>];</span><br><span class="line">        <span class="keyword">self</span>.saveBtn.hidden = <span class="literal">NO</span>;</span><br><span class="line">        sender.title = <span class="string">@"取消"</span>;<span class="comment">// 更新编辑按钮文案</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  改变登录按钮的可点击状态</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)textChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span>.edit.enabled = (<span class="keyword">self</span>.nameField.text.length &amp;&amp; <span class="keyword">self</span>.phoneField.text.length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p><code>联系人列表界面</code>采纳代理协议，接收编辑页面的数据</p>
<blockquote>
<ul>
<li>跳转到编辑页面前为<code>编辑界面</code>赋值代理对象</li>
<li>实现滑动删除功能</li>
</ul>
</blockquote>
<hr>
<p><em>ContactTableViewConrtroller.m</em></p>
</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ContactTableViewController</span> ()&lt;<span class="title">AddViewControllerDelegate</span>, <span class="title">EditViewControllerDelegate</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Navigation</span></span><br><span class="line"><span class="comment">// 在跳转到添加界面前为其设置代理对象（将当前的联系人列表视图控制器作为代理对象）和数据模型</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareForSegue:(<span class="built_in">UIStoryboardSegue</span> *)segue sender:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="keyword">id</span> vc = segue.destinationViewController;</span><br><span class="line">    <span class="comment">/* 设置代理 */</span></span><br><span class="line">    <span class="comment">// 跳转到添加联系人视图控制器</span></span><br><span class="line">    <span class="keyword">if</span> ([vc isKindOfClass:[AddViewController class]]) &#123;</span><br><span class="line">        AddViewController *addVc = vc;</span><br><span class="line">        addVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 跳转到编辑联系人视图控制器</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([vc isKindOfClass:[EditViewController class]]) &#123;</span><br><span class="line">        <span class="comment">// 获取点击的联系人所在cell(选中的那一行)的 NSIndexPath</span></span><br><span class="line">        EditViewController *editVc = vc;</span><br><span class="line">        <span class="comment">// 获取选中的那一行</span></span><br><span class="line">        <span class="built_in">NSIndexPath</span> *path = [<span class="keyword">self</span>.tableView indexPathForSelectedRow];</span><br><span class="line">        <span class="comment">// 赋值数据模型</span></span><br><span class="line">        editVc.contactMode = <span class="keyword">self</span>.contactArr[path.row];</span><br><span class="line">        <span class="comment">// 赋值代理对象</span></span><br><span class="line">        editVc.delegate = <span class="keyword">self</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-5-数据存储"><a href="#2-12-5-数据存储" class="headerlink" title="2.12.5    数据存储"></a>2.12.5    数据存储</h3><blockquote>
<p><strong>说明：</strong>本课时讲解数据存储的四种方式的区别，学习<code>偏好设置</code>和<code>归档</code>的方式存储数据，并解决添加页面不能传值的问题。</p>
</blockquote>
<table>
<thead>
<tr>
<th>数据存储方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>plist</td>
<td>需要知道文件名，只适合<code>NSArray</code>、<code>NSString</code>等基本数据类型</td>
</tr>
<tr>
<td>偏好设置</td>
<td>不需要知道文件名，小型数据<code>NSUserDefaults</code></td>
</tr>
<tr>
<td>对象归档</td>
<td><code>NSKeyedArchiver</code>，必须采纳<code>NSCoding</code>协议</td>
</tr>
<tr>
<td>core Data</td>
<td>大型数据</td>
</tr>
<tr>
<td>sqpite3</td>
<td>数据库</td>
</tr>
</tbody>
</table>
<h4 id="2-12-5-1-便好设置"><a href="#2-12-5-1-便好设置" class="headerlink" title="2.12.5.1    便好设置"></a>2.12.5.1    便好设置</h4><blockquote>
<p><strong>实战：</strong>登录界面载入后采用<code>便好设置</code>方式读取配置</p>
<ul>
<li>页面载入时读取<code>便好设置</code></li>
<li>点击登录时存储<code>便好设置</code></li>
</ul>
</blockquote>
<p><em>LoginViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MBProgressHUD+MJ.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define UserNameKey @<span class="meta-string">"name"</span></span></span><br><span class="line"><span class="meta">#define PwdKey @<span class="meta-string">"pwd"</span></span></span><br><span class="line"><span class="meta">#define RmbPwdKey @<span class="meta-string">"rmd_pwd"</span></span></span><br><span class="line">...</span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">LoginViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)loginAction &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 存储数据</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.nameField forKey:UserNameKey];</span><br><span class="line">    [defaults setObject:<span class="keyword">self</span>.pwdField.text forKey:PwdKey];</span><br><span class="line">    [defaults setBool:<span class="keyword">self</span>.rembField.isOn forKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 设置同步</span></span><br><span class="line">    [defaults synchronize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="comment">// 读取上次配置</span></span><br><span class="line">    <span class="built_in">NSUserDefaults</span> *defaults = [<span class="built_in">NSUserDefaults</span> standardUserDefaults];</span><br><span class="line">    <span class="keyword">self</span>.nameField.text = [defaults valueForKey:UserNameKey];</span><br><span class="line">    <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">    <span class="keyword">self</span>.rembField.on = [defaults boolForKey:RmbPwdKey];</span><br><span class="line">    <span class="comment">// 如果上次登录时选择了记住密码，则自动填写密码字段，并激活登录按钮</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.rembField.isOn) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pwdField.text = [defaults valueForKey:PwdKey];</span><br><span class="line">        <span class="keyword">self</span>.loginBtn.enabled = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-12-5-2-对象归档"><a href="#2-12-5-2-对象归档" class="headerlink" title="2.12.5.2    对象归档"></a>2.12.5.2    对象归档</h4><blockquote>
<p><strong>实战：</strong>联系人列表界面使用<code>对象归档方式</code>存储数据。</p>
<ul>
<li><code>JKContactModel</code>采纳<code>NSCoding</code>协议</li>
<li>对<code>联系人列表界面</code>中添加、删除和读取数据模型的操作进行归档</li>
</ul>
</blockquote>
<p><em>ContactTableViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ContactTableViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKContactModel.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"AddViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"EditViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取归档的文件路径</span></span><br><span class="line"><span class="meta">#define ContactFilePath [[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:@<span class="meta-string">"contacts.data"</span>]</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ContactTableViewController</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - UITableView delegate</span></span><br><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="comment">// 滑动删除</span></span><br><span class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</span><br><span class="line">        <span class="comment">// 1. 删除对应数据模型</span></span><br><span class="line">        [<span class="keyword">self</span>.contactArr removeObjectAtIndex:indexPath.row];</span><br><span class="line">        <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">        [<span class="keyword">self</span>.tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</span><br><span class="line">        <span class="comment">// 3. 归档</span></span><br><span class="line">        [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)contactArr</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_contactArr) &#123;</span><br><span class="line">        _contactArr = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithFile:ContactFilePath];</span><br><span class="line">        <span class="keyword">if</span> (_contactArr == <span class="literal">nil</span>) &#123;</span><br><span class="line">            _contactArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _contactArr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - EditViewController delegate</span></span><br><span class="line"><span class="comment">// 数据模型被改变后，刷新界面显示</span></span><br><span class="line">- (<span class="keyword">void</span>)editViewController:(EditViewController *)editVc didSavaContact:(JKContactModel *)model</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - AddViewController delagate</span></span><br><span class="line">- (<span class="keyword">void</span>)addContact:(AddViewController *)addVc didAddContact:(JKContactModel *)contact</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 添加数据模型</span></span><br><span class="line">    [<span class="keyword">self</span>.contactArr addObject:contact];</span><br><span class="line">    <span class="comment">// 2. 刷新表视图</span></span><br><span class="line">    [<span class="keyword">self</span>.tableView reloadData];</span><br><span class="line">    <span class="comment">// 3. 归档</span></span><br><span class="line">    [<span class="built_in">NSKeyedArchiver</span> archiveRootObject:<span class="keyword">self</span>.contactArr toFile:ContactFilePath];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-13-绘制小黄人"><a href="#2-13-绘制小黄人" class="headerlink" title="2.13    绘制小黄人"></a>2.13    绘制小黄人</h2><h3 id="Quartz-2D"><a href="#Quartz-2D" class="headerlink" title="Quartz 2D"></a>Quartz 2D</h3><blockquote>
<p><strong>说明：</strong>是一个二维绘图引擎。<code>Quartz 2D</code>的<code>API</code>是<code>C</code>语言，来自于<code>CoreGraphics</code>框架。该框架可以用来</p>
<ul>
<li>绘制图形：线条／三角形／矩形／圆／弧等</li>
<li>绘制文字</li>
<li>绘制、生成图片（图像)）</li>
<li>读取／生成pdf</li>
<li>截图、裁剪图片</li>
<li>自定义UI控件</li>
</ul>
<p><strong>技巧：</strong><code>UIView</code>就是通过该引擎实现的控件绘制，因此可以通过继承<code>UIView</code>定义自己的控件。<br><strong>图形上下文（Graphics Context）：</strong>是一个<code>CGContextRef</code>类型的数据，用来</p>
<ul>
<li>保存绘图信息、绘图状态</li>
<li>决定绘制的输出目标（绘制到什么地方去，输出目标可以是PDF文件、Bitmap或者显示器的窗口上）</li>
</ul>
</blockquote>
<h3 id="2-13-1-Quartz-2D基本图形"><a href="#2-13-1-Quartz-2D基本图形" class="headerlink" title="2.13.1    Quartz 2D基本图形"></a>2.13.1    <code>Quartz 2D</code>基本图形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解 <code>Quartz 2D</code> 的概念，<code>drawRect</code> 方法的调用、图形上下文、以及线段、三角形、四边形的绘制方法。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%889.51.15.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawLine.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DrawLine</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>DrawLine.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawLine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawLine</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  系统自动调用，视图显示在屏幕上的时候调用切只调用一次</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drwaLine();</span><br><span class="line">    drawRect();</span><br><span class="line">    drawTriangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制直线</span><br><span class="line"> *  绘制两条样式不同的线，因此在两个图形上下文中分别绘制</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drwaLine() &#123;</span><br><span class="line">    <span class="comment">// 第1条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 将上下文复制一份到栈中(作为为第二条线的图形上下文)</span></span><br><span class="line">    <span class="built_in">CGContextSaveGState</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">20</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(context, k<span class="built_in">CGLineCapRound</span>);<span class="comment">// 设置线条头尾部的样式</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(context, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);<span class="comment">//设置起点</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 第二条线</span></span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRestoreGState</span>(context);<span class="comment">// 将图形上下文出栈， 替换当前的上下文</span></span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(context, k<span class="built_in">CGLineJoinRound</span>);<span class="comment">// 设置线断转折点的样式</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">120</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">180</span>);</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 以空心的方式画出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制四边形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawRect() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制四边形</span></span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">180</span>));<span class="comment">// 四边形</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> purpleColor] setFill];<span class="comment">// 设置填充色</span></span><br><span class="line">    <span class="comment">// 3. 显示在 View 上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制三角形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawTriangle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制三角形</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">100</span>, <span class="number">100</span>);<span class="comment">// 第一个边</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, <span class="number">150</span>, <span class="number">100</span>);<span class="comment">// 第二个边</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);<span class="comment">// 第三个边（闭合路径，连接起点和最后一个点）</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> redColor] set];</span><br><span class="line">    <span class="comment">// 3. 显示在view</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-2-绘制圆、图片与文字"><a href="#2-13-2-绘制圆、图片与文字" class="headerlink" title="2.13.2    绘制圆、图片与文字"></a>2.13.2    绘制圆、图片与文字</h3><blockquote>
<p><strong>说明：</strong>本课时讲解绘制圆弧、圆形、图片与文字的方法，所用函数及函数参数的含义，并介绍多种不同的函数绘制图形，最后介绍了<code>Quartz 2D</code>中的贝塞尔曲线。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-24%20%E4%B8%8B%E5%8D%8810.25.47.png" alt="Alt text"></p>
</blockquote>
<p><em>DrawCircle.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawCircle.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  角度转换为弧度</span><br><span class="line"> *</span><br><span class="line"> *  @param angle 角度</span><br><span class="line"> *</span><br><span class="line"> *  @return 弧度</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">CGFloat</span> arc(<span class="built_in">CGFloat</span> angle) &#123;</span><br><span class="line">    <span class="keyword">return</span> angle * (M_PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawCircle</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    drawArc();</span><br><span class="line">    drawCircle();</span><br><span class="line">    drawImg();</span><br><span class="line">    drawText();</span><br><span class="line">    drawBezier();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  画圆</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawCircle() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(context, <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">130</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  弧形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawArc() &#123;</span><br><span class="line">    <span class="comment">// 1. 获取图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 绘制图形</span></span><br><span class="line">    <span class="comment">// 参数：上下文, 圆心横坐标，圆心纵坐标，半径，开始的角度，结束的角度，0顺时针/1逆时针</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, arc(<span class="number">90</span>), arc(<span class="number">200</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 3. 显示在View上</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *   绘制字体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawText() &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;<span class="comment">// 字串</span></span><br><span class="line">    <span class="comment">// 设置（字体样式信息保存在字典中）</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *attributes = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    attributes[<span class="built_in">NSFontAttributeName</span>] = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];<span class="comment">// 字体大小</span></span><br><span class="line">    attributes[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> purpleColor];<span class="comment">// 字体颜色</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:attributes];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图片</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawImg()&#123;</span><br><span class="line">    <span class="comment">// 1. 取得图片</span></span><br><span class="line">    <span class="built_in">UIImage</span> *img = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>];</span><br><span class="line">    <span class="comment">// 2. 画</span></span><br><span class="line">    <span class="comment">// img drawAtPoint</span></span><br><span class="line">    <span class="comment">// img drawInRect</span></span><br><span class="line">    [img drawAsPatternInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>)];</span><br><span class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"极客学院"</span>;</span><br><span class="line">    <span class="comment">// 3. 显示到View</span></span><br><span class="line">    [str drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">30</span>) withAttributes:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  贝塞尔曲线</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBezier()&#123;</span><br><span class="line">    <span class="comment">// 1.取得图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="comment">// 2. 起点</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//CGContextAddCurveToPoint(context, 120, 100, 180, 50, 190, 190);// 2个控制点</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, <span class="number">150</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>);<span class="comment">// 1个控制点</span></span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-13-3-绘制小黄人雏形"><a href="#2-13-3-绘制小黄人雏形" class="headerlink" title="2.13.3    绘制小黄人雏形"></a>2.13.3    绘制小黄人雏形</h3><blockquote>
<p><strong>说明：</strong>本课时讲解根据所学习的 <code>Quartz 2D</code> 的绘制图形的知识绘制小黄人雏形，以此加深对绘图的理解。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-25%20%E4%B8%8A%E5%8D%8812.28.25.png" alt="Alt text|200x150"></p>
</blockquote>
<p><em>DrawHuman.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"DrawHuman.h"</span></span></span><br><span class="line"><span class="meta">#define JKRadius 70// 半径</span></span><br><span class="line"><span class="meta">#define JKTopY 100// 即是身体高度，也是身体顶部纵坐标</span></span><br><span class="line"><span class="meta">#define JKColor(r, g, b) [UIColor colorWithRed:(r)/255.0 green:(g)/255.0 blue :(b)/255.0 alpha:1.0]// 身体颜色</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DrawHuman</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// 1. 图形上下文</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    drawBody(context, rect);</span><br><span class="line">    drawMouse(context, rect);</span><br><span class="line">    drawEyes(context, rect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  身体</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawBody(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 上半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topX = rect.size.width * <span class="number">0.5</span>;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topY = JKTopY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> topRadius = JKRadius;<span class="comment">// 圆形半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, topX, topY, topRadius, <span class="number">0</span>, M_PI, <span class="number">1</span>);<span class="comment">// 绘制半圆（从右侧沿逆时针向左绘制）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 身体左侧竖线</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleX = topX - topRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleH = JKTopY;<span class="comment">// 身体部分高度</span></span><br><span class="line">    <span class="built_in">CGFloat</span> middleY =  topY + middleH;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, middleX, middleY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下半圆</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomX = topX;<span class="comment">// 圆心横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomY = middleY;<span class="comment">// 圆心纵坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> bottomRedius = topRadius;<span class="comment">// 半径</span></span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, bottomX, bottomY, bottomRedius, M_PI, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭合</span></span><br><span class="line">    <span class="built_in">CGContextClosePath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [JKColor(<span class="number">252</span>, <span class="number">218</span>, <span class="number">0</span>) set];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  嘴</span><br><span class="line"> *  采用赛贝尔曲线，1个控制点</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawMouse(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">// 控制点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> controlX = rect.size.width * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> controlY = rect.size.height * <span class="number">0.3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移动到起点</span></span><br><span class="line">    <span class="built_in">CGFloat</span> marginX = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> marginY = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentX = controlX - marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> currentY = controlY - marginY;</span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, currentX, currentY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 结束点坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endX = controlX + marginX;</span><br><span class="line">    <span class="built_in">CGFloat</span> endY = currentY;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绘制</span></span><br><span class="line">    <span class="built_in">CGContextAddQuadCurveToPoint</span>(context, controlX, controlY, endX, endY);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置颜色</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示到View</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  眼睛</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawEyes(<span class="built_in">CGContextRef</span> context, <span class="built_in">CGRect</span> rect) &#123;</span><br><span class="line">    <span class="comment">//黑色绑带（一条很粗的线）</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startX = rect.size.width * <span class="number">0.5</span> - JKRadius;<span class="comment">// 起点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> startY = JKTopY;<span class="comment">// 起点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextMoveToPoint</span>(context, startX, startY);</span><br><span class="line">    <span class="built_in">CGFloat</span> endX = startX + <span class="number">2</span> * JKRadius;<span class="comment">// 终点横坐标</span></span><br><span class="line">    <span class="built_in">CGFloat</span> endY = startY;<span class="comment">// 终点纵坐标</span></span><br><span class="line">    <span class="built_in">CGContextAddLineToPoint</span>(context, endX, endY);<span class="comment">// 划线</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(context, <span class="number">15</span>);<span class="comment">// 设置线的宽度</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];<span class="comment">// 设置线的颜色</span></span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(context);<span class="comment">// 显示</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//灰色镜框</span></span><br><span class="line">    [JKColor(<span class="number">61</span>, <span class="number">62</span>, <span class="number">66</span>) set];</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangRadius = JKRadius * <span class="number">0.4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangY = startY;</span><br><span class="line">    <span class="built_in">CGFloat</span> kuangX = rect.size.width * <span class="number">0.5</span> - kuangRadius;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, kuangX + <span class="number">25</span>, kuangY, kuangRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//里面的白色框</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> whiteColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteRadius = kuangRadius * <span class="number">0.7</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteX = kuangX;</span><br><span class="line">    <span class="built_in">CGFloat</span> whiteY = kuangY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, whiteX + <span class="number">25</span>, whiteY, whiteRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//眼睛</span></span><br><span class="line">    [[<span class="built_in">UIColor</span> blackColor] set];</span><br><span class="line">    <span class="built_in">CGFloat</span> blackRadius = whiteRadius * <span class="number">0.5</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackX = whiteX;</span><br><span class="line">    <span class="built_in">CGFloat</span> blackY = whiteY;</span><br><span class="line">    <span class="built_in">CGContextAddArc</span>(context, blackX + <span class="number">25</span>, blackY, blackRadius, <span class="number">0</span>, M_PI * <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="2-14-手势密码锁"><a href="#2-14-手势密码锁" class="headerlink" title="2.14    手势密码锁"></a>2.14    手势密码锁</h2><h3 id="UIGestureRecognizer"><a href="#UIGestureRecognizer" class="headerlink" title="UIGestureRecognizer"></a>UIGestureRecognizer</h3><blockquote>
<p><strong>说明：</strong>所有手势操作相关的操作的类的<code>基类</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><code>UIGestureRecognizer</code>的子类</th>
<th>对应的手势操作</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UITapGestureRecoginizer</code></td>
<td>点击</td>
</tr>
<tr>
<td><code>UIPinchGestureRecognizer</code></td>
<td>捏合</td>
</tr>
<tr>
<td><code>UIRotationGestureRecognizer</code></td>
<td>旋转</td>
</tr>
<tr>
<td><code>UISwipwGestureRecognizer</code></td>
<td>轻扫、快速移动，是用于监测欢动方向的</td>
</tr>
<tr>
<td><code>UIPanGestureRecognizer</code></td>
<td>拖移、慢速移动，是用于监测便宜的量的</td>
</tr>
<tr>
<td><code>UILongPressGestureRecognizer</code></td>
<td>长按</td>
</tr>
</tbody>
</table>
<h3 id="2-14-1-点击、捏合、轻扫"><a href="#2-14-1-点击、捏合、轻扫" class="headerlink" title="2.14.1    点击、捏合、轻扫"></a>2.14.1    点击、捏合、轻扫</h3><blockquote>
<p><strong>说明：</strong>本课时讲解点击手势，单击和双击，手势互斥原则的概念和解决方法，捏合手势缩放视图以及轻扫手势的使用。</p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="meta">#pragma mark - Tap 点击和手势</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  1. 点击示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)tapGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 类型一：一个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTap:)];</span><br><span class="line">    tap.numberOfTapsRequired = <span class="number">1</span>;<span class="comment">// 点击次数(默认1)</span></span><br><span class="line">    tap.numberOfTouchesRequired = <span class="number">1</span>;<span class="comment">// 几个手指点击（默认1）</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap];<span class="comment">// 注册事件到顶层view</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二：一个手指双击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap2 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(doubleTap:)];</span><br><span class="line">    tap2.numberOfTapsRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap2];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型一和类型二冲突策略</span></span><br><span class="line">    [tap requireGestureRecognizerToFail:tap2];<span class="comment">// 同时发生时，只触发tap2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型三：两个手指单击</span></span><br><span class="line">    <span class="built_in">UITapGestureRecognizer</span> *tap3 = [[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(singleTwoFingerTap:)];</span><br><span class="line">    tap3.numberOfTouchesRequired = <span class="number">2</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:tap3];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型二和类型三冲突策略</span></span><br><span class="line">    [tap2 requireGestureRecognizerToFail:tap3];<span class="comment">// 同时发生时，只触发tap3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  2. 轻扫手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UISwipeGestureRecognizer</span> *swipe = [[<span class="built_in">UISwipeGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(swipeAction:)];</span><br><span class="line">    swipe.direction = <span class="built_in">UISwipeGestureRecognizerDirectionLeft</span>;<span class="comment">// 默认右扫</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:swipe];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  3. 捏合手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPinchGestureRecognizer</span> *pinch = [[<span class="built_in">UIPinchGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(pinchAction:)];</span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:pinch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 响应方法</span></span><br><span class="line"><span class="comment">// 单击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双击（一个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)doubleTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"一个手指双击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单击（两个手指）</span></span><br><span class="line">- (<span class="keyword">void</span>)singleTwoFingerTap:(<span class="built_in">UITapGestureRecognizer</span> *)tap</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"两个手指单击"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 滑动</span></span><br><span class="line">- (<span class="keyword">void</span>)swipeAction:(<span class="built_in">UISwipeGestureRecognizer</span> *)swipe</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"向左轻扫"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 捏合</span></span><br><span class="line">- (<span class="keyword">void</span>)pinchAction:(<span class="built_in">UIPinchGestureRecognizer</span> *)pinch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> scale = pinch.scale;</span><br><span class="line">    pinch.view.transform = <span class="built_in">CGAffineTransformScale</span>(pinch.view.transform, scale, scale);</span><br><span class="line">    <span class="keyword">if</span> (scale &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合放大"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (scale &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        _genstureLabel.text = <span class="string">@"捏合缩小"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-14-2-拖移、旋转、长按"><a href="#2-14-2-拖移、旋转、长按" class="headerlink" title="2.14.2    拖移、旋转、长按"></a>2.14.2    拖移、旋转、长按</h3><blockquote>
<p><strong>说明：</strong>本课时讲解拖移、旋转和长按手势的声明以及响应方法，根据其属性和方法来深入理解手势。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  4. 拖移手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)panGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(panAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:pan];<span class="comment">// 注册事件到_genstureLabel</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  5. 旋转手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIRotationGestureRecognizer</span> *rotation = [[<span class="built_in">UIRotationGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(rotationAction:)];</span><br><span class="line">    [_genstureLabel addGestureRecognizer:rotation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  6. 长按手势示例</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressGesture</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UILongPressGestureRecognizer</span> *longPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(longPressAction:)];</span><br><span class="line">    longPress.minimumPressDuration = <span class="number">2</span>;<span class="comment">// 设置有效触发长按事件时间</span></span><br><span class="line">    [<span class="keyword">self</span>.view addGestureRecognizer:longPress];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长按</span></span><br><span class="line">- (<span class="keyword">void</span>)longPressAction:(<span class="built_in">UILongPressGestureRecognizer</span> *)longPress</span><br><span class="line">&#123;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"已经长按2秒"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)rotationAction:(<span class="built_in">UIRotationGestureRecognizer</span> *)rotationGes</span><br><span class="line">&#123;</span><br><span class="line">    rotationGes.view.transform = <span class="built_in">CGAffineTransformRotate</span>(rotationGes.view.transform, rotationGes.rotation);</span><br><span class="line">    rotationGes.rotation = M_PI;</span><br><span class="line">    _genstureLabel.text = <span class="string">@"旋转"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拖动</span></span><br><span class="line">- (<span class="keyword">void</span>)panAction:(<span class="built_in">UIPanGestureRecognizer</span> *)pan</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 移动的量（向量）</span></span><br><span class="line">    <span class="built_in">CGPoint</span> translation = [pan translationInView:<span class="keyword">self</span>.view];</span><br><span class="line">    <span class="comment">// 计算移动后的位置坐标</span></span><br><span class="line">    pan.view.center = <span class="built_in">CGPointMake</span>(pan.view.center.x + translation.x, pan.view.center.y + translation.y);</span><br><span class="line">    <span class="comment">// 设置坐标和速度</span></span><br><span class="line">    [pan setTranslation:<span class="built_in">CGPointZero</span> inView:<span class="keyword">self</span>.view];</span><br><span class="line">    _genstureLabel.text = <span class="string">@"把我放哪儿啊？"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-14-3-九宫格布局按钮"><a href="#2-14-3-九宫格布局按钮" class="headerlink" title="2.14.3    九宫格布局按钮"></a>2.14.3    九宫格布局按钮</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>storyboard</code> 添加背景视图，并通过代码布局按钮，运用到了九宫格布局算法，对触摸事件和按钮的功能进行代码封装。</p>
<ol>
<li>引入图片资源</li>
<li>创建<code>JKLockView</code>（<code>UIView</code>）</li>
<li>重写<code>initWithFrame</code>和<code>initWithCoder</code></li>
<li>布局<code>JKLockView</code>并添加按钮<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_gesture.gif" alt="Alt text|100x180"></li>
</ol>
</blockquote>
<h3 id="2-14-4-手势连线与代理"><a href="#2-14-4-手势连线与代理" class="headerlink" title="2.14.4    手势连线与代理"></a>2.14.4    手势连线与代理</h3><blockquote>
<p><strong>说明：</strong>本课时讲解将按钮根据手势触摸连线，修改按钮选中状态、手势结束后取消连线、最后设置代理方法来判断密码是否正确。</p>
<ol>
<li>完成连线逻辑</li>
<li>在<code>JKLockView</code>中定义代理协议</li>
<li><code>ViewController</code>采纳代理协议</li>
<li>在<code>JKLockView</code>中调用代理对象</li>
<li>在<code>ViewController</code>中使用<code>UIAlertController</code></li>
</ol>
<p><strong>注意：</strong></p>
<ul>
<li>数组或字典中添加的对象不能为<code>nil</code>，否则程序会崩溃</li>
<li>当视图发生变化时，调用<code>setNeedDisplay</code>更新视图</li>
</ul>
<p><strong>技巧：</strong>通过 <code>makeObjectsPerformSelector</code> 向数组中的每一个对象发送信息</p>
</blockquote>
<h2 id="2-15-抽奖转盘动画"><a href="#2-15-抽奖转盘动画" class="headerlink" title="2.15    抽奖转盘动画"></a>2.15    抽奖转盘动画</h2><blockquote>
<p><strong>说明：</strong><code>QuartzCore</code> 框架是常用的框架，除了绘图还有动画效果，通过这个课程理解常用的 <code>CAAnimation</code> 类，并且了解图层与视图的关系，包括 <code>CALayer</code> 的自定义方法和属性。</p>
<ul>
<li>CALayer</li>
<li>CAAnimation</li>
<li>转场动画与组动画</li>
<li>隐性动画</li>
<li>CGImageCreateWithImageInRect</li>
<li>CADisplayLink</li>
</ul>
<p><strong>兼容性：</strong><code>QuartzCore</code>与<code>CoreGraphics</code>是可以跨平台使用的，<code>UIKit</code>只能在<code>iOS</code>中使用</p>
</blockquote>
<h3 id="2-15-1-CALayer图层介绍"><a href="#2-15-1-CALayer图层介绍" class="headerlink" title="2.15.1    CALayer图层介绍"></a>2.15.1    CALayer图层介绍</h3><p><strong>*课程介绍：</strong>本课时讲解<code>CALayer</code> 图层的概念，介绍图层的属性和自定义图层的方法。*</p>
<h4 id="CALayer"><a href="#CALayer" class="headerlink" title="CALayer"></a>CALayer</h4><blockquote>
<p><strong>依赖：</strong>使用层之前，需要在项目中引入<code>QuartzCore.framework</code>框架<br><strong>用途：</strong><code>CALayer</code>(层)是屏幕上的一个矩形区域，在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。</p>
<ul>
<li>层的大小尺寸</li>
<li>背景色</li>
<li>内容（可以填充图片或者使用<code>Core Graphics</code>绘制的内容）</li>
<li>矩形是否使用圆角</li>
<li>矩形是否有阴影</li>
</ul>
<p><strong>感性认知：</strong><code>CALayer</code>本质上是一块包含一幅位图的缓冲区，由视图创建的层为<code>隐式层</code>，而手动创建的层称为<code>显示层</code>。<br><strong>种类：</strong><code>Layer</code>有很多种，最常用也是最基本的是<code>CALayer</code>，当然还包括其他的子类</p>
<ul>
<li><code>CAScrollerLayer</code> 简化显示层的一部分</li>
<li><code>CATextLayer</code> 文本层</li>
<li><code>CAGradientLayer</code>、<code>CAShapeLayer</code>等等</li>
</ul>
</blockquote>
<h4 id="2-15-1-1-原生控件使用CALayer"><a href="#2-15-1-1-原生控件使用CALayer" class="headerlink" title="2.15.1.1    原生控件使用CALayer"></a>2.15.1.1    原生控件使用<code>CALayer</code></h4><blockquote>
<p><strong>说明：</strong>在每一个<code>UIView</code>中都包含一个根<code>CALayer</code>，在<code>UIView</code>上的所有视觉效果都是在这个<code>Layer</code>上进行的。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.11.53.png" alt="Alt text"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#define kScreenWidth [UIScreen mainScreen].bounds.size.width</span></span><br><span class="line"><span class="meta">#define kScreenHeight [UIScreen mainScreen].bounds.size.height</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> initImageView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  设置原生控件的CALayer（以 UIImageView 为例）</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)initImageView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIImageView</span> *imgView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.jpg"</span>]];</span><br><span class="line">    imgView.frame = <span class="built_in">CGRectMake</span>((kScreenWidth - <span class="number">200</span>) / <span class="number">2</span>, (kScreenHeight - <span class="number">200</span>) / <span class="number">2</span>, <span class="number">200</span>, <span class="number">200</span>);<span class="comment">// 设置frame</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:imgView];<span class="comment">// 将 UIImageView 添加到视图中</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 UIImageView 的根 CGLayer</span></span><br><span class="line">    <span class="comment">// 1. 设置阴影</span></span><br><span class="line">    imgView.layer.shadowColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;<span class="comment">// 设置阴影颜色</span></span><br><span class="line">    imgView.layer.shadowOffset = <span class="built_in">CGSizeMake</span>(<span class="number">10</span>, <span class="number">10</span>);<span class="comment">// 设置阴影的偏移</span></span><br><span class="line">    imgView.layer.shadowOpacity = <span class="number">0.5</span>;<span class="comment">// 设置阴影的不透明</span></span><br><span class="line">    <span class="comment">// 2. 设置圆角</span></span><br><span class="line">    imgView.layer.cornerRadius = <span class="number">10</span>;<span class="comment">// 设置圆角半径</span></span><br><span class="line">    imgView.layer.masksToBounds = <span class="literal">YES</span>;<span class="comment">// 强制内部的所有子层支持圆角效果，少了这个设置，UIImageView是不会有圆角效果的。设置之后，没有阴影效果。</span></span><br><span class="line">    <span class="comment">// 3. 设置边框</span></span><br><span class="line">    imgView.layer.borderWidth = <span class="number">5</span>;</span><br><span class="line">    imgView.layer.borderColor = [<span class="built_in">UIColor</span> grayColor].CGColor;</span><br><span class="line">    <span class="comment">// 4. 设置旋转：利用 transform 属性可以设置旋转、缩放等效果</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 顺时针旋转45度</span></span><br><span class="line">    imgView.layer.transform = <span class="built_in">CATransform3DMakeScale</span>(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">0</span>);<span class="comment">// 缩小0.5倍</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [imgView.layer setValue:@(2) forKey:@"transform.scale.x"];// 使用KVC方式</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="2-15-1-2-自定义CALayer"><a href="#2-15-1-2-自定义CALayer" class="headerlink" title="2.15.1.2    自定义CALayer"></a>2.15.1.2    自定义CALayer</h4><blockquote>
<p><strong>说明：</strong>两种方式</p>
<ul>
<li>建子类继承<code>CALayer</code>，实现 <code>drawInContext：</code>方法</li>
<li>在控制器中设置代理，实现代理方法来画图层</li>
</ul>
</blockquote>
<h5 id="方式一：继承CALayer"><a href="#方式一：继承CALayer" class="headerlink" title="方式一：继承CALayer"></a>方式一：继承CALayer</h5><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-03-29%2013.26.12.png" alt="Alt text"></p>
<p><em>MyCALayer.h</em></p>
<blockquote>
<p><strong>说明：</strong>继承<code>CALayer</code><br><strong>注意：</strong>需要在项目的<code>info.plist</code>中导入<code>QuartzCore</code>库</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyCALyer</span> : <span class="title">CALayer</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>MyCALayer.m</em></p>
<blockquote>
<p><strong>说明：</strong>需要重写<code>drawInContext</code>方法，该方法在视图变动时通过<code>setNeededDisplay</code>被自动调用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyCALyer</span></span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  该方法中完成对图层的绘制</span><br><span class="line"> *</span><br><span class="line"> *  @param ctx 图形上下文</span><br><span class="line"> */</span></span><br><span class="line">-(<span class="keyword">void</span>)drawInContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);<span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));<span class="comment">// 椭圆</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);<span class="comment">// 实心绘制</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<blockquote>
<p><strong>说明：</strong>在控制器中使用这个自定义的<code>MyLayer</code>，将图层实例添加到视图中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyCALyer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">	...</span><br><span class="line">    [<span class="keyword">self</span> myLayerExample];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  示例自定义 CALayer 的使用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)myLayerExample</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建自定义 layer 实例</span></span><br><span class="line">    My<span class="built_in">CALyer</span> *layer = [My<span class="built_in">CALyer</span> layer];</span><br><span class="line">    <span class="comment">// 设置该 layer 实例</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">// 绘制该layer</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 调用该方法，layer 的 drawInContext 方法才会被调用</span></span><br><span class="line">    <span class="comment">// 添加到视图中</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到视图</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：实现代理当法"><a href="#方式二：实现代理当法" class="headerlink" title="方式二：实现代理当法"></a>方式二：实现代理当法</h5><blockquote>
<p><strong>说明：</strong>和方式一一样要创建<code>CALayer</code>的子类，但不用实现<code>drawInContext</code>方法，而是设置代理对象（可以是任何类的实例），绘制的过程由代理对象重写<code>drawInContext</code>方法来实现。<br><em>JKLayer.h</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/QuartzCore.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JKLayer</span> : <span class="title">CALayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>JKLayer.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JKLayer</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"JKLayer.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    JKLayer *layer = [JKLayer layer];</span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">    layer.anchorPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    layer.delegate = <span class="keyword">self</span>;<span class="comment">// 不用采纳额外协议，任何对象可以作为代理对象</span></span><br><span class="line">    [layer setNeedsDisplay];<span class="comment">// 必须调用这个方法，代理对象的 drawLayer方法 才会显被调用</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];<span class="comment">// 添加到父图层</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 代理方法</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  修改当前ViewController的根Layer</span><br><span class="line"> *  @param layer 图层</span><br><span class="line"> *  @param ctx   绘制上下文</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(ctx, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">10</span>,<span class="number">10</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-2-CAAnimation-动画"><a href="#2-15-2-CAAnimation-动画" class="headerlink" title="2.15.2    CAAnimation 动画"></a>2.15.2    CAAnimation 动画</h3><blockquote>
<p><strong>说明：</strong>基本动画、关键帧动画、组动画</p>
</blockquote>
<table>
<thead>
<tr>
<th>基本动画类型</th>
<th>说明</th>
<th>父类</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CABasicAnimation</code></td>
<td>基础动画</td>
<td>属性动画</td>
<td>平移、旋转、缩放</td>
</tr>
<tr>
<td><code>CAKeyframeAnimation</code></td>
<td>关键帧动画</td>
<td>属性动画</td>
<td>按照某种自定义路径移动</td>
</tr>
<tr>
<td><code>CATransition</code></td>
<td>转场动画</td>
<td><code>CAAnimation</code></td>
<td>不同layer之间的切换</td>
</tr>
<tr>
<td><code>CAAnimationGroup</code></td>
<td>组动画</td>
<td><code>CAAnimation</code></td>
<td>将几个不同的动画放在同一个组里</td>
</tr>
</tbody>
</table>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CALayer</span> *layer;<span class="comment">// 用于演示动画的图层</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="comment">// 创建图层</span></span><br><span class="line">    <span class="built_in">CALayer</span> *layer = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    <span class="comment">// 设置图层</span></span><br><span class="line">    layer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.position = <span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    layer.backgroundColor = [<span class="built_in">UIColor</span> yellowColor].CGColor;</span><br><span class="line">    <span class="comment">// 添加图层</span></span><br><span class="line">    [<span class="keyword">self</span>.view.layer addSublayer:layer];</span><br><span class="line">    <span class="keyword">self</span>.layer = layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">// [self animationScale];</span></span><br><span class="line">    <span class="comment">// [self animationTranslate];</span></span><br><span class="line">    <span class="comment">// [self animationRotation];</span></span><br><span class="line">    [<span class="keyword">self</span> keyFrameAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 基本动画(CABasicAnimation)</span></span><br><span class="line"><span class="comment">// 缩放</span></span><br><span class="line">- (<span class="keyword">void</span>)animationScale</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置 动画</span></span><br><span class="line">    <span class="comment">// keyPath ：决定了基本动画的类型</span></span><br><span class="line">    animation.keyPath = <span class="string">@"bounds"</span>;</span><br><span class="line">    <span class="comment">// toValue 到达哪个点，byValue 增加多少值, fromValue 从哪个点开始移动</span></span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGRect</span>:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>)];<span class="comment">// toValue ：到达哪个点</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;<span class="comment">// 动画持续时间</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;<span class="comment">// 动画完毕之后不删除动画（即，可以再次触发）</span></span><br><span class="line">    animation.fillMode = <span class="string">@"forwords"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画到图层</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 平移</span></span><br><span class="line">- (<span class="keyword">void</span>)animationTranslate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"position"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forwards"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转</span></span><br><span class="line">- (<span class="keyword">void</span>)animationRotation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *animation = [<span class="built_in">CABasicAnimation</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.keyPath = <span class="string">@"transform"</span>;</span><br><span class="line">    animation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeRotation</span>(M_PI_4, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)];</span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = <span class="string">@"forward"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 关键帧动画</span></span><br><span class="line"><span class="comment">// 让图层做一个圆形移动</span></span><br><span class="line">- (<span class="keyword">void</span>)keyFrameAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建动画对象</span></span><br><span class="line">    <span class="built_in">CAKeyframeAnimation</span> *animation = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置动画</span></span><br><span class="line">    animation.removedOnCompletion = <span class="literal">NO</span>;</span><br><span class="line">    animation.fillMode = k<span class="built_in">CAFillModeForwards</span>;<span class="comment">// 保持最新的状态</span></span><br><span class="line">    animation.duration = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();<span class="comment">// 创建一个可变路径</span></span><br><span class="line">    <span class="built_in">CGPathAddEllipseInRect</span>(path, <span class="literal">NULL</span>, <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>));<span class="comment">// 画一个圆</span></span><br><span class="line">    animation.path = path;<span class="comment">// 设置动画路径</span></span><br><span class="line">    <span class="comment">// CGPathRelease(path);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置动画的执行节奏</span></span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.delegate = <span class="keyword">self</span>;<span class="comment">// 也可以将动画设置工作交给代理对象</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4. 添加动画</span></span><br><span class="line">    [<span class="keyword">self</span>.layer addAnimation:animation forKey:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 组动画</span></span><br><span class="line"><span class="comment">// 组动画</span></span><br><span class="line">- (<span class="keyword">void</span>)animationGroup</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 1. 创建组动画对象</span></span><br><span class="line">    <span class="comment">// CAAnimationGroup *animationGroup = [CAAnimationGroup animation];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 创建多个动画，添加到组动画（数组）中</span></span><br><span class="line">    <span class="comment">// animationGroup.animations = @[];</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 添加动画</span></span><br><span class="line">    <span class="comment">// [self.layer addAnimation:animationGroup forKey:nil];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="2-15-3-转场动画"><a href="#2-15-3-转场动画" class="headerlink" title="2.15.3    转场动画"></a>2.15.3    转场动画</h3><blockquote>
<p><strong>说明：</strong>本课时讲解核心动画的两个子类即<code>转场动画</code>和<code>组动画</code>，并介绍了转场动画的私有 API ，全面理解 <code>CAAnimation</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_animation.gif" alt="Alt text|200x200"></p>
</blockquote>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - 转场动画</span></span><br><span class="line">- (<span class="keyword">IBAction</span>)exchangeView &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"pageCurl"</span>;<span class="comment">// 翻页效果：私有API的动画类型</span></span><br><span class="line">    animation.subtype = k<span class="built_in">CATransitionFromRight</span>;<span class="comment">// 翻页方向</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 实施动画</span></span><br><span class="line">    [_animView exchangeSubviewAtIndex:<span class="number">0</span> withSubviewAtIndex:<span class="number">1</span>];</span><br><span class="line">    [_animView.layer addAnimation:animation forKey:<span class="string">@"myAnimation"</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)pushAction &#123;</span><br><span class="line">    <span class="comment">// 1. 创建转场动画对象</span></span><br><span class="line">    <span class="built_in">CATransition</span> *animation = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置转场动画</span></span><br><span class="line">    animation.duration = <span class="number">1</span>;</span><br><span class="line">    animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span>];</span><br><span class="line">    animation.type = <span class="string">@"cube"</span>;<span class="comment">// 立体翻转</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 将动画添加到导航控制器视图图层</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController.view.layer addAnimation:animation forKey:<span class="string">@"navAnimation"</span>];</span><br><span class="line">    <span class="comment">// 4. 实施动画</span></span><br><span class="line">    DetailViewController *detailVC = [[DetailViewController alloc] init];<span class="comment">// 创建要导航到的视图控制器</span></span><br><span class="line">    [<span class="keyword">self</span>.navigationController showViewController:detailVC sender:<span class="literal">nil</span>];<span class="comment">// 导航到目标视图控制器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-15-4-实例动画按钮布局"><a href="#2-15-4-实例动画按钮布局" class="headerlink" title="2.15.4    实例动画按钮布局"></a>2.15.4    实例动画按钮布局</h3><blockquote>
<p><strong>说明：</strong>本课时讲解转盘动画实例，进行效果展示并完成 <code>UI</code> 布局，介绍了裁剪图片的新方法。</p>
<ol>
<li>导入资源</li>
<li>创建轮盘类（<code>WheelView</code>，继承<code>UIView</code>）</li>
<li>创建轮盘类对应的<code>xib</code>文件</li>
</ol>
<p><strong>要点：</strong> 使用<code>CGImageCreateWithImageInRect</code>裁剪图片</p>
</blockquote>
<h3 id="2-15-5-CADisplayLink实现动画效果"><a href="#2-15-5-CADisplayLink实现动画效果" class="headerlink" title="2.15.5    CADisplayLink实现动画效果"></a>2.15.5    CADisplayLink实现动画效果</h3><blockquote>
<p><strong>说明：</strong>本课时讲解通过 <code>CADisplayLink</code> 实现动画效果，完善实例动画功能，复习了 <code>CABasicAnimation</code> 的属性和方法。</p>
<p><strong>要点：</strong>使用<code>CADisplayLink</code>通过刷新实现动画，<br><strong>注意：</strong>这里没有使用核心动画，因为它们在动画过程中响应点击的位置并没有真的发生变化。<code>CADisplayLink</code>就可以做到。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/JK_IOS_S2_wheel.gif" alt="Alt text"></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">94</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
