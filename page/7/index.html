<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/7/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/7/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_12 类别/" itemprop="url">
                  12 类别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:40:26+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_12 类别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_12 类别/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>利用<code>Objective-C</code>的动态运行时分配机制，你可以为现有的类添加<code>方法</code>或<code>计算属性</code>，这种机制称为<code>类别(category)</code>。</p>
<ul>
<li>可以在类中添加属性（<code>@property</code>），且只能是<code>计算属性</code>（不能添加<code>实例变量</code>）</li>
<li>可以向一个<code>类</code>添加任意数量的<code>类别</code></li>
<li><code>类别</code>可以访问其扩展的类的<code>实例变量</code></li>
</ul>
<p><strong>总结：</strong>我将<code>类别</code>分3种</p>
</blockquote>
<table>
<thead>
<tr>
<th>种类</th>
<th><code>@interface</code></th>
<th><code>@implementation</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>类别</td>
<td><code>@interface 类名(类别名)</code></td>
<td><code>@implementation 类名(类别名)</code></td>
</tr>
<tr>
<td>类扩展（匿名类别）</td>
<td><code>@interface 类名()</code></td>
<td>无</td>
</tr>
<tr>
<td>前向引导</td>
<td><code>@interface 类名(类别名)</code></td>
<td><code>@implementation 类名</code></td>
</tr>
</tbody>
</table>
<h2 id="12-1-创建类别"><a href="#12-1-创建类别" class="headerlink" title="12.1    创建类别"></a>12.1    创建类别</h2><blockquote>
<p><strong>说明：</strong>可以为人和类添加新的方法，包括那些没有源代码的类。<br><strong>技巧：</strong>通常把类别代码放在<code>独立</code>的文件中，通常以<code>类名称+类别名称</code>的风格命名。</p>
</blockquote>
<h3 id="12-1-1-开始创建类别独立文件"><a href="#12-1-1-开始创建类别独立文件" class="headerlink" title="12.1.1    开始创建类别独立文件"></a>12.1.1    开始创建类别独立文件</h3><blockquote>
<p><strong>说明：</strong>使用<code>Xcode</code>往项目中添加类别非常容易，甚至可以<code>类名称+类别名称</code>命名类别文件。</p>
<ol>
<li>新建文件<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-20%20%E4%B8%8A%E5%8D%8811.23.09.png" alt="Alt text"></li>
<li>选择模版<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-20%20%E4%B8%8A%E5%8D%8811.23.39.png" alt="Alt text"></li>
<li>文件相关<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-20%20%E4%B8%8A%E5%8D%8811.24.00.png" alt="Alt text"></li>
<li>完成<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-20%20%E4%B8%8A%E5%8D%8811.24.16.png" alt="Alt text"></li>
</ol>
</blockquote>
<h3 id="12-1-2-interface部分"><a href="#12-1-2-interface部分" class="headerlink" title="12.1.2    @interface部分"></a>12.1.2    @interface部分</h3><p><em>NSString+NumberConvience.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">NumberConvience</span>)</span></span><br><span class="line">- (<span class="built_in">NSNumber</span> *) lengthAsNumber;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// NumberConvience</span></span><br></pre></td></tr></table></figure>
<h3 id="12-1-3-implementation部分"><a href="#12-1-3-implementation部分" class="headerlink" title="12.1.3    @implementation部分"></a>12.1.3    @implementation部分</h3><p><em>NSString+NumberConvience.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NSString+NumberConvience.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">NumberConvience</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 获取NSNumber 类型的字符串长度</span><br><span class="line"> * @return &#123;NSNumber *&#125; 字符串长度</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSNumber</span> *) lengthAsNumber &#123;</span><br><span class="line">    <span class="comment">// 获得字符串长度：NSInteger 底层是个 long int</span></span><br><span class="line">    <span class="built_in">NSUInteger</span> length = [<span class="keyword">self</span> length];</span><br><span class="line">    <span class="comment">// 将字符串长度转换为 NSNumber 类型</span></span><br><span class="line">    <span class="keyword">return</span> ([<span class="built_in">NSNumber</span> numberWithUnsignedLong: length]);</span><br><span class="line">&#125;<span class="comment">// lengthAsNumber</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"NSString+NumberConvience.h"</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// 可变字典</span></span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="comment">// 添加键/值对</span></span><br><span class="line">        [dict setObject:[<span class="string">@"hello"</span> lengthAsNumber] forKey:<span class="string">@"hello"</span>];</span><br><span class="line">        [dict setObject:[<span class="string">@"iLikeFish"</span> lengthAsNumber] forKey:<span class="string">@"iLikeFish"</span>];</span><br><span class="line">        [dict setObject:[<span class="string">@"Once upon a time"</span> lengthAsNumber] forKey:<span class="string">@"Once upon a time"</span>];</span><br><span class="line">        <span class="comment">// 打印字典</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, dict);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-1-4-类别的缺陷"><a href="#12-1-4-类别的缺陷" class="headerlink" title="12.1.4    类别的缺陷"></a>12.1.4    类别的缺陷</h3><blockquote>
<p><strong>说明：</strong>类别有2个局限性</p>
<ul>
<li>无法向类中添加实例变量</li>
<li>当类别添加的方法和类中原有的方法重名时，类别具有更高的优先级</li>
</ul>
<p><strong>解决命名冲突：</strong>可以在类别的方法名中添加一个前缀，以确保不会发生名称冲突。<br><strong>添加实例变量：</strong>使用全局字典来存储对象与想关联的额外变量之间的映射。</p>
</blockquote>
<h3 id="12-1-5-类别的优势"><a href="#12-1-5-类别的优势" class="headerlink" title="12.1.5    类别的优势"></a>12.1.5    类别的优势</h3><blockquote>
<p><strong>说明：</strong>类别主要有3个用途</p>
<ul>
<li>将类的实现代码分散到多个不同文件或框架中</li>
<li>创建对私有方法的前向引用</li>
<li>向对象添加非正式协议（informal protocol）</li>
</ul>
</blockquote>
<h3 id="12-1-6-类扩展"><a href="#12-1-6-类扩展" class="headerlink" title="12.1.6    类扩展"></a>12.1.6    类扩展</h3><blockquote>
<p><strong>说名：</strong><code>类扩展（class extension）</code>是一个特殊的<code>类别</code>，它不需要命名(只有<code>@interface</code>没有<code>@implementation</code>)。</p>
<ul>
<li>可以包含源代码的类中使用</li>
<li>可以添加实例变量</li>
<li>可以将只读权限改成可读写的权限</li>
<li>创建数量不限</li>
</ul>
<p><strong>信息隐藏：</strong>分2种情况</p>
</blockquote>
<table>
<thead>
<tr>
<th><code>类扩展</code>所在文件</th>
<th>可访问性</th>
</tr>
</thead>
<tbody>
<tr>
<td>扩展的目标类的<code>@implementation</code>所在<code>.m</code>文件</td>
<td>目标类的内部</td>
</tr>
<tr>
<td>单独的私有<code>.h</code>文件</td>
<td>目标类的内部、目标类的子类和友类</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>可以拥有多个<code>类扩展</code>，不过这样会引发很难察觉的<code>bug</code>，所以请理智使用。</p>
</blockquote>
<p><em>Things.h：类的<code>@interface</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Things</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>) <span class="built_in">NSInteger</span> thing1;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> thing2;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)resetAllValues;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Things.m：类的<code>@implementation</code>和类扩展</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Things.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  在实现文件中添加类扩展（匿名类别）</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Things</span> ()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 添加实例变量</span></span><br><span class="line">    <span class="built_in">NSInteger</span> thing4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 修改原有属性的特性（只读－&gt;读写）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readwrite</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> thing2;</span><br><span class="line"><span class="comment">// 添加属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>) <span class="built_in">NSInteger</span> thing3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Things ()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  类的原始定义</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Things</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) resetAllValues &#123;</span><br><span class="line">    thing1 = <span class="number">100</span>;</span><br><span class="line">    thing2 = <span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Things</span></span><br></pre></td></tr></table></figure>
<p><em>main.m：使用被扩展后的<code>NSString</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        Things *things = [[Things alloc] init];</span><br><span class="line">        things.thing1 = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, things);</span><br><span class="line">        [things resetAllValues];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, things);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12-2-利用类别分散实现代码"><a href="#12-2-利用类别分散实现代码" class="headerlink" title="12.2    利用类别分散实现代码"></a>12.2    利用类别分散实现代码</h2><blockquote>
<p><strong>说明：</strong>如果想将大型的单个类分散到多个不同的<code>.m</code>文件中，可以使用<code>类别</code>。<br><strong>举例：</strong><code>AppKit</code>中的<code>NSWindow</code>，拥有大量的<code>类别</code>声明</p>
<ul>
<li><code>@interface NSWindow(NSKeyboardUI)</code></li>
<li><code>@interface NSWindow(NSToolbarSupport)</code></li>
<li><code>@interface NSWindow(NSDrag)</code></li>
<li><code>@interface NSWindow(NSCarbonExtensions)</code></li>
</ul>
<p><strong>扩展：</strong><code>类别</code>还可以将<code>方法</code>分散到<code>逻辑群组</code>中，使编程人员可以更加容易地阅读头<code>文件</code>。</p>
</blockquote>
<h3 id="在项目中使用类别"><a href="#在项目中使用类别" class="headerlink" title="在项目中使用类别"></a>在项目中使用类别</h3><blockquote>
<p><strong>说明：</strong>将类的<code>类别</code>的实现部分分散在三个独立的文件中。<br><img src="./屏幕快照 2016-01-20 下午10.54.50.png" alt="Alt text"></p>
</blockquote>
<p><em>CategoryThing.h：类的<code>@interface</code>和3个类别的<code>@interface</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CategoryThing</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> thing1;</span><br><span class="line">    <span class="built_in">NSInteger</span> thing2;</span><br><span class="line">    <span class="built_in">NSInteger</span> thing3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// CategoryThing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  类扩展：Thing1</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CategoryThing</span> (<span class="title">Thing1</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>) setThing1: (<span class="built_in">NSInteger</span>) thing1;</span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing1;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  类扩展：Thing2</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CategoryThing</span> (<span class="title">Thing2</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>) setThing2: (<span class="built_in">NSInteger</span>) thing2;</span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing2;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  类扩展：Thing3</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CategoryThing</span> (<span class="title">Thing3</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>) setThing3: (<span class="built_in">NSInteger</span>) thing3;</span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing3;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CategoryThing.m：类的<code>@implementation</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CategoryThing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CategoryThing</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  描述</span><br><span class="line"> *</span><br><span class="line"> *  @return 字符串表示的描述内容</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *) description &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *desc = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%ld %ld %ld"</span>, thing1, thing2, thing3];</span><br><span class="line">    <span class="keyword">return</span> (desc);</span><br><span class="line">&#125;<span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="comment">// CategoryThing</span></span><br></pre></td></tr></table></figure>
<p><em>CategoryThing+Thing1.m：类别Thing1的<code>@implementation</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CategoryThing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CategoryThing</span> (<span class="title">Thing1</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>)setThing1:(<span class="built_in">NSInteger</span>)t1</span><br><span class="line">&#123;</span><br><span class="line">    thing1 = t1;</span><br><span class="line">&#125; <span class="comment">// setThing1</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (thing1);</span><br><span class="line">&#125; <span class="comment">// thing1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// CategoryThing</span></span><br></pre></td></tr></table></figure>
<p><em>CategoryThing+Thing2.m：类别Thing2的<code>@implementation</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CategoryThing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CategoryThing</span> (<span class="title">Thing2</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setThing2:(<span class="built_in">NSInteger</span>)t2 &#123;</span><br><span class="line">    thing2 = t2;</span><br><span class="line">&#125; <span class="comment">// setthing2</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing2 &#123;</span><br><span class="line">    <span class="keyword">return</span> (thing2);</span><br><span class="line">&#125; <span class="comment">// thing2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>CategoryThing+Thing3.m：类别Thing3的<code>@implementation</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CategoryThing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CategoryThing</span> (<span class="title">Thing3</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setThing3:(<span class="built_in">NSInteger</span>)t3 &#123;</span><br><span class="line">    thing3 = t3;</span><br><span class="line">&#125; <span class="comment">// setthing3</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSInteger</span>) thing3 &#123;</span><br><span class="line">    <span class="keyword">return</span> (thing3);</span><br><span class="line">&#125; <span class="comment">// thing3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m：调用<code>类</code>通过<code>类别</code>扩展的功能</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"CategoryThing.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// 创建物品集合</span></span><br><span class="line">        CategoryThing *thing = [[CategoryThing alloc] init];</span><br><span class="line">        <span class="comment">// 调用通过“类别”扩展来的方法</span></span><br><span class="line">        [thing setThing1: <span class="number">5</span>];</span><br><span class="line">        [thing setThing2: <span class="number">23</span>];</span><br><span class="line">        [thing setThing3: <span class="number">42</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Things are %@"</span>, thing);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="12-3-通过类别创建前向引用"><a href="#12-3-通过类别创建前向引用" class="headerlink" title="12.3    通过类别创建前向引用"></a>12.3    通过类别创建前向引用</h2><blockquote>
<p><strong>背景：</strong><code>Objective-C</code>的<code>私有方法</code>分两种</p>
<ul>
<li>如果在一个类的<code>@implementation</code>部分定义了某个方法，而对应的<code>@interface</code>部分没有相应的方法声明</li>
<li>通过<code>类扩展（匿名类别）</code>扩展的方法</li>
</ul>
<p>然而，<code>O-C</code>并不真的支持<code>私有方法</code>，所以<code>私有方法</code>仍然可以通过对象调用，只不过这时<code>Xcode</code>会给出警告。<br><strong>说明：</strong>当从外部访问某个<code>类</code>的<code>私有方法</code>时，为了避免<code>Xcode</code>给出警告，可以通过<code>类别</code>补充一个声明，即<code>前向引导</code>。<br><strong>扩展：</strong>实际上，苹果公司官网在知道方针中指出，应用程序不能访问类里面的私有变量和方法，如果你的应用程序有这样的行为，那么苹果公司会拒绝让它上架。<br><em>main.m：在最前面创建<code>类别</code>来补充<code>私有方法</code>的声明</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> (<span class="title">Private</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) moveTireFromPosition: (<span class="keyword">int</span>) pos1 toPosition: (<span class="keyword">int</span>) pos2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>Car.m：方法的实现部分是Car的<code>私有方法</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>) moveTireFromPosition: (<span class="keyword">int</span>) pos1 toPosition: (<span class="keyword">int</span>) pos2 &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="12-4-非正式协议和委托类别"><a href="#12-4-非正式协议和委托类别" class="headerlink" title="12.4    非正式协议和委托类别"></a>12.4    非正式协议和委托类别</h2><blockquote>
<p><strong>委托：</strong>将某些工作交给另一个类执行就叫做<code>委托(delegate)</code>。<br><strong>委托对象：</strong><code>委托</code>技术中，被委托用来执行某些工作的<code>对象</code>。<br><strong>说明：</strong>除了通过<code>继承</code>创建<code>委托对象</code>外，可以通过<code>类别</code>扩展<code>NSObject</code>（即创建了一个<code>非正式协议</code>），使其获得<code>委托方法</code>，从而将任何对象都变成<code>委托对象</code>。</p>
</blockquote>
<h3 id="12-4-1-iTunesFinder项目"><a href="#12-4-1-iTunesFinder项目" class="headerlink" title="12.4.1    iTunesFinder项目"></a>12.4.1    iTunesFinder项目</h3><blockquote>
<p><strong>说明：</strong>用来说明<code>Cocoa</code>中是如何使用<code>委托</code>技术的。</p>
</blockquote>
<h4 id="Bonjour"><a href="#Bonjour" class="headerlink" title="Bonjour"></a>Bonjour</h4><blockquote>
<p><strong>说明：</strong>查找由<code>Bonjour</code>发布的网络服务的<code>Cocoa类</code>是<code>NSNetServiceBrowser</code>。<br><strong>用法：</strong>告诉<code>网络服务浏览器</code>你需要的服务，并为其提供一个<code>委托对象</code>。<code>浏览器对象</code>将会向该<code>委托对象</code>发送消息，告知其发现新服务的时间。<br><em>ITunesFinder.h</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ITunesFinder</span> : <span class="title">NSObject</span> &lt;<span class="title">NSNetServiceBrowserDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ITunesFinder.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ITunesFinder.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ITunesFinder</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  找到了网络服务时的回调方法</span><br><span class="line"> *</span><br><span class="line"> *  @param b          网络服务浏览器对象</span><br><span class="line"> *  @param service    被发现的服务</span><br><span class="line"> *  @param moreComing 一批通知是否已经完成的标记</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowser:(<span class="built_in">NSNetServiceBrowser</span> *) b</span><br><span class="line">            didFindService:(<span class="built_in">NSNetService</span> *) service</span><br><span class="line">                moreComing:(<span class="built_in">BOOL</span>) moreComing &#123;</span><br><span class="line">    <span class="comment">// 获取关于该服务的所有有趣的属性</span></span><br><span class="line">    [service resolveWithTimeout:<span class="number">10</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"found one! Name is %@"</span>, [service name]);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// didFindService</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  某个网络服务消失时的回调方法（用于状态刷新）</span><br><span class="line"> *</span><br><span class="line"> *  @param b          网络服务浏览器对象</span><br><span class="line"> *  @param service    被发现的服务</span><br><span class="line"> *  @param moreComing 一批通知是否已经完成的标记</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowser:(<span class="built_in">NSNetServiceBrowser</span> *) b</span><br><span class="line">          didRemoveService:(<span class="built_in">NSNetService</span> *) service</span><br><span class="line">                moreComing:(<span class="built_in">BOOL</span>) moreComing</span><br><span class="line">&#123;</span><br><span class="line">    [service resolveWithTimeout:<span class="number">10</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"lost one! Name is %@"</span>, [service name]);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// didRemoveService</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// ITunesFinder</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ITunesFinder.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建 网络服务浏览器对象</span></span><br><span class="line">        <span class="built_in">NSNetServiceBrowser</span> *browser = [[<span class="built_in">NSNetServiceBrowser</span> alloc] init];</span><br><span class="line">        <span class="comment">// 创建 委托对象（自定义的查找iTunes资源的对象）</span></span><br><span class="line">        ITunesFinder *finder = [[ITunesFinder alloc] init];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通知 网络服务浏览器对象所使用的委托对象为自定义的 ITunes 对象</span></span><br><span class="line">        [browser setDelegate:finder];</span><br><span class="line">        <span class="comment">// 搜索 iTunes 共享（使用TCP协议、只在本地网络中）</span></span><br><span class="line">        [browser searchForServicesOfType:<span class="string">@"_daap._tcp"</span></span><br><span class="line">                                inDomain:<span class="string">@"local."</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"begun browsing"</span>);</span><br><span class="line">        <span class="comment">// run循环（在 网络服务浏览器 发现新的 iTunes 共享之前会一直保持运行而不返回，即阻塞在此处而不执行后面的代码）</span></span><br><span class="line">        [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-4-2-委托和类别"><a href="#12-4-2-委托和类别" class="headerlink" title="12.4.2    委托和类别"></a>12.4.2    委托和类别</h3><blockquote>
<p><strong>说明：</strong>除了通过<code>继承</code>创建<code>委托对象</code>外，可以通过<code>类别</code>扩展<code>NSObject</code>（即创建了一个<code>非正式协议</code>），使其获得<code>委托方法</code>，从而将任何对象都变成<code>委托对象</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">NSNetServerBrowserDelegateMethods</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowserWillSearch: (<span class="built_in">NSNetServiceBrowser</span> *) browser;</span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowser:(<span class="built_in">NSNetServiceBrowser</span> *) b didFindService:(<span class="built_in">NSNetService</span> *) service moreComing:(<span class="built_in">BOOL</span>) moreComing;</span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowserDidStopSearch: (<span class="built_in">NSNetServiceBrowser</span> *) browser;</span><br><span class="line">- (<span class="keyword">void</span>) netServiceBrowser:(<span class="built_in">NSNetServiceBrowser</span> *) b didRemoveService:(<span class="built_in">NSNetService</span> *) service moreComing:(<span class="built_in">BOOL</span>) moreComing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="12-4-3-响应选择器"><a href="#12-4-3-响应选择器" class="headerlink" title="12.4.3    响应选择器"></a>12.4.3    响应选择器</h3><blockquote>
<p><strong>说明：</strong><code>NSNetServiceBrowser</code>为了确定其<code>委托对象</code>是否能够处理那些发送给它的消息，会首先检查对象，询问其能否响应该选择器，是泽发送消息，否则忽略这个委托对象，程序继续运行。</p>
</blockquote>
<h4 id="选择器（selector）"><a href="#选择器（selector）" class="headerlink" title="选择器（selector）"></a>选择器（selector）</h4><blockquote>
<p><strong>说明：</strong>只是一个方法名称，但以<code>Objective-C</code>运行时使用的特殊方式编码，以快速执行查询。<br><strong>语法：</strong><code>@selector(方法名)</code><br><strong>用途：</strong><code>NSObject</code>提供了一个名为<code>responendsToSelector</code>的方法，该方法询问对象以确定其是否能够响应某个特定的消息。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Car *car = [[Car alloc] init];</span><br><span class="line"><span class="keyword">if</span> ([car responengsToSelector: <span class="keyword">@selector</span>(setEngine:)]) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"yowza!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-4-4-选择器的其它应用"><a href="#12-4-4-选择器的其它应用" class="headerlink" title="12.4.4    选择器的其它应用"></a>12.4.4    选择器的其它应用</h3><blockquote>
<p><strong>说明：</strong>选择器可以</p>
<ul>
<li>被传递</li>
<li>作为方法的参数</li>
<li>作为实例变量被存储</li>
</ul>
<p><strong>举个例子：</strong><code>Foundation</code>框架中的<code>NSTimer</code></p>
</blockquote>
<h2 id="12-5-小结"><a href="#12-5-小结" class="headerlink" title="12.5    小结"></a>12.5    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_11 属性/" itemprop="url">
                  11 属性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:40:03+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_11 属性/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_11 属性/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>O-C 2.0</code>引入了<code>属性（property）</code>，即<code>@property</code>预编译指令，它组合了新的预编译指令和新的属性访问器语法。<br><strong>用途：</strong>除非自己定义了相关代码，否则<code>@property</code>会根据<code>特性</code>自动生成属性及其<code>setter</code>和<code>getter</code>的声明和实现。<br><strong>兼容性：</strong><code>10.5+</code><br><strong>语法：</strong><code>@property[(特性)] 实例变量类型 实例变量名;</code><br><strong>注意：</strong>还有一个编译指令<code>@synthesize</code>，用来配合<code>@property</code>生成<code>getter</code>和<code>setter</code>的实现，可以省略（<code>XCode 4.4</code>之后）。</p>
</blockquote>
<h2 id="11-1-使用属性值"><a href="#11-1-使用属性值" class="headerlink" title="11.1    使用属性值"></a>11.1    使用属性值</h2><p><em>AllWeatherRadial.h</em></p>
<blockquote>
<p><strong>说明：</strong>对需要设置<code>setter</code>和<code>getter</code>的实例变量使用<code>@property</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AllWeatherRadial</span> : <span class="title">Tire</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 轮胎再潮湿的道路上的性能</span></span><br><span class="line">    <span class="keyword">float</span> rainHandling;</span><br><span class="line">    <span class="keyword">float</span> snowHandling;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对需要设置setter和getter的实例变量使用@property(不在需要为每个属性分别声明setter和getter)</span></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> rainHandling;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> snowHandling;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// AllWeatherRadial</span></span><br></pre></td></tr></table></figure>
<p><em>AllWeatherRadial.m</em></p>
<blockquote>
<p><strong>说明：</strong>不需要实现被设置了<code>@propery</code>的实例属性的<code>getter</code>和<code>setter</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AllWeatherRadial.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AllWeatherRadial</span></span></span><br><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) p treadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithPressure: p treadDepth:td]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *) description &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *desc;</span><br><span class="line">    desc = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"AllWeatherRadial: %.1f / %.1f / %.1f / %.1f"</span>, [<span class="keyword">self</span> pressure], [<span class="keyword">self</span> treadDepth], [<span class="keyword">self</span> rainHandling], [<span class="keyword">self</span> snowHandling]];</span><br><span class="line">    <span class="keyword">return</span> (desc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<blockquote>
<p><strong>说明：</strong>调用相应的属性的<code>setter</code>和<code>getter</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AllWeatherRadial.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Slant6.h"</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// 车身</span></span><br><span class="line">        Car *car = [[Car alloc] init];</span><br><span class="line">        <span class="comment">// 安装轮胎</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            AllWeatherRadial *tire;</span><br><span class="line">            tire = [[AllWeatherRadial alloc] init];</span><br><span class="line">            <span class="comment">// 调用通过@property指令获得的setter和getter</span></span><br><span class="line">            [tire setRainHandling:<span class="number">23</span> + i];</span><br><span class="line">            [tire setSnowHandling:<span class="number">33</span> - i];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"tire %d's handling is %.f %.f"</span>, i, [tire rainHandling], [tire snowHandling]);</span><br><span class="line">            [car setTire:tire atIndex:i];</span><br><span class="line">            [tire release];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 安装引擎</span></span><br><span class="line">        Engine *engine = [[Slant6 alloc] init];</span><br><span class="line">        [car setEngine:engine];</span><br><span class="line">        <span class="comment">// 使用Car</span></span><br><span class="line">        [car print];</span><br><span class="line">        [car release];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-1-1-简化接口代码"><a href="#11-1-1-简化接口代码" class="headerlink" title="11.1.1    简化接口代码"></a>11.1.1    简化接口代码</h3><h3 id="11-1-2-简化实现代码"><a href="#11-1-2-简化实现代码" class="headerlink" title="11.1.2    简化实现代码"></a>11.1.2    简化实现代码</h3><h3 id="11-1-3-点表达式的妙用"><a href="#11-1-3-点表达式的妙用" class="headerlink" title="11.1.3    点表达式的妙用"></a>11.1.3    点表达式的妙用</h3><blockquote>
<p><strong>说明：</strong><code>O-C 2.0</code>引入的新的语法特性，可以更加容易地访问对象的属性。<br><strong>限制：</strong>只能用于对象属性的<code>setter</code>或<code>getter</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getter</span></span><br><span class="line">tire.rainHandling = <span class="number">20</span> + i;</span><br><span class="line">tire.snowHandling = <span class="number">28</span> + i;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"tire %d's handling is %.f %.f"</span>, i, tire.rainHandling, tire.snowHandling);</span><br></pre></td></tr></table></figure>
<h2 id="11-2-属性扩展"><a href="#11-2-属性扩展" class="headerlink" title="11.2    属性扩展"></a>11.2    属性扩展</h2><blockquote>
<p><strong>说明：</strong><code>@property</code>对如何生成代码还有一些<code>特性</code>可以指定，这些<code>特性</code>将影响<code>setter</code>代码的生成。</p>
</blockquote>
<table>
<thead>
<tr>
<th><code>@property</code>特性</th>
<th>说明</th>
<th>适用</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>assign</td>
<td>简单赋值，不更改<code>引用计数</code></td>
<td>基础数据类型和C数据类型</td>
<td>默认</td>
</tr>
<tr>
<td>copy</td>
<td>通过就对象复制出一个新对象（引用计数为1），并<code>释放</code>旧对象</td>
<td>不可变对象（例如NSString）</td>
<td></td>
</tr>
<tr>
<td>retain</td>
<td><code>释放</code>旧对象，将旧对象的值赋予输入对象，再<code>保留</code>输入对象</td>
<td>其它<code>O-C</code>对象</td>
<td></td>
</tr>
<tr>
<td>nonatomic</td>
<td>非线程安全</td>
<td>所有类型</td>
<td>默认，性能更好</td>
</tr>
<tr>
<td>atomic</td>
<td>某种程度的线程安全</td>
<td>所有类型</td>
<td>在多线程的环境保证<code>get</code>和<code>set</code>正确执行，但前提是是使用<code>@synthesize</code>生成的实现</td>
</tr>
<tr>
<td>readwrite</td>
<td>可读写</td>
<td>所有类型</td>
<td>默认</td>
</tr>
<tr>
<td>readonly</td>
<td>只读</td>
<td>所有类型</td>
<td>只生成<code>getter</code></td>
</tr>
<tr>
<td>getter=getter名称</td>
<td>指定生成的<code>getter</code>方法名</td>
<td>所有类型</td>
<td>默认为<code>属性名</code></td>
</tr>
<tr>
<td>setter=setter名称</td>
<td>指定生成的<code>setter</code>方法名</td>
<td>所有类型</td>
<td><code>set属性名</code>，匈牙利命名法</td>
</tr>
</tbody>
</table>
<h4 id="使用-property"><a href="#使用-property" class="headerlink" title="使用@property"></a>使用<code>@property</code></h4><blockquote>
<p><strong>说明：</strong><code>name</code>属性为<code>@property(copy)</code>，<code>engine</code>属性为<code>@property(retain)</code></p>
</blockquote>
<p><em>Car.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name;</span><br><span class="line">    Engine *engine;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *) name;</span><br><span class="line">- (<span class="keyword">void</span>) setName: (<span class="built_in">NSString</span> *) newName;</span><br><span class="line">- (Engine *) engine;</span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (retain) Engine *engine;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>Car.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line">- (<span class="built_in">NSString</span> *) name &#123;</span><br><span class="line">	<span class="keyword">return</span> (name);</span><br><span class="line">&#125;<span class="comment">// name</span></span><br><span class="line">- (<span class="keyword">void</span>) setName: (<span class="built_in">NSString</span> *) newName &#123;</span><br><span class="line">	[name release];</span><br><span class="line">	name = [newName <span class="keyword">copy</span>];</span><br><span class="line">&#125;<span class="comment">// setName</span></span><br><span class="line"></span><br><span class="line">- (Engine *) engine &#123;</span><br><span class="line">    <span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine &#123;</span><br><span class="line">    [newEngine retain];</span><br><span class="line">    [engine release];</span><br><span class="line">    engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h4 id="不使用-property"><a href="#不使用-property" class="headerlink" title="不使用@property"></a>不使用<code>@property</code></h4><p><em>Car.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name;</span><br><span class="line">    Engine *engine;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用copy特性</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">copy</span>) <span class="built_in">NSString</span> name;</span><br><span class="line"><span class="comment">// 使用retain特性</span></span><br><span class="line"><span class="keyword">@property</span>(retain) Engine *engine;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>Car.m</em></p>
<blockquote>
<p><strong>说明：</strong><code>@synthesize</code>用来生成成员变量的<code>setter</code>和<code>getter</code>的实现。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"><span class="comment">// xcode4.4 之后@synthesize就不再需要了</span></span><br><span class="line"><span class="keyword">@synthesize</span> name;</span><br><span class="line"><span class="keyword">@synthesize</span> engine;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h3 id="11-2-1-名称的使用"><a href="#11-2-1-名称的使用" class="headerlink" title="11.2.1    名称的使用"></a>11.2.1    名称的使用</h3><p><em>Car.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *appellation;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><em>Car.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"><span class="keyword">@synthesize</span> name = appellation;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="11-2-2-只读属性"><a href="#11-2-2-只读属性" class="headerlink" title="11.2.2    只读属性"></a>11.2.2    只读属性</h3><blockquote>
<p><strong>说明：</strong>假设某个属性，不想让任何人修改它，则可以对这个<code>@property</code>使用<code>readonly</code>特性，这时，只生成一个<code>getter</code>方法而不会生成<code>setter</code>。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Me</span>: <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">float</span> showSize;</span><br><span class="line">	<span class="built_in">NSString</span> *licenseNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="keyword">float</span> showSize;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">NSString</span> *licenseNumber;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="11-2-3-自己动手有时更好"><a href="#11-2-3-自己动手有时更好" class="headerlink" title="11.2.3    自己动手有时更好"></a>11.2.3    自己动手有时更好</h3><h4 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h4><blockquote>
<p><strong>说明：</strong>可以通过<code>@property</code>配合<code>@dynamic</code>指令告诉编译器不生成人和代码或实例变量，通过自定义的<code>getter</code>创建一个能在运行时计算出此值的访问方法。<br><strong>注意：</strong>如果使用了<code>@dynamic</code>指令，并企图调用不存在的<code>getter</code>或<code>setter</code>方法，你将会的到一个报错。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @property</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="keyword">float</span> bodyMassIndex;</span><br><span class="line"><span class="comment">// @dynamic</span></span><br><span class="line"><span class="keyword">@dynamic</span> bodyMassIndex;</span><br><span class="line"><span class="comment">// getter</span></span><br><span class="line">- (<span class="keyword">float</span>) bodyMassIndex &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="指定getter和setter方法名"><a href="#指定getter和setter方法名" class="headerlink" title="指定getter和setter方法名"></a>指定getter和setter方法名</h4><blockquote>
<p><strong>说明：</strong>可以通过<code>@property(getter=getter名称)</code>和<code>@property(setter=setter名称)</code>自定义<code>geter</code>和<code>setter</code>方法的名称。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getter为isHidden，setter为setHidden（默认）</span></span><br><span class="line"><span class="keyword">@property</span> (getter=isHidden) <span class="built_in">BOOL</span> hidden;</span><br></pre></td></tr></table></figure>
<h3 id="11-2-4-特性不是万能的"><a href="#11-2-4-特性不是万能的" class="headerlink" title="11.2.4    特性不是万能的"></a>11.2.4    特性不是万能的</h3><blockquote>
<p><strong>说明：</strong><code>@property</code>只能生成严格意义上的<code>getter</code>和<code>setter</code>，不支持那些需要接收额外参数的方法。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setter有额外的参数</span></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire atIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"><span class="comment">// getter有额外的参数</span></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index;</span><br></pre></td></tr></table></figure>
<h2 id="11-3-小结"><a href="#11-3-小结" class="headerlink" title="11.3    小结"></a>11.3    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_10 对象初始化/" itemprop="url">
                  10 对象初始化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:39:41+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_10 对象初始化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_10 对象初始化/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>创建对象有两种方式</p>
<ul>
<li><code>类名 new</code></li>
<li><code>[[类名 alloc] init]</code></li>
</ul>
<p><strong>技巧：</strong><code>Cocoa</code>惯例是使用后一种方式</p>
</blockquote>
<h2 id="10-1-分配对象"><a href="#10-1-分配对象" class="headerlink" title="10.1    分配对象"></a>10.1    分配对象</h2><blockquote>
<p><strong>说明：</strong>就是从操作系统获得一块内存，并将其指定为存放对象的实例变量的位置。<br><strong>语法：</strong>像某个类发送<code>alloc</code>消息</p>
</blockquote>
<h4 id="alloc实例方法"><a href="#alloc实例方法" class="headerlink" title="alloc实例方法"></a>alloc实例方法</h4><blockquote>
<p><strong>说明：</strong>为类实例分配一块足够大的内存，并将这块内存区域全部初始化为对应的<code>0</code>值</p>
</blockquote>
<table>
<thead>
<tr>
<th>实例变量类型</th>
<th><code>0</code>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>BOOL</td>
<td>NO</td>
</tr>
<tr>
<td>int</td>
<td>0</td>
</tr>
<tr>
<td>float</td>
<td>0.0</td>
</tr>
<tr>
<td>指针</td>
<td>nil</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>刚刚分配的对象不能立即使用，初始化后才能使用。<code>Objective-C</code>将对象的创建拆分为两个明确的步骤：<code>分配</code>和<code>初始化</code>。<br><strong>扩展：</strong>有些语言（包括<code>c++</code>和<code>java</code>）使用构造函数在一次操作中便执行完对象的分配和初始化。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分配</span></span><br><span class="line">Car *car = [Car alloc];<span class="comment">// 还需要init，之后才能使用</span></span><br></pre></td></tr></table></figure>
<h3 id="10-1-1-初始化对象"><a href="#10-1-1-初始化对象" class="headerlink" title="10.1.1    初始化对象"></a>10.1.1    初始化对象</h3><blockquote>
<p><strong>说明：</strong>从操作系统取得一块内存（不一定是<code>分配</code>的内存）用于存储对象。<br><strong>语法：</strong>通过嵌套方式向<code>分配</code>操作的返回值发送<code>init</code>消息。<br><strong>注意：</strong><code>init</code>方法返回的对象可能与<code>分配</code>的对象不同，因为某些类型底层其实是<code>类蔟</code>。</p>
</blockquote>
<p><em>错误示例</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Car *car = [Car alloc];</span><br><span class="line"><span class="comment">// 我们需要的是init后的对象，car指向的对象未必和init返回的是一个对象</span></span><br><span class="line">[car init];</span><br></pre></td></tr></table></figure>
<p><em>正确示例</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Car *car = [[Car alloc] init];</span><br></pre></td></tr></table></figure>
<h3 id="10-1-2-编写初始化方法"><a href="#10-1-2-编写初始化方法" class="headerlink" title="10.1.2    编写初始化方法"></a>10.1.2    编写初始化方法</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">id</span>) init &#123;</span><br><span class="line">	<span class="comment">// 1. 兼容超类返回nil的情况</span></span><br><span class="line">	<span class="comment">// 2. 更新self表示的内存位置（因为超类的init可能返回另一个位置）</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">		<span class="comment">// ...	</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-1-3-初始化时要做些什么"><a href="#10-1-3-初始化时要做些什么" class="headerlink" title="10.1.3    初始化时要做些什么"></a>10.1.3    初始化时要做些什么</h3><blockquote>
<p><strong>说明：</strong>有两种方式可以选择，取决于灵活性和性能的权衡</p>
</blockquote>
<table>
<thead>
<tr>
<th>是否为实例变量创建对象</th>
<th>说明</th>
<th>适用</th>
</tr>
</thead>
<tbody>
<tr>
<td>是</td>
<td>方便，一步到位，出产即用</td>
<td>实例变量不需要定制</td>
</tr>
<tr>
<td>否</td>
<td>在某些情况下避免资源的浪费</td>
<td>实例变量需要定制</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>扩展：</strong><code>惰性求值</code>，指的是即是目前没有设置自定义属性的值，也等到调用着需要时再创建对象，可以提高程序的性能。</p>
</blockquote>
<h2 id="10-2-便利初始化函数"><a href="#10-2-便利初始化函数" class="headerlink" title="10.2    便利初始化函数"></a>10.2    便利初始化函数</h2><blockquote>
<p><strong>说明：</strong>相比<code>init</code>，完成某些额外的初始化工作，名称以<code>init</code>开头。<br><strong>适用：</strong>加入对象必须要用某些信息进行初始化，那么应该将这些信息作为init方法的一部分添加进来。</p>
</blockquote>
<h3 id="initWithContentsofFile便利初始化方法"><a href="#initWithContentsofFile便利初始化方法" class="headerlink" title="initWithContentsofFile便利初始化方法"></a>initWithContentsofFile便利初始化方法</h3><blockquote>
<p><strong>说明：</strong>打开指定路径上的文本文件，读取文件内容，并即用文件内容初始化为一个字符串。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;/**</span><br><span class="line">&gt;* @param &#123;nonnull NSString *&#125; 非空字符串</span><br><span class="line">&gt;* @param &#123;nullable NSStringEncoding *&#125; usedEncoding 编码方式</span><br><span class="line">&gt;* @param &#123;NSError * _Nullable __autoreleasing * _Nullable&#125; error 错误对象</span><br><span class="line">&gt;* @return &#123;instancetype _Nullable&#125; 字符串对象（可以为空）</span><br><span class="line">&gt;*/</span><br><span class="line">&gt;- (instancetype _Nullable) initWithContentsOfFile:(nonnull NSString *) usedEncoding: (nullable NSStringEncoding *) error:(NSError * _Nullable __autoreleasing * _Nullable);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误</span></span><br><span class="line"><span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line"><span class="comment">// 编码</span></span><br><span class="line"><span class="built_in">NSStringEncoding</span> encoding = <span class="built_in">NSUTF8StringEncoding</span>;</span><br><span class="line"><span class="comment">// 读取文件</span></span><br><span class="line"><span class="built_in">NSString</span> *string = [[<span class="built_in">NSString</span> alloc] initWithContentsOfFile:<span class="string">@"/tmp/words.txt"</span> usedEncoding:&amp;encoding error:&amp;error];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取出错</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">nil</span> != error) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Unable to read data from file, %@"</span>, [error localizedDescription]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 读取成功</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-3-更多部件改进"><a href="#10-3-更多部件改进" class="headerlink" title="10.3    更多部件改进"></a>10.3    更多部件改进</h2><blockquote>
<p><strong>注意：</strong>如果做<code>iOS</code>开发，由于不支持垃圾回收，必须使用<code>ARC</code>技术。</p>
</blockquote>
<h3 id="10-3-1-Tire类的初始化"><a href="#10-3-1-Tire类的初始化" class="headerlink" title="10.3.1    Tire类的初始化"></a>10.3.1    Tire类的初始化</h3><p><em>Tire.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Tire</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 轮胎压力</span></span><br><span class="line">    <span class="keyword">float</span> pressure;</span><br><span class="line">    <span class="comment">// 轮胎花纹</span></span><br><span class="line">    <span class="keyword">float</span> treadDepth;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) setPressure: (<span class="keyword">float</span>) pressure;</span><br><span class="line">- (<span class="keyword">float</span>) pressure;</span><br><span class="line">- (<span class="keyword">void</span>) setTreadDepth: (<span class="keyword">float</span>) treadDepth;</span><br><span class="line">- (<span class="keyword">float</span>)treadDepth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Tire.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Tire</span></span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">- (<span class="keyword">id</span>) init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        pressure = <span class="number">34.0</span>;</span><br><span class="line">        treadDepth = <span class="number">20.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setPressure:(<span class="keyword">float</span>) p &#123;</span><br><span class="line">    pressure = p;</span><br><span class="line">&#125;<span class="comment">// setPressure</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">float</span>) pressure &#123;</span><br><span class="line">    <span class="keyword">return</span> (pressure);</span><br><span class="line">&#125;<span class="comment">// pressure</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTreadDepth:(<span class="keyword">float</span>) td &#123;</span><br><span class="line">    treadDepth = td;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">float</span>) treadDepth &#123;</span><br><span class="line">    <span class="keyword">return</span> treadDepth;</span><br><span class="line">&#125;<span class="comment">// treadDepth</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *) description &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *desc;</span><br><span class="line">    <span class="comment">// 不是通过alloc、copy、new创建的，按照内存管理规则，不需要做什么（可以认为它被加入到了自动释放池中）</span></span><br><span class="line">    desc = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Tire: Pressure: %.1f TreadDepth: %1f"</span>, pressure, treadDepth];</span><br><span class="line">    <span class="keyword">return</span> (desc);</span><br><span class="line">&#125;<span class="comment">// description</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="10-3-2-更新main-函数"><a href="#10-3-2-更新main-函数" class="headerlink" title="10.3.2    更新main()函数"></a>10.3.2    更新main()函数</h3><p><em>既没有启用<code>ARC</code>，也没有启用<code>垃圾回收</code>的情形－手动管理</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Slant6.h"</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// 车身</span></span><br><span class="line">        Car *car = [[Car alloc] init];</span><br><span class="line">        <span class="comment">// 安装轮胎</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            Tire *tire;</span><br><span class="line">            tire = [[Tire alloc] init];</span><br><span class="line">            [tire setPressure:<span class="number">23</span> + i];</span><br><span class="line">            [tire setTreadDepth:<span class="number">33</span> - i];</span><br><span class="line">            [car setTire:tire atIndex:i];</span><br><span class="line">            <span class="comment">// 按照内存管理规则，应当释放一次，其余交给自动释放池</span></span><br><span class="line">            [tire release];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 安装引擎</span></span><br><span class="line">        Engine *engine = [[Slant6 alloc] init];</span><br><span class="line">        [car setEngine:engine];</span><br><span class="line">        <span class="comment">// 使用Car</span></span><br><span class="line">        [car print];</span><br><span class="line">        <span class="comment">// 按照内存管理规则，应当释放一次，其余交给自动释放池</span></span><br><span class="line">        [car release];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>启用了<code>ARC</code>或<code>垃圾回收</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Slant6.h"</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 车身</span></span><br><span class="line">    Car *car = [[Car alloc] init];</span><br><span class="line">    <span class="comment">// 安装轮胎</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        Tire *tire;</span><br><span class="line">        tire = [[Tire alloc] init];</span><br><span class="line">        [tire setPressure:<span class="number">23</span> + i];</span><br><span class="line">        [tire setTreadDepth:<span class="number">33</span> - i];</span><br><span class="line">        [car setTire:tire atIndex:i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 安装引擎</span></span><br><span class="line">    Engine *engine = [[Slant6 alloc] init];</span><br><span class="line">    [car setEngine:engine];</span><br><span class="line">    <span class="comment">// 使用Car</span></span><br><span class="line">    [car print];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-3-3-清理Car类"><a href="#10-3-3-清理Car类" class="headerlink" title="10.3.3    清理Car类"></a>10.3.3    清理Car类</h3><p><em>Car.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用可变数组代替C数组（Tire *tires[4]），就不用上限检查了</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *tires;</span><br><span class="line">    Engine *engine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line">- (Engine *) engine;</span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire atIndex: (<span class="keyword">int</span>) index;</span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index;</span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>Car.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        engine = [Engine new];</span><br><span class="line">        tires = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">        <span class="comment">// 将每个轮胎初始化为null</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            [tires addObject: [<span class="built_in">NSNull</span> null]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Engine *) engine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine &#123;</span><br><span class="line">    [newEngine retain];</span><br><span class="line">    [engine release];</span><br><span class="line">    engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire atIndex: (<span class="keyword">int</span>) index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in setTire:atIndex:"</span>,</span><br><span class="line">               index);</span><br><span class="line">        exit (<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [tires replaceObjectAtIndex:index withObject:tire];</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// setTire:atIndex:</span></span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in tireAtIndex:"</span>,</span><br><span class="line">               index);</span><br><span class="line">        exit (<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Tire *tire;</span><br><span class="line">    tire = [tires objectAtIndex:index];</span><br><span class="line">    <span class="keyword">return</span> (tire);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// tireAtIndex:</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 不直接访问数组，避免代码收到将来更改的影响</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="keyword">self</span> tireAtIndex: i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, engine);</span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 确保car对象呗销毁时所有的内存都被回收</span><br><span class="line"> * @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) dealloc &#123;</span><br><span class="line">    [tires release];</span><br><span class="line">    [engine release];</span><br><span class="line">    [<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h2 id="10-4-Car-类的内存清理（垃圾回收方式和ARC方式）"><a href="#10-4-Car-类的内存清理（垃圾回收方式和ARC方式）" class="headerlink" title="10.4    Car 类的内存清理（垃圾回收方式和ARC方式）"></a>10.4    Car 类的内存清理（垃圾回收方式和ARC方式）</h2><blockquote>
<p><strong>说明：</strong>启用了<code>垃圾回收</code>或<code>ARC</code>，则不用手动管理内存。</p>
<ul>
<li>不再需要手动<code>释放</code>或<code>保留</code></li>
<li>不需要重写<code>dealloc</code>方法完成内存的清理，如果要销毁时执行一些特别的操作，可以重写<code>-finalize</code>方法</li>
</ul>
<p><strong>注意：</strong>启用了<code>垃圾回收</code>则不需要<code>@autoreleasepool</code>；启用<code>ARC</code>，则代码中必要时仍然可以使用<code>@autoreleasepool</code>。</p>
</blockquote>
<h3 id="构造便利初始化函数"><a href="#构造便利初始化函数" class="headerlink" title="构造便利初始化函数"></a>构造便利初始化函数</h3><blockquote>
<p><strong>说明：</strong>构造一个能同时获取轮胎压力和花纹深度的便利初始化函数。</p>
</blockquote>
<p><em>Tire.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) pressure treadDepth: (<span class="keyword">float</span>) treadDepth;</span><br></pre></td></tr></table></figure>
<p><em>Tire.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) p treadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        pressure = p;</span><br><span class="line">        treadDepth = td;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// initWithPressure: treadDepth</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Tire *tire;</span><br><span class="line">tire = [[Tire alloc] initWithPressure: <span class="number">23</span> + i treadDepth: <span class="number">33</span> - i];</span><br></pre></td></tr></table></figure>
<h2 id="10-5-指定初始化函数"><a href="#10-5-指定初始化函数" class="headerlink" title="10.5    指定初始化函数"></a>10.5    指定初始化函数</h2><blockquote>
<p><strong>说明：</strong>先增加几个<code>便利初始化函数</code></p>
</blockquote>
<p><em>Tire.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) pressure treadDepth: (<span class="keyword">float</span>) treadDepth;</span><br><span class="line">- (<span class="keyword">id</span>) initWithTreadDepth: (<span class="keyword">float</span>) treadDepth;</span><br><span class="line">- (<span class="keyword">id</span>) initWithPressure:(<span class="keyword">float</span>)pressure;</span><br></pre></td></tr></table></figure>
<p><em>Tire.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) p treadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        pressure = p;</span><br><span class="line">        treadDepth = td;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// initWithPressure: treadDepth</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithTreadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        treadDepth = td;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// initWithTreadDepth</span></span><br></pre></td></tr></table></figure>
<h3 id="10-5-1-子类化问题"><a href="#10-5-1-子类化问题" class="headerlink" title="10.5.1    子类化问题"></a>10.5.1    子类化问题</h3><blockquote>
<p><strong>说明：</strong><code>指定初始化函数</code>，即该中的某个初始化方法被指派为指定初始化函数，该类的所有初始化方法都调用指定初始化函数完成初始化。<br><strong>技巧：</strong>通常，接收参数最多的初始化方法是最终的指定初始化函数。</p>
</blockquote>
<h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><blockquote>
<p><strong>说明：</strong><code>AllWeatherRadial</code>的超类<code>Tire</code>中的构造器都没有使用<code>指定初始化函数</code>，导致<code>AllWeatherRadial</code>需要重写所有<code>Tire</code>的构造器完成对自身实例变量的初始化。</p>
</blockquote>
<p><em>AllWeatherRadial.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AllWeatherRadial</span> : <span class="title">Tire</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 轮胎再潮湿的道路上的性能</span></span><br><span class="line">    <span class="keyword">float</span> rainHandling;</span><br><span class="line">    <span class="keyword">float</span> snowHandling;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) setRainHandling: (<span class="keyword">float</span>) rainHandling;</span><br><span class="line">- (<span class="keyword">float</span>) rainHandling;</span><br><span class="line">- (<span class="keyword">void</span>) setSnowHandling: (<span class="keyword">float</span>) snowHandling;</span><br><span class="line">- (<span class="keyword">float</span>) snowHandling;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// AllWeatherRadial</span></span><br></pre></td></tr></table></figure>
<p><em>AllWeatherRadial.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AllWeatherRadial.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AllWeatherRadial</span></span></span><br><span class="line">- (<span class="keyword">void</span>) setRainHandling:(<span class="keyword">float</span>) rh &#123;</span><br><span class="line">    rainHandling = rh;</span><br><span class="line">&#125;<span class="comment">// setRainHandling</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">float</span>) rainHandling &#123;</span><br><span class="line">    <span class="keyword">return</span> (rainHandling);</span><br><span class="line">&#125;<span class="comment">// rainHandling</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setSnowHandling: (<span class="keyword">float</span>) sh &#123;</span><br><span class="line">    snowHandling = sh;</span><br><span class="line">&#125;<span class="comment">// setSnowHandling</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">float</span>) snowHandling &#123;</span><br><span class="line">    <span class="keyword">return</span> (snowHandling);</span><br><span class="line">&#125;<span class="comment">// snowHandling</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *) description &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *desc;</span><br><span class="line">    desc = [[<span class="built_in">NSString</span> alloc] initWithFormat:<span class="string">@"AllWeatherRadial: %.1f / %.1f / %.1f / %.1f"</span>, [<span class="keyword">self</span> pressure], [<span class="keyword">self</span> treadDepth], [<span class="keyword">self</span> rainHandling], [<span class="keyword">self</span> snowHandling]];</span><br><span class="line">    <span class="keyword">return</span> (desc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="10-5-2-Tire-类的初始化函数改进后的版本"><a href="#10-5-2-Tire-类的初始化函数改进后的版本" class="headerlink" title="10.5.2    Tire 类的初始化函数改进后的版本"></a>10.5.2    Tire 类的初始化函数改进后的版本</h3><blockquote>
<p><strong>说明：</strong>要解决上述问题，首先需要将<code>Tire</code>改造为使用<code>指定初始化函数</code>的版本。</p>
</blockquote>
<p><em>Tire.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">self</span> initWithPressure: <span class="number">34.0</span> treadDepth: <span class="number">20.0</span>]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// init</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithPressure: (<span class="keyword">float</span>) p &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">self</span> initWithPressure: p treadDepth: <span class="number">20</span>]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithTreadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">self</span> initWithPressure: <span class="number">34</span> treadDepth: td]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// initWithTreadDepth</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 参数最多的作为指定初始化函数</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) p treadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        pressure = p;</span><br><span class="line">        treadDepth = td;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;<span class="comment">// initWithPressure: treadDepth</span></span><br></pre></td></tr></table></figure>
<h3 id="10-5-3-添加AllWeatherPressure类的初始化函数"><a href="#10-5-3-添加AllWeatherPressure类的初始化函数" class="headerlink" title="10.5.3    添加AllWeatherPressure类的初始化函数"></a>10.5.3    添加AllWeatherPressure类的初始化函数</h3><blockquote>
<p><strong>说明：</strong>然后，将<code>AllWeatherPressure</code>改造为使用<code>指定初始化函数</code>的版本。只需要重载父类的<code>指定初始化函数</code>，所有构造器就可以正常使用了（因为其他构造器都调用的<code>指定初始化函数</code>）。<br><em>AllWeatherPressure.m</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) initWithPressure: (<span class="keyword">float</span>) p treadDepth: (<span class="keyword">float</span>) td &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithPressure: p treadDepth:td]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-6-初始化函数规则"><a href="#10-6-初始化函数规则" class="headerlink" title="10.6    初始化函数规则"></a>10.6    初始化函数规则</h2><blockquote>
<p><strong>说明：</strong>不是一定要为自己的类创建初始化函数</p>
<ul>
<li>如果不需要设置任何状态，或者<code>alloc</code>方法将内存清零的默认行为相当不错，则不可以不设置<code>指定初始化函数</code>。</li>
<li>如果子类中创建类<code>指定初始化函数</code>，则一定要在这个<code>制定初始化函数</code>中调用超类的<code>指定初始化函数</code>。</li>
</ul>
</blockquote>
<h2 id="10-7-小结"><a href="#10-7-小结" class="headerlink" title="10.7    小结"></a>10.7    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_09  内存管理/" itemprop="url">
                  9 内存管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:39:18+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_09  内存管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_09  内存管理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="9-1-对象生命周期"><a href="#9-1-对象生命周期" class="headerlink" title="9.1    对象生命周期"></a>9.1    对象生命周期</h2><blockquote>
<p><strong>说明：</strong>4个过程</p>
<ol>
<li>诞生：通过<code>alloc</code>或<code>new</code>方法实现</li>
<li>生存：接收消息并执行操作</li>
<li>交友：通过复合以及向方法传递参数</li>
<li>死去：被释放掉</li>
</ol>
</blockquote>
<h3 id="9-1-1-引用计数"><a href="#9-1-1-引用计数" class="headerlink" title="9.1.1    引用计数"></a>9.1.1    引用计数</h3><blockquote>
<p><strong>说明：</strong>也叫<code>保留计数</code>，每个对象都有一个与之想关联的整数，被称作它的<code>引用计数器</code>或<code>保留计数器</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>相关操作</th>
<th>说明</th>
<th>相关方法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>引用计数器</code>初始化</td>
<td>被设置为1</td>
<td><code>alloc</code>、<code>new</code>、<code>copy</code></td>
</tr>
<tr>
<td><code>引用计数器</code>+1</td>
<td>新增对象引用时</td>
<td><code>retain</code></td>
</tr>
<tr>
<td><code>引用计数器</code>-1</td>
<td>引用生命周期结束或引用被断开时</td>
<td><code>release</code></td>
</tr>
<tr>
<td>销毁对象</td>
<td>释放掉已经分配的全部相关资源</td>
<td><code>dealloc</code></td>
</tr>
</tbody>
</table>
<h4 id="retain实例方法"><a href="#retain实例方法" class="headerlink" title="retain实例方法"></a>retain实例方法</h4><blockquote>
<p><strong>说明：</strong>增加对象的<code>引用计数器</code>的值。<br><strong>注意：</strong><code>Objective-C</code> 会在需要的时候自动调用它。<br><strong>原型：</strong><code>id</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;id&#125; 接收消息的对象</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">id</span>) retain;</span><br></pre></td></tr></table></figure>
<h4 id="release实例方法"><a href="#release实例方法" class="headerlink" title="release实例方法"></a>release实例方法</h4><blockquote>
<p><strong>说明：</strong>减少对象的<code>引用计数器</code>的值。<br><strong>注意：</strong><code>Objective-C</code> 会在需要的时候自动调用它。<br><strong>技巧：</strong>因为<code>retain</code>方法返回一个id类型的值，可以在接收其他消息的同时进行<code>retain</code>调用，增加对象的<code>引用计数器</code>的值并执行其他操作。<br><strong>原型：</strong><code>id</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">oneway</span> <span class="keyword">void</span>) release;</span><br></pre></td></tr></table></figure>
<h4 id="retainCount实例方法"><a href="#retainCount实例方法" class="headerlink" title="retainCount实例方法"></a>retainCount实例方法</h4><blockquote>
<p><strong>说明：</strong>获取对象的<code>引用计数器</code>的值。<br><strong>原型：</strong><code>id</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;NSUInteger&#125; 引用计数器当前值</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSUInteger</span>) retaonCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RetainTracker</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// RetainTracker</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RetainTracker</span></span></span><br><span class="line">- (<span class="keyword">id</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span> = [<span class="keyword">super</span> init])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"init: Retain count of %lu."</span>, [<span class="keyword">self</span> retainCount]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写dealloc,当引用计数器的值为0时将被自动调用</span></span><br><span class="line">- (<span class="keyword">void</span>) dealloc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"dealloc called. Bye Bye."</span>);</span><br><span class="line">    [<span class="keyword">super</span> dealloc];</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// dealloc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// RetainTracker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    RetainTracker *tracker = [RetainTracker new];</span><br><span class="line">    <span class="comment">// count: 1</span></span><br><span class="line">    </span><br><span class="line">    [tracker retain]; <span class="comment">// count: 2</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker retain]; <span class="comment">// count: 3</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker release]; <span class="comment">// count: 2</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker release]; <span class="comment">// count: 1</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker retain]; <span class="comment">// count 2</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker release]; <span class="comment">// count 1</span></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%lu"</span>, [tracker retainCount]);</span><br><span class="line">    </span><br><span class="line">    [tracker release]; <span class="comment">// count: 0, dealloc it</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-1-2-对象所有权"><a href="#9-1-2-对象所有权" class="headerlink" title="9.1.2    对象所有权"></a>9.1.2    对象所有权</h3><blockquote>
<p><strong>说明：</strong>如果一个对象（或函数）内有指向其他对象的实例变量，则称该对象（或函数）拥有这些对象，并负责确保对其拥有的对象进行清理。</p>
</blockquote>
<h3 id="9-1-3-访问方法中的保留和释放"><a href="#9-1-3-访问方法中的保留和释放" class="headerlink" title="9.1.3    访问方法中的保留和释放"></a>9.1.3    访问方法中的保留和释放</h3><blockquote>
<p><strong>说明：</strong><code>setEngine</code>方法的第一个内存管理版本。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    Engine *engine;</span><br><span class="line">&#125;</span><br><span class="line">- (Engine *) engine;</span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        engine = [Engine new];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">- (Engine *) engine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// newEngin引用计数器加1</span></span><br><span class="line">	[newEngin retain];</span><br><span class="line">	<span class="comment">// engine应用计数器减1</span></span><br><span class="line">	[engine release];</span><br><span class="line">    engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="9-1-4-自动释放"><a href="#9-1-4-自动释放" class="headerlink" title="9.1.4    自动释放"></a>9.1.4    自动释放</h3><blockquote>
<p><strong>说明：</strong>有些情况下，拥有对象的实体并不能负责清理拥有的对象，如下</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不能在description中释放对象，因为先释放decription字符串对象再返回它，则保留计数器的值归0，对象马上被销毁。</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *description;</span><br><span class="line">	description = [[<span class="built_in">NSString</span> alloc] initWithFormat: <span class="string">@"I'm %d years old"</span>, <span class="number">4</span>];</span><br><span class="line">	<span class="keyword">return</span> (description);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>解决办法：不够优雅</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将返回的字符串赋在某个变量中</span></span><br><span class="line"><span class="built_in">NSString</span> *desc = [someObject description];</span><br><span class="line"><span class="comment">// 使用这个字符串</span></span><br><span class="line"><span class="built_in">NSSLog</span>(<span class="string">@"%@"</span>, desc);</span><br><span class="line"><span class="comment">// 销毁它</span></span><br><span class="line">[desc release];</span><br></pre></td></tr></table></figure>
<h3 id="9-1-5-所有对象放入池中"><a href="#9-1-5-所有对象放入池中" class="headerlink" title="9.1.5    所有对象放入池中"></a>9.1.5    所有对象放入池中</h3><blockquote>
<p><strong>关键字：</strong><code>@autoreleasepool</code>、<code>NSAutoreleasePool</code><br><strong>说明：</strong><code>自动释放池</code>是一个用来存放对象的池子（集合），并且能够自动释放。当自动释放池被销毁时，会想该池中所有的对象发送<code>release</code>消息。</p>
</blockquote>
<h4 id="autorelease实例方法"><a href="#autorelease实例方法" class="headerlink" title="autorelease实例方法"></a>autorelease实例方法</h4><blockquote>
<p><strong>说明：</strong>当向一个对象发送<code>autorelease</code>消息时，实际上是将该对象添加到自动释放池中。<br><strong>原型：</strong><code>id</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;id&#125; 接收对象</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">id</span>) autorelease;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)description &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *description;</span><br><span class="line">	description = [[<span class="built_in">NSString</span> alloc] initWithFormat: <span class="string">@"I'm %d years old"</span>, <span class="number">4</span>];</span><br><span class="line">	<span class="comment">// 通过autorelease方法将字符串加入到自动释放池</span></span><br><span class="line">	<span class="keyword">return</span> ([description autorelease]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NSLog函数的代码运行结束以后，自动释放池会被自动销毁（假设上下文存在已经创建好的自动释放池）</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [someObject description]);</span><br></pre></td></tr></table></figure>
<h3 id="9-1-6-自动释放池的创建和销毁"><a href="#9-1-6-自动释放池的创建和销毁" class="headerlink" title="9.1.6    自动释放池的创建和销毁"></a>9.1.6    自动释放池的创建和销毁</h3><blockquote>
<p><strong>说明：</strong>自动释放池应该什么时候创建？什么时候销毁？</p>
</blockquote>
<h4 id="9-1-6-1-创建"><a href="#9-1-6-1-创建" class="headerlink" title="9.1.6.1    创建"></a>9.1.6.1    创建</h4><blockquote>
<p><strong>说明：</strong>有两种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>自动释放池的创建</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@autorelease{}</code></td>
<td><code>{}</code>内的代码都会被放入这个新池子中</td>
<td>定义在<code>{}</code>内的变量在外部无法使用</td>
</tr>
<tr>
<td><code>NSAutoreleasePool</code>对象</td>
<td>创建和释放<code>NSAutoreleasePool</code>对象之间的代码会使用这个新的池子</td>
<td>性能不如<code>@autorelease{}</code>方式</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>扩展：</strong>可以使用<code>drain方法</code>清空自定释放池中的对象而不销毁自动释放池（Mac OS 10.4+）</p>
</blockquote>
<h4 id="9-1-6-2-销毁"><a href="#9-1-6-2-销毁" class="headerlink" title="9.1.6.2    销毁"></a>9.1.6.2    销毁</h4><blockquote>
<p><strong>说明：</strong>使用<code>AppKit</code>时，<code>Cocoa</code>定期自动地为你创建和销毁自动释放池，通常是在程序处理完当前事件（如鼠标单击或者键盘按下）以后执行这些操作。</p>
</blockquote>
<h3 id="9-1-7-自动释放池的工作流程"><a href="#9-1-7-自动释放池的工作流程" class="headerlink" title="9.1.7    自动释放池的工作流程"></a>9.1.7    自动释放池的工作流程</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RetainTracker</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// RetainTracker</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RetainTracker</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init])</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"init: Retain count of %lu."</span>, [<span class="keyword">self</span> retainCount]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) dealloc</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"dealloc called. Bye Bye."</span>);</span><br><span class="line">	[<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125; <span class="comment">// dealloc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// RetainTracker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 方式一：NSAutoreleasePool对象 */</span></span><br><span class="line">    <span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line">	</span><br><span class="line">    RetainTracker *tracker = [RetainTracker new]; <span class="comment">// count: 1</span></span><br><span class="line">	</span><br><span class="line">    [tracker retain]; <span class="comment">// count: 2</span></span><br><span class="line">    [tracker autorelease]; <span class="comment">// count: still 2</span></span><br><span class="line">    [tracker release]; <span class="comment">// count: 1</span></span><br><span class="line">	</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"releasing pool"</span>);</span><br><span class="line">    [pool release];<span class="comment">// 销毁自动释放池</span></span><br><span class="line">    <span class="comment">// gets nuked, sends release to tracker</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 方式二：@autorelease代码块 */</span></span><br><span class="line">    <span class="keyword">@autoreleasepool</span></span><br><span class="line">    &#123;</span><br><span class="line">        RetainTracker *tracker2 = [RetainTracker new]; <span class="comment">// count: 1</span></span><br><span class="line">        </span><br><span class="line">        [tracker2 retain]; <span class="comment">// count: 2</span></span><br><span class="line">        [tracker2 autorelease]; <span class="comment">// count: still 2</span></span><br><span class="line">        [tracker2 release]; <span class="comment">// count: 1</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"auto releasing pool"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-2-Cocoa-的内存管理规则"><a href="#9-2-Cocoa-的内存管理规则" class="headerlink" title="9.2    Cocoa 的内存管理规则"></a>9.2    Cocoa 的内存管理规则</h2><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>有一些内存管理约定，它们都是一些很简单的规则，可用用于整个工具集內。</p>
<ul>
<li>如果使用<code>new</code>、<code>alloc</code>、<code>copy</code>方法创建了一个对象：当不再使用该对象时，应该向该对象发送一条<code>release</code>或<code>autorelease</code>消息</li>
<li>如果通过其他方法获得一个对象：如果对象的保留计数器的值为1，而且已经被设置为自动释放，那么你不需要执任何操作来确保对象的到清理，除非打算在一段时间内拥有该对象，则需要<code>保留</code>它并确保在操作完成时<code>释放</code>它。</li>
<li>如果<code>保留</code>了某个对象：需要（最终）<code>释放</code>或<code>自动释放</code>该对象（即保持<code>retain</code>方法和<code>release</code>方法使用次数相等）。<br><strong>技巧：</strong>以上规则可以归结为下表(两个维度：对象的来历？用完就销毁还是保留？)</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>对象的来历</th>
<th>用完就销毁</th>
<th>和拥有者同命</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>alloc</code>、<code>new</code>、<code>copy</code></td>
<td>不在使用时释放对象</td>
<td>在<code>dealloc方法中释放对象</code></td>
</tr>
<tr>
<td><strong>其它方法</strong></td>
<td>不需要执行任何操作</td>
<td>获得对象时<code>保留</code>，在<code>dealloc</code>方法中<code>释放</code>对象</td>
</tr>
</tbody>
</table>
<h3 id="9-2-1-临时对象"><a href="#9-2-1-临时对象" class="headerlink" title="9.2.1    临时对象"></a>9.2.1    临时对象</h3><blockquote>
<p><strong>说明：</strong>临时对象指的是，在代码中使用某个对象，但是并未打算长期拥有该对象。<br><strong>内存管理：</strong>如果是用<code>new</code>、<code>alloc</code>、<code>copy</code>方法获得这个对象，就需要安排好该对象的内存释放（通常使用<code>release</code>）。<br><em>alloc</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 维度1:通过alloc创建可变数组</span></span><br><span class="line"><span class="comment">// 维度2:临时使用</span></span><br><span class="line">KSMutableArray *array;</span><br><span class="line">array = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line"><span class="comment">// 使用array</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用时销毁</span></span><br><span class="line">[array release];</span><br></pre></td></tr></table></figure>
<p><em>其它方法</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 维度1:其它方法（工厂方法arrayWithCapacity已经将该对象的引用计数器设置为1且设置了自动释放，即已经放在了自动释放池中）</span></span><br><span class="line"><span class="comment">// 维度2:临时使用</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *array;</span><br><span class="line">array = [<span class="built_in">NSMutableArray</span> arrayWithCapacity: <span class="number">17</span>];</span><br><span class="line"><span class="comment">// 使用array</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p><em>其它方法（全局单例）</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSColor</span> *color;</span><br><span class="line"><span class="comment">// blueColor方法返回一个全局单例对象，这个对象永远不会被销毁，也不需要手动销毁</span></span><br><span class="line">color = [<span class="built_in">NSColor</span> blueColor];</span><br></pre></td></tr></table></figure>
<h3 id="9-2-2-拥有对象"><a href="#9-2-2-拥有对象" class="headerlink" title="9.2.2    拥有对象"></a>9.2.2    拥有对象</h3><blockquote>
<p><strong>说明：</strong><code>拥有对象</code>指的是希望在多个代码中一直拥有某个对象，比如</p>
<ul>
<li>将对象放进<code>集合</code>中（<code>NSArray</code>、<code>NSDictionary</code>等）</li>
<li>作为其它对象的<code>实例变量</code>使用</li>
<li>作为<code>全局变量</code>使用（比较罕见）</li>
</ul>
<p><strong>内存管理：</strong>见<a href="">9.2-技巧</a></p>
<ul>
<li>使用<code>new</code>、<code>alloc</code>、<code>copy</code>方法获得一个对象：只需保证在拥有者的<code>dealloc</code>方法中释放它</li>
<li>其它方法获得一个对象：获得后<code>保留</code>该对象，并保证在拥有者的<code>dealloc</code>方法中释放它<br><em><code>new</code>、实例变量</em></li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) doStuff &#123;</span><br><span class="line">	<span class="comment">// 通过new获得一个对象并赋值给实例变量</span></span><br><span class="line">	flonkArray = [<span class="built_in">NSMutableArray</span> new];<span class="comment">// count 1, autoreleased</span></span><br><span class="line">	[flonkArray retain];<span class="comment">// count 2, autoreleased</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) dealloc &#123;</span><br><span class="line">	<span class="comment">// 释放实例变量指向的空间</span></span><br><span class="line">	[flonkArray release];<span class="comment">// count 0</span></span><br><span class="line">	<span class="comment">// 重写了dealloc别忘记调用超类的dealloc</span></span><br><span class="line">	[<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>其它方法、实例变量</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) doStuff &#123;</span><br><span class="line">	<span class="comment">// 通过new获得一个对象并赋值给实例变量</span></span><br><span class="line">	flonkArray = [<span class="built_in">NSMutableArray</span> arrayWithCapacity: <span class="number">17</span>];<span class="comment">// count 1</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>) dealloc &#123;</span><br><span class="line">	<span class="comment">// 释放实例变量指向的空间</span></span><br><span class="line">	[flonkArray release];<span class="comment">// count 0</span></span><br><span class="line">	<span class="comment">// 重写了dealloc别忘记调用超类的dealloc</span></span><br><span class="line">	[<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="清理自动释放池"><a href="#清理自动释放池" class="headerlink" title="清理自动释放池"></a>清理自动释放池</h4><blockquote>
<p><strong>说明：</strong>自动释放池被清理的时间是完全确定的</p>
<ul>
<li>在代码中手动销毁</li>
<li>使用AppKit时是在循环结束时销毁</li>
</ul>
<p><strong>原理：</strong>自动释放池存放在栈中，新建的自动释放池被添加到栈顶，接收<code>autorelease</code>消息的对象将被放入最顶端的自动释放池。<br><strong>注意：</strong>自动释放池的分配和销毁操作代价很小，如果一个循环中会创建大量对象，可以创建在循环中常见自己的自动释放池，每创建一批就释放一批。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建自动释放池</span></span><br><span class="line"><span class="built_in">NSAutoreleasePool</span> *pool;</span><br><span class="line">pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">	<span class="comment">// 创建字符串对象</span></span><br><span class="line">	<span class="keyword">id</span> object = [someArray objectAtIndex: i];</span><br><span class="line">	<span class="built_in">NSString</span> *desc = [object description];</span><br><span class="line">	<span class="keyword">if</span> (i % <span class="number">1000</span> == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="comment">// 每创建1000个对象清理到上一个自动释放池</span></span><br><span class="line">		[pool release];</span><br><span class="line">		<span class="comment">// 并新建一个自动释放池</span></span><br><span class="line">		pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 释放最后一个自动释放池</span></span><br><span class="line">[pool release];</span><br></pre></td></tr></table></figure>
<h3 id="9-2-3-垃圾回收"><a href="#9-2-3-垃圾回收" class="headerlink" title="9.2.3    垃圾回收"></a>9.2.3    垃圾回收</h3><blockquote>
<p><strong>说明：</strong><code>Objective-C2.0</code>引入了自动内存管理机制，也称为<code>垃圾回收</code><br><strong>触发：</strong>类似自动释放池</p>
<ul>
<li>在时间循环结束时触发</li>
<li>也可以自己触发（如果不是GUI程序）</li>
</ul>
<p><strong>开启：</strong><code>垃圾回收</code>是一个可选择的是否启动的功能（项目信息窗口-&gt;Build Settings选项卡-&gt;Require[-fobjc-gc-only]选项）<br><strong>限制：</strong>只支持<code>OS X</code>应用开发，无法在<code>iOS</code>应用程序上应用。<br><strong>扩展：</strong>苹果对<code>iOS</code>开发的一些建议</p>
<ul>
<li>不要在自己的代码中使用<code>autorelease</code>方法</li>
<li>不要使用会返回自动释放对象的一些便利方法（比如<code>NSString</code>中以<code>stringWith</code>开头的工厂方法）</li>
</ul>
</blockquote>
<h3 id="9-2-4-自动引用计数"><a href="#9-2-4-自动引用计数" class="headerlink" title="9.2.4    自动引用计数"></a>9.2.4    自动引用计数</h3><blockquote>
<p><strong>背景：</strong><code>iOS</code>不支持垃圾回收，因为移动设备比电脑更加私人化、资源更少，垃圾回收存在潜在的体验问题。但苹果提供了另外一个方案来祢补，那就是<code>自动引用计数（automatic regerence counting, ARC）</code><br><strong>说明：</strong><code>ARC</code>不是垃圾回收器，它是在编译期（而不是运行期）工作的，它在代码中插入了合适的<code>retain</code>和<code>release</code>语句。<br><strong>注意：</strong><code>ARC</code>是一个可选的功能，必需明确地启用或禁用。<br><strong>开发环境限制：</strong>以下是编写（或运行）<code>ARC</code>代码所需的条件</p>
<ul>
<li>Xcode4.2 以上的版本</li>
<li>Apple LLVM 3.0 以上版本的编译器</li>
<li><code>OS X 10.7</code>以上版本的系统</li>
</ul>
<p><strong>运行环境限制：</strong>以下是运行移动设备必需满足的条件</p>
<ul>
<li>ios 4.0以上的移动设备或<code>OS X10.6</code>以上版本的64位系统的电脑</li>
<li><code>归零弱引用</code>需要<code>iOS 5.0</code>或<code>OS X 10.7</code>以上版本的系统</li>
</ul>
<p><strong>作用对象限制：</strong><code>ARC</code>只对可保留的对象指针<code>(ROPs)</code>有效</p>
<ul>
<li>代码块指针</li>
<li><code>Objective-C</code>对象指针</li>
<li>通过<code>_attribute((NSObject))</code>类型定义的指针</li>
</ul>
<p><strong>技巧：</strong>如果想在代码中使用<code>ARC</code>，必需满足以下三个条件</p>
<ul>
<li>能够确定哪些对象需要进行内存管理</li>
<li>能够表明如何去管理对象：就是说必需能够对某个对象的引用计数器的值进行加1和减1的操作（<code>NSObject</code>的子类都可以）</li>
<li>有可行的办法传递对象的所有权（在调用者和接受者之间）</li>
</ul>
<p><strong>注意：</strong>如果使用的指针不支持<code>ARC</code>，那么你不得不亲自手动管理它们。</p>
</blockquote>
<h4 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h4><blockquote>
<p><strong>说明：</strong>通常变量和<code>Objective-C</code>对象之间都是<code>强引用</code>，可以通过对属性使用了<code>assign</code>特性声明为<code>弱引用</code>。<br><strong>用途：</strong>处理<code>保留循环（retain cycle）</code>带来的内存泄漏。<br><strong>限制：</strong><code>弱引用</code>指向的对象有可能被提前释放，直接使用会导致问题。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-14%20%E4%B8%8B%E5%8D%8811.14.20.png" alt="Alt text"></p>
</blockquote>
<h4 id="归零弱引用"><a href="#归零弱引用" class="headerlink" title="归零弱引用"></a>归零弱引用</h4><blockquote>
<p><strong>说明：</strong>在指向的对象被释放之后，这种弱引用就会被设置为<code>nil</code>，然后就可以像平常的指针一样被处理了。<br><strong>语法：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_weak</code>关键字</td>
<td>声明变量时使用<code>_weak</code>修饰</td>
<td><code>_weak NSString *myString;</code></td>
</tr>
<tr>
<td><code>@property(weak)</code></td>
<td>对属性使用<code>weak</code>特性</td>
<td><code>@property(weak) NSString *myString;</code></td>
</tr>
<tr>
<td><code>_unsafe_unretained</code>关键字和<code>unsafe_unretained</code>特性</td>
<td>告诉<code>ARC</code>这个特殊的引用是弱引用</td>
<td>前提是：不支持弱引用、使用了ARC</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>兼容性：</strong><code>iOS 5+</code>和<code>OS X 10.7+</code><br><strong>属性命名限制：</strong>使用<code>ARC</code>的时候，有两种命名规则</p>
<ul>
<li>属性名称不能以<code>new</code>开头</li>
<li>属性不能只有一个<code>read-only</code>而没有内存管理特性（除非启用了<code>ARC</code>功能）</li>
</ul>
<p><strong>注意：</strong>内存管理的<code>关键字</code>和<code>特性</code>是不能一起使用的，两者相互排斥。<br><strong>扩展：</strong><code>强引用</code>也有自己的<code>_strong</code>关键字和<code>strong</code>特性</p>
</blockquote>
<h4 id="将已有的项目转换成支持ARC的"><a href="#将已有的项目转换成支持ARC的" class="headerlink" title="将已有的项目转换成支持ARC的"></a>将已有的项目转换成支持<code>ARC</code>的</h4><blockquote>
<p><strong>前提：</strong>必须确保垃圾回收机制没有启动（<code>垃圾回收</code>和<code>ARC</code>是无法一同使用的）。<br><strong>说明：</strong><code>ARC</code>默认是启动了的，如果一个项目没有是在没有启动<code>ARC</code>的情况下开发的，可以转换（通过Edit-&gt;Convert-&gt;To Objective-C ARC…）</p>
</blockquote>
<h4 id="桥接转换"><a href="#桥接转换" class="headerlink" title="桥接转换"></a>桥接转换</h4><blockquote>
<p><strong>指针分两类：</strong><code>ROP</code>和<code>non-ROP</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>分类</th>
<th>说明</th>
<th>是否被<code>ARC</code>（启用了的话）管理</th>
</tr>
</thead>
<tbody>
<tr>
<td>可保留对象指针(<code>ROP</code>)</td>
<td>NSobject的所有子类</td>
<td>是</td>
</tr>
<tr>
<td>不可保留对象指针(<code>non-ROP</code>)</td>
<td>C语言集合类型</td>
<td>否</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>拥有者权限：</strong>这个概念只有在启用了<code>ARC</code>的情况下才有意义。指的是<code>ROP</code>和<code>non-ROP</code>相互转换时指针所有权情况，用来告诉<code>ARC</code>如何工作</p>
<p><strong>用途：</strong>通过<code>桥接转换</code>，可以在转换类型的同时控制<code>拥有者权限</code><br><strong>说明：</strong>有3种类型的桥接转换</p>
</blockquote>
<table>
<thead>
<tr>
<th>关键字</th>
<th>语法</th>
<th>对象的保留计数器</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_bridge</code></td>
<td><code>non-ROP变量=(__bridge)ROP变量;</code>或<code>ROP变量=(__bridge)non-ROP变量;</code></td>
<td>不变化</td>
<td>指针的所有权仍会留在原变量</td>
</tr>
<tr>
<td><code>_bridge_restained</code></td>
<td><code>non-ROP变量=(__bridge_restained)ROP变量;</code></td>
<td>加1</td>
</tr>
<tr>
<td><code>_bridge_transfer</code></td>
<td><code>ROP变量=(__bridge_transfer)non-ROP变量;</code></td>
<td>减1</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong></p>
<ul>
<li>结构体（<code>struct</code>）和集合体（<code>union</code>）不能使用<code>ROP</code>作为成员。可以通过使用<code>void *</code>和<code>桥接转换</code>来解决这个问题</li>
<li>有时需要释放不支持<code>ARC</code>的对象或执行其他清理操作，所以仍要实现<code>dealloc</code>方法，但是不能直接调用<code>[super dealloc]</code></li>
</ul>
<p><strong>注意：</strong><code>ARC</code>中的代码存在如下限制</p>
</blockquote>
<table>
<thead>
<tr>
<th>内存管理方法</th>
<th>不能调用</th>
<th>不能重写</th>
</tr>
</thead>
<tbody>
<tr>
<td>retain</td>
<td>- [x]</td>
<td>- [x]</td>
</tr>
<tr>
<td>retainCount</td>
<td>- [x]</td>
<td>- [x]</td>
</tr>
<tr>
<td>release</td>
<td>- [x]</td>
<td>- [x]</td>
</tr>
<tr>
<td>autorelease</td>
<td>- [x]</td>
<td>- [x]</td>
</tr>
<tr>
<td>dealloc</td>
<td>- [x]</td>
</tr>
</tbody>
</table>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ROP</span></span><br><span class="line"><span class="built_in">NSString</span> *theString = <span class="string">@"Learn Objective-C"</span>;</span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="keyword">struct</span> &#123;</span><br><span class="line">    int32_t foo;</span><br><span class="line">    <span class="keyword">char</span> *bar;</span><br><span class="line">    <span class="built_in">NSString</span> *baz;</span><br><span class="line">&#125; MyStruct;</span><br><span class="line"><span class="comment">// 转成C语言提供的类型（void *），并指定所有权</span></span><br><span class="line">MyStruct.baz = (_bridge_restained <span class="keyword">void</span> *)theString;</span><br><span class="line"><span class="comment">// non-ROP 转 ROP</span></span><br><span class="line"><span class="built_in">NSString</span> *myString = (_bridge_transfer <span class="built_in">NSString</span> *)MyStruct.baz;</span><br></pre></td></tr></table></figure>
<h2 id="9-3-异常"><a href="#9-3-异常" class="headerlink" title="9.3    异常"></a>9.3    异常</h2><blockquote>
<p><strong>说明：</strong>异常就是异常事件，比如数组溢出，如果<code>捕捉</code>并<code>处理</code>，就会痰乱程序流程。</p>
<ul>
<li>异常对象：<code>Cocoa</code>中使用<code>NSException</code>类来表示异常，可以创建<code>NSException</code>子类作为自己的异常（如果通过其它类型的对象来<code>抛出异常</code>，<code>Cocoa</code>不会处理它们）</li>
<li>抛出异常：在运行时系统中创建并处理异常的行为</li>
<li>捕捉异常：处理被<code>抛出</code>的异常的行为</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>如果要项目支持异常特性，要确保<code>-fobj-exceptions</code>（Enable Objecytive-C Exception）项被打开</li>
<li><code>Cocoa</code>框架处理错误的方式通常是退出程序</li>
<li>如果一个异常被抛出但没有被捕捉，程序会在异常断点处停止运行并通知有这个异常</li>
</ul>
</blockquote>
<h3 id="9-3-1-与异常有关的关键字"><a href="#9-3-1-与异常有关的关键字" class="headerlink" title="9.3.1    与异常有关的关键字"></a>9.3.1    与异常有关的关键字</h3><blockquote>
<p><strong>说明：</strong>都以<code>@</code>开头</p>
</blockquote>
<table>
<thead>
<tr>
<th>关键字</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@try</code></td>
<td>定义可能包含异常的代码块</td>
</tr>
<tr>
<td><code>@catch</code></td>
<td>定义处理已抛出异常的代码块，接收一个参数，通常是<code>NSException</code>或其子类</td>
</tr>
<tr>
<td><code>@finally</code></td>
<td>定义无论是够有抛出异常都会执行的代码块</td>
</tr>
<tr>
<td><code>@throw</code></td>
<td>抛出异常</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>语法：</strong><code>@try-catch-finally</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@try</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@finally</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-3-2-捕捉不同类型的异常"><a href="#9-3-2-捕捉不同类型的异常" class="headerlink" title="9.3.2    捕捉不同类型的异常"></a>9.3.2    捕捉不同类型的异常</h3><blockquote>
<p><strong>说明：</strong>可以根据需要处理的异常类型过使用多个<code>@catch</code>代码块。处理代码应该按照从具体到抽象的顺序排序，并在最后使用一个通用的处理代码</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@try</span> &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span> (myCustomException) &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span> (<span class="keyword">id</span> value) &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@finally</span> &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>C语言程序员经常会在异常处理代码中使用<code>setjmp</code>和<code>longjmp</code>语句。在<code>@try</code>中则不可以，但可以使用<code>goto</code>和<code>return</code>语句退出异常处理代码。</p>
</blockquote>
<h3 id="9-3-3-抛出异常"><a href="#9-3-3-抛出异常" class="headerlink" title="9.3.3    抛出异常"></a>9.3.3    抛出异常</h3><blockquote>
<p><strong>说明：</strong>异常的抛出分两种，<code>自动</code>和<code>手动</code>，后者有<code>2</code>中方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>手动抛出异常</th>
<th>异常对象类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@throw 异常对象</code></td>
<td>id</td>
</tr>
<tr>
<td>向某个异常对象发送<code>raise</code>消息</td>
<td><code>NSException</code>或其子类</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>在<code>@try</code>和<code>@catch</code>中都可以抛出异常，后者会引发下一个异常处理调用（<code>@finally</code>会在<code>@throw</code>之前被调用）<br><strong>扩展：</strong><code>Objective-C</code>的异常机制与<code>C++</code>的异常机制兼容。<br><strong>性能问题：</strong><code>@try</code>建立异常不会产生消耗，但捕捉异常会消耗大量资源并影响程序运行的速度。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSExceptionn</span> *theException = [<span class="built_in">NSException</span> exceptionWithName: _];</span><br><span class="line"><span class="keyword">@throw</span> theException;<span class="comment">// 或者[theException raise]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@try</span> &#123;</span><br><span class="line">	<span class="built_in">NSException</span> *e = _;</span><br><span class="line">	<span class="keyword">@throw</span> e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@catch</span> (<span class="built_in">NSException</span> *e) &#123;</span><br><span class="line">	<span class="comment">// 可以不指定异常对象（默认重复抛出）</span></span><br><span class="line">	<span class="keyword">@throw</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-3-4-异常也需要内存管理"><a href="#9-3-4-异常也需要内存管理" class="headerlink" title="9.3.4    异常也需要内存管理"></a>9.3.4    异常也需要内存管理</h3><blockquote>
<p><strong>说明：</strong>如果代码出现了异常，程序会被中断，原本没有内存问题的代码或许会因此出现内存泄漏。</p>
</blockquote>
<p><em>问题描述</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)mySimpleMethod &#123;</span><br><span class="line">	<span class="comment">// 创建一个字典</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *dictionary = [[<span class="built_in">NSDictionary</span> alloc] initWith_.];</span><br><span class="line">	<span class="comment">// 对字典进行操作，假设操作中出现了异常，则程序会从方法中跳出寻找异常处理代码</span></span><br><span class="line">	[<span class="keyword">self</span> processDictionary: dictionary];</span><br><span class="line">	<span class="comment">// 释放字典：由于方法已经退出来了，所以字典没有释放</span></span><br><span class="line">	[dictionary release];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>解决方式：<code>@try-@finally</code></em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)mySimpleMethod &#123;</span><br><span class="line">	<span class="comment">// 创建一个字典</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *dictionary = [[<span class="built_in">NSDictionary</span> alloc] initWith_.];</span><br><span class="line">	<span class="keyword">@try</span> &#123;</span><br><span class="line">		<span class="comment">// 对字典进行操作，假设操作中出现了异常，则程序会从方法中跳出寻找异常处理代码</span></span><br><span class="line">		[<span class="keyword">self</span> processDictionary: dictionary];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">@finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放字典：由于方法已经退出来了，所以字典没有释放</span></span><br><span class="line">		[dictionary release];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-3-5-异常和自动释放池"><a href="#9-3-5-异常和自动释放池" class="headerlink" title="9.3.5    异常和自动释放池"></a>9.3.5    异常和自动释放池</h3><blockquote>
<p><strong>说明：</strong>通常，开发人员并不知道异常对象何时释放，所以异常几乎总是作为自动释放对象创建。<br><strong>注意：</strong><code>@finally</code>代码块会在<code>@catch</code>中的<code>@throw</code>语句执行之前被调用，因此如果在<code>@finally</code>将自动释放池销毁，那么就会导致<code>僵尸异常</code>。</p>
</blockquote>
<p><em>僵尸异常示例</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)myMechod &#123;</span><br><span class="line">	<span class="comment">// 自动释放池</span></span><br><span class="line">	<span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line">	<span class="comment">// 字典</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *myDictionary = [[<span class="built_in">NSDictionary</span> alloc] initWithObjectsAndKey: <span class="string">@"asdfads"</span>, <span class="literal">nil</span>];</span><br><span class="line">	<span class="keyword">@try</span> &#123;</span><br><span class="line">		<span class="comment">// 操作字典</span></span><br><span class="line">		[<span class="keyword">self</span> processDictionaty: myDictionary];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">@catch</span> (<span class="built_in">NSException</span> *e) &#123;</span><br><span class="line">		<span class="comment">// pool在下面的@throw被调用之前就被释放了，释放池中的异常对象随之被销毁，导致僵尸异常</span></span><br><span class="line">		<span class="keyword">@throw</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">@finally</span> &#123;</span><br><span class="line">		<span class="comment">// 销毁自动释放池</span></span><br><span class="line">		[pool release];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>避免僵尸异常：在<code>自动释放池</code>外<code>保留</code>异常对象</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)myMechod &#123;</span><br><span class="line">	<span class="keyword">id</span> savedException = <span class="literal">nil</span>;</span><br><span class="line">	<span class="comment">// 自动释放池</span></span><br><span class="line">	<span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</span><br><span class="line">	<span class="comment">// 字典</span></span><br><span class="line">	<span class="built_in">NSDictionary</span> *myDictionary = [[<span class="built_in">NSDictionary</span> alloc] initWithObjectsAndKey: <span class="string">@"asdfads"</span>, <span class="literal">nil</span>];</span><br><span class="line">	<span class="keyword">@try</span> &#123;</span><br><span class="line">		<span class="comment">// 操作字典</span></span><br><span class="line">		[<span class="keyword">self</span> processDictionaty: myDictionary];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">@catch</span> (<span class="built_in">NSException</span> *e) &#123;</span><br><span class="line">		<span class="comment">// 通过retain方法，将异常对象放入当前池而不是pool中，因为savedException定义的位置在pool定义之前。</span></span><br><span class="line">		savedException = [e retain];</span><br><span class="line">		<span class="comment">// pool在下面的@throw被调用之前就被释放了</span></span><br><span class="line">		<span class="keyword">@throw</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">@finally</span> &#123;</span><br><span class="line">		<span class="comment">// 销毁自动释放池</span></span><br><span class="line">		[pool release];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-4-小结"><a href="#9-4-小结" class="headerlink" title="9.4    小结"></a>9.4    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_08  Foundation Kit介绍/" itemprop="url">
                  8 Foundation Kit介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:38:55+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_08  Foundation Kit介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_08  Foundation Kit介绍/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Cocoa</code>的几个重要框架</p>
</blockquote>
<table>
<thead>
<tr>
<th>框架</th>
<th>说明</th>
<th>兼容</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Foundation Kit</td>
<td>两类UI框架的基础，包含很多有用的、面向数据的简单类和数据类型</td>
<td>ios和OS X</td>
<td>基于CoreFoundation框架</td>
</tr>
<tr>
<td>Application Kit(Appkit)</td>
<td>包含所有用户界面对象和高级类</td>
<td>OS X</td>
<td><a href="">16章</a></td>
</tr>
<tr>
<td>User Interface Kit(UIKit)</td>
<td>用户界面</td>
<td>ios</td>
<td><a href="">15章</a></td>
</tr>
</tbody>
</table>
<h2 id="8-1-稳固的-Foundation"><a href="#8-1-稳固的-Foundation" class="headerlink" title="8.1    稳固的 Foundation"></a>8.1    稳固的 Foundation</h2><blockquote>
<p><strong>说明：</strong>两类UI框架的基础，包含很多有用的、面向数据的简单类和数据类型。包含<code>NSString</code>、<code>NSArray</code>、<code>NSEnumerator</code>、和<code>NSNumber</code>等100多个类。<br><strong>扩展：</strong><code>Foundation</code>框架以<code>CoreFoundation</code>框架为（纯C编写）基础，<code>CoreFoundation</code>中的函数和变量的名称以<code>CF</code>开头。</p>
</blockquote>
<h2 id="8-2-使用项目样本代码"><a href="#8-2-使用项目样本代码" class="headerlink" title="8.2    使用项目样本代码"></a>8.2    使用项目样本代码</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// insert code here...</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Hello, World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-3-一些有用的数据类型"><a href="#8-3-一些有用的数据类型" class="headerlink" title="8.3    一些有用的数据类型"></a>8.3    一些有用的数据类型</h2><h3 id="8-3-1-范围"><a href="#8-3-1-范围" class="headerlink" title="8.3.1    范围"></a>8.3.1    范围</h3><blockquote>
<p><strong>类型：</strong><code>NSRange</code><br><strong>原型描述：</strong><code>Foundation.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">typedef</span> <span class="keyword">struct</span> _<span class="built_in">NSRange</span> &#123;</span><br><span class="line">&gt;    <span class="keyword">unsigned</span> <span class="keyword">int</span> location;</span><br><span class="line">&gt;    <span class="keyword">unsigned</span> <span class="keyword">int</span> length;</span><br><span class="line">&gt;&#125; <span class="built_in">NSRange</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>说明：</strong>用来表示相关事物的范围，通常是字符串里字符范围或者数组里的元素范围。有<code>3</code>中创建方式</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一：直接给字段赋值</span></span><br><span class="line"><span class="built_in">NSRange</span> range1;</span><br><span class="line">range.location = <span class="number">17</span>;</span><br><span class="line">range.length = <span class="number">4</span>;</span><br><span class="line"><span class="comment">// 方式二：利用c语言的聚合结构赋值机制</span></span><br><span class="line"><span class="built_in">NSRange</span> range2 = &#123;<span class="number">17</span>, <span class="number">4</span>&#125;;</span><br><span class="line"><span class="comment">// 方式三：Cocoa提供的一个快捷函数NSMakeRange，优点是能够在任何能够使用函数的地方使用</span></span><br><span class="line"><span class="built_in">NSRange</span> range3 = <span class="built_in">NSMakeRange</span>(<span class="number">17</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<h3 id="8-3-2-几何数据类型"><a href="#8-3-2-几何数据类型" class="headerlink" title="8.3.2    几何数据类型"></a>8.3.2    几何数据类型</h3><blockquote>
<p><strong>源：</strong><code>Cocoa</code>（引用<code>C</code>语言编写的<code>Core Graphics</code>框架）<br><strong>说明：</strong>包括一些用来处理图形的<code>数据类型</code>和创建这些数据类型的<code>快捷方法</code>。<br><strong>原型：</strong></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">CGPoint</span> &#123;</span><br><span class="line">	<span class="keyword">float</span> x;</span><br><span class="line">	<span class="keyword">float</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="built_in">CGSize</span> &#123;</span><br><span class="line">	<span class="keyword">float</span> width;</span><br><span class="line">	<span class="keyword">float</span> height;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="built_in">CGRect</span> &#123;</span><br><span class="line">	<span class="built_in">CGPoint</span> origin;</span><br><span class="line">	<span class="built_in">CGSize</span> size;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>扩展：</strong>所有的<code>O-C</code>对象都是动态分配的，而动态分配是一个代价较大的操作，会消耗大量的时间。所以为了性能，<code>GUI</code>程序更倾向使用结构体。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 矩形原点</span></span><br><span class="line">    <span class="built_in">CGPoint</span> point = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 矩形大小</span></span><br><span class="line">    <span class="built_in">CGSize</span> size = <span class="built_in">CGSizeMake</span>(<span class="number">8</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 矩形</span></span><br><span class="line">    <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-4-字符串"><a href="#8-4-字符串" class="headerlink" title="8.4    字符串"></a>8.4    字符串</h2><h3 id="8-4-1-创建字符串"><a href="#8-4-1-创建字符串" class="headerlink" title="8.4.1    创建字符串"></a>8.4.1    创建字符串</h3><h4 id="stringWithFormat方法"><a href="#stringWithFormat方法" class="headerlink" title="stringWithFormat方法"></a>stringWithFormat方法</h4><blockquote>
<p><strong>说明：</strong>通过格式字符串和参数来创建<code>NSString</code><br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; format 格式串</span><br><span class="line">* @param &#123;...&#125; 对应参数</span><br><span class="line">* @reuturn &#123;id&#125; NSString对象</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>) stringWithFormat: (<span class="built_in">NSString</span> *) format, ...;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *height;</span><br><span class="line">height = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"Your height is %d feet, %d inches"</span>, <span class="number">5</span>, <span class="number">11</span>];</span><br></pre></td></tr></table></figure>
<h3 id="8-4-2-类方法"><a href="#8-4-2-类方法" class="headerlink" title="8.4.2    类方法"></a>8.4.2    类方法</h3><blockquote>
<p><strong>说明：</strong>如果在声明方法时添加了<code>+</code>，就是把这个方法定义为<code>类方法(class method)</code>。</p>
<ul>
<li>通常用于工厂方法</li>
<li>也可以用来访问全局数据</li>
</ul>
<p><strong>原理：</strong><code>Objective-C</code>运行时生成一个类的时候，会创建一个代表该类的<code>类对象（class object）</code>，包含了指向超类、类名和类方法列表的指针，还包含一个<code>long</code>类型的数据，为新创建的实例对象指定大小（以字节为单位）。</p>
<p><strong>扩展：</strong>类方法和实例方法</p>
</blockquote>
<table>
<thead>
<tr>
<th>标识</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>类方法</td>
<td>属于类的方法</td>
</tr>
<tr>
<td>-</td>
<td>实例方法</td>
<td>将会在指定的对象实例中起作用</td>
</tr>
</tbody>
</table>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIColor的类方法：redColor（访问全局数据）</span></span><br><span class="line"><span class="built_in">NSColor</span> *haveTheBlues = [<span class="built_in">NSColor</span> blueColor];</span><br><span class="line"><span class="built_in">UIColor</span> *blueMan = [<span class="built_in">UIColor</span> blueColor];</span><br></pre></td></tr></table></figure>
<h3 id="8-4-4-关于大小"><a href="#8-4-4-关于大小" class="headerlink" title="8.4.4    关于大小"></a>8.4.4    关于大小</h3><h4 id="length实例方法"><a href="#length实例方法" class="headerlink" title="length实例方法"></a>length实例方法</h4><blockquote>
<p><strong>说明：</strong>返回字符串中字符的个数，能够准确无误地处理各种语言的字符串。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">/**</span><br><span class="line">&gt;* @return &#123;NSUInter&#125; 字符串中字符的数目</span><br><span class="line">&gt;*/</span></span><br><span class="line">&gt;- (<span class="built_in">NSUInter</span>) length;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>扩展：</strong>在C语言中处理这些国际字符串很麻烦，因为一个字符占用的空间可能多于一个字节，使用<code>strlen</code>只能计算字节数的函数会返回错误的数值。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> height = <span class="string">@"Hello world!"</span>;</span><br><span class="line"><span class="keyword">if</span> ([height length] &gt; <span class="number">35</span>) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"wow, you're really tail!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-4-4-字符串比较"><a href="#8-4-4-字符串比较" class="headerlink" title="8.4.4    字符串比较"></a>8.4.4    字符串比较</h3><h4 id="isEqualToString实例方法"><a href="#isEqualToString实例方法" class="headerlink" title="isEqualToString实例方法"></a>isEqualToString实例方法</h4><blockquote>
<p><strong>说明：</strong>比较接收方和作为参数传递过来的字符串。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; aString 字符串</span><br><span class="line">* @return &#123;BOOL&#125; YES 内容相同，NO 内容不同</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) isEqualToString: (<span class="built_in">NSString</span> *) aString</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>扩展：</strong><code>==</code>运算符用来检查两个对象是否为同一事物；<code>isEqualToString</code>用来检查两个字符串的内容是否相等。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串比较</span></span><br><span class="line"><span class="built_in">NSString</span> *thing1 = <span class="string">@"hello 5"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *thing2 = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"hello %d"</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([thing1 isEqualToString:thing2]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"They are the same."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="compare实例方法"><a href="#compare实例方法" class="headerlink" title="compare实例方法"></a>compare实例方法</h4><blockquote>
<p><strong>说明：</strong>将接收对象和传递过来的字符串逐个进行比较</p>
<ul>
<li>区分大小写</li>
<li>返回一个显示比较结果的枚举类型</li>
</ul>
<p><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; aString 字符串</span><br><span class="line">* @return &#123;NSComparisonResult&#125; 包含比较结果的枚举类型</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSComparisonResult</span>) compare: (<span class="built_in">NSString</span> *) aString;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>返回值原型：</strong></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    <span class="built_in">NSOrderedAscending</span> = <span class="number">-1</span>;<span class="comment">// 左侧小于右侧</span></span><br><span class="line">    <span class="built_in">NSOrderdSame</span>,<span class="comment">// 两侧字符串相同</span></span><br><span class="line">    <span class="built_in">NSOrderdDescending</span><span class="comment">// 左侧大于右侧</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NSInteger</span> <span class="built_in">NSComparisonResult</span>;</span><br></pre></td></tr></table></figure>
<h3 id="8-4-5-不区分大小写的比较"><a href="#8-4-5-不区分大小写的比较" class="headerlink" title="8.4.5    不区分大小写的比较"></a>8.4.5    不区分大小写的比较</h3><h4 id="compare实例方法（2个参数）"><a href="#compare实例方法（2个参数）" class="headerlink" title="compare实例方法（2个参数）"></a>compare实例方法（2个参数）</h4><blockquote>
<p><strong>说明：</strong>比较字符串，有更多选择权，可以使用<code>位</code>或<code>bitwise-OR远端符（|）</code>来添加选项标记。</p>
</blockquote>
<table>
<thead>
<tr>
<th>选项标记</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>NSCaseInsensitiveSearch</td>
<td>不区分大小写字符</td>
</tr>
<tr>
<td>NSLiteralSearch</td>
<td>进行完全比较，区分大小写</td>
</tr>
<tr>
<td>NSNumericSearch</td>
<td>比较字符串的字符个数，而不是字符串值</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; aString 字符串</span><br><span class="line">* @option &#123;NSStringCompareOption&#125; mask 比较选项</span><br><span class="line">* @return &#123;NSComparisonResult&#125; 包含比较结果的枚举类型</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSComparisonResult</span>) compare: (<span class="built_in">NSString</span> *) aString</span><br><span class="line">options: (<span class="built_in">NSStringCompareOption</span>) mask;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不区分大小写、比较字符串的字符个数（而不是值）</span></span><br><span class="line"><span class="keyword">if</span> ([thing1 compare:thing2 options:<span class="built_in">NSCaseInsensitiveSearch</span> | <span class="built_in">NSNumericSearch</span>] == <span class="built_in">NSOrderedSame</span>) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"They match!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-4-6-字符串是否还包含别的字符串"><a href="#8-4-6-字符串是否还包含别的字符串" class="headerlink" title="8.4.6    字符串是否还包含别的字符串"></a>8.4.6    字符串是否还包含别的字符串</h3><h3 id="hasPrefix实例方法"><a href="#hasPrefix实例方法" class="headerlink" title="hasPrefix实例方法"></a>hasPrefix实例方法</h3><blockquote>
<p><strong>说明：</strong>检查字符串是否是以另一个字符串开头<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*@param &#123;NSString *&#125; aString 子字符串</span><br><span class="line">*@return &#123;BOOL&#125; YES， NO</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) hasPrefix: (<span class="built_in">NSString</span> *) aString;</span><br></pre></td></tr></table></figure>
<h3 id="hasSuffix实例方法"><a href="#hasSuffix实例方法" class="headerlink" title="hasSuffix实例方法"></a>hasSuffix实例方法</h3><blockquote>
<p><strong>说明：</strong>检查字符串是否是以另一个字符串结尾<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*@param &#123;NSString *&#125; aString 子字符串</span><br><span class="line">*@return &#123;BOOL&#125; YES ， NO</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) hasSuffix: (<span class="built_in">NSString</span> *) aString;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *fileName = <span class="string">@"draft-chapter.pages"</span>;</span><br><span class="line"><span class="keyword">if</span> ([fileName hasPrefix:<span class="string">@"draft"</span>]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"this is a draft."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> ([fileName hasSuffix:<span class="string">@".mov"</span>]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"this is a movie"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="rangeOfString实例方法"><a href="#rangeOfString实例方法" class="headerlink" title="rangeOfString实例方法"></a>rangeOfString实例方法</h4><blockquote>
<p><strong>说明：</strong>查看字符串的某处是否包含指定子字符串。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; rangeOfString 子字符串</span><br><span class="line">* @return &#123;NSRange&#125; 包含匹配的位置信息和能够匹配上的字符个数</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSRange</span>) rangeOfString: (<span class="built_in">NSString</span> *) aString;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任意位置</span></span><br><span class="line"><span class="built_in">NSRange</span> range = [fileName rangeOfString:<span class="string">@"chapter"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"range.location:%d, range.length: %d"</span>, range.location, range.length);</span><br></pre></td></tr></table></figure>
<h3 id="8-4-7-可变性"><a href="#8-4-7-可变性" class="headerlink" title="8.4.7    可变性"></a>8.4.7    可变性</h3><blockquote>
<p><strong>说明：</strong><code>NSString</code>是不可变（不能通过删除字符或添加字符的方式改变它）。的，<code>NSMutableString</code>是可变的。<br><strong>注意：</strong><code>NSMutableString</code>是<code>NSString</code>的子类。</p>
</blockquote>
<h4 id="stringWithCapacity类方法"><a href="#stringWithCapacity类方法" class="headerlink" title="stringWithCapacity类方法"></a>stringWithCapacity类方法</h4><blockquote>
<p><strong>说明：</strong>创建一个新的<code>NSMutableString</code></p>
<ul>
<li><strong>参数：</strong>字符串的大小并不限于所提供的容量，这个容量仅是最优值，用来预分配一块内存，这样后续操作的速度会快很多。</li>
</ul>
<p><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSInteger&#125; 最优容量</span><br><span class="line">* @return &#123;id&#125; NSMutable对象</span><br><span class="line">*/</span></span><br><span class="line">+ <span class="keyword">id</span> stringWithCapacity: (<span class="built_in">NSUInteger</span>) capacity;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建可变字符串对象</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *string = [<span class="built_in">NSMutableString</span> stringWithCapacity: <span class="number">42</span>];</span><br></pre></td></tr></table></figure>
<h4 id="appendString实例方法"><a href="#appendString实例方法" class="headerlink" title="appendString实例方法"></a>appendString实例方法</h4><blockquote>
<p><strong>说明：</strong>接收参数<code>aString</code>，然后将其复制到接收对象的末尾。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; aString 子字符串</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) appendString: (<span class="built_in">NSString</span> *) aString;</span><br></pre></td></tr></table></figure>
<h4 id="appendFormat实例方法"><a href="#appendFormat实例方法" class="headerlink" title="appendFormat实例方法"></a>appendFormat实例方法</h4><blockquote>
<p><strong>说明：</strong>将格式化的字符串附加在接收字符串的末尾<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; format 格式串</span><br><span class="line">* @param &#123;...&#125; 格式串对应的值</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) appendFormat: (<span class="built_in">NSString</span> *) format, ...;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可变字符串方法</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *mString = [<span class="built_in">NSMutableString</span> stringWithCapacity:<span class="number">50</span>];</span><br><span class="line">[mString appendString:<span class="string">@"Hello there!"</span>];</span><br><span class="line">[mString appendFormat:<span class="string">@"human %d"</span>, <span class="number">42</span>];</span><br></pre></td></tr></table></figure>
<h4 id="deleteCharactersInRange实例方法"><a href="#deleteCharactersInRange实例方法" class="headerlink" title="deleteCharactersInRange实例方法"></a>deleteCharactersInRange实例方法</h4><blockquote>
<p><strong>说明：</strong>删除字符串中的字符。<br><strong>原型：</strong><code>NSString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSRange&#125; aRange 指定删除的部分坐在的区域</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) deleteCharactersInRange: (<span class="built_in">NSRange</span>) aRange;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建可变字符串对象</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *friends = [<span class="built_in">NSMutableString</span> stringWithCapacity: <span class="number">50</span>];</span><br><span class="line"><span class="comment">// 查找子串</span></span><br><span class="line"><span class="built_in">NSRange</span> jackRange = [friends tangeOfString: <span class="string">@"Jack"</span>];</span><br><span class="line">jackRange.length++;<span class="comment">// eat the space that follows</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除"Jack"</span></span><br><span class="line">[friends deleteCharactersInRange: jackRange];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用继承自NSString的实例方法</span></span><br><span class="line"><span class="built_in">NSMutableString</span> *string = [<span class="built_in">NSMutableString</span> strringWithFormat: <span class="string">@"jo%dy"</span>, <span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<h2 id="8-5-集合大家族"><a href="#8-5-集合大家族" class="headerlink" title="8.5    集合大家族"></a>8.5    集合大家族</h2><h3 id="8-5-1-NSArray"><a href="#8-5-1-NSArray" class="headerlink" title="8.5.1    NSArray"></a>8.5.1    NSArray</h3><blockquote>
<p><strong>说明：</strong>一个<code>Cocoa</code>类，用来存储对象的有序列表</p>
<ul>
<li>通过<code>工厂方法</code>创建</li>
<li>通过<code>字面量</code>创建（不需要在结尾处不上<code>nil</code>）</li>
</ul>
<p><strong>限制：</strong>有2个限制</p>
<ul>
<li>只能存储<code>Object-C</code>对象，不能存储原始的C语言基础数据类型</li>
<li>不能使用<code>nil（对象的零值）</code></li>
</ul>
<p><strong>技巧：</strong>可以通过一些<code>NSArray</code>的方法避开这些限制<br><strong>注意：</strong>为什么不能在<code>NSArray</code>中存放<code>nil</code>？</p>
<ul>
<li>使用工厂方法创建数组时，最后一个参数<code>nil</code>用来表示参数列表的末尾</li>
<li>没有办法判断<code>nil</code>是存储在数组中的数值还是代表循环结束的标志。</li>
</ul>
</blockquote>
<h4 id="arrayWithObjects类方法"><a href="#arrayWithObjects类方法" class="headerlink" title="arrayWithObjects类方法"></a>arrayWithObjects类方法</h4><blockquote>
<p><strong>说明：</strong>创建一个新的<code>NSArray</code>，可以发送一个以<code>,</code>分隔的对象列表，在列表结尾添加<code>nil</code>代表列表结束。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id ...&#125; 对象列表</span><br><span class="line">* @return &#123;NSArray&#125; 数组</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="built_in">NSArray</span>) arrayWithObjects(<span class="keyword">id</span> ...);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过工厂方法创建数组</span></span><br><span class="line"><span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithObjects: <span class="string">@"one"</span>, <span class="string">@"two"</span>, <span class="string">@"three"</span>, <span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过字面量创建数组</span></span><br><span class="line"><span class="built_in">NSArray</span> *array2 = @[<span class="string">@"one"</span>, <span class="string">@"two"</span>, <span class="string">@"three"</span>];</span><br></pre></td></tr></table></figure>
<h4 id="objectAtIndex实例方法"><a href="#objectAtIndex实例方法" class="headerlink" title="objectAtIndex实例方法"></a>objectAtIndex实例方法</h4><blockquote>
<p><strong>说明：</strong>索引数组元素。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问数组中的对象</span></span><br><span class="line"><span class="keyword">id</span> *myObject = array1[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (NAInteger i = <span class="number">0</span>; i &lt; [array count]; i++) &#123;</span><br><span class="line">    <span class="comment">// 通过方法索引</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"index %d has %@."</span>, i, [array1 objectAtIndex:i]);</span><br><span class="line">    <span class="comment">// 通过下标（字面量方式）索引</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"index %d has %@."</span>, i, array1[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="切分数组"><a href="#切分数组" class="headerlink" title="切分数组"></a>切分数组</h3><h4 id="componentsSepartedByString实例方法"><a href="#componentsSepartedByString实例方法" class="headerlink" title="componentsSepartedByString实例方法"></a>componentsSepartedByString实例方法</h4><blockquote>
<p><strong>说明：</strong>将字符串切分为数组。</p>
</blockquote>
<h4 id="componentsJoinedByString实例方法"><a href="#componentsJoinedByString实例方法" class="headerlink" title="componentsJoinedByString实例方法"></a>componentsJoinedByString实例方法</h4><blockquote>
<p><strong>说明：</strong>合并<code>NSArray</code>中的元素并创建字符串。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *string = <span class="string">@"oop:ack:bork:greeble:poines"</span>;</span><br><span class="line"><span class="built_in">NSArray</span> *chunks = [string componentsSeparatedByString:<span class="string">@":"</span>];</span><br><span class="line">string = [chunks componentsJoinedByString:<span class="string">@":-)"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="8-5-2-可变数组"><a href="#8-5-2-可变数组" class="headerlink" title="8.5.2    可变数组"></a>8.5.2    可变数组</h3><blockquote>
<p><strong>说明：</strong><code>NSArray</code>是不可变对象的数组，<code>NSMutableArray</code>是可变数组。<br><strong>注意：</strong>没有可以用来创建<code>NSMutableArray</code>对象的字面量语法。</p>
</blockquote>
<h4 id="arrayWithCapacity类方法"><a href="#arrayWithCapacity类方法" class="headerlink" title="arrayWithCapacity类方法"></a>arrayWithCapacity类方法</h4><blockquote>
<p><strong>说明：</strong>创建新的可变数组。<br><strong>原型：</strong><code>NSMutableString</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSInteger&#125; 容量</span><br><span class="line">* @return &#123;id&#125; 可变数组</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>) arrayWithCapacity: (<span class="built_in">NSInteger</span>) numItems;</span><br></pre></td></tr></table></figure>
<h4 id="removeObjectAtIndex实例方法"><a href="#removeObjectAtIndex实例方法" class="headerlink" title="removeObjectAtIndex实例方法"></a>removeObjectAtIndex实例方法</h4><blockquote>
<p><strong>说明：</strong>删除指定索引处的对象。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSUInteger&#125; index 下标</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) removeObjectAtIndex: (<span class="built_in">NSUInteger</span>) index;</span><br></pre></td></tr></table></figure>
<h3 id="8-5-3-遍历"><a href="#8-5-3-遍历" class="headerlink" title="8.5.3    遍历"></a>8.5.3    遍历</h3><blockquote>
<p><strong>说明：</strong>有<code>4</code>种方式</p>
<ul>
<li>从0到<code>[array count]</code>循环</li>
<li>使用迭代器：<code>NSEnumerator</code></li>
<li>使用快速迭代：<code>for-in</code>（10.5+）</li>
<li>使用代码块（依赖苹果最新的编译器：基于<code>CLang</code>和<code>LLVM</code>项目）</li>
</ul>
</blockquote>
<h4 id="NSEnumerator"><a href="#NSEnumerator" class="headerlink" title="NSEnumerator"></a>NSEnumerator</h4><blockquote>
<p><strong>说明：</strong>迭代器，<code>Cocoa</code>用它来表示集合中迭代出的对象。</p>
</blockquote>
<h4 id="objectEnumerator实例方法"><a href="#objectEnumerator实例方法" class="headerlink" title="objectEnumerator实例方法"></a>objectEnumerator实例方法</h4><blockquote>
<p><strong>说明：</strong>获取数组对应的迭代器(从前往后迭代)。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;NSEnumerator *&#125; 迭代器</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSEnumerator</span> *)objectEnumerator;</span><br></pre></td></tr></table></figure>
<h4 id="reverseObjectEnumerator实例方法"><a href="#reverseObjectEnumerator实例方法" class="headerlink" title="reverseObjectEnumerator实例方法"></a>reverseObjectEnumerator实例方法</h4><blockquote>
<p><strong>说明：</strong>获取数组对应的迭代器(从后往前迭代)。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;NSEnumerator *&#125; 迭代器</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSEnumerator</span> *)reverseObjectEnumerator;</span><br></pre></td></tr></table></figure>
<h4 id="nextObject实例方法"><a href="#nextObject实例方法" class="headerlink" title="nextObject实例方法"></a>nextObject实例方法</h4><blockquote>
<p><strong>说明：</strong>请求迭代器的下一个对象，返回<code>nil</code>时迭代结束。<br><strong>原型：</strong><code>NSEnumerator</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;id&#125; 迭代器迭代的一个对象</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">id</span>) nextObject;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>限制：</strong>获取<code>可变数组</code>的迭代器后，如果再通过添加或删除对象<code>改变了数组的容量</code>，枚举起就会出现混乱。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过字面量创建数组</span></span><br><span class="line"><span class="built_in">NSArray</span> *array = @[<span class="string">@"one"</span>, <span class="string">@"two"</span>, <span class="string">@"three"</span>];</span><br><span class="line"><span class="comment">// 获取迭代器</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> *enumerator = [array objectEnumerator];</span><br><span class="line"><span class="comment">// 使用迭代器遍历</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">id</span> thingie = [enumerator nextObject]) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"I found %@"</span>, thingie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-5-4-快速迭代"><a href="#8-5-4-快速迭代" class="headerlink" title="8.5.4    快速迭代"></a>8.5.4    快速迭代</h3><blockquote>
<p><strong>说明：</strong>在<code>Mac OS x 10.5</code>，<code>O-C</code>升级到<code>2.0</code>，引入了<code>快速枚举（迭代）</code>，类似一些脚本语言的<code>for-in</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *string <span class="keyword">in</span> array) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"I found %@"</span>, string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="enumerateObjectsUsingBlock实例方法"><a href="#enumerateObjectsUsingBlock实例方法" class="headerlink" title="enumerateObjectsUsingBlock实例方法"></a>enumerateObjectsUsingBlock实例方法</h4><blockquote>
<p><strong>说明：</strong>为了支持C语言的代码块功能，苹果公司添加了一个能在<code>NSArray</code>中通过<code>代码块</code>迭代对象的方法。<br><strong>优点：</strong>通过代码块可以让循环操作并发执行，而通过快速枚举，执行操作要一项项线性完成。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; string 迭代项</span><br><span class="line">* @param &#123;NSUInteger&#125; index 下标</span><br><span class="line">* @param &#123;BOOL *&#125; stop </span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) enumerateObjectUsingBlock:^(<span class="built_in">NSString</span> *string, <span class="built_in">NSUInteger</span> index, <span class="built_in">BOOL</span> *stop);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[array enumerateObjectsUsingBlock:^(<span class="built_in">NSString</span> *string, <span class="built_in">NSUInteger</span> index, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"I found %@"</span>, string);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="8-5-5-NSDictionary"><a href="#8-5-5-NSDictionary" class="headerlink" title="8.5.5    NSDictionary"></a>8.5.5    NSDictionary</h3><blockquote>
<p><strong>说明：</strong>字典是关键字及其定义的合集。<br><strong>扩展：</strong>字典使用的是键查询的优化方式，可以立即找到要查询的数据，而不需要遍历整个数组。</p>
</blockquote>
<h4 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h4><blockquote>
<p><strong>说明：</strong>创建字典最简单的方式就是用字典字面量。<br><strong>语法：</strong><code>@{key: value, ...}</code></p>
</blockquote>
<h4 id="dictionaryWithObjectsAndKeys类方法"><a href="#dictionaryWithObjectsAndKeys类方法" class="headerlink" title="dictionaryWithObjectsAndKeys类方法"></a>dictionaryWithObjectsAndKeys类方法</h4><blockquote>
<p><strong>说明：</strong>创建字典对象<br><strong>原型：</strong><code>NSDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id ...&#125; 键值对列表</span><br><span class="line">* @return &#123;id&#125; 字典对象</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>) dictionaryWithObjectsAndKeys: (<span class="keyword">id</span>) firstObject, ...;</span><br></pre></td></tr></table></figure>
<h4 id="objectForKey实例方法"><a href="#objectForKey实例方法" class="headerlink" title="objectForKey实例方法"></a>objectForKey实例方法</h4><blockquote>
<p><strong>说明：</strong>根据<code>关键字</code>访问字典中的<code>值</code>。<br><strong>原型：</strong><code>NSDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; aKey 键</span><br><span class="line">* @return &#123;id&#125; 值</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">id</span>) objectForKey: (<span class="keyword">id</span>) aKey;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象实例</span></span><br><span class="line">Tire *t1 = [Tire new];</span><br><span class="line">Tire *t2 = [Tire new];</span><br><span class="line">Tire *t3 = [Tire new];</span><br><span class="line">Tire *t4 = [Tire new];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用对象实例构建字典（工厂方法）</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *tires1 = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys: t1, <span class="string">@"front-left"</span>, t2, <span class="string">@"front-right"</span>, t3, <span class="string">@"back-left"</span>, t3, <span class="string">@"back-left"</span>, t4, <span class="string">@"back-right"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 使用对象实例构建字典（字面量）</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *tires2 = @&#123;<span class="string">@"front-left"</span>: t1, <span class="string">@"front-right"</span>: t2, <span class="string">@"back-left"</span>: t3, <span class="string">@"back-right"</span>: t4&#125;;</span><br><span class="line"><span class="comment">// 通过方法索引</span></span><br><span class="line">Tire *tire = [tires objectForKey: <span class="string">@"back-right"</span>];</span><br><span class="line"><span class="comment">// 通过字面量索引</span></span><br><span class="line">tire = tires[<span class="string">@"back-right"</span>];</span><br></pre></td></tr></table></figure>
<h4 id="可变字典"><a href="#可变字典" class="headerlink" title="可变字典"></a>可变字典</h4><blockquote>
<p><strong>说明：</strong><code>NSDictionary</code>容量是不可变的，<code>NSMutableDictionary</code>是可变的。<br><strong>注意：</strong>没有适用于<code>NSMutableDictionary</code>的字面量初始化语法。</p>
</blockquote>
<h5 id="dictionary类方法"><a href="#dictionary类方法" class="headerlink" title="dictionary类方法"></a>dictionary类方法</h5><blockquote>
<p><strong>说明：</strong>创建<code>NSMutableDictionary</code>实例。<br><strong>原型：</strong><code>NSMutableDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;id&#125; NSMutableDictionary实例</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="keyword">id</span>) dictionary;</span><br></pre></td></tr></table></figure>
<h5 id="dictionaryWithCapacity类方法"><a href="#dictionaryWithCapacity类方法" class="headerlink" title="dictionaryWithCapacity类方法"></a>dictionaryWithCapacity类方法</h5><blockquote>
<p><strong>说明：</strong>创建新的可变字典并告诉<code>Cocoa</code>该字典的最优大小。<br><strong>原型：</strong><code>NSMutableDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSUInteger&#125; numItems 最优容量</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) dictionaryWithCapacity: (<span class="built_in">NSUInteger</span>) numItems;</span><br></pre></td></tr></table></figure>
<h5 id="setObject实例方法"><a href="#setObject实例方法" class="headerlink" title="setObject实例方法"></a>setObject实例方法</h5><blockquote>
<p><strong>说明：</strong>为字典添加（设置）元素<br><strong>原型：</strong><code>NSMutableDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; anObject 值</span><br><span class="line">* @param &#123;id&#125; aKey  键</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) setObject: (<span class="keyword">id</span>)anObject forKey: (<span class="keyword">id</span>)aKey;</span><br></pre></td></tr></table></figure>
<h5 id="removeObjectForKey实例方法"><a href="#removeObjectForKey实例方法" class="headerlink" title="removeObjectForKey实例方法"></a>removeObjectForKey实例方法</h5><blockquote>
<p><strong>说明：</strong>在可变字典中删除元素<br><strong>原型：</strong><code>NSMutableDictionary</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; aKey 要删除的元素的键</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) removeObjectForKey: (<span class="keyword">id</span>) aKey;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建可变字典</span></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *tires = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line"><span class="comment">// 对象实例</span></span><br><span class="line">Tire *t1 = [Tire new];</span><br><span class="line">Tire *t2 = [Tire new];</span><br><span class="line">Tire *t3 = [Tire new];</span><br><span class="line">Tire *t4 = [Tire new];</span><br><span class="line"><span class="comment">// 为字典添加元素</span></span><br><span class="line">[tires setObject: t1 forKey: <span class="string">@"front-left"</span>];</span><br><span class="line">[tires setObject: t2 forKey: <span class="string">@"front-right"</span>];</span><br><span class="line">[tires setObject: t3 forKey: <span class="string">@"back-left"</span>];</span><br><span class="line">[tires setObject: t4 forKey: <span class="string">@"back-right"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除元素</span></span><br><span class="line">[tires removeObjectForKey: <span class="string">@"back-left"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="8-5-6-请不要乱来"><a href="#8-5-6-请不要乱来" class="headerlink" title="8.5.6    请不要乱来"></a>8.5.6    请不要乱来</h3><blockquote>
<p><strong>类蔟：</strong>一群隐藏在通用接口之下与实现相关的类。<br><strong>说明：</strong>在<code>Cocoa</code>中，许多类实际上是以<code>类蔟</code>的方式实现。比如，创建<code>NSString</code>对象时，实际上获得的可能是<code>NSLiteralString</code>、<code>NSCFString</code>、<code>NSSimpleCString</code>、<code>NSBallOfString</code>或者其他未写入文档的与实现相关的对象。<br><strong>技巧：</strong>不要尝试给一个<code>类蔟</code>创建子类，可以将<code>NSString</code>或<code>NSArray</code>复合到某个类中或者使用别类。</p>
</blockquote>
<h2 id="8-6-其他数值"><a href="#8-6-其他数值" class="headerlink" title="8.6    其他数值"></a>8.6    其他数值</h2><blockquote>
<p><strong>说明：</strong><code>NSArray</code>和<code>NSDictionary</code>只能存储对象，而不能直接存储任何基本类型的数据，如<code>int</code>、<code>float</code>和<code>struct</code>。<br><strong>技巧：</strong>可以用对象封装基本数据类型，然后再放入<code>NSArray</code>或<code>NSDictionary</code>。<br><strong>注意：</strong><code>Objective-C</code>不支持<code>自动开箱</code>和<code>自动装箱</code>。</p>
</blockquote>
<h3 id="8-6-1-NSNumber"><a href="#8-6-1-NSNumber" class="headerlink" title="8.6.1    NSNumber"></a>8.6.1    NSNumber</h3><blockquote>
<p><strong>说明：</strong>可以用来封装和数字相关的一些基本数据类型。<br><strong>工厂方法：</strong>以最常用的为例</p>
<ul>
<li><code>+ (NSNumber *) numberWithChar: (char) value;</code></li>
<li><code>+ (NSNumber *) numberWithInt: (int) value;</code></li>
<li><code>+ (NSNumber *) numberWithFloat: (float) value;</code></li>
<li><code>+ (NSNumber *) numberWithBool: (BOOL) value;</code></li>
</ul>
<p><strong>实例方法：</strong>从<code>NSNumber</code>中提取数值</p>
<ul>
<li><code>- (char) charValue</code></li>
<li><code>- (int) intValue</code></li>
<li><code>- (float) floatValue</code></li>
<li><code>- (BOOL) boolValue</code></li>
<li><code>- (NSString *) stringValue</code></li>
</ul>
<p><strong>字面量：</strong>可以使用字面量语法创建<code>NSNumber</code>对象</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装几本类型</span></span><br><span class="line"><span class="built_in">NSNumber</span> *number;</span><br><span class="line">number = @<span class="string">'X'</span>;<span class="comment">// 字符型</span></span><br><span class="line">number = @<span class="number">12345</span>;<span class="comment">// 整型</span></span><br><span class="line">number = @<span class="number">12345</span>ul;<span class="comment">// 无符号长整数</span></span><br><span class="line">number = @<span class="number">12345</span>ll;<span class="comment">// long long</span></span><br><span class="line">number = @<span class="number">123</span>,<span class="number">45</span>f;<span class="comment">// 浮点型</span></span><br><span class="line">number = @<span class="number">123</span>,<span class="number">45</span>;<span class="comment">// 双浮点型</span></span><br><span class="line">number = @YES;<span class="comment">// 布尔值</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> arrayWithCapacity];</span><br><span class="line"><span class="comment">// 存储到数组中</span></span><br><span class="line">[array addObject number];</span><br><span class="line">[dictionary setObject: number forKey: @:<span class="string">"Bork"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="8-6-2-NSValue"><a href="#8-6-2-NSValue" class="headerlink" title="8.6.2    NSValue"></a>8.6.2    NSValue</h3><blockquote>
<p><strong>说明：</strong><code>NSValue</code>可以封装任意值。<br><strong>扩展：</strong><code>NSNumber</code>是<code>NSValue</code>的子类。</p>
</blockquote>
<h4 id="valueWithBytes类方法"><a href="#valueWithBytes类方法" class="headerlink" title="valueWithBytes类方法"></a>valueWithBytes类方法</h4><blockquote>
<p><strong>说明：</strong>创建新的<code>NSValue</code>对象。<br><strong>原型：</strong><code>NSValue</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;const void *&#125; value 要存储的变量的地址</span><br><span class="line">* @param &#123;const char *&#125; type 描述数据类的字符串</span><br><span class="line">* @return &#123;NSValue *&#125; NSValue对象</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="built_in">NSValue</span> *) valueWithBytes: (<span class="keyword">const</span> <span class="keyword">void</span> *) value objCType: (<span class="keyword">const</span> <span class="keyword">char</span> *) type;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>工厂方法：</strong><code>NSValue</code>，举例</p>
<ul>
<li><code>(NSValue *)valueWithPoint: (NSPoint) aPoint;</code></li>
<li><code>(NSValue *)valueWithSize: (NSSize) size;</code></li>
<li><code>(NSValue *)valueWithRect: (NSRect);</code></li>
</ul>
<p><strong>实例方法：</strong><code>NSValue</code>, 会进行类型转换</p>
<ul>
<li><code>(NSPoint)pointValue;</code></li>
<li><code>(NSSize)sizeValue;</code></li>
<li><code>(NSRect)rectValue;</code></li>
</ul>
</blockquote>
<h4 id="getValue实例方法"><a href="#getValue实例方法" class="headerlink" title="getValue实例方法"></a>getValue实例方法</h4><blockquote>
<p><strong>说明：</strong>提取数值，返回一个<code>NSValue</code>型值。<br><strong>注意：</strong>方法名中使用了<code>get</code>，表明我们提供的是一个指针，而指针所指向的空间则用来存储该方法生成的数据。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个对象（struct）</span></span><br><span class="line"><span class="built_in">NSRect</span> rect = <span class="built_in">NSMakeRect</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">40</span>);</span><br><span class="line"><span class="comment">// 包装包NSValue型值中</span></span><br><span class="line"><span class="built_in">NSValue</span> *value = [<span class="built_in">NSValue</span> valueWithBytes:&amp;rect objCType:@encode(<span class="built_in">NSRect</span>)];</span><br><span class="line"><span class="comment">// 添加到数组中</span></span><br><span class="line">[array addObject:value];</span><br><span class="line">value = [array objectAtIndex:<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 提取数值</span></span><br><span class="line">[value getValue:&amp;rect];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 疯转NSRect</span></span><br><span class="line">value = [<span class="built_in">NSValue</span> valueWithRect:rect];</span><br><span class="line"><span class="comment">// 添加到数组</span></span><br><span class="line">[array addObject:value];</span><br><span class="line"><span class="comment">// 提取NSRect型值</span></span><br><span class="line"><span class="built_in">NSRect</span> anotherRect = [value rectValue];</span><br></pre></td></tr></table></figure>
<h3 id="8-6-3-NSNull"><a href="#8-6-3-NSNull" class="headerlink" title="8.6.3    NSNull"></a>8.6.3    NSNull</h3><blockquote>
<p><strong>说明：</strong>集合中不能放入<code>nil</code>，但可以放入<code>NSNull</code>。</p>
</blockquote>
<h4 id="null类方法"><a href="#null类方法" class="headerlink" title="null类方法"></a>null类方法</h4><blockquote>
<p><strong>说明：</strong>创建一个<code>NSNull</code>实例<br><strong>原型：</strong><code>NSNull</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;NSNull *&#125; NSNull实例</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="built_in">NSNull</span> *) null;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 想通讯录中加入一条信息（没有传真号）</span></span><br><span class="line">[contact setObject: [<span class="built_in">NSNull</span> null] forKey: <span class="string">@"home fax machine"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 索引这条信息</span></span><br><span class="line"><span class="keyword">id</span> homefax = [contact objectForKey: <span class="string">@"home fax machine"</span>];</span><br><span class="line"><span class="keyword">if</span> (homefax == [<span class="built_in">NSNull</span> null]) &#123;</span><br><span class="line">	<span class="comment">// 确实没有传真机</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-7-示例：查找文件"><a href="#8-7-示例：查找文件" class="headerlink" title="8.7    示例：查找文件"></a>8.7    示例：查找文件</h2><h3 id="8-7-1-使用迭代器的版本"><a href="#8-7-1-使用迭代器的版本" class="headerlink" title="8.7.1    使用迭代器的版本"></a>8.7.1    使用迭代器的版本</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建文件管理器</span></span><br><span class="line">        <span class="built_in">NSFileManager</span> *manager;</span><br><span class="line">        manager = [<span class="built_in">NSFileManager</span> defaultManager];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将~替换为相应的绝对目录</span></span><br><span class="line">        <span class="built_in">NSString</span> *home;</span><br><span class="line">        home = [<span class="string">@"~"</span> stringByExpandingTildeInPath];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取相应路径下文件集合的迭代器</span></span><br><span class="line">        <span class="built_in">NSDirectoryEnumerator</span> *direnum;</span><br><span class="line">        direnum = [manager enumeratorAtPath:home];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建存放文件的可变数组</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *files;</span><br><span class="line">        files = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:<span class="number">42</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过迭代器遍历寻找目标文件</span></span><br><span class="line">        <span class="built_in">NSString</span> *filename;</span><br><span class="line">        <span class="keyword">while</span> (filename = [direnum nextObject])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 查看扩展名是否匹配</span></span><br><span class="line">            <span class="keyword">if</span> ([[filename pathExtension] isEqualTo: <span class="string">@"jpg"</span>]) &#123;</span><br><span class="line">                [files addObject: filename];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过迭代器遍历匹配到的文件的文件名</span></span><br><span class="line">        <span class="built_in">NSEnumerator</span> *fileenum;</span><br><span class="line">        fileenum = [files objectEnumerator];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (filename = [fileenum nextObject])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-7-2-使用快速迭代的版本"><a href="#8-7-2-使用快速迭代的版本" class="headerlink" title="8.7.2    使用快速迭代的版本"></a>8.7.2    使用快速迭代的版本</h3><blockquote>
<p><strong>说明：</strong>不支持<code>Leopard</code>之前的版本。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="8-8-小结"><a href="#8-8-小结" class="headerlink" title="8.8    小结"></a>8.8    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_07  深入了解Xcode/" itemprop="url">
                  7 深入了解Xcode
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:38:28+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_07  深入了解Xcode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_07  深入了解Xcode/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="7-1-窗口布局一览"><a href="#7-1-窗口布局一览" class="headerlink" title="7.1    窗口布局一览"></a>7.1    窗口布局一览</h2><blockquote>
<p><strong>说明：</strong>窗口的组成部分</p>
</blockquote>
<table>
<thead>
<tr>
<th>组成</th>
<th>说明</th>
<th>相关功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>工具栏</td>
<td>位于窗口的最顶端</td>
<td>上面由很多工具按钮</td>
</tr>
<tr>
<td>导航器面板</td>
<td>位于窗口的左边，通常用来显示项目中的文件列表，也可以浏览其他内容</td>
<td>符号(symbol)、搜索(Search)、问题(Issue)、调试(Debug)、断点(BreakPoints)、和日志(Logs)</td>
</tr>
<tr>
<td>编辑器面板</td>
<td>卫浴中间偏右的位置</td>
<td>大部分时间都在这里工作</td>
</tr>
<tr>
<td>检查器面板</td>
<td>位于窗口右边</td>
<td>显示的是与上下文有关的信息，以及修改选中项属性值的按钮</td>
</tr>
<tr>
<td>调试器面板</td>
<td>位于底部居中位置</td>
<td>调试器运行的时候，堆栈和调试器控制器会出现在这里</td>
</tr>
<tr>
<td>库面板</td>
<td>隐藏在窗口右下角</td>
<td>列有项目资源、对象、代码片段和其他在项目中可能会用到的东西</td>
</tr>
</tbody>
</table>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-03%20%E4%B8%8B%E5%8D%8810.16.15.png" alt="Alt text"></p>
<h2 id="7-2-改变公司名称"><a href="#7-2-改变公司名称" class="headerlink" title="7.2    改变公司名称"></a>7.2    改变公司名称</h2><blockquote>
<p><strong>说明：</strong>公司的名称会出现在创建文件时自动生成的注释中。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-04%20%E4%B8%8A%E5%8D%8810.02.06.png" alt="Alt text"></p>
</blockquote>
<h2 id="7-3-使用编辑器的技巧"><a href="#7-3-使用编辑器的技巧" class="headerlink" title="7.3    使用编辑器的技巧"></a>7.3    使用编辑器的技巧</h2><blockquote>
<p><strong>说明：</strong>列举一下不同区域的使用的技巧<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-03%20%E4%B8%8B%E5%8D%8810.16.15.png" alt="Alt text"></p>
</blockquote>
<h3 id="7-3-1-导航器面板"><a href="#7-3-1-导航器面板" class="headerlink" title="7.3.1    导航器面板"></a>7.3.1    导航器面板</h3><blockquote>
<ol>
<li>导航器视图中使用<code>过滤搜索框</code>过滤列表文件（可以在任意导航器视图中使用）</li>
<li>双击源文件在新窗口中打开它</li>
</ol>
</blockquote>
<h3 id="7-3-2-工具栏"><a href="#7-3-2-工具栏" class="headerlink" title="7.3.2    工具栏"></a>7.3.2    工具栏</h3><blockquote>
<ol>
<li>右上方有一组标记为View的工具栏按钮，用来显示／隐藏部分窗口</li>
</ol>
</blockquote>
<h3 id="7-3-2-其它"><a href="#7-3-2-其它" class="headerlink" title="7.3.2    其它"></a>7.3.2    其它</h3><blockquote>
<ol>
<li>窗口顶端的工具栏下面看文件的路径</li>
<li>在多个标签页中打开多个视图：View(菜单) -&gt; Show Tab Bar -&gt; +</li>
</ol>
</blockquote>
<h2 id="7-4-在Xcode的帮助下编写代码"><a href="#7-4-在Xcode的帮助下编写代码" class="headerlink" title="7.4    在Xcode的帮助下编写代码"></a>7.4    在Xcode的帮助下编写代码</h2><h3 id="7-4-1-首行缩进（美观排版）"><a href="#7-4-1-首行缩进（美观排版）" class="headerlink" title="7.4.1    首行缩进（美观排版）"></a>7.4.1    首行缩进（美观排版）</h3><blockquote>
<p><strong>说明：</strong><code>O-C</code>并不要求缩进代码，但这么做是个好习惯。</p>
</blockquote>
<table>
<thead>
<tr>
<th>整理缩进</th>
<th>快捷键</th>
<th>菜单</th>
</tr>
</thead>
<tbody>
<tr>
<td>自动整理缩进</td>
<td>Control + I</td>
<td>右键（代码编辑区）-&gt; Structure -&gt; Re Indent</td>
</tr>
<tr>
<td>向左缩进</td>
<td>Command + [</td>
<td>右键（代码编辑区）-&gt; Structure -&gt; Shift Right</td>
</tr>
<tr>
<td>向右缩进</td>
<td>Command + [</td>
<td>左键（代码编辑区）-&gt; Structure -&gt; Shift Left</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>扩展：</strong>设置<code>自动整理</code>的风格：Xcode(菜单) -&gt; Preferences -&gt; Text Editing -&gt; Indentation</p>
</blockquote>
<h3 id="7-4-2-代码自动完成"><a href="#7-4-2-代码自动完成" class="headerlink" title="7.4.2    代码自动完成"></a>7.4.2    代码自动完成</h3><blockquote>
<p><strong>说明：</strong>当输入代码时，Xcode 会不断地比较你输入的代码和它生成的符号索引，如果两者匹配，Xcode就会给出建议。</p>
</blockquote>
<table>
<thead>
<tr>
<th>相关快捷键</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>Control + .(半角句号)</td>
<td>使推荐列表向后翻页</td>
</tr>
<tr>
<td>Shift + Control + .(半角句号)</td>
<td>使推荐列表向前翻页</td>
</tr>
<tr>
<td>esc</td>
<td>切换推荐列表的显示和隐藏</td>
</tr>
<tr>
<td>tap(或Enter)</td>
<td>使用推荐列表中高，亮的推荐项</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>技巧：</strong></p>
<ol>
<li>查看对象或类可用消息：<code>[对象或类 + 空格 + esc键</code></li>
<li>打开推荐列表中推荐方法的迷你帮助窗口：将鼠标悬停在推荐列表中的方法名上，便会看法哦窗口右边由一个<code>?</code>，点击它</li>
</ol>
</blockquote>
<h3 id="7-4-3-括号配对"><a href="#7-4-3-括号配对" class="headerlink" title="7.4.3    括号配对"></a>7.4.3    括号配对</h3><blockquote>
<p><strong>说明：</strong>输入某些<code>闭括号</code>（比如<code>)、}、]</code>）时，如果匹配到对应的<code>开括号</code>，屏幕会闪烁。如果没有正确闭合，<code>Xcode</code>会发出警报声。这个功能叫做<code>括号配对</code>。<br><strong>技巧：</strong>双击某个<code>分隔符</code>，<code>Xcode</code>会选定它以及与它匹配的货号之间的全部代码。</p>
</blockquote>
<h3 id="7-4-4-批量编辑"><a href="#7-4-4-批量编辑" class="headerlink" title="7.4.4    批量编辑"></a>7.4.4    批量编辑</h3><blockquote>
<p><strong>注意：</strong>批量操作是一件危险的操作，因此可以先创建一个<code>快照</code>用来恢复项目，但是<code>Xcode7</code>已经将此功能移除。</p>
</blockquote>
<h4 id="查找和替换"><a href="#查找和替换" class="headerlink" title="查找和替换"></a>查找和替换</h4><blockquote>
<p><strong>说明：</strong><code>Edit -&gt; Find</code>子菜单中包含几个非常方便的选项</p>
</blockquote>
<table>
<thead>
<tr>
<th>功能</th>
<th>说明</th>
<th>快捷键</th>
</tr>
</thead>
<tbody>
<tr>
<td>Find in Workspace…</td>
<td>Command + Shift + F</td>
<td>在当前工作区中搜索</td>
</tr>
<tr>
<td>Find and Replace in Workspace…</td>
<td>Command + Alt + Shift + F</td>
<td>在当前工作区中搜索并替换</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>缺点：</strong>对于一些替换任务，查找和替换的功能并不好用</p>
<ul>
<li>修改的过于彻底，比如只想重命名函数中的变量，但事实上整个文件中的变量名都被修改了</li>
<li>不能修改文件名（修改类需要同时修改文件名）</li>
</ul>
</blockquote>
<h4 id="Edit-all-in-Scope"><a href="#Edit-all-in-Scope" class="headerlink" title="Edit all in Scope"></a>Edit all in Scope</h4><blockquote>
<p><strong>说明：</strong>在范围内编辑全部内容。</p>
<ol>
<li>在编辑器中选中要修改的<code>标记名</code></li>
<li>点击它，右边出现一个向下的箭头，点击箭头出现一个菜单</li>
<li>选择菜单，选择Edit all in Scope</li>
</ol>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%20%E4%B8%8A%E5%8D%888.14.05.png" alt="Alt text"><br><strong>注意：</strong>如果Xcode中的语法高亮功能被关闭或改动很多，<code>Edit in all Scope</code>功能也许就会拒绝工作</p>
</blockquote>
<h4 id="Xcode内置的重构工具"><a href="#Xcode内置的重构工具" class="headerlink" title="Xcode内置的重构工具"></a>Xcode内置的重构工具</h4><blockquote>
<p><strong>说明：</strong>不仅能重命名类，还能重命名相应源文件。</p>
<ol>
<li>打开存在要修改的类名的文件，将光标放到类名中</li>
<li>Edit(菜单)-&gt;Refactor-&gt;Rename</li>
</ol>
<p><strong>注意：</strong>重构不能重命名注释中的文字。所以，<code>类里面的注释</code>、<code>Xcode生成的文件头注释</code>或者任何你编写的<code>文档注释</code>都需要手工编辑（可以通过查找和替换简化这一过程）。</p>
</blockquote>
<h3 id="7-4-5-代码导航"><a href="#7-4-5-代码导航" class="headerlink" title="7.4.5    代码导航"></a>7.4.5    代码导航</h3><h4 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h4><blockquote>
<p><strong>说明：</strong>源自<code>emacs</code>，同时适用于Xcode、TextEdit、Safari的地址栏和文本域、Pages和Keynote文本域。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%20%E4%B8%8A%E5%8D%888.44.02.png" alt="Alt text"></p>
</blockquote>
<h4 id="快速打开"><a href="#快速打开" class="headerlink" title="快速打开"></a>快速打开</h4><blockquote>
<p><strong>说明：</strong>大致有2种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>用途</th>
<th>操作</th>
<th>快捷键</th>
</tr>
</thead>
<tbody>
<tr>
<td>项目文件搜索</td>
<td>File(菜单)-&gt;Open Quickly</td>
<td>Command + Shift + D</td>
</tr>
<tr>
<td>辅助窗口（默认打开当前文件对应的<code>.m</code>文件或<code>.h</code>文件）</td>
<td>View(菜单)-&gt;Assistant Editor-&gt;Show Assistant Editor</td>
<td><strong>打开：</strong>Command + alt + Enter  <strong>关闭：</strong>Command + Enter</td>
</tr>
</tbody>
</table>
<h3 id="7-4-6-集中精力"><a href="#7-4-6-集中精力" class="headerlink" title="7.4.6    集中精力"></a>7.4.6    集中精力</h3><blockquote>
<p><strong>说明：</strong><code>边栏（gutter）</code>和<code>聚焦栏（focus ribbon）</code></p>
</blockquote>
<table>
<thead>
<tr>
<th><em>**</em></th>
<th>说明</th>
<th>操作</th>
</tr>
</thead>
<tbody>
<tr>
<td>边栏</td>
<td>代码调试</td>
</tr>
<tr>
<td>聚焦栏</td>
<td>代码折叠</td>
<td><strong>显示聚焦栏：</strong><code>Xcode(菜单)-&gt;Preferences...-&gt;Text Editing-&gt;勾选Code folding ribbon</code>；<strong>更多代码折叠操作：</strong><code>Editor-&gt;Code Folding</code></td>
</tr>
</tbody>
</table>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%20%E4%B8%8A%E5%8D%889.13.08.png" alt="Alt text"></p>
<h3 id="7-4-7-使用导航条"><a href="#7-4-7-使用导航条" class="headerlink" title="7.4.7    使用导航条"></a>7.4.7    使用导航条</h3><blockquote>
<p><strong>说明：</strong>里面的很多空间可以让你在项目中的原文件之间快速切换。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%2011.05.05.png" alt="Alt text"></p>
</blockquote>
<h4 id="pragma指令"><a href="#pragma指令" class="headerlink" title="#pragma指令"></a><code>#pragma</code>指令</h4><blockquote>
<p><strong>说明：</strong>可以将<code>O-C</code>常规代码之外的一些信息或说明传递给编译器和代码编辑器。</p>
<ul>
<li><code>#pragma mark 说明</code>：添加标记到功能菜单</li>
<li><code>#pragma mark -</code>：在菜单中插入一条分割线</li>
</ul>
</blockquote>
<h4 id="注释中使用特殊字符"><a href="#注释中使用特殊字符" class="headerlink" title="注释中使用特殊字符"></a>注释中使用特殊字符</h4><blockquote>
<p><strong>说明：</strong>会将相应的注释信息放入功能菜单中，类似<code>#pragma mark</code>的效果。例如：</p>
<ul>
<li><code>MARK:说明</code></li>
<li><code>TODO:说明</code></li>
<li><code>FIXME:说明</code></li>
<li><code>!!!:说明</code></li>
<li><code>???:说明</code></li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%2013.13.37.png" alt="Alt text"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#pragma mark 初始化父类</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        engine = [Engine new];</span><br><span class="line">        <span class="comment">// MARK:初始化实例属性</span></span><br><span class="line">        tires[<span class="number">0</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">1</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">2</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">3</span>] = [Tire new];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125; <span class="comment">// init</span></span><br></pre></td></tr></table></figure>
<h3 id="7-4-8-获取信息"><a href="#7-4-8-获取信息" class="headerlink" title="7.4.8    获取信息"></a>7.4.8    获取信息</h3><h4 id="7-4-8-1-获得帮助"><a href="#7-4-8-1-获得帮助" class="headerlink" title="7.4.8.1    获得帮助"></a>7.4.8.1    获得帮助</h4><p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-05%2013.52.23.png" alt="Alt text"></p>
<h4 id="7-4-8-2-文档管理程序"><a href="#7-4-8-2-文档管理程序" class="headerlink" title="7.4.8.2    文档管理程序"></a>7.4.8.2    文档管理程序</h4><blockquote>
<p><strong>说明：</strong>访问苹果官方API文档有以下方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>情景</th>
<th>操作</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>quick search</td>
<td>option + 单击某个标记</td>
<td>只弹出一个包含概要信息的帮助窗口</td>
</tr>
<tr>
<td>在文档浏览窗口查看相应文档</td>
<td>option + 双击某个标记（或 将光标移动到标记內  + control + option + command + /）</td>
</tr>
</tbody>
</table>
<h2 id="7-5-调试"><a href="#7-5-调试" class="headerlink" title="7.5    调试"></a>7.5    调试</h2><h3 id="7-5-1-暴力测试"><a href="#7-5-1-暴力测试" class="headerlink" title="7.5.1    暴力测试"></a>7.5.1    暴力测试</h3><blockquote>
<p><strong>说明：</strong>在程序中写入语句（如<code>NSLog</code>）来输出程序中的控制流程和一些数据值。</p>
</blockquote>
<h3 id="7-5-2-Xcode的调试器"><a href="#7-5-2-Xcode的调试器" class="headerlink" title="7.5.2    Xcode的调试器"></a>7.5.2    Xcode的调试器</h3><blockquote>
<p><strong>调试器：</strong>位于程序和操作系统之间的程序，能够</p>
<ul>
<li>中断程序，这样就可以检查程序的数据，甚至修改程序，然后恢复程序并查看运行结果</li>
<li>可以单步执行代码，减缓程序运行的速度，细致地查看代码会对数据进行哪些改动</li>
</ul>
<p><strong>调试窗口：</strong>可以提供大量概述信息<br><strong>调试控制台：</strong>可以直接向调试器发送调试命令的调试控制台。<br><strong>说明：</strong>调试窗口可以选择两种调试器，<code>GDB</code>和<code>LLDB</code>，区别主要是精细度和内联性。</p>
<ul>
<li><strong>GDB：</strong>GNU计划的一部分，可以在各种平台上兼容，享誉已久</li>
<li><strong>LLDB：</strong>LLVM计划多个Xcode工具中的一员</li>
</ul>
</blockquote>
<h3 id="7-5-3-精巧的调试符号"><a href="#7-5-3-精巧的调试符号" class="headerlink" title="7.5.3    精巧的调试符号"></a>7.5.3    精巧的调试符号</h3><blockquote>
<p><strong>说明：</strong>调试程序时可以让编译器发出额外的调试符号，可以使用Debug构建配置（Product-&gt;Schema-&gt;Edit Schema）。</p>
</blockquote>
<h3 id="7-5-4-开始调试"><a href="#7-5-4-开始调试" class="headerlink" title="7.5.4    开始调试"></a>7.5.4    开始调试</h3><blockquote>
<p><strong>说明：</strong>使用GUI比命令行进行调试更加容易一些</p>
<ol>
<li>设置断点</li>
<li>运行程序</li>
<li>调试</li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-06%20%E4%B8%8A%E5%8D%8810.52.03.png" alt="Alt text"></p>
<h3 id="7-5-5-检查程序"><a href="#7-5-5-检查程序" class="headerlink" title="7.5.5    检查程序"></a>7.5.5    检查程序</h3><blockquote>
<p><strong>说明：</strong>在调试状态下，将鼠标放在变量名上时，会弹出一个<code>显示</code>当前数值信息的弹出窗，点击里面的值还可以<code>修改</code>当前值。</p>
</blockquote>
<h2 id="7-6-备忘表"><a href="#7-6-备忘表" class="headerlink" title="7.6    备忘表"></a>7.6    备忘表</h2><blockquote>
<p><strong>说明：</strong>Xcode键盘快捷键<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-06%20%E4%B8%8B%E5%8D%8812.14.31.png" alt="Alt text"><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-06%20%E4%B8%8B%E5%8D%8812.15.11.png" alt="Alt text"></p>
</blockquote>
<h2 id="7-7-小结"><a href="#7-7-小结" class="headerlink" title="7.7    小结"></a>7.7    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_06  源文件组织/" itemprop="url">
                  6 源文件组织
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:38:06+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_06  源文件组织/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_06  源文件组织/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>将程序拆分为多个小文件有助于更快地找到重要的代码。</p>
</blockquote>
<h2 id="6-1-拆分接口与实现"><a href="#6-1-拆分接口与实现" class="headerlink" title="6.1    拆分接口与实现"></a>6.1    拆分接口与实现</h2><blockquote>
<p><strong>说明：</strong>接口放在<code>.h</code>文件，实现放在<code>.m</code>文件。</p>
</blockquote>
<table>
<thead>
<tr>
<th>文件</th>
<th>存放代码</th>
</tr>
</thead>
<tbody>
<tr>
<td>头文件(.h)</td>
<td>类的<code>@interface</code>指令、公共<code>struct</code>定义、<code>enum</code>常量、<code>#defines</code>和<code>extern</code>全局变量等</td>
</tr>
<tr>
<td>和类同名的.m(或.mm)文件</td>
<td>类的<code>@implementation</code>指令、全局变量的定义、私有struct等</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong>如果用<code>.mm</code>做文件扩展名，编译器就会认为你是用<code>Objective-C++</code>（同时使用<code>C++</code>和<code>Objective-C</code>）编写的代码</p>
</blockquote>
<h3 id="在Xcode中创建新文件"><a href="#在Xcode中创建新文件" class="headerlink" title="在Xcode中创建新文件"></a>在Xcode中创建新文件</h3><blockquote>
<p><strong>说明：</strong>创建包含类的文件</p>
<ol>
<li>File（菜单）-&gt; New -&gt; File…</li>
<li>选择模版：ios -&gt; Source -&gt; Cocoa Class</li>
<li>填写类名</li>
<li>选择父类（默认NSObject）</li>
<li>选择群组和目标</li>
<li>选择存储位置并保存</li>
</ol>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>群组（Group）</td>
<td>文件都放在群组内的文件夹中，将代码分组存放可以帮助组织项目中的源文件</td>
<td><code>1.</code> 设置群组时，Xcode并不会在硬盘上移动文件或者创建目录，群组关系仅仅是Xcode负责管理的一项奇妙的功能；<code>2.</code> 可以设置群组指向文件系统中某个特定的目录，Xcode会新建的文件放入该目录中</td>
</tr>
<tr>
<td>目标（Target）</td>
<td>复杂的项目可以拥有多个目标，它们源文件的配置各不相同，构建规则也不同</td>
</tr>
</tbody>
</table>
<h2 id="6-2-拆分-Car-程序"><a href="#6-2-拆分-Car-程序" class="headerlink" title="6.2    拆分 Car 程序"></a>6.2    拆分 Car 程序</h2><blockquote>
<p><strong>说明：</strong>每个类都由头文件（<code>.h</code>）和实现文件（<code>.m</code>）组成，入口在<code>main.m</code></p>
<ul>
<li><strong>头文件（<code>.h</code>文件）：</strong>通过<code>import</code>引入模块的过程放在头文件</li>
<li><strong>实现文件（<code>.m</code>文件）：</strong>文件中需要引入相应的头文件（<code>.h</code>）文件</li>
</ul>
<p><strong>技巧：</strong>复合的程序文件中使用了其它类，如果只是通过指针引用了相应的类实例，可以用<code>@class</code>声明引用的类而不需要<code>import</code>，从而提升重新编译时的性能。</p>
<p><strong>导入文件：</strong><code>import</code>文件有两种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>导入</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>#import &quot;文件&quot;</code></td>
<td>导入项目本地的头文件</td>
</tr>
<tr>
<td><code>#import &lt;文件&gt;</code></td>
<td>导入系统文件（只读）</td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── 6.2\ CarPaers-Split<span class="comment"># 存放代码的群组</span></span><br><span class="line">│   ├── AllWeatherRadial.h</span><br><span class="line">│   ├── AllWeatherRadial.m</span><br><span class="line">│   ├── Car.h</span><br><span class="line">│   ├── Car.m</span><br><span class="line">│   ├── Engine.h</span><br><span class="line">│   ├── Engine.m</span><br><span class="line">│   ├── Slant6.h</span><br><span class="line">│   ├── Slant6.m</span><br><span class="line">│   ├── Tire.h</span><br><span class="line">│   ├── Tire.m</span><br><span class="line">│   └── main.m<span class="comment"># 入口文件</span></span><br><span class="line">└── 6.2\ CarPaers-Split.xcodeproj</span><br><span class="line">    ├── project.pbxproj</span><br><span class="line">    └── xcuserdata</span><br><span class="line">        └── tonyearth.xcuserdatad</span><br></pre></td></tr></table></figure>
<h2 id="6-3-使用快文件依赖关系"><a href="#6-3-使用快文件依赖关系" class="headerlink" title="6.3    使用快文件依赖关系"></a>6.3    使用快文件依赖关系</h2><blockquote>
<p><strong>说明：</strong>依赖关系可以存在于两个或多个文件之间，并且具有传递性，如果其中一个文件发生变化，其它文件都会被重新编译。</p>
</blockquote>
<h3 id="6-3-1-重新编译须知"><a href="#6-3-1-重新编译须知" class="headerlink" title="6.3.1    重新编译须知"></a>6.3.1    重新编译须知</h3><blockquote>
<p><strong>说明：</strong>文件导入过于混乱会延长编译时间，也会导致不必要的重复编译，可以通过<code>@class</code>减少必需导入的头文件的数量，从而可以缩短编译时间。</p>
</blockquote>
<h4 id="class"><a href="#class" class="headerlink" title="@class"></a>@class</h4><blockquote>
<p><strong>说明：</strong>创建一个前向引导，用在程序不需要知道类的所有信息的场景（比如创建了相应的变量，但没有向变量发送消息）。<br><strong>技巧：</strong>如果试图通过<code>#import</code>语句让两个类相互引用，那么就会出现编译错误，可以用<code>@class</code>替代。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line"></span><br><span class="line">- (Engine *) engine;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire</span><br><span class="line">         atIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h3 id="6-3-2-让汽车跑一会儿"><a href="#6-3-2-让汽车跑一会儿" class="headerlink" title="6.3.2    让汽车跑一会儿"></a>6.3.2    让汽车跑一会儿</h3><p><em>Car.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line">&#123;</span><br><span class="line">    Tire *tires[<span class="number">4</span>];</span><br><span class="line">    Engine *engine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        engine = [Engine new];</span><br><span class="line"></span><br><span class="line">        tires[<span class="number">0</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">1</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">2</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">3</span>] = [Tire new];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Engine *) engine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine</span><br><span class="line">&#123;</span><br><span class="line">    engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire</span><br><span class="line">         atIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in setTire:atIndex:"</span>,</span><br><span class="line">               index);</span><br><span class="line">        exit (<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tires[index] = tire;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// setTire:atIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in tireAtIndex:"</span>,</span><br><span class="line">               index);</span><br><span class="line">        exit (<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (tires[index]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// tireAtIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, engine);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h3 id="6-3-3-导入和继承"><a href="#6-3-3-导入和继承" class="headerlink" title="6.3.3    导入和继承"></a>6.3.3    导入和继承</h3><blockquote>
<p><strong>说明：</strong>如果当前的文件头文件中的类会<code>继承</code>要引入的类，则不能通过<code>@class</code>引入，因为编译器需要知道父类中实例变量的完整信息。</p>
</blockquote>
<p><em>Slant6.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Slant6</span> : <span class="title">Engine</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="6-4-小结"><a href="#6-4-小结" class="headerlink" title="6.4    小结"></a>6.4    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_05  复合/" itemprop="url">
                  5 复合
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:37:38+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_05  复合/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_05  复合/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>建立类之间的关系除了<code>继承</code>还有<code>复合</code></p>
</blockquote>
<h2 id="5-1-什么是复合"><a href="#5-1-什么是复合" class="headerlink" title="5.1    什么是复合"></a>5.1    什么是复合</h2><blockquote>
<p><strong>说明：</strong>使用复合可组合多个对象，让它们分工协作<br><strong>原理：</strong>在<code>0-C</code> 中，复合是通过包含作为实例变量的对象指针实现的。</p>
</blockquote>
<h2 id="5-2-自定义NSLog"><a href="#5-2-自定义NSLog" class="headerlink" title="5.2    自定义NSLog()"></a>5.2    自定义NSLog()</h2><blockquote>
<p><strong>说明：</strong>在类中提供<code>description方法</code>就可以自定义<code>NSLog()</code>会如何输出对象。</p>
</blockquote>
<h3 id="在init中初始化实例属性"><a href="#在init中初始化实例属性" class="headerlink" title="在init中初始化实例属性"></a>在init中初始化实例属性</h3><blockquote>
<p><strong>说明：</strong>使用<code>new</code>创建新对象时后台进行了两步</p>
<ol>
<li>为对象分配内存，用来存放<code>实例变量</code>（如果实例属性是对象，被初始化为<code>nil</code>）</li>
<li>自动调用<code>init方法</code>，之后对象进入可用状态</li>
</ol>
<p><strong>扩展：</strong>在<code>init方法中</code>使用<code>if (self = [super init])</code>是为了完成父类的初始化并确保父类返回的对象和一开始创建的对象是一致的。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Tire</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Tire</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">@"I am a tire. I last a while"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Engine</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Engine</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">@"I am an engine.  Vrooom!"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    Engine *engine;</span><br><span class="line">    Tire *tires[<span class="number">4</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        engine = [Engine new];</span><br><span class="line">        </span><br><span class="line">        tires[<span class="number">0</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">1</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">2</span>] = [Tire new];</span><br><span class="line">        tires[<span class="number">3</span>] = [Tire new];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, engine);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">3</span>]);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main (<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    Car *car;</span><br><span class="line">    </span><br><span class="line">    car = [Car new];</span><br><span class="line">    [car print];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="comment">// main</span></span><br></pre></td></tr></table></figure>
<h2 id="5-3-存取方法"><a href="#5-3-存取方法" class="headerlink" title="5.3    存取方法"></a>5.3    存取方法</h2><blockquote>
<p><strong>说明：</strong>是用来读取或改变某个对象属性的方法。</p>
</blockquote>
<table>
<thead>
<tr>
<th>存取方法</th>
<th>方法命名（Cocoa惯例）</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>getter</td>
<td>getPropertyName</td>
<td>返回实例变量的值</td>
</tr>
<tr>
<td>setter</td>
<td>propertyName</td>
<td>将实例变量的值赋为参数所指向的值</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>建议：</strong>如果要对对象中的属性进行操作，因该尽量使用对象提供的存取方法，而不是直接改变对象里面的值。<br><strong>注意：</strong>不要将<code>get</code>作为getter方法的前缀，因为<code>get</code>出现在<code>Cocoa</code>的方法名称中意味着这个方法会将你传递的参数作为指针来返回数值。</p>
</blockquote>
<h3 id="5-3-1-设置-engine-属性的存取方法"><a href="#5-3-1-设置-engine-属性的存取方法" class="headerlink" title="5.3.1    设置 engine 属性的存取方法"></a>5.3.1    设置 engine 属性的存取方法</h3><blockquote>
<p><strong>说明：</strong>在<code>@interface</code>和<code>@implementation</code>中同时增加存取方法。<br><strong>扩展：</strong>在内存管理和对象的多有权方面<code>Engin</code>的<code>getter</code>方法和<code>setter</code>方法还存在着问题。</p>
</blockquote>
<h3 id="5-3-2-设置-tires-属性的存取方法"><a href="#5-3-2-设置-tires-属性的存取方法" class="headerlink" title="5.3.2    设置 tires 属性的存取方法"></a>5.3.2    设置 tires 属性的存取方法</h3><blockquote>
<p><strong>说明：</strong>不仅要知道新轮胎，还要知道新轮胎的位置。<br><strong>注意：</strong><code>防御式编程</code><br>对无效索引进行防御。</p>
</blockquote>
<h3 id="5-3-3-Car-类代码的其他变化"><a href="#5-3-3-Car-类代码的其他变化" class="headerlink" title="5.3.3    Car 类代码的其他变化"></a>5.3.3    Car 类代码的其他变化</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Tire</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Tire</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">@"I am a tire. I last a while"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Engine</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Engine</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">@"I am an engine.  Vrooom!"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">	Engine *engine;</span><br><span class="line">	Tire *tires[<span class="number">4</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Engine *) engine;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire</span><br><span class="line">		 atIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">		engine = [Engine new];</span><br><span class="line">		</span><br><span class="line">		tires[<span class="number">0</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">1</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">2</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">3</span>] = [Tire new];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Engine *) engine</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine</span><br><span class="line">&#123;</span><br><span class="line">	engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire</span><br><span class="line">		 atIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in setTire:atIndex:"</span>,</span><br><span class="line">			   index);</span><br><span class="line">		exit (<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	tires[index] = tire;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// setTire:atIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in tireAtIndex:"</span>,</span><br><span class="line">			   index);</span><br><span class="line">		exit (<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (tires[index]);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// tireAtIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, engine);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">3</span>]);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main (<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) </span><br><span class="line">&#123;</span><br><span class="line">	Car *car = [Car new];</span><br><span class="line">	</span><br><span class="line">	Engine *engine = [Engine new];</span><br><span class="line">	[car setEngine: engine];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		Tire *tire = [Tire new];</span><br><span class="line">		</span><br><span class="line">		[car setTire: tire atIndex: i];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	[car print];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (<span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// main</span></span><br></pre></td></tr></table></figure>
<h2 id="5-4-扩展-CarParts-程序"><a href="#5-4-扩展-CarParts-程序" class="headerlink" title="5.4    扩展 CarParts 程序"></a>5.4    扩展 CarParts 程序</h2><blockquote>
<p><strong>说明：</strong>结合<code>继承</code>和<code>复合</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Tire</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Tire</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">@"I am a tire. I last a while"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Tire</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// 新型轮胎</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AllWeatherRadial</span> : <span class="title">Tire</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// AllWeatherRadial</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AllWeatherRadial</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">@"I am a tire for rain or shine."</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// AllWeatherRadial</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Engine</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Engine</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">@"I am an engine.  Vrooom!"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// 新型引擎</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Slant6</span> : <span class="title">Engine</span></span></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Slant6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Slant6</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">@"I am a slant-6. VROOOM!"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Slant6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">	Engine *engine;</span><br><span class="line">	Tire *tires[<span class="number">4</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Engine *) engine;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine;</span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire atIndex: (<span class="keyword">int</span>) index;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) init</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">		engine = [Engine new];</span><br><span class="line">		</span><br><span class="line">		tires[<span class="number">0</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">1</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">2</span>] = [Tire new];</span><br><span class="line">		tires[<span class="number">3</span>] = [Tire new];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Engine *) engine</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (engine);</span><br><span class="line">&#125; <span class="comment">// engine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setEngine: (Engine *) newEngine</span><br><span class="line">&#123;</span><br><span class="line">	engine = newEngine;</span><br><span class="line">&#125; <span class="comment">// setEngine</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setTire: (Tire *) tire atIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in setTire:atIndex:"</span>, index);</span><br><span class="line">		exit (<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	tires[index] = tire;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// setTire:atIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (Tire *) tireAtIndex: (<span class="keyword">int</span>) index</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">3</span>) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"bad index (%d) in tireAtIndex:"</span>, index);</span><br><span class="line">		exit (<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (tires[index]);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// tireAtIndex:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, engine);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">1</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">2</span>]);</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, tires[<span class="number">3</span>]);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main (<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) </span><br><span class="line">&#123;</span><br><span class="line">	Car *car = [Car new];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		Tire *tire = [AllWeatherRadial new];</span><br><span class="line">		</span><br><span class="line">		[car setTire: tire</span><br><span class="line">			 atIndex: i];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Engine *engine = [Slant6 new];</span><br><span class="line">	[car setEngine: engine];</span><br><span class="line">	</span><br><span class="line">	[car print];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> (<span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// main</span></span><br></pre></td></tr></table></figure>
<h2 id="5-5-复合还是继承"><a href="#5-5-复合还是继承" class="headerlink" title="5.5    复合还是继承"></a>5.5    复合还是继承</h2><blockquote>
<p><strong>说明：</strong>在进行面向对象编程时通常会犯这样的错误－任何东西都想使用继承。</p>
</blockquote>
<table>
<thead>
<tr>
<th>比较</th>
<th>类之间的关系</th>
</tr>
</thead>
<tbody>
<tr>
<td>继承</td>
<td><code>is a</code></td>
</tr>
<tr>
<td>复合</td>
<td><code>has a</code></td>
</tr>
</tbody>
</table>
<h2 id="5-6-小结"><a href="#5-6-小结" class="headerlink" title="5.6    小结"></a>5.6    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_04  继承/" itemprop="url">
                  4 继承
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:36:44+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_04  继承/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_04  继承/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>处理类和对象的关系时，要重视<code>OOP</code>的两个方面</p>
<ul>
<li><strong>继承：</strong>定义一个具有父类所有功能的新类</li>
<li><strong>复合：</strong>在对象中引用其他对象</li>
</ul>
</blockquote>
<h2 id="4-1-为何使用继承"><a href="#4-1-为何使用继承" class="headerlink" title="4.1    为何使用继承"></a>4.1    为何使用继承</h2><blockquote>
<p><strong>说明：</strong>将所有重复的内容合并在一起，并在需要的地方拥有自定义的方法。<br><strong>不使用继承的架构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-02%20%E4%B8%8B%E5%8D%887.34.10.png" alt="Alt text"><br><strong>使用继承后的架构</strong><br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-02%20%E4%B8%8B%E5%8D%887.35.04.png" alt="Alt text"></p>
</blockquote>
<h2 id="4-2-继承的语法格式"><a href="#4-2-继承的语法格式" class="headerlink" title="4.2    继承的语法格式"></a>4.2    继承的语法格式</h2><blockquote>
<p><strong>说明：</strong><code>@interface 子类名: 父类名</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>超类（或父类）</td>
<td>继承的类</td>
</tr>
<tr>
<td>子类（或孩子类）</td>
<td>执行继承的类</td>
</tr>
<tr>
<td>重写</td>
<td>如果想改变方法的实现，需要重写继承的方法</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>O-C</code>不支持多继承（可以使用类别和协议模拟多继承效果）</p>
</blockquote>
<h2 id="4-3-继承的工作机制"><a href="#4-3-继承的工作机制" class="headerlink" title="4.3    继承的工作机制"></a>4.3    继承的工作机制</h2><h3 id="4-3-1-方法调度"><a href="#4-3-1-方法调度" class="headerlink" title="4.3.1    方法调度"></a>4.3.1    方法调度</h3><blockquote>
<p><strong>说明：</strong>当发送消息时，<code>O-C</code>的方法调度机制将在当前的类中搜索相应的方法。如果无法在接收消息的对象的类文件中找到相应的方法，它就会在该对象的超类中进行查找。<br><strong>注意：</strong>如果在最顶层的<code>NSObject</code>类中也没有找到该方法，则会出现一个运行时错误。</p>
</blockquote>
<h3 id="4-3-2-实例变量"><a href="#4-3-2-实例变量" class="headerlink" title="4.3.2    实例变量"></a>4.3.2    实例变量</h3><blockquote>
<p><strong>说明：</strong><code>O-C</code> 中图和访问实例变量</p>
<ul>
<li>子类会从父类继承实例变量</li>
<li>子类根据自己的情况添加额外的自己的实例变量</li>
<li>每个方法被调用时都获得了一个名为<code>self</code>的参数，<code>self</code>指向继承链中第一个类中的第一个实例变量。</li>
</ul>
<p><strong>多态性：</strong>使用更具体种类的对象来代替一般类型，这种能力被称为<code>多态性</code>。<br><strong>扩展：</strong>通过<code>对象基地址</code>（第一个实例变量的首个字节在内存中的位置）加上<code>偏移地址</code>，编译器就可以查找其他实例变量的位置。这个机制叫做<code>基地址加偏移</code>，通过硬编码实现，但存在<code>脆弱的基类问题</code>，<code>Leopard</code>系统中通过引入64位<code>Objective-C</code>运行时（使用间接寻址方式确定变量的位置）解决了这个问题。</p>
</blockquote>
<h2 id="4-4-重写方法"><a href="#4-4-重写方法" class="headerlink" title="4.4    重写方法"></a>4.4    重写方法</h2><h3 id="super关键字"><a href="#super关键字" class="headerlink" title="super关键字"></a>super关键字</h3><blockquote>
<p><strong>说明：</strong>利用<code>super</code>，既可以重写方法的实现，又能调用超类中的实现方式。<br><strong>原理：</strong>既不是参数也不是实例变量，而是由<code>Objective-C</code>编译器提供的一种神奇的功能。当想<code>super</code>发送消息时，实际上是在请求<code>Obective-C</code>向该类的超类发送消息。如果超类中没有定义该消息，则向平常一样继续在<code>继承链</code>上一级中查找。</p>
</blockquote>
<h2 id="4-5-小结"><a href="#4-5-小结" class="headerlink" title="4.5    小结"></a>4.5    小结</h2><h2 id="4-6-举个栗子"><a href="#4-6-举个栗子" class="headerlink" title="4.6    举个栗子"></a>4.6    举个栗子</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_03  面向对象编程的基础知识/" itemprop="url">
                  3 面向对象编程的基础知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:35:54+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_03  面向对象编程的基础知识/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_03  面向对象编程的基础知识/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>OOP历史：</strong>演变自20世纪60年代的<code>Simula</code>、70年代的<code>SmallTalk</code>、80年代的<code>Clascal</code>以及其他相关语言。<code>C++</code>、<code>Java</code>、<code>Python</code>和<code>Objective-C</code>等现代编程语言都从这个早期的语言中获得了灵感。</p>
</blockquote>
<h2 id="3-1-间接"><a href="#3-1-间接" class="headerlink" title="3.1    间接"></a>3.1    间接</h2><p><code>只要在多加一层间接，计算机科学中就没有解决不了的问题</code>。</p>
<blockquote>
<p><strong>说明：</strong>指的就是面向对象的<code>多态性</code>。<br><strong>原理：</strong>在程序运行期间，通过指针间接获取某个值，而不是直接获取（<code>指针指向</code>的变化对程序员不可见）。</p>
</blockquote>
<h3 id="3-1-1-变量与间接"><a href="#3-1-1-变量与间接" class="headerlink" title="3.1.1    变量与间接"></a>3.1.1    变量与间接</h3><blockquote>
<p><strong>说明：</strong>基本变量就是间接思想的一种实际应用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 通过修改 count 间接控制后面循环的次数，本身就蕴含着间接的思想</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"The numbers from 1 to %d:"</span>, count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%d\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-使用文件名的间接"><a href="#3-1-2-使用文件名的间接" class="headerlink" title="3.1.2    使用文件名的间接"></a>3.1.2    使用文件名的间接</h3><blockquote>
<p><strong>说明：</strong>程序中使用文件（而不是写死在代码中）也是间接思想的运用。<br><strong>技巧：</strong><code>xcode</code>中运行程序时提供文件路径的方式</p>
<ol>
<li>打开设置面板：Product（菜单）-&gt; Scheme -&gt; Edit Scheme</li>
<li>在面板中添加参数：Arguments -&gt; Arguments Passed On Launch—&gt;点击<code>+</code>添加</li>
</ol>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 命令中没有提供文件名，则退出程序</span></span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"you need to provide a file name"</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 打开文件</span></span><br><span class="line">    FILE *wordFile = fopen(argv[<span class="number">1</span>], <span class="string">"r"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 访问文件</span></span><br><span class="line">    <span class="keyword">char</span> word[<span class="number">100</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 一行一行地读区</span></span><br><span class="line">    <span class="keyword">while</span> (fgets(word, <span class="number">100</span>, wordFile)) &#123;</span><br><span class="line">        <span class="comment">// 将每行最后的换行符替换为字符串结束符（从而不会被后面的 strlen 计入字符串的长度）</span></span><br><span class="line">        word[strlen(word) - <span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%s is %lu characters long"</span>, word, strlen(word));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. 关闭文件</span></span><br><span class="line">    fclose(wordFile);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-2-在面向对象编程中使用间接"><a href="#3-2-在面向对象编程中使用间接" class="headerlink" title="3.2    在面向对象编程中使用间接"></a>3.2    在面向对象编程中使用间接</h2><blockquote>
<p><strong>说明：</strong><code>OOP</code>的核心在于使用间接来调用代码（而不是直接调用函数）</p>
</blockquote>
<h3 id="3-2-1-过程式编程"><a href="#3-2-1-过程式编程" class="headerlink" title="3.2.1    过程式编程"></a>3.2.1    过程式编程</h3><blockquote>
<p><strong>说明：</strong>在过程式编程中，数据通常保存在简单的数据结构中。要花时间连接数据和用来处理数据的函数。<br><strong>语言举例：</strong><code>BASIC</code>、<code>C</code>、<code>Tcl</code>和<code>Perl</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">/******* 枚举：图形的基本元素 *******/</span></span><br><span class="line"><span class="comment">// 图形类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    kCircle,</span><br><span class="line">    kRectangle,</span><br><span class="line">    kEgg</span><br><span class="line">&#125; ShapeType;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形颜色</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    kRedColor,</span><br><span class="line">    kGreenColor,</span><br><span class="line">    kBlueColor</span><br><span class="line">&#125; ShapeColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 结构体：图形类型 ******/</span></span><br><span class="line"><span class="comment">// 绘图区域</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, width, height;<span class="comment">// 坐标和边长</span></span><br><span class="line">&#125; ShapeRect;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    ShapeType type;<span class="comment">// 类型</span></span><br><span class="line">    ShapeColor fillColor;<span class="comment">// 填充色</span></span><br><span class="line">    ShapeRect bounds;<span class="comment">// 边框</span></span><br><span class="line">&#125; Shape;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 将传入的颜色值转换为字符串描述</span><br><span class="line"> * @param &#123;ShapeColor&#125; colorName 图形颜色</span><br><span class="line"> * @return &#123;NSString&#125; 枚举类型的颜色对应的字符串</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">NSString</span> *colorName (ShapeColor colorName) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (colorName) &#123;</span><br><span class="line">        <span class="keyword">case</span> kRedColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"red"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kGreenColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"green"</span>;</span><br><span class="line">        <span class="keyword">case</span> kBlueColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"blue"</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制圆形</span><br><span class="line"> * @param &#123;ShapeRect&#125; bounds 绘制区域</span><br><span class="line"> * @param &#123;ShapeColor&#125; fillColor 图形填充色</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawCircle (ShapeRect bounds, ShapeColor fillColor) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a circle at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.height, bounds.width, colorName(fillColor));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制矩形</span><br><span class="line"> * @param &#123;ShapeRect&#125; bounds 绘制区域</span><br><span class="line"> * @param &#123;ShapeColor&#125; fillColor 图形填充色</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawRectangle (ShapeRect bounds, ShapeColor fillColor) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a rectangle at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.height, bounds.width, colorName(fillColor));&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制椭圆形</span><br><span class="line"> * @param &#123;ShapeRect&#125; bounds 绘制区域</span><br><span class="line"> * @param &#123;ShapeColor&#125; fillColor 图形填充色</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawEgg (ShapeRect bounds, ShapeColor fillColor) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a egg at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.height, bounds.width, colorName(fillColor));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图形</span><br><span class="line"> * @param &#123;Shape[]&#125; shapes 要绘制的一组图形</span><br><span class="line"> * @param &#123;int&#125; count 绘制数组中的前count个图形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawShapes (Shape shapes[], <span class="keyword">int</span> count) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (shapes[i].type) &#123;</span><br><span class="line">            <span class="keyword">case</span> kCircle:</span><br><span class="line">                drawCircle (shapes[i].bounds, shapes[i].fillColor);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> kRectangle:</span><br><span class="line">                drawRectangle (shapes[i].bounds, shapes[i].fillColor);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> kEgg:</span><br><span class="line">                drawEgg(shapes[i].bounds, shapes[i].fillColor);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">// 存放图形实例的数组</span></span><br><span class="line">    Shape shapes[<span class="number">3</span>];</span><br><span class="line">    <span class="comment">// 红色圆形</span></span><br><span class="line">    ShapeRect rect0 = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">30</span>&#125;;</span><br><span class="line">    shapes[<span class="number">0</span>].type = kCircle;</span><br><span class="line">    shapes[<span class="number">0</span>].fillColor = kRedColor;</span><br><span class="line">    shapes[<span class="number">0</span>].bounds = rect0;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绿色矩形</span></span><br><span class="line">    ShapeRect rect1 = &#123;<span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>&#125;;</span><br><span class="line">    shapes[<span class="number">1</span>].type = kRectangle;</span><br><span class="line">    shapes[<span class="number">1</span>].fillColor = kGreenColor;</span><br><span class="line">    shapes[<span class="number">1</span>].bounds = rect1;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 蓝色椭圆</span></span><br><span class="line">    ShapeRect rect2 = &#123;<span class="number">15</span>, <span class="number">18</span>, <span class="number">37</span>, <span class="number">29</span>&#125;;</span><br><span class="line">    shapes[<span class="number">2</span>].type = kEgg;</span><br><span class="line">    shapes[<span class="number">2</span>].fillColor = kBlueColor;</span><br><span class="line">    shapes[<span class="number">2</span>].bounds = rect2;</span><br><span class="line">    </span><br><span class="line">    drawShapes(shapes, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2016-01-02 00:50:43.911 3.2.1-procedureOriented[834:55458] drawing a circle at (0 0 30 10) <span class="keyword">in</span> red</span><br><span class="line">2016-01-02 00:50:43.912 3.2.1-procedureOriented[834:55458] drawing a rectangle at (30 40 60 50) <span class="keyword">in</span> green</span><br><span class="line">2016-01-02 00:50:43.912 3.2.1-procedureOriented[834:55458] drawing a egg at (15 18 29 37) <span class="keyword">in</span> blue</span><br><span class="line">Program ended with <span class="built_in">exit</span> code: 0</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-实现面向对象编程"><a href="#3-2-2-实现面向对象编程" class="headerlink" title="3.2.2    实现面向对象编程"></a>3.2.2    实现面向对象编程</h3><blockquote>
<p><strong>说明：</strong>过程式编程建立在函数之上，数据为函数服务，而面向对象编程则以程序的数据为中心，函数为数据服务。<br><strong>原理：</strong>数据通过<code>间接方式</code>引用相应代码对数据进行操作（数据能够知道如何查找相应的函数）。</p>
</blockquote>
<h4 id="id（标识符）"><a href="#id（标识符）" class="headerlink" title="id（标识符）"></a>id（标识符）</h4><blockquote>
<p><strong>说明：</strong><code>identifier</code>，是一种泛型，可以用来定义引用任何类型对象的变量。</p>
</blockquote>
<h4 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h4><blockquote>
<p><strong>说明：</strong>通知对象执行某种操作，也叫做<code>调用方法</code></p>
</blockquote>
<h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><blockquote>
<p><strong>说明：</strong>不同于其他<code>OOP</code>系统，在<code>O-C</code>中，如果在运行时改变某个类，则该类的所有对象会<code>自动继承这些变化</code>。</p>
</blockquote>
<h2 id="3-3-有关术语"><a href="#3-3-有关术语" class="headerlink" title="3.3    有关术语"></a>3.3    有关术语</h2><blockquote>
<p><strong>说明：</strong>有关<code>面向对象</code>的术语</p>
</blockquote>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
<th>语法</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>类(class)</strong></td>
<td>一种表示对象类型的结构体</td>
<td>类名首字母大写</td>
<td>对象通过它的类来获取自身的各种信息</td>
</tr>
<tr>
<td><strong>对象或实例(object)</strong></td>
<td>一种包含值和指向其类的隐藏指针的结构体</td>
<td>指向对象的变量通常首字母不要大些</td>
<td></td>
</tr>
<tr>
<td><strong>消息(message)</strong></td>
<td>对象可以执行的操作，用于通知对象做什么</td>
<td></td>
</tr>
<tr>
<td><strong>方法(method)</strong></td>
<td>响应消息运行的代码</td>
<td></td>
<td>根据对象的类，消息可以调用不同的方法</td>
</tr>
<tr>
<td><strong>方法调度(method dispatcher)</strong></td>
<td>用于推测执行什么方法以响应某个特定的消息</td>
<td></td>
</tr>
<tr>
<td><strong>接口(interface)</strong></td>
<td>类为对象提供的特性描述</td>
<td></td>
</tr>
<tr>
<td><strong>实现(implementation)</strong></td>
<td>使接口能正常工作的代码</td>
</tr>
</tbody>
</table>
<h2 id="3-4-Object-C语言中的OOP"><a href="#3-4-Object-C语言中的OOP" class="headerlink" title="3.4    Object-C语言中的OOP"></a>3.4    Object-C语言中的OOP</h2><h3 id="3-4-1-interface部分"><a href="#3-4-1-interface部分" class="headerlink" title="3.4.1    @interface部分"></a>3.4.1    @interface部分</h3><blockquote>
<p><strong>说明：</strong>定义类的公共接口，真正运行的代码位于<code>@implementation</code>中。<br><strong>用途：</strong>在特定类的对象被创建时，为编译器提供有关该类的信息，尤其是对象的数据成员及其提供的功能。<br><strong>组成：</strong>语法上包含以下几个部分</p>
<ul>
<li>继承其它<code>interface</code></li>
<li>实现<code>protocol</code></li>
<li>实例变量</li>
<li>方法声明</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> 类名: 父类名 </span>&#123;</span><br><span class="line">	<span class="comment">// 实例属性</span></span><br><span class="line">	属性类型 属性名;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法声明</span></span><br><span class="line">- (返回值类型) 方法名: (参数<span class="number">1</span>类型)参数<span class="number">1</span>名称, (参数<span class="number">2</span>类型)参数<span class="number">2</span>名称;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// 类名（便于代码阅读）</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>在声明方法时，如果方法有参数，则需要冒号，否则不需要。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Circle类</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Circle</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例变量</span></span><br><span class="line">    <span class="keyword">@private</span></span><br><span class="line">    ShapeColor fillColor;</span><br><span class="line">    ShapeRect bounds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法声明</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor: (ShapeColor) fillColor;</span><br><span class="line">- (<span class="keyword">void</span>) setBounds: (ShapeRect) bounds;</span><br><span class="line">- (<span class="keyword">void</span>) draw;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Circle</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-implementation部分"><a href="#3-4-2-implementation部分" class="headerlink" title="3.4.2    @implementation部分"></a>3.4.2    @implementation部分</h3><blockquote>
<p><strong>说明：</strong><code>@implementation</code>是一个编译器指令，表明将为某个类提供代码</p>
<ul>
<li>方法的定义不必按照在<code>@interface</code>指令中的顺序出现</li>
<li>可以定义没有在<code>@interface</code>中声明过的方法</li>
<li>同一个类中，方法的参数名不可以和实例属性名相同，否则方法被调用时会覆盖实例属性的值</li>
</ul>
<p><strong>扩展：</strong></p>
<ul>
<li><strong>实例变量名：</strong>如果实例变量取一个和方法名相同的名字，<code>Cocoa</code>还可以发挥出某些神奇的威力</li>
<li><strong>运行时：</strong><code>O-C运行时</code>是指用户应用程序时，支持这些应用程序的代码块</li>
<li><strong>self：</strong>类的方法被调用时，一个名为<code>self</code>的秘密隐藏参数将被传递给接受对象，而这个参数引用的就是该接收对象</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Circle</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置图形填充色</span><br><span class="line"> * @param &#123;ShapeColor&#125; c 颜色</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor:(ShapeColor)c &#123;</span><br><span class="line">    fillColor = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置绘图区域</span><br><span class="line"> * @param &#123;ShapeRect&#125; b 绘图区域</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setBounds:(ShapeRect)b &#123;</span><br><span class="line">    bounds = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-实例化对象"><a href="#3-4-3-实例化对象" class="headerlink" title="3.4.3    实例化对象"></a>3.4.3    实例化对象</h3><blockquote>
<p><strong>说明：</strong>实例化对象时，需要分配内存，然后将这些内存初始化并保存为有用的默认值。<br><strong>语法：</strong>向相应的<code>类</code>(或已经存在的<code>对象</code>)发送<code>new</code>消息，该类接收并处理完<code>new</code>消息后，我们就会得到一个可以使用的新对象实例。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// 图形类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    kCircle,</span><br><span class="line">    kRectangle,</span><br><span class="line">    kEgg</span><br><span class="line">&#125; ShapeType;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// 图形颜色</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    kRedColor,</span><br><span class="line">    kGreenColor,</span><br><span class="line">    kBlueColor</span><br><span class="line">&#125; ShapeColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// 绘图区域</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, width, height;<span class="comment">// 坐标和边长</span></span><br><span class="line">&#125; ShapeRect;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 将传入的颜色值转换为字符串描述</span><br><span class="line"> * @param &#123;ShapeColor&#125; colorName 图形颜色</span><br><span class="line"> * @return &#123;NSString&#125; 枚举类型的颜色对应的字符串</span><br><span class="line"> */</span></span><br><span class="line"><span class="built_in">NSString</span> *colorName (ShapeColor colorName) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (colorName) &#123;</span><br><span class="line">        <span class="keyword">case</span> kRedColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"red"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> kGreenColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"green"</span>;</span><br><span class="line">        <span class="keyword">case</span> kBlueColor:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">@"blue"</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// Circle类</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Circle</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例变量</span></span><br><span class="line">    <span class="keyword">@private</span></span><br><span class="line">    ShapeColor fillColor;</span><br><span class="line">    ShapeRect bounds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法声明</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor: (ShapeColor) fillColor;</span><br><span class="line">- (<span class="keyword">void</span>) setBounds: (ShapeRect) bounds;</span><br><span class="line">- (<span class="keyword">void</span>) draw;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Circle</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Circle类的实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Circle</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置图形填充色</span><br><span class="line"> * @param &#123;ShapeColor&#125; c 颜色</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor:(ShapeColor)c &#123;</span><br><span class="line">    fillColor = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置绘图区域</span><br><span class="line"> * @param &#123;ShapeRect&#125; b 绘图区域</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setBounds:(ShapeRect)b &#123;</span><br><span class="line">    bounds = b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) draw &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a circle at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.width, bounds.height, colorName(fillColor));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// Rectangle类</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Rectangle</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例变量</span></span><br><span class="line"><span class="keyword">@private</span></span><br><span class="line">    ShapeColor fillColor;</span><br><span class="line">    ShapeRect bounds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法声明</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor: (ShapeColor) fillColor;</span><br><span class="line">- (<span class="keyword">void</span>) setBounds: (ShapeRect) bounds;</span><br><span class="line">- (<span class="keyword">void</span>) draw;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Rectangle</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rectangle类的实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Rectangle</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置图形填充色</span><br><span class="line"> * @param &#123;ShapeColor&#125; c 颜色</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor:(ShapeColor)c &#123;</span><br><span class="line">    fillColor = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置绘图区域</span><br><span class="line"> * @param &#123;ShapeRect&#125; b 绘图区域</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setBounds:(ShapeRect)b &#123;</span><br><span class="line">    bounds = b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) draw &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a rectangle at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.width, bounds.height, colorName(fillColor));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">// Egg类</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Egg</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例变量</span></span><br><span class="line"><span class="keyword">@private</span></span><br><span class="line">    ShapeColor fillColor;</span><br><span class="line">    ShapeRect bounds;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法声明</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor: (ShapeColor) fillColor;</span><br><span class="line">- (<span class="keyword">void</span>) setBounds: (ShapeRect) bounds;</span><br><span class="line">- (<span class="keyword">void</span>) draw;</span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Egg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Egg类的实现</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Egg</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置图形填充色</span><br><span class="line"> * @param &#123;ShapeColor&#125; c 颜色</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setFillCollor:(ShapeColor)c &#123;</span><br><span class="line">    fillColor = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 设置绘图区域</span><br><span class="line"> * @param &#123;ShapeRect&#125; b 绘图区域</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setBounds:(ShapeRect)b &#123;</span><br><span class="line">    bounds = b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 绘制</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) draw &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"drawing a egg at (%d %d %d %d) in %@"</span>, bounds.x, bounds.y, bounds.width, bounds.height, colorName(fillColor));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------------------------</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  绘制图形</span><br><span class="line"> * @param &#123;id[]&#125; shapes 要绘制的一组图形</span><br><span class="line"> * @param &#123;int&#125; count 绘制数组中的前count个图形</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">void</span> drawShapes (<span class="keyword">id</span> shapes[], <span class="keyword">int</span> count) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="keyword">id</span> shape = shapes[i];</span><br><span class="line">        [shape draw];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">id</span> shapes[<span class="number">3</span>];</span><br><span class="line">    <span class="comment">// 红色圆形</span></span><br><span class="line">    ShapeRect rect0 =&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">30</span>&#125;;</span><br><span class="line">    shapes[<span class="number">0</span>] = [Circle new];</span><br><span class="line">    [shapes[<span class="number">0</span>] setBounds: rect0];</span><br><span class="line">    [shapes[<span class="number">0</span>] setFillCollor:kRedColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绿色矩形</span></span><br><span class="line">    ShapeRect rect1 = &#123;<span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>&#125;;</span><br><span class="line">    shapes[<span class="number">1</span>] = [Rectangle new];</span><br><span class="line">    [shapes[<span class="number">1</span>] setBounds: rect1];</span><br><span class="line">    [shapes[<span class="number">1</span>] setFillCollor:kGreenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 蓝色椭圆</span></span><br><span class="line">    ShapeRect rect2 = &#123;<span class="number">15</span>, <span class="number">18</span>, <span class="number">37</span>, <span class="number">29</span>&#125;;</span><br><span class="line">    shapes[<span class="number">2</span>] = [Egg new];</span><br><span class="line">    [shapes[<span class="number">2</span>] setBounds: rect2];</span><br><span class="line">    [shapes[<span class="number">2</span>] setFillCollor:kBlueColor];</span><br><span class="line">    </span><br><span class="line">    drawShapes(shapes, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-4-扩展-Shapes-Object-程序"><a href="#3-4-4-扩展-Shapes-Object-程序" class="headerlink" title="3.4.4    扩展 Shapes-Object 程序"></a>3.4.4    扩展 Shapes-Object 程序</h3><blockquote>
<p><strong>说明：</strong>软件实体应该对扩展开放，而对修改关闭</p>
</blockquote>
<h2 id="3-5-小结"><a href="#3-5-小结" class="headerlink" title="3.5    小结"></a>3.5    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">98</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
