<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta property="og:type" content="website">
<meta property="og:title" content="Sean">
<meta property="og:url" content="http://laputa-er.github.io/page/6/index.html">
<meta property="og:site_name" content="Sean">
<meta property="og:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sean">
<meta name="twitter:description" content="整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://laputa-er.github.io/page/6/"/>

  <title> Sean </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sean</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">笔记分享</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_01  基础部分/" itemprop="url">
                  1 基础部分
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:31:53+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_01  基础部分/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_01  基础部分/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-1-常量和变量"><a href="#1-1-常量和变量" class="headerlink" title="1.1    常量和变量"></a>1.1    常量和变量</h2><blockquote>
<p><strong>描述：</strong>常量和变量把一个名字和一个指定类型的值关良起来。<br><strong>说明：</strong>两者的区别在于设定后是否还能修改</p>
<ul>
<li>常量：设定后不可能修改</li>
<li>变量：可以随意更改</li>
</ul>
</blockquote>
<h3 id="1-1-1-声明常量和变量"><a href="#1-1-1-声明常量和变量" class="headerlink" title="1.1.1    声明常量和变量"></a>1.1.1    声明常量和变量</h3><blockquote>
<p><strong>共同规则：</strong></p>
<ul>
<li>可以在一行中声明多个，用<code>,</code>分隔</li>
</ul>
<p><strong>关键字：</strong></p>
<ul>
<li><code>let</code>：常量</li>
<li><code>var</code>：变量</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常量声明</span></span><br><span class="line"><span class="keyword">let</span> maximunNumberOfLoginAttemts = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量声明</span></span><br><span class="line"><span class="keyword">var</span> currentLoginAttempts = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">0.0</span>, y = <span class="number">0.0</span>, z = <span class="number">0.0</span></span><br></pre></td></tr></table></figure>
<h3 id="1-1-2-类型标注"><a href="#1-1-2-类型标注" class="headerlink" title="1.1.2    类型标注"></a>1.1.2    类型标注</h3><blockquote>
<p><strong>用途：</strong>说明常量或者变量中要存储的值的类型<br><strong>注意：</strong></p>
<ul>
<li>如果没有类型标注，声明时都必须设置一个值作为初始值，否则报错</li>
<li>类型标注可以省略，此时Swift可以通过赋的初始值推断其类型</li>
</ul>
<p><strong>语法：</strong><code>var welcomeMessage: String</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>var</th>
<th>welcomeMessage:</th>
<th></th>
<th>String</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>let(var)</code></td>
<td>常量(变量)名</td>
<td><code>:</code></td>
<td><code>空格</code></td>
<td>类型名称</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>说明：</strong>可以在一行中定义多个同样类型的变量，<code>,</code>分隔，并在最后一个比变量名之后添加<code>类型标注</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明</span></span><br><span class="line"><span class="keyword">var</span> welcomeMessage: <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">welcomeMessage = <span class="string">"Hello"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明多个具有相同类型标注的变量的略写方式</span></span><br><span class="line"><span class="keyword">var</span> red, green, blue:<span class="type">Double</span></span><br></pre></td></tr></table></figure>
<h3 id="1-1-3-常量和变量的命名"><a href="#1-1-3-常量和变量的命名" class="headerlink" title="1.1.3    常量和变量的命名"></a>1.1.3    常量和变量的命名</h3><blockquote>
<p><strong>说明：</strong>声明完成后，一些特性将不能再次修改</p>
<ul>
<li>已经声明的名字不能再次用来声明</li>
<li>声明时确定的类型不能更改</li>
<li>常量与变量不能相互转换</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>不允许的字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>数学符号</td>
</tr>
<tr>
<td>箭头</td>
</tr>
<tr>
<td>保留的（非法的）<code>Univode</code>码位</td>
</tr>
<tr>
<td>连线</td>
</tr>
<tr>
<td>制表符</td>
</tr>
<tr>
<td>数字（仅开头不能使用）</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常量和变量的命名</span></span><br><span class="line"><span class="keyword">let</span> π = <span class="number">3.141592654</span></span><br><span class="line"><span class="keyword">let</span> 你好 = <span class="string">"Hello"</span></span><br><span class="line"><span class="keyword">let</span> ？？ = <span class="string">"dog"</span><span class="comment">// 中文全角的</span></span><br></pre></td></tr></table></figure>
<h3 id="1-1-4-输出常量和变量"><a href="#1-1-4-输出常量和变量" class="headerlink" title="1.1.4    输出常量和变量"></a>1.1.4    输出常量和变量</h3><h4 id="print函数"><a href="#print函数" class="headerlink" title="print函数"></a>print函数</h4><blockquote>
<p><strong>描述：</strong>一个用来输出一个或多个值到适当输出区的全局函数。<br><strong>说明：</strong>可以直接通过<code>\(表达式)</code>的方式在字符串中插值（<code>String interprolation</code>）<br><strong>原型：</strong><code>全局函数</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">/**</span><br><span class="line">&gt;* @param &#123;Any...&#125; items 可变个任意类型的参数</span><br><span class="line">&gt;* @param &#123;String=&#125; separator 连接符（默认为空格，可省略）</span><br><span class="line">&gt;* @param &#123;String=&#125; terminator 自动追加再末尾的字串（默认为换行符，可省略）</span><br><span class="line">&gt;* @param &#123;&amp;Target=&#125; toStream 输出流（默认为标准输出流，可省略）</span><br><span class="line">&gt;*/</span></span><br><span class="line">&gt;void <span class="built_in">print</span>(items: <span class="type">Any</span>..., separator: <span class="type">String</span>, terminator: <span class="type">String</span>, toStream: &amp;<span class="type">Target</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str1 = <span class="string">"hello"</span></span><br><span class="line"><span class="keyword">var</span> str2 = <span class="string">"world"</span></span><br><span class="line"><span class="comment">// hello,world!</span></span><br><span class="line"><span class="built_in">print</span>(str1, str2, separator:<span class="string">","</span>, terminator:<span class="string">"!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// hello world\n</span></span><br><span class="line"><span class="built_in">print</span>(str1, str2)</span><br></pre></td></tr></table></figure>
<h2 id="1-2-注释"><a href="#1-2-注释" class="headerlink" title="1.2    注释"></a>1.2    注释</h2><blockquote>
<p><strong>说明：</strong>和C语言的注释非常相似</p>
<ul>
<li>单行注释：<code>// 这是一个注释</code></li>
<li>多行注释：<code>/* 多行注释 */</code></li>
</ul>
<p><strong>注意：</strong>和C语言不同的是，swift支持前套的多行注释。便于在原先多行注释的基础上扩大注释范围。</p>
</blockquote>
<h2 id="1-3-分号"><a href="#1-3-分号" class="headerlink" title="1.3    分号"></a>1.3    分号</h2><blockquote>
<p><strong>说明：</strong>和大部分语句有所不同</p>
<ul>
<li>单独占一行的语句的结尾处的分号可以省略</li>
<li>一行代码存在多个语句，则语句之间的<code>;</code>不能省略</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cat = <span class="string">"?"</span>; <span class="built_in">print</span>(cat)</span><br></pre></td></tr></table></figure>
<h2 id="1-3-整数"><a href="#1-3-整数" class="headerlink" title="1.3    整数"></a>1.3    整数</h2><blockquote>
<p><strong>说明：</strong>一共有<code>10</code>种整数类型（<code>(U)Int(4种宽度)</code>）<br><strong>注意：</strong>其中8种类型是指定的宽度的，<code>Int</code>和<code>UInt</code>类型比较特殊，其宽度依赖于处理器架构。</p>
</blockquote>
<table>
<thead>
<tr>
<th>长度(bit)</th>
<th>有符号</th>
<th>无符号</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>Int8</td>
<td>UInt8</td>
</tr>
<tr>
<td>16</td>
<td>Int16</td>
<td>UInt16</td>
</tr>
<tr>
<td>32</td>
<td>Int32</td>
<td>UInt32</td>
</tr>
<tr>
<td>64</td>
<td>Int64</td>
<td>UInt64</td>
</tr>
<tr>
<td>依赖平台</td>
<td>Int</td>
<td>UInt</td>
</tr>
</tbody>
</table>
<h3 id="1-3-1-整数范围"><a href="#1-3-1-整数范围" class="headerlink" title="1.3.1    整数范围"></a>1.3.1    整数范围</h3><blockquote>
<p><strong>说明：</strong>可以通过<code>mix</code>和<code>max</code>属性获得相应类型的最大值和最小值。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> minValue = <span class="type">UInt8</span>.<span class="built_in">min</span><span class="comment">// 0</span></span><br><span class="line"><span class="keyword">let</span> maxValue = <span class="type">UInt8</span>.<span class="built_in">max</span><span class="comment">// 255</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-Int"><a href="#1-3-2-Int" class="headerlink" title="1.3.2    Int"></a>1.3.2    Int</h3><blockquote>
<p><strong>技巧：</strong>大多数时候使用<code>Int</code>类型</p>
<ul>
<li>可以提高代码的一致性和可复用性</li>
<li>即使在32位机器上，也足够大了（<code>-2,147,483,648~2,147,483,647</code>）</li>
</ul>
</blockquote>
<h3 id="1-3-3-UInt"><a href="#1-3-3-UInt" class="headerlink" title="1.3.3    UInt"></a>1.3.3    UInt</h3><blockquote>
<p><strong>技巧：</strong>尽可能使用<code>Int</code>而不是<code>UInt</code>，即使已知值是非负的</p>
<ul>
<li>一致型和可复用性</li>
<li>避免不同类型数字之间的转换(默认的对整数类型的表达式的推断类型为<code>Int</code>)</li>
</ul>
</blockquote>
<h2 id="1-4-浮点数"><a href="#1-4-浮点数" class="headerlink" title="1.4    浮点数"></a>1.4    浮点数</h2><blockquote>
<p><strong>定义：</strong>有小数部分的数字<br><strong>说明：</strong>有两种有符号浮点数类型</p>
</blockquote>
<table>
<thead>
<tr>
<th>浮点类型</th>
<th>解释</th>
<th>最大精度（整数部分和小数部分数字位数之和）</th>
<th>适用</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Double</td>
<td>64位浮点数</td>
<td>7</td>
<td>需要存储很大或很高精度的浮点数时</td>
</tr>
<tr>
<td>Float</td>
<td>32位浮点数</td>
<td>16</td>
<td>精度要求不高时</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f:<span class="type">Float</span> = <span class="number">0.123456789</span><span class="comment">// 0.1234568</span></span><br><span class="line"><span class="keyword">var</span> d:<span class="type">Double</span> = <span class="number">0.12345678901234567</span><span class="comment">// 0.1234567890123457</span></span><br></pre></td></tr></table></figure>
<h2 id="1-5-类型安全和类型推断"><a href="#1-5-类型安全和类型推断" class="headerlink" title="1.5    类型安全和类型推断"></a>1.5    类型安全和类型推断</h2><blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><strong>类型安全：</strong>编译器会在编译阶段进行类型检查，并把不匹配的类型标记为错误</li>
<li><strong>类型推断：</strong>如果在声明阶段没有显示指定类型，编译器回通过赋的值自动推断出表达式的类型</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li>当推断浮点数的类型时，Swift 总是会选择<code>Double</code>而不是<code>Float</code></li>
<li>如果表达式中同时出现整数和浮点数，则计算结果被推断为<code>Double</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// meaningOfLife 会被推测为 Int 类型</span></span><br><span class="line"><span class="keyword">let</span> meaningOfLife = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pi 会被推测为 Double 类型</span></span><br><span class="line"><span class="keyword">let</span> pi = <span class="number">3.14159</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 表达式种出现了一个浮点字面量，所以表达式被推断为 Double 类型</span></span><br><span class="line"><span class="keyword">let</span> anotherPi = <span class="number">3</span> + <span class="number">0.14159</span></span><br></pre></td></tr></table></figure>
<h2 id="1-6-数值型字面量"><a href="#1-6-数值型字面量" class="headerlink" title="1.6    数值型字面量"></a>1.6    数值型字面量</h2><h3 id="整数字面量"><a href="#整数字面量" class="headerlink" title="整数字面量"></a>整数字面量</h3><blockquote>
<p><strong>说明：</strong>根据进制划分有<code>4</code>种</p>
</blockquote>
<table>
<thead>
<tr>
<th>进制</th>
<th>前缀</th>
</tr>
</thead>
<tbody>
<tr>
<td>十进制</td>
<td>无</td>
</tr>
<tr>
<td>二进制</td>
<td><code>0b</code></td>
</tr>
<tr>
<td>八进制</td>
<td><code>0o</code></td>
</tr>
<tr>
<td>十六进制</td>
<td><code>0x</code></td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 17</span></span><br><span class="line"><span class="keyword">let</span> decimalInteger = <span class="number">17</span><span class="comment">// 十进制</span></span><br><span class="line"><span class="keyword">let</span> binaryInter = <span class="number">0b10001</span><span class="comment">// 二进制</span></span><br><span class="line"><span class="keyword">let</span> octalInteger = <span class="number">0o21</span><span class="comment">// 八进制</span></span><br><span class="line"><span class="keyword">let</span> hexadecimalInteger = <span class="number">0x11</span><span class="comment">// 十六进制</span></span><br></pre></td></tr></table></figure>
<h3 id="浮点数字面量"><a href="#浮点数字面量" class="headerlink" title="浮点数字面量"></a>浮点数字面量</h3><blockquote>
<p><strong>说明：</strong>根据进制划分有<code>2</code>种</p>
</blockquote>
<table>
<thead>
<tr>
<th>进制</th>
<th>前缀</th>
<th>小数点两边</th>
<th>可选的指数</th>
</tr>
</thead>
<tbody>
<tr>
<td>十进制</td>
<td>无</td>
<td>至少有一个十进制数</td>
<td><code>(E)e</code>， 基数为10</td>
</tr>
<tr>
<td>十六进制</td>
<td><code>0x</code></td>
<td>至少有一个十六进制数</td>
<td><code>(P)p</code></td>
<td>基数为2</td>
</tr>
</tbody>
</table>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10进制</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1.25e2</span><span class="comment">// 1.25 x 10^2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 16进制</span></span><br><span class="line"><span class="keyword">let</span> b = 0xFp-<span class="number">2</span><span class="comment">// 15 x 2^-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 12.1875</span></span><br><span class="line"><span class="keyword">let</span> decimalDouble = <span class="number">12.1875</span></span><br><span class="line"><span class="keyword">let</span> exponentDouble = <span class="number">1.21876e1</span></span><br><span class="line"><span class="keyword">let</span> hexadecimalDouble = <span class="number">0xC.3p0</span></span><br></pre></td></tr></table></figure>
<h3 id="增强可读性"><a href="#增强可读性" class="headerlink" title="增强可读性"></a>增强可读性</h3><blockquote>
<p><strong>说明：</strong>整数和浮点数都可以添加额外的零并且包含下划线来增强可读性</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 额外的零</span></span><br><span class="line"><span class="keyword">let</span> paddedDouble = <span class="number">000123.456</span></span><br><span class="line"><span class="comment">// 额外的下划线</span></span><br><span class="line"><span class="keyword">let</span> oneMillon = <span class="number">1_000_000</span></span><br><span class="line"><span class="keyword">let</span> justOverOneMillion = <span class="number">1_000_000.000_000_1</span></span><br></pre></td></tr></table></figure>
<h2 id="1-7-数值型类型转换"><a href="#1-7-数值型类型转换" class="headerlink" title="1.7    数值型类型转换"></a>1.7    数值型类型转换</h2><blockquote>
<p><strong>使用<code>Int</code>：</strong>即使代码中的整数常量或变量已知非负，也尽量使用<code>Int</code></p>
<ul>
<li>保证整数变量或常量可以直接被复用</li>
<li>可以匹配整数类字面量的类型推断（整数字面量只会被推断为<code>Int</code>，赋值给其它类型的整数需要类型转换）</li>
</ul>
<p><strong>使用其它整数类型：</strong></p>
<ul>
<li>处理外部的长度明确的数据时，为了优化性能、内存占用等</li>
<li>可以及时发现溢出</li>
<li>可以暗示正在处理特殊数据</li>
</ul>
</blockquote>
<h3 id="1-7-1-整数转换"><a href="#1-7-1-整数转换" class="headerlink" title="1.7.1    整数转换"></a>1.7.1    整数转换</h3><h4 id="1-7-1-1-必要性"><a href="#1-7-1-1-必要性" class="headerlink" title="1.7.1.1    必要性"></a>1.7.1.1    必要性</h4><blockquote>
<ul>
<li>如果数字超过了常量或变量可存储的范围，编译的时候会报错</li>
<li>两种类型（<code>Int</code>除外）的整数不能直接相加</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 会报错，因为 UInt8 不能存储负数</span></span><br><span class="line"><span class="keyword">let</span> cannotBeNegative:<span class="type">UInt8</span> = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 会报错，因为超过了最大值</span></span><br><span class="line"><span class="keyword">let</span> tooBig:<span class="type">Int8</span> = <span class="type">Int8</span>.<span class="built_in">max</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="1-7-1-2-使用类型对应的构造器进行转换"><a href="#1-7-1-2-使用类型对应的构造器进行转换" class="headerlink" title="1.7.1.2    使用类型对应的构造器进行转换"></a>1.7.1.2    使用类型对应的构造器进行转换</h4><blockquote>
<p><strong>注意：</strong>不能传入任意类型的值给构造器，只能是有对应构造器的值<br><strong>扩展：</strong>可以通过扩展现有的类型让它可以接受其它类型的值</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> twoThousand: <span class="type">UInt16</span> = <span class="number">2_000</span></span><br><span class="line"><span class="keyword">let</span> one: <span class="type">UInt8</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 one 由 UInt8 转换为 UInt16，最终 twoThousandAndOne 被推断为 UInt16</span></span><br><span class="line"><span class="keyword">let</span> twoThousandAndOne = twoThousand + <span class="type">UInt16</span>(one)</span><br></pre></td></tr></table></figure>
<h3 id="1-7-2-整数和浮点数转换"><a href="#1-7-2-整数和浮点数转换" class="headerlink" title="1.7.2    整数和浮点数转换"></a>1.7.2    整数和浮点数转换</h3><h4 id="1-7-2-1-整数-gt-浮点数"><a href="#1-7-2-1-整数-gt-浮点数" class="headerlink" title="1.7.2.1    整数-&gt;浮点数"></a>1.7.2.1    整数-&gt;浮点数</h4><blockquote>
<p><strong>说明：</strong></p>
<ul>
<li><strong>强制转换：</strong>对与所有类型的整数常量或变量，可以强制转换为<code>Double</code>或<code>Float</code></li>
<li><strong>隐式转换：</strong>声明时指定<code>Double</code>或<code>Float</code>，则用来初始化的整数字面量会被自动转换</li>
</ul>
<p><strong>注意：</strong>数值类常量或变量不同于数值类字面量，后者可以不同类型可以一起运算，因为字面量本身没有明确的类型</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐式转换</span></span><br><span class="line"><span class="keyword">let</span> d:<span class="type">Double</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 强制转换</span></span><br><span class="line"><span class="keyword">let</span> three = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> pointOneFourOneFineNine = <span class="number">0.14159</span></span><br><span class="line"><span class="keyword">let</span> pi = <span class="type">Double</span>(three) + pointOneFourOneFineNine</span><br></pre></td></tr></table></figure>
<h4 id="1-7-2-2-浮点数-gt-整数"><a href="#1-7-2-2-浮点数-gt-整数" class="headerlink" title="1.7.2.2    浮点数-&gt;整数"></a>1.7.2.2    浮点数-&gt;整数</h4><blockquote>
<p><strong>说明：</strong>声明变量或常量时指定任何一种整数类型，则用来初始化字面量只能是整数。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 强制转换</span></span><br><span class="line"><span class="keyword">let</span> pi = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">let</span> integerPi = <span class="type">Int</span>(pi)</span><br></pre></td></tr></table></figure>
<h2 id="1-8-类型别名"><a href="#1-8-类型别名" class="headerlink" title="1.8    类型别名"></a>1.8    类型别名</h2><blockquote>
<p><strong>语法：</strong><code>typealias 别名 = 原始类型名</code><br><strong>用途：</strong>给现有类型起一个更有意义的名字。<br><strong>说明：</strong>定义了类型别名之后，可以在任何使用原始类型名的地方使用。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类型别名</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">AudioSample</span> = <span class="type">UInt16</span></span><br><span class="line"><span class="comment">// 调用类型别名</span></span><br><span class="line"><span class="keyword">var</span> maxAmolitudeFound = <span class="type">AudioSample</span>.<span class="built_in">min</span></span><br></pre></td></tr></table></figure>
<h2 id="1-9-布尔值"><a href="#1-9-布尔值" class="headerlink" title="1.9    布尔值"></a>1.9    布尔值</h2><blockquote>
<p><strong>类型：</strong><code>Bool</code><br><strong>字面量：</strong></p>
<ul>
<li>true</li>
<li>false</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 橙子是橙子，true</span></span><br><span class="line"><span class="keyword">let</span> orangesAreOrange = <span class="literal">true</span></span><br><span class="line"><span class="comment">// 萝卜很好吃，false</span></span><br><span class="line"><span class="keyword">let</span> turnipsAreDelicious = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> turnipsAreDelicious &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Mmm, tasty turnips"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Eww, turnips are horrible."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-10-元组"><a href="#1-10-元组" class="headerlink" title="1.10    元组"></a>1.10    元组</h2><blockquote>
<p><strong>用途：</strong>元组把多个值组合成一个复合值<br><strong>说明：</strong></p>
<ul>
<li>元组内的值可以是任意类型，并不要求是相同类型。</li>
<li>可以作为函数的返回值</li>
<li>可以为元组中的每个元素命名</li>
<li>可以通过下标访问元组中的每个元素</li>
</ul>
<p><strong>语法：</strong><code>(字面量1, 字面量2, ...)</code></p>
<p><strong>限制：</strong>元组在临时组织值的时候很有用，但不适合创建复杂的数据结构。<br><strong>扩展：</strong>如果数据结构不是临时使用，请使用类或者结构体而不是元组。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明：一个类型为 (Int, String) 的元组</span></span><br><span class="line"><span class="keyword">let</span> http404Error = (<span class="number">404</span>, <span class="string">"Not found"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分解</span></span><br><span class="line"><span class="keyword">let</span> (statusCode, statusMessage) = http404Error</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The status code is \(statusCode)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The status message is \(statusMessage)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分解时用_忽略</span></span><br><span class="line"><span class="keyword">let</span> (justTheStatusCode, <span class="number">_</span>) = http404Error</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过下标访问元组中的元素</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The status code is \(http404Error.1))"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义元组时为单个元素命名</span></span><br><span class="line"><span class="keyword">let</span> http200Status = (statusCode: <span class="number">200</span>, description: <span class="string">"OK"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"The status code is \(http200Status.statusCode)"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="1-11-可选类型"><a href="#1-11-可选类型" class="headerlink" title="1.11    可选类型"></a>1.11    可选类型</h2><blockquote>
<p><strong>用途：</strong>值可能缺失的情况<br><strong>应用：</strong>任何类型</p>
</blockquote>
<h3 id="1-11-1-nil"><a href="#1-11-1-nil" class="headerlink" title="1.11.1    nil"></a>1.11.1    nil</h3><blockquote>
<p><strong>语法：</strong><code>var(let) 标识符: 类型? = 表达式</code><br><strong>相关字面量：</strong><code>nil</code></p>
<ul>
<li><code>nil</code>不能用于非可选的常量或变量</li>
<li>如果声明一个可选常量或者变量但是没有赋值，他们会自动被设置为<code>nil</code></li>
<li>任何类型的可选状态都可以被设置为<code>nil</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serverResponseCode: <span class="type">Int</span>? = <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// nil是一类可选类型字面量，表示没有值</span></span><br><span class="line">serverResponseCode = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<h3 id="1-11-2-if语句以及强制解析"><a href="#1-11-2-if语句以及强制解析" class="headerlink" title="1.11.2        if语句以及强制解析"></a>1.11.2        if语句以及强制解析</h3><blockquote>
<ol>
<li>通过判断可选型是否<code>!= nil</code>,判断可选型是否存在值</li>
<li>如果存在(否则会报错)通过<code>可选型变量或常量!</code>强制解析</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> possibleNumber = <span class="string">"123"</span></span><br><span class="line"><span class="comment">// 强制类型转换返回的是一个可选型</span></span><br><span class="line"><span class="keyword">let</span> convertedNumber = <span class="type">Int</span>(possibleNumber)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 !强制解析</span></span><br><span class="line"><span class="keyword">if</span> convertedNumber != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"convertedNumber has an integer value of \(convertedNumber!)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-11-3-可选绑定"><a href="#1-11-3-可选绑定" class="headerlink" title="1.11.3    可选绑定"></a>1.11.3    可选绑定</h3><blockquote>
<p><strong>用途：</strong>更加便捷地解包可选型值。<br><strong>限制：</strong>只能结合<code>if</code>或<code>while</code>使用<br><strong>说明：</strong>如果包含值就把值赋给一个临时<code>常量</code>或者<code>变量</code>。</p>
</blockquote>
<h4 id="绑定一个"><a href="#绑定一个" class="headerlink" title="绑定一个"></a>绑定一个</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> possibleNumber = <span class="string">"abc"</span>;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> actualNumber = <span class="type">Int</span>(possibleNumber) &#123;</span><br><span class="line">    <span class="comment">// 如果确实包含一个值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\'\(possibleNumber)\' has an integer value of \(actualNumber)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 可选值为nil</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\'\(possibleNumber)\' could not be converted to an integer"</span>)<span class="comment">// 'abc' could not be converted to an intege</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="批量绑定"><a href="#批量绑定" class="headerlink" title="批量绑定"></a>批量绑定</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> firstNumber = <span class="type">Int</span>(<span class="string">"4"</span>), secondNumber = <span class="type">Int</span>(<span class="string">"42"</span>) <span class="keyword">where</span> firstNumber &lt; secondNumber &#123;</span><br><span class="line">    <span class="comment">// 4 &lt; 42</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(firstNumber) &lt; \(secondNumber)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-11-4-隐式解析可选类型"><a href="#1-11-4-隐式解析可选类型" class="headerlink" title="1.11.4    隐式解析可选类型"></a>1.11.4    隐式解析可选类型</h3><blockquote>
<p><strong>说明：</strong>相当于声明可选型(<code>类型?</code>)和强制解包(<code>可选型!</code>)两个过程的结合。</p>
<ul>
<li>被赋值后，值要么是解包后的值，要么是<code>nil</code></li>
<li>在可选绑定中仍然可以作为普通可选类型使用</li>
</ul>
<p><strong>限制：</strong>右边表达式的返回值必须是可选型，否则将报错。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明可选型并强制解析</span></span><br><span class="line"><span class="keyword">let</span> possibleString: <span class="type">String</span>? = <span class="string">"An optional string."</span></span><br><span class="line"><span class="keyword">let</span> forcedString: <span class="type">String</span> = possibleString!</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐式解析(一步到位)</span></span><br><span class="line"><span class="keyword">let</span> assumedString: <span class="type">String</span>! = <span class="string">"An implicitly unwrapped optional string."</span></span><br><span class="line"><span class="keyword">if</span> assumedString != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(assumedString)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在可选绑定中使用隐式解析可选类型</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> definiteString = assumedString &#123;</span><br><span class="line">    <span class="built_in">print</span>(definiteString)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-12-错误处理"><a href="#1-12-错误处理" class="headerlink" title="1.12    错误处理"></a>1.12    错误处理</h2><blockquote>
<p><strong>说明：</strong>分位两步</p>
<ol>
<li>定义函数时，使用<code>throws</code>标记可能抛出错误的函数</li>
<li>用<code>do-try-catch</code>包含函数的调用过程和错误处理方式</li>
</ol>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeASandwich</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 可能报错的函数的调用前必须加关键字 try</span></span><br><span class="line">    <span class="keyword">try</span> makeASandwich()</span><br><span class="line">    <span class="comment">// 如果没有报错则执行</span></span><br><span class="line">    eatASandwich()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">Error</span>.<span class="type">OutOfCleanDishes</span> &#123;</span><br><span class="line">    <span class="comment">// 捕获错误类型1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">Error</span>.<span class="type">MissingIngredients</span>(<span class="keyword">let</span> ingredients) &#123;</span><br><span class="line">    <span class="comment">// 捕获错误类型2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-13-断言"><a href="#1-13-断言" class="headerlink" title="1.13    断言"></a>1.13    断言</h2><blockquote>
<p><strong>用途：</strong>当满足一定条件时结束代码运行通过调试来找到值缺失的原因。<br><strong>适用场景：</strong></p>
<ul>
<li>整数类型的下标索引被传入一个自定义下标脚本实现，但是下标索引值可能太小或者太大</li>
<li>需要给函数传入一个值，但是非法的值可能导致函数不能正常执行</li>
<li>一个可选值现在是<code>nil</code>，但是后面的代码运行需要一个非<code>nil</code>的值</li>
</ul>
</blockquote>
<h3 id="assert函数"><a href="#assert函数" class="headerlink" title="assert函数"></a>assert函数</h3><blockquote>
<p><strong>说明：</strong>在运行时判断一个逻辑条件是否为<code>true</code></p>
<ul>
<li>如果为<code>true</code>，代码继续运行</li>
<li>如果为<code>false</code>，代码执行结束</li>
<li>可以附加一条调试信息</li>
</ul>
<p><strong>注意：</strong>在Xcode 中使用<code>target Release</code>配置为<code>build</code>时，断言会被禁用。<br><strong>原型：</strong><code>全局</code></p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">/**</span><br><span class="line">&gt;* @param &#123;Bool&#125; condition 结果为true或false的表达式</span><br><span class="line">&gt;* @param &#123;String=&#125; message 调试信息</span><br><span class="line">&gt;*/</span></span><br><span class="line">&gt;<span class="type">Void</span> <span class="built_in">assert</span>(condition: <span class="type">Bool</span>,  message: <span class="type">String</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = -<span class="number">3</span></span><br><span class="line"><span class="built_in">assert</span>(age &gt;= <span class="number">0</span>, <span class="string">"Aperson's age cannot be less than zero"</span>);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/TSPL2_0 简介/" itemprop="url">
                  简介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T19:31:15+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/TSPL2_0 简介/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/TSPL2_0 简介/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="0-1-关于Swift-About-Swift"><a href="#0-1-关于Swift-About-Swift" class="headerlink" title="0.1    关于Swift(About Swift)"></a>0.1    关于Swift(About Swift)</h2><blockquote>
<p><strong>用途：</strong>编写<code>IOS</code>、<code>OS X</code>、<code>watchOS</code>应用程序<br><strong>特点归纳：</strong></p>
<ul>
<li>基于<code>Cocoa</code>和<code>Cocoa Touch</code>框架</li>
<li>自动垃圾回收（自动引用计数）</li>
<li>采用了<code>Object-C</code>的命名参数和动态对象模型，兼容<code>Object-C</code>，可以无缝对接到现有的<code>Cocoa</code>框架</li>
<li>支持<code>过程式编程</code>和<code>面向对象编程</code></li>
<li>支持代码预览（像脚本语言一样，可以实时查看结果）</li>
</ul>
</blockquote>
<h2 id="0-2-Swift初见（A-Swift-Tour）"><a href="#0-2-Swift初见（A-Swift-Tour）" class="headerlink" title="0.2    Swift初见（A Swift Tour）"></a>0.2    Swift初见（A Swift Tour）</h2><h3 id="0-2-1-简单值（Simple-Values）"><a href="#0-2-1-简单值（Simple-Values）" class="headerlink" title="0.2.1    简单值（Simple Values）"></a>0.2.1    简单值（Simple Values）</h3><h4 id="0-2-1-1-自动推断类型"><a href="#0-2-1-1-自动推断类型" class="headerlink" title="0.2.1.1    自动推断类型"></a>0.2.1.1    自动推断类型</h4><blockquote>
<p><strong>说明：</strong>声明的同时赋值的话，如果不指定类型，编译器会自动推断其类型。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动推断类型为integer</span></span><br><span class="line"><span class="keyword">let</span> implicitInteger = <span class="number">70</span></span><br><span class="line"><span class="comment">// 自动推断类型为double</span></span><br><span class="line"><span class="keyword">let</span> implicitDouble = <span class="number">70.0</span></span><br></pre></td></tr></table></figure>
<h4 id="0-2-1-2-指定类型"><a href="#0-2-1-2-指定类型" class="headerlink" title="0.2.1.2    指定类型"></a>0.2.1.2    指定类型</h4><blockquote>
<p><strong>说明：</strong>指定类型会导致强制类型转换</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定类型为double</span></span><br><span class="line"><span class="keyword">let</span> explicitDouble:<span class="type">Double</span> = <span class="number">70</span></span><br></pre></td></tr></table></figure>
<h4 id="0-2-1-3-显示转换（在表达式中）"><a href="#0-2-1-3-显示转换（在表达式中）" class="headerlink" title="0.2.1.3    显示转换（在表达式中）"></a>0.2.1.3    显示转换（在表达式中）</h4><blockquote>
<p><strong>说明：</strong>表达式中的值任何时候都不会发生隐式转化。需要转换为其它类型必须进行显示转换。<br><strong>特别：</strong><code>\(变量或表达式)</code>（转换成字符串类型）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="keyword">let</span> label = <span class="string">"The width is"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// integer</span></span><br><span class="line"><span class="keyword">let</span> width = <span class="number">94</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// integer显示转换为string</span></span><br><span class="line"><span class="keyword">let</span> widthLabel = label + <span class="type">String</span>(width)</span><br></pre></td></tr></table></figure>
<p><em><code>\(变量或表达式)</code></em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> apples = <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> oranges = <span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> appleSummary = <span class="string">"I have \(apples) apples."</span></span><br><span class="line"><span class="keyword">let</span> fruitSummary = <span class="string">"I have \(apples + oranges) pices of fruit."</span></span><br></pre></td></tr></table></figure>
<h4 id="0-2-1-4-数组和字典"><a href="#0-2-1-4-数组和字典" class="headerlink" title="0.2.1.4    数组和字典"></a>0.2.1.4    数组和字典</h4><p><em>声明并初始化（自动推断类型）</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">var</span> shoppingList = [<span class="string">"catfish"</span>, <span class="string">"water"</span>, <span class="string">"tulips"</span>, <span class="string">"blue paint"</span>]</span><br><span class="line">shoppingList[<span class="number">1</span>] = <span class="string">"bottle of water"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典</span></span><br><span class="line"><span class="keyword">var</span> occupations = [</span><br><span class="line">    <span class="string">"Malcolm"</span>: <span class="string">"Caption"</span>,</span><br><span class="line">    <span class="string">"Kaylee"</span>: <span class="string">"Mechanic"</span></span><br><span class="line">]</span><br><span class="line">occupations[<span class="string">"Jayne"</span>] = <span class="string">"Public Relations"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空（类型信息可以被推断出来）</span></span><br><span class="line">shoppingList = []</span><br><span class="line">occuations = [:]</span><br></pre></td></tr></table></figure>
<p><em>空数组和空字典</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 空数组(指定每个元素的类型)</span></span><br><span class="line"><span class="keyword">let</span> emptyArry = [<span class="type">String</span>]()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空字典（指定键的类型和值的类型）</span></span><br><span class="line"><span class="keyword">let</span> emptyDictionary = [<span class="type">String</span>:<span class="type">Float</span>]()</span><br></pre></td></tr></table></figure>
<h3 id="0-2-2-控制流（Control-Flow）"><a href="#0-2-2-控制流（Control-Flow）" class="headerlink" title="0.2.2    控制流（Control Flow）"></a>0.2.2    控制流（Control Flow）</h3><h4 id="0-2-2-1-条件判断"><a href="#0-2-2-1-条件判断" class="headerlink" title="0.2.2.1    条件判断"></a>0.2.2.1    条件判断</h4><blockquote>
<p><strong>说明：</strong>有两类</p>
<ul>
<li>if</li>
<li>switch</li>
</ul>
<p><strong>if语法：</strong></p>
<ul>
<li>包裹条件的<code>()</code>可以省略</li>
<li>语句的<code>{}</code>不可以省略</li>
<li><code>条件</code>必须是一个<code>布尔表达式</code>（其它数据类型会报错，因为不会隐式转换）</li>
</ul>
<p><strong>switch语法：</strong></p>
<ul>
<li>支持任意类型（不仅仅是整数）</li>
<li>支持各种比较操作（不仅仅是测试想等）</li>
<li><code>case</code>后可以有多个数据</li>
<li><code>case</code>后可以使用<code>where</code>字句</li>
<li>匹配字句后程序会退出<code>switch</code>，不需要在每个字句结尾写break</li>
<li>…<br><strong>技巧：</strong><code>if</code>和<code>let</code>组合起来使用可以来为可选值解包</li>
</ul>
</blockquote>
<p><em>if(配合let解包可选值)</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> optionalString:<span class="type">String</span>? = <span class="string">"Hello"</span></span><br><span class="line"><span class="built_in">print</span>(optionalString == <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> optionalName:<span class="type">String</span>? = <span class="string">"Join Appleseed"</span></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="string">"Hello"</span></span><br><span class="line"><span class="comment">// 将可选值optionalName解包后的值给name</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = optionalName &#123;</span><br><span class="line">    greeting = <span class="string">"Hello, \(name)"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    greeting = <span class="string">"Hello"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>switch</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vegetable = <span class="string">"red pepper"</span></span><br><span class="line"><span class="keyword">switch</span> vegetable &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"celery"</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Add some raisins and make ants on a log."</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"cucumber"</span>, <span class="string">"watercress"</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"That would make a good tea sandwich."</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x.hasSuffix(<span class="string">"pepper"</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Is it a spicy \(x)?"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Everything tasts good in soup."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0-2-2-2-循环"><a href="#0-2-2-2-循环" class="headerlink" title="0.2.2.2    循环"></a>0.2.2.2    循环</h4><blockquote>
<p><strong>说明：</strong>有4类</p>
<ul>
<li>for-in</li>
<li>for</li>
<li>while</li>
<li>repeat-while</li>
</ul>
</blockquote>
<p><em>for-in</em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 寻找字典中的所有数组中的最大值</span></span><br><span class="line">let interestingNumbers = [</span><br><span class="line">    <span class="string">"Prime"</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>],</span><br><span class="line">    <span class="string">"Fibonacci"</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    <span class="string">"Square"</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line">]</span><br><span class="line">var largest = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (kind, numbers) in interestingNumbers &#123;</span><br><span class="line">    <span class="keyword">for</span> number in numbers &#123;</span><br><span class="line">        <span class="keyword">if</span> number &gt; largest &#123;</span><br><span class="line">            largest = number</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(largest)<span class="comment">// 25</span></span><br></pre></td></tr></table></figure>
<p><em>repeat-while</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> n &lt; <span class="number">100</span> &#123;</span><br><span class="line">    n = n * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">2</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    m = m * <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> m &lt; <span class="number">100</span></span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<p><em>for</em></p>
<blockquote>
<p><strong>区间：</strong></p>
<ul>
<li>包含边界：<code>...</code></li>
<li>不包含上边界：<code>..&lt;</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 区间的方式</span></span><br><span class="line"><span class="keyword">var</span> firstForLoop = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">4</span> &#123;</span><br><span class="line">    firstForLoop += i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(firstForLoop)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传统的方式</span></span><br><span class="line"><span class="keyword">var</span> secondForLoop = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i &#123;</span><br><span class="line">    secondForLoop += i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(secondForLoop)</span><br></pre></td></tr></table></figure>
<h3 id="0-2-3-函数和闭包（Functions-and-Closures）"><a href="#0-2-3-函数和闭包（Functions-and-Closures）" class="headerlink" title="0.2.3    函数和闭包（Functions and Closures）"></a>0.2.3    函数和闭包（Functions and Closures）</h3><h4 id="0-2-3-1-简单函数"><a href="#0-2-3-1-简单函数" class="headerlink" title="0.2.3.1    简单函数"></a>0.2.3.1    简单函数</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(name: String, day: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello \(name), today is \(day)."</span></span><br><span class="line">&#125;</span><br><span class="line">greet(<span class="string">"Bob"</span>, day: <span class="string">"Tuesday"</span>)<span class="comment">// 第一个参数不用说明label</span></span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-2-返回元组"><a href="#0-2-3-2-返回元组" class="headerlink" title="0.2.3.2    返回元组"></a>0.2.3.2    返回元组</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 找到元组的最大值、最小值和总和</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateStatistics</span><span class="params">(scores: [Int])</span></span> -&gt; (<span class="built_in">min</span>: <span class="type">Int</span>, <span class="built_in">max</span>: <span class="type">Int</span>, sum: <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">min</span> = scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">max</span> = scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> score <span class="keyword">in</span> scores &#123;</span><br><span class="line">        <span class="keyword">if</span> score &gt; <span class="built_in">max</span> &#123;</span><br><span class="line">            <span class="built_in">max</span> = score</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> score &lt; <span class="built_in">min</span> &#123;</span><br><span class="line">            <span class="built_in">min</span> = score</span><br><span class="line">        &#125;</span><br><span class="line">        sum += score</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">min</span>, <span class="built_in">max</span>, sum)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">let</span> statistics = calculateStatistics([<span class="number">5</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">3</span>, <span class="number">9</span>])</span><br><span class="line"><span class="built_in">print</span>(statistics.sum)</span><br><span class="line"><span class="built_in">print</span>(statistics.<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-3-可变参数"><a href="#0-2-3-3-可变参数" class="headerlink" title="0.2.3.3    可变参数"></a>0.2.3.3    可变参数</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可变参数函数</span></span><br><span class="line"><span class="comment">// 计算总和</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sumOf</span><span class="params">(numbers: Int...)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        sum += number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line">sumOf()</span><br><span class="line">sumOf(<span class="number">42</span>, <span class="number">597</span>, <span class="number">12</span>)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-4-函数嵌套"><a href="#0-2-3-4-函数嵌套" class="headerlink" title="0.2.3.4    函数嵌套"></a>0.2.3.4    函数嵌套</h4><blockquote>
<p><strong>说明：</strong>如果嵌套的函数被返回，调用返回的函数就会出现闭包的效果。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数嵌套</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnFifteen</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">10</span></span><br><span class="line">    <span class="comment">// 函数内部的函数</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y += <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用函数内部的函数</span></span><br><span class="line">    add()</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line">returnFifteen()</span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-5-返回函数"><a href="#0-2-3-5-返回函数" class="headerlink" title="0.2.3.5    返回函数"></a>0.2.3.5    返回函数</h4><blockquote>
<p><strong>说明：</strong>返回的函数是闭包的一种</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeIncrementer</span><span class="params">()</span></span> -&gt; (<span class="type">Int</span> -&gt; <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addOne</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> addOne</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> increment = makeIncrementer()</span><br><span class="line">increment(<span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-6-函数作为参数"><a href="#0-2-3-6-函数作为参数" class="headerlink" title="0.2.3.6    函数作为参数"></a>0.2.3.6    函数作为参数</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用函数作为参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasAnyMatches</span><span class="params">(list: [Int], condition: Int -&gt; Bool)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> condition(item) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 被作为参数的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lessThanThen</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> number &lt; <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">20</span>, <span class="number">19</span>, <span class="number">7</span>, <span class="number">12</span>]</span><br><span class="line">hasAnyMatches(numbers, condition: lessThanThen)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-3-7-匿名函数（匿名闭包）"><a href="#0-2-3-7-匿名函数（匿名闭包）" class="headerlink" title="0.2.3.7    匿名函数（匿名闭包）"></a>0.2.3.7    匿名函数（匿名闭包）</h4><blockquote>
<p><strong>说明：</strong>匿名函数写法非常自由</p>
<ul>
<li>如果一个闭包的类型已知，比如作为一个回调函数，可以忽略参数的类型和返回值</li>
<li>单个语句闭包会把它语句的值当作结果返回</li>
<li>可以通过参数位置而不是参数名引用参数</li>
<li>当一个闭包作为最后一个参数传给一个函数的时候，它可以直接跟在括号后面</li>
<li>当一个闭包是传给函数的唯一参数，可以完全忽略<code>()</code></li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匿名闭包1（包含参数类型和返回值类型）</span></span><br><span class="line">numbers.<span class="built_in">map</span>(&#123;</span><br><span class="line">    (number:<span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">3</span> * number</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 匿名闭包2（可以推导出闭包的参数类型和返回值类型的话，两者都可以省略）</span></span><br><span class="line"><span class="keyword">let</span> mappedNumbers = numbers.<span class="built_in">map</span>(&#123;number <span class="keyword">in</span> <span class="number">3</span> * number&#125;)</span><br><span class="line"><span class="built_in">print</span>(mappedNumbers)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名闭包3（函数体中通过参数位置而不是参数名访问参数）</span></span><br><span class="line"><span class="keyword">let</span> sortedNumbers = numbers.<span class="built_in">sort</span> &#123; $<span class="number">0</span> &gt; $<span class="number">1</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(sortedNumbers)</span><br></pre></td></tr></table></figure>
<h3 id="0-2-4-对象和类（Object-and-Classes）"><a href="#0-2-4-对象和类（Object-and-Classes）" class="headerlink" title="0.2.4    对象和类（Object and Classes）"></a>0.2.4    对象和类（Object and Classes）</h3><blockquote>
<p><strong>语法：</strong></p>
<ul>
<li><code>class 类型名 {...}</code></li>
<li>使用<code>.</code>访问实例的属性和方法</li>
<li>在成员方法中使用<code>self</code>引用当前实例对象</li>
<li>使用构造函数<code>init</code>初始化类实例</li>
<li>使用析构函数<code>deinit</code>在删除对象之前做一些清理工作</li>
<li>没有标准的根类（不同于<code>java</code>）</li>
<li>子类的定义：<code>class 子类名:父类名</code></li>
<li>重写父类的方法许必须用<code>override</code>标记</li>
</ul>
</blockquote>
<p><em>简单类</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 形状</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实例属性</span></span><br><span class="line">    <span class="keyword">var</span> numberOfSides = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 实例方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A shape with \(numberOfSides) sides."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> shape = <span class="type">Shape</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作实例的成员</span></span><br><span class="line">shape.numberOfSides = <span class="number">7</span></span><br><span class="line"><span class="keyword">var</span> shapeDescription = shape.simpleDescription()</span><br></pre></td></tr></table></figure>
<p><em>构造函数和子类</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 带名字的形状（基类）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfSides: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 成员方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A shape with \(numberOfSides) sides."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正方形（子类）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength = sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">area</span><span class="params">()</span></span> -&gt;  <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sideLength * sideLength</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A square with sides of length \(sideLength)."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> test = <span class="type">Square</span>(sideLength: <span class="number">5.2</span>, name: <span class="string">"my test square"</span>)</span><br><span class="line">test.area()</span><br><span class="line">test.simpleDescription()</span><br></pre></td></tr></table></figure>
<h4 id="0-2-4-1-计算属性"><a href="#0-2-4-1-计算属性" class="headerlink" title="0.2.4.1    计算属性"></a>0.2.4.1    计算属性</h4><blockquote>
<p><strong>说明：</strong>计算属性有getter和setter</p>
<ul>
<li>get：读取属性时返回计算出的属性值</li>
<li>set：写入值时被调用，其中内置变量<code>newValue</code>存储新值</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等腰三角形（子类）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EquilateralTriangle</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span> = <span class="number">0.0</span></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength = sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides = <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算属性：提供get和set</span></span><br><span class="line">    <span class="keyword">var</span> perimeter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3.0</span> * sideLength</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            sideLength = newValue / <span class="number">3.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"An equilateral triagle with sides of length \(sideLength)."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> triangle = <span class="type">EquilateralTriangle</span>(sideLength: <span class="number">3.1</span>, name: <span class="string">"a triangle"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问计算属性（get被调用）</span></span><br><span class="line"><span class="built_in">print</span>(triangle.perimeter)</span><br><span class="line"><span class="comment">// 设置计算属性（set计算属性）</span></span><br><span class="line">triangle.perimeter = <span class="number">9.9</span></span><br><span class="line"><span class="comment">// 访问存储属性</span></span><br><span class="line"><span class="built_in">print</span>(triangle.sideLength)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-4-2-属性监控"><a href="#0-2-4-2-属性监控" class="headerlink" title="0.2.4.2    属性监控"></a>0.2.4.2    属性监控</h4><blockquote>
<p><strong>说明：</strong>不需要计算属性，但是仍然需要在设置一个新值之前或者之后运行代码。可以使用<code>willset</code>和<code>didSet</code>。</p>
<ul>
<li>willset：在设置之前调用</li>
<li>didSet：在设置后后调用</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包含一个三角形实例和一个正方形实例作为成员，并确保边长相等</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TriangleAndSquare</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> triangle: <span class="type">EquilateralTriangle</span> &#123;</span><br><span class="line">        <span class="comment">// 设置新值前调用</span></span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            square.sideLength = newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> square: <span class="type">Square</span> &#123;</span><br><span class="line">        <span class="comment">// 设置新值之前调用</span></span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            triangle.sideLength = newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span> (size: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        square = <span class="type">Square</span>(sideLength: size, name: name)</span><br><span class="line">        triangle = <span class="type">EquilateralTriangle</span>(sideLength: size, name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> triangleAndSquare = <span class="type">TriangleAndSquare</span>(size: <span class="number">10</span>, name: <span class="string">"another test shape"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置前</span></span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.square.sideLength)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置其中一个成员（会触发willset）</span></span><br><span class="line">triangleAndSquare.square = <span class="type">Square</span>(sideLength: <span class="number">50</span>, name: <span class="string">"larger square"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置之后</span></span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br></pre></td></tr></table></figure>
<h4 id="0-2-4-3-实例是可选值"><a href="#0-2-4-3-实例是可选值" class="headerlink" title="0.2.4.3    实例是可选值"></a>0.2.4.3    实例是可选值</h4><blockquote>
<p><strong>说明：</strong>当实例是nil是，需要避免访问实例的成员导致报错。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明可选型</span></span><br><span class="line"><span class="keyword">let</span> optionalSquare: <span class="type">Square</span>? = <span class="type">Square</span>(sideLength: <span class="number">2.5</span>, name: <span class="string">"optional square"</span>)</span><br><span class="line"><span class="comment">// 在操作（方法调用／属性访问／子脚本访问）前加?</span></span><br><span class="line"><span class="keyword">let</span> sideLength = optionalSquare?.sideLength</span><br></pre></td></tr></table></figure>
<h3 id="0-2-5-枚举和结构体（Enumerations-and-Structures）"><a href="#0-2-5-枚举和结构体（Enumerations-and-Structures）" class="headerlink" title="0.2.5    枚举和结构体（Enumerations and Structures）"></a>0.2.5    枚举和结构体（Enumerations and Structures）</h3><h4 id="0-2-5-1-枚举"><a href="#0-2-5-1-枚举" class="headerlink" title="0.2.5.1    枚举"></a>0.2.5.1    枚举</h4><blockquote>
<p><strong>关键字：</strong><code>enum</code><br><strong>说明：</strong>swift中的所有命名类型都可以包含方法（包括枚举）。</p>
<ul>
<li>可以不设置枚举值的原始值类型</li>
<li>同一枚举类型的实例的成员（枚举值）的原始值（可以在创建实例的时候传入值）可以不同</li>
<li>如果原始值类型为<code>Int</code>，可以只设置第一个原始值，剩下的原始值会按照顺序自动完成赋值</li>
<li>也可以使用字符串或者浮点数作为枚举的原始值</li>
<li>使用<code>rawValue</code>属性来访问一个枚举成员的原始值</li>
<li>存在一个默认的初始化构造器<code>init?(rawValue:)</code>，这意味着可以通过原始值创建可选型美剧值（使用前需要解包）</li>
<li>声明枚举类型常量或在<code>switch</code>中时，当指定了枚举类型时，可以使用<code>.枚举值</code>的方式</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扑克牌级别</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Rank</span>: <span class="title">Int</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Ace</span> = <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Two</span>, <span class="type">Three</span>, <span class="type">Four</span>, <span class="type">Five</span>, <span class="type">Six</span>, <span class="type">Seven</span>, <span class="type">Eight</span>, <span class="type">Nine</span>, <span class="type">Ten</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Jack</span>, <span class="type">Queen</span>, <span class="type">King</span></span><br><span class="line">    <span class="comment">// 枚举类型可以声明方法</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Ace</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"ace"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Jack</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jack"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Queen</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"queen"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">King</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"king"</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(<span class="keyword">self</span>.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 枚举类型变量</span></span><br><span class="line"><span class="keyword">let</span> ace = <span class="type">Rank</span>.<span class="type">Ace</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用枚举类型值的方法</span></span><br><span class="line">ace.simpleDescription()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举类型变量的原始值</span></span><br><span class="line"><span class="keyword">let</span> aceRawValue = ace.rawValue<span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解包通过init?(rawValue:)初始化构造器创建的枚举类型值</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> convertedRank = <span class="type">Rank</span>(rawValue: <span class="number">3</span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> threeDescription = convertedRank.simpleDescription()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>不设置原始值类型</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扑克牌花色</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Suit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Spades</span>, <span class="type">Hearts</span>, <span class="type">Diamonds</span>, <span class="type">Clubs</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Spades</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"spades"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Hearts</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"hearts"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Diamonds</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"diamonds"</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Clubs</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"clubs"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 枚举值</span></span><br><span class="line"><span class="keyword">let</span> hearts = <span class="type">Suit</span>.<span class="type">Hearts</span></span><br><span class="line"><span class="comment">// 调用枚举值的方法查看枚举值对应的说明</span></span><br><span class="line"><span class="keyword">let</span> heartsDescription = hearts.simpleDescription()</span><br></pre></td></tr></table></figure>
<p><em>枚举的每个case还可以包含一些值</em></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务器响应</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ServerResponse</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 正确响应</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Result</span>(<span class="type">String</span>, <span class="type">String</span>)</span><br><span class="line">    <span class="comment">// 请求失败</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Error</span>(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 为实例传值</span></span><br><span class="line"><span class="keyword">let</span> success = <span class="type">ServerResponse</span>.<span class="type">Result</span>(<span class="string">"6:00 am"</span>, <span class="string">"8:09 pm"</span>)</span><br><span class="line"><span class="keyword">let</span> failure = <span class="type">ServerResponse</span>.<span class="type">Error</span>(<span class="string">"Out of cheese"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> success &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Result</span>(sunrise, sunset):</span><br><span class="line">    <span class="comment">// 获取枚举实例的值</span></span><br><span class="line">    <span class="keyword">let</span> serverResponse = <span class="string">"sunset is at \(sunrise) and sunset is at \(sunset)."</span></span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Error</span>(error):</span><br><span class="line">    <span class="keyword">let</span> serverResponse = <span class="string">"Failure... \(error)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0-2-5-2-结构体"><a href="#0-2-5-2-结构体" class="headerlink" title="0.2.5.2    结构体"></a>0.2.5.2    结构体</h4><blockquote>
<p><strong>说明：</strong>结构体和类有很多相同的地方，比如方法和构造器。它们之间最大的区别就是结构体是传值，类是传引用。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扑克牌</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Card</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 级别</span></span><br><span class="line">    <span class="keyword">var</span> rank: <span class="type">Rank</span></span><br><span class="line">    <span class="comment">// 花色</span></span><br><span class="line">    <span class="keyword">var</span> suit: <span class="type">Suit</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The \(rank.simpleDescription()) of \(suit.simpleDescription())"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 黑桃3</span></span><br><span class="line"><span class="keyword">let</span> threeOfSpades = <span class="type">Card</span>(rank: .<span class="type">Three</span>, suit: .<span class="type">Spades</span>)</span><br><span class="line"><span class="keyword">let</span> threeOfSpandesDescription = threeOfSpades.simpleDescription()</span><br></pre></td></tr></table></figure>
<h3 id="0-2-6-协议和扩展（Protocols-and-Extensions）"><a href="#0-2-6-协议和扩展（Protocols-and-Extensions）" class="headerlink" title="0.2.6    协议和扩展（Protocols and Extensions）"></a>0.2.6    协议和扩展（Protocols and Extensions）</h3><h4 id="0-2-6-1-协议"><a href="#0-2-6-1-协议" class="headerlink" title="0.2.6.1    协议"></a>0.2.6.1    协议</h4><blockquote>
<p><strong>关键字：</strong><code>protocol</code><br><strong>说明：</strong>类似于接句，类、枚举、结构体都可以实现协议。<br><strong>注意：</strong></p>
<ul>
<li>使用结构体实现协议时，如果实现的方法会修改结构体，需要用<code>mutating</code>标记。</li>
<li>可以直接使用协议声明变量或常量，但无法调用运行时类型实现的协议值完的方法或属性</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个协议</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123;<span class="keyword">get</span>&#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过类实现这个协议</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> = <span class="string">"A very simple class."</span></span><br><span class="line">    <span class="keyword">var</span> anotherProperty: <span class="type">Int</span> = <span class="number">69105</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        simpleDescription += <span class="string">" Now 100% adjust."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="type">SimpleClass</span>()</span><br><span class="line">a.adjust()</span><br><span class="line"><span class="keyword">let</span> aDescription = a.simpleDescription</span><br><span class="line"><span class="comment">// 像使用其他命名类型一样使用协议名，用其声明一个变量，并将实现了该协议的类的实例赋值给它</span></span><br><span class="line"><span class="keyword">let</span> protocolValue: <span class="type">ExampleProtocol</span> = a</span><br><span class="line"><span class="comment">// 使用协议本身声明的变量或常量不能访问协议外定义成员</span></span><br><span class="line"><span class="comment">// print(protocolValue.anotherProperty)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过结构体实现这个协议</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SimpleStructure</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> = <span class="string">"A simple structure"</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        simpleDescription += <span class="string">"(adjusted)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="type">SimpleStructure</span>()</span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line">b.adjust()</span><br><span class="line"><span class="keyword">let</span> bDesctiption = b.simpleDescription</span><br></pre></td></tr></table></figure>
<h4 id="0-2-6-2-扩展"><a href="#0-2-6-2-扩展" class="headerlink" title="0.2.6.2    扩展"></a>0.2.6.2    扩展</h4><blockquote>
<p><strong>关键字：</strong><code>extension</code><br><strong>描述：</strong>为现有的类型添加功能，比如新的方法和计算属性。<br><strong>说明：</strong>你可以使用扩展在别处修改定义，甚至是从外部库活着框架引入的一个类型，使得这个类型遵循某个协议。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"The number \(self)"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span> += <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="number">7</span>.simpleDescription)</span><br></pre></td></tr></table></figure>
<h3 id="0-2-7-范型（Generics）"><a href="#0-2-7-范型（Generics）" class="headerlink" title="0.2.7    范型（Generics）"></a>0.2.7    范型（Generics）</h3><blockquote>
<p><strong>描述：</strong>在<code>&lt;&gt;</code>中写一个名字来创建一个范型函数或者类型。<br><strong>说明：</strong>可以应用于</p>
<ul>
<li>函数</li>
<li>方法</li>
<li>类</li>
<li>枚举</li>
<li>结构体</li>
</ul>
<p><strong>特点：</strong></p>
<ul>
<li>可以使用<code>where</code>来指定对类型的要求</li>
<li><code>&lt;T: Equatable&gt;</code>和<code>&lt;T where T: Equatable&gt;</code>等价</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anyCommonElements</span> &lt;T: SequenceType, U: SequenceType where T.Generator.Element: Equatable, T.Generator.Element == U.Generator.Element&gt; <span class="params">(lhs: T, <span class="number">_</span> rhs: U)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> lhsItem <span class="keyword">in</span> lhs &#123;</span><br><span class="line">        <span class="keyword">for</span> rhsItem <span class="keyword">in</span> rhs &#123;</span><br><span class="line">            <span class="keyword">if</span> lhsItem == rhsItem &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">anyCommonElements([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<h2 id="0-3-Swift版本历史记录"><a href="#0-3-Swift版本历史记录" class="headerlink" title="0.3    Swift版本历史记录"></a>0.3    Swift版本历史记录</h2><h2 id="0-4-The-Swift-Programing-language中文版"><a href="#0-4-The-Swift-Programing-language中文版" class="headerlink" title="0.4    The Swift Programing language中文版"></a>0.4    The Swift Programing language中文版</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_20 NSPredicate/" itemprop="url">
                  20 NSpredicate
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:43:10+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_20 NSPredicate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_20 NSPredicate/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Cocoa</code>提供了一个名为<code>NSPredicate</code>的类，用于指定过滤器的条件。<br><strong>原理：</strong>可以创建<code>NSPredicate</code>对象，通过它准确描述所需的条件，通过<code>谓词</code>(计算真值和假值的函数)筛选每个对象，判断它们是否与条件相匹配。</p>
</blockquote>
<h2 id="20-1-创建谓词"><a href="#20-1-创建谓词" class="headerlink" title="20.1    创建谓词"></a>20.1    创建谓词</h2><blockquote>
<p><strong>说明：</strong>使用<code>谓词</code>有两种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>方式</th>
<th>适用</th>
</tr>
</thead>
<tbody>
<tr>
<td>创建许多<code>NSPredicate</code>对象，组合使用</td>
<td>构建通用用户界面来指定查询的场景</td>
</tr>
<tr>
<td>谓词字符串</td>
<td>适用于初学者使用，比较简单</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>建议：</strong>通常将以使用<code>面向字符串</code>的<code>API</code>，尤其是在缺少编译器的错误检查和奇怪的运行时错误的时候。</p>
</blockquote>
<h3 id="predicateWithFormat工厂方法"><a href="#predicateWithFormat工厂方法" class="headerlink" title="predicateWithFormat工厂方法"></a>predicateWithFormat工厂方法</h3><blockquote>
<p><strong>说明：</strong>基于<code>谓词字符串</code>在后台构建<code>对象数</code>，创建<code>谓词</code>。<br><strong>谓词字符串：</strong>用途类似<code>sql</code>，语法类似标准c语言表达式<br><strong>原型：</strong><code>NSPredicate</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; predicateFormat 谓词字符串（地位类似格式串）</span><br><span class="line">* @param &#123;...&#125; 对应为此字符串中的占位符</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="built_in">NSPredicate</span> *)predicateWithFormat:(<span class="built_in">NSString</span> *)predicateFormat, ...;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 汽车集合</span></span><br><span class="line">Garage *garage = [[Garage alloc] init];</span><br><span class="line">garage.name = <span class="string">@"Joe's Garage"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存入汽车实例</span></span><br><span class="line">Car *car;</span><br><span class="line">car = makeCar(<span class="string">@"Herbie"</span>, <span class="string">@"Honda"</span>, <span class="string">@"CRX"</span>, <span class="number">1984</span>, <span class="number">2</span>, <span class="number">34000</span>, <span class="number">58</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建谓词：过滤 name 属性值为 Herbie 的车</span></span><br><span class="line"><span class="built_in">NSPredicate</span> *predicate;</span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == 'Herbie'"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="20-2-计算谓词"><a href="#20-2-计算谓词" class="headerlink" title="20.2    计算谓词"></a>20.2    计算谓词</h2><h3 id="evaluateWithObject实例方法"><a href="#evaluateWithObject实例方法" class="headerlink" title="evaluateWithObject实例方法"></a>evaluateWithObject实例方法</h3><blockquote>
<p><strong>说明：</strong>通知接收对象（即<code>谓词</code>）根据<code>指定的对象</code>计算自身的值。<br><strong>用途：</strong>计算<code>某个对象</code>是否符合某个<code>谓词</code>中的判断逻辑。<br><strong>原型：</strong>``</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; object 谓词的主语</span><br><span class="line">* @return &#123;BOOL&#125; YES 判断为真， NO 判断为假</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)evaluateWithObject:(nullable <span class="keyword">id</span>)object;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 谓词1：过滤 name 属性值为 Herbie 的车</span></span><br><span class="line"><span class="built_in">NSPredicate</span> *predicate;</span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == 'Herbie'"</span>];</span><br><span class="line"><span class="comment">// 搭配主语进行判断</span></span><br><span class="line"><span class="built_in">BOOL</span> match = [predicate evaluateWithObject:car];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, (match) ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 谓词2：引擎马力大于150</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"engine.horsepower &gt; 150"</span>];</span><br><span class="line">match = [predicate evaluateWithObject:car];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, (match) ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 谓词3：和谓词1等价</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == %@"</span>, <span class="string">@"Herbie"</span>];</span><br><span class="line">match = [predicate evaluateWithObject:car];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, (match) ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="20-3-数组过滤器"><a href="#20-3-数组过滤器" class="headerlink" title="20.3    数组过滤器"></a>20.3    数组过滤器</h2><blockquote>
<p><strong>说明：</strong>某些<code>类别</code>将<code>谓词过滤方法</code>添加到了<code>Cocoa</code>集合类（比如<code>NSArray</code>）中。</p>
</blockquote>
<h3 id="filteredArrayUsingPredicate实例方法"><a href="#filteredArrayUsingPredicate实例方法" class="headerlink" title="filteredArrayUsingPredicate实例方法"></a>filteredArrayUsingPredicate实例方法</h3><blockquote>
<p><strong>说明：</strong>循环过滤数组内容，根据<code>谓词</code>计算每个对象的值，并将值为<code>YES</code>的对象累计到将被放回的新数组中。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 数组过滤 */</span></span><br><span class="line"><span class="comment">// 创建汽车集合</span></span><br><span class="line">Garage *garage = [[Garage alloc] init];</span><br><span class="line">garage.name = <span class="string">@"Joe's Garage"</span>;</span><br><span class="line"><span class="comment">// 添加汽车实例</span></span><br><span class="line">car = makeCar (<span class="string">@"Badger"</span>, <span class="string">@"Acura"</span>, <span class="string">@"Integra"</span>, <span class="number">1987</span>, <span class="number">5</span>, <span class="number">217036.7</span>, <span class="number">130</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"></span><br><span class="line">car = makeCar (<span class="string">@"Elvis"</span>, <span class="string">@"Acura"</span>, <span class="string">@"Legend"</span>, <span class="number">1989</span>, <span class="number">4</span>, <span class="number">28123.4</span>, <span class="number">151</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"></span><br><span class="line">car = makeCar (<span class="string">@"Phoenix"</span>, <span class="string">@"Pontiac"</span>, <span class="string">@"Firebird"</span>, <span class="number">1969</span>, <span class="number">2</span>, <span class="number">85128.3</span>, <span class="number">345</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"></span><br><span class="line">car = makeCar (<span class="string">@"Streaker"</span>, <span class="string">@"Pontiac"</span>, <span class="string">@"Silver Streak"</span>, <span class="number">1950</span>, <span class="number">2</span>, <span class="number">39100.0</span>, <span class="number">36</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"></span><br><span class="line">car = makeCar (<span class="string">@"Judge"</span>, <span class="string">@"Pontiac"</span>, <span class="string">@"GTO"</span>, <span class="number">1969</span>, <span class="number">2</span>, <span class="number">45132.2</span>, <span class="number">370</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"></span><br><span class="line">car = makeCar (<span class="string">@"Paper Car"</span>, <span class="string">@"Plymouth"</span>, <span class="string">@"Valiant"</span>, <span class="number">1965</span>, <span class="number">2</span>, <span class="number">76800</span>, <span class="number">105</span>);</span><br><span class="line">[garage addCar: car];</span><br><span class="line"><span class="comment">// 创建谓词</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"engine.horsepower &gt; 150"</span>];</span><br><span class="line"><span class="comment">// 获取汽车实例组成的数组</span></span><br><span class="line"><span class="built_in">NSArray</span> *cars = [garage cars];</span><br><span class="line"><span class="comment">// 遍历数组</span></span><br><span class="line"><span class="keyword">for</span> (Car *car <span class="keyword">in</span> cars) &#123;</span><br><span class="line">    <span class="keyword">if</span> ([predicate evaluateWithObject:car]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, car.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建谓词</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"engine.horsepower &gt; %d"</span>, <span class="number">50</span>];</span><br><span class="line"><span class="comment">// 过滤数组：引擎马力大于50的</span></span><br><span class="line"><span class="built_in">NSArray</span> *results = [cars filteredArrayUsingPredicate:predicate];</span><br></pre></td></tr></table></figure>
<h3 id="filterUsingPredicate实例方法"><a href="#filterUsingPredicate实例方法" class="headerlink" title="filterUsingPredicate实例方法"></a>filterUsingPredicate实例方法</h3><blockquote>
<p><strong>说明：</strong>通过<code>谓词</code>剔除可变数组中计算结果不为真的对象。<br><strong>原型：</strong><code>NSMutableArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSPredicate *&#125; predicate 谓词</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)filterUsingPredicate:(<span class="built_in">NSPredicate</span> *)predicate;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------可变数组过滤</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *carsCopy = [cars mutableCopy];</span><br><span class="line"><span class="comment">// 过滤（有副作用的过滤）</span></span><br><span class="line">[carsCopy filterUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, results);</span><br></pre></td></tr></table></figure>
<h2 id="20-4-格式说明符"><a href="#20-4-格式说明符" class="headerlink" title="20.4    格式说明符"></a>20.4    格式说明符</h2><blockquote>
<p><strong>说明：</strong>硬编码并非好事，可以通过两种方式将不同的内同放入<code>谓词格式字符串</code>中</p>
<ul>
<li>格式说明符：<code>%格式说明符</code></li>
<li>变量名：<code>$变量名</code></li>
</ul>
</blockquote>
<h3 id="20-4-1-格式说明符"><a href="#20-4-1-格式说明符" class="headerlink" title="20.4.1    格式说明符"></a>20.4.1    格式说明符</h3><blockquote>
<p><strong>说明：</strong>分3种</p>
</blockquote>
<table>
<thead>
<tr>
<th>分类</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>printf说明符</td>
<td><code>c</code>语言使用的格式说明符</td>
<td><code>%d</code>、<code>%f</code>等</td>
</tr>
<tr>
<td><code>%@</code></td>
<td>插入<code>O-C</code>字符串值</td>
<td></td>
</tr>
<tr>
<td><code>%K</code></td>
<td>插入键路径</td>
</tr>
</tbody>
</table>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用printf式格式字符串</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"engine.horsepower &gt; %d"</span>, <span class="number">50</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="comment">// 使用%@插入字符串值</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == %@"</span>, <span class="string">@"Herbie"</span>];</span><br><span class="line"><span class="comment">// 使用%K指定键路径</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"%K == %@"</span>, <span class="string">@"name"</span>, <span class="string">@"Herbie"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="20-4-2-插入变量名"><a href="#20-4-2-插入变量名" class="headerlink" title="20.4.2    插入变量名"></a>20.4.2    插入变量名</h3><blockquote>
<p><strong>说明：</strong>需要配合<code>字典</code>和<code>predicateWithSubstitutionVariables</code>实例方法一起使用。</p>
</blockquote>
<h4 id="predicateWithSubstitutionVariables"><a href="#predicateWithSubstitutionVariables" class="headerlink" title="predicateWithSubstitutionVariables"></a>predicateWithSubstitutionVariables</h4><blockquote>
<p><strong>说明：</strong>通过已有的<code>谓词</code>（<code>谓词字符串</code>中包含插入的变量名）创建更加具体的<code>专用谓词</code>。<br><strong>原型：</strong><code>NSPredicate</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSDictionary&lt;NSString *, id&gt; *&#125; variables 用于具体化谓词的字典</span><br><span class="line">* @return &#123;NSPredicate&#125; 专用谓词</span><br><span class="line">*/</span></span><br><span class="line">- (instancetype)predicateWithSubstitutionVariables:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)variables;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将字典的键名插入到谓词字符串中</span></span><br><span class="line"><span class="built_in">NSPredicate</span> *predicateTemplate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name == $NAME"</span>];<span class="comment">// 创建谓词模版</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *varDict;</span><br><span class="line"><span class="comment">// 变量名为NSString类型</span></span><br><span class="line">varDict = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:<span class="string">@"Heribie"</span>, <span class="string">@"NAME"</span>, <span class="literal">nil</span>];<span class="comment">// 用来为上述谓词模版的$NAME赋值的字典</span></span><br><span class="line">predicate = [predicateTemplate predicateWithSubstitutionVariables:varDict];<span class="comment">// 通过谓词模版创建谓词</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"SNORGLE：%@"</span>, predicate);</span><br><span class="line">match = [predicate evaluateWithObject:car];<span class="comment">// 主语结合谓词进行计算</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, (match) ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">predicateTemplate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"engine.horsepower &gt; $POWER"</span>];</span><br><span class="line"><span class="comment">// 变量名为NSNumber类型</span></span><br><span class="line">varDict = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">150</span>], <span class="string">@"POWER"</span>, <span class="literal">nil</span>];</span><br><span class="line">predicate = [predicateTemplate predicateWithSubstitutionVariables:varDict];</span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"OOP %@"</span>, results);</span><br></pre></td></tr></table></figure>
<h2 id="20-5-运算符"><a href="#20-5-运算符" class="headerlink" title="20.5    运算符"></a>20.5    运算符</h2><blockquote>
<p><strong>说明：</strong><code>NSPredicate</code>的格式串中包含大量不同的运算符。<br><strong>注意：</strong>本章将介绍大多数运算符，其余的可以通过苹果公司的<code>在线文档</code>进行查询。</p>
</blockquote>
<h3 id="20-5-1-比较和逻辑运算符"><a href="#20-5-1-比较和逻辑运算符" class="headerlink" title="20.5.1    比较和逻辑运算符"></a>20.5.1    比较和逻辑运算符</h3><blockquote>
<p><strong>说明：</strong><code>谓词字符串</code>语法支持<code>C</code>语言中一些常用的运算符</p>
<ul>
<li>等号运算符：<code>==</code></li>
<li>不等号运算符：<code>&gt;</code>、<code>&lt;=</code>、<code>!=</code>等</li>
<li>赋值运算符：<code>=</code></li>
<li>逻辑运算符：<code>AND(&amp;&amp;)</code>、<code>OR(||)</code>、<code>NOT(!)</code></li>
</ul>
</blockquote>
<h4 id="20-5-1-1-比较运算符"><a href="#20-5-1-1-比较运算符" class="headerlink" title="20.5.1.1    比较运算符"></a>20.5.1.1    比较运算符</h4><blockquote>
<p><strong>说明：</strong>包括<code>等号运算符</code>和<code>不等号运算符</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>==</code>(<code>&lt;&gt;</code>)</td>
<td>等于</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>不等于</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>小于</td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>大于</td>
</tr>
<tr>
<td><code>&lt;=</code>(<code>=&lt;</code>)</td>
<td>小于或等于</td>
</tr>
<tr>
<td><code>&gt;=</code>(<code>=&gt;</code>)</td>
<td>大于或等于</td>
</tr>
</tbody>
</table>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比较运算符：过滤出数组中name属性小于"Newton"的对象组成的新数组</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"name &lt; 'Newton'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [results valueForKey:<span class="string">@"name"</span>]);</span><br></pre></td></tr></table></figure>
<h4 id="20-5-1-2-逻辑运算符"><a href="#20-5-1-2-逻辑运算符" class="headerlink" title="20.5.1.2    逻辑运算符"></a>20.5.1.2    逻辑运算符</h4><blockquote>
<p><strong>说明：</strong>共3个</p>
</blockquote>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th><code>O-C</code>形式</th>
<th>c语言形式</th>
</tr>
</thead>
<tbody>
<tr>
<td>与</td>
<td><code>AND</code></td>
<td><code>&amp;&amp;</code></td>
</tr>
<tr>
<td>或</td>
<td><code>OR</code></td>
<td>`</td>
<td></td>
<td>`</td>
</tr>
<tr>
<td>非</td>
<td><code>NOT</code></td>
<td><code>!</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意：</strong><code>谓词字符串</code>中的运算符不区分大小写</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 逻辑运算符</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"(engine.horsepower &gt; 50) AND (engine.horsepower &lt; 200)"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"oop %@"</span>, results);</span><br></pre></td></tr></table></figure>
<h3 id="20-5-2-数组运算符"><a href="#20-5-2-数组运算符" class="headerlink" title="20.5.2    数组运算符"></a>20.5.2    数组运算符</h3><blockquote>
<p><strong>说明：</strong>有2个</p>
</blockquote>
<p>|数组运算符|说明|<br>|<code>BETWEEN</code>|判断是否介于两个值之间|<br>|<code>IN</code>|判断数组中是否包含某个值|</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组运算符 BETWEEN：使用数组字面量</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:</span><br><span class="line">             <span class="string">@"engine.horsepower BETWEEN &#123; 50, 200 &#125;"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组运算符 BETWEEN：使用数组变量</span></span><br><span class="line"><span class="built_in">NSArray</span> *betweens = [<span class="built_in">NSArray</span> arrayWithObjects:</span><br><span class="line">                     [<span class="built_in">NSNumber</span> numberWithInt: <span class="number">50</span>], [<span class="built_in">NSNumber</span> numberWithInt: <span class="number">200</span>], <span class="literal">nil</span>];</span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"engine.horsepower BETWEEN %@"</span>, betweens];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"><span class="comment">// 数组运算符 BETWEEN：使用数组变量＋谓词模版</span></span><br><span class="line">predicateTemplate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"engine.horsepower BETWEEN $POWERS"</span>];</span><br><span class="line">varDict = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys: betweens, <span class="string">@"POWERS"</span>, <span class="literal">nil</span>];</span><br><span class="line">predicate = [predicateTemplate predicateWithSubstitutionVariables: varDict];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组运算符 IN：使用数组字面量</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name IN &#123; 'Herbie', 'Snugs', 'Badger', 'Flap' &#125;"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, [results valueForKey: <span class="string">@"name"</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="20-6-有-SELF-就足够了"><a href="#20-6-有-SELF-就足够了" class="headerlink" title="20.6    有 SELF 就足够了"></a>20.6    有 SELF 就足够了</h2><blockquote>
<p><strong>说明：</strong>在谓词字符串的<code>键路径</code>部分，除了可以使用对象的属性名外，还可以通过<code>SELF</code>引用自身。<br><strong>用途：</strong><code>SELF</code>表示的是响应谓词计算的对象本身，适用于将谓词应用于简单的值（例如纯文本字符串），而非哪些可以通过键路径进行操作的复杂对象。<br><strong>技巧：</strong>可以使用<code>谓词</code>计算两个数组的交集，其中一个数组作为<code>主语</code>，另一个在<code>谓词</code>中，使用<code>IN</code>运算符。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------ SELF ：应用于复杂对象</span></span><br><span class="line"><span class="comment">// 判断 name 属性是不是在指定 字符串数组中</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF.name IN &#123;'Herbie', 'Snugs', 'Badger', 'Flap'&#125;"</span>];</span><br><span class="line"><span class="comment">// 使用谓词过滤汽车数组，获取子数组</span></span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------ SELF：应用于简单对象</span></span><br><span class="line"><span class="comment">// 字符串数组</span></span><br><span class="line">names = [cars valueForKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="comment">// 判断字符串自身是不是在指定 字符串数组中</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF IN &#123;'Herbie', 'Snugs', 'Bager', 'Flap'&#125;"</span>];</span><br><span class="line"><span class="comment">// 主语＋谓词</span></span><br><span class="line">results = [cars filteredArrayUsingPredicate:predicate];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------- 使用 IN 运算符计算两个数组的交集</span></span><br><span class="line"><span class="built_in">NSArray</span> *names1 = [<span class="built_in">NSArray</span> arrayWithObjects: <span class="string">@"Herbie"</span>, <span class="string">@"Badger"</span>, <span class="string">@"Judge"</span>, <span class="string">@"Elvis"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *names2 = [<span class="built_in">NSArray</span> arrayWithObjects: <span class="string">@"Judge"</span>, <span class="string">@"Paper Car"</span>, <span class="string">@"Badger"</span>, <span class="string">@"Phoenix"</span>, <span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"SELF IN %@"</span>, names1];</span><br><span class="line">results = [names2 filteredArrayUsingPredicate: predicate];</span><br></pre></td></tr></table></figure>
<h2 id="20-7-字符串运算符"><a href="#20-7-字符串运算符" class="headerlink" title="20.7    字符串运算符"></a>20.7    字符串运算符</h2><blockquote>
<p><strong>说明：</strong>3个专门针对字符串的运算符</p>
</blockquote>
<table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BEGINSWITH</code></td>
<td>前缀是否是某一个字符串</td>
</tr>
<tr>
<td><code>ENDSWITH</code></td>
<td>后缀是某一个字符串</td>
</tr>
<tr>
<td><code>CONTAINS</code></td>
<td>是否包含某一个子串</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>运算符修饰符：</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>c</code></td>
<td>不区分大小写</td>
</tr>
<tr>
<td><code>d</code></td>
<td>不区分发音符号</td>
</tr>
<tr>
<td><code>cd</code></td>
<td>不区分大小写和发音符号</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>建议：</strong>处分是需要区分大小写或重音符号的特殊原因，否则请尽力使用<code>cd</code>修饰符。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------- 字符串运算符</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name BEGINSWITH 'Bad'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name BEGINSWITH 'HERB'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name BEGINSWITH[cd] 'HERB'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br></pre></td></tr></table></figure>
<h2 id="20-8-LIKE-运算符"><a href="#20-8-LIKE-运算符" class="headerlink" title="20.8    LIKE 运算符"></a>20.8    LIKE 运算符</h2><blockquote>
<p><strong>说明：</strong><code>LIKE</code>运算符包含2个通配符</p>
</blockquote>
<table>
<thead>
<tr>
<th>通配符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>与任意个任意字符匹配</td>
</tr>
<tr>
<td><code>?</code></td>
<td>与一个任意字符匹配</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>扩展：</strong>如果热衷于正则表达式，可以使用<code>MATCHES</code>运算符。<br><strong>技巧：</strong>由于正则表达式计算开销比较大，因此可以在使用<code>MATCH</code>之前先使用其它运算符做初步过滤，从而提高运算速度。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------- like 运算符</span></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name LIKE[cd] '*er*'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br><span class="line"></span><br><span class="line">predicate = [<span class="built_in">NSPredicate</span> predicateWithFormat: <span class="string">@"name LIKE[cd] '???er*'"</span>];</span><br><span class="line">results = [cars filteredArrayUsingPredicate: predicate];</span><br><span class="line"><span class="built_in">NSLog</span> (<span class="string">@"%@"</span>, results);</span><br></pre></td></tr></table></figure>
<h2 id="20-9-结语"><a href="#20-9-结语" class="headerlink" title="20.9    结语"></a>20.9    结语</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_19 使用静态分析器/" itemprop="url">
                  19 使用静态分析器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:42:52+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_19 使用静态分析器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_19 使用静态分析器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong>从<code>Xcode 3.2</code>开始加入的新功能，不需要运行程序就可以从逻辑上检测代码的工具，它可以寻找会演变成bug的错误。</p>
</blockquote>
<h2 id="19-1-静态工作"><a href="#19-1-静态工作" class="headerlink" title="19.1    静态工作"></a>19.1    静态工作</h2><blockquote>
<p><strong>说明：</strong><code>静态分析器</code>可以识别以下几种错误</p>
<ul>
<li><strong>安全问题：</strong>比如内存泄漏和缓冲区溢出</li>
<li><strong>并发性问题：</strong>比如静态条件（也就是依赖时间的两个或多个任务失效）</li>
<li><strong>逻辑问题：</strong>包括废代码和不好的编码习惯</li>
</ul>
<p><strong>注意：</strong><code>静态分析器</code>存在以下不足</p>
<ul>
<li>拖慢构建程序的过程：因为需要消耗时间来进行分析</li>
<li>有时会误报错误</li>
<li>需要适应：因为改变了熟悉的工作流程</li>
</ul>
</blockquote>
<h3 id="19-1-1-开始分析"><a href="#19-1-1-开始分析" class="headerlink" title="19.1.1    开始分析"></a>19.1.1    开始分析</h3><blockquote>
<p><strong>运行静态分析器：</strong><code>Product(菜单) -&gt; Analyze</code>，分解决过在导航栏<code>issue</code>中可以看到<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-31%20%E4%B8%8B%E5%8D%885.26.58.png" alt="Alt text"></p>
</blockquote>
<h4 id="19-1-1-1-废代码"><a href="#19-1-1-1-废代码" class="headerlink" title="19.1.1.1    废代码"></a>19.1.1.1    废代码</h4><blockquote>
<p><strong>废代码：</strong>创建了一个对象<code>pool</code>，但从没有在代码中直接访问过，没有向它发送消息也没有更改过它。<br><strong>优化手段：</strong>移除<code>废代码</code><br><strong>优化意义：</strong>废代码并不一定会给程序带来功能上的问题，但终归会浪费性能，移除废代码可以使应用程序更加高效。</p>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-31%20%E4%B8%8B%E5%8D%886.42.15.png" alt="Alt text"></p>
<h4 id="19-1-1-2-内存泄漏：对象被释放之前程序return"><a href="#19-1-1-2-内存泄漏：对象被释放之前程序return" class="headerlink" title="19.1.1.2    内存泄漏：对象被释放之前程序return"></a>19.1.1.2    内存泄漏：对象被释放之前程序return</h4><blockquote>
<p><strong>说明：</strong>通常还没有释放掉分配的内存的对象，就过早返回时便会出现这种情况。<br><strong>扩展：</strong>可以通过点击带有<code>分析器图标</code>的代码来观察代码从开始到当前行的运行流程</p>
<ol>
<li>触发“运行流程”<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-31%20%E4%B8%8B%E5%8D%886.50.10.png" alt="Alt text"></li>
<li>完毕<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-31%20%E4%B8%8B%E5%8D%886.55.01.png" alt="Alt text"></li>
</ol>
</blockquote>
<h4 id="19-1-1-3-内存泄漏：副本没有释放"><a href="#19-1-1-3-内存泄漏：副本没有释放" class="headerlink" title="19.1.1.3    内存泄漏：副本没有释放"></a>19.1.1.3    内存泄漏：副本没有释放</h4><blockquote>
<p><strong>说明：</strong>创建一个对象的副本，要在适当的时候对其进行释放，否则引发内存泄漏。<br><strong>优化手段：</strong>在<code>main</code>函数结尾处释放<code>carCopy</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-31%20%E4%B8%8B%E5%8D%887.02.18.png" alt="Alt text"></p>
</blockquote>
<h4 id="19-1-1-4-内存泄漏：description方法中的desc在返回前没有释放"><a href="#19-1-1-4-内存泄漏：description方法中的desc在返回前没有释放" class="headerlink" title="19.1.1.4    内存泄漏：description方法中的desc在返回前没有释放"></a>19.1.1.4    内存泄漏：description方法中的desc在返回前没有释放</h4><blockquote>
<p><strong>说明：</strong><code>AllWeatherRadial类</code>中的<code>description</code>方法中分配了一个字符串<code>desc</code>，但没有在返回函数之前释放它。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *desc;</span><br><span class="line">    desc = [[<span class="built_in">NSString</span> alloc] initWithFormat:</span><br><span class="line">                   <span class="string">@"AllWeatherRadial: %.1f / %.1f / %.1f / %.1f"</span>,</span><br><span class="line">               [<span class="keyword">self</span> pressure], [<span class="keyword">self</span> treadDepth],</span><br><span class="line">               [<span class="keyword">self</span> rainHandling], </span><br><span class="line">               [<span class="keyword">self</span> snowHandling]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [desc autorelease];</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// description</span></span><br></pre></td></tr></table></figure>
<h3 id="19-1-2-协助分析器"><a href="#19-1-2-协助分析器" class="headerlink" title="19.1.2    协助分析器"></a>19.1.2    协助分析器</h3><blockquote>
<p><strong>说明：</strong><code>静态分析器</code>分析出的“问题”如果是我们有意的，可以通过在声明方法时使用一些<code>关键字</code>避免误报；或者有些情况下，想要使通常没问题的方式发出警报。比如</p>
</blockquote>
<table>
<thead>
<tr>
<th>关键字</th>
<th>用途</th>
<th>对应的惯例</th>
<th>返回对象为<code>Core Foundation</code>对象时</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>NS_RETURNS_RETAINTED</code></td>
<td>标记方法，以返回一个保留计数器的值不是零的对象</td>
<td>分配内存的地方也要负责清理内存</td>
<td><code>CF_RETURNS_RETAINTED</code></td>
</tr>
<tr>
<td><code>NS_RETURNS_NOT_RETAINED</code></td>
<td>使<code>静态分析器</code>在方法试图返回一个保留对象时发出<code>issue</code></td>
<td>返回保留对象通常不需要做额外内存管理</td>
<td><code>NS_RETURNS_NOT_RETAINED</code></td>
</tr>
<tr>
<td><code>CLANG_ANALYZER_NORETURN</code></td>
<td>如果方法有值返回，就在<code>静态分析</code>是发出警报</td>
<td>方法返回值不会发生<code>issue</code></td>
<td>无意义</td>
</tr>
</tbody>
</table>
<h4 id="NS-RETURNS-RETAINTED：返回一个保留的对象"><a href="#NS-RETURNS-RETAINTED：返回一个保留的对象" class="headerlink" title="NS_RETURNS_RETAINTED：返回一个保留的对象"></a>NS_RETURNS_RETAINTED：返回一个保留的对象</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableArray</span> *) superDuperArrayCreator <span class="built_in">NS_RETURNS_RETAINED</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableArray</span> *) superDuperArrayCreator</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSMutableArray</span> *myArray = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="comment">// 没将 myArray 释放就返回了</span></span><br><span class="line">	<span class="keyword">return</span> myArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="NS-RETURNS-NOT-RETAINED：返回一个未保留的对象"><a href="#NS-RETURNS-NOT-RETAINED：返回一个未保留的对象" class="headerlink" title="NS_RETURNS_NOT_RETAINED：返回一个未保留的对象"></a>NS_RETURNS_NOT_RETAINED：返回一个未保留的对象</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分析器会在该方法视图返回一个保留对象时提出issue</span></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *) superDuperArrayCreator <span class="built_in">NS_RETURNS_NOT_RETAINED</span>;</span><br></pre></td></tr></table></figure>
<h3 id="19-1-3-了解更多"><a href="#19-1-3-了解更多" class="headerlink" title="19.1.3    了解更多"></a>19.1.3    了解更多</h3><blockquote>
<p><strong>说明：</strong><code>静态分析器</code>能够找到的其它问题</p>
</blockquote>
<table>
<thead>
<tr>
<th><code>issue</code></th>
<th>说明</th>
<th>解决<code>issue</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>等号错误</td>
<td><code>if (myValue = expression)</code>存在歧义</td>
<td>赋值后判空：<code>if ((myValue = expression))</code>；判等：<code>if (nil != (myValue = expression))</code></td>
</tr>
<tr>
<td>内存泄漏</td>
<td>方法中的运行时错误使方法提前return，导致release代码没有执行而发生内存泄漏</td>
<td>无论什么时候退出了方法，都需要确认有没有分配了单海没有释放的对象</td>
</tr>
<tr>
<td>过度释放</td>
<td>重复<code>autorelease</code></td>
<td>移除多余的<code>autorelease</code></td>
</tr>
<tr>
<td><code>@synchronized语句中的空值</code></td>
<td><code>@synchronized(object)</code>中的<code>object</code>如果为<code>nil</code>就发出<code>issue</code></td>
<td>确保<code>object</code>不为<code>nil</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>建议：</strong>把<code>静态分析器</code>作为一个善意但烦人的朋友，因为它所说的通常都是对的。<br><strong>注意：</strong>不要太依赖<code>静态分析器</code>来查找每一个内存泄漏和废代码，自己要对自己的代码负责。</p>
</blockquote>
<h2 id="19-2-小结"><a href="#19-2-小结" class="headerlink" title="19.2    小结"></a>19.2    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_18 键／值编码/" itemprop="url">
                  18 键/值编码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:42:32+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_18 键／值编码/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_18 键／值编码/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="18-1-入门项目"><a href="#18-1-入门项目" class="headerlink" title="18.1    入门项目"></a>18.1    入门项目</h2><blockquote>
<p><strong>说明：</strong></p>
</blockquote>
<h2 id="18-2-KVC简介"><a href="#18-2-KVC简介" class="headerlink" title="18.2    KVC简介"></a>18.2    KVC简介</h2><blockquote>
<p><strong>说明：</strong>通过<code>键／值编码（KVC）</code>，没有相应<code>getter</code>方法也能获取属性值，没有相应<code>setter</code>方法也能设置属性值。<br><strong>自动开箱和装箱：</strong>仅<code>KVC</code>具有这种功能，常规方法调用和属性语法不具备该功能。</p>
</blockquote>
<h3 id="valueForKey实例方法"><a href="#valueForKey实例方法" class="headerlink" title="valueForKey实例方法"></a>valueForKey实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>获取属性的<code>值</code>。<br><strong>原理：</strong>在<code>Objective-C</code>的运行中使用元数据打开对象并进入其中查找需要的信息，查找顺序为</p>
<ol>
<li>以参数命名(<code>key</code>或<code>isKey</code>)的<code>getter</code></li>
<li>名称为<code>_key</code>或<code>key</code>的实例变量</li>
</ol>
<p><strong>自动装箱：</strong>通过该方法获取属性值时，如果属性为<code>标量(int、float、struct)</code>，该方法会根据需要将属性放入<code>NSNumber</code>或<code>NSValue</code>中。<br><strong>兼容性：</strong>在<code>C</code>或<code>C++</code>中不能执行这种操作。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; key 属性名</span><br><span class="line">* @return &#123;id&#125; 属性值（标量会被自动装箱）</span><br><span class="line">*/</span></span><br><span class="line">- (nullable <span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<h3 id="setValue-forkey实例方法"><a href="#setValue-forkey实例方法" class="headerlink" title="setValue:forkey实例方法"></a>setValue:forkey实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>设置属性的<code>值</code>。<br><strong>自动开箱：</strong>使用该方法设置属性时，如果属性是<code>标量（int、float、struct）</code>，则会从新值（<code>id</code>）中提取出和属性类型相符的<code>标量</code>。<br><strong>技巧：</strong>如果想设置一个<code>标量</code>值，在调用<code>setValue</code>方法之前需要将它们包装掐来（封装到对象中）。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; value 要设置的值（需要的话会被开箱）</span><br><span class="line">* @param &#123;NSString *&#125; key 属性名</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(nullable <span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 创建 Car 对象</span></span><br><span class="line">Car *car = [[Car alloc] init];</span><br><span class="line">car.name = <span class="string">@"Herbie"</span>;</span><br><span class="line">car.make = <span class="string">@"Honda"</span>;</span><br><span class="line">car.model = <span class="string">@"CRX"</span>;</span><br><span class="line">car.modelYear = <span class="number">1984</span>;</span><br><span class="line">car.numberOfDoors = <span class="number">2</span>;</span><br><span class="line">car.mileage = <span class="number">110000</span>;</span><br><span class="line"><span class="comment">// 初始化轮胎</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    AllWeatherRadial *tire;</span><br><span class="line">    tire = [[AllWeatherRadial alloc] init];</span><br><span class="line">    [car setTire: tire atIndex:i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化引擎</span></span><br><span class="line">Slant6 *engine = [[Slant6 alloc] init];</span><br><span class="line">car.engine = engine;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 访问车的引擎的马力</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [engine valueForKey:<span class="string">@"horsepower"</span>]);</span><br><span class="line"><span class="comment">// 通过 KVC 重新设置车的引擎的马力</span></span><br><span class="line">[engine setValue:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">150</span>] forKey:<span class="string">@"horsepower"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [engine valueForKey:<span class="string">@"horsepower"</span>]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Car is %@"</span>, car);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 访问车的名字</span></span><br><span class="line"><span class="built_in">NSString</span> *name = [car valueForKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, name);</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的制造商</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"make is %@"</span>, [car valueForKey:<span class="string">@"make"</span>]);</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的车型出厂日期</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"model year is %@"</span>, [car valueForKey:<span class="string">@"modelYear"</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 设置车名</span></span><br><span class="line">[car setValue:<span class="string">@"Harold"</span> forKey:<span class="string">@"name"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"new car name is %@"</span>, [car name]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 KVC 设置里程数</span></span><br><span class="line">[car setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">25062.4</span>] forKey:<span class="string">@"mileage"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"new mileage is %.1f"</span>, [car mileage]);</span><br></pre></td></tr></table></figure>
<h2 id="18-3-键路径"><a href="#18-3-键路径" class="headerlink" title="18.3    键路径"></a>18.3    键路径</h2><blockquote>
<p><strong>说明：</strong>进行<code>get</code>和<code>set</code>操作，除了通过<code>键</code>，还可以通过<code>键路径</code>。<code>键路径</code>可以根据<code>对象图</code>访问到任意深度的对象，比使用一系列嵌套方法调用更容易访问到对象。</p>
</blockquote>
<h3 id="valueForKeyPath实例方法"><a href="#valueForKeyPath实例方法" class="headerlink" title="valueForKeyPath实例方法"></a>valueForKeyPath实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>获取属性的<code>值</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; keyPath 键路径</span><br><span class="line">* @return &#123;id&#125; 属性值（标量会被自动装箱）</span><br><span class="line">*/</span></span><br><span class="line">- (nullable <span class="keyword">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<h3 id="setValue-forKeyPath实例方法"><a href="#setValue-forKeyPath实例方法" class="headerlink" title="setValue:forKeyPath实例方法"></a>setValue:forKeyPath实例方法</h3><blockquote>
<p><strong>说明：</strong>将属性名作为<code>键</code>设置属性的<code>值</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; value 要设置的值（需要的话会被开箱）</span><br><span class="line">* @param &#123;NSString *&#125; keyPath 键路径</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(nullable <span class="keyword">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 KVC 设置车的引擎的马力</span></span><br><span class="line">[car setValue:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">155</span>] forKeyPath:<span class="string">@"engine.horsepower"</span>];</span><br><span class="line"><span class="comment">// 通过 KVC 访问车的引擎的马力</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"horsepower is %@"</span>, [car valueForKeyPath:<span class="string">@"engine.horsepower"</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="18-4-整体操作"><a href="#18-4-整体操作" class="headerlink" title="18.4    整体操作"></a>18.4    整体操作</h2><blockquote>
<p><strong>说明：</strong>如果使用<code>键值</code>或<code>键路径</code>访问位于对象中的数组类型的<code>实例属性</code>的元素，实际上会对数组中所有元素进行操作。如果是查询操作，则还会将查询结果打包到另一个数组中并返回。<br><strong>注意：</strong>这种<code>整体操作</code>意味着无法在<code>键路径</code>中单独索引数组类型的属性的其中一个元素。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 KVC 访问车的轮胎的胎压，会便利tires的每个属性，并将所有tires的属性的pressure变量封装到 NSNumber 对象中并返回</span></span><br><span class="line"><span class="built_in">NSArray</span> *pressures = [car valueForKeyPath:<span class="string">@"tires.pressure"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"pressures %@"</span>, pressures);</span><br></pre></td></tr></table></figure>
<h3 id="18-4-1-休息一下"><a href="#18-4-1-休息一下" class="headerlink" title="18.4.1    休息一下"></a>18.4.1    休息一下</h3><blockquote>
<p><strong>说明：</strong>创建一个新的类用于后面的学习使用。</p>
</blockquote>
<p><em>Garage.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Car</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Garage</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">	<span class="built_in">NSString</span> *name;</span><br><span class="line">	<span class="built_in">NSMutableArray</span> *cars;</span><br><span class="line">	<span class="built_in">NSMutableDictionary</span> *stuff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readwrite</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) addCar: (Car *) car;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Garage</span></span><br></pre></td></tr></table></figure>
<p><em>Garage.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Garage.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Garage</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> name;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) addCar: (Car *) car &#123;</span><br><span class="line">	<span class="keyword">if</span> (cars == <span class="literal">nil</span>) &#123;</span><br><span class="line">		cars = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">	&#125;</span><br><span class="line">	[cars addObject: car];</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// addCar</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) dealloc &#123;</span><br><span class="line">	[name release];</span><br><span class="line">	[cars release];</span><br><span class="line">	[stuff release];</span><br><span class="line">	[<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125; <span class="comment">// dealloc</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) print &#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"%@:"</span>, name);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (Car *car <span class="keyword">in</span> cars) &#123;</span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"    %@"</span>, car);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="comment">// print</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) setValue: (<span class="keyword">id</span>) value  forUndefinedKey: (<span class="built_in">NSString</span> *) key &#123;</span><br><span class="line">	<span class="keyword">if</span> (stuff == <span class="literal">nil</span>) &#123;</span><br><span class="line">		stuff = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">	&#125;</span><br><span class="line">	[stuff setValue: value forKey: key];</span><br><span class="line">&#125; <span class="comment">// setValueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) valueForUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">	<span class="keyword">id</span> value = [stuff valueForKey: key];</span><br><span class="line">	<span class="keyword">return</span> (value);</span><br><span class="line">&#125; <span class="comment">// valueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span>  <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 汽车集合</span></span><br><span class="line">Garage *garage = [[Garage alloc] init];</span><br><span class="line">garage.name = <span class="string">@"Joe's Garage"</span>;</span><br><span class="line"><span class="comment">// 创建一些汽车实例</span></span><br><span class="line">Car *car;</span><br><span class="line">car = makeCar(<span class="string">@"Herbie"</span>, <span class="string">@"Honda"</span>, <span class="string">@"CRX"</span>, <span class="number">1984</span>, <span class="number">2</span>, <span class="number">110000</span>, <span class="number">58</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Badger"</span>, <span class="string">@"Acura"</span>, <span class="string">@"integra"</span>, <span class="number">1987</span>, <span class="number">5</span>, <span class="number">217036</span>, <span class="number">130</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Elvis"</span>, <span class="string">@"Acura"</span>, <span class="string">@"Legend"</span>, <span class="number">1989</span>, <span class="number">4</span>, <span class="number">28123.4</span>, <span class="number">151</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line">car = makeCar(<span class="string">@"Phoenix"</span>, <span class="string">@"Pontiac"</span>, <span class="string">@"Firebird"</span>, <span class="number">1969</span>, <span class="number">2</span>, <span class="number">85128.3</span>, <span class="number">345</span>);</span><br><span class="line">[garage addCar:car];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察汽车集合</span></span><br><span class="line">[garage print];</span><br></pre></td></tr></table></figure>
<h3 id="18-4-2-快速运算"><a href="#18-4-2-快速运算" class="headerlink" title="18.4.2    快速运算"></a>18.4.2    快速运算</h3><blockquote>
<p><strong>说明：</strong><code>键路径</code>中可以使用进行引用一些运算符进行一些运算，比如</p>
<ul>
<li><strong>prevProperty.<code>@count</code>：</strong>计算 <strong>prevProperty</strong> 包含的对象的总数</li>
<li><strong>prevProperty.<code>@sum</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的总和</li>
<li><strong>prevProperty.<code>@avg</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的平均值</li>
<li><strong>prevProperty.<code>@max</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的最大值</li>
<li><strong>prevProperty.<code>@min</code>.nextProperty：</strong>计算<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性的最小值</li>
<li><strong>prevProperty.<code>@distinctUnionOfObjects</code>.nextProperty：</strong>获得从<strong>prevProperty</strong>包含的所有对象的<strong>nextProperty</strong>属性构成的集合去重后的集合</li>
</ul>
<p><strong>注意：</strong>不要滥用<code>KVC</code>通过<code>键路径</code>提供的处理集合类的<code>快速运算</code>特性，因为</p>
<ul>
<li>速度比较慢</li>
<li>编译器无法对它进行错误检查（出现运行时错误时才能发觉）</li>
</ul>
<p><strong>限制：</strong>无法添加自定义的运算符</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// @count</span></span><br><span class="line"><span class="built_in">NSNumber</span> *count = [garage valueForKeyPath:<span class="string">@"cars.@count"</span>];</span><br><span class="line"><span class="comment">// @sum</span></span><br><span class="line"><span class="built_in">NSNumber</span> *sum = [garage valueForKeyPath:<span class="string">@"cars.@sum.mileage"</span>];</span><br><span class="line"><span class="comment">// @avg</span></span><br><span class="line"><span class="built_in">NSNumber</span> *avgMileage = [garage valueForKeyPath:<span class="string">@"cars.@avg.mileage"</span>];</span><br><span class="line"><span class="comment">// @max、 @min</span></span><br><span class="line"><span class="built_in">NSNumber</span> *min, *max;</span><br><span class="line">max = [garage valueForKeyPath:<span class="string">@"cars.@max.mileage"</span>];</span><br><span class="line">min = [garage valueForKeyPath:<span class="string">@"cars.@max.mileage"</span>];</span><br><span class="line"><span class="comment">// @distinctUnionOfObjects</span></span><br><span class="line"><span class="built_in">NSArray</span> *manufacture = [garage valueForKeyPath:<span class="string">@"cars.@distinctUnionOfObjects.make"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="18-5-批处理"><a href="#18-5-批处理" class="headerlink" title="18.5    批处理"></a>18.5    批处理</h2><blockquote>
<p><strong>说明：</strong><code>KVC</code>提供了对对象进行批量操作的方式。</p>
</blockquote>
<h3 id="setValuesForKeysWithDictionary实例方法"><a href="#setValuesForKeysWithDictionary实例方法" class="headerlink" title="setValuesForKeysWithDictionary实例方法"></a>setValuesForKeysWithDictionary实例方法</h3><blockquote>
<p><strong>说明：</strong>通过<code>字典</code>对对象进行批量<code>set</code>。<br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSDictionary&lt;NSString *, id&gt; *&#125; keyedValues 包含一系列属性名和值的字典</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValuesForKeysWithDictionary:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)keyedValues;</span><br></pre></td></tr></table></figure>
<h3 id="dictionaryWithValuesForKeys实例方法"><a href="#dictionaryWithValuesForKeys实例方法" class="headerlink" title="dictionaryWithValuesForKeys实例方法"></a>dictionaryWithValuesForKeys实例方法</h3><blockquote>
<p><strong>说明：</strong>通过<code>数组</code>对对象进行批量<code>set</code><br><strong>原型：</strong><code>NSKeyValueCoding.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSArray&lt;NSString *&gt; *&#125; keys 包含要获取的属性的属性名</span><br><span class="line">* @return &#123;NSDictionary&lt;NSString *, id&gt; *&#125; 包含要获取的属性名/属性值对的字典</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取汽车集合中的最后一个汽车实例</span></span><br><span class="line">car = [[garage valueForKeyPath:<span class="string">@"cars"</span>] lastObject];</span><br><span class="line"><span class="comment">// 创建一个数组：包含创建字典需要的键集合</span></span><br><span class="line"><span class="built_in">NSArray</span> *keys = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"make"</span>, <span class="string">@"model"</span>, <span class="string">@"modelYear"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 使用 KVC 批量get：利用上一步创建的包含一系列键的数组</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *carValues = [car dictionaryWithValuesForKeys:keys];</span><br><span class="line"><span class="comment">// 创建字典：用于初始化汽车实例的属性</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *newValues = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">                           <span class="string">@"Chevy"</span>, <span class="string">@"make"</span>,</span><br><span class="line">                           <span class="string">@"Nova"</span>,<span class="string">@"model"</span>,</span><br><span class="line">                           [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">1964</span>], <span class="string">@"modelYear"</span>,</span><br><span class="line">                           [<span class="built_in">NSNull</span> null], <span class="string">@"mileage"</span>,</span><br><span class="line">                           <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 使用 KVC 批量set汽车</span></span><br><span class="line">[car setValuesForKeysWithDictionary:newValues];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"car with new values is %@"</span>, car);</span><br></pre></td></tr></table></figure>
<h2 id="18-6-nil-仍然可用"><a href="#18-6-nil-仍然可用" class="headerlink" title="18.6    nil 仍然可用"></a>18.6    nil 仍然可用</h2><blockquote>
<p><strong>背景：</strong>默认情况下，应用<code>KVC</code>调用<code>setValue:forKey</code>设置某个属性的值为<code>nil</code>时，编译器会给出警告。<br><strong>解决：</strong>可以通过重写<code>setNilValueForKey</code>方法给出有意义个返回值而避免警告。<br><strong>扩展：</strong>这里的 <code>nil</code>是标量<code>nil</code>，不要和<code>[NSNull null]</code>相混淆</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>) setNilValueForKey: (<span class="built_in">NSString</span> *) key &#123;</span><br><span class="line">	<span class="keyword">if</span> ([key isEqualToString: <span class="string">@"mileage"</span>]) &#123;</span><br><span class="line">		mileage = <span class="number">0</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		[<span class="keyword">super</span> setNilValueForKey: key];</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="comment">// setNilValueForKey</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 会将 mileage 设置为 0</span></span><br><span class="line">[car setValue: <span class="literal">nil</span> forKey: <span class="string">@"mileage"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="18-7-处理未定义键"><a href="#18-7-处理未定义键" class="headerlink" title="18.7    处理未定义键"></a>18.7    处理未定义键</h2><blockquote>
<p><strong>背景：</strong>如果<code>KVC</code>机制无法找到处理方法，会退回并询问该如何处理。默认的实现会取消操作。<br><strong>解决：</strong>通过重写<code>setValue:forUndefinedKey</code>和<code>valueForUndefinedKey</code>更改默认行为，使对象可以设置和获取任何键。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  处理通过 KVC 设置不存在的属性的值</span><br><span class="line"> *</span><br><span class="line"> *  @param value 要设置的值</span><br><span class="line"> *  @param key   要设置的属性名</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) setValue:(<span class="keyword">id</span>)value forUndefinedKey: (<span class="built_in">NSString</span> *) key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 惰性初始化</span></span><br><span class="line">    <span class="keyword">if</span> (stuff == <span class="literal">nil</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        stuff = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    [stuff setValue:value forKey:key];</span><br><span class="line">&#125;<span class="comment">// setValueForUndefinedKey</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @override</span><br><span class="line"> *  处理通过 KVC 方式获取不存在的属性的值</span><br><span class="line"> *</span><br><span class="line"> *  @param key 属性名</span><br><span class="line"> *</span><br><span class="line"> *  @return 试图获取不存在的属性的值时的返回值</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>) valueForUndefinedKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span> value = [stuff valueForKey:key];</span><br><span class="line">    <span class="keyword">return</span> (value);</span><br><span class="line">&#125;<span class="comment">// valueForUnderfinedKey</span></span><br></pre></td></tr></table></figure>
<h2 id="18-8-小结"><a href="#18-8-小结" class="headerlink" title="18.8    小结"></a>18.8    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_17 文件的加载于保存/" itemprop="url">
                  17 文件的加载与保存
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:42:12+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_17 文件的加载于保存/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_17 文件的加载于保存/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="17-1-属性列表"><a href="#17-1-属性列表" class="headerlink" title="17.1    属性列表"></a>17.1    属性列表</h2><h3 id="17-1-1-NSDate"><a href="#17-1-1-NSDate" class="headerlink" title="17.1.1    NSDate"></a>17.1.1    NSDate</h3><h4 id="date类方法"><a href="#date类方法" class="headerlink" title="date类方法"></a>date类方法</h4><blockquote>
<p><strong>说明：</strong>获取当前日期和时间。<br><strong>原型：</strong><code>NSDate</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @return &#123;instancetype&#125; NSDate类实例</span><br><span class="line">*/</span></span><br><span class="line">+ (instancetype)date;</span><br></pre></td></tr></table></figure>
<h4 id="dateWithTimeIntervalSinceNow类方法"><a href="#dateWithTimeIntervalSinceNow类方法" class="headerlink" title="dateWithTimeIntervalSinceNow类方法"></a>dateWithTimeIntervalSinceNow类方法</h4><blockquote>
<p><strong>说明：</strong>获取与当前时间相隔一定时差的日期<br><strong>原型：</strong><code>NSDate</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">*@return &#123;instancetype&#125; NSDate实例</span><br><span class="line">*/</span></span><br><span class="line">+ (instancetype)dateWithTimeIntervalSinceNow:(<span class="built_in">NSTimeInterval</span>)secs;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前的日期和时间</span></span><br><span class="line"><span class="built_in">NSDate</span> *date = [<span class="built_in">NSDate</span> date];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"today is %@"</span>, date);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取24小时之前的时间</span></span><br><span class="line"><span class="built_in">NSDate</span> *yesterday = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-(<span class="number">24</span>* <span class="number">60</span> *<span class="number">60</span>)];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"yesterday is %@"</span>, yesterday);</span><br></pre></td></tr></table></figure>
<h3 id="17-1-2-NSData"><a href="#17-1-2-NSData" class="headerlink" title="17.1.2    NSData"></a>17.1.2    NSData</h3><blockquote>
<p><strong>说明：</strong>该类可以包含大量的字节，可以获得数据的长度和指向字节启示位置的指针<br><strong>用途：</strong>如果想将数据块传递给一个函数或方法，可以通过传递一个<code>NSData</code>来实现。<br>注意：<code>NSData</code>是一个对象，支持<code>自动释放</code>的，常规的内存管理对它是有效的，因而无需担心内存清理的问题。</p>
</blockquote>
<h4 id="dataWithBytes类方法"><a href="#dataWithBytes类方法" class="headerlink" title="dataWithBytes类方法"></a>dataWithBytes类方法</h4><blockquote>
<p><strong>说明：</strong>创建一个保存一个普通C字符串（一个字节序列）的<code>NSData</code>对象。<br><strong>原型：</strong><code>NSData</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;nullable const void *&#125; bytes 字符串</span><br><span class="line">* @param &#123;NSUInteger&#125; length 字符串的长度（包括尾部的`\0`）</span><br><span class="line">* @return &#123;instancetype&#125; NSData实例</span><br><span class="line">*/</span></span><br><span class="line">+ (instancetype)dataWithBytes:(nullable <span class="keyword">const</span> <span class="keyword">void</span> *)bytes length:(<span class="built_in">NSUInteger</span>)length;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>扩展：</strong><code>NSData</code>是不可变的，创建后不能改变其中的内容来；<code>NSMutableData</code>是可变的，可以在数据中添加和删除字节。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c 语言字符串</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *string = <span class="string">"hi there, this is a C string!"</span>;</span><br><span class="line"><span class="comment">// 创建 NSData 对象</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithBytes:string length:strlen(string) + <span class="number">1</span>];</span><br><span class="line"><span class="comment">// 操作 NSData 对象</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"data is %@"</span>, data);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%ld byte string is '%s'"</span>, [data length], [data bytes]);</span><br></pre></td></tr></table></figure>
<h3 id="17-1-3-写入和读取属性列表"><a href="#17-1-3-写入和读取属性列表" class="headerlink" title="17.1.3    写入和读取属性列表"></a>17.1.3    写入和读取属性列表</h3><blockquote>
<p><strong>说明：</strong>属性列表类可以存储到文件中，也可以从文件中读取出来。此外，<code>Xcode</code>包含一个属性列表编辑器，可以用来方便地查看<code>plist</code>文件。<br><strong>注意：</strong>如果出现问题，下面介绍的函数都不会返回具体的错误的原因。</p>
</blockquote>
<h4 id="writeToFile实例方法"><a href="#writeToFile实例方法" class="headerlink" title="writeToFile实例方法"></a>writeToFile实例方法</h4><blockquote>
<p><strong>说明：</strong>将属性列表的内容写入到文件。<br><strong>技巧：</strong>应尽量使用<code>atomically</code>的方式保存文件，除非保存的文件容量非常大，会占用用户大量的磁盘空间。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; 文件路径</span><br><span class="line">* @param &#123;BOOL&#125;useAuxiliaryFile 是否首先将文件内容保存到临时文件中（防止极端情况下原始文件被破坏）</span><br><span class="line">*/</span></span><br><span class="line">(<span class="built_in">BOOL</span>)writeToFile:(<span class="built_in">NSString</span> *)path atomically:(<span class="built_in">BOOL</span>)useAuxiliaryFile;</span><br></pre></td></tr></table></figure>
<h4 id="arrayWithContentsOfFile类方法"><a href="#arrayWithContentsOfFile类方法" class="headerlink" title="arrayWithContentsOfFile类方法"></a>arrayWithContentsOfFile类方法</h4><blockquote>
<p><strong>说明：</strong>读取文件中的数组信息并据此创建数组。<br><strong>原型：</strong><code>NSArray</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSString *&#125; path 文件路径</span><br><span class="line">* @return &#123;NSArray&#125; 数组实例</span><br><span class="line">*/</span></span><br><span class="line">+ (nullable <span class="built_in">NSArray</span>&lt;ObjectType&gt; *)arrayWithContentsOfFile:(<span class="built_in">NSString</span> *)path;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 NSArray 实例</span></span><br><span class="line"><span class="built_in">NSArray</span> *phrase;</span><br><span class="line">phrase = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"I"</span>, <span class="string">@"seem"</span>, <span class="string">@"to"</span>, <span class="string">@"be"</span>, <span class="string">@"a"</span>, <span class="string">@"verb"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="comment">// 将 NSArray 对象写入文件</span></span><br><span class="line">[phrase writeToFile:<span class="string">@"/tmp/verbiage.txt"</span> atomically:<span class="literal">YES</span>];</span><br><span class="line"><span class="comment">// 通过文件创建 NSArray 实例</span></span><br><span class="line"><span class="built_in">NSArray</span> *phrase2 = [<span class="built_in">NSArray</span> arrayWithContentsOfFile:<span class="string">@"/tmp/veribage.txt"</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, phrase2);</span><br></pre></td></tr></table></figure>
<p><em>/tmp/verbiage.txt</em></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>I<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>seem<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>to<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>be<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>a<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>verb<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="17-1-4-修改对象类型"><a href="#17-1-4-修改对象类型" class="headerlink" title="17.1.4    修改对象类型"></a>17.1.4    修改对象类型</h3><blockquote>
<p><strong>说明：</strong>存储或加载属性列表时可以使用<code>NSPropertyListSerialization</code>添加一些设定项。</p>
</blockquote>
<h4 id="dataFromPropertyList类方法"><a href="#dataFromPropertyList类方法" class="headerlink" title="dataFromPropertyList类方法"></a>dataFromPropertyList类方法</h4><blockquote>
<p><strong>说明：</strong>存储到文件时指定设定项。已过时。<br><strong>原型：</strong><code>NSPropertyListSerialization</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; plist 属性列表类型对象</span><br><span class="line">* @param &#123;NSPropertyListFormat&#125; format 存储属性列表的方式</span><br><span class="line">* @param &#123;NSString *&#125; errorDescription 错误信息</span><br><span class="line">*/</span></span><br><span class="line">+ (nullable <span class="built_in">NSData</span> *)dataFromPropertyList:(<span class="keyword">id</span>)plist format:(<span class="built_in">NSPropertyListFormat</span>)format errorDescription:(<span class="keyword">out</span> __<span class="keyword">strong</span> <span class="built_in">NSString</span> * __nullable * __nullable)errorString <span class="built_in">NS_DEPRECATED</span>(<span class="number">10</span>_0, <span class="number">10</span>_10, <span class="number">2</span>_0, <span class="number">8</span>_0, <span class="string">"Use dataWithPropertyList:format:options:error: instead."</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可变数组(首都集合)</span></span><br><span class="line"><span class="built_in">NSMutableArray</span> *capitols = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:<span class="number">10</span>];</span><br><span class="line"><span class="comment">// 第一个国家</span></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *capitol = [<span class="built_in">NSMutableDictionary</span> dictionaryWithObject:<span class="string">@"Canada"</span> forKey:<span class="string">@"country"</span>];</span><br><span class="line">[capitol setObject:<span class="string">@"Ottawa"</span> forKey:<span class="string">@"capitol"</span>];</span><br><span class="line">[capitols addObject:capitol];</span><br><span class="line"><span class="comment">// 第二个国家</span></span><br><span class="line">capitol = [<span class="built_in">NSMutableDictionary</span> dictionaryWithObject:<span class="string">@"Norway"</span> forKey:<span class="string">@"country"</span>];</span><br><span class="line">[capitol setObject:<span class="string">@"Oslo"</span> forKey:<span class="string">@"capitol"</span>];</span><br><span class="line">[capitols addObject:capitol];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *error = <span class="literal">nil</span>;</span><br><span class="line"><span class="comment">// 将 plist 数据内容以二进制形式写入文件</span></span><br><span class="line"><span class="built_in">NSData</span> *encodeArray = [<span class="built_in">NSPropertyListSerialization</span> dataFromPropertyList:capitols format:<span class="built_in">NSPropertyListXMLFormat_v1_0</span> errorDescription:&amp;error];</span><br><span class="line">[encodeArray writeToFile:<span class="string">@"/tmp/capitols.txt"</span> atomically:<span class="literal">YES</span>];</span><br></pre></td></tr></table></figure>
<h4 id="propertyListFromData实例方法"><a href="#propertyListFromData实例方法" class="headerlink" title="propertyListFromData实例方法"></a>propertyListFromData实例方法</h4><blockquote>
<p><strong>说明：</strong>以指定形式将文件读取到内存。<br><strong>原型：</strong><code>NSPropertyListSerialization</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;NSData *&#125; data 从文件读取原始数据</span><br><span class="line">* @param &#123;NSPropertyListMutabilityOptions&#125; opt format 读取形式</span><br><span class="line">* @param &#123;NSString *&#125; errorString 可能的错误信息</span><br><span class="line">*/</span></span><br><span class="line">+ (nullable <span class="keyword">id</span>)propertyListFromData:(<span class="built_in">NSData</span> *)data mutabilityOption:(<span class="built_in">NSPropertyListMutabilityOptions</span>)opt format:(nullable <span class="built_in">NSPropertyListFormat</span> *)format errorDescription:(<span class="keyword">out</span> __<span class="keyword">strong</span> <span class="built_in">NSString</span> * __nullable * __nullable)errorString <span class="built_in">NS_DEPRECATED</span>(<span class="number">10</span>_0, <span class="number">10</span>_10, <span class="number">2</span>_0, <span class="number">8</span>_0, <span class="string">"Use propertyListWithData:options:format:error: instead."</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从文件中读取属性列表数据</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfFile:<span class="string">@"/tmp/capitols.txt"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以指定的格式将文件中的内容读取到内存</span></span><br><span class="line"><span class="built_in">NSPropertyListFormat</span> properyListFormat = <span class="built_in">NSPropertyListXMLFormat_v1_0</span>;</span><br><span class="line"><span class="built_in">NSString</span> *error = <span class="literal">nil</span>;</span><br><span class="line"><span class="built_in">NSMutableArray</span> *capitols = [<span class="built_in">NSPropertyListSerialization</span> propertyListFromData:data mutabilityOption:<span class="built_in">NSPropertyListMutableContainersAndLeaves</span> format:&amp;properyListFormat errorDescription:&amp;error];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"capitols %@"</span>, capitols);</span><br></pre></td></tr></table></figure>
<h2 id="17-2-编码对象"><a href="#17-2-编码对象" class="headerlink" title="17.2    编码对象"></a>17.2    编码对象</h2><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>具备一种将任意对象转换成某种格式并保存到磁盘中的机制。</p>
<ul>
<li><strong>序列化（编码）：</strong>将对象的实例变量和其他数据编码为数据块，然后保存到磁盘</li>
<li><strong>反序列化（解码）：</strong>将数据块读回内存，并基于保存的数据创建新对象</li>
</ul>
</blockquote>
<h3 id="NSCoding协议"><a href="#NSCoding协议" class="headerlink" title="NSCoding协议"></a>NSCoding协议</h3><blockquote>
<p><strong>说明：</strong>通过采纳该协议，可以使对象具备<code>序列化和反序列化</code>的能力。<br><strong>原型：</strong></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">NSCoding</span></span></span><br><span class="line"><span class="comment">// 序列化</span></span><br><span class="line">- (<span class="keyword">void</span>) encodeWithCoder: (<span class="built_in">NSCoder</span> *) encoder;</span><br><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line">- (<span class="keyword">id</span>) initWithCoder: (<span class="built_in">NSCoder</span> *) decoder;</span><br><span class="line">&gt;<span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="archiveDataWithRootObject类方法"><a href="#archiveDataWithRootObject类方法" class="headerlink" title="archiveDataWithRootObject类方法"></a>archiveDataWithRootObject类方法</h3><blockquote>
<p><strong>说明：</strong>对对象进行编码。</p>
<ol>
<li>创建了一个<code>KSKeyedArchier</code>实例</li>
<li>将上一步创建的实例传递给参数指定的对象的<code>encodeWithCoder</code>方法</li>
<li>递归编码自身使用到的其它对象，比如字符串、数组及放入数组中的任何对象</li>
<li>所有对象完成键值编码后，被放入一个<code>NSData</code>对象并返回</li>
</ol>
<p><strong>原型：</strong><code>KSKeyedArchiver</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;id&#125; rootObject 要被序列化的对象</span><br><span class="line">* @return &#123;NSData *&#125; 序列化为 NSData 型数据</span><br><span class="line">*/</span></span><br><span class="line">+ (<span class="built_in">NSData</span> *)archivedDataWithRootObject:(<span class="keyword">id</span>)rootObject;</span><br></pre></td></tr></table></figure>
<p><em>Thingie.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Thingie</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name;</span><br><span class="line">    <span class="keyword">int</span> magicNumber;</span><br><span class="line">    <span class="keyword">float</span> shoeSize;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *subThingies;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">int</span> magicNumber;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> shoeSize;</span><br><span class="line"><span class="keyword">@property</span> (retain) <span class="built_in">NSMutableArray</span> *subThingies;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) initWithName: (<span class="built_in">NSString</span> *) n</span><br><span class="line">        magicNumber: (<span class="keyword">int</span>) mn</span><br><span class="line">           shoeSize: (<span class="keyword">float</span>) ss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Thingie.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Thingie.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Thingie</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> name;</span><br><span class="line"><span class="keyword">@synthesize</span> magicNumber;</span><br><span class="line"><span class="keyword">@synthesize</span> shoeSize;</span><br><span class="line"><span class="keyword">@synthesize</span> subThingies;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 便利构造函数：通过用户名</span></span><br><span class="line">- (<span class="keyword">id</span>) initWithName:(<span class="built_in">NSString</span> *)</span><br><span class="line">        magicNumber:(<span class="keyword">int</span>)mn</span><br><span class="line">        shoeSize:(<span class="keyword">float</span>)ss</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = n;</span><br><span class="line">        <span class="keyword">self</span>.magicNumber = mn;</span><br><span class="line">        <span class="keyword">self</span>.showSize = ss;</span><br><span class="line">        <span class="keyword">self</span>.subThingies = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议:反序列化</span></span><br><span class="line">- (<span class="keyword">id</span>) initWithCoder: (<span class="built_in">NSCoder</span> *) decoder</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [decoder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.magicNumber = [decoder decodeIntForKey:<span class="string">@"magicNumber"</span>];</span><br><span class="line">        <span class="keyword">self</span>.shoeSize = [decoder decodeIntForKey:<span class="string">@"shoeSize"</span>];</span><br><span class="line">        <span class="keyword">self</span>.subThingies = [decoder decodeObjectForKey:<span class="string">@"subThingies"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 采纳协议：序列化</span></span><br><span class="line">- (<span class="keyword">void</span>) encodeWithCoder: (<span class="built_in">NSCoder</span> *) coder</span><br><span class="line">&#123;</span><br><span class="line">    [coder encodeObject:name</span><br><span class="line">                 forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [coder encodeInt:magicNumber</span><br><span class="line">              forKey:<span class="string">@"magicNumber"</span>];</span><br><span class="line">    [coder encodeFloat:shoeSize</span><br><span class="line">                forKey:<span class="string">@"shoeSize"</span>];</span><br><span class="line">    [coder encodeObject:subThingies</span><br><span class="line">                 forKey:<span class="string">@"subThingies"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *description = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@: %d/%.1f %@"</span>, name, magicNumber, shoeSize, subThingies];</span><br><span class="line">    <span class="keyword">return</span> (description);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) dealloc</span><br><span class="line">&#123;</span><br><span class="line">    [name release];</span><br><span class="line">    [subThingies release];</span><br><span class="line">    [<span class="keyword">super</span> dealloc];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Thingie.h"</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">/** 简单情形 **/</span></span><br><span class="line">        <span class="comment">// 创建可序列化的对象</span></span><br><span class="line">        Thingie *thing1;</span><br><span class="line">        thing1 = [[Thingie alloc]</span><br><span class="line">                  initWithName:<span class="string">@"thing1"</span></span><br><span class="line">                  magicNumber:<span class="number">42</span></span><br><span class="line">                  shoeSize:<span class="number">10.5</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"some thing: @"</span>, thing1);</span><br><span class="line">        <span class="comment">// 序列化为 NSData 对象</span></span><br><span class="line">        <span class="built_in">NSData</span> *freezeDried;</span><br><span class="line">        freezeDried = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:thing1];</span><br><span class="line">        [thing1 release];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        thing1 = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:freezeDried];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"reconstitued thing: %@"</span>, thing1);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 复杂情形：递归序列化 */</span></span><br><span class="line">        <span class="comment">// 初始化thing1.subThingies（数组）</span></span><br><span class="line">        Thingie *anotherThing;</span><br><span class="line">        anotherThing = [[[Thingle alloc]</span><br><span class="line">                         initWithName:<span class="string">@"thing2"</span></span><br><span class="line">                         magicNumber:<span class="number">23</span> shoeSize:<span class="number">13.0</span>]];</span><br><span class="line">        [thing1.subThingies addObject:anotherThing];</span><br><span class="line">        anotherThing = [[[Thingle alloc]</span><br><span class="line">                         initWithName:<span class="string">@"thing3"</span></span><br><span class="line">                         magicNumber:<span class="number">17</span> shoeSize:<span class="number">9.0</span>]];</span><br><span class="line">        [thing1.subThingies addObject:anotherThing];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"reconstitued muthing: %@"</span>, thing1);</span><br><span class="line">        <span class="comment">// 序列化</span></span><br><span class="line">        [freezeDried = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:thing1];</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        thing1 = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:freezeDried];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"reconstitued multiting: %@"</span>, thing1);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">/* 复杂情形：设置一处引用自己的数据，序列化和反序列化仍能正常工作 */</span></span><br><span class="line">        [thing1.subThingies addObject:thing1];</span><br><span class="line">        <span class="comment">// 序列化</span></span><br><span class="line">        freezeDried = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:thing1];</span><br><span class="line">        <span class="comment">// 反序列化</span></span><br><span class="line">        thing1 = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:freezeDried];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-3-小结"><a href="#17-3-小结" class="headerlink" title="17.3    小结"></a>17.3    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_16 UIKit简介/" itemprop="url">
                  16 UIKit简介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:41:48+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_16 UIKit简介/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_16 UIKit简介/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Mac</code>应用程序使用的是<code>AppKit</code>框架，而<code>iOS</code>应用程序使用的是<code>UIKit</code>框架，它包含了所有的<code>UI</code>组件和构成<code>iOS</code>应用程序的资源。<br><strong>注意：</strong><code>iOS</code>和<code>OS X</code>存在以下区别</p>
<ul>
<li>没有<code>shell</code>和控制台</li>
<li>应用程序在<code>Mac</code>电脑的模拟器中运行</li>
<li>无法支持一些无<code>UI</code>界面的<code>API</code></li>
<li>大部分程序员都认为开发<code>iOS</code>应用更加轻松</li>
</ul>
<p><strong>项目创建：</strong>步骤如下</p>
<ol>
<li><code>File-&gt;New-&gt;New Project</code>(command + shift + n)</li>
<li>选择应用程序模版：左边列表选择<code>iOS</code>下的<code>Application</code>，然后右边选择<code>Single View Application</code></li>
</ol>
<ul>
<li><code>Master-Detail</code>：用一个导航控制器和一个表视图来显示项目列表遗迹项目的详细信息</li>
<li><code>OpenGL Game</code>：游戏</li>
<li><code>Page-Based</code>：创建电子书式的应用，拥有翻页动画效果（该效果支持ipad）</li>
<li><code>Tabbed</code>：多视图应用程序，底部又一个标签栏并且每个标签都有一个视图香关联的那种应用程序</li>
<li><code>Utility</code>：和<code>Single View Application</code>相似，但还多处一个翻转视图</li>
<li><code>Empty</code>：是一个高级选项，如果没有合适的模版，或是你非常了解如何构建你的应用程序，那么刻意选择使用这个模版</li>
</ul>
<ol>
<li>点击<code>Next</code>按钮，弹出询问程序名等信息的对话框</li>
</ol>
<ul>
<li>复选框：不选择<code>Use Storyboard</code>和<code>Include Unit Tests</code>，选中<code>Use Automatic Reference Counting</code></li>
<li><code>Device Family</code>：选择<code>Universal</code>（意味着可以同时运行在<code>iPhone</code>、<code>iPod</code>、<code>iPad</code>上）</li>
</ul>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-26%20%E4%B8%8B%E5%8D%8811.15.54.png" alt="Alt text"></p>
<p><em>AppDelegate.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">ViewController</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> : <span class="title">UIResponder</span> &lt;<span class="title">UIApplicationDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 窗口对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIWindow</span> *window;</span><br><span class="line"><span class="comment">// 视图控制器</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) ViewController *viewController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"AppDelegate.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> window = _window;</span><br><span class="line"><span class="keyword">@synthesize</span> viewController = _viewController;</span><br><span class="line"><span class="comment">// 窗口被创建时回被调用</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">/* 初始化窗口对象 */</span></span><br><span class="line">    <span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[[<span class="built_in">UIScreen</span> mainScreen] bounds]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 初始视图控制器 */</span></span><br><span class="line">    <span class="comment">// iPhone</span></span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">UIDevice</span> currentDevice] userInterfaceIdiom] == <span class="built_in">UIUserInterfaceIdiomPhone</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewController = [[ViewController alloc] initWithNibName:<span class="string">@"ViewController_iPhone"</span> bundle:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// iPad</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.viewController = [[ViewController alloc] initWithNibName:<span class="string">@"ViewController_iPad"</span> bundle:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将视图控制器的视图添加到应用程序层级</span></span><br><span class="line">    <span class="keyword">self</span>.window.rootViewController = <span class="keyword">self</span>.viewController;</span><br><span class="line">    [<span class="keyword">self</span>.window makeKeyAndVisible];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillResignActive:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">    <span class="comment">// Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</span></span><br><span class="line">    <span class="comment">// Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidEnterBackground:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">    <span class="comment">// Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</span></span><br><span class="line">    <span class="comment">// If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillEnterForeground:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">    <span class="comment">// Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidBecomeActive:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">    <span class="comment">// Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationWillTerminate:(<span class="built_in">UIApplication</span> *)application &#123;</span><br><span class="line">    <span class="comment">// Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="16-1-视图控制器"><a href="#16-1-视图控制器" class="headerlink" title="16.1    视图控制器"></a>16.1    视图控制器</h2><blockquote>
<p><strong>说明：</strong><code>Cocoa</code>主要使用的是<code>MVC</code>模式</p>
<ul>
<li><strong>视图：</strong>从<code>nib</code>文件中获取视图</li>
<li><strong>模型：</strong>一组数据</li>
<li><strong>控制器：</strong><code>UIViewController</code>的子类</li>
</ul>
</blockquote>
<h3 id="16-1-1-在Nib文件中添加控件"><a href="#16-1-1-在Nib文件中添加控件" class="headerlink" title="16.1.1    在Nib文件中添加控件"></a>16.1.1    在Nib文件中添加控件</h3><blockquote>
<p><strong>说明：</strong>完成视图的部分</p>
<ul>
<li>拖进一个<code>TextField</code>对象</li>
<li>拖进一个<code>Label</code></li>
<li>拖进两个<code>Button</code></li>
</ul>
</blockquote>
<p><img src="./屏幕快照 2016-01-26 下午10.07.01.png" alt="Alt text"></p>
<h3 id="16-1-2-视图（Nib文件）和控制器建立连接"><a href="#16-1-2-视图（Nib文件）和控制器建立连接" class="headerlink" title="16.1.2    视图（Nib文件）和控制器建立连接"></a>16.1.2    视图（Nib文件）和控制器建立连接</h3><blockquote>
<p><strong>说明：</strong>打开辅助窗口，通过拖拽完成<code>视图</code>(<code>Nib</code>文件)和<code>控制器</code>(<code>ViewController.h</code>)之间的连接。</p>
<ol>
<li>代开辅助窗口：<code>Command+Option+Return</code>或<code>Editor</code>组中间的按钮</li>
<li>为<code>Text Field</code>和<code>Label</code>创建输出口（<code>outlet</code>）：按住<code>control</code>键，将鼠标从视图中的图像元素一直拖到<code>ViewController.h</code>相应位置<br><img src="./屏幕快照 2016-01-26 下午10.01.24 2.png" alt="Alt text"><br><img src="./屏幕快照 2016-01-26 下午10.01.30 2.png" alt="Alt text"></li>
<li>为两个按钮创建<code>操作</code>(Action)</li>
</ol>
<ul>
<li>Name：操作的名称</li>
<li>Type：操作方法参数的类型（默认为<code>id</code>）</li>
<li>Event：事件类型</li>
<li>Arguments：<code>None</code>、<code>Sender</code>和<code>Event</code>（包含一个<code>UIEvent</code>类型的参数）<br><img src="./屏幕快照 2016-01-26 下午10.23.36.png" alt="Alt text"></li>
</ul>
</blockquote>
<h3 id="16-1-3-完成代码的手动编写部分"><a href="#16-1-3-完成代码的手动编写部分" class="headerlink" title="16.1.3    完成代码的手动编写部分"></a>16.1.3    完成代码的手动编写部分</h3><blockquote>
<p><strong>说明：</strong>包括程序核心功能的实现以及一些事件的回调。</p>
</blockquote>
<p><em>ViewController.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *textField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UILabel</span> *resultsField;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)uppercase;</span><br><span class="line">- (<span class="keyword">IBAction</span>)lowercase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ViewController.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> textField;</span><br><span class="line"><span class="keyword">@synthesize</span> resultsField;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  重写父类的便利构造器：完成视图和控制器的绑定</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithNibName:(<span class="built_in">NSString</span> *)nibNameOrNil bundle:(<span class="built_in">NSBundle</span> *)nibBundleOrNil &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithNibName:nibNameOrNil bundle:nibBundleOrNil];</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nil</span> != <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"init: text %@ / result %@"</span>, textField, resultsField);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  系统在nib文件加载和对象初始化完成后调用：从ios 5 不会再调用该方法了</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)awakeFromNib &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"awake: text %@ / result %@"</span>, textField, resultsField);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  系统在nib文件加载和对象初始化完成后调用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"viewDidLoad: text %@ / results %@"</span>, textField, resultsField);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置输入框的placeholder(占位符)</span></span><br><span class="line">    [textField setPlaceholder:<span class="string">@"Enter text here"</span>];</span><br><span class="line">    <span class="comment">// 设置Label的默认值</span></span><br><span class="line">    resultsField.text = <span class="string">@"Result"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  视图从视图层级中移除后会调用这个方法，可以在这里做一些内存清理的事情</span><br><span class="line"> *  该方法已过时</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidUnload &#123;</span><br><span class="line">    [<span class="keyword">self</span> setTextField:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">self</span> setResultsField:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">super</span> viewDidUnload];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</span><br><span class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</span><br><span class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图出现前调用</span></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 视图出现后调用</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 视图消失前调用</span></span><br><span class="line">- (<span class="keyword">void</span>)viewWillDisappear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillDisappear:animated];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 视图消失后调用</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidDisappear:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidDisappear:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)uppercase &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *original = textField.text;</span><br><span class="line">    <span class="built_in">NSString</span> *uppercase = [original uppercaseString];</span><br><span class="line">    resultsField.text = uppercase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)lowercase &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *original = textField.text;</span><br><span class="line">    <span class="built_in">NSString</span> *lowercase = [original lowercaseString];</span><br><span class="line">    resultsField.text = lowercase;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="16-2-小结"><a href="#16-2-小结" class="headerlink" title="16.2    小结"></a>16.2    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_15 AppKit简介/" itemprop="url">
                  15 AppKit简介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:41:28+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_15 AppKit简介/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_15 AppKit简介/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><strong>说明：</strong><code>Application Kit</code>中包含<code>Cocoa</code>中关于用户界面的大量资源。<br><strong>注意：</strong>学习这一章节时，<code>Xcode</code>的最新版本是<code>7.2</code>，部分知识已经过时。比如目前<code>storyboard</code>已经基本取代了<code>xib</code>。</p>
</blockquote>
<h2 id="15-1-构建项目"><a href="#15-1-构建项目" class="headerlink" title="15.1    构建项目"></a>15.1    构建项目</h2><blockquote>
<p><strong>说明：</strong>下面是通过<code>Xcode</code>构建<code>Cocoa</code>应用程序项目的步骤。</p>
<ol>
<li>File-&gt;New-&gt;New Project（Create a New Xcode Project）</li>
<li>左边列表<code>Mac OS X</code>下的<code>Application</code>选项-&gt;<code>Cocoa Application</code>-&gt;Next</li>
<li>项目信息</li>
</ol>
<ul>
<li><code>Product Name</code>：应用名称</li>
<li><code>Company Identifier</code>：企业标识符，用来区分应用程序</li>
<li><code>Class Prefix</code>：伪命名空间，避免文件名冲突</li>
</ul>
<ol>
<li>复选框</li>
</ol>
<ul>
<li><code>Create Document-Based Application</code></li>
<li><code>Use Core Data</code></li>
<li><code>Include Unit Test</code></li>
<li><code>Use Automatic Reference Counting</code></li>
</ul>
</blockquote>
<h2 id="15-2-创建委托文件-interface部分"><a href="#15-2-创建委托文件-interface部分" class="headerlink" title="15.2    创建委托文件@interface部分"></a>15.2    创建委托文件<code>@interface</code>部分</h2><blockquote>
<p><strong><code>Interface Builder</code>：</strong>简称<code>IB</code>，用可视化的方式为<code>OS X</code>和<code>iOS</code>布局窗口内容，构建用户界面。<br><strong><code>IBOutlet</code>和<code>IBAction</code>：</strong>这两个关键字会经常出现在代码中，用于</p>
<ul>
<li>为<code>Interface Builder</code>提供标记</li>
<li>帮助阅读代码</li>
</ul>
</blockquote>
<h2 id="15-3-Interface-Builder"><a href="#15-3-Interface-Builder" class="headerlink" title="15.3    Interface Builder"></a>15.3    Interface Builder</h2><blockquote>
<p><strong>说明：</strong>通过<code>.xib</code>文件就可以打开<code>IB</code>的可视化编辑器。</p>
<ul>
<li><strong>nib文件：</strong>编译时，<code>.xib</code>(<code>XML</code>格式)文件会被编译为<code>nib(NeXT Interface Builder)</code>文件，它是包含了压缩对象的二进制文件，</li>
<li><strong>对象库：</strong>包含了大量可以拖入窗口的不同类型的对象。</li>
</ul>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-25%20%E4%B8%8B%E5%8D%8810.17.36.png" alt="Alt text"></p>
</blockquote>
<h2 id="15-4-设计用户界面"><a href="#15-4-设计用户界面" class="headerlink" title="15.4    设计用户界面"></a>15.4    设计用户界面</h2><blockquote>
<p><strong>说明：</strong>对用户界面进行布局</p>
<ol>
<li>拖入一个<code>Text Filed</code></li>
<li>拖入一个<code>Label</code></li>
<li>拖入一个<code>push button</code></li>
</ol>
</blockquote>
<p><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-25%20%E4%B8%8B%E5%8D%8810.42.36.png" alt="Alt text"></p>
<h2 id="15-5-创建连接"><a href="#15-5-创建连接" class="headerlink" title="15.5    创建连接"></a>15.5    创建连接</h2><blockquote>
<p><strong>说明：</strong>将<code>代码</code>与刚创建的<code>用户界面元素</code>相连接。</p>
</blockquote>
<h3 id="15-5-1-连接输出口（IBOutlet）"><a href="#15-5-1-连接输出口（IBOutlet）" class="headerlink" title="15.5.1    连接输出口（IBOutlet）"></a>15.5.1    连接输出口（IBOutlet）</h3><blockquote>
<p><strong>说明：</strong>通过拖动自动生成界面元素对应的代码。以其中的<code>Text Field</code>为例子</p>
<ol>
<li>打开辅助编辑器</li>
<li>按住<code>Control</code>键将光标从<code>文本框</code>拖动到<code>头文件</code>中<code>@property</code>那一行的下面</li>
<li>出现<code>Insert Outlet orAction</code>提示消息时松开鼠标</li>
<li>在弹出的对话框中输入<code>textField</code>，点击<code>Connect</code></li>
</ol>
</blockquote>
<h3 id="15-5-2-连接操作（IBAction）"><a href="#15-5-2-连接操作（IBAction）" class="headerlink" title="15.5.2    连接操作（IBAction）"></a>15.5.2    连接操作（IBAction）</h3><blockquote>
<p><strong>说明：</strong>将按钮连接到操作，这样按下按钮就会触发代码。以<code>UpperCae</code>按钮为例</p>
<ol>
<li>按住<code>Control</code>键和<code>UpperCase</code>按钮</li>
<li>拖动一条直线到<code>头文件</code>的最后一行<code>@property</code>语句下</li>
<li>弹出连接对话框，选择<code>Action</code>类型</li>
<li>在Name文本框中输入<code>uppercase</code>，并点击<code>Connect</code>(自动在头文件中创建方法的声明，并在实现文件中创建方法的实现)</li>
</ol>
</blockquote>
<h2 id="15-6-应用程序委托的实现"><a href="#15-6-应用程序委托的实现" class="headerlink" title="15.6    应用程序委托的实现"></a>15.6    应用程序委托的实现</h2><blockquote>
<p><strong>说明：</strong><code>IBOutlet</code>的工作方式</p>
<ol>
<li>应用程序启动时，<code>MainMenu.nib</code>被自动加载，界面对象被创建</li>
<li>分配并初始化<code>MSCApplelegate</code>实例（<code>IBOutlet</code>的实例变量）</li>
<li>建立连接：将<code>NSTextField</code>等对象的地址添加到<code>MSCAppDelegate</code>实例变量中，然后像每个每个<code>界面对象</code>发送<code>awakeFromNib</code>消息。</li>
</ol>
</blockquote>
<p><em>MSCAppDelegate.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MSCAppDelegate</span> : <span class="title">NSObject</span> &lt;<span class="title">NSApplicationDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>) <span class="keyword">IBOutlet</span> <span class="built_in">NSWindow</span> *window;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>) <span class="keyword">IBOutlet</span> <span class="built_in">NSTextField</span> *textField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>) <span class="keyword">IBOutlet</span> <span class="built_in">NSTextField</span> *resultsField;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)uppercase:(<span class="keyword">id</span>)sender;</span><br><span class="line">- (<span class="keyword">IBAction</span>)lowercase:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>MSCAppDelegate.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"MSCAppDelegate.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MSCAppDelegate</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> window = _window;</span><br><span class="line"><span class="keyword">@synthesize</span> textField = _textField;</span><br><span class="line"><span class="keyword">@synthesize</span> resultsField = _resultsField;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)init &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">nil</span> != (<span class="keyword">self</span> = [<span class="keyword">super</span> init])) &#123;</span><br><span class="line">        <span class="comment">// 此时还没和界面对象建立连接，因此都是 nil</span></span><br><span class="line">		<span class="built_in">NSLog</span> (<span class="string">@"init: text %@ / results %@"</span>, _textField, _resultsField);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * 对界面对象进行一些初始化工作</span><br><span class="line"> * 连接建立后会被调用</span><br><span class="line"> *  @override</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)awakeFromNib &#123;</span><br><span class="line">	<span class="built_in">NSLog</span> (<span class="string">@"awake: text %@ / results %@"</span>, _textField, _resultsField);</span><br><span class="line">	</span><br><span class="line">	[_textField setStringValue:<span class="string">@"Enter text here"</span>];</span><br><span class="line">	[_resultsField setStringValue:<span class="string">@"Results"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)applicationDidFinishLaunching:(<span class="built_in">NSNotification</span> *)aNotification &#123;</span><br><span class="line">    <span class="comment">// Insert code here to initialize your application</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)uppercase:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *original = [_textField stringValue];</span><br><span class="line">	<span class="built_in">NSString</span> *uppercase = [original uppercaseString];</span><br><span class="line">	[_resultsField setStringValue:uppercase];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)lowercase:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">	<span class="built_in">NSString</span> *original = [_textField stringValue];</span><br><span class="line">	<span class="built_in">NSString</span> *lowercase = [original lowercaseString];</span><br><span class="line">	[_resultsField setStringValue:lowercase];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="15-7-小结"><a href="#15-7-小结" class="headerlink" title="15.7    小结"></a>15.7    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_14 代码块和并发性/" itemprop="url">
                  14 代码块和并发行
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:41:10+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_14 代码块和并发性/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_14 代码块和并发性/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="14-1-代码块"><a href="#14-1-代码块" class="headerlink" title="14.1    代码块"></a>14.1    代码块</h2><blockquote>
<p><strong>说明：</strong><code>代码块</code>是由C语言实现的，是对C语言中函数的扩展。<br><strong>支持的语言：</strong><code>Objective-C</code>、<code>C</code> 、<code>C++</code>、<code>Objective-C++</code><br><strong>用途：</strong><code>替代函数</code>或实现<code>闭包</code><br><strong>现状：</strong><code>代码块</code>在<code>Xcode</code>的<code>GCC</code>和<code>CLang</code>工具中是有效的，但它不属于<code>ANSI</code>的<code>C</code>语言标准。关于代码块的提议已经提交给C语言标准团体。</p>
</blockquote>
<h3 id="14-1-1-代码块和函数指针"><a href="#14-1-1-代码块和函数指针" class="headerlink" title="14.1.1    代码块和函数指针"></a>14.1.1    代码块和函数指针</h3><blockquote>
<p><strong>说明：</strong><code>代码块</code>的语法借鉴了<code>函数指针</code></p>
<ul>
<li><strong>返回类型</strong>可以手动声明也可以由编译器通过代码块推导</li>
<li>具有指定类型的<strong>参数</strong>列表</li>
<li>拥有<strong>名称</strong></li>
<li>代码放在<code>{}</code>中</li>
</ul>
<p><strong>语法：</strong><code>&lt;returntype&gt; (^blockname)(list of arguments) = ^(arguments){body;}</code><br><em>实现部分推导出返回值类型</em></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现部分省略了返回值类型，没有参数列表</span></span><br><span class="line"><span class="keyword">void</span> (^theBlock)() = ^&#123;</span><br><span class="line">	printf(<span class="string">"Hello Blocks!"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 定义并实现代码块 square_block</span><br><span class="line">* 计算乘方</span><br><span class="line">* @param &#123;int&#125; number 数值</span><br><span class="line">* @return &#123;int&#125; number 乘方结果</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">int</span> (^square_block)(<span class="keyword">int</span> number) = ^(<span class="keyword">int</span> number) &#123;</span><br><span class="line">	<span class="keyword">return</span> (number * number);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用代码块</span></span><br><span class="line"><span class="keyword">int</span> result = square_block(<span class="number">5</span>);</span><br><span class="line">printf(<span class="string">"Result = %d\n"</span>, result);</span><br></pre></td></tr></table></figure>
<h4 id="14-1-1-1-通过代码块名调用代码块"><a href="#14-1-1-1-通过代码块名调用代码块" class="headerlink" title="14.1.1.1    通过代码块名调用代码块"></a>14.1.1.1    通过代码块名调用代码块</h4><blockquote>
<p><strong>说明：</strong>可以像调用<code>函数</code>一样调用<code>代码块</code>。<br><strong>比函数强大：</strong>代码块可以访问与它相同的有效范围内声明的变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明并初始化变量：声明时的作用域和代码块相同</span></span><br><span class="line"><span class="keyword">int</span> value = <span class="number">6</span>;</span><br><span class="line"><span class="comment">// 定义并实现代码块</span></span><br><span class="line"><span class="keyword">int</span> (^multiply_block)(<span class="keyword">int</span> number) = ^(<span class="keyword">int</span> number) &#123;</span><br><span class="line">	<span class="comment">// 访问外部同作用域声明的变量</span></span><br><span class="line">	<span class="keyword">return</span> (value * number);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="14-1-1-2-直接调用代码块（匿名）"><a href="#14-1-1-2-直接调用代码块（匿名）" class="headerlink" title="14.1.1.2    直接调用代码块（匿名）"></a>14.1.1.2    直接调用代码块（匿名）</h4><blockquote>
<p><strong>说明：</strong>使用代码块时通常不需要创建一个代码块变量，而是在代码中内联代码块的内容。<br><strong>使用场景：</strong>作为参数传递给方法或函数</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithObjects: <span class="string">@"Amir"</span>, <span class="string">@"Mishal"</span>, <span class="string">@"Irrum"</span>, <span class="string">@"Adam"</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Unsorted Array %@"</span>, array);</span><br><span class="line"><span class="comment">// 传递匿名代码块</span></span><br><span class="line"><span class="built_in">NSArray</span> *soredArray = [array sortedArrayUsingComparator: ^(<span class="built_in">NSString</span> *object1, <span class="built_in">NSString</span> *object2)] &#123;</span><br><span class="line">	<span class="keyword">return</span> [object1 compare: object2];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Sorted Array %@"</span>, sortedArray);</span><br></pre></td></tr></table></figure>
<h4 id="14-1-1-3-使用typedef关键字"><a href="#14-1-1-3-使用typedef关键字" class="headerlink" title="14.1.1.3    使用typedef关键字"></a>14.1.1.3    使用<code>typedef</code>关键字</h4><blockquote>
<p><strong>说明：</strong>将<code>代码块</code>声明定义为一种类型，更易于代码的编写。<br><strong>语法：</strong><code>typedef 代码块定义;</code><br><strong>注意：</strong><code>typedef</code>后面的<code>代码块</code>定义中的代码块名不再具备<code>代码块名</code>的功能，而是一种类型名。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将代码块定义为一种类型： MKSampleMultiply2BlockRef</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> (^<span class="built_in">MKSampleMultiply2BlockRef</span>)(<span class="keyword">double</span> c, <span class="keyword">double</span> d);</span><br><span class="line"><span class="comment">// 使用新类型创建代码块</span></span><br><span class="line"><span class="built_in">MKSampleMultiply2BlockRef</span> multiply2 = ^(<span class="keyword">double</span> c, <span class="keyword">double</span> d) &#123;</span><br><span class="line">	<span class="keyword">return</span> c * d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用代码块</span></span><br><span class="line">printf(<span class="string">"%f, %f"</span>, multiply2(<span class="number">4</span>, <span class="number">5</span>), multiply2(<span class="number">5</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<h4 id="14-1-1-4-代码块和变量"><a href="#14-1-1-4-代码块和变量" class="headerlink" title="14.1.1.4    代码块和变量"></a>14.1.1.4    代码块和变量</h4><blockquote>
<p><strong>说明：</strong>代码块被声明后会捕捉到创建时的上下文中的变量或函数。</p>
<ul>
<li>全局变量（包括在封闭范围内声明的本地静态变量）</li>
<li>全局函数</li>
<li>封闭范围内的参数</li>
<li><code>Objective-C</code>的实例变量</li>
<li>代码块内部的本地变量</li>
</ul>
</blockquote>
<h5 id="本地变量"><a href="#本地变量" class="headerlink" title="本地变量"></a>本地变量</h5><blockquote>
<p><strong>说明：</strong>与代码块在同一范围内声明的变量。<br><strong>捕获情况：</strong>代码块会在定义时把本地变量当作<code>常量</code>复制并保存它们的状态。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义代码块类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> (^<span class="built_in">MKSampleMultiplyBlockRef</span>)(<span class="keyword">void</span>);</span><br><span class="line"><span class="comment">// 本地变量</span></span><br><span class="line"><span class="keyword">double</span> a = <span class="number">10</span>, b = <span class="number">20</span>;</span><br><span class="line"><span class="comment">// 声明并实现代码块，复制并保存状态</span></span><br><span class="line"><span class="built_in">MKSampleMultiplyBlockRef</span> multiply = ^(<span class="keyword">void</span>) &#123;</span><br><span class="line">	reutrn a * b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用代码块</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, multiply());<span class="comment">// 200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改本地变量</span></span><br><span class="line">a = <span class="number">20</span>;</span><br><span class="line">b = <span class="number">50</span>;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, multiply());<span class="comment">// 200</span></span><br></pre></td></tr></table></figure>
<h5 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h5><blockquote>
<p><strong>说明：</strong>可以根据需要将变量标记为<code>静态的（全局的）</code>。<br><strong>捕获情况：</strong>同本地变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> a = <span class="number">10</span>, b = <span class="number">20</span>;</span><br><span class="line"><span class="built_in">MKSimpleMultiplyBlockRef</span> multiply = ^(<span class="keyword">void</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> a * b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, multiply());<span class="comment">// 200</span></span><br></pre></td></tr></table></figure>
<h5 id="参数变量"><a href="#参数变量" class="headerlink" title="参数变量"></a>参数变量</h5><blockquote>
<p><strong>说明：</strong>代码块中的参数变量与函数中的参数变量具有相同的作用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义代码块类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> (^<span class="built_in">MKSampleMultiply2BlockRef</span>)(<span class="keyword">double</span> c, <span class="keyword">double</span> d);</span><br><span class="line"><span class="comment">// 声明并实现代码块</span></span><br><span class="line"><span class="built_in">MKSimpleMultiply2BlockRef</span> multiply2 = ^(<span class="keyword">double</span> c, <span class="keyword">double</span> d) &#123;</span><br><span class="line">	<span class="keyword">return</span> c * d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用代码块</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%f, %f"</span>, multiply2(<span class="number">4</span>, <span class="number">5</span>), multiply2(<span class="number">5</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<h5 id="block变量"><a href="#block变量" class="headerlink" title="_block变量"></a>_block变量</h5><blockquote>
<p><strong>关键字：</strong><code>_block</code><br><strong>说明：</strong><code>本地变量</code>会被<code>代码块</code>当作<code>常量</code>获取到，如果想要修改它们的值，必须通过<code>_black</code>将它们声明为<code>可修改</code>的。<br><strong>限制：</strong>由两种情况不能使用<code>_block</code>修饰</p>
<ul>
<li>长度可变数组</li>
<li>包含长度可变数组的结构体</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用_block 修饰，使变量 c 在代码块中的副本可修改</span></span><br><span class="line">_block <span class="keyword">double</span> c = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">MKSampleMultiplyBlockRef</span> multiply = ^(<span class="keyword">double</span> a, <span class="keyword">double</span> b) &#123;</span><br><span class="line">	c = a * b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="代码块内部的本地变量"><a href="#代码块内部的本地变量" class="headerlink" title="代码块内部的本地变量"></a>代码块内部的本地变量</h5><blockquote>
<p><strong>说明：</strong>对<code>代码块来说</code>，和<code>本地变量</code>一样使用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义并实现代码块</span></span><br><span class="line"><span class="keyword">void</span> (^<span class="built_in">MKSampleBlockRef</span>)(<span class="keyword">void</span>) = ^(<span class="keyword">void</span>)&#123;</span><br><span class="line">	<span class="keyword">double</span> a = <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">double</span> c = <span class="number">2</span>;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"%f"</span>, a * c);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用代码块</span></span><br><span class="line"><span class="built_in">MKSimpleBlockRef</span>();</span><br></pre></td></tr></table></figure>
<h3 id="14-1-2-Objective-C代码块内存管理"><a href="#14-1-2-Objective-C代码块内存管理" class="headerlink" title="14.1.2    Objective-C代码块内存管理"></a>14.1.2    Objective-C代码块内存管理</h3><blockquote>
<p><strong>说明：</strong>代码块是对象，所以可以向它发送任何与内存管理由关的信息。</p>
<ul>
<li>如果引用了一个<code>Objective-C</code>对象，必须要<code>保留</code>它</li>
<li>如果类的方法中的<code>代码块</code>通过引用访问了一个实例变量，要<code>保留</code>一次<code>self</code>（执行所在方法的对象）</li>
<li>如果通过数值访问了一个实例变量，变量需要<code>保留</code></li>
</ul>
</blockquote>
<p><em>ProcessString.h：方法中包含代码块的类</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ProcessStrings</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>) <span class="built_in">NSString</span> *theString;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)testMyString;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>ProcessString.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"ProcessStrings.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ProcessStrings</span></span></span><br><span class="line"><span class="keyword">@synthesize</span> theString = _theString;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)testMyString</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 代码块1</span></span><br><span class="line">    <span class="built_in">NSString</span> *string1 = ^&#123;</span><br><span class="line">    	<span class="comment">// 规则2：直接通过引用（实例变量名）访问了实例变量，若没有ARC则应该保留self</span></span><br><span class="line">        <span class="keyword">return</span> [_theString stringByAppendingString:_theString];</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSString</span> *localObject = _theString;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 代码块2</span></span><br><span class="line">    <span class="built_in">NSString</span> *string2 = ^&#123;</span><br><span class="line">    	<span class="comment">// 规则3: 通过中间变量间接访问了实例变量，如果没有ARC则要保留localObject</span></span><br><span class="line">        <span class="keyword">return</span> [localObject stringByAppendingString:localObject];</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"ProcessStrings.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span></span><br><span class="line">    &#123;</span><br><span class="line">        ProcessStrings *myStringProcessor = [[ProcessStrings alloc] init];</span><br><span class="line">        myStringProcessor.theString = <span class="string">@"Hello Objective Blocks!"</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 调用对象中包含代码块的方法</span></span><br><span class="line">        [myStringProcessor testMyString];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>扩展：</strong>在C语言中，必须使用<code>Block_copy()</code>和<code>Block_release()</code>函数来适当地管理内存。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^<span class="built_in">MKSampleVoidBlockRef</span>)(<span class="keyword">void</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">MKSampleVoidBlockRef</span> block1 = ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Block1"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        block1();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">MKSampleVoidBlockRef</span> block2 = ^&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Block2"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        block2();</span><br><span class="line">        Block_release(block2);</span><br><span class="line">        </span><br><span class="line">        block2 = Block_copy(block1);</span><br><span class="line">        block2();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="14-2-并发性"><a href="#14-2-并发性" class="headerlink" title="14.2    并发性"></a>14.2    并发性</h2><blockquote>
<p><strong>说明：</strong>能够在同一时间执行多个任务的程序称为<code>并发的(concurrent)</code>程序。苹果公司提供了多种可以利用多核特性的<code>API</code>。</p>
</blockquote>
<table>
<thead>
<tr>
<th>相关技术选择</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>POSIX线程</td>
<td>利用并发行最基础的方法是使用<code>POSIX</code>线程来处理程序的不同部分使其能够独立运行。<code>POSIX线程</code>拥有支持<code>C</code>和<code>Objective-C</code>的API。</td>
<td>因为线程是级别较低的API，必须手动管理，挑战很大</td>
</tr>
<tr>
<td>GDC(Grand Central Dipatch)</td>
<td>运行在系统级别，减少了不少线程管理的麻烦</td>
<td>可以平衡应用程序所有内同的家在，从而提高计算机或设备的运行效率</td>
</tr>
</tbody>
</table>
<h3 id="14-2-1-同步"><a href="#14-2-1-同步" class="headerlink" title="14.2.1    同步"></a>14.2.1    同步</h3><blockquote>
<p><strong>关键字：</strong><code>@synchronized</code><br><strong>说明：</strong>用来设置<code>临界区</code>，确保多个线程不会在同一时间进入<code>临界区</code>。<br><strong>相关：</strong><code>@property</code>指令的<code>atomic</code>特性会让编译器通过插入<code>@synchronize(mutex, atomic)</code>生成强制彼此互斥的<code>getter</code>和<code>setter</code>方法（降低了代码性能），而<code>nonatomic</code>特性（默认）则不会。</p>
</blockquote>
<h4 id="14-2-1-1-选择性能"><a href="#14-2-1-1-选择性能" class="headerlink" title="14.2.1.1    选择性能"></a>14.2.1.1    选择性能</h4><blockquote>
<p><strong>说明：</strong><code>NSObject</code>提供了一些可以使代码在后台以较低性能运行的方法（方法名带有<code>performSelector</code>前缀）</p>
</blockquote>
<h5 id="performSelectorInBackground实例方法"><a href="#performSelectorInBackground实例方法" class="headerlink" title="performSelectorInBackground实例方法"></a>performSelectorInBackground实例方法</h5><blockquote>
<p><strong>说明：</strong>通过创建一个线程，在后端运行一个指定的方法。<br><strong>限制：</strong>指定运行的方法（第一个参数）要遵从以下限制</p>
<ul>
<li>方法中需要<code>@autoreleasepool</code></li>
<li>方法不能有返回值，参数最多一个且必须为<code>id</code>类型</li>
</ul>
<ol>
<li><code>- (void) myMethod;</code></li>
<li><code>- (void) myMethod:(id)myObject;</code></li>
</ol>
<p><strong>原型：</strong><code>NSObject</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;SEL&#125; 希望在后台运行的方法</span><br><span class="line">* @param &#123;id&#125; object 可以传递一个对象</span><br><span class="line">*/</span></span><br><span class="line">(<span class="keyword">void</span>) performSelectorInBackground:(nonnull SEL) withObject:(nullable <span class="keyword">id</span>)&gt;</span><br></pre></td></tr></table></figure>
<p><em>SelectorTester.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SelectorTester</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) runSelectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>SelectorTester.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"SelectorTester.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SelectorTester</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  封装对性能选择器的调用</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) runSelectors &#123;</span><br><span class="line">    <span class="comment">// 在后端运行不带参数的方法</span></span><br><span class="line">    [<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(myBackgroundMethod1) withObject:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">// 在后端运行带一个参数的方法</span></span><br><span class="line">    [<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(myBackgroundMethod2:) withObject:<span class="string">@"Hello Selector"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Done performing selectors"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @pravite</span><br><span class="line"> *  会被选择器调用的方法：不带参数</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) myBackgroundMethod1 &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"myBackgroundMethod1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  @pravite</span><br><span class="line"> *  会被选择器调用的方法：只有一个参数</span><br><span class="line"> *  @param &#123;id&#125; object 一个对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">void</span>) myBackgroundMethod2: (<span class="keyword">id</span>)object &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"myBackgroundMethod2 %@"</span>, object);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="14-2-1-2-调度队列"><a href="#14-2-1-2-调度队列" class="headerlink" title="14.2.1.2    调度队列"></a>14.2.1.2    调度队列</h4><blockquote>
<p><strong>说明：</strong><code>GDC</code>可以使用<code>调度队列（dispatch queue）</code>，共有3种。</p>
</blockquote>
<table>
<thead>
<tr>
<th>队列类型</th>
<th>说明</th>
<th>并行／串行</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>连续队列</td>
<td>根据指派的顺序执行任务</td>
<td>串行，先入先出（FIFO，栈）</td>
<td>可以创建多个<code>连续</code>队列，彼此并行</td>
</tr>
<tr>
<td>并发队列</td>
<td>并发执行一个或多个任务</td>
<td>并行，根据指派到队列的顺序开始执行</td>
<td>无法创建，只能从系统提供的并发队列中选择（一共3个）</td>
</tr>
<tr>
<td>主队列</td>
<td>应用程序的有效的主队列</td>
<td>主线程只有一个，无所谓串/并行</td>
<td>执行的应用程序的主线程任务</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>调度队列数据类型：</strong><code>dispatch_queue_t</code></p>
</blockquote>
<h5 id="连续队列"><a href="#连续队列" class="headerlink" title="连续队列"></a>连续队列</h5><blockquote>
<p><strong>说明：</strong>只要任务是异步提交的，队列会确保任务根据预定顺序执行，不会发生死锁。<br><strong>适用：</strong>一连串的任务需要按照一定的顺序执行的场景</p>
</blockquote>
<h6 id="dispatch-queue-create全局方法"><a href="#dispatch-queue-create全局方法" class="headerlink" title="dispatch_queue_create全局方法"></a>dispatch_queue_create全局方法</h6><blockquote>
<p><strong>说明：</strong>创建连续队列<br><strong>原型：</strong></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;const char *&#125; label 队列的名称</span><br><span class="line">* @param &#123;dispatch_queue_attr_t&#125; attr 队列的特性（可以为NULL）</span><br><span class="line">* @return &#123;dispatch_queue_t&#125; 顺序队列</span><br><span class="line">*/</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> dispatch_queue_create(<span class="keyword">const</span> <span class="keyword">char</span> *label, dispatch_queue_attr_t attr);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明连续队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> my_serial_queue;</span><br><span class="line"><span class="comment">// 创建连续队列</span></span><br><span class="line">my_serial_queue = dispatch_queue_create(<span class="string">"com.apress.MySerialQueue1"</span>, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<h5 id="并发队列"><a href="#并发队列" class="headerlink" title="并发队列"></a>并发队列</h5><blockquote>
<p><strong>说明：</strong>并发调度队列适用于那些可以并行运行的任务</p>
<ul>
<li>开始执行时间遵从FIFO</li>
<li>任务可以在前一个任务结束前就开始执行</li>
<li>一次所运行的任务数量是无法预测的（根据其它运行的任务的状况）</li>
</ul>
<p><strong>技巧：</strong>如果需要确保每次运行的任务的数量都是一样的，可以通过线程<code>API</code>来手动管理线程。</p>
</blockquote>
<h6 id="dispatch-get-global-queue全局方法"><a href="#dispatch-get-global-queue全局方法" class="headerlink" title="dispatch_get_global_queue全局方法"></a>dispatch_get_global_queue全局方法</h6><blockquote>
<p><strong>说明：</strong>获取系统的并发队列。<br><strong>原型：</strong><code>/usr/include/dispatch/queue.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;long&#125; identifier 优先级选项</span><br><span class="line">* @param &#123;unsigned long&#125; flags 标记（可以为0）</span><br><span class="line">* @return &#123;dispatch_queue_t&#125; 顺序队列</span><br><span class="line">*/</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> dispatch_get_global_queue(<span class="keyword">long</span> identifier, <span class="keyword">unsigned</span> <span class="keyword">long</span> flags);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明并发队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> my_global_queue;</span><br><span class="line"><span class="comment">// 获取并发队列（默认优先级）</span></span><br><span class="line">my_global_queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h5 id="主队列"><a href="#主队列" class="headerlink" title="主队列"></a>主队列</h5><h6 id="dispatch-get-current-queue全局方法"><a href="#dispatch-get-current-queue全局方法" class="headerlink" title="dispatch_get_current_queue全局方法"></a>dispatch_get_current_queue全局方法</h6><blockquote>
<p><strong>说明：</strong>获取<code>当前运行的</code>队列代码块，如果在代码块的对象之外调用了这个函数，则它会返回<code>主队列</code>。<br><strong>注意：</strong>该方法在从<code>OS X 10.9</code>和<code>ios 6</code>开始被废弃，因为GCD队列本身是不可重入的，同步阻塞会导致死锁。<br><strong>用途：</strong>仍然可以作为调试手段在代码中使用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取主线程或当前队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> theQueue = dispatch_get_current_queue();</span><br></pre></td></tr></table></figure>
<h3 id="14-2-2-队列也要内存管理"><a href="#14-2-2-队列也要内存管理" class="headerlink" title="14.2.2    队列也要内存管理"></a>14.2.2    队列也要内存管理</h3><blockquote>
<p><strong>说明：</strong><code>调度队列</code>是引用计数对象，可以使用<code>dispatch_retain()</code>和<code>dispatch_release()</code>来修改队列的保留计数器的值。</p>
</blockquote>
<h4 id="14-2-2-1-队列的上下文"><a href="#14-2-2-1-队列的上下文" class="headerlink" title="14.2.2.1    队列的上下文"></a>14.2.2.1    队列的上下文</h4><blockquote>
<p><strong>说明：</strong>可以向<code>调度对象（包括调度队列）</code>指派<code>全局数据上下文</code>，可以在上下文中指派任意类型的数据，比如<code>Objective-C</code>对象或指针。<br><strong>内存管理：</strong>必须在需要<code>队列上下文</code>的时候分配内存并在队列销毁之前进行清理。</p>
</blockquote>
<h5 id="dispatch-set-context全局方法"><a href="#dispatch-set-context全局方法" class="headerlink" title="dispatch_set_context全局方法"></a>dispatch_set_context全局方法</h5><blockquote>
<p><strong>说明：</strong>为指定队列设置<code>全局上下文</code>。<br><strong>原型：</strong><code>/usr/include/dispatch/object.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_object_t&#125; object 调度队列</span><br><span class="line">* @param &#123;void *&#125; context 上下文</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> dispatch_set_context(dispatch_object_t object, <span class="keyword">void</span> *context);</span><br></pre></td></tr></table></figure>
<h5 id="dispatch-get-context全局方法"><a href="#dispatch-get-context全局方法" class="headerlink" title="dispatch_get_context全局方法"></a>dispatch_get_context全局方法</h5><blockquote>
<p><strong>说明：</strong>获得<code>调度队列</code>的<code>全局数据上下文</code>。<br><strong>原型：</strong><code>/usr/include/dispatch/object.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_object_t&#125; object 调度队列</span><br><span class="line">* @return &#123;void *&#125; 全局数据上下文</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> * dispatch_get_context(dispatch_object_t object);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建可变字典（作为全局数据上下文）</span></span><br><span class="line"><span class="built_in">NSMutableDictionary</span> *myContext = [[<span class="built_in">NSMutableDictionary</span> alloc] initWithCapacity:<span class="number">5</span>];</span><br><span class="line"><span class="comment">// 为全局上下文添加队列需要的数据</span></span><br><span class="line">[myContext setObject:<span class="string">@"My Context"</span> forKey:<span class="string">@"title"</span>];</span><br><span class="line">[myContext setObject:[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">0</span>] forKey:<span class="string">@"value"</span>];</span><br><span class="line"><span class="comment">// 为连续队列 my_serial_queue 设置全局数据上下文</span></span><br><span class="line">dispatch_set_context(my_serial_queue, (__bridge_retained <span class="keyword">void</span> *)myContext);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取全局数据上下文(桥接转换__bridge，告诉ARC不想自己来管理上下文的内存)</span></span><br><span class="line">myContext = (__bridge <span class="built_in">NSMutableDictionary</span> *)dispatch_get_context(my_serial_queue);</span><br></pre></td></tr></table></figure>
<h4 id="14-2-2-2-全局数据上下文内存管理"><a href="#14-2-2-2-全局数据上下文内存管理" class="headerlink" title="14.2.2.2    全局数据上下文内存管理"></a>14.2.2.2    全局数据上下文内存管理</h4><blockquote>
<p><strong>说明：</strong>编写一个<code>终结器(finalizer)</code>函数，在<code>dealloc</code>中调用。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 终结器函数</span><br><span class="line">* @param &#123;void *&#125; context 全局数据上下文对象</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> myFinalizerFunction(<span class="keyword">void</span> *context) &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"myFinalizerFunction"</span>);</span><br><span class="line">	<span class="comment">// 桥接转换：将全局数据上下文对象桥接转换为具体类型</span></span><br><span class="line">	<span class="comment">// 其中，__bridge_transfer 将拥有权限转移到了本函数中，意味着该对象的内存管理由全局释放池换成了我们的函数</span></span><br><span class="line">	<span class="built_in">NSMutableDictionary</span> *theData = (__bridge_transfer <span class="built_in">NSMutableDictionary</span>*)context;</span><br><span class="line">	<span class="comment">// 清空作为全局数据上下文的对象</span></span><br><span class="line">	[theData removeAllObjects];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="14-2-2-3-向调度队列添加任务"><a href="#14-2-2-3-向调度队列添加任务" class="headerlink" title="14.2.2.3    向调度队列添加任务"></a>14.2.2.3    向调度队列添加任务</h4><blockquote>
<p><strong>说明：</strong>有两种方式可以向队列中添加任务，每种方式针对<code>代码块</code>和<code>函数</code>各有一个调度函数（共4个）</p>
<ul>
<li><strong>同步：</strong>队列会一直等待前面任务结束</li>
<li><strong>异步：</strong>添加任务后，不必等待任务，函数会立刻返回（推荐，因为不会阻塞其他代码的运行）</li>
</ul>
</blockquote>
<p>|<em>**</em>|同步|异步|<br>|代码块|<code>dispatch_sync</code>|<code>dispatch_async</code>|<br>|函数|<code>dispatch_sync_f</code>|<code>dispatch_async_f</code>|</p>
<h5 id="dispatch-sync全局函数"><a href="#dispatch-sync全局函数" class="headerlink" title="dispatch_sync全局函数"></a>dispatch_sync全局函数</h5><blockquote>
<p><strong>说明：</strong>向队列中<code>同步</code>添加<code>代码块</code>。<br><strong>原型：</strong><code>/use/include/dispatch/queue.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_queue_t&#125; queue 调度队列</span><br><span class="line">* @param &#123;dispatch_block_t&#125; block 代码块</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="built_in">dispatch_async</span>(<span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);</span><br></pre></td></tr></table></figure>
<h5 id="dispatch-async全局函数"><a href="#dispatch-async全局函数" class="headerlink" title="dispatch_async全局函数"></a>dispatch_async全局函数</h5><blockquote>
<p><strong>说明：</strong>向队列中<code>异步</code>添加<code>代码块</code>。<br><strong>原型：</strong><code>/use/include/dispatch/queue.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_queue_t&#125; queue 调度队列</span><br><span class="line">* @param &#123;dispatch_block_t&#125; block 代码块</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="built_in">dispatch_async</span>(<span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步添加代码块：内联方式</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(my_serial_queue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Serial Task 1"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步添加代码块：非内联</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^dispatch_block_t)(<span class="keyword">void</span>);</span><br><span class="line">dispatch_block_t myBlock = ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"My Prefined block"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">dispatch_async</span>(my_serial_queue, myBlock);</span><br></pre></td></tr></table></figure>
<h5 id="dispatch-sync-f全局函数"><a href="#dispatch-sync-f全局函数" class="headerlink" title="dispatch_sync_f全局函数"></a>dispatch_sync_f全局函数</h5><blockquote>
<p><strong>说明：</strong>向队列中<code>同步</code>添加<code>代码块</code>。<br><strong>原型：</strong><code>/use/include/dispatch/queue.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_queue_t&#125; queue 调度队列</span><br><span class="line">* @param &#123;void *&#125; context 需要传递的任意上下文</span><br><span class="line">* @param &#123;dispatch_function_t&#125; work 函数</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> dispatch_async_f(<span class="built_in">dispatch_queue_t</span> queue,	<span class="keyword">void</span> *context,	dispatch_function_t work);</span><br></pre></td></tr></table></figure>
<h5 id="dispatch-async-f全局函数"><a href="#dispatch-async-f全局函数" class="headerlink" title="dispatch_async_f全局函数"></a>dispatch_async_f全局函数</h5><blockquote>
<p><strong>说明：</strong>向队列中<code>异步</code>添加<code>代码块</code>。<br><strong>原型：</strong><code>/use/include/dispatch/queue.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_queue_t&#125; queue 调度队列</span><br><span class="line">* @param &#123;void *&#125; context 需要传递的任意上下文</span><br><span class="line">* @param &#123;dispatch_function_t&#125; work 函数</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> dispatch_async_f(<span class="built_in">dispatch_queue_t</span> queue,	<span class="keyword">void</span> *context,	dispatch_function_t work);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义好要添加到队列的函数</span></span><br><span class="line"><span class="keyword">void</span> myDispatchFunction (<span class="keyword">void</span> *argument) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Serial Task %@"</span>, (__bridge <span class="built_in">NSNumber</span> *)argument);</span><br><span class="line">    <span class="comment">// 获得当前队列的全局数据上下文</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *context = (__bridge <span class="built_in">NSMutableDictionary</span> *)dispatch_get_context(dispatch_get_current_queue());</span><br><span class="line">    <span class="comment">// 在字典中索引</span></span><br><span class="line">    <span class="built_in">NSNumber</span> *value = [context objectForKey:<span class="string">@"value"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"value = %@"</span>, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步向队列中添加函数</span></span><br><span class="line">dispatch_async_f(my_serial_queue, (__bridge <span class="keyword">void</span> *)[<span class="built_in">NSNumber</span> numberWithInt:<span class="number">3</span>], (dispatch_function_t)myDispatchFunction);</span><br></pre></td></tr></table></figure>
<h4 id="14-2-2-3-调度队列的暂停和重启"><a href="#14-2-2-3-调度队列的暂停和重启" class="headerlink" title="14.2.2.3    调度队列的暂停和重启"></a>14.2.2.3    调度队列的暂停和重启</h4><h5 id="dispatch-suspend全局方法"><a href="#dispatch-suspend全局方法" class="headerlink" title="dispatch_suspend全局方法"></a>dispatch_suspend全局方法</h5><blockquote>
<p><strong>说明：</strong>暂停队列<br><strong>原型：</strong><code>/use/include/dispatch/object.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_object_t&#125; object 要暂停的队列</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> dispatch_suspend(dispatch_object_t object);</span><br></pre></td></tr></table></figure>
<h5 id="dispatch-resume全局方法"><a href="#dispatch-resume全局方法" class="headerlink" title="dispatch_resume全局方法"></a>dispatch_resume全局方法</h5><blockquote>
<p><strong>说明：</strong>重启队列<br><strong>原型：</strong><code>/use/include/dispatch/object.h</code></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* @param &#123;dispatch_object_t&#125; object 要暂停的队列</span><br><span class="line">*/</span></span><br><span class="line"><span class="keyword">void</span> dispatch_resume(dispatch_object_t object);</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 暂停队列</span></span><br><span class="line">dispatch_suspend(my_serial_queue);</span><br><span class="line"><span class="comment">// 重启队列</span></span><br><span class="line">dispatch_resume(my_serial_queue);</span><br></pre></td></tr></table></figure>
<h3 id="14-2-3-操作队列"><a href="#14-2-3-操作队列" class="headerlink" title="14.2.3    操作队列"></a>14.2.3    操作队列</h3><blockquote>
<p><strong>说明：</strong>有一些称为<code>操作（operation）</code>的<code>API</code>，可以让队列使用起来更加简单。</p>
<ol>
<li>创建一个<code>操作</code>对象</li>
<li>将其指派给<code>操作队列</code></li>
<li><code>操作</code>被队列执行</li>
</ol>
</blockquote>
<h4 id="操作的创建方式"><a href="#操作的创建方式" class="headerlink" title="操作的创建方式"></a><code>操作</code>的创建方式</h4><blockquote>
<p><strong>说明：</strong>一共有3种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>调用操作（<code>NSInvocationOperation</code>）</td>
<td>前提是已经拥有一个可以完成工作的类，并且想在队列上执行</td>
</tr>
<tr>
<td>代码块操作（<code>NSBlockOperation</code>）</td>
<td>类似包含了要执行代码块的<code>dispatch_async</code>函数</td>
</tr>
<tr>
<td>自定义的<code>操作</code></td>
<td>通过继承<code>NSOperation</code>定义自己的<code>操作</code></td>
</tr>
</tbody>
</table>
<h5 id="方式一：创建调用操作"><a href="#方式一：创建调用操作" class="headerlink" title="方式一：创建调用操作"></a>方式一：创建<code>调用操作</code></h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyCustomClass</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSOperation</span> *)operationWithData: (<span class="keyword">id</span>)data &#123;</span><br><span class="line">	<span class="keyword">return</span> [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget: <span class="keyword">self</span> selectorL <span class="keyword">@selector</span>(myWorkerMethod:)object:data];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 做具体工作的函数</span></span><br><span class="line">- (<span class="keyword">void</span>)myWorkerMethod: (<span class="keyword">id</span>)data &#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"My Worker Method %@"</span>, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：创建代码块操作"><a href="#方式二：创建代码块操作" class="headerlink" title="方式二：创建代码块操作"></a>方式二：创建<code>代码块操作</code></h5><blockquote>
<p><strong>说明：</strong>创建时作为参数的<code>代码块</code>的类型和在<code>调度队列</code>中使用的相同。</p>
<ul>
<li>一旦创建了第一个<code>代码块操作</code>，便可以通过<code>addExecutionBlock</code>方法继续添加更多的<code>代码块</code></li>
<li>根据<code>队列</code>的类型，代码块会分别以连续或并行的方式运行</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSBlockOperation</span> *blockOperation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock: ^ &#123;</span><br><span class="line">	<span class="comment">// 具体工作内容</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过代码块操作，继续添加代码块</span></span><br><span class="line">[blockOperation addExecutionBlock:^&#123;</span><br><span class="line">	<span class="comment">// 更多要做工作</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h4 id="向队列中添加操作"><a href="#向队列中添加操作" class="headerlink" title="向队列中添加操作"></a>向队列中添加操作</h4><blockquote>
<p><strong>说明：</strong>可以使用<code>NSOperationQueue</code>来取代之前使用的<code>dispatch_queue</code>函数，特点如下</p>
<ul>
<li>并发执行<code>操作</code></li>
<li>具有<code>相关性</code>，也就是说，如果某个<code>操作</code>是基于其它<code>操作</code>的，则也会先被执行</li>
</ul>
<p><strong>技巧：</strong>如果要确保添加的<code>操作</code>是连续执行（串行）的，可以设置最大并发操作数为1，这样会按照<code>先入先出</code>的规范执行</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取队列</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *currentQueue = [<span class="built_in">NSOperation</span> currentQueue];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加操作</span></span><br><span class="line">[theQueue addOperation:blockOperation];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以添加代码块替代操作对象</span></span><br><span class="line">[theQueue addOperationWithBlock:^&#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"my work"</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="14-3-小结"><a href="#14-3-小结" class="headerlink" title="14.3    小结"></a>14.3    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/13/o-c基础教程第二版_13 协议/" itemprop="url">
                  13 协议
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-13T10:40:50+08:00" content="2016-05-13">
              2016-05-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/13/o-c基础教程第二版_13 协议/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/13/o-c基础教程第二版_13 协议/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="13-1-正式协议"><a href="#13-1-正式协议" class="headerlink" title="13.1    正式协议"></a>13.1    正式协议</h2><blockquote>
<p><strong>说明：</strong>正式协议类似<code>Java</code>的接口。</p>
<ul>
<li><strong>声明协议：</strong>通过<code>@protocol</code>创建协议的声明。</li>
<li><strong>采用协议：</strong>在类的<code>@interface</code>声明中列出协议的名称。</li>
<li><strong>遵守协议：</strong>在类的<code>@implementation</code>中实现协议的所有方法（否则编译器会生成警告）。</li>
</ul>
</blockquote>
<h3 id="13-1-1-声明协议"><a href="#13-1-1-声明协议" class="headerlink" title="13.1.1    声明协议"></a>13.1.1    声明协议</h3><blockquote>
<p><strong>说明：</strong>类似类或类别的声明</p>
<ul>
<li>可以继承父协议，类似继承父类</li>
<li>内部是方法声明列表</li>
<li>在协议中不会引入新的实例变量</li>
</ul>
<p><strong>语法：</strong></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> 协议名 &lt;父协议名</span></span><br><span class="line"><span class="comment">// 方法列表</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="Cocoa的NSCopying协议"><a href="#Cocoa的NSCopying协议" class="headerlink" title="Cocoa的NSCopying协议"></a>Cocoa的<code>NSCopying</code>协议</h4><blockquote>
<p><strong>说明：</strong>如果采用了该协议，对象就会知道如何创建自己的副本。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">NSCopying</span></span></span><br><span class="line">- (<span class="keyword">id</span>) copyWithZone: (<span class="built_in">NSZone</span> *) zone;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h4 id="Cocoa的NSCoding协议"><a href="#Cocoa的NSCoding协议" class="headerlink" title="Cocoa的NSCoding协议"></a>Cocoa的<code>NSCoding</code>协议</h4><blockquote>
<p><strong>说明：</strong>能够对自身进行编码和解码</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">NSCoding</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 接收对象的实例变量并将其转换为NSCoder类的对象</span><br><span class="line">*</span><br><span class="line">* @param &#123;NSCoder *&#125; encoder</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">void</span>) encodeWithCoder: (<span class="built_in">NSCoder</span> *) encoder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 从NSCoder对象中提取经过转换雪藏的实例变量，并使用它们去初始化新的对象</span><br><span class="line">*</span><br><span class="line">* @param &#123;NSCoder *&#125; decoder</span><br><span class="line">*/</span></span><br><span class="line">- (<span class="keyword">id</span>) initWithCoder: (<span class="built_in">NSCoder</span> *) decoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="13-1-2-采用协议"><a href="#13-1-2-采用协议" class="headerlink" title="13.1.2    采用协议"></a>13.1.2    采用协议</h3><blockquote>
<p><strong>说明：</strong>要采用某个协议，可以在类的声明中列出该协议的名称，并用<code>&lt;&gt;</code>括起来<br><strong>语法：</strong>可以同时实现多个协议，中间用<code>,</code>分隔</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> 类名: 父类明 &lt;协议1, 协议2, ...</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 实例变量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遵守协议实现的方法</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span>: <span class="title">NSObject</span> &lt;<span class="title">NSCoping</span>, <span class="title">NSCoding</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 实例变量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遵守协议实现的方法</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="13-1-3-实现协议"><a href="#13-1-3-实现协议" class="headerlink" title="13.1.3    实现协议"></a>13.1.3    实现协议</h3><h2 id="13-2-复制"><a href="#13-2-复制" class="headerlink" title="13.2    复制"></a>13.2    复制</h2><blockquote>
<p><strong>说明：</strong>复制分为两类，<code>浅层复制（shallow copy）</code>和<code>深层复制（deep copy）</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>复制</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>浅层复制</td>
<td>只会复制指向引用对象的指针</td>
</tr>
<tr>
<td>深层复制</td>
<td>将复制引用的对象</td>
</tr>
</tbody>
</table>
<h3 id="13-2-1-复制-Engine"><a href="#13-2-1-复制-Engine" class="headerlink" title="13.2.1    复制 Engine"></a>13.2.1    复制 Engine</h3><blockquote>
<p><strong>说明：</strong>没有实例变量或属性。</p>
</blockquote>
<p><em>Engine.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  采纳 NSCopying 协议</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Engine</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="comment">// Engine</span></span><br></pre></td></tr></table></figure>
<p><em>Engine.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Engine</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *) description</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">@"I am an engine.  Vrooom!"</span>);</span><br><span class="line">&#125; <span class="comment">// description</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遵守协议，实现复制自身的方法</span><br><span class="line"> *</span><br><span class="line"> *  @param zone 内存区域</span><br><span class="line"> *</span><br><span class="line"> *  @return &#123;id&#125; 复制的对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>) copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    Engine *engineCopy;</span><br><span class="line">    <span class="comment">// 创建一个当前类（Engine或其子类）创建一个新对象</span></span><br><span class="line">    engineCopy = [[[<span class="keyword">self</span> class] allocWithZone:zone] init];</span><br><span class="line">    <span class="keyword">return</span> engineCopy;</span><br><span class="line">&#125;<span class="comment">// copyWithZone</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Engine</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2-2-复制-Tire"><a href="#13-2-2-复制-Tire" class="headerlink" title="13.2.2    复制 Tire"></a>13.2.2    复制 Tire</h3><blockquote>
<p><strong>说明：</strong>有属性，要考虑实例变量（包括子类的）的复制，需要选择合适的构造函数或者使用<code>setter</code>修改对象的属性。<br><strong>扩展：</strong>可以使用<code>C</code>语言风格的<code>指针运算符</code>直接访问实例变量。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tireCopy-&gt;pressure = presssure;</span><br><span class="line">tireCopy-&gt;treadDepth = treadDepth;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>技巧：</strong>一般来说，当设置属性不太可能涉及额外工作时，我们尽量使用init方法和访问器方法。</p>
</blockquote>
<p><em>Tire.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Tire</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> pressure;</span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> treadDepth;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithPressure:(<span class="keyword">float</span>)pressure treadDepth:(<span class="keyword">float</span>)treadDepth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Tire.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Tire</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  遵守协议，实现复制自身的方法</span><br><span class="line"> *</span><br><span class="line"> *  @param zone 内存区域</span><br><span class="line"> *</span><br><span class="line"> *  @return 复制的对象</span><br><span class="line"> */</span></span><br><span class="line">- (<span class="keyword">id</span>) copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    Tire *tireCopy;</span><br><span class="line">    <span class="comment">// 调用便利构造器创建对象（属性相同）</span></span><br><span class="line">    tireCopy = [[[<span class="keyword">self</span> class] allocWithZone:zone] initWithPressure:<span class="keyword">self</span>.pressure treadDepth:<span class="keyword">self</span>.treadDepth];</span><br><span class="line">    <span class="keyword">return</span> (tireCopy);</span><br><span class="line">&#125;<span class="comment">// copyWithZone</span></span><br><span class="line"><span class="comment">// 构造器</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2-3-复制-Car"><a href="#13-2-3-复制-Car" class="headerlink" title="13.2.3    复制 Car"></a>13.2.3    复制 Car</h3><p><em>Car.h</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Tire</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Engine</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Car</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<p><em>Car.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Car.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Engine.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Tire.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Car</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>) copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    Car *carCopy;</span><br><span class="line">    <span class="comment">// 创建车身</span></span><br><span class="line">    carCopy = [[[<span class="keyword">self</span> class] allocWithZone:zone] init];</span><br><span class="line">    <span class="comment">// 基本设置</span></span><br><span class="line">    carCopy.name = <span class="keyword">self</span>.name;</span><br><span class="line">    Engine *engineCopy;</span><br><span class="line">    engineCopy = [engine <span class="keyword">copy</span>];</span><br><span class="line">    carCopy.engine = engineCopy;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i= <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        Tire *tireCopy;</span><br><span class="line">        tireCopy = [[<span class="keyword">self</span> tireAtIndex:i] <span class="keyword">copy</span>];</span><br><span class="line">        [carCopy setTire:tireCopy atIndex:i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (carCopy);</span><br><span class="line">&#125;<span class="comment">// copyWithZone</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span> <span class="comment">// Car</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2-4-协议和数据"><a href="#13-2-4-协议和数据" class="headerlink" title="13.2.4    协议和数据"></a>13.2.4    协议和数据</h3><blockquote>
<p><strong>说明：</strong>可以在实例变量和方法参数的后面添加<code>&lt;协议名&gt;</code>来对对象是够遵守协议进行类型检查。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要求 object 遵守 NSCopying 协议,否则编译器会给出警告</span></span><br><span class="line">- (<span class="keyword">void</span>) setObjectValue: (<span class="keyword">id</span>&lt;<span class="built_in">NSCopying</span>&gt;) object;</span><br></pre></td></tr></table></figure>
<h2 id="13-3-Objective-C-2-0-的新特性"><a href="#13-3-Objective-C-2-0-的新特性" class="headerlink" title="13.3    Objective-C 2.0 的新特性"></a>13.3    Objective-C 2.0 的新特性</h2><blockquote>
<p><strong>说明：</strong><code>Objective-C 2.0</code>中增加了两个新的协议修饰符：<code>@optional</code>和<code>@required</code>，用来取代<code>非正式协议</code></p>
<ul>
<li><code>@optional</code>：后面的方法声明列表可以实现也可以不实现</li>
<li><code>@required</code>后面的方法列表中的方法必须被实现</li>
</ul>
<p><strong>优点(相比非正式协议)：</strong>可以用来在类声明中明确表达我们的意图。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@proptocol BaseballPlayer</span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须实现</span></span><br><span class="line">- (<span class="keyword">void</span>) drawHugeSalary;</span><br><span class="line"><span class="comment">// 可以实现</span></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>) slideeHome;</span><br><span class="line">- (<span class="keyword">void</span>) catchBall;</span><br><span class="line">- (<span class="keyword">void</span>) throwBall;</span><br><span class="line"><span class="comment">// 必须实现</span></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>) swingBat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="comment">//</span></span><br></pre></td></tr></table></figure>
<h2 id="13-4-委托方法"><a href="#13-4-委托方法" class="headerlink" title="13.4    委托方法"></a>13.4    委托方法</h2><blockquote>
<p><strong>说明：</strong><code>委托</code>是一个经常与<code>协议</code>共用的特性。<br><strong>举例：</strong><code>管理者</code>将部分具体工作委托给<code>工作人员</code>完成，<code>工作人员类</code>采纳了指定<code>协议</code>。<br><img src="http://o6ul1xz4z.bkt.clouddn.com/img/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-01-22%20%E4%B8%8B%E5%8D%886.19.00.png" alt="Alt text"></p>
</blockquote>
<p><em>WorkerProtocol.h：工作人员类采纳的协议</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">WorkerProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line">- (<span class="keyword">void</span>)doSomeOptionalWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@required</span></span><br><span class="line">- (<span class="keyword">void</span>)doSomeRequiredWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Worker1.h + Worker1.m</em> </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WorkerProtocol.h"</span></span></span><br><span class="line"><span class="comment">// 采纳了协议 WorkerProtocol</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Worker1</span> : <span class="title">NSObject</span> &lt;<span class="title">WorkerProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Worker1.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Worker1</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doSomeRequiredWork &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Worker1 doing required work."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Worker2.h + Worker2.m</em> </p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WorkerProtocol.h"</span></span></span><br><span class="line"><span class="comment">// 采纳了协议 WorkerProtocol</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Worker2</span> : <span class="title">NSObject</span> &lt;<span class="title">WorkerProtocol</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Worker2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Worker2</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doSomeRequiredWork &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Worker2 doing required work."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doSomeOptionalWork &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Worker2 doing optional work."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>Manager.h + Manager.m：管理者（会委托部分工作给设置的委托对象）</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"WorkerProtocol.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Manager</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>) <span class="keyword">id</span> &lt;WorkerProtocol&gt; delegate;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doWork;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Manager.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义私有方法</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Manager</span> ()</span></span><br><span class="line">- (<span class="keyword">void</span>)myWork;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Manager</span></span></span><br><span class="line"><span class="keyword">@synthesize</span> delegate;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)doWork</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用委托对象完成必要工作</span></span><br><span class="line">    [delegate doSomeRequiredWork];</span><br><span class="line">    <span class="comment">// 检查是否有额外工作，有则做</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">YES</span> == [delegate respondsToSelector:<span class="keyword">@selector</span>(doSomeOptionalWork)])</span><br><span class="line">    &#123;</span><br><span class="line">        [delegate doSomeOptionalWork];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行自己的私有方法</span></span><br><span class="line">    [<span class="keyword">self</span> myWork];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)myWork &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"I am a manager and I am working"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>main.m</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Manager.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Worker1.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"Worker2.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 管理者</span></span><br><span class="line">        Manager *manager = [[Manager alloc] init];</span><br><span class="line">        <span class="comment">// 委托对象</span></span><br><span class="line">        Worker1 *worker1 = [[Worker1 alloc] init];</span><br><span class="line">        <span class="comment">// 为管理者设置委托对象</span></span><br><span class="line">        manager.delegate = worker1;</span><br><span class="line">        <span class="comment">// 工作（内部委托 worker1 工作）</span></span><br><span class="line">        [manager doWork];</span><br><span class="line">        </span><br><span class="line">        Worker2 *worker2 = [[Worker2 alloc] init];</span><br><span class="line">        manager.delegate = worker2;</span><br><span class="line">        [manager doWork];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="13-5-小结"><a href="#13-5-小结" class="headerlink" title="13.5    小结"></a>13.5    小结</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sean" />
          <p class="site-author-name" itemprop="name">Sean</p>
          <p class="site-description motion-element" itemprop="description">整理了一批过去一段时间ios相关的笔记，其它的笔记也整理下？源码分享出来？再说吧...反正也只有自己会看吧...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">98</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sean</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lapuda-er"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
